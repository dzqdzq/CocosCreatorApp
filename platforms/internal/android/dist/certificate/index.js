"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path");let vm,panel=null;const Vue=require("vue/dist/vue.js");async function ready(){vm=new Vue({el:(panel=this).$.certificate,data:{settings:{password:"",confirmPassword:"",alias:"",aliasPassword:"",confirmAliasPassword:"",validity:3650,commonName:"",organization:"",organizationalUnit:"",locality:"",state:"",country:""},dirty:!1,saveBtnState:!1,saveBtnDisabled:!1,generateSuccess:!1,verifyResult:{}},methods:{onConfirm(e){const t=e.target.getAttribute("name");if(!t)return;const s=e.target.value;this.dirty=!0,this.saveBtnState=!1;const i=this.judgeEmpty(t,s);this.verifyResult[t]=i,i&&console.warn(`${t} can't be empty!`),this.saveBtnDisabled=this.calcBtnState(),this.settings[t]=s,Editor.Profile.setConfig("android",`certificate.${t}`,s)},judgeEmpty(e,t){let s="";return(!t||t.trim&&0==t.trim().length)&&(s=`${e} Can't be empty`),s},onGenerate(){const e=this;-1===process.env.PATH.indexOf("/usr/bin/openssl")&&(process.env.PATH+=":/usr/bin/openssl");const t=e.settings.certificatePath,{country:s,state:i,locality:a,organization:r,organizationalUnit:o,commonName:n,email:c}=e.settings;var l=`/C=${s}/ST=${i}/L=${a}/O=${r}/OU=${o}/CN=${n}/emailAddress=${c}`;const d=path_1.join(Editor.App.path,"../tools/openSSLWin64/bin");var u=path_1.join(d,"openssl"),p=`${"win32"===process.platform?u:"openssl"} req -newkey rsa:2048 -nodes -keyout private.pem -x509 -days 3650 -out certificate.pem -subj ${l}`,f=path_1.join(d,"openssl.cfg"),m="win32"===process.platform?{OPENSSL_CONF:f}:process.env;(0,require("child_process").exec)(`${p}`,{env:m,cwd:t},t=>{if(t)return e.generateSuccess=!1,void console.error(Editor.I18n.t("builder.certificate.build_certificate_fail")+t);console.log(Editor.I18n.t("builder.certificate.build_certificate_complete")),e.generateSuccess=!0,Editor.Panel.close("builder.certificate")})},calcBtnState(){const e=this;if(e.saveBtnState)return!0;for(const t of Object.keys(e.verifyResult))if(e.verifyResult[t])return!0;return!1},async initData(){const e=await Editor.Profile.getConfig("builder","certificate");Object.assign(this.settings,e)}},async mounted(){this.netStatus="success",await this.initData()}})}async function beforeClose(){}async function close(){}async function checkIsSave(){if(!vm||!vm.dirty)return;const e=Editor.I18n.t,t=await Editor.Dialog.warn(e("builder.splash_setting.is_save_dialog.title"),{buttons:[e("builder.splash_setting.is_save_dialog.save"),e("builder.splash_setting.is_save_dialog.cancel"),e("builder.splash_setting.is_save_dialog.abort")],default:0,cancel:1});return 1!==t.response&&(0===t.response&&await vm.saveSettings(),!0)}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../dist/certificate.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/certificate.html"),"utf8"),exports.$={certificate:".certificate"},exports.methods={},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;