"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=exports.getAPILevel=exports.ready=exports.$=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),options_1=require("./options"),lodash=require("lodash");let panel;exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/builder/view.html"),"utf8");const methods={async onSetAndroidSDK(){Editor.Message.send("preferences","open-settings","program")},getDefaultPackageName:()=>options_1.defaultOptions.packageName,onNewKeyStore(){Editor.Panel.open("android.certificate")},onChangeDebugKeystore(e){const t=this;t.onUpdateOptions("useDebugKeystore",e),!0===e?(t.pkgErrorMap.keystorePath=null,t.pkgErrorMap.keystorePassword=null,t.pkgErrorMap.keystoreAlias=null,t.pkgErrorMap.keystoreAliasPassword=null):(t.pkgErrorMap.keystorePath=options_1.verificationFunc("keystorePath",t.pkgOptions.keystorePath,t.options).error,t.pkgErrorMap.keystorePassword=options_1.verificationFunc("keystorePassword",t.pkgOptions.keystorePassword,t.options).error,t.pkgErrorMap.keystoreAlias=options_1.verificationFunc("keystoreAlias",t.pkgOptions.keystoreAlias,t.options).error,t.pkgErrorMap.keystoreAliasPassword=options_1.verificationFunc("keystoreAliasPassword",t.pkgOptions.keystoreAliasPassword,t.options).error),t.emitChange()},async onConfirm(e){const t=e.target.value,o=e.target.getAttribute("path");await this.onUpdateOptions(o,t),this.emitChange()},async onUpdateOptions(e,t){if(!e)return;lodash.set(this.pkgOptions,e,t);const o=await options_1.verificationFunc(e,t,this.options);this.$set(this.pkgErrorMap,e,o.error)},emitChange(){panel.dispatch("update",`packages.${this.pkgName}`,this.pkgOptions,this.pkgErrorMap)},async onChangeABI(e,t){const o=this,r=e.target.value;Array.isArray(o.pkgOptions.appABIs)||(o.pkgOptions.appABIs=[]),r?o.pkgOptions.appABIs.push(t):o.pkgOptions.appABIs.splice(o.pkgOptions.appABIs.indexOf(t),1),await o.onUpdateOptions("appABIs",o.pkgOptions.appABIs),o.emitChange()},async changeInstantValue(e){let t=this;if(t.pkgOptions.androidInstant=e,e){const e=await options_1.verificationFunc("remoteUrl",t.pkgOptions.remoteUrl,t.options);t.pkgErrorMap.remoteUrl=e.error}else t.pkgErrorMap.remoteUrl=null;t.emitChange()},async init(){const e=this;e.pkgOptions=lodash.get(panel.options,"packages.android")||{};const t=lodash.get(panel.errorMap,"packages.android")||{};e.apiLevels=await getAndroidAPILevels(),e.apiLevels.length||(t.apiLevels="i18n.android.tips.apilevel_empty");for(const o of Object.keys(e.pkgOptions)){const r=await options_1.verificationFunc(o,e.pkgOptions[o],e.options);t[o]=r.error}e.pkgErrorMap=t,e.emitChange()}};function ready(e,t,o,r){panel=this;const s=require("vue/dist/vue.js");panel.options=e,panel.pkgName=o,panel.errorMap=r,panel.vm=new s({el:panel.$.root,methods:methods,data:()=>({pkgName:o,options:panel.options,errorMap:panel.errorMap,pkgOptions:{},pkgErrorMap:{},apiLevels:[],appABIList:["armeabi-v7a","arm64-v8a","x86","x86_64"]}),mounted(){this.init()},components:{"build-prop":BuildPanel.vueComps.buildProp,"template-comp":BuildPanel.vueComps.templateComp}})}exports.$={root:".android"},exports.ready=ready;const MIN_COMPILE_LEVEL=26;async function getAndroidAPILevels(){const e=await Editor.Profile.getConfig("program","android_sdk"),t=path_1.join(e,"platforms");return e&&fs_1.existsSync(e)&&fs_1.existsSync(t)?fs_1.readdirSync(t).filter(e=>{const o=getAPILevel(e),r=fs_1.statSync(path_1.join(t,e));return!!/^android-/.test(e)&&!!(o>=MIN_COMPILE_LEVEL&&r.isDirectory())}):[]}function getAPILevel(e){const t=(e=e||"").match("android-([0-9]+)$");let o=-1;return t&&(o=parseInt(t[1])),o}exports.getAPILevel=getAPILevel,exports.buttonConfig={configs:{make:{label:"i18n:android.make.label",hookHandle:"make"},run:{label:"i18n:android.run.label",hookHandle:"run"}}};