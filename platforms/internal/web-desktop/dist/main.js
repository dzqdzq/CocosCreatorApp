"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(s,a){function i(e){try{p(o.next(e))}catch(e){a(e)}}function n(e){try{p(o.throw(e))}catch(e){a(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,n)}p((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=exports.methods=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),electron_1=require("electron"),server_1=require("./server"),lodash=require("lodash");function load(){return __awaiter(this,void 0,void 0,function*(){const e=(yield Editor.Profile.getConfig("builder","BuildTaskManager.taskMap"))||{};Object.values(e).forEach(e=>{if(1!==e.progress)return;const t=lodash.get(e,"options.platform"),r=lodash.get(e,"options.buildPath");if("web-desktop"!==t||"string"!=typeof r)return;const o=path_1.join(Editor.UI.File.resolveToRaw(r),e.options.outputName);server_1.setRootPath(o)})})}exports.methods={"create-build-template"(){return __awaiter(this,void 0,void 0,function*(){const e=path_1.join(__dirname,"../static/build-template/index.ejs").replace("app.asar","app.asar.unpacked"),t=path_1.join(Editor.Project.path,"build-templates","web-desktop",path_1.basename(e));if(fs_extra_1.existsSync(t)){if(1===(yield Editor.Dialog.warn("Do you want to overwrite the source file?",{buttons:["Yes","Cancel"],default:0,cancel:1})).response)return!1}fs_extra_1.copySync(e,t),console.log(`web-desktop ${Editor.I18n.t("web-desktop.tips.creat_template_success")}({link(${t})})`)})},preview(e){return __awaiter(this,void 0,void 0,function*(){server_1.setRootPath(e);const t=yield Editor.Message.request("server","query-port"),r=`http://${yield Editor.Message.request("preview","get-preview-ip")}:${t}/web-desktop/${path_1.basename(e)}/index.html`;return electron_1.shell.openExternal(r),!0})},"set-preview-path":e=>!!fs_extra_1.existsSync(e)&&(server_1.setRootPath(e),!0)},exports.load=load;