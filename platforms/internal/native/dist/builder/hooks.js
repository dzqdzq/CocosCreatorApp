"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onBeforeCompressSettings=exports.run=exports.make=exports.onAfterBuild=exports.onAfterInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),hooks_1=require("./gfx/hooks");async function onAfterInit(e,t){let r=e.packages.native.remoteServerAddress||"";return r&&!r.endsWith("/")&&(r+="/"),Object.assign(e.appTemplateData,{server:r}),e.packages.native.makeAfterBuild&&(e.nextTasks=["make"]),await hooks_1.onBeforeBuild(e,t)}async function onAfterBuild(e,t){if(!e.debug&&e.packages.native.encrypted){if(!e.packages.native.xxteaKey)return Promise.reject(Error(Editor.I18n.t("native.encrypt.xxtea_key_empty")));await hooks_1.encryptJsForNative(e,t)}if((e.packages.native.remoteServerAddress||"")&&fs_extra_1.existsSync(t.paths.remote)){const e=path_1.resolve(t.paths.dir,"../remote");fs_extra_1.moveSync(t.paths.remote,e),t.paths.remote=e}await hooks_1.onAfterBuild(e,t),await hooks_1.generateNativeProject(e,t),e.packages.native.encrypted&&hooks_1.replaceTeaKeyForGame(e,t)}async function make(e,t){return await hooks_1.make(e,t)}async function run(e,t){return await hooks_1.run(e,t)}async function onBeforeCompressSettings(e,t){if(await hooks_1.copyNativeTemplates(e,t),!e.debug)return e.packages.native.xxteaKey?e.packages.native.encrypted?await hooks_1.setEncryptConfig(e,t):void 0:Promise.reject(Error(Editor.I18n.t("native.encrypt.xxtea_key_empty")))}exports.throwError=!0,exports.onAfterInit=onAfterInit,exports.onAfterBuild=onAfterBuild,exports.make=make,exports.run=run,exports.onBeforeCompressSettings=onBeforeCompressSettings;