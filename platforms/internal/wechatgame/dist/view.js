"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,r)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.data=exports.template=exports.style=exports.buttonConfig=void 0;const child_process_1=require("child_process"),fs_extra_1=require("fs-extra"),path_1=require("path"),PKG_NAME="wechatgame";let panel;exports.buttonConfig={configs:{run:{label:"i18n:wechatgame.run.label",click(e,t){return __awaiter(this,void 0,void 0,function*(){t.buildPath=Editor.UI.File.resolveToRaw(t.buildPath);const e=path_1.join(t.buildPath,t.outputName);let n=yield Editor.Profile.getConfig("program","wechat_devtools");if(!n||!fs_extra_1.existsSync(n)){return console.warn(`${Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty",{wechatgamePath:n})}`),1===(yield Editor.Dialog.warn(Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty"),{buttons:["Cancel","Set Wechat DevTools"]})).response&&Editor.Message.send("preferences","open-settings","program"),!1}fs_extra_1.statSync(n).isDirectory()||"win32"!==process.platform||(n=path_1.dirname(n));const o={stdio:"pipe"};let i;if("darwin"===process.platform?(i=path_1.join(n,"Contents/Resources/app.nw/bin/cli"),fs_extra_1.existsSync(i)||(i=path_1.join(n,"Contents/MacOS/cli"))):(i=path_1.join(n,"cli.bat"),o.shell=!0),!fs_extra_1.existsSync(i))return yield Editor.Dialog.error(Editor.I18n.t("builder.wechat_game.client_path_error")),!1;const s=["-o",e,"-f","cocos"];console.log(`Run command : ${s.join(" ")}`);const a=child_process_1.spawn(i,s);return a&&a.stdout&&a.stdout.on("data",function(e){console.log(e.toString())}),a&&a.stderr&&a.stderr.on("data",function(e){console.error(e.toString())}),!0})}}}},exports.style="\n.warning-tip {\n    color: var(--color-warn-fill);\n    font-sizeï¼š 11px;\n    line-height: 16px;\n    margin-bottom: 2px;\n}\n\n.jump {\n    cursor: pointer;\n    text-decoration: underline;\n}\n\n.jump:hover {\n    color: var(--color-focus-fill-weakest)\n}\n",exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8");const component={data:()=>({pkgOptions:{},includeModules:[]}),computed:{physics3D(){return!!this.includeModules.filter(e=>e.startsWith("physics-")&&!e.startsWith("physics-2d")).length}},methods:{t:e=>Editor.I18n.t("wechatgame.options."+e),init(){return __awaiter(this,void 0,void 0,function*(){this.pkgOptions=panel.options.packages.wechatgame,yield this.updateEngineModules()})},onConfirm(e){const t=e.target.value;this.pkgOptions.wasm=t,panel.dispatch("update","packages.wechatgame.wasm",t,null)},openProjectSettings(){Editor.Message.send("project","open-settings","engine","modules")},updateEngineModules(){return __awaiter(this,void 0,void 0,function*(){this.includeModules=yield Editor.Profile.getProject("engine","modules.includeModules")})}},mounted(){this.init(),Editor.Message.addBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)},beforeDestroy(){Editor.Message.removeBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)}};function ready(e){panel=this;const t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".wechatgame"},exports.ready=ready;