"use strict";var __awaiter=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(r,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=void 0;const child_process_1=require("child_process"),fs_extra_1=require("fs-extra"),path_1=require("path");exports.buttonConfig={configs:{run:{label:"i18n:wechatgame.run.label",click(t,e){return __awaiter(this,void 0,void 0,function*(){e.buildPath=Editor.UI.File.resolveToRaw(e.buildPath);const t=path_1.join(e.buildPath,e.outputName);let o=yield Editor.Profile.getConfig("program","wechat_devtools");if(!o||!fs_extra_1.existsSync(o)){return console.warn(`${Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty",{wechatgamePath:o})}`),1===(yield Editor.Dialog.warn(Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty"),{buttons:["Cancel","Set Wechat DevTools"]})).response&&Editor.Message.send("preferences","open-settings","program"),!1}fs_extra_1.statSync(o).isDirectory()||"win32"!==process.platform||(o=path_1.dirname(o));const n={stdio:"pipe"};let r;if("darwin"===process.platform?(r=path_1.join(o,"Contents/Resources/app.nw/bin/cli"),fs_extra_1.existsSync(r)||(r=path_1.join(o,"Contents/MacOS/cli"))):(r=path_1.join(o,"cli.bat"),n.shell=!0),!fs_extra_1.existsSync(r))return yield Editor.Dialog.error(Editor.I18n.t("builder.wechat_game.client_path_error")),!1;const i=["-o",t,"-f","cocos"];console.log(`Run command : ${i.join(" ")}`);const a=child_process_1.spawn(r,i);return a&&a.stdout&&a.stdout.on("data",function(t){console.log(t.toString())}),a&&a.stderr&&a.stderr.on("data",function(t){console.error(t.toString())}),!0})}}}};