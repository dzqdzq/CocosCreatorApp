"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttons=void 0;const fs_extra_1=require("fs-extra"),util_1=require("util"),path_1=require("path"),child_process_1=require("child_process");function run(t){return __awaiter(this,void 0,void 0,function*(){let e=yield Editor.Profile.getConfig("program","bytedance_app_path");if(!e||!fs_extra_1.existsSync(e))return console.warn(`${util_1.format(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty"),e)}`),yield Editor.Dialog.warn(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty")),!1;fs_extra_1.statSync(e).isDirectory()||"win32"!==process.platform||(e=path_1.dirname(e));const n={stdio:"pipe"};let i;if("darwin"===process.platform?i=path_1.join(e,"Contents/Resources/app.asar.unpacked/bytecli"):(i=path_1.join(e,"resources/app.asar.unpacked/bytecli.bat"),n.shell=!0),!fs_extra_1.existsSync(i))return yield Editor.Dialog.error(Editor.I18n.t("bytedance-mini-game.tips.client_path_error")),!1;let r=path_1.isAbsolute(t.buildPath)?t.buildPath:path_1.join(Editor.Project.path,t.buildPath);const o=["-o",r=path_1.join(r,t.outputName)];console.log(`Run command : ${o.join(" ")}`);const a=child_process_1.spawn(i,o,{env:{bytedanceide:e,byte_dance_ide:e}});return a&&a.stdout&&a.stdout.on("data",function(t){console.log(t.toString())}),a&&a.stderr&&a.stderr.on("data",function(t){console.error(t.toString())}),!1})}exports.buttons=[{name:"run",displayName:"i18n:builder.run",click:t=>__awaiter(void 0,void 0,void 0,function*(){return yield run(t)})}];