"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{p(i.next(e))}catch(e){s(e)}}function a(e){try{p(i.throw(e))}catch(e){s(e)}}function p(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}p((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.data=exports.style=exports.template=void 0;const fs_extra_1=require("fs-extra"),util_1=require("util"),path_1=require("path"),child_process_1=require("child_process"),PKG_NAME="bytedance-mini-game";let panel;function run(e){return __awaiter(this,void 0,void 0,function*(){let t=yield Editor.Profile.getConfig("program","bytedance_app_path");if(!t||!fs_extra_1.existsSync(t))return console.warn(`${util_1.format(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty"),t)}`),yield Editor.Dialog.warn(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty")),!1;fs_extra_1.statSync(t).isDirectory()||"win32"!==process.platform||(t=path_1.dirname(t));const n={stdio:"pipe"};let i;if("darwin"===process.platform?i=path_1.join(t,"Contents/Resources/app.asar.unpacked/bytecli"):(i=path_1.join(t,"resources/app.asar.unpacked/bytecli.bat"),n.shell=!0),!fs_extra_1.existsSync(i))return yield Editor.Dialog.error(Editor.I18n.t("bytedance-mini-game.tips.client_path_error")),!1;e.buildPath=Editor.UI.File.resolveToRaw(e.buildPath);const o=["-o",path_1.join(e.buildPath,e.outputName)];console.log(`Run command : ${o.join(" ")}`);const s=child_process_1.spawn(i,o,{env:{bytedanceide:t,byte_dance_ide:t}});return s&&s.stdout&&s.stdout.on("data",function(e){console.log(e.toString())}),s&&s.stderr&&s.stderr.on("data",function(e){console.error(e.toString())}),!1})}exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8"),exports.style="\n.warning-tip {\n    color: var(--color-warn-fill);\n    font-sizeï¼š 11px;\n    line-height: 16px;\n    margin-bottom: 2px;\n}\n\n.jump {\n    cursor: pointer;\n    text-decoration: underline;\n}\n\n.jump:hover {\n    color: var(--color-focus-fill-weakest)\n}\n";const component={data:()=>({includeModules:[],pkgOptions:null}),computed:{physicsX(){return this.physics3D&&(this.pkgOptions&&"physX"===this.pkgOptions.physX.use||this.includeModules.includes("physics-physx"))},physics3D(){return!!this.includeModules.filter(e=>e.startsWith("physics-")&&!e.startsWith("physics-2d")).length},selectStyle(){return this.physics3D?{display:"flex"}:{display:"flex",color:"var(--color-warn-fill)"}}},methods:{t:e=>Editor.I18n.t("bytedance-mini-game.options."+e),updateEngineModules(){return __awaiter(this,void 0,void 0,function*(){console.debug("engine-modules-config-changed"),this.includeModules=yield Editor.Profile.getProject("engine","modules.includeModules")})},init(){return __awaiter(this,void 0,void 0,function*(){this.pkgOptions=panel.options.packages["bytedance-mini-game"],yield this.updateEngineModules()})},onConfirm(e){const t=e.target.value,n=e.target.getAttribute("path");this.pkgOptions.physX[n]=t,panel.dispatch("update",`packages.${PKG_NAME}.physX.${n}`,t,null)},openProjectSettings(){Editor.Message.send("project","open-settings","engine","modules")}},mounted(){this.init(),Editor.Message.addBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)},beforeDestroy(){Editor.Message.removeBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)}};function ready(e){panel=this;const t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".bytedance-mini-game"},exports.ready=ready;