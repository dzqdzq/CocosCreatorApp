"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function s(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=exports.ready=exports.update=exports.$=exports.data=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),qrcode=require("qrcode");function getPreviewUrl(e){return __awaiter(this,void 0,void 0,function*(){const t=yield Editor.Message.request("server","query-port");return`http://${yield Editor.Message.request("preview","get-preview-ip")}:${t}/web-mobile/${e}/index.html`})}let panel;exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/view.html"),"utf8");const component={data:()=>({preview_url:""}),methods:{t(e,t=""){const i=`web-mobile.${t}${e}`;return Editor.I18n.t(i)},preview(){return __awaiter(this,void 0,void 0,function*(){const e=panel.options;let t=Editor.UI.File.resolveToRaw(e.buildPath);return t=path_1.join(t,e.outputName),yield Editor.Message.request("web-mobile","preview",t)})},init(){return __awaiter(this,void 0,void 0,function*(){this.preview_url=yield getPreviewUrl(panel.options.outputName),qrcode.toCanvas(this.$refs.canvas,this.preview_url,{errorCorrectionLevel:"H",maskPattern:2,margin:1})})}},mounted(){this.init()}};function update(e,t){panel=this,e.buildPath===panel.options.buildPath&&e.outputName===panel.options.outputName||(panel.options=e,panel.vm.init())}function ready(e){panel=this;const t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".web-mobile"},exports.update=update,exports.ready=ready,exports.buttonConfig={configs:{run:{label:"i18n:web-mobile.run.label",click(e,t){return __awaiter(this,void 0,void 0,function*(){t.buildPath=Editor.UI.File.resolveToRaw(t.buildPath);const e=path_1.join(t.buildPath,t.outputName);yield Editor.Message.request("web-mobile","preview",e)})}}}};