"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(a,n){function s(t){try{p(o.next(t))}catch(t){n(t)}}function i(t){try{p(o.throw(t))}catch(t){n(t)}}function p(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,i)}p((o=o.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=exports.removeServerRoot=exports.setRootPath=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");let rootMap={};function setRootPath(t){rootMap[path_1.basename(t)]=t}function removeServerRoot(t){delete rootMap[path_1.basename(t)]}function handle(t,e,r){return __awaiter(this,void 0,void 0,function*(){const o=path_1.join(Editor.Project.path,"build-templates","web-mobile"),a=t.params[1],n=rootMap[t.params[0]];if(!n)return r(new Error(`${t.params[0]} 未启动服务`));let s=path_1.join(o,a);if(fs_extra_1.existsSync(s)){fs_extra_1.statSync(s).isDirectory()&&(s=path_1.join(s,"index.html"),fs_extra_1.existsSync(s)&&e.sendFile(s))}if(s=path_1.join(n,a),!fs_extra_1.existsSync(s))return r(new Error(`${t.params[0]} 资源不存在`));if(fs_extra_1.statSync(s).isDirectory()&&(s=path_1.join(s,"index.html"),!fs_extra_1.existsSync(s)))return r(new Error(`${t.params[0]} 资源不存在`));e.sendFile(s)})}exports.setRootPath=setRootPath,exports.removeServerRoot=removeServerRoot,exports.get=[{url:"/web-mobile/*/*",handle:handle}];