"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.watch=exports.methods=exports.computed=exports.data=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),lodash=require("lodash");exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../static/builder/view.html"),"utf8");const EMPTY_PLUGIN={id:"0",name:Editor.I18n.t("huawei-agc.empty_plugin_name"),plugins:[]},HUAWEI_CONFIG_BASE_NAME="agconnect-services.json",PLUGIN_ENUM={android:"1",ios:"2",agc:"3"};function data(){return{selected:null,config:[],serviceConfigPath:"",serviceConfigPathError:{error:""}}}async function mounted(){this.init()}exports.data=data,exports.computed={currentSelect(){let t=this;if(t.selected)for(let e in t.config)if(t.config[e].id===t.selected)return t.config[e];return null}},exports.methods={t:t=>Editor.I18n.t(`huawei-agc.${t}`),async updateAGConnectConfigPath(t){const e=this;let i=path_1.join(Editor.Project.path,"settings","agconnect-services.json");fs_extra_1.existsSync(t)?(t!==i&&fs_extra_1.copySync(t,i),e.serviceConfigPath=i,e.serviceConfigPathError.error=""):(console.error(e.t("service_config_not_exists")),e.serviceConfigPathError.error=e.t("service_config_not_exists"))},async updateOptions(t){this.selected=t,await Editor.Profile.setConfig(this.pkgName,`options.${this.pkgName}.sdkhub`,t,"local")},emitChange(t,e){this.$emit("update",this.pkgName,t,e),lodash.set(this.options,`packages.${this.pkgName}.${t}`,e),Editor.Profile.setConfig(this.pkgName,`options.${this.pkgName}.${t}`,e,"local")},async init(){const t=this;await t.loadConfig();let e=path_1.join(Editor.Project.path,"settings","agconnect-services.json");fs_extra_1.existsSync(e)?(t.serviceConfigPath=e,t.serviceConfigPathError.error=""):t.serviceConfigPathError.error=t.t("service_config_not_exists"),Editor.Message.addBroadcastListener("huawei-agc:update-sdkhub-config",t.loadConfig)},parseConfig(t){return this.paramValid(t)?this.t("plugin_config"):this.t("plugin_not_config")},paramValid:t=>t.hasParam,async loadConfig(){let t=await Editor.Profile.getProject("cocos-sdkhub","configSet")||[];t=t.filter(t=>t.platform===PLUGIN_ENUM.agc);for(let e in t)await this.queryDisplayName(t[e]);t.unshift(EMPTY_PLUGIN),this.config=t,this.selected=await this.checkConfigExists()?await Editor.Profile.getConfig(this.pkgName,`options.${this.pkgName}.sdkhub`):this.config.length>0?this.config[0].id:null},async queryDisplayName(t){try{let e=await Editor.Message.request("cocos-services","plugin-messages","sdkhub:plugins-type",t.id);if(!e)return;for(let i in e){let s=e[i],o=t.plugins.find(t=>t.pId===i);o&&(o.pName+=s)}}catch(t){}},async checkConfigExists(){let t=await Editor.Profile.getConfig(this.pkgName,`options.${this.pkgName}.sdkhub`);return!!this.config.find(e=>e.id===t)}},exports.watch={selected(t){this.emitChange("sdkhub",t)}},exports.mounted=mounted;