"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=exports.ready=exports.$=exports.template=void 0;const fs_1=require("fs"),fs_extra_1=require("fs-extra"),path_1=require("path"),util_1=require("./util");let panel;const lodash=require("lodash"),EMPTY_PLUGIN={id:"0",name:Editor.I18n.t("huawei-agc.empty_plugin_name"),plugins:[]},PLUGIN_ENUM={android:"1",ios:"2",agc:"3"};function data(){return{selected:null,config:[],serviceConfigPath:"",pkgOptions:{},pkgErrorMap:{}}}const computed={currentSelect(){const e=this;if(e.selected)for(const t in e.config)if(e.config[t].id===e.selected)return e.config[t];return null}},methods={t:e=>Editor.I18n.t(`huawei-agc.${e}`),async updateAGConnectConfigPath(e){const t=this,a=e.target.value;a&&fs_1.existsSync(a)&&".json"===path_1.extname(a)?(a!==util_1.HUAWEI_CONFIG_PATH&&fs_extra_1.copySync(a,util_1.HUAWEI_CONFIG_PATH),t.pkgOptions.serviceConfigPath=util_1.HUAWEI_CONFIG_PATH,delete t.pkgErrorMap.serviceConfigPath,e.target.value=util_1.HUAWEI_CONFIG_PATH,t.checkPackageName(),t.emitChange()):t.pkgErrorMap.serviceConfigPath="i18n:huawei-agc.service_config_empty"},emitChange(){panel.dispatch("update",`packages.${panel.pkgName}`,this.pkgOptions,this.pkgErrorMap)},async updateOptions(e){this.selected=e,this.emitChange()},updateData(e,t){lodash.set(this.pkgOptions,e,t),this.emitChange()},init(){const e=this,t=lodash.get(panel.options,`packages.${panel.options.platform}`)||{},a=lodash.get(panel.errorMap,`packages.${panel.options.platform}`)||{};t.serviceConfigPath=util_1.HUAWEI_CONFIG_PATH,a.serviceConfigPath="",BuildPanel.validator.check("required",util_1.HUAWEI_CONFIG_PATH)&&BuildPanel.validator.check("pathExist",util_1.HUAWEI_CONFIG_PATH)?e.checkPackageName():(t.serviceConfigPath="",a.serviceConfigPath="i18n:huawei-agc.service_config_empty"),e.pkgOptions=t,e.pkgErrorMap=a,e.emitChange()},checkPackageName(){const e=this,t=util_1.getNameFromConfig();t&&t!==panel.options.packages.android.packageName&&panel.dispatch("update","packages.android.packageName",t,e.pkgErrorMap)},parseConfig(e){return this.paramValid(e)?this.t("plugin_config"):this.t("plugin_not_config")},paramValid:e=>e.hasParam,async loadConfig(){let e=await Editor.Profile.getProject("cocos-sdkhub","configSet")||[];e=e.filter(e=>e.platform===PLUGIN_ENUM.agc);for(const t in e)await this.queryDisplayName(e[t]);e.unshift(EMPTY_PLUGIN),this.config=e,this.selected=await this.checkConfigExists()?await Editor.Profile.getConfig(panel.pkgName,`options.${panel.pkgName}.sdkhub`):this.config.length>0?this.config[0].id:null},async queryDisplayName(e){try{const t=await Editor.Message.request("cocos-services","plugin-messages","sdkhub:plugins-type",e.id);if(!t)return;for(const a in t){const i=t[a],n=e.plugins.find(e=>e.pId===a);n&&(n.pName+=i)}}catch(e){}},async checkConfigExists(){const e=await Editor.Profile.getConfig(panel.pkgName,`options.${panel.pkgName}.sdkhub`);return!!this.config.find(t=>t.id===e)}},watch={selected(e){this.updateData("sdkhub",e)}};function mounted(){this.init()}function ready(e,t,a,i){panel=this;const n=require("vue/dist/vue.js");panel.options=e,panel.pkgName=a,panel.vm=new n({el:panel.$.root,methods:methods,watch:watch,data:data,mounted:mounted,computed:computed,components:{"build-prop":BuildPanel.vueComps.buildProp,"template-comp":BuildPanel.vueComps.templateComp}})}exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../static/builder/view.html"),"utf8"),exports.$={root:".huawei-agc"},exports.ready=ready,exports.buttonConfig={configs:{make:{label:"i18n:huawei-agc.make.label",hookHandle:"make"},run:{label:"i18n:huawei-agc.run.label",hookHandle:"run"},upload:{label:"i18n:huawei-agc.upload.label",click(e,t){Editor.Panel.open("channel-upload-tools","huawei-agc")}}}};