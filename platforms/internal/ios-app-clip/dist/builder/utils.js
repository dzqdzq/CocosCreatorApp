"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.findXcodeProjects=exports.getBrowserslistQuery=exports.createBundle=exports.outputJSBAdapter=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),Editor=__importStar(require("editor")),babelify=require("babelify"),browserify=require("browserify");async function outputJSBAdapter(e,t){const{targets:r}=t||{},i=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/builtin/index.js"),n=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/engine/index.js");await createBundle(i,path_1.join(e,"jsb-adapter","jsb-builtin.js"),{targets:r}),await createBundle(n,path_1.join(e,"jsb-adapter","jsb-engine.js"),{targets:r})}async function createBundle(e,t,r){let i,n;Array.isArray(r)?i=r:r&&(i=r.excludes,n=r.targets);let s=browserify(e);return i&&i.forEach(function(e){s.exclude(e)}),await fs_extra_1.ensureDir(path_1.dirname(t)),new Promise((e,r)=>{s.transform(babelify,{presets:[[require("@babel/preset-env"),{targets:n}]]}).bundle((i,n)=>{if(i)return console.error(i),void r(i);fs_extra_1.writeFileSync(t,n,"utf8"),e()})})}async function getBrowserslistQuery(e){const t=path_1.join(e,".browserslistrc");let r;try{r=await fs_extra_1.readFile(t,"utf8")}catch(e){return}const i=function(e){const t=[];for(const r of e.split("\n")){let e=r.indexOf("#");const i=(e<0?r:r.substr(0,e)).trim();0!==i.length&&t.push(i)}return t}(r);if(0!==i.length)return i.join(" or ")}function findXcodeProjects(e){return fs_extra_1.readdirSync(e).filter(e=>e.endsWith(".xcodeproj"))}exports.outputJSBAdapter=outputJSBAdapter,exports.createBundle=createBundle,exports.getBrowserslistQuery=getBrowserslistQuery,exports.findXcodeProjects=findXcodeProjects;