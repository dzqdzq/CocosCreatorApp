"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(a,e,t);return __setModuleDefault(a,e),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.renameXcodeResource=exports.updateXcodeproject=exports.modifyPackageName=exports.checkPackageNameValidity=exports.changePackageName=exports.updateOrientation=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),plist=require("plist"),Editor=__importStar(require("editor"));async function updateOrientation(e,a){if(!a)return;let t=path_1.join(e,"frameworks/runtime-src/proj.ios_mac/ios/Info.plist");if(fs_extra_1.existsSync(t)){let e=await fs_extra_1.readFile(t,"utf8"),r=plist.parse(e),i=[];a.landscapeRight&&i.push("UIInterfaceOrientationLandscapeRight"),a.landscapeLeft&&i.push("UIInterfaceOrientationLandscapeLeft"),a.portrait&&i.push("UIInterfaceOrientationPortrait"),a.upsideDown&&i.push("UIInterfaceOrientationPortraitUpsideDown"),r.UISupportedInterfaceOrientations=i,e=plist.build(r),await fs_extra_1.writeFile(t,e)}}async function changePackageName(e,a){let t=path_1.join(e,".cocos-project.json");if(!fs_extra_1.existsSync(t))return void console.error(`Can't find project json [${t}]`);let r=await fs_extra_1.readJSON(t);checkPackageNameValidity(a=a||r.packageName)||(console.warn("The package name is illegal(iOS). It can only contain these characters: [0-9], [a-z], [A-Z], [_]."),a=modifyPackageName(a));let i=r.packageName;r.mac&&r.mac.packageName&&(i=r.mac.packageName);let o=i!==a;if(!o)return;let n=path_1.join(e,"cocos-project-template.json");if(!fs_extra_1.existsSync(n))return void console.error(`Can't find template json [${n}]`);let c,s=(await fs_extra_1.readJSON(n)).do_add_native_support;if(o){c=s.project_replace_ios_bundleid.files;for(let t of c){let r=path_1.join(e,t);if(!fs_extra_1.existsSync(r)){console.error(`Can't not find file [${t}], replace package name failed`);continue}let o=await fs_extra_1.readFile(r,"utf8");o=o.replace(new RegExp(i,"gm"),a),await fs_extra_1.writeFile(r,o)}}r.ios||(r.ios={}),r.ios.packageName=a,await fs_extra_1.writeFile(t,JSON.stringify(r,null,2))}function checkPackageNameValidity(e){return!0}function modifyPackageName(e){return e}async function updateXcodeproject(e,a){const t=path_1.join(Editor.App.path,"../resources/3d/engine-native"),r=a.packages.native.template,i=path_1.join(e,"frameworks/runtime-src/proj.ios_mac",`${a.name}.xcodeproj`);if("link"===r&&fs_extra_1.existsSync(i)){const e=path_1.join(i,"project.pbxproj");let a=(await fs_extra_1.readFile(e)).toString();a=a.replace(/\/Applications\/CocosCreator.app\/Contents\/Resources\/cocos2d-x/g,path_1.normalize(t)),await fs_extra_1.writeFile(e,a)}const o=path_1.join(i,"xcshareddata/xcschemes/HelloJavascript-clip.xcscheme");if(fs_extra_1.existsSync(o)){let e=(await fs_extra_1.readFile(o)).toString();e=e.replace(/HelloJavascript/g,a.name),await fs_extra_1.writeFile(o,e)}}async function renameXcodeResource(e,a){const t=[path_1.join(e,"frameworks/runtime-src/proj.ios_mac",`${a.name}.xcodeproj/xcshareddata/xcschemes/HelloJavascript-clip.xcscheme`),path_1.join(e,"frameworks/runtime-src/proj.ios_mac",`${a.name}.xcodeproj/xcshareddata/xcschemes/${a.name}-clip.xcscheme`),path_1.join(e,"frameworks/runtime-src/proj.ios_mac","ios/HelloJavascript-mobileRelease.entitlements"),path_1.join(e,"frameworks/runtime-src/proj.ios_mac",`ios/${a.name}-mobileRelease.entitlements`),path_1.join(e,"frameworks/runtime-src/proj.ios_mac","ios_appclip/HelloJavascript.entitlements"),path_1.join(e,"frameworks/runtime-src/proj.ios_mac",`ios_appclip/${a.name}.entitlements`)];for(let e=0;e<t.length;e+=2)fs_extra_1.existsSync(t[e])?await fs_extra_1.rename(t[e],t[e+1]):console.log(`notice: file ${t[e]} not found!`)}exports.updateOrientation=updateOrientation,exports.changePackageName=changePackageName,exports.checkPackageNameValidity=checkPackageNameValidity,exports.modifyPackageName=modifyPackageName,exports.updateXcodeproject=updateXcodeproject,exports.renameXcodeResource=renameXcodeResource;