"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=exports.component=void 0;const fs_1=require("fs"),path_1=require("path"),verification_1=require("./utils/verification"),lodash=require("lodash"),template=fs_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8");function data(){return{pkgOptions:{},verifyRes:{}}}const methods={onNewCertificate(){Editor.Panel.open("builder.certificate")},t(t,i=""){const e=`xiaomi-quick-game.${i}${t}`;return Editor.I18n.t(e)},async onConfirm(t){const i=t.target.getAttribute("path"),e=t.target.value;if(t.stopPropagation(),await this.onUpdateOptions(i,e),"useDebugKey"!==i)return;const o=verification_1.verificationFunc("privatePemPath",this.pkgOptions.privatePemPath,this.options),a=verification_1.verificationFunc("certificatePemPath",this.pkgOptions.certificatePemPath,this.options);this.verifyRes.privatePemPath=e?null:o,this.verifyRes.certificatePemPath=e?null:a},async onUpdateOptions(t,i){if(!t)return;const e=this;e.$emit("update",e.pkgName,t,i),e.verifyRes[t]=verification_1.verificationFunc(t,e.pkgOptions[t],e.options),lodash.set(e.pkgOptions,`${t}`,i),lodash.set(e.options,`packages.${e.pkgName}.${t}`,i),Editor.Profile.setConfig("xiaomi-quick-game",`options.${e.pkgName}.${t}`,i,"local");const o=await verification_1.verificationFunc(t,i,e.options);o&&e.$set(e.verifyRes,t,o)},async init(){const t=this;let i={};t.options.packages?i=t.options.packages[t.pkgName]:t.options.packages={};let e=await Editor.Profile.getConfig(t.pkgName,`options.${t.options.platform}`);e=Object.assign({},verification_1.defaultOptions,e),t.pkgOptions=Object.assign(e,i),lodash.set(t.options.packages,t.pkgName,t.pkgOptions);const o={};for(const i of Object.keys(e)){let e=t.pkgOptions[i];const a=await verification_1.verificationFunc(i,e,t.options);a&&(o[i]=a)}t.verifyRes=o}};exports.component={template:template,methods:methods,data:data,mounted(){this.init()}},exports.buttonConfig={configs:{make:{label:"i18n:xiaomi-quick-game.make.label",hookHandle:"make"},run:{label:"i18n:xiaomi-quick-game.run.label",hookHandle:"run"}}};