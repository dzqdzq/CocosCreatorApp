"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),preview_cli_1=require("./preview-cli"),fixPath=require("fix-path");let vm,panel=null;const Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const qrcode=require("qrcode");async function ready(){panel=this,fixPath(),vm=new Vue({el:panel.$.preview,data:{previewIp:"",rpkPath:"",pid:null},computed:{tips(){return this.rpkPath?this.previewIp?"打开快应用调试器的扫描安装，即可调试":"正在生成二维码，请稍等":"请重新在构建页面处点击运行"}},methods:{async updateRpkPath(e){e!==this.rpkPath&&(console.debug(`rpkPath({link(${e})}).`),preview_cli_1.previewManager.exist(),this.rpkPath=e,await this.getPreviewIp(e),await this.updateAddress())},async getPreviewIp(e){const r=this;await new Promise((r,i)=>{preview_cli_1.previewManager.run(e,(e,t)=>{t?i(t):r(e)})})&&(r.previewIp=await preview_cli_1.previewManager.getPreviewIp()),r.pid=preview_cli_1.previewManager.lastPid,console.log(`xiaomi preview IP: {link(${r.previewIp})},pid:${preview_cli_1.previewManager.lastPid}`)},async updateAddress(){qrcode.toCanvas(this.$refs.preview,this.previewIp,{errorCorrectionLevel:"H",maskPattern:2,margin:1})}}})}async function beforeClose(){preview_cli_1.previewManager.exist()}async function close(){}exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../dist/preview.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/preview.html"),"utf8"),exports.$={preview:".preview"},exports.methods={"update-rpk-path"(e){vm.updateRpkPath(e)}},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;