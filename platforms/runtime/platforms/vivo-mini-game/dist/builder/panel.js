"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,o){function p(e){try{s(a.next(e))}catch(e){o(e)}}function r(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(p,r)}s((a=a.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonConfig=exports.ready=exports.update=exports.$=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),_1=require("."),verification_1=require("../utils/verification"),lodash=require("lodash");let panel;const methods={onNewCertificate(){Editor.Panel.open("builder.certificate")},t(e,t=""){const i=`vivo-mini-game.${t}${e}`;return Editor.I18n.t(i)},onConfirm(e){return __awaiter(this,void 0,void 0,function*(){const t=this,i=e.target.value,a=e.target.getAttribute("path");lodash.set(t.pkgOptions,a,i),["useDebugKey","certificatePemPath","privatePemPath"].includes(a)&&t.updatePemPathCheckRes(),panel.dispatch("update",`packages.${t.pkgName}.${a}`,t.pkgOptions[a],t.verifyRes[a])})},updatePemPathCheckRes(){const e=this.pkgOptions.useDebugKey,t=verification_1.verificationFunc("privatePemPath",this.pkgOptions.privatePemPath,this.options),i=verification_1.verificationFunc("certificatePemPath",this.pkgOptions.certificatePemPath,this.options);this.verifyRes.privatePemPath=e?null:t.error,this.verifyRes.certificatePemPath=e?null:i.error,panel.dispatch("update",`packages.${this.pkgName}.certificatePemPath`,this.pkgOptions.certificatePemPath,this.verifyRes.certificatePemPath),panel.dispatch("update",`packages.${this.pkgName}.privatePemPath`,this.pkgOptions.privatePemPath,this.verifyRes.privatePemPath)},init(){return __awaiter(this,void 0,void 0,function*(){this.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{},this.verifyRes=lodash.get(panel.errorMap,`packages.${panel.options.platform}`)||{},this.updatePemPathCheckRes()})}};function update(e,t){return __awaiter(this,void 0,void 0,function*(){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)||(panel.options=e,panel.vm.init())})}function ready(e,t,i,a){panel=this;const n=BuildPanel.Vue;panel.options=e,panel.pkgName=i,panel.errorMap=a,panel.vm=new n({el:panel.$.root,methods:methods,data:()=>({pkgName:i,options:panel.options,errorMap:panel.errorMap,optionsConfig:_1.optionsInPanel,pkgOptions:{},verifyRes:{}}),mounted(){this.init()},components:{"build-prop":BuildPanel.vueComps.buildProp,"template-comp":BuildPanel.vueComps.templateComp}})}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/view.html"),"utf8"),exports.$={root:".vivo-mini-game"},exports.update=update,exports.ready=ready,exports.buttonConfig={configs:{make:{label:"i18n:vivo-mini-game.make.label",hookHandle:"make"},run:{label:"i18n:vivo-mini-game.run.label",hookHandle:"run"},build:{label:"i18n:vivo-mini-game.build.label"}}};