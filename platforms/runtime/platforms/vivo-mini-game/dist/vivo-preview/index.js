"use strict";var __awaiter=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))(function(o,v){function p(e){try{n(r.next(e))}catch(e){v(e)}}function a(e){try{n(r.throw(e))}catch(e){v(e)}}function n(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(p,a)}n((r=r.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),vivo_preview_cli_1=require("./vivo-preview-cli"),fixPath=require("fix-path");let vm,panel=null;const Vue=require("vue/dist/vue.js");function ready(e){return __awaiter(this,void 0,void 0,function*(){panel=this,fixPath(),vm=new Vue({el:panel.$["vivo-preview"],data:{previewIp:"",rpkPath:e},computed:{tips(){return this.rpkPath?this.previewIp?Editor.I18n.t("vivo-mini-game.debug_tools.start_run_server",{rpk:this.rpkPath}):Editor.I18n.t("vivo-mini-game.debug_tools.waiting_to_run_server"):"请重新在构建页面处点击运行"}},methods:{updateRpkPath(e){return __awaiter(this,void 0,void 0,function*(){e===this.rpkPath&&this.previewIp||(console.debug("rpkPath",`{link(${e})}`),vivo_preview_cli_1.previewManager.lastPid&&vivo_preview_cli_1.previewManager.kill(vivo_preview_cli_1.previewManager.lastPid),this.rpkPath=e,yield this.getPreviewIp(e))})},getPreviewIp(e){return __awaiter(this,void 0,void 0,function*(){this.previewIp=yield new Promise((i,t)=>{vivo_preview_cli_1.previewManager.run(e,(e,r)=>{e?t(e):i(r)})}),console.log("vivo preview IP:"+`{link(${this.previewIp})}`)})}}})})}function beforeClose(){return __awaiter(this,void 0,void 0,function*(){vivo_preview_cli_1.previewManager.lastPid&&vivo_preview_cli_1.previewManager.kill(vivo_preview_cli_1.previewManager.lastPid)})}function close(){return __awaiter(this,void 0,void 0,function*(){})}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../dist/vivo-preview.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/vivo-preview.html"),"utf8"),exports.$={"vivo-preview":".vivo-preview",preview:".preview"},exports.methods={"update-rpk-path"(e){vm.updateRpkPath(e)}},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;