"use strict";var __awaiter=this&&this.__awaiter||function(e,i,t,o){return new(t||(t=Promise))(function(r,n){function a(e){try{s(o.next(e))}catch(e){n(e)}}function p(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var i;e.done?r(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(a,p)}s((o=o.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeClose=exports.mounted=exports.methods=exports.data=exports.props=exports.template=void 0;const vivo_preview_cli_1=require("./vivo-preview-cli"),fixPath=require("fix-path");function data(){return{previewIp:"",tips:"",packTools:vivo_preview_cli_1.previewManager.packToolDir,rpkPath:""}}function mounted(){return __awaiter(this,void 0,void 0,function*(){fixPath()})}function beforeClose(){return __awaiter(this,void 0,void 0,function*(){this.stop()})}exports.template='\n<div class="vivo-preview">\n    <ui-prop>\n        <ui-label slot="label" value="i18n:vivo-mini-game.debug_tools.custom_rpk_path"></ui-label>\n        <ui-file :value="rpkPath" slot="content"></ui-file>\n    </ui-prop>\n    <ui-prop>\n        <ui-label slot="label" value="i18n:vivo-mini-game.debug_tools.pack_tool_path"></ui-label>\n        <ui-file readonly :value="packTools" slot="content"></ui-file>\n    </ui-prop>\n</div>\n\n',exports.props=["args","root"],exports.data=data,exports.methods={handleCommand(e){return __awaiter(this,void 0,void 0,function*(){return!(this.previewIp||"run"!==e||!this.rpkPath)&&(console.debug("rpkPath",`{link(${this.rpkPath})}`),yield Editor.Panel.open("vivo-mini-game.preview",this.rpkPath),Editor.Message.send("vivo-mini-game","update-rpk-path",this.rpkPath),!0)})},getPreviewIp(){return __awaiter(this,void 0,void 0,function*(){const e=this;e.tips="i18n:vivo-mini-game.debug_tools.waiting_to_run_server",e.previewIp=yield new Promise((i,t)=>{vivo_preview_cli_1.previewManager.run(e.rpkPath,(e,o)=>{e?t(e):i(o)})}),e.tips=Editor.I18n.t("vivo-mini-game.debug_tools.start_run_server",{rpk:e.rpkPath}),console.debug("vivo preview IP:"+`{link(${e.previewIp})}`)})},stop(){vivo_preview_cli_1.previewManager.lastPid&&vivo_preview_cli_1.previewManager.kill(vivo_preview_cli_1.previewManager.lastPid),this.previewIp="",this.tips=""}},exports.mounted=mounted,exports.beforeClose=beforeClose;