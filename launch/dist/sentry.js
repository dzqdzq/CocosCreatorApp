"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initSentry=initSentry,exports.initUserInfo=initUserInfo;const path_1=require("path"),fs_extra_1=require("fs-extra"),sentry_1=require("@editor/sentry"),electron_1=require("electron");let isKipSentry=!1;async function initSentry(){if(!(isKipSentry=void 0!==process.argv.find(e=>"--skipSentry"===e))){var e=void 0!==process.argv.find(e=>"--dev"===e),e=await queryRemoteConfig((0,path_1.join)(electron_1.app.getPath("home"),"."+electron_1.app.getName()+(e?"_Develop":"")));if(!e||!1!==e.enable){e=require((0,path_1.join)(__dirname,"../../package.json")),e={dsn:e.dsn||"https://d1228c9c9d49468a9f6795d0f8f66df3@sentry.cocos.org/11",debug:!1,appPath:(0,path_1.join)(__dirname,"../../"),skipTags:["[PreviewInEditor]","[Scene]","[Programming]","[Assets]"],version:e.version};if(electron_1.app.isPackaged)try{var t=(0,fs_extra_1.readJSONSync)((0,path_1.join)(__dirname,"../../.HEAD"));e.releaseInfo={hash:{"editor-hash":t.editor,"engine-hash":t.engine},time:t.time}}catch(e){console.debug(e)}sentry_1.sentry.init(e)}}}async function initUserInfo(){isKipSentry||(sentry_1.sentry.setUserInfo(await Editor.User.getData()),Editor.User.on("login",async()=>{sentry_1.sentry.setUserInfo(await Editor.User.getData())}),Editor.User.on("logout",()=>{sentry_1.sentry.setUserInfo()}))}function queryRemoteConfig(e){try{var t=(0,fs_extra_1.readJSONSync)((0,path_1.join)(e,"profiles/v2/packages/utils.json"));return t&&t.features&&t.features.logger}catch(e){}}