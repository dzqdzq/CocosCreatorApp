"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Nativize=exports.initNativize=void 0;const electron_1=require("electron"),native_manager_1=require("./native-manager");Object.defineProperty(exports,"Nativize",{enumerable:!0,get:function(){return native_manager_1.Nativize}});const ipc=require("@base/electron-base-ipc");let initLimitTimes=5,mainWindow=null;const MainWindowName="MainWindow",isWin32="win32"===process.platform,scale=electron_1.screen.getPrimaryDisplay().scaleFactor;let MainWindowWidth=0,MainWindowHeight=0;const resizeHandle=null;function initMainWindowEvent(){isWin32&&(mainWindow.on("focus",()=>{native_manager_1.Nativize.redraw()}),mainWindow.on("restore",()=>{native_manager_1.Nativize.redraw()}),mainWindow.on("will-resize",(i,n)=>{var e;null===(e=native_manager_1.Nativize.parentWindow)||void 0===e||e.setSize(n.width*scale,n.height*scale),mainWindow.setBackgroundColor("#434343")}),mainWindow.on("resized",()=>{mainWindow.setBackgroundColor("#00000000"),native_manager_1.Nativize.redraw()}),mainWindow.on("move",()=>{native_manager_1.Nativize.redraw()}))}function initMainWindow(){const{width:i,height:n}=mainWindow.getBounds();native_manager_1.Nativize.init(mainWindow.getNativeWindowHandle(),i,n),MainWindowWidth=i,MainWindowHeight=n,initMainWindowEvent()}async function initSceneWindow(i){await native_manager_1.Nativize.createWindow(native_manager_1.Nativize.mainWindowRect.w,native_manager_1.Nativize.mainWindowRect.h,MainWindowName,i),native_manager_1.Nativize.resizeWindow(MainWindowName,native_manager_1.Nativize.mainWindowRect)}async function initNativize(i){(mainWindow=i.uuid2win[i.uuids[0]])?(initMainWindow(),ipc.on("native:engine-ready",async(i,n)=>{await initSceneWindow(n)}),ipc.on("editor-lib-windows:scene-resize",(i,n)=>{if(!n||!n.width)return;const e=mainWindow.getContentSize(),a=isWin32?scale:1,t={x:Math.round(n.left*a),y:Math.round((isWin32?n.top:e[1]-n.bottom)*a),w:Math.round(n.width*a),h:Math.round(n.height*a)};native_manager_1.Nativize.resizeWindow(MainWindowName,t)})):initLimitTimes>0&&setTimeout(()=>{initLimitTimes--,initNativize(i)},1e3)}exports.initNativize=initNativize;