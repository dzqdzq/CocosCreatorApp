"use strict";const{existsSync:existsSync}=require("fs"),{readJSONSync:readJSONSync,outputJSONSync:outputJSONSync}=require("fs-extra"),{join:join}=require("path"),semver=require("semver"),project=require("@editor/project"),ipc=require("@base/electron-base-ipc"),{Dialog:Dialog}=require("../../lib/dist/dialog"),{t:t,errorDialog:errorDialog,chooseProjectPath:chooseProjectPath}=require("./util"),{version:version}=require("@editor/setting");exports.openProject=async function(e){try{if(e||(e=await chooseProjectPath(t("open_project"))),!e)return!1;if(!existsSync(e)){await Dialog.warn(t("message.project_missing"),{title:t("project_missing"),buttons:[t("cancel")]});return!1}const r=join(e,"package.json"),s=readJSONSync(r);let o=!0;if(s.version){const r=semver.gt(semver.valid(semver.coerce(version)),semver.valid(semver.coerce(s.version))),i=semver.lt(semver.valid(semver.coerce(version)),semver.valid(semver.coerce(s.version)));let a="",c="";if(r&&(a=t("message.upgrade_message"),c=t("message.upgrade_detail")),i&&(a=t("message.degrade_message"),c=t("message.degrade_detail")),a){c=c.replace("$$projectVersion",s.version).replace("$$editorVersion",version).replace("$$projectPath",e),o=0===(await Dialog.warn(a,{title:t("warn"),detail:c,buttons:[t("confirm"),t("cancel")]})).response}if(!o)return!1}return s.version=version,outputJSONSync(r,s,{spaces:2}),project.open(e),!0}catch(r){return await errorDialog(t("message.check_version_error",{error:r.message}),e),console.error(r),!1}};