"use strict";const{existsSync:existsSync}=require("fs"),{readJSONSync:readJSONSync,outputJSONSync:outputJSONSync}=require("fs-extra"),{join:join}=require("path"),semver=require("semver"),project=require("@editor/project"),ipc=require("@base/electron-base-ipc"),{Dialog:Dialog}=require("../../lib/dist/dialog"),{t:t,errorDialog:errorDialog,chooseProjectPath:chooseProjectPath}=require("./util"),{version:version}=require("@editor/setting");exports.openProject=async function(e){try{if(e||(e=await chooseProjectPath(t("open_project"))),!e)return!1;if(!existsSync(e)){await Dialog.warn(t("message.project_missing"),{title:t("project_missing"),buttons:[t("cancel")]});return!1}const r=join(e,"package.json"),o=readJSONSync(r);let s=!0;if(o.version){const r=semver.gt(version,o.version),i=semver.lt(version,o.version);let a="",n="";if(r&&(a=t("message.upgrade_message"),n=t("message.upgrade_detail")),i&&(a=t("message.degrade_message"),n=t("message.degrade_detail")),a){n=n.replace("$$projectVersion",o.version).replace("$$editorVersion",version).replace("$$projectPath",e),s=0===(await Dialog.warn(a,{title:t("warn"),detail:n,buttons:[t("confirm"),t("cancel")]})).response}if(!s)return!1}return o.version=version,outputJSONSync(r,o,{spaces:2}),project.open(e),!0}catch(r){return await errorDialog(t("message.check_version_error",{error:r.message}),e),console.error(r),!1}};