const _0x709f=["login","join","setPanelBlurred","isVip","../common-lib/update-toolbar","error","init","getButtonTitle","add","logout","getPackages","./new-msg-count-timer","send","../constant/namespace","onLoggedInShouldShowState",":force-close-panel","onUserLogout","instance","show","Menu","onNotLoggedInState","setUp","__importDefault","bind","apply","addBroadcastListener","removeListener","assign","info","cleanUp","i18n:change","onLanguageChanged","length","focus","default","BrowserWindow","electron","cleanImSetting","setMenuVisibility","hide","isLoggedIn","blur",":panel-win-state-changed","menu","updateToolbar","User","onUserLogin","ipcMain","path","fromWebContents","shouldShowEntrance","dispatchLoggedInState","onHidePanel","onPanelReady","onLoggedInShouldNotShowState","getInstance","uninit","broadcast",":panel-ready","Message","restore","contributions"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x709f,221);const _0x3776=function(e,t){return _0x709f[e-=241]},_0x914b20=_0x3776;var __importDefault=this&&this[_0x914b20(290)]||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=__importDefault(require(_0x914b20(254))),electron_1=require(_0x914b20(242)),update_toolbar_1=require(_0x914b20(272)),namespace_1=require(_0x914b20(281)),new_msg_count_timer_1=__importDefault(require(_0x914b20(279))),service_1=__importDefault(require("./service")),newMsgCountTimer=new_msg_count_timer_1[_0x914b20(302)][_0x914b20(261)]();class Controller{constructor(){const e=_0x914b20;this.onUserLogin=this[e(252)][e(291)](this),this[e(284)]=this[e(284)][e(291)](this),this[e(299)]=this[e(299)][e(291)](this),this[e(259)]=this[e(259)].bind(this)}static[_0x914b20(261)](){const e=_0x914b20;return this[e(285)]||(this[e(285)]=new Controller),this[e(285)]}async[_0x914b20(274)](){const e=_0x914b20;Editor[e(251)].on(e(268),this[e(252)]),Editor[e(251)].on(e(277),this[e(284)]),Editor.Message[e(293)]("i18n:change",this.onLanguageChanged),electron_1[e(253)].on(namespace_1.ns+e(264),this.onPanelReady),await Editor[e(251)][e(246)]()?this[e(257)]():(this[e(288)](),setTimeout(()=>{this[e(244)](!1)},500))}[_0x914b20(262)](){const e=_0x914b20;Editor.User[e(294)](e(268),this.onUserLogin),Editor[e(251)][e(294)]("logout",this[e(284)]),Editor[e(265)].removeBroadcastListener(e(298),this[e(299)]),electron_1.ipcMain[e(294)](namespace_1.ns+e(264),this[e(259)])}onShowPanel(){const e=_0x914b20;newMsgCountTimer[e(297)](),update_toolbar_1[e(250)]({newMsgCount:0},!0),update_toolbar_1[e(270)](!1)}[_0x914b20(258)](){update_toolbar_1[_0x914b20(270)](!0)}onClosePanel(){update_toolbar_1.setPanelBlurred(!0)}[_0x914b20(252)](){this[_0x914b20(257)]()}onUserLogout(){this[_0x914b20(288)]()}async[_0x914b20(299)](){const e=_0x914b20;await Editor.User[e(246)]()&&this[e(257)]()}async[_0x914b20(257)](){const e=_0x914b20,t=await service_1[e(302)].getInstance();t[e(243)](),await t[e(256)]()?this[e(282)]():this[e(260)]()}[_0x914b20(288)](){const e=_0x914b20;Editor[e(265)][e(263)](namespace_1.ns+e(283)),this[e(244)](!1),update_toolbar_1[e(250)]({showToolbar:!1}),newMsgCountTimer.cleanUp()}async onLoggedInShouldShowState(){const e=_0x914b20,t=await service_1[e(302)][e(261)](),n=await t[e(271)](),o=await t[e(275)]();this[e(244)](!0),update_toolbar_1.updateToolbar({showToolbar:!0,isVip:n,buttonTitle:o}),newMsgCountTimer[e(289)]()}[_0x914b20(260)](){this[_0x914b20(288)]()}[_0x914b20(259)](e){const t=_0x914b20,n=electron_1[t(241)][t(255)](e.sender);function o(n){const o=t;e.sender[o(280)](namespace_1.ns+o(248),n)}n?(n.on("blur",o[t(291)](null,t(247))),n.on(t(301),o.bind(null,"focus")),n.on(t(286),o.bind(null,"show")),n.on(t(245),o[t(291)](null,t(245))),n.on("minimize",o[t(291)](null,"minimize")),n.on(t(266),o[t(291)](null,t(266))),n.on(t(247),()=>{update_toolbar_1[t(270)](!0)}),n.on(t(301),()=>{const e=t;update_toolbar_1[e(250)]({newMsgCount:0},!0),update_toolbar_1[e(270)](!1)})):console[t(273)]("panel window is undefined")}setMenuVisibility(e){const t=_0x914b20;var n;const o=Editor.Package[t(278)]({name:namespace_1.ns}),s=o[o[t(300)]-1],i=s.name,a=null===(n=s[t(296)][t(267)])||void 0===n?void 0:n[t(249)][0];a&&(e?Editor[t(287)][t(276)](a[t(254)],Object.assign(Object[t(295)]({},a),{icon:path_1[t(302)][t(269)](__dirname,"../../resources/images/icon.png"),click:()=>{const e=t;Editor.Message[e(280)](i,a.message)}})):Editor.Menu.remove(a.path,a),Editor[t(287)][t(292)]())}}exports[_0x914b20(302)]=Controller,Controller[_0x914b20(285)]=null;