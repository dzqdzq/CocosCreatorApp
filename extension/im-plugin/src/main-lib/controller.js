const _0x1c63=["Message","uninit","getInstance","Menu","blur","dispatchLoggedInState","logout","Package","ipcMain","shouldShowEntrance","onLoggedInShouldShowState","User","getButtonTitle","login","onLanguageChanged","onPanelReady","fromWebContents","addBroadcastListener","onClosePanel","assign","default","sender","setUp","onUserLogin","onHidePanel","./new-msg-count-timer","apply",":panel-win-state-changed","onNotLoggedInState","show","onLoggedInShouldNotShowState","../common-lib/update-toolbar","../../resources/images/icon.png","updateToolbar","join","onShowPanel","cleanImSetting","bind","focus","onUserLogout","instance",":panel-ready","isLoggedIn","cleanUp","hide","__importDefault","__esModule","name","path","error","add","minimize","./service","setMenuVisibility","contributions","broadcast","send","remove","defineProperty","info","init","setPanelBlurred","../constant/namespace","removeListener","restore"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x1c63,386);const _0xf67e=function(e,t){return _0x1c63[e-=273]},_0x4f40e5=_0xf67e;var __importDefault=this&&this[_0x4f40e5(322)]||function(e){return e&&e[_0x4f40e5(323)]?e:{default:e}};Object[_0x4f40e5(335)](exports,"__esModule",{value:!0});const path_1=__importDefault(require(_0x4f40e5(325))),electron_1=require("electron"),update_toolbar_1=require(_0x4f40e5(308)),namespace_1=require(_0x4f40e5(274)),new_msg_count_timer_1=__importDefault(require(_0x4f40e5(302))),service_1=__importDefault(require(_0x4f40e5(329))),newMsgCountTimer=new_msg_count_timer_1[_0x4f40e5(297)].getInstance();class Controller{constructor(){const e=_0x4f40e5;this[e(300)]=this.onUserLogin[e(314)](this),this.onUserLogout=this[e(316)].bind(this),this.onLanguageChanged=this.onLanguageChanged.bind(this),this[e(292)]=this[e(292)][e(314)](this)}static[_0x4f40e5(279)](){return this[_0x4f40e5(317)]||(this.instance=new Controller),this.instance}async[_0x4f40e5(337)](){const e=_0x4f40e5;Editor.User.on(e(290),this[e(300)]),Editor[e(288)].on(e(283),this[e(316)]),Editor.Message[e(294)]("i18n:change",this[e(291)]),electron_1[e(285)].on(namespace_1.ns+e(318),this[e(292)]),await Editor[e(288)][e(319)]()?this[e(282)]():(this.onNotLoggedInState(),setTimeout(()=>{this[e(330)](!1)},500))}[_0x4f40e5(278)](){const e=_0x4f40e5;Editor[e(288)][e(275)]("login",this.onUserLogin),Editor[e(288)][e(275)](e(283),this[e(316)]),Editor.Message.removeBroadcastListener("i18n:change",this[e(291)]),electron_1.ipcMain[e(275)](namespace_1.ns+e(318),this.onPanelReady)}[_0x4f40e5(312)](){const e=_0x4f40e5;newMsgCountTimer.cleanUp(),update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1[e(273)](!1)}[_0x4f40e5(301)](){update_toolbar_1[_0x4f40e5(273)](!0)}[_0x4f40e5(295)](){update_toolbar_1[_0x4f40e5(273)](!0)}[_0x4f40e5(300)](){this[_0x4f40e5(282)]()}[_0x4f40e5(316)](){this[_0x4f40e5(305)]()}async[_0x4f40e5(291)](){const e=_0x4f40e5;await Editor.User[e(319)]()&&this.dispatchLoggedInState()}async[_0x4f40e5(282)](){const e=_0x4f40e5,t=await service_1[e(297)][e(279)]();t[e(313)](),await t[e(286)]()?this[e(287)]():this[e(307)]()}onNotLoggedInState(){const e=_0x4f40e5;Editor[e(277)][e(332)](namespace_1.ns+":force-close-panel"),this[e(330)](!1),update_toolbar_1[e(310)]({showToolbar:!1}),newMsgCountTimer[e(320)]()}async[_0x4f40e5(287)](){const e=_0x4f40e5,t=await service_1.default[e(279)](),n=await t.isVip(),o=await t[e(289)]();this[e(330)](!0),update_toolbar_1[e(310)]({showToolbar:!0,isVip:n,buttonTitle:o}),newMsgCountTimer[e(299)]()}onLoggedInShouldNotShowState(){this[_0x4f40e5(305)]()}[_0x4f40e5(292)](e){const t=_0x4f40e5,n=electron_1.BrowserWindow[t(293)](e[t(298)]);function o(n){const o=t;e[o(298)][o(333)](namespace_1.ns+o(304),n)}n?(n.on(t(281),o[t(314)](null,t(281))),n.on(t(315),o[t(314)](null,"focus")),n.on(t(306),o.bind(null,t(306))),n.on(t(321),o[t(314)](null,t(321))),n.on(t(328),o[t(314)](null,"minimize")),n.on(t(276),o[t(314)](null,t(276))),n.on(t(281),()=>{update_toolbar_1.setPanelBlurred(!0)}),n.on(t(315),()=>{const e=t;update_toolbar_1[e(310)]({newMsgCount:0},!0),update_toolbar_1[e(273)](!1)})):console[t(326)]("panel window is undefined")}setMenuVisibility(e){const t=_0x4f40e5;var n;const o=Editor[t(284)].getPackages({name:namespace_1.ns}),i=o[o.length-1],s=i[t(324)],a=null===(n=i[t(336)][t(331)])||void 0===n?void 0:n.menu[0];a&&(e?Editor.Menu[t(327)](a[t(325)],Object[t(296)](Object[t(296)]({},a),{icon:path_1.default[t(311)](__dirname,t(309)),click:()=>{const e=t;Editor[e(277)][e(333)](s,a.message)}})):Editor[t(280)][t(334)](a.path,a),Editor[t(280)][t(303)]())}}exports[_0x4f40e5(297)]=Controller,Controller[_0x4f40e5(317)]=null;