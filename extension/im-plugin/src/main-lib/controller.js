const _0x5082=["onLoggedInShouldNotShowState","onLanguageChanged","onUserLogin","remove","uninit","length","Menu","__esModule","apply","defineProperty","join","onUserLogout","show","../constant/namespace","dispatchLoggedInState","isLoggedIn","onNotLoggedInState","./service","getInstance","BrowserWindow","login","send","../common-lib/update-toolbar","minimize","bind","cleanImSetting",":panel-ready","path",":panel-win-state-changed","setPanelBlurred","getPackages","restore","instance","onShowPanel","menu","default","User","setMenuVisibility","panel window is undefined","addBroadcastListener","logout","cleanUp","hide","init","name","focus","info","./new-msg-count-timer","contributions","sender","Message","ipcMain","assign","removeListener","electron","onHidePanel","removeBroadcastListener","onPanelReady","blur","onLoggedInShouldShowState","isVip","i18n:change","error"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x5082,273);const _0x284e=function(e,t){return _0x5082[e-=204]},_0x99c3f4=_0x284e;var __importDefault=this&&this.__importDefault||function(e){return e&&e[_0x284e(253)]?e:{default:e}};Object[_0x99c3f4(255)](exports,"__esModule",{value:!0});const path_1=__importDefault(require(_0x99c3f4(210))),electron_1=require(_0x99c3f4(237)),update_toolbar_1=require(_0x99c3f4(205)),namespace_1=require(_0x99c3f4(259)),new_msg_count_timer_1=__importDefault(require(_0x99c3f4(230))),service_1=__importDefault(require(_0x99c3f4(263))),newMsgCountTimer=new_msg_count_timer_1[_0x99c3f4(218)][_0x99c3f4(264)]();class Controller{constructor(){const e=_0x99c3f4;this[e(248)]=this[e(248)][e(207)](this),this[e(257)]=this.onUserLogout[e(207)](this),this[e(247)]=this.onLanguageChanged[e(207)](this),this[e(240)]=this[e(240)][e(207)](this)}static[_0x99c3f4(264)](){const e=_0x99c3f4;return this[e(215)]||(this[e(215)]=new Controller),this[e(215)]}async[_0x99c3f4(226)](){const e=_0x99c3f4;Editor.User.on(e(266),this[e(248)]),Editor[e(219)].on(e(223),this[e(257)]),Editor[e(233)][e(222)](e(244),this.onLanguageChanged),electron_1[e(234)].on(namespace_1.ns+e(209),this.onPanelReady),await Editor.User[e(261)]()?this.dispatchLoggedInState():(this[e(262)](),setTimeout(()=>{this.setMenuVisibility(!1)},500))}[_0x99c3f4(250)](){const e=_0x99c3f4;Editor.User[e(236)](e(266),this[e(248)]),Editor[e(219)][e(236)]("logout",this.onUserLogout),Editor.Message[e(239)]("i18n:change",this[e(247)]),electron_1[e(234)].removeListener(namespace_1.ns+e(209),this[e(240)])}[_0x99c3f4(216)](){const e=_0x99c3f4;newMsgCountTimer[e(224)](),update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1[e(212)](!1)}[_0x99c3f4(238)](){update_toolbar_1[_0x99c3f4(212)](!0)}onClosePanel(){update_toolbar_1[_0x99c3f4(212)](!0)}[_0x99c3f4(248)](){this[_0x99c3f4(260)]()}[_0x99c3f4(257)](){this.onNotLoggedInState()}async onLanguageChanged(){const e=_0x99c3f4;await Editor.User[e(261)]()&&this[e(260)]()}async dispatchLoggedInState(){const e=_0x99c3f4,t=await service_1.default.getInstance();t[e(208)](),await t.shouldShowEntrance()?this.onLoggedInShouldShowState():this[e(246)]()}[_0x99c3f4(262)](){const e=_0x99c3f4;Editor[e(233)].broadcast(namespace_1.ns+":force-close-panel"),this.setMenuVisibility(!1),update_toolbar_1.updateToolbar({showToolbar:!1}),newMsgCountTimer[e(224)]()}async[_0x99c3f4(242)](){const e=_0x99c3f4,t=await service_1[e(218)][e(264)](),o=await t[e(243)]();this[e(220)](!0),update_toolbar_1.updateToolbar({showToolbar:!0,isVip:o}),newMsgCountTimer.setUp()}[_0x99c3f4(246)](){this.onNotLoggedInState()}onPanelReady(e){const t=_0x99c3f4,o=electron_1[t(265)].fromWebContents(e[t(232)]);function n(o){const n=t;e[n(232)][n(204)](namespace_1.ns+n(211),o)}o?(o.on(t(241),n.bind(null,t(241))),o.on(t(228),n[t(207)](null,"focus")),o.on(t(258),n.bind(null,t(258))),o.on(t(225),n[t(207)](null,t(225))),o.on(t(206),n.bind(null,t(206))),o.on(t(214),n[t(207)](null,t(214))),o.on("blur",()=>{update_toolbar_1[t(212)](!0)}),o.on("focus",()=>{const e=t;update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1[e(212)](!1)})):console[t(245)](t(221))}[_0x99c3f4(220)](e){const t=_0x99c3f4;var o;const n=Editor.Package[t(213)]({name:namespace_1.ns}),s=n[n[t(251)]-1],a=s[t(227)],i=null===(o=s[t(229)][t(231)])||void 0===o?void 0:o[t(217)][0];i&&(e?Editor[t(252)].add(i[t(210)],Object[t(235)](Object[t(235)]({},i),{icon:path_1[t(218)][t(256)](__dirname,"../../resources/images/icon.png"),click:()=>{const e=t;Editor[e(233)][e(204)](a,i.message)}})):Editor[t(252)][t(249)](i[t(210)],i),Editor[t(252)][t(254)]())}}exports[_0x99c3f4(218)]=Controller,Controller[_0x99c3f4(215)]=null;