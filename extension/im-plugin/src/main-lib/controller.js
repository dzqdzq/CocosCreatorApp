const _0x812c=["getInstance","onHidePanel","uninit","onUserLogout",":panel-ready","contributions","updateToolbar","init","setPanelBlurred","ipcMain","focus","broadcast","getButtonTitle","onNotLoggedInState","path","isVip","shouldShowEntrance","apply","show","__esModule","onLoggedInShouldNotShowState","cleanUp","add","defineProperty","hide","remove","addBroadcastListener","fromWebContents","User","send","onClosePanel","onLanguageChanged","Message","i18n:change","default","BrowserWindow",":panel-win-state-changed","getPackages","onShowPanel","name","Menu","assign","instance","../constant/namespace","info","setMenuVisibility","isLoggedIn","minimize","onPanelReady",":force-close-panel","dispatchLoggedInState","login","blur","length","onUserLogin","removeListener","panel window is undefined","menu","removeBroadcastListener","logout","bind","sender","Package","restore","onLoggedInShouldShowState","electron","./service"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x812c,404);const _0xcfe8=function(e,t){return _0x812c[e-=300]},_0x1ab6de=_0xcfe8;var __importDefault=this&&this.__importDefault||function(e){return e&&e[_0xcfe8(317)]?e:{default:e}};Object[_0x1ab6de(321)](exports,_0x1ab6de(317),{value:!0});const path_1=__importDefault(require("path")),electron_1=require(_0x1ab6de(363)),update_toolbar_1=require("../common-lib/update-toolbar"),namespace_1=require(_0x1ab6de(341)),new_msg_count_timer_1=__importDefault(require("./new-msg-count-timer")),service_1=__importDefault(require(_0x1ab6de(364))),newMsgCountTimer=new_msg_count_timer_1[_0x1ab6de(332)].getInstance();class Controller{constructor(){const e=_0x1ab6de;this[e(352)]=this.onUserLogin[e(358)](this),this[e(301)]=this[e(301)][e(358)](this),this.onLanguageChanged=this[e(329)].bind(this),this[e(346)]=this[e(346)][e(358)](this)}static[_0x1ab6de(365)](){const e=_0x1ab6de;return this[e(340)]||(this[e(340)]=new Controller),this.instance}async[_0x1ab6de(305)](){const e=_0x1ab6de;Editor.User.on(e(349),this.onUserLogin),Editor.User.on(e(357),this[e(301)]),Editor[e(330)][e(324)](e(331),this[e(329)]),electron_1[e(307)].on(namespace_1.ns+":panel-ready",this[e(346)]),await Editor[e(326)][e(344)]()?this[e(348)]():(this.onNotLoggedInState(),setTimeout(()=>{this[e(343)](!1)},500))}[_0x1ab6de(300)](){const e=_0x1ab6de;Editor[e(326)].removeListener("login",this.onUserLogin),Editor[e(326)].removeListener(e(357),this[e(301)]),Editor[e(330)][e(356)]("i18n:change",this[e(329)]),electron_1.ipcMain[e(353)](namespace_1.ns+e(302),this[e(346)])}[_0x1ab6de(336)](){const e=_0x1ab6de;newMsgCountTimer[e(319)](),update_toolbar_1[e(304)]({newMsgCount:0},!0),update_toolbar_1[e(306)](!1)}[_0x1ab6de(366)](){update_toolbar_1[_0x1ab6de(306)](!0)}[_0x1ab6de(328)](){update_toolbar_1[_0x1ab6de(306)](!0)}[_0x1ab6de(352)](){this[_0x1ab6de(348)]()}[_0x1ab6de(301)](){this[_0x1ab6de(311)]()}async[_0x1ab6de(329)](){const e=_0x1ab6de;await Editor[e(326)].isLoggedIn()&&this.dispatchLoggedInState()}async[_0x1ab6de(348)](){const e=_0x1ab6de,t=await service_1[e(332)][e(365)]();t.cleanImSetting(),await t[e(314)]()?this[e(362)]():this[e(318)]()}onNotLoggedInState(){const e=_0x1ab6de;Editor.Message[e(309)](namespace_1.ns+e(347)),this[e(343)](!1),update_toolbar_1[e(304)]({showToolbar:!1}),newMsgCountTimer[e(319)]()}async[_0x1ab6de(362)](){const e=_0x1ab6de,t=await service_1[e(332)].getInstance(),n=await t[e(313)](),o=await t[e(310)]();this[e(343)](!0),update_toolbar_1[e(304)]({showToolbar:!0,isVip:n,buttonTitle:o}),newMsgCountTimer.setUp()}[_0x1ab6de(318)](){this.onNotLoggedInState()}onPanelReady(e){const t=_0x1ab6de,n=electron_1[t(333)][t(325)](e[t(359)]);function o(n){const o=t;e[o(359)][o(327)](namespace_1.ns+o(334),n)}n?(n.on(t(350),o.bind(null,t(350))),n.on("focus",o[t(358)](null,t(308))),n.on(t(316),o.bind(null,t(316))),n.on(t(322),o[t(358)](null,t(322))),n.on(t(345),o[t(358)](null,t(345))),n.on(t(361),o[t(358)](null,t(361))),n.on(t(350),()=>{update_toolbar_1.setPanelBlurred(!0)}),n.on(t(308),()=>{const e=t;update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1[e(306)](!1)})):console.error(t(354))}setMenuVisibility(e){const t=_0x1ab6de;var n;const o=Editor[t(360)][t(335)]({name:namespace_1.ns}),a=o[o[t(351)]-1],s=a[t(337)],i=null===(n=a[t(342)][t(303)])||void 0===n?void 0:n[t(355)][0];i&&(e?Editor[t(338)][t(320)](i[t(312)],Object[t(339)](Object[t(339)]({},i),{icon:path_1[t(332)].join(__dirname,"../../resources/images/icon.png"),click:()=>{Editor.Message.send(s,i.message)}})):Editor.Menu[t(323)](i[t(312)],i),Editor[t(338)][t(315)]())}}exports[_0x1ab6de(332)]=Controller,Controller.instance=null;