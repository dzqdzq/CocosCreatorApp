const _0x487e=["Message",":panel-win-state-changed","removeBroadcastListener","Package","info","updateToolbar","minimize","remove","default","assign","getButtonTitle","sender","broadcast","__esModule","ipcMain","cleanUp","removeListener","login","menu","isLoggedIn","setUp","../constant/namespace","setMenuVisibility","restore","hide","fromWebContents","dispatchLoggedInState","setPanelBlurred","path","Menu","getPackages","init","length","focus","blur","join","onHidePanel","onLanguageChanged",":panel-ready","logout","User","onLoggedInShouldShowState","../../resources/images/icon.png","defineProperty","instance","cleanImSetting","add","uninit","./new-msg-count-timer","contributions","onUserLogout","onPanelReady","send","getInstance","onNotLoggedInState","i18n:change","onLoggedInShouldNotShowState","onUserLogin","../common-lib/update-toolbar","show","BrowserWindow","apply","bind","onShowPanel"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x487e,339);const _0x1453=function(e,t){return _0x487e[e-=211]},_0xbc37c7=_0x1453;var __importDefault=this&&this.__importDefault||function(e){return e&&e[_0x1453(269)]?e:{default:e}};Object[_0xbc37c7(235)](exports,"__esModule",{value:!0});const path_1=__importDefault(require(_0xbc37c7(220))),electron_1=require("electron"),update_toolbar_1=require(_0xbc37c7(250)),namespace_1=require(_0xbc37c7(213)),new_msg_count_timer_1=__importDefault(require(_0xbc37c7(240))),service_1=__importDefault(require("./service")),newMsgCountTimer=new_msg_count_timer_1[_0xbc37c7(264)][_0xbc37c7(245)]();class Controller{constructor(){const e=_0xbc37c7;this[e(249)]=this[e(249)][e(254)](this),this[e(242)]=this[e(242)][e(254)](this),this[e(229)]=this[e(229)][e(254)](this),this[e(243)]=this[e(243)][e(254)](this)}static getInstance(){const e=_0xbc37c7;return this[e(236)]||(this.instance=new Controller),this[e(236)]}async[_0xbc37c7(223)](){const e=_0xbc37c7;Editor[e(232)].on(e(273),this[e(249)]),Editor[e(232)].on(e(231),this[e(242)]),Editor[e(256)].addBroadcastListener("i18n:change",this[e(229)]),electron_1[e(270)].on(namespace_1.ns+e(230),this[e(243)]),await Editor.User.isLoggedIn()?this[e(218)]():(this[e(246)](),setTimeout(()=>{this[e(214)](!1)},500))}[_0xbc37c7(239)](){const e=_0xbc37c7;Editor.User.removeListener(e(273),this.onUserLogin),Editor[e(232)][e(272)]("logout",this[e(242)]),Editor[e(256)][e(258)](e(247),this[e(229)]),electron_1[e(270)].removeListener(namespace_1.ns+":panel-ready",this[e(243)])}[_0xbc37c7(255)](){newMsgCountTimer.cleanUp(),update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1.setPanelBlurred(!1)}[_0xbc37c7(228)](){update_toolbar_1[_0xbc37c7(219)](!0)}onClosePanel(){update_toolbar_1.setPanelBlurred(!0)}[_0xbc37c7(249)](){this[_0xbc37c7(218)]()}[_0xbc37c7(242)](){this[_0xbc37c7(246)]()}async[_0xbc37c7(229)](){const e=_0xbc37c7;await Editor[e(232)][e(211)]()&&this[e(218)]()}async dispatchLoggedInState(){const e=_0xbc37c7,t=await service_1.default.getInstance();t[e(237)](),await t.shouldShowEntrance()?this.onLoggedInShouldShowState():this[e(248)]()}[_0xbc37c7(246)](){const e=_0xbc37c7;Editor[e(256)][e(268)](namespace_1.ns+":force-close-panel"),this[e(214)](!1),update_toolbar_1[e(261)]({showToolbar:!1}),newMsgCountTimer[e(271)]()}async[_0xbc37c7(233)](){const e=_0xbc37c7,t=await service_1[e(264)][e(245)](),n=await t.isVip(),o=await t[e(266)]();this[e(214)](!0),update_toolbar_1[e(261)]({showToolbar:!0,isVip:n,buttonTitle:o}),newMsgCountTimer[e(212)]()}[_0xbc37c7(248)](){this[_0xbc37c7(246)]()}[_0xbc37c7(243)](e){const t=_0xbc37c7,n=electron_1[t(252)][t(217)](e.sender);function o(n){const o=t;e[o(267)][o(244)](namespace_1.ns+o(257),n)}n?(n.on(t(226),o[t(254)](null,"blur")),n.on(t(225),o.bind(null,"focus")),n.on(t(251),o.bind(null,t(251))),n.on(t(216),o[t(254)](null,t(216))),n.on(t(262),o[t(254)](null,t(262))),n.on(t(215),o[t(254)](null,"restore")),n.on(t(226),()=>{update_toolbar_1[t(219)](!0)}),n.on("focus",()=>{const e=t;update_toolbar_1[e(261)]({newMsgCount:0},!0),update_toolbar_1[e(219)](!1)})):console.error("panel window is undefined")}[_0xbc37c7(214)](e){const t=_0xbc37c7;var n;const o=Editor[t(259)][t(222)]({name:namespace_1.ns}),c=o[o[t(224)]-1],s=c.name,i=null===(n=c[t(260)][t(241)])||void 0===n?void 0:n[t(274)][0];i&&(e?Editor.Menu[t(238)](i.path,Object[t(265)](Object[t(265)]({},i),{icon:path_1[t(264)][t(227)](__dirname,t(234)),click:()=>{const e=t;Editor[e(256)][e(244)](s,i.message)}})):Editor[t(221)][t(263)](i[t(220)],i),Editor[t(221)][t(253)]())}}exports[_0xbc37c7(264)]=Controller,Controller.instance=null;