const _0x1c9b=["blur","hide","i18n:change","restore","path","addBroadcastListener","focus","send","instance","info","onNotLoggedInState","onHidePanel","removeListener","name","logout","broadcast","getPackages","getInstance","login","electron","apply","Menu","setPanelBlurred","ipcMain","assign","onUserLogin","bind","Package","Message","default","cleanUp","__esModule","updateToolbar","init","__importDefault",":force-close-panel","menu","show","shouldShowEntrance","message","dispatchLoggedInState","sender","join","onPanelReady","./service","BrowserWindow","panel window is undefined","minimize","onLanguageChanged","error","add","../constant/namespace","onLoggedInShouldShowState","onShowPanel","onUserLogout","removeBroadcastListener","isVip","User","setMenuVisibility",":panel-ready","remove","onLoggedInShouldNotShowState"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x1c9b,421);const _0x1bb0=function(e,t){return _0x1c9b[e-=121]},_0x170e2f=_0x1bb0;var __importDefault=this&&this[_0x170e2f(168)]||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,_0x170e2f(165),{value:!0});const path_1=__importDefault(require(_0x170e2f(138))),electron_1=require(_0x170e2f(153)),update_toolbar_1=require("../common-lib/update-toolbar"),namespace_1=require(_0x170e2f(123)),new_msg_count_timer_1=__importDefault(require("./new-msg-count-timer")),service_1=__importDefault(require(_0x170e2f(178))),newMsgCountTimer=new_msg_count_timer_1[_0x170e2f(163)][_0x170e2f(151)]();class Controller{constructor(){const e=_0x170e2f;this[e(159)]=this[e(159)][e(160)](this),this[e(126)]=this[e(126)][e(160)](this),this.onLanguageChanged=this[e(182)][e(160)](this),this[e(177)]=this[e(177)].bind(this)}static[_0x170e2f(151)](){return this[_0x170e2f(142)]||(this.instance=new Controller),this.instance}async[_0x170e2f(167)](){const e=_0x170e2f;Editor[e(129)].on(e(152),this.onUserLogin),Editor[e(129)].on(e(148),this[e(126)]),Editor[e(162)][e(139)]("i18n:change",this[e(182)]),electron_1.ipcMain.on(namespace_1.ns+e(131),this.onPanelReady),await Editor[e(129)].isLoggedIn()?this[e(174)]():(this[e(144)](),setTimeout(()=>{this[e(130)](!1)},500))}uninit(){const e=_0x170e2f;Editor[e(129)].removeListener(e(152),this[e(159)]),Editor[e(129)][e(146)](e(148),this[e(126)]),Editor[e(162)][e(127)](e(136),this[e(182)]),electron_1[e(157)][e(146)](namespace_1.ns+e(131),this[e(177)])}[_0x170e2f(125)](){newMsgCountTimer[_0x170e2f(164)](),update_toolbar_1.updateToolbar({newMsgCount:0},!0),update_toolbar_1.setPanelBlurred(!1)}[_0x170e2f(145)](){update_toolbar_1[_0x170e2f(156)](!0)}onClosePanel(){update_toolbar_1[_0x170e2f(156)](!0)}[_0x170e2f(159)](){this.dispatchLoggedInState()}[_0x170e2f(126)](){this[_0x170e2f(144)]()}async[_0x170e2f(182)](){const e=_0x170e2f;await Editor[e(129)].isLoggedIn()&&this[e(174)]()}async dispatchLoggedInState(){const e=_0x170e2f,t=await service_1[e(163)][e(151)]();t.cleanImSetting(),await t[e(172)]()?this.onLoggedInShouldShowState():this[e(133)]()}[_0x170e2f(144)](){const e=_0x170e2f;Editor.Message[e(149)](namespace_1.ns+e(169)),this[e(130)](!1),update_toolbar_1[e(166)]({showToolbar:!1}),newMsgCountTimer[e(164)]()}async[_0x170e2f(124)](){const e=_0x170e2f,t=await service_1[e(163)][e(151)](),n=await t[e(128)](),o=await t.getButtonTitle();this[e(130)](!0),update_toolbar_1[e(166)]({showToolbar:!0,isVip:n,buttonTitle:o}),newMsgCountTimer.setUp()}[_0x170e2f(133)](){this.onNotLoggedInState()}[_0x170e2f(177)](e){const t=_0x170e2f,n=electron_1[t(179)].fromWebContents(e[t(175)]);function o(n){const o=t;e.sender[o(141)](namespace_1.ns+":panel-win-state-changed",n)}n?(n.on(t(134),o[t(160)](null,"blur")),n.on("focus",o[t(160)](null,t(140))),n.on(t(171),o.bind(null,t(171))),n.on("hide",o[t(160)](null,t(135))),n.on(t(181),o.bind(null,t(181))),n.on(t(137),o.bind(null,t(137))),n.on("blur",()=>{update_toolbar_1[t(156)](!0)}),n.on(t(140),()=>{update_toolbar_1[t(166)]({newMsgCount:0},!0),update_toolbar_1.setPanelBlurred(!1)})):console[t(121)](t(180))}[_0x170e2f(130)](e){const t=_0x170e2f;var n;const o=Editor[t(161)][t(150)]({name:namespace_1.ns}),i=o[o.length-1],s=i[t(147)],a=null===(n=i[t(143)].contributions)||void 0===n?void 0:n[t(170)][0];a&&(e?Editor[t(155)][t(122)](a[t(138)],Object[t(158)](Object[t(158)]({},a),{icon:path_1[t(163)][t(176)](__dirname,"../../resources/images/icon.png"),click:()=>{const e=t;Editor.Message[e(141)](s,a[e(173)])}})):Editor[t(155)][t(132)](a[t(138)],a),Editor.Menu[t(154)]())}}exports[_0x170e2f(163)]=Controller,Controller[_0x170e2f(142)]=null;