{"version":3,"sources":["../src/main-lib/new-msg-count-timer.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;AAEb,wDAAgC;AAChC,iEAA6D;AAE7D,MAAqB,gBAAgB;IAenC;QAVQ,UAAK,GAAQ,IAAI,CAAC;QAWxB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC7D,CAAC;IAVD,MAAM,CAAC,WAAW;QAChB,IAAI,gBAAgB,CAAC,QAAQ,EAAE;YAC7B,OAAO,gBAAgB,CAAC,QAAQ,CAAC;SAClC;QACD,gBAAgB,CAAC,QAAQ,GAAG,IAAI,gBAAgB,EAAE,CAAC;QACnD,OAAO,gBAAgB,CAAC,QAAQ,CAAC;IACnC,CAAC;IAUD,KAAK;QACH,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACf,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACzB,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;SACjE;IACH,CAAC;IAMD,OAAO;QACL,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC1B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;SACnB;IACH,CAAC;IAEO,KAAK,CAAC,iBAAiB;QAC7B,MAAM,OAAO,GAAG,MAAM,iBAAO,CAAC,WAAW,EAAE,CAAC;QAC5C,8BAAa,CAAC;YACZ,WAAW,EAAE,MAAM,OAAO,CAAC,cAAc,EAAE;SAC5C,CAAC,CAAC;IACL,CAAC;;AA9CH,mCA+CC;AA9CgB,yBAAQ,GAA4B,IAAI,CAAC","file":"new-msg-count-timer.js","sourcesContent":["'use strict';\n\nimport Service from './service';\nimport { updateToolbar } from '../common-lib/update-toolbar';\n\nexport default class NewMsgCountTimer {\n  private static instance: NewMsgCountTimer | null = null;\n\n  // Currently, the type definitions of Node and DOM conflicted.\n  // Specify any as a workaround.\n  private timer: any = null;\n\n  static getInstance(): NewMsgCountTimer {\n    if (NewMsgCountTimer.instance) {\n      return NewMsgCountTimer.instance;\n    }\n    NewMsgCountTimer.instance = new NewMsgCountTimer();\n    return NewMsgCountTimer.instance;\n  }\n\n  private constructor() {\n    this.updateNewMsgCount = this.updateNewMsgCount.bind(this);\n  }\n\n  /**\n   * Setup the timer to update the count of new messages.\n   * If timer is already set up, do nothing.\n   */\n  setUp(): void {\n    if (!this.timer) {\n      this.updateNewMsgCount();\n      this.timer = setInterval(this.updateNewMsgCount, 1000 * 60 * 5);\n    }\n  }\n\n  /**\n   * Clean up the timer which update the count of new messages.\n   * If timer is not set up, do nothing.\n   */\n  cleanUp(): void {\n    if (this.timer) {\n      clearInterval(this.timer);\n      this.timer = null;\n    }\n  }\n\n  private async updateNewMsgCount() {\n    const service = await Service.getInstance();\n    updateToolbar({\n      newMsgCount: await service.getNewMsgCount(),\n    });\n  }\n}\n"]}