const _0x39fc=["sessionCode","get session failed","requestService","instance","data","getInstance","cleanImSetting","getSessionToken","default","getUserData","then","getImSetting","https://creator-api.cocos.com/api","indexOf","user_licnese","I18n","/service/get_im_setting","/session/token","getSessionCode","User","init","shouldShowEntrance","__esModule","sessionId","isVip","postData","getSignInUrl","getRedirectUrl","getNewMsgCount","session_id","encodeParams","&redirect_url=","show_entrance","defineProperty","remote","sessionToken","sessionChanged","/account/client_signin?session_id=","error","lang=","getLanguage","init failed, cannot get session id"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x39fc,225);const _0x3479=function(e,t){return _0x39fc[e-=207]},_0xe28eab=_0x3479;Object[_0xe28eab(225)](exports,_0xe28eab(214),{value:!0});const http_utils_1=require("./http-utils"),apiBaseUrl=_0xe28eab(246);class Service{constructor(){const e=_0xe28eab;this[e(215)]=null,this[e(234)]=null,this[e(227)]=null,this.imSetting=null}static async[_0xe28eab(239)](){const e=_0xe28eab;if(Service[e(237)]&&!await Service[e(237)].sessionChanged())return Service[e(237)];const t=new Service;return await t[e(212)](),Service[e(237)]=t,t}async[_0xe28eab(228)](){const e=_0xe28eab;return(await this[e(243)]())[e(221)]!==this[e(215)]}async getUserData(){const e=_0xe28eab;let t=null;return(t=Editor.User.getData())[e(244)]||(t=Editor[e(226)][e(211)].getData()),t}async[_0xe28eab(212)](){const e=_0xe28eab,t=await this[e(243)]();if(this.sessionId=t.session_id,this[e(215)])try{this[e(234)]=await this.getSessionCode(this[e(215)]),this[e(227)]=await this[e(241)](this.sessionCode)}catch(t){console[e(230)](e(235)),console.error(t)}else console[e(230)](e(233))}async[_0xe28eab(245)](){const e=_0xe28eab;try{const t=await this[e(236)](apiBaseUrl+e(208),{session_token:this[e(227)]});return this.imSetting=t[e(238)],t[e(238)]}catch(e){return null}}[_0xe28eab(240)](){this.imSetting=null}async getButtonTitle(){const e=await this.getImSetting();return e?e.button_title:""}async[_0xe28eab(216)](){const e=_0xe28eab,t=await this[e(245)]();return!!t&&!!t[e(248)]}async[_0xe28eab(220)](){const e=_0xe28eab,t=await this[e(245)]();if(!t)return 0;try{const s=await http_utils_1[e(217)](t.msg_api_url);return s[e(238)]?s[e(238)]:0}catch(e){return 0}}async[_0xe28eab(213)](){const e=_0xe28eab,t=await this[e(245)]();return!!t&&!!t[e(224)]}async[_0xe28eab(218)](){const e=_0xe28eab,t=await this.getImSetting();return t?this[e(219)](t.entry_url):null}[_0xe28eab(219)](e){const t=_0xe28eab,s=e+(e[t(247)]("?")>=0?"&":"?")+(t(231)+Editor[t(207)][t(232)]());return apiBaseUrl+t(229)+this[t(215)]+t(223)+encodeURIComponent(s)}async[_0xe28eab(210)](e){const t=_0xe28eab;return(await this[t(236)](apiBaseUrl+"/session/code",{session_id:e}))[t(238)].session_code}async[_0xe28eab(241)](e){const t=_0xe28eab;return(await this.requestService(apiBaseUrl+t(209),{session_code:e})).data.session_token}async[_0xe28eab(236)](e,t){const s=_0xe28eab;return http_utils_1[s(217)](e,http_utils_1[s(222)](t))}}exports[_0xe28eab(242)]=Service,Service[_0xe28eab(237)]=null;