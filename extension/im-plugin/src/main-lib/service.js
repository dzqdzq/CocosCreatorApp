const _0x351b=["__esModule","https://creator-api.cocos.com/api","User","getUserData","sessionCode","error","isVip","instance","getData","entry_url","/session/token","/session/code","then","postData","getButtonTitle","getImSetting","show_entrance","defineProperty","sessionId","indexOf","get session failed","remote","user_licnese","getLanguage","getNewMsgCount","getSessionCode","cleanImSetting","requestService","msg_api_url","data","sessionChanged","init","init failed, cannot get session id","/account/client_signin?session_id=","session_id","getSessionToken","getRedirectUrl","default","I18n","shouldShowEntrance","getImSetting failed","sessionToken","getInstance","getSignInUrl","imSetting"];!function(t,e){!function(e){for(;--e;)t.push(t.shift())}(++e)}(_0x351b,429);const _0x3c4f=function(t,e){return _0x351b[t-=134]},_0x1f8c2a=_0x3c4f;Object[_0x1f8c2a(172)](exports,_0x1f8c2a(155),{value:!0});const http_utils_1=require("./http-utils"),apiBaseUrl=_0x1f8c2a(156);class Service{constructor(){const t=_0x1f8c2a;this[t(173)]=null,this[t(159)]=null,this[t(151)]=null,this.imSetting=null}static async[_0x1f8c2a(152)](){const t=_0x1f8c2a;if(Service.instance&&!await Service[t(162)].sessionChanged())return Service[t(162)];const e=new Service;return await e[t(141)](),Service[t(162)]=e,e}async[_0x1f8c2a(140)](){const t=_0x1f8c2a;return(await this[t(158)]())[t(144)]!==this[t(173)]}async[_0x1f8c2a(158)](){const t=_0x1f8c2a;let e=null;return(e=Editor[t(157)].getData())[t(167)]||(e=Editor[t(176)][t(157)][t(163)]()),e}async init(){const t=_0x1f8c2a,e=await this.getUserData();if(this[t(173)]=e[t(144)],this[t(173)])try{this.sessionCode=await this[t(135)](this[t(173)]),this[t(151)]=await this[t(145)](this[t(159)])}catch(e){console.error(t(175)),console[t(160)](e)}else console[t(160)](t(142))}async[_0x1f8c2a(170)](){const t=_0x1f8c2a;try{const e=await this[t(137)](apiBaseUrl+"/service/get_im_setting",{session_token:this[t(151)]});return this[t(154)]=e.data,e[t(139)]}catch(e){return console[t(160)](t(150)),null}}[_0x1f8c2a(136)](){this[_0x1f8c2a(154)]=null}async[_0x1f8c2a(169)](){const t=_0x1f8c2a,e=await this[t(170)]();return e?e.button_title:""}async[_0x1f8c2a(161)](){const t=_0x1f8c2a,e=await this[t(170)]();return!!e&&!!e[t(177)]}async[_0x1f8c2a(134)](){const t=_0x1f8c2a,e=await this[t(170)]();if(!e)return 0;try{const s=await http_utils_1[t(168)](e[t(138)]);return s.data?s[t(139)]:0}catch(t){return 0}}async[_0x1f8c2a(149)](){const t=_0x1f8c2a,e=await this[t(170)]();return!!e&&!!e[t(171)]}async[_0x1f8c2a(153)](){const t=_0x1f8c2a,e=await this.getImSetting();return e?this.getRedirectUrl(e[t(164)]):null}[_0x1f8c2a(146)](t){const e=_0x1f8c2a,s=t+(t[e(174)]("?")>=0?"&":"?")+"lang="+Editor[e(148)][e(178)]();return apiBaseUrl+e(143)+this[e(173)]+"&redirect_url="+encodeURIComponent(s)}async getSessionCode(t){const e=_0x1f8c2a;return(await this.requestService(apiBaseUrl+e(166),{session_id:t}))[e(139)].session_code}async[_0x1f8c2a(145)](t){const e=_0x1f8c2a;return(await this.requestService(apiBaseUrl+e(165),{session_code:t})).data.session_token}async[_0x1f8c2a(137)](t,e){return http_utils_1[_0x1f8c2a(168)](t,http_utils_1.encodeParams(e))}}exports[_0x1f8c2a(147)]=Service,Service.instance=null;