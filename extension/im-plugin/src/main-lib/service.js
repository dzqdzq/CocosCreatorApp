const _0x279a=["./http-utils","init failed, cannot get session id","__esModule","getSessionToken","session_code","sessionChanged","sessionCode","error","getButtonTitle","instance","data","getUserData","getRedirectUrl","/account/client_signin?session_id=","getImSetting failed","imSetting","getInstance","lang=","requestService","msg_api_url","User","session_token","I18n","default","remote","/service/get_im_setting","defineProperty","get session failed","indexOf","getData","postData","https://creator-api.cocos.com/api","sessionId","sessionToken","getSignInUrl","encodeParams","shouldShowEntrance","cleanImSetting","getNewMsgCount","getImSetting","isVip","&redirect_url=","getSessionCode","session_id","init","user_licnese"];!function(t,s){!function(s){for(;--s;)t.push(t.shift())}(++s)}(_0x279a,162);const _0x4b66=function(t,s){return _0x279a[t-=118]},_0x20a786=_0x4b66;Object[_0x20a786(120)](exports,_0x20a786(142),{value:!0});const http_utils_1=require(_0x20a786(140)),apiBaseUrl=_0x20a786(125);class Service{constructor(){const t=_0x20a786;this[t(126)]=null,this[t(146)]=null,this[t(127)]=null,this.imSetting=null}static async[_0x20a786(156)](){const t=_0x20a786;if(Service.instance&&!await Service[t(149)][t(145)]())return Service[t(149)];const s=new Service;return await s[t(138)](),Service.instance=s,s}async[_0x20a786(145)](){const t=_0x20a786;return(await this[t(151)]())[t(137)]!==this[t(126)]}async getUserData(){const t=_0x20a786;let s=null;return(s=Editor[t(160)][t(123)]()).then||(s=Editor[t(118)][t(160)][t(123)]()),s}async[_0x20a786(138)](){const t=_0x20a786,s=await this[t(151)]();if(this.sessionId=s[t(137)],this.sessionId)try{this[t(146)]=await this[t(136)](this.sessionId),this[t(127)]=await this[t(143)](this[t(146)])}catch(s){console[t(147)](t(121)),console[t(147)](s)}else console[t(147)](t(141))}async[_0x20a786(133)](){const t=_0x20a786;try{const s=await this[t(158)](apiBaseUrl+t(119),{session_token:this[t(127)]});return this[t(155)]=s.data,s[t(150)]}catch(s){return console.error(t(154)),null}}[_0x20a786(131)](){this[_0x20a786(155)]=null}async[_0x20a786(148)](){const t=_0x20a786,s=await this[t(133)]();return s?s.button_title:""}async[_0x20a786(134)](){const t=_0x20a786,s=await this[t(133)]();return!!s&&!!s[t(139)]}async[_0x20a786(132)](){const t=_0x20a786,s=await this[t(133)]();if(!s)return 0;try{const e=await http_utils_1[t(124)](s[t(159)]);return e.data?e[t(150)]:0}catch(t){return 0}}async[_0x20a786(130)](){const t=await this.getImSetting();return!!t&&!!t.show_entrance}async[_0x20a786(128)](){const t=_0x20a786,s=await this[t(133)]();return s?this[t(152)](s.entry_url):null}getRedirectUrl(t){const s=_0x20a786,e=t+(t[s(122)]("?")>=0?"&":"?")+(s(157)+Editor[s(162)].getLanguage());return apiBaseUrl+s(153)+this[s(126)]+s(135)+encodeURIComponent(e)}async[_0x20a786(136)](t){const s=_0x20a786;return(await this[s(158)](apiBaseUrl+"/session/code",{session_id:t}))[s(150)][s(144)]}async[_0x20a786(143)](t){const s=_0x20a786;return(await this[s(158)](apiBaseUrl+"/session/token",{session_code:t}))[s(150)][s(161)]}async[_0x20a786(158)](t,s){const e=_0x20a786;return http_utils_1[e(124)](t,http_utils_1[e(129)](s))}}exports[_0x20a786(163)]=Service,Service[_0x20a786(149)]=null;