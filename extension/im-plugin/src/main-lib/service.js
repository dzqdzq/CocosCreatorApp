const _0x5988=["remote","I18n","init","session_code","msg_api_url","indexOf","sessionToken","session_token","init failed, cannot get session id","__esModule","https://creator-api.cocos.com/api","getData","getRedirectUrl","/service/get_im_setting","getImSetting failed","session_id","getSessionToken","imSetting","getButtonTitle","entry_url","&redirect_url=","getInstance","sessionCode","getLanguage","show_entrance","get session failed","lang=","getSessionCode","sessionId","button_title","requestService","then","getUserData","data","User","cleanImSetting","default","getImSetting","/session/token","sessionChanged","error","instance"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x5988,158);const _0x44d1=function(e,t){return _0x5988[e-=438]},_0x4c6a9e=_0x44d1;Object.defineProperty(exports,_0x4c6a9e(457),{value:!0});const http_utils_1=require("./http-utils"),apiBaseUrl=_0x4c6a9e(458);class Service{constructor(){const e=_0x4c6a9e;this[e(476)]=null,this[e(470)]=null,this[e(454)]=null,this[e(465)]=null}static async[_0x4c6a9e(469)](){const e=_0x4c6a9e;if(Service[e(447)]&&!await Service[e(447)][e(445)]())return Service[e(447)];const t=new Service;return await t.init(),Service[e(447)]=t,t}async sessionChanged(){const e=_0x4c6a9e;return(await this.getUserData())[e(463)]!==this[e(476)]}async[_0x4c6a9e(438)](){const e=_0x4c6a9e;let t=null;return(t=Editor[e(440)][e(459)]())[e(479)]||(t=Editor[e(448)][e(440)][e(459)]()),t}async[_0x4c6a9e(450)](){const e=_0x4c6a9e,t=await this.getUserData();if(this[e(476)]=t.session_id,this[e(476)])try{this[e(470)]=await this[e(475)](this[e(476)]),this[e(454)]=await this[e(464)](this.sessionCode)}catch(t){console[e(446)](e(473)),console[e(446)](t)}else console[e(446)](e(456))}async getImSetting(){const e=_0x4c6a9e;try{const t=await this[e(478)](apiBaseUrl+e(461),{session_token:this[e(454)]});return this[e(465)]=t[e(439)],t[e(439)]}catch(t){return console.error(e(462)),null}}[_0x4c6a9e(441)](){this[_0x4c6a9e(465)]=null}async[_0x4c6a9e(466)](){const e=_0x4c6a9e,t=await this[e(443)]();return t?t[e(477)]:""}async isVip(){const e=_0x4c6a9e,t=await this[e(443)]();return!!t&&!!t.user_licnese}async getNewMsgCount(){const e=_0x4c6a9e,t=await this[e(443)]();if(!t)return 0;try{const s=await http_utils_1.postData(t[e(452)]);return s[e(439)]?s[e(439)]:0}catch(e){return 0}}async shouldShowEntrance(){const e=_0x4c6a9e,t=await this[e(443)]();return!!t&&!!t[e(472)]}async getSignInUrl(){const e=_0x4c6a9e,t=await this.getImSetting();return t?this.getRedirectUrl(t[e(467)]):null}[_0x4c6a9e(460)](e){const t=_0x4c6a9e,s=e+(e[t(453)]("?")>=0?"&":"?")+(t(474)+Editor[t(449)][t(471)]());return apiBaseUrl+"/account/client_signin?session_id="+this.sessionId+t(468)+encodeURIComponent(s)}async getSessionCode(e){const t=_0x4c6a9e;return(await this[t(478)](apiBaseUrl+"/session/code",{session_id:e}))[t(439)][t(451)]}async[_0x4c6a9e(464)](e){const t=_0x4c6a9e;return(await this.requestService(apiBaseUrl+t(444),{session_code:e}))[t(439)][t(455)]}async[_0x4c6a9e(478)](e,t){return http_utils_1.postData(e,http_utils_1.encodeParams(t))}}exports[_0x4c6a9e(442)]=Service,Service[_0x4c6a9e(447)]=null;