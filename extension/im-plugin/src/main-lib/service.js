const _0x4d3b=["encodeParams","/account/client_signin?session_id=","imSetting","instance","/service/get_im_setting","init","error","getData","cleanImSetting","getImSetting","then","./http-utils","init failed, cannot get session id","getInstance","remote","indexOf","&redirect_url=","requestService","user_licnese","sessionChanged","session_id","I18n","https://creator-api.cocos.com/api","getSessionToken","isVip","sessionCode","getUserData","__esModule","getSessionCode","sessionId","data","postData","sessionToken","session_token","/session/code","get session failed","button_title","msg_api_url"];!function(t,s){!function(s){for(;--s;)t.push(t.shift())}(++s)}(_0x4d3b,231);const _0xe3b0=function(t,s){return _0x4d3b[t-=473]},_0x35a4cc=_0xe3b0;Object.defineProperty(exports,_0x35a4cc(497),{value:!0});const http_utils_1=require(_0x35a4cc(481)),apiBaseUrl=_0x35a4cc(492);class Service{constructor(){const t=_0x35a4cc;this[t(499)]=null,this[t(495)]=null,this[t(502)]=null,this[t(510)]=null}static async[_0x35a4cc(483)](){const t=_0x35a4cc;if(Service[t(473)]&&!await Service[t(473)][t(489)]())return Service[t(473)];const s=new Service;return await s[t(475)](),Service[t(473)]=s,s}async sessionChanged(){const t=_0x35a4cc;return(await this[t(496)]())[t(490)]!==this.sessionId}async[_0x35a4cc(496)](){const t=_0x35a4cc;let s=null;return(s=Editor.User[t(477)]())[t(480)]||(s=Editor[t(484)].User.getData()),s}async[_0x35a4cc(475)](){const t=_0x35a4cc,s=await this[t(496)]();if(this.sessionId=s.session_id,this.sessionId)try{this[t(495)]=await this[t(498)](this[t(499)]),this[t(502)]=await this[t(493)](this.sessionCode)}catch(s){console[t(476)](t(505)),console.error(s)}else console[t(476)](t(482))}async[_0x35a4cc(479)](){const t=_0x35a4cc;if(this[t(510)])return this[t(510)];try{const s=await this[t(487)](apiBaseUrl+t(474),{session_token:this.sessionToken});return this[t(510)]=s[t(500)],s[t(500)]}catch(s){return console[t(476)]("getImSetting failed"),null}}[_0x35a4cc(478)](){this[_0x35a4cc(510)]=null}async getButtonTitle(){const t=_0x35a4cc,s=await this[t(479)]();return s?s[t(506)]:""}async[_0x35a4cc(494)](){const t=_0x35a4cc,s=await this.getImSetting();return!!s&&!!s[t(488)]}async getNewMsgCount(){const t=_0x35a4cc,s=await this[t(479)]();if(!s)return 0;try{const e=await http_utils_1[t(501)](s[t(507)]);return e[t(500)]?e[t(500)]:0}catch(t){return 0}}async shouldShowEntrance(){const t=await this.getImSetting();return!!t&&!!t.show_entrance}async getSignInUrl(){const t=await this.getImSetting();return t?this.getRedirectUrl(t.entry_url):null}getRedirectUrl(t){const s=_0x35a4cc,e=t+(t[s(485)]("?")>=0?"&":"?")+"lang="+Editor[s(491)].getLanguage();return apiBaseUrl+s(509)+this[s(499)]+s(486)+encodeURIComponent(e)}async[_0x35a4cc(498)](t){const s=_0x35a4cc;return(await this[s(487)](apiBaseUrl+s(504),{session_id:t}))[s(500)].session_code}async[_0x35a4cc(493)](t){const s=_0x35a4cc;return(await this[s(487)](apiBaseUrl+"/session/token",{session_code:t}))[s(500)][s(503)]}async[_0x35a4cc(487)](t,s){const e=_0x35a4cc;return http_utils_1[e(501)](t,http_utils_1[e(508)](s))}}exports.default=Service,Service[_0x35a4cc(473)]=null;