const _0x3827=["getSignInUrl","remote","show_entrance","defineProperty","requestService","getLanguage","encodeParams","./http-utils","shouldShowEntrance","entry_url","default","imSetting","session_code","getSessionToken","isVip","getData","data","sessionId","postData","get session failed","/session/token","sessionToken","sessionCode","error","https://creator-api.cocos.com/api","getRedirectUrl","instance","session_token","sessionChanged","User","getImSetting","getUserData","then","/service/get_im_setting","/session/code","&redirect_url=","session_id","lang=","getSessionCode","init","cleanImSetting","/account/client_signin?session_id=","getInstance"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x3827,350);const _0x212f=function(e,t){return _0x3827[e-=220]},_0x4ab99e=_0x212f;Object[_0x4ab99e(260)](exports,"__esModule",{value:!0});const http_utils_1=require(_0x4ab99e(221)),apiBaseUrl=_0x4ab99e(238);class Service{constructor(){const e=_0x4ab99e;this[e(231)]=null,this[e(236)]=null,this[e(235)]=null,this[e(225)]=null}static async[_0x4ab99e(256)](){const e=_0x4ab99e;if(Service[e(240)]&&!await Service[e(240)].sessionChanged())return Service[e(240)];const t=new Service;return await t.init(),Service[e(240)]=t,t}async[_0x4ab99e(242)](){const e=_0x4ab99e;return(await this.getUserData()).session_id!==this[e(231)]}async getUserData(){const e=_0x4ab99e;let t=null;return(t=Editor[e(243)][e(229)]())[e(246)]||(t=Editor[e(258)].User[e(229)]()),t}async[_0x4ab99e(253)](){const e=_0x4ab99e,t=await this[e(245)]();if(this.sessionId=t[e(250)],this.sessionId)try{this.sessionCode=await this.getSessionCode(this[e(231)]),this[e(235)]=await this.getSessionToken(this[e(236)])}catch(t){console.error(e(233)),console[e(237)](t)}else console.error("init failed, cannot get session id")}async getImSetting(){const e=_0x4ab99e;if(this[e(225)])return this[e(225)];try{const t=await this[e(261)](apiBaseUrl+e(247),{session_token:this[e(235)]});return this[e(225)]=t.data,t[e(230)]}catch(e){return console.error("getImSetting failed"),null}}[_0x4ab99e(254)](){this[_0x4ab99e(225)]=null}async[_0x4ab99e(228)](){const e=_0x4ab99e,t=await this[e(244)]();return!!t&&!!t.user_licnese}async getNewMsgCount(){const e=_0x4ab99e,t=await this[e(244)]();if(!t)return 0;try{const s=await http_utils_1[e(232)](t.msg_api_url);return s[e(230)]?s[e(230)]:0}catch(e){return 0}}async[_0x4ab99e(222)](){const e=_0x4ab99e,t=await this[e(244)]();return!!t&&!!t[e(259)]}async[_0x4ab99e(257)](){const e=_0x4ab99e,t=await this[e(244)]();return t?this[e(239)](t[e(223)]):null}[_0x4ab99e(239)](e){const t=_0x4ab99e,s=e+(e.indexOf("?")>=0?"&":"?")+(t(251)+Editor.I18n[t(262)]());return apiBaseUrl+t(255)+this.sessionId+t(249)+encodeURIComponent(s)}async[_0x4ab99e(252)](e){const t=_0x4ab99e;return(await this[t(261)](apiBaseUrl+t(248),{session_id:e})).data[t(226)]}async[_0x4ab99e(227)](e){const t=_0x4ab99e;return(await this.requestService(apiBaseUrl+t(234),{session_code:e}))[t(230)][t(241)]}async requestService(e,t){const s=_0x4ab99e;return http_utils_1.postData(e,http_utils_1[s(220)](t))}}exports[_0x4ab99e(224)]=Service,Service[_0x4ab99e(240)]=null;