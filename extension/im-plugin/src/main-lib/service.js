const _0x3240=["imSetting","defineProperty","getUserData","&redirect_url=","getRedirectUrl","I18n","entry_url","getButtonTitle","getSessionToken","postData","sessionId","/account/client_signin?session_id=","User","init","data","default","error","getNewMsgCount","requestService","instance","session_id","get session failed","__esModule","getImSetting failed","isVip","getSessionCode","./http-utils","getData","indexOf","button_title","sessionChanged","encodeParams","lang=","getSignInUrl","/session/token","https://creator-api.cocos.com/api","session_token","cleanImSetting","/service/get_im_setting","remote","msg_api_url","/session/code","getImSetting","session_code","init failed, cannot get session id","sessionCode","sessionToken"];!function(t,s){!function(s){for(;--s;)t.push(t.shift())}(++s)}(_0x3240,286);const _0x3909=function(t,s){return _0x3240[t-=298]},_0x2b1bc7=_0x3909;Object[_0x2b1bc7(342)](exports,_0x2b1bc7(316),{value:!0});const http_utils_1=require(_0x2b1bc7(320)),apiBaseUrl=_0x2b1bc7(329);class Service{constructor(){const t=_0x2b1bc7;this[t(304)]=null,this[t(339)]=null,this[t(340)]=null,this[t(341)]=null}static async getInstance(){const t=_0x2b1bc7;if(Service[t(313)]&&!await Service[t(313)][t(324)]())return Service[t(313)];const s=new Service;return await s[t(307)](),Service[t(313)]=s,s}async[_0x2b1bc7(324)](){const t=_0x2b1bc7;return(await this[t(343)]())[t(314)]!==this[t(304)]}async getUserData(){const t=_0x2b1bc7;let s=null;return(s=Editor.User[t(321)]()).then||(s=Editor[t(333)][t(306)][t(321)]()),s}async[_0x2b1bc7(307)](){const t=_0x2b1bc7,s=await this[t(343)]();if(this[t(304)]=s[t(314)],this[t(304)])try{this[t(339)]=await this[t(319)](this.sessionId),this.sessionToken=await this[t(302)](this[t(339)])}catch(s){console[t(310)](t(315)),console[t(310)](s)}else console[t(310)](t(338))}async[_0x2b1bc7(336)](){const t=_0x2b1bc7;if(this.imSetting)return this[t(341)];try{const s=await this.requestService(apiBaseUrl+t(332),{session_token:this.sessionToken});return this[t(341)]=s.data,s.data}catch(s){return console.error(t(317)),null}}[_0x2b1bc7(331)](){this[_0x2b1bc7(341)]=null}async[_0x2b1bc7(301)](){const t=_0x2b1bc7,s=await this.getImSetting();return s?s[t(323)]:""}async[_0x2b1bc7(318)](){const t=_0x2b1bc7,s=await this[t(336)]();return!!s&&!!s.user_licnese}async[_0x2b1bc7(311)](){const t=_0x2b1bc7,s=await this[t(336)]();if(!s)return 0;try{const e=await http_utils_1[t(303)](s[t(334)]);return e[t(308)]?e[t(308)]:0}catch(t){return 0}}async shouldShowEntrance(){const t=await this.getImSetting();return!!t&&!!t.show_entrance}async[_0x2b1bc7(327)](){const t=_0x2b1bc7,s=await this[t(336)]();return s?this[t(298)](s[t(300)]):null}[_0x2b1bc7(298)](t){const s=_0x2b1bc7,e=t+(t[s(322)]("?")>=0?"&":"?")+(s(326)+Editor[s(299)].getLanguage());return apiBaseUrl+s(305)+this.sessionId+s(344)+encodeURIComponent(e)}async[_0x2b1bc7(319)](t){const s=_0x2b1bc7;return(await this[s(312)](apiBaseUrl+s(335),{session_id:t}))[s(308)][s(337)]}async[_0x2b1bc7(302)](t){const s=_0x2b1bc7;return(await this.requestService(apiBaseUrl+s(328),{session_code:t})).data[s(330)]}async[_0x2b1bc7(312)](t,s){const e=_0x2b1bc7;return http_utils_1.postData(t,http_utils_1[e(325)](s))}}exports[_0x2b1bc7(309)]=Service,Service[_0x2b1bc7(313)]=null;