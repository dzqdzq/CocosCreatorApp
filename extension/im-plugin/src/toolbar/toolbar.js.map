{"version":3,"sources":["../src/toolbar/toolbar.ts"],"names":[],"mappings":"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","file":"toolbar.js","sourcesContent":["'use strict';\n\nimport fs from 'fs';\nimport path from 'path';\n\nimport { generateStyle } from './style-generator';\nimport { ns } from '../constant/namespace';\nimport { ToolbarNewInfo } from './toolbar-new-info';\n\nconst template = fs.readFileSync(\n  path.join(__dirname, './toolbar.html'),\n  'utf8'\n);\n\nconst style = generateStyle();\n\nconst selector = {\n  toolbar: `.${ns}-toolbar`,\n  openPanelBtn: `.${ns}-btn`,\n  msgCounter: `.${ns}-msg-counter`,\n};\n\ninterface ThisType {\n  $: {\n    toolbar: HTMLElement;\n    openPanelBtn: HTMLElement;\n    msgCounter: HTMLElement;\n  };\n\n  _onUpdateToolbar: (newInfo: ToolbarNewInfo) => void;\n}\n\nconst methods = {\n  updateToolbar(this: ThisType, newInfo: ToolbarNewInfo = {}) {\n    if (newInfo.showToolbar !== undefined) {\n      setElementVisibility(this.$.toolbar, newInfo.showToolbar);\n    }\n\n    if (newInfo.buttonTitle !== undefined) {\n      this.$.openPanelBtn.setAttribute('title', newInfo.buttonTitle);\n    }\n\n    if (newInfo.isVip !== undefined) {\n      if (newInfo.isVip) {\n        this.$.openPanelBtn.classList.remove(`${ns}-non-vip-btn`);\n        this.$.openPanelBtn.classList.add(`${ns}-vip-btn`);\n      } else {\n        this.$.openPanelBtn.classList.remove(`${ns}-vip-btn`);\n        this.$.openPanelBtn.classList.add(`${ns}-non-vip-btn`);\n      }\n    }\n\n    const newMsgCount = newInfo.newMsgCount;\n    if (newMsgCount !== undefined) {\n      this.$.toolbar.classList.remove(`${ns}-non-vip-btn-single-digit-msgs`);\n      this.$.toolbar.classList.remove(`${ns}-non-vip-btn-double-digits-msgs`);\n\n      if (newMsgCount === 0) {\n        setElementVisibility(this.$.msgCounter, false);\n        this.$.msgCounter.innerText = '0';\n      } else {\n        setElementVisibility(this.$.msgCounter, true);\n        this.$.msgCounter.innerText =\n          newMsgCount > 99 ? '99' : newMsgCount.toString();\n        if (!newInfo.isVip) {\n          if (newMsgCount >= 10) {\n            this.$.toolbar.classList.add(\n              `${ns}-non-vip-btn-double-digits-msgs`\n            );\n          } else {\n            this.$.toolbar.classList.add(`${ns}-non-vip-btn-single-digit-msgs`);\n          }\n        }\n      }\n    }\n\n    const savedToolBarInfo: ToolbarNewInfo = {\n      showToolbar: getElementVisibility(this.$.toolbar),\n      isVip: this.$.openPanelBtn.classList.contains(`${ns}-vip-btn`),\n      newMsgCount: parseInt(this.$.msgCounter.innerText) || 0,\n    };\n    Editor.Message.send(ns, 'save-toolbar-info', savedToolBarInfo);\n  },\n};\n\nasync function ready(this: ThisType) {\n  this._onUpdateToolbar = (newInfo: ToolbarNewInfo) => {\n    methods.updateToolbar.call(this, newInfo);\n  };\n\n  Editor.Message.addBroadcastListener(\n    `${ns}:update-toolbar`,\n    this._onUpdateToolbar\n  );\n\n  this.$.openPanelBtn.addEventListener('click', onClickShowPanel);\n\n  // User may refresh the Editor by Ctrl+r, we need to retrieve the saved info\n  // to restore back the UI state.\n  const savedInfo = await Editor.Message.request(ns, 'get-saved-toolbar-info');\n  if (savedInfo) {\n    this._onUpdateToolbar(savedInfo);\n  }\n}\n\nfunction close(this: ThisType) {\n  Editor.Message.removeBroadcastListener(\n    `${ns}:update-toolbar`,\n    this._onUpdateToolbar\n  );\n\n  this.$.openPanelBtn.removeEventListener('click', onClickShowPanel);\n}\n\nfunction setElementVisibility(element: HTMLElement, visible: boolean): void {\n  if (visible) {\n    element.classList.remove(`${ns}-hide`);\n  } else {\n    element.classList.add(`${ns}-hide`);\n  }\n}\n\nfunction getElementVisibility(element: HTMLElement): boolean {\n  return !element.classList.contains(`${ns}-hide`);\n}\n\nfunction onClickShowPanel() {\n  Editor.Message.send(ns, 'show-panel');\n}\n\nexport { template, style, selector as $, methods, ready, close };\n"]}