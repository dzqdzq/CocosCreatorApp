const _0x5837=["defineProperty","validate","load","uninit","cannot hide panel, panelWin is undefined","ipcMain","./main-lib/controller","length","error","new-version-found","onHidePanel","Panel","__importDefault","getPackages","replace","default","./common-lib/update-toolbar","join","getRedirectUrl","./node_modules","paths","_waitClosedMain",":hide-panel","init","BrowserWindow",":get-version","push","returnValue","send","cancel","path","./common-lib/translate","button_title","unload","removeListener","./common-lib/dialog","./constant/namespace","extension","methods","info","./main-lib/service","onShowPanel","getInstance","hide","plugin_version","plugin_url","__esModule","close","updateToolbar"];!function(e,n){!function(n){for(;--n;)e.push(e.shift())}(++n)}(_0x5837,103);const _0x3d5d=function(e,n){return _0x5837[e-=475]},_0x5c3949=_0x3d5d;var __importDefault=this&&this[_0x5c3949(482)]||function(e){return e&&e[_0x5c3949(516)]?e:{default:e}};Object[_0x5c3949(519)](exports,"__esModule",{value:!0}),exports[_0x5c3949(503)]=exports[_0x5c3949(521)]=exports[_0x5c3949(508)]=void 0;const path_1=__importDefault(require(_0x5c3949(500))),compare_versions_1=__importDefault(require("compare-versions")),electron_1=require("electron"),service_1=__importDefault(require(_0x5c3949(510))),translate_1=require(_0x5c3949(501)),dialog_1=require(_0x5c3949(505)),namespace_1=require(_0x5c3949(506)),update_toolbar_1=require(_0x5c3949(486)),controller_1=__importDefault(require(_0x5c3949(476)));module[_0x5c3949(490)][_0x5c3949(496)](path_1[_0x5c3949(485)][_0x5c3949(487)](Editor.App[_0x5c3949(500)],_0x5c3949(489)));const windows=require("@base/electron-windows"),controller=controller_1.default[_0x5c3949(512)]();let panelWin=null,newVersionChecked=!1;function load(){const e=_0x5c3949;electron_1[e(475)].on(namespace_1.ns+":hide-panel",hidePanel),electron_1.ipcMain.on(namespace_1.ns+e(495),getVersion_),controller[e(493)]()}function unload(){const e=_0x5c3949;electron_1.ipcMain[e(504)](namespace_1.ns+e(492),hidePanel),electron_1[e(475)].removeListener(namespace_1.ns+e(495),getVersion_),controller[e(522)]()}exports[_0x5c3949(521)]=load,exports[_0x5c3949(503)]=unload;let savedInfo=null;const methods={showPanel(){const e=_0x5c3949;panelWin?(panelWin.show(),panelWin=null):Editor[e(481)].open(namespace_1.ns),controller[e(511)]()},domReady(){checkUpdate()},closePanel(){const e=_0x5c3949;Editor[e(481)][e(517)](namespace_1.ns),panelWin=null,controller.onClosePanel()},whetherClose:()=>windows[_0x5c3949(491)],getSignInUrl:async()=>(await service_1.default[_0x5c3949(512)]()).getSignInUrl(),getRedirectUrl:async e=>(await service_1[_0x5c3949(485)][_0x5c3949(512)]())[_0x5c3949(488)](e),updateToolbarMain(e,n){update_toolbar_1[_0x5c3949(518)](e,n)},saveToolbarInfo(e){savedInfo=e},getSavedToolbarInfo:()=>savedInfo};function hidePanel(e){const n=_0x5c3949;(panelWin=electron_1[n(494)].fromWebContents(e.sender))?(panelWin[n(513)](),controller[n(480)]()):console[n(478)](n(523))}function getVersion_(e){e[_0x5c3949(497)]=getVersion()}function getVersion(){const e=_0x5c3949,n=Editor.Package[e(483)]({name:namespace_1.ns});return n[n[e(477)]-1].version}async function checkUpdate(){const e=_0x5c3949;if(newVersionChecked)return;newVersionChecked=!0;const n=await service_1[e(485)][e(512)](),o=await n.getImSetting();if(!o||!o[e(514)]||!o[e(515)])return;const t=o[e(514)];if(!compare_versions_1.default[e(520)](t))return;const r=getVersion();if(compare_versions_1[e(485)](t,r)<=0)return;const a=translate_1.tr(e(479))[e(484)]("_1",o[e(502)])[e(484)]("_2",t);1!==await dialog_1[e(509)](a,{title:translate_1.tr("info-title"),buttons:[translate_1.tr("ok"),translate_1.tr(e(499))],default:0,cancel:1})&&Editor.Message[e(498)](e(507),"update-extension",o.plugin_url,namespace_1.ns,"global")}exports[_0x5c3949(508)]=methods;