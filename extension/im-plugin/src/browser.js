const _0x3a80=["__importDefault","push","./common-lib/update-toolbar","extension","./common-lib/dialog","_waitClosedMain","version","info-title","onShowPanel","plugin_version","removeListener","Message","load","path","returnValue","App","@base/electron-windows","getImSetting","getPackages","methods","onClosePanel","replace","global","ipcMain","unload","getRedirectUrl","./node_modules","updateToolbar","defineProperty","./constant/namespace","compare-versions","plugin_url","update-extension","open","onHidePanel",":get-version","validate","info","getSignInUrl","getInstance","./main-lib/controller","__esModule","send","error","uninit","electron","join","button_title","default","cancel",":hide-panel","new-version-found","show","Panel"];!function(e,n){!function(n){for(;--n;)e.push(e.shift())}(++n)}(_0x3a80,137);const _0xdfd1=function(e,n){return _0x3a80[e-=143]},_0x35c833=_0xdfd1;var __importDefault=this&&this[_0x35c833(168)]||function(e){return e&&e.__esModule?e:{default:e}};Object[_0x35c833(196)](exports,_0x35c833(155),{value:!0}),exports[_0x35c833(192)]=exports[_0x35c833(180)]=exports[_0x35c833(187)]=void 0;const path_1=__importDefault(require(_0x35c833(181))),compare_versions_1=__importDefault(require(_0x35c833(144))),electron_1=require(_0x35c833(159)),service_1=__importDefault(require("./main-lib/service")),translate_1=require("./common-lib/translate"),dialog_1=require(_0x35c833(172)),namespace_1=require(_0x35c833(143)),update_toolbar_1=require(_0x35c833(170)),controller_1=__importDefault(require(_0x35c833(154)));module.paths[_0x35c833(169)](path_1.default[_0x35c833(160)](Editor[_0x35c833(183)][_0x35c833(181)],_0x35c833(194)));const windows=require(_0x35c833(184)),controller=controller_1[_0x35c833(162)][_0x35c833(153)]();let panelWin=null,newVersionChecked=!1;function load(){const e=_0x35c833;electron_1[e(191)].on(namespace_1.ns+e(164),hidePanel),electron_1[e(191)].on(namespace_1.ns+e(149),getVersion_),controller.init()}function unload(){const e=_0x35c833;electron_1[e(191)][e(178)](namespace_1.ns+e(164),hidePanel),electron_1.ipcMain[e(178)](namespace_1.ns+":get-version",getVersion_),controller[e(158)]()}exports[_0x35c833(180)]=load,exports[_0x35c833(192)]=unload;let savedInfo=null;const methods={showPanel(){const e=_0x35c833;panelWin?(panelWin[e(166)](),panelWin=null):Editor[e(167)][e(147)](namespace_1.ns),controller[e(176)]()},domReady(){checkUpdate()},closePanel(){const e=_0x35c833;Editor[e(167)].close(namespace_1.ns),panelWin=null,controller[e(188)]()},whetherClose:()=>windows[_0x35c833(173)],getSignInUrl:async()=>(await service_1[_0x35c833(162)][_0x35c833(153)]())[_0x35c833(152)](),getRedirectUrl:async e=>(await service_1[_0x35c833(162)].getInstance())[_0x35c833(193)](e),updateToolbarMain(e,n){update_toolbar_1[_0x35c833(195)](e,n)},saveToolbarInfo(e){savedInfo=e},getSavedToolbarInfo:()=>savedInfo};function hidePanel(e){const n=_0x35c833;(panelWin=electron_1.BrowserWindow.fromWebContents(e.sender))?(panelWin.hide(),controller[n(148)]()):console[n(157)]("cannot hide panel, panelWin is undefined")}function getVersion_(e){e[_0x35c833(182)]=getVersion()}function getVersion(){const e=_0x35c833,n=Editor.Package[e(186)]({name:namespace_1.ns});return n[n.length-1][e(174)]}async function checkUpdate(){const e=_0x35c833;if(newVersionChecked)return;newVersionChecked=!0;const n=await service_1[e(162)][e(153)](),o=await n[e(185)]();if(!o||!o[e(177)]||!o[e(145)])return;const t=o[e(177)];if(!compare_versions_1[e(162)][e(150)](t))return;const r=getVersion();if(compare_versions_1[e(162)](t,r)<=0)return;const a=translate_1.tr(e(165))[e(189)]("_1",o[e(161)]).replace("_2",t);1!==await dialog_1[e(151)](a,{title:translate_1.tr(e(175)),buttons:[translate_1.tr("ok"),translate_1.tr(e(163))],default:0,cancel:1})&&Editor[e(179)][e(156)](e(171),e(146),o[e(145)],namespace_1.ns,e(190))}exports[_0x35c833(187)]=methods;