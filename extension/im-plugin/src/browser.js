const _0x4942=["plugin_version","replace","ipcMain","info-title","methods","path","Panel","show","default","global","@base/electron-windows","cannot hide panel, panelWin is undefined","onShowPanel","plugin_url","getInstance","length","getPackages","./node_modules","removeListener","compare-versions","addBroadcastListener","join","__importDefault","scene:ready",":hide-panel","update-extension","./common-lib/update-toolbar","__esModule","onHidePanel","Message","cancel","open","sender","init","electron","./common-lib/translate","getSignInUrl","getImSetting","./main-lib/service","unload","./constant/namespace",":get-version","new-version-found","./common-lib/dialog","returnValue","version","paths","getRedirectUrl","load","extension","send","close","info","removeBroadcastListener"];!function(e,n){!function(n){for(;--n;)e.push(e.shift())}(++n)}(_0x4942,149);const _0x1810=function(e,n){return _0x4942[e-=102]},_0x391b6c=_0x1810;var __importDefault=this&&this[_0x391b6c(137)]||function(e){return e&&e[_0x391b6c(142)]?e:{default:e}};Object.defineProperty(exports,_0x391b6c(142),{value:!0}),exports.unload=exports.load=exports[_0x391b6c(119)]=void 0;const path_1=__importDefault(require(_0x391b6c(120))),compare_versions_1=__importDefault(require(_0x391b6c(134))),electron_1=require(_0x391b6c(149)),service_1=__importDefault(require(_0x391b6c(153))),translate_1=require(_0x391b6c(150)),dialog_1=require(_0x391b6c(104)),namespace_1=require(_0x391b6c(155)),update_toolbar_1=require(_0x391b6c(141)),controller_1=__importDefault(require("./main-lib/controller"));module[_0x391b6c(107)].push(path_1.default[_0x391b6c(136)](Editor.App.path,_0x391b6c(132)));const windows=require(_0x391b6c(125)),controller=controller_1.default[_0x391b6c(129)]();let panelWin=null,newVersionChecked=!1;function load(){const e=_0x391b6c;Editor[e(144)][e(135)](e(138),promptForUpdateIfNewVersionExists),electron_1.ipcMain.on(namespace_1.ns+e(139),hidePanel),electron_1[e(117)].on(namespace_1.ns+":get-version",getVersion_),controller[e(148)]()}function unload(){const e=_0x391b6c;Editor[e(144)][e(114)](e(138),promptForUpdateIfNewVersionExists),electron_1[e(117)][e(133)](namespace_1.ns+e(139),hidePanel),electron_1[e(117)][e(133)](namespace_1.ns+e(102),getVersion_),controller.uninit()}exports[_0x391b6c(109)]=load,exports[_0x391b6c(154)]=unload;let savedInfo=null;const methods={showPanel(){const e=_0x391b6c;panelWin?(panelWin[e(122)](),panelWin=null):Editor[e(121)][e(146)](namespace_1.ns),controller[e(127)]()},closePanel(){const e=_0x391b6c;Editor[e(121)][e(112)](namespace_1.ns),panelWin=null,controller.onClosePanel()},whetherClose:()=>windows._waitClosedMain,getSignInUrl:async()=>(await service_1[_0x391b6c(123)][_0x391b6c(129)]())[_0x391b6c(151)](),getRedirectUrl:async e=>(await service_1[_0x391b6c(123)].getInstance())[_0x391b6c(108)](e),updateToolbarMain(e,n){update_toolbar_1.updateToolbar(e,n)},saveToolbarInfo(e){savedInfo=e},getSavedToolbarInfo:()=>savedInfo};function hidePanel(e){const n=_0x391b6c;(panelWin=electron_1.BrowserWindow.fromWebContents(e[n(147)]))?(panelWin.hide(),controller[n(143)]()):console.error(n(126))}function getVersion_(e){e[_0x391b6c(105)]=getVersion()}function getVersion(){const e=_0x391b6c,n=Editor.Package[e(131)]({name:namespace_1.ns});return n[n[e(130)]-1][e(106)]}async function promptForUpdateIfNewVersionExists(){const e=_0x391b6c;if(newVersionChecked)return;newVersionChecked=!0;const n=await service_1[e(123)][e(129)](),o=await n[e(152)]();if(!o||!o.plugin_version||!o.plugin_url)return;const t=o[e(115)];if(!compare_versions_1[e(123)].validate(t))return;const r=getVersion();if(compare_versions_1[e(123)](t,r)<=0)return;const a=translate_1.tr(e(103))[e(116)]("_",t);1!==await dialog_1[e(113)](a,{title:translate_1.tr(e(118)),buttons:[translate_1.tr("ok"),translate_1.tr(e(145))],default:0,cancel:1})&&Editor[e(144)][e(111)](e(110),e(140),o[e(128)],namespace_1.ns,e(124))}exports[_0x391b6c(119)]=methods;