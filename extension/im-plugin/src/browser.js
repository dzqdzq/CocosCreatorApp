const _0x4fa3=["getLanguage","home","plugin_version","./constant/namespace","request","plugin_url","request-progress","fromWebContents","BrowserWindow","assign","lastErrorTime","cannot hide panel, panelWin is undefined","create","im-plugin.callback","compare-versions","[Im-plugin] Go back to old version.","[Im-plugin] No online info of im-plugin.","getTimezoneOffset","[Im-plugin] Im-plugin local version is ","extension-callback","Network","extension","I18n","broadcast","getInstance","default","_waitClosedMain","close","sender","join",":hide-panel","__importStar","path","log","version","onHidePanel","extensions","defineProperty","arch","length","im-plugin.IgnoreImVersion","getDate","Message","[Im-plugin] Remove your old im-plugin to ","getData","unload","[Im-plugin] The number of errors reached online on the day, 5 times.","pipe","ipcMain","./main-lib/controller",":get-version","__esModule","POST","queryIPList","getSignInUrl","copy","warn","reload","push","updateToolbar","im-plugin:check","enable","message","[Im-plugin] Im-plugin need not update.","setConfig","Package","[Im-plugin] Download im-plugin zip.","-error","[Im-plugin] Im-plugin online version is error, ","getImSetting","getTime","Update","./node_modules","paths","methods","remove","tmpdir","./main-lib/service","global","call","im-plugin","hostname","[Im-plugin] Unzip installation failed .","Profile","3.3.1","sumErrorTime","Project","hasOwnProperty","realpath","fs-extra","createWriteStream","@base/electron-windows","open","im-plugin.zip","[Im-plugin] The editor does not support automatic updates of versions below 3.3.1, and you need to download it manually from the store.","then","show","__createBinding"," failed.","error","./common-lib/update-toolbar","[Im-plugin] You need to update in panel due to you opening it.","plugin","getPackages","getConfig","App","Start","download-url","validate","removeListener","[Im-plugin] Im-plugin zip exists.","progreass","platform","download","emptyDir","type","getRedirectUrl","firstErrorTime","nickname","onClosePanel","import-package","load","name","Panel","[Im-plugin] Remove callback folder.","__importDefault","[Im-plugin] Go back ok.","init"];!function(e,o){!function(o){for(;--o;)e.push(e.shift())}(++o)}(_0x4fa3,481);const _0x2558=function(e,o){return _0x4fa3[e-=351]},_0x3ac6b9=_0x2558;var __createBinding=this&&this[_0x3ac6b9(351)]||(Object.create?function(e,o,n,t){void 0===t&&(t=n),Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[n]}})}:function(e,o,n,t){void 0===t&&(t=n),e[t]=o[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object[_0x3ac6b9(394)]?function(e,o){const n=_0x3ac6b9;Object[n(419)](e,n(407),{enumerable:!0,value:o})}:function(e,o){e.default=o}),__importStar=this&&this[_0x3ac6b9(413)]||function(e){const o=_0x3ac6b9;if(e&&e[o(433)])return e;var n={};if(null!=e)for(var t in e)o(407)!==t&&Object.prototype[o(469)][o(461)](e,t)&&__createBinding(n,e,t);return __setModuleDefault(n,e),n},__importDefault=this&&this[_0x3ac6b9(379)]||function(e){return e&&e.__esModule?e:{default:e}};Object[_0x3ac6b9(419)](exports,_0x3ac6b9(433),{value:!0}),exports[_0x3ac6b9(427)]=exports[_0x3ac6b9(375)]=exports[_0x3ac6b9(456)]=void 0;const os_1=__importDefault(require("os")),path_1=__importStar(require(_0x3ac6b9(414))),compare_versions_1=__importDefault(require(_0x3ac6b9(396))),electron_1=require("electron"),service_1=__importDefault(require(_0x3ac6b9(459))),namespace_1=require(_0x3ac6b9(385)),update_toolbar_1=require(_0x3ac6b9(354)),controller_1=__importDefault(require(_0x3ac6b9(431))),fs_1=require("fs"),requestProgress=require(_0x3ac6b9(388)),request=require("request");module[_0x3ac6b9(455)][_0x3ac6b9(440)](path_1[_0x3ac6b9(407)][_0x3ac6b9(411)](Editor[_0x3ac6b9(359)][_0x3ac6b9(414)],_0x3ac6b9(454)));const windows=require(_0x3ac6b9(473)),fse=require(_0x3ac6b9(471)),controller=controller_1[_0x3ac6b9(407)][_0x3ac6b9(406)]();let panelWin=null,newVersionChecked=!1;const reportOptions={url:"http://kibana-alihz.592you.com:8511",method:_0x3ac6b9(434),json:!0};async function commonFields(){const e=_0x3ac6b9,o=process.env,n=(new Date).toUTCString(),t=o.dashboard,r=await Editor[e(359)][e(416)],i=await Editor[e(404)][e(382)](),a=await Editor.User[e(426)]();return{appType:"secretary",time:n,dashBoardVersion:t,creatorVersion:r,locate:i,userData:a,nickName:a[e(372)],email:a.email,cocos_uid:a.cocos_uid,ips:await Editor[e(402)][e(435)](),osType:os_1[e(407)][e(369)](),osPlatform:os_1[e(407)][e(366)](),osHostname:os_1.default[e(463)](),osTmpdir:os_1[e(407)][e(458)](),osArch:os_1[e(407)][e(420)](),currentPjName:Editor[e(468)][e(376)]}}async function reportInformation(){const e=_0x3ac6b9,o=(new Date)[e(399)]()/60,n=getVersion(),{time:t,dashBoardVersion:r,creatorVersion:i,locate:a,userData:s,nickName:c,email:l,cocos_uid:u,ips:p,osType:m,osPlatform:d,osHostname:_,osTmpdir:g,osArch:f,currentPjName:b}=await commonFields(),h={timeZone:o,time:t,dashBoardVersion:r,creatorVersion:i,pluginVersion:n,locate:a,userData:s,nickName:c,email:l,cocos_uid:u,ips:p,osType:m,osPlatform:d,osHostname:_,osTmpdir:g,osArch:f,currentPjName:b,entryType:e(356),reportType:e(360)};request(Object[e(391)]({},reportOptions,{body:h}),()=>{})}async function updateReportInformation(e,o,n,t){const r=_0x3ac6b9,{time:i,dashBoardVersion:a,creatorVersion:s,locate:c,userData:l,nickName:u,email:p,cocos_uid:m,ips:d,osType:_,osPlatform:g,osHostname:f,osTmpdir:b,osArch:h,currentPjName:w}=await commonFields(),x={time:i,preVersion:e,newVersion:o,updateStatus:n,dashBoardVersion:a,creatorVersion:s,locate:c,userData:l,nickName:u,email:p,cocos_uid:m,ips:d,osType:_,osPlatform:g,osHostname:f,osTmpdir:b,osArch:h,currentPjName:w,reportType:r(453)};t&&Object.assign(x,{errorName:t[r(376)],errorMessage:t[r(444)]}),request(Object[r(391)]({},reportOptions,{body:x}),()=>{})}function load(){const e=_0x3ac6b9;electron_1[e(430)].on(namespace_1.ns+e(412),hidePanel),electron_1[e(430)].on(namespace_1.ns+e(432),getVersion_),controller[e(381)](),isVersionMore331()&&silentCheckAndUpdate(),reportInformation()}function unload(){const e=_0x3ac6b9;electron_1[e(430)][e(363)](namespace_1.ns+":hide-panel",hidePanel),electron_1[e(430)][e(363)](namespace_1.ns+e(432),getVersion_),controller.uninit()}exports[_0x3ac6b9(375)]=load,exports[_0x3ac6b9(427)]=unload;let savedInfo=null;const downloadZip=async(e,o)=>{await fse.ensureDir(path_1.dirname(o)),await new Promise((n,t)=>{const r=_0x2558;requestProgress(request(e),{delay:300}).on(r(365),function(e){}).on("error",function(e){t(e)}).on("end",function(e,o){n(null)})[r(429)](fs_1[r(472)](o))})},formatVersion=e=>e.replace(/\./g,"-"),isVersionMore331=()=>{const e=_0x3ac6b9,o=Editor[e(359)][e(416)];return!(compare_versions_1[e(407)](o,e(466))<=0&&(console[e(415)]("[Im-plugin] Im-plugin version <= 3.3.1, don't support hot patching."),1))},silentCheck=async()=>{const e=_0x3ac6b9;if(console[e(415)]("[Im-plugin] Check im-plugin version."),!isVersionMore331())return void console[e(438)](e(476));const o=await service_1[e(407)][e(406)](),n=await o[e(451)]();if(!n||!n[e(384)]||!n[e(387)])return void console[e(415)](e(398));const t=n[e(384)];if(!0===await Editor[e(465)][e(358)](e(422),formatVersion(t),e(460)))return void console[e(415)]("[Im-plugin] Im-plugin online version has something wrong, don't update.");const r=await Editor.Profile[e(358)](e(422),e(392),e(460));if((new Date)[e(452)]()-r<6e5)return;const i=getCurrentErrorTime(),a=await Editor[e(465)][e(358)](e(422),i,"global");if(parseInt(a)<=0)return void console[e(415)](e(428));if(!compare_versions_1[e(407)][e(362)](t))return void console[e(415)](e(450)+t+".");console.log("[Im-plugin] Im-plugin online version is "+t+".");const s=getVersion();if(console[e(415)](e(400)+s+"."),!(compare_versions_1[e(407)](t,s)<=0))return{imSetting:n,newVersion:t,curVersion:s};console.log(e(445))},unZipAndInstall=async(e,o)=>await new Promise(async n=>{const t=_0x3ac6b9;await Editor[t(424)][t(386)](t(403),t(374),t(460),e,{forceImport:!0})[t(477)](async()=>{const r=t;await fse[r(457)](e),await Editor[r(424)].request(r(403),r(443),o,!0),n(!0)}).catch(()=>{n(!1)})}),getCurrentErrorTime=()=>{const e=_0x3ac6b9,o=new Date;return o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o[e(423)]()+e(449)},silentCheckAndUpdate=async()=>{const e=_0x3ac6b9,o=await silentCheck();if(!o)return;const{imSetting:n,newVersion:t,curVersion:r}=o,i=path_1[e(411)](Editor[e(359)].home,e(401),e(395));console[e(415)](e(425)+i);let a=path_1[e(411)](Editor.App.home,e(418),e(462)),s=await Editor.Package[e(357)]({name:e(462),enable:!0});s[0]&&(a=s[0][e(414)]);const c=path_1[e(411)](Editor[e(359)][e(383)],e(418),e(462)),l=path_1[e(411)](Editor[e(359)][e(383)],e(367),e(475));try{await fse.copy(a,i)[e(477)](async()=>{const o=e;console.log("[Im-plugin] Remove Succeed.");let i=!0;if(await Editor[o(465)][o(358)](o(422),o(361),o(460))===n[o(387)])try{await fse[o(470)](l),console.log(o(364)),i=!1}catch(e){i=!0}if(await Editor.Profile[o(446)]("im-plugin.IgnoreImVersion",o(361),n[o(387)],o(460)),i&&(console[o(415)](o(448)),await downloadZip(n[o(387)],l)),await Editor.Panel.has(o(407)))console[o(415)](o(355));else{if(!await unZipAndInstall(l,c))throw new Error(o(464));updateReportInformation(r,t,!0,null)}})}catch(o){updateReportInformation(r,t,!1,o),console[e(353)]("[Im-plugin] Update "+t+e(352));const n=await Editor[e(465)][e(358)]("im-plugin.IgnoreImVersion",e(371),e(460));await Editor[e(465)][e(446)](e(422),e(392),(new Date)[e(452)](),e(460)),n||await Editor[e(465)].setConfig(e(422),e(371),(new Date).getTime(),e(460));const s=getCurrentErrorTime(),c=await Editor.Profile[e(358)]("im-plugin.IgnoreImVersion",s,e(460));c?await Editor.Profile[e(446)]("im-plugin.IgnoreImVersion",s,c-1,e(460)):await Editor.Profile.setConfig(e(422),s,4,e(460));const u=await Editor[e(465)][e(358)](e(422),"sumErrorTime",e(460));u?await Editor[e(465)].setConfig("im-plugin.IgnoreImVersion",e(467),u+1,e(460)):await Editor[e(465)][e(446)](e(422),"sumErrorTime",1,e(460));const p=(new Date)[e(452)]()-n>=2592e6;(u>=15||p)&&await Editor[e(465)][e(446)]("im-plugin.IgnoreImVersion",formatVersion(t),!0,e(460)),console[e(415)](e(397)+r),await fse[e(368)](a),await fse[e(437)](i,a).then(async()=>{const o=e;console[o(415)](o(380)),await Editor[o(424)].request(o(403),o(439),a)[o(477)](()=>{const e=o;fse[e(457)](i),fse[e(457)](l),console[e(415)](e(378))})})}},methods={showPanel(){const e=_0x3ac6b9;console[e(415)]("[im-plugin] Current version is "+getVersion()),panelWin?(panelWin[e(478)](),isVersionMore331()&&Editor[e(424)][e(405)](e(442)),panelWin=null):Editor.Panel[e(474)](namespace_1.ns),controller.onShowPanel()},silentCheckAndUpdate:silentCheckAndUpdate,silentCheck:silentCheck,unZipAndInstall:unZipAndInstall,closePanel(){const e=_0x3ac6b9;Editor[e(377)][e(409)](namespace_1.ns),panelWin=null,controller[e(373)]()},whetherClose:()=>windows[_0x3ac6b9(408)],getSignInUrl:async()=>(await service_1[_0x3ac6b9(407)].getInstance())[_0x3ac6b9(436)](),getRedirectUrl:async e=>(await service_1[_0x3ac6b9(407)][_0x3ac6b9(406)]())[_0x3ac6b9(370)](e),updateToolbarMain(e,o){update_toolbar_1[_0x3ac6b9(441)](e,o)},saveToolbarInfo(e){savedInfo=e},getSavedToolbarInfo:()=>savedInfo};function hidePanel(e){const o=_0x3ac6b9;(panelWin=electron_1[o(390)][o(389)](e[o(410)]))?(panelWin.hide(),controller[o(417)]()):console[o(353)](o(393))}function getVersion_(e){e.returnValue=getVersion()}function getVersion(){const e=_0x3ac6b9,o=Editor[e(447)][e(357)]({name:namespace_1.ns});return o[o[e(421)]-1][e(416)]}exports.methods=methods;