const _0x4a37=["setAttribute","isLoggedIn","../../common-lib/dialog","png","info-title","push","new-window","./host-api.js","ipcRenderer","update-toolbar","select-file","Message",":hide-panel","template","display","save-file","#webview","select-image",":close","path","close","__importDefault","is-ready","@editor/panel/lib/element","User","ready","filePath","preload","dirname","args","gif",":force-close-panel","webview","../../common-lib/translate","info","join","beforeClose","refresh","src","url","request","file-url","addEventListener","paths",":panel-ready","jpeg","close-panel","./node_modules","download","#loading-page","info-non-logged-in","electron","../../constant/namespace","default","./index.html","type","get-sign-in-url","move","App","channel","fileName","image","__esModule","newMsgCount",":panel-win-state-changed","image-filter-name","whether-close","file-selected","length","send","none","@base/electron-windows/package.json","readFileSync","style","./style.css","broadcast","file-filter-name","openExternal"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x4a37,398);const _0x1acf=function(e,t){return _0x4a37[e-=360]},_0x563832=_0x1acf;var __importDefault=this&&this[_0x563832(373)]||function(e){return e&&e[_0x563832(414)]?e:{default:e}};Object.defineProperty(exports,_0x563832(414),{value:!0}),exports[_0x563832(372)]=exports[_0x563832(388)]=exports[_0x563832(377)]=exports.$=exports[_0x563832(425)]=exports.template=void 0;const path_1=__importDefault(require(_0x563832(371))),fs_1=__importDefault(require("fs")),electron_1=require(_0x563832(403)),download_1=__importDefault(require(_0x563832(400))),file_url_1=__importDefault(require(_0x563832(393))),translate_1=require(_0x563832(385)),dialog_1=require(_0x563832(432)),namespace_1=require(_0x563832(404));module[_0x563832(395)][_0x563832(435)](path_1[_0x563832(405)].join(Editor[_0x563832(410)][_0x563832(371)],_0x563832(399)));const element=require(_0x563832(375)),windowsPkg=require(_0x563832(423)),ipcFlag=windowsPkg.name+"@"+windowsPkg.version;let forceClose=!1;const template=fs_1.default[_0x563832(424)](path_1[_0x563832(405)][_0x563832(387)](__dirname,_0x563832(406)),"utf8");exports[_0x563832(365)]=template;const style=fs_1[_0x563832(405)][_0x563832(424)](path_1[_0x563832(405)].join(__dirname,_0x563832(426)),"utf8");exports[_0x563832(425)]=style;const selector={webview:_0x563832(368),loadingPage:_0x563832(401)};exports.$=selector;let action=_0x563832(389);async function ready(){const e=_0x563832;if(forceClose=!1,Editor[e(363)].addBroadcastListener(namespace_1.ns+e(383),forceClosePanel),!await Editor[e(376)][e(431)]())return await dialog_1[e(386)](translate_1.tr(e(402)),{title:translate_1.tr("info-title"),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(363)].broadcast(namespace_1.ns+":force-close-panel");this.$[e(384)][e(430)](e(379),file_url_1[e(405)](path_1[e(405)][e(387)](__dirname,e(437)))),this.$[e(384)][e(394)]("ipc-message",t=>{const a=e;onIpcMessage(t,this.$[a(384)],this.$.loadingPage)});const t=await Editor[e(363)][e(392)](namespace_1.ns,e(408));if(!t)return dialog_1[e(386)](translate_1.tr("get-sign-in-url-failed"),{title:translate_1.tr(e(434))}),void Editor[e(363)][e(427)](namespace_1.ns+":force-close-panel");this.$[e(384)][e(390)]=t,this.$[e(384)].addEventListener(e(436),async t=>{const a=e;electron_1.shell[a(429)](await Editor[a(363)].request(namespace_1.ns,"get-redirect-url",t[a(391)]))}),electron_1[e(360)].on(ipcFlag+e(370),()=>{action=e(372)}),electron_1[e(360)].on(namespace_1.ns+e(416),(t,a)=>{const n=e;try{this.$[n(384)][n(421)](namespace_1.ns+":panel-win-state-changed",a)}catch(e){}}),electron_1.ipcRenderer[e(421)](namespace_1.ns+e(396))}async function beforeClose(e={}){const t=_0x563832;if(forceClose||e[t(409)]||element.panels&&element.panels[t(420)]>1)return!0;if("refresh"===action)return!0;action=t(389);try{return!!await Editor[t(363)][t(392)](namespace_1.ns,t(418))||(electron_1[t(360)][t(421)](namespace_1.ns+t(364)),!1)}catch(e){return!0}}function close(){Editor.Message.removeBroadcastListener(namespace_1.ns+":force-close-panel",forceClosePanel)}function onIpcMessage(e,t,a){const n=_0x563832;switch(e[n(411)]){case"new-msg":Editor[n(363)][n(421)](namespace_1.ns,n(361),{newMsgCount:e[n(381)][0][n(415)]});break;case n(374):a[n(425)][n(366)]=n(422);break;case n(400):!async function(){const t=n,a=e.args[0][t(407)],s=e[t(381)][0][t(412)];let r=null;r="image"===a?{title:translate_1.tr("save-image"),path:s,filters:[{name:translate_1.tr(t(417)),extensions:["jpg",t(397),t(433),t(382)]}]}:{title:translate_1.tr(t(367)),path:s,filters:[{name:translate_1.tr(t(428)),extensions:["*"]}]};const o=await dialog_1.save(r);if(!o.filePath)return;const i=e.args[0][t(391)],l=path_1[t(405)][t(380)](o[t(378)]);download_1[t(405)](i,l,{filename:path_1[t(405)].basename(o[t(378)])})}();break;case n(362):!async function(){const a=n,s=await function(){const t=_0x1acf;let a;return a=t(413)===e[t(381)][0][t(407)]?{title:translate_1.tr(t(369)),filters:[{name:translate_1.tr(t(417)),extensions:["jpg","jpeg",t(433),t(382)]}]}:{title:translate_1.tr(t(362)),filters:[{name:translate_1.tr(t(428)),extensions:["*"]}]},dialog_1.select(a)}();s.canceled?t[a(421)](a(419),""):t[a(421)](a(419),s.filePaths[0])}()}}function forceClosePanel(){const e=_0x563832;forceClose=!0,Editor.Message.send(namespace_1.ns,e(398))}exports[_0x563832(377)]=ready,exports[_0x563832(388)]=beforeClose,exports.close=close;