const _0x2289=["ipc-message","App","percent","new-msg","webview","select-file","download-progress","shell","refresh","removeBroadcastListener","whether-close","updateBtn","none","select-image","openExternal","../../constant/namespace","paths","Panel","contextIsolation=false","basename","total","./index.html","move","electron","addEventListener","ready","methods","filePaths",":panel-win-state-changed","png",":force-close-panel","jpeg","preload","webpreferences","jpg","#btn-4","dirname","download-succeeded","readFileSync","update-btn","setAttribute","isLoggedIn","default","get-redirect-url","filePath","./node_modules","channel","info-non-logged-in","name","callId","path","dom-ready","removeEventListener","@editor/panel/lib/element","gif","defineProperty","join","broadcast","save-image","close-panel","addBroadcastListener","close","args",":close","image-filter-name","beforeClose","display","select","click","version","new-window","style","User","panels","toString",":hide-panel","innerText","type","Message","send","file-filter-name","info","image","template","info-title","__esModule","file-selected","request","src","../../common-lib/dialog","./style.css","url","is-ready","download-canceled","file-url","ipcRenderer","__importDefault","download-with-progress","block",":panel-ready"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x2289,272);const _0x5500=function(e,t){return _0x2289[e-=100]},_0x16ea89=_0x5500;var __importDefault=this&&this[_0x16ea89(124)]||function(e){return e&&e[_0x16ea89(113)]?e:{default:e}};Object[_0x16ea89(183)](exports,"__esModule",{value:!0}),exports[_0x16ea89(154)]=exports[_0x16ea89(189)]=exports[_0x16ea89(193)]=exports.ready=exports.$=exports.style=exports[_0x16ea89(111)]=void 0;const path_1=__importDefault(require(_0x16ea89(178))),fs_1=__importDefault(require("fs")),electron_1=require(_0x16ea89(151)),download_1=__importDefault(require("download")),file_url_1=__importDefault(require(_0x16ea89(122))),translate_1=require("../../common-lib/translate"),dialog_1=require(_0x16ea89(117)),namespace_1=require(_0x16ea89(143));module[_0x16ea89(144)].push(path_1[_0x16ea89(170)][_0x16ea89(184)](Editor[_0x16ea89(129)][_0x16ea89(178)],_0x16ea89(173)));const element=require(_0x16ea89(181)),windowsPkg=require("@base/electron-windows/package.json"),ipcFlag=windowsPkg[_0x16ea89(176)]+"@"+windowsPkg[_0x16ea89(197)];let forceClose=!1;const template=fs_1[_0x16ea89(170)].readFileSync(path_1[_0x16ea89(170)][_0x16ea89(184)](__dirname,_0x16ea89(149)),"utf8");exports.template=template;const style=fs_1[_0x16ea89(170)][_0x16ea89(166)](path_1[_0x16ea89(170)].join(__dirname,_0x16ea89(118)),"utf8");exports.style=style;const selector={webview:"#webview",loadingPage:"#loading-page",updateBtn:_0x16ea89(163)};exports.$=selector;let action="refresh";async function controlUpdateBtn(e){const t=_0x16ea89;await Editor[t(106)].request("im-plugin","silent-check")?(e.$[t(139)][t(199)][t(194)]=t(126),e.$[t(139)][t(104)]=translate_1.tr(t(167))||"update",e.$.updateBtn[t(152)](t(196),async()=>{const e=t;Editor[e(106)][e(107)]("im-plugin","silent-check-and-update")})):(e.$[t(139)][t(199)].display=t(140),e.$[t(139)][t(180)]("click",()=>{}))}let that=null;async function ready(){const e=_0x16ea89;if(that=this,await controlUpdateBtn(that),forceClose=!1,Editor[e(145)].kitControl,Editor.Message[e(188)](namespace_1.ns+e(158),forceClosePanel),!await Editor[e(100)][e(169)]())return await dialog_1[e(109)](translate_1.tr(e(175)),{title:translate_1.tr("info-title"),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(106)][e(185)](namespace_1.ns+e(158));this.$[e(132)][e(152)]("dom-ready",()=>{const t=e;Editor.Message[t(107)](namespace_1.ns,t(179))}),this.$[e(132)][e(168)](e(161),e(146)),this.$[e(132)][e(168)](e(160),file_url_1.default(path_1[e(170)][e(184)](__dirname,"./host-api.js"))),this.$[e(132)][e(152)](e(128),t=>{const a=e;onIpcMessage(t,this.$[a(132)],this.$.loadingPage)});const t=await Editor[e(106)].request(namespace_1.ns,"get-sign-in-url");if(!t)return dialog_1[e(109)](translate_1.tr("get-sign-in-url-failed"),{title:translate_1.tr(e(112))}),void Editor.Message[e(185)](namespace_1.ns+":force-close-panel");this.$[e(132)][e(116)]=t,this.$[e(132)][e(152)](e(198),async t=>{const a=e;electron_1[a(135)][a(142)](await Editor[a(106)][a(115)](namespace_1.ns,a(171),t.url))}),electron_1[e(123)].on(ipcFlag+e(191),()=>{action=e(189)}),electron_1[e(123)].on(namespace_1.ns+e(156),(t,a)=>{const n=e;try{this.$[n(132)][n(107)](namespace_1.ns+n(156),a)}catch(e){}}),electron_1[e(123)][e(107)](namespace_1.ns+e(127))}async function beforeClose(e={}){const t=_0x16ea89;if(forceClose||e[t(150)]||element[t(101)]&&element[t(101)].length>1)return!0;if(t(136)===action)return!0;action=t(136);try{return!!await Editor[t(106)][t(115)](namespace_1.ns,t(138))||(electron_1.ipcRenderer[t(107)](namespace_1.ns+t(103)),!1)}catch(e){return!0}}function close(){const e=_0x16ea89;Editor[e(106)][e(137)](namespace_1.ns+e(158),forceClosePanel)}function onIpcMessage(e,t,a){const n=_0x16ea89;async function s(a){const n=_0x5500,s=e.args[0][n(105)],o=e[n(190)][0].fileName;let r=null;r="image"===s?{title:translate_1.tr(n(186)),path:o,filters:[{name:translate_1.tr(n(192)),extensions:[n(162),n(159),n(157),n(182)]}]}:{title:translate_1.tr("save-file"),path:o,filters:[{name:translate_1.tr(n(108)),extensions:["*"]}]};const l=await dialog_1.save(r);if(!l[n(172)])return void(a&&t[n(107)](n(121),e[n(190)][0][n(177)]));const i=e[n(190)][0][n(119)],c=path_1[n(170)][n(164)](l[n(172)]),d=download_1[n(170)](i,c,{filename:path_1.default[n(147)](l[n(172)])});if(a){d.on("downloadProgress",a=>{const s=n;t[s(107)](s(134),{callId:e.args[0][s(177)],percent:a[s(130)],transferred:a.transferred,total:a[s(148)]})});try{await d,t[n(107)](n(165),e[n(190)][0][n(177)])}catch(a){t[n(107)]("download-failed",{callId:e[n(190)][0][n(177)],errorStr:a[n(102)]()})}}}switch(e[n(174)]){case n(131):Editor[n(106)][n(107)](namespace_1.ns,"update-toolbar",{newMsgCount:e.args[0].newMsgCount});break;case n(120):a.style.display="none";break;case"download":s(!1);break;case"select-file":!async function(){const a=n,s=await function(){const t=_0x5500;let a;return a=t(110)===e[t(190)][0][t(105)]?{title:translate_1.tr(t(141)),filters:[{name:translate_1.tr("image-filter-name"),extensions:[t(162),t(159),"png","gif"]}]}:{title:translate_1.tr(t(133)),filters:[{name:translate_1.tr(t(108)),extensions:["*"]}]},dialog_1[t(195)](a)}();s.canceled?t.send("file-selected",""):t[a(107)](a(114),s[a(155)][0])}();break;case n(125):s(!0)}}function forceClosePanel(){const e=_0x16ea89;forceClose=!0,Editor[e(106)].send(namespace_1.ns,e(187))}exports[_0x16ea89(153)]=ready,exports.beforeClose=beforeClose,exports[_0x16ea89(189)]=close;const methods={async check(){that&&await controlUpdateBtn(that)}};exports[_0x16ea89(154)]=methods;