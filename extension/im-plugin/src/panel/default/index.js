const _0x16d0=["../../constant/namespace","loadingPage","preload","ready","ipcRenderer","new-window","removeBroadcastListener","defineProperty","basename","style","jpg","User","gif","jpeg",":hide-panel","#loading-page","get-sign-in-url-failed","refresh","info-title","info",":close","url","file-url","Message","total","callId","image","whether-close","select","update-toolbar","./node_modules","send","@base/electron-windows/package.json","./host-api.js","get-redirect-url","download-failed","canceled","name","select-image","beforeClose","filePath","template","get-sign-in-url","args","broadcast","save","readFileSync","image-filter-name","newMsgCount","download-with-progress","move","close","type","dirname","info-non-logged-in","#webview","channel","close-panel","select-file","file-filter-name","default","toString","./index.html","__esModule","@editor/panel/lib/element","addEventListener","__importDefault","openExternal","utf8",":panel-win-state-changed","save-file","../../common-lib/translate","download-succeeded","webview","addBroadcastListener","fileName","dom-ready",":force-close-panel","png","push","path","setAttribute","../../common-lib/dialog","join","src","electron","panels","file-selected"];!function(e,a){!function(a){for(;--a;)e.push(e.shift())}(++a)}(_0x16d0,135);const _0x157d=function(e,a){return _0x16d0[e-=144]},_0x76a82d=_0x157d;var __importDefault=this&&this[_0x76a82d(163)]||function(e){return e&&e[_0x76a82d(160)]?e:{default:e}};Object[_0x76a82d(192)](exports,_0x76a82d(160),{value:!0}),exports[_0x76a82d(148)]=exports[_0x76a82d(224)]=exports[_0x76a82d(188)]=exports.$=exports.style=exports[_0x76a82d(226)]=void 0;const path_1=__importDefault(require(_0x76a82d(177))),fs_1=__importDefault(require("fs")),electron_1=require(_0x76a82d(182)),download_1=__importDefault(require("download")),file_url_1=__importDefault(require(_0x76a82d(207))),translate_1=require(_0x76a82d(168)),dialog_1=require(_0x76a82d(179)),namespace_1=require(_0x76a82d(185));module.paths[_0x76a82d(176)](path_1[_0x76a82d(157)][_0x76a82d(180)](Editor.App[_0x76a82d(177)],_0x76a82d(215)));const element=require(_0x76a82d(161)),windowsPkg=require(_0x76a82d(217)),ipcFlag=windowsPkg[_0x76a82d(222)]+"@"+windowsPkg.version;let forceClose=!1;const template=fs_1.default[_0x76a82d(231)](path_1[_0x76a82d(157)][_0x76a82d(180)](__dirname,_0x76a82d(159)),_0x76a82d(165));exports[_0x76a82d(226)]=template;const style=fs_1.default.readFileSync(path_1[_0x76a82d(157)][_0x76a82d(180)](__dirname,"./style.css"),_0x76a82d(165));exports.style=style;const selector={webview:_0x76a82d(152),loadingPage:_0x76a82d(200)};exports.$=selector;let action=_0x76a82d(202);async function ready(){const e=_0x76a82d;if(forceClose=!1,Editor[e(208)][e(171)](namespace_1.ns+e(174),forceClosePanel),!await Editor[e(196)].isLoggedIn())return await dialog_1[e(204)](translate_1.tr(e(151)),{title:translate_1.tr(e(203)),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(208)][e(229)](namespace_1.ns+":force-close-panel");this.$[e(170)].addEventListener(e(173),()=>{const a=e;Editor.Message.send(namespace_1.ns,a(173))}),this.$[e(170)][e(178)](e(187),file_url_1[e(157)](path_1.default[e(180)](__dirname,e(218)))),this.$[e(170)][e(162)]("ipc-message",a=>{const t=e;onIpcMessage(a,this.$[t(170)],this.$[t(186)])});const a=await Editor[e(208)].request(namespace_1.ns,e(227));if(!a)return dialog_1[e(204)](translate_1.tr(e(201)),{title:translate_1.tr(e(203))}),void Editor[e(208)][e(229)](namespace_1.ns+e(174));this.$[e(170)][e(181)]=a,this.$[e(170)][e(162)](e(190),async a=>{const t=e;electron_1.shell[t(164)](await Editor[t(208)].request(namespace_1.ns,t(219),a[t(206)]))}),electron_1[e(189)].on(ipcFlag+e(205),()=>{action="close"}),electron_1[e(189)].on(namespace_1.ns+e(166),(a,t)=>{const n=e;try{this.$[n(170)][n(216)](namespace_1.ns+":panel-win-state-changed",t)}catch(e){}}),electron_1[e(189)][e(216)](namespace_1.ns+":panel-ready")}async function beforeClose(e={}){const a=_0x76a82d;if(forceClose||e[a(147)]||element.panels&&element[a(183)].length>1)return!0;if(a(202)===action)return!0;action=a(202);try{return!!await Editor[a(208)].request(namespace_1.ns,a(212))||(electron_1[a(189)][a(216)](namespace_1.ns+a(199)),!1)}catch(e){return!0}}function close(){const e=_0x76a82d;Editor[e(208)][e(191)](namespace_1.ns+e(174),forceClosePanel)}function onIpcMessage(e,a,t){const n=_0x76a82d;async function s(t){const n=_0x157d,s=e.args[0][n(149)],r=e[n(228)][0][n(172)];let o=null;o=n(211)===s?{title:translate_1.tr("save-image"),path:r,filters:[{name:translate_1.tr(n(144)),extensions:[n(195),n(198),n(175),n(197)]}]}:{title:translate_1.tr(n(167)),path:r,filters:[{name:translate_1.tr(n(156)),extensions:["*"]}]};const l=await dialog_1[n(230)](o);if(!l[n(225)])return void(t&&a[n(216)]("download-canceled",e[n(228)][0][n(210)]));const i=e.args[0].url,d=path_1[n(157)][n(150)](l[n(225)]),c=download_1[n(157)](i,d,{filename:path_1[n(157)][n(193)](l[n(225)])});if(t){c.on("downloadProgress",t=>{const s=n;a[s(216)]("download-progress",{callId:e.args[0][s(210)],percent:t.percent,transferred:t.transferred,total:t[s(209)]})});try{await c,a.send(n(169),e.args[0][n(210)])}catch(t){a[n(216)](n(220),{callId:e[n(228)][0].callId,errorStr:t[n(158)]()})}}}switch(e[n(153)]){case"new-msg":Editor[n(208)][n(216)](namespace_1.ns,n(214),{newMsgCount:e.args[0][n(145)]});break;case"is-ready":t[n(194)].display="none";break;case"download":s(!1);break;case n(155):!async function(){const t=n,s=await function(){const a=_0x157d;let t;return t="image"===e[a(228)][0][a(149)]?{title:translate_1.tr(a(223)),filters:[{name:translate_1.tr(a(144)),extensions:[a(195),a(198),"png",a(197)]}]}:{title:translate_1.tr(a(155)),filters:[{name:translate_1.tr(a(156)),extensions:["*"]}]},dialog_1[a(213)](t)}();s[t(221)]?a[t(216)]("file-selected",""):a[t(216)](t(184),s.filePaths[0])}();break;case n(146):s(!0)}}function forceClosePanel(){const e=_0x76a82d;forceClose=!0,Editor[e(208)][e(216)](namespace_1.ns,e(154))}exports[_0x76a82d(188)]=ready,exports[_0x76a82d(224)]=beforeClose,exports[_0x76a82d(148)]=close;