const _0x2d1d=["jpeg","setAttribute","click","join","User","is-ready","toString","block","push","transferred","gif","image-filter-name","fileName","innerText","updateBtn","ready","../../constant/namespace","percent","select-image","canceled","request-data",":force-close-panel","file-url","type","request","electron","Panel","select",":panel-ready","info-title","url","./style.css","silent-check","info","download-failed","length","select-file","file-selected","ipc-message","image","shell","methods",":hide-panel","get-redirect-url","@editor/panel/lib/element","removeEventListener","#btn-4",":panel-win-state-changed","display","./node_modules","Message","whether-close","move","readFileSync","filePath","close-panel","get-sign-in-url","addEventListener","isLoggedIn","name","save-file","kitControl","style","close","__esModule","App","total","contextIsolation=false","utf8","args","webview","send","default","none","template","beforeClose","jpg","defineProperty","file-filter-name","update-toolbar","update","download-canceled","preload","__importDefault","removeBroadcastListener","downloadProgress","addBroadcastListener","download","download-succeeded","ipcRenderer","version","info-non-logged-in","save-image","refresh","dom-ready","im-plugin","@base/electron-windows/package.json","update-btn","broadcast","get-sign-in-url-failed","../../common-lib/dialog","paths","download-with-progress","newMsgCount","filePaths","callId","src","png"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x2d1d,221);const _0x2b44=function(e,t){return _0x2d1d[e-=203]},_0x4922e=_0x2b44;var __importDefault=this&&this[_0x4922e(281)]||function(e){return e&&e.__esModule?e:{default:e}};Object[_0x4922e(275)](exports,_0x4922e(262),{value:!0}),exports[_0x4922e(239)]=exports[_0x4922e(261)]=exports[_0x4922e(273)]=exports[_0x4922e(213)]=exports.$=exports[_0x4922e(260)]=exports[_0x4922e(272)]=void 0;const path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),electron_1=require(_0x4922e(223)),download_1=__importDefault(require(_0x4922e(285))),file_url_1=__importDefault(require(_0x4922e(220))),translate_1=require("../../common-lib/translate"),dialog_1=require(_0x4922e(298)),namespace_1=require(_0x4922e(214));module[_0x4922e(299)][_0x4922e(206)](path_1.default[_0x4922e(309)](Editor[_0x4922e(263)].path,_0x4922e(247)));const element=require(_0x4922e(242)),windowsPkg=require(_0x4922e(294)),ipcFlag=windowsPkg[_0x4922e(257)]+"@"+windowsPkg[_0x4922e(288)];let forceClose=!1;const template=fs_1[_0x4922e(270)][_0x4922e(251)](path_1[_0x4922e(270)][_0x4922e(309)](__dirname,"./index.html"),_0x4922e(266));exports.template=template;const style=fs_1.default[_0x4922e(251)](path_1[_0x4922e(270)][_0x4922e(309)](__dirname,_0x4922e(229)),_0x4922e(266));exports[_0x4922e(260)]=style;const selector={webview:"#webview",loadingPage:"#loading-page",updateBtn:_0x4922e(244)};exports.$=selector;let action="refresh";async function controlUpdateBtn(e){const t=_0x4922e;await Editor[t(248)][t(222)](t(293),t(230))?(e.$[t(212)][t(260)][t(246)]=t(205),e.$[t(212)][t(211)]=translate_1.tr(t(295))||t(278),e.$[t(212)][t(255)]("click",async()=>{const a=t;e.$[a(212)][a(260)].display="none",Editor[a(248)][a(269)](a(293),"silent-check-and-update")})):(e.$[t(212)][t(260)].display=t(271),e.$[t(212)][t(243)](t(308),()=>{}))}let that=null;async function ready(){const e=_0x4922e;if(that=this,await controlUpdateBtn(that),forceClose=!1,Editor[e(224)][e(259)],Editor[e(248)][e(284)](namespace_1.ns+e(219),forceClosePanel),!await Editor[e(310)][e(256)]())return await dialog_1[e(231)](translate_1.tr(e(289)),{title:translate_1.tr(e(227)),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(248)][e(296)](namespace_1.ns+e(219));this.$[e(268)].addEventListener("dom-ready",()=>{const t=e;Editor[t(248)][t(269)](namespace_1.ns,t(292))}),this.$[e(268)][e(307)]("webpreferences",e(265)),this.$[e(268)][e(307)](e(280),file_url_1[e(270)](path_1[e(270)][e(309)](__dirname,"./host-api.js"))),this.$[e(268)][e(255)](e(236),t=>{const a=e;onIpcMessage(t,this.$[a(268)],this.$.loadingPage)});const t=await Editor[e(248)][e(222)](namespace_1.ns,e(254));if(!t)return dialog_1[e(231)](translate_1.tr(e(297)),{title:translate_1.tr(e(227))}),void Editor[e(248)][e(296)](namespace_1.ns+e(219));this.$[e(268)][e(304)]=t,this.$.webview.addEventListener("new-window",async t=>{const a=e;electron_1[a(238)].openExternal(await Editor[a(248)][a(222)](namespace_1.ns,a(241),t[a(228)]))}),electron_1.ipcRenderer.on(ipcFlag+":close",()=>{action=e(261)}),electron_1[e(287)].on(namespace_1.ns+e(245),(t,a)=>{const n=e;try{this.$[n(268)][n(269)](namespace_1.ns+":panel-win-state-changed",a)}catch(e){}}),electron_1[e(287)][e(269)](namespace_1.ns+e(226))}async function beforeClose(e={}){const t=_0x4922e;if(forceClose||e[t(250)]||element.panels&&element.panels[t(233)]>1)return!0;if(t(291)===action)return!0;action=t(291);try{return!!await Editor[t(248)][t(222)](namespace_1.ns,t(249))||(electron_1[t(287)][t(269)](namespace_1.ns+t(240)),!1)}catch(e){return!0}}function close(){const e=_0x4922e;Editor[e(248)][e(282)](namespace_1.ns+e(219),forceClosePanel)}function onIpcMessage(e,t,a){const n=_0x4922e;async function s(a){const n=_0x2b44,s=e[n(267)][0][n(221)],r=e[n(267)][0][n(210)];let o=null;o="image"===s?{title:translate_1.tr(n(290)),path:r,filters:[{name:translate_1.tr(n(209)),extensions:[n(274),n(306),n(305),n(208)]}]}:{title:translate_1.tr(n(258)),path:r,filters:[{name:translate_1.tr("file-filter-name"),extensions:["*"]}]};const i=await dialog_1.save(o);if(!i[n(252)])return void(a&&t[n(269)](n(279),e[n(267)][0][n(303)]));const l=e.args[0][n(228)],c=path_1.default.dirname(i[n(252)]),d=download_1.default(l,c,{filename:path_1.default.basename(i[n(252)])});if(a){d.on(n(283),a=>{const s=n;t[s(269)]("download-progress",{callId:e[s(267)][0][s(303)],percent:a[s(215)],transferred:a[s(207)],total:a[s(264)]})});try{await d,t[n(269)](n(286),e.args[0][n(303)])}catch(a){t[n(269)](n(232),{callId:e.args[0][n(303)],errorStr:a[n(204)]()})}}}switch(e.channel){case"new-msg":Editor.Message.send(namespace_1.ns,n(277),{newMsgCount:e[n(267)][0][n(301)]});break;case n(203):a.style[n(246)]=n(271);break;case n(285):s(!1);break;case n(234):!async function(){const a=n,s=await function(){const t=_0x2b44;let a;return a=t(237)===e[t(267)][0].type?{title:translate_1.tr(t(216)),filters:[{name:translate_1.tr(t(209)),extensions:[t(274),t(306),t(305),"gif"]}]}:{title:translate_1.tr(t(234)),filters:[{name:translate_1.tr(t(276)),extensions:["*"]}]},dialog_1[t(225)](a)}();s[a(217)]?t[a(269)](a(235),""):t[a(269)](a(235),s[a(302)][0])}();break;case n(300):s(!0);break;case n(218):!async function(){}()}}function forceClosePanel(){const e=_0x4922e;forceClose=!0,Editor.Message[e(269)](namespace_1.ns,e(253))}exports[_0x4922e(213)]=ready,exports[_0x4922e(273)]=beforeClose,exports[_0x4922e(261)]=close;const methods={async check(){that&&await controlUpdateBtn(that)}};exports[_0x4922e(239)]=methods;