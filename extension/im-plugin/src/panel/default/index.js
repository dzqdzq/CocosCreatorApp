const _0x21ab=["fileName","download-with-progress","push","newMsgCount","info-non-logged-in","png","type","ready","User","image","preload","utf8","get-sign-in-url-failed","version","addEventListener","image-filter-name","close","download-failed","openExternal",":hide-panel","../../constant/namespace","./host-api.js","loadingPage","request","move","electron","download-canceled","transferred","@editor/panel/lib/element","default","select-file","../../common-lib/translate","__importDefault","defineProperty","file-selected","url","gif","../../common-lib/dialog","shell","#webview",":panel-ready","callId","src","close-panel",":close","is-ready","style","isLoggedIn","basename","__esModule",":panel-win-state-changed","jpeg","panels","canceled","name","downloadProgress","ipcRenderer","args","setAttribute","App","readFileSync","get-redirect-url","new-window","percent","send","#loading-page","paths","dom-ready","new-msg","toString","save-file","./index.html","save","template","refresh","info-title","jpg",":force-close-panel","webview","contextIsolation=false","whether-close","Message","display","webpreferences","filePath","removeBroadcastListener","info","ipc-message","join","update-toolbar","select","./node_modules","file-filter-name","beforeClose"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x21ab,254);const _0x310e=function(e,t){return _0x21ab[e-=287]},_0x56535f=_0x310e;var __importDefault=this&&this[_0x56535f(347)]||function(e){return e&&e.__esModule?e:{default:e}};Object[_0x56535f(348)](exports,_0x56535f(364),{value:!0}),exports[_0x56535f(331)]=exports[_0x56535f(314)]=exports[_0x56535f(322)]=exports.$=exports[_0x56535f(361)]=exports[_0x56535f(294)]=void 0;const path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),electron_1=require(_0x56535f(340)),download_1=__importDefault(require("download")),file_url_1=__importDefault(require("file-url")),translate_1=require(_0x56535f(346)),dialog_1=require(_0x56535f(352)),namespace_1=require(_0x56535f(335));module[_0x56535f(287)][_0x56535f(317)](path_1[_0x56535f(344)][_0x56535f(309)](Editor[_0x56535f(374)].path,_0x56535f(312)));const element=require(_0x56535f(343)),windowsPkg=require("@base/electron-windows/package.json"),ipcFlag=windowsPkg[_0x56535f(369)]+"@"+windowsPkg[_0x56535f(328)];let forceClose=!1;const template=fs_1[_0x56535f(344)][_0x56535f(375)](path_1[_0x56535f(344)][_0x56535f(309)](__dirname,_0x56535f(292)),_0x56535f(326));exports[_0x56535f(294)]=template;const style=fs_1[_0x56535f(344)][_0x56535f(375)](path_1.default[_0x56535f(309)](__dirname,"./style.css"),"utf8");exports.style=style;const selector={webview:_0x56535f(354),loadingPage:_0x56535f(380)};exports.$=selector;let action=_0x56535f(295);async function ready(){const e=_0x56535f;if(forceClose=!1,Editor[e(302)].addBroadcastListener(namespace_1.ns+":force-close-panel",forceClosePanel),!await Editor[e(323)][e(362)]())return await dialog_1.info(translate_1.tr(e(319)),{title:translate_1.tr(e(296)),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(302)].broadcast(namespace_1.ns+e(298));this.$[e(299)][e(329)]("dom-ready",()=>{const t=e;Editor[t(302)][t(379)](namespace_1.ns,t(288))}),this.$[e(299)][e(373)](e(304),e(300)),this.$[e(299)][e(373)](e(325),file_url_1.default(path_1[e(344)][e(309)](__dirname,e(336)))),this.$.webview[e(329)](e(308),t=>{const a=e;onIpcMessage(t,this.$.webview,this.$[a(337)])});const t=await Editor.Message[e(338)](namespace_1.ns,"get-sign-in-url");if(!t)return dialog_1[e(307)](translate_1.tr(e(327)),{title:translate_1.tr(e(296))}),void Editor[e(302)].broadcast(namespace_1.ns+":force-close-panel");this.$[e(299)][e(357)]=t,this.$[e(299)][e(329)](e(377),async t=>{const a=e;electron_1[a(353)][a(333)](await Editor[a(302)][a(338)](namespace_1.ns,a(376),t[a(350)]))}),electron_1.ipcRenderer.on(ipcFlag+e(359),()=>{action=e(331)}),electron_1[e(371)].on(namespace_1.ns+e(365),(t,a)=>{const n=e;try{this.$[n(299)].send(namespace_1.ns+n(365),a)}catch(e){}}),electron_1[e(371)][e(379)](namespace_1.ns+e(355))}async function beforeClose(e={}){const t=_0x56535f;if(forceClose||e[t(339)]||element[t(367)]&&element[t(367)].length>1)return!0;if(t(295)===action)return!0;action="refresh";try{return!!await Editor.Message.request(namespace_1.ns,t(301))||(electron_1[t(371)].send(namespace_1.ns+t(334)),!1)}catch(e){return!0}}function close(){const e=_0x56535f;Editor[e(302)][e(306)](namespace_1.ns+e(298),forceClosePanel)}function onIpcMessage(e,t,a){const n=_0x56535f;async function s(a){const n=_0x310e,s=e.args[0][n(321)],r=e[n(372)][0][n(315)];let o=null;o=n(324)===s?{title:translate_1.tr("save-image"),path:r,filters:[{name:translate_1.tr(n(330)),extensions:[n(297),n(366),n(320),n(351)]}]}:{title:translate_1.tr(n(291)),path:r,filters:[{name:translate_1.tr(n(313)),extensions:["*"]}]};const l=await dialog_1[n(293)](o);if(!l[n(305)])return void(a&&t[n(379)](n(341),e[n(372)][0][n(356)]));const i=e[n(372)][0][n(350)],c=path_1[n(344)].dirname(l.filePath),_=download_1.default(i,c,{filename:path_1[n(344)][n(363)](l[n(305)])});if(a){_.on(n(370),a=>{const s=n;t[s(379)]("download-progress",{callId:e[s(372)][0].callId,percent:a[s(378)],transferred:a[s(342)],total:a.total})});try{await _,t[n(379)]("download-succeeded",e.args[0][n(356)])}catch(a){t[n(379)](n(332),{callId:e[n(372)][0][n(356)],errorStr:a[n(290)]()})}}}switch(e.channel){case n(289):Editor.Message[n(379)](namespace_1.ns,n(310),{newMsgCount:e.args[0][n(318)]});break;case n(360):a[n(361)][n(303)]="none";break;case"download":s(!1);break;case n(345):!async function(){const a=n,s=await function(){const t=_0x310e;let a;return a="image"===e[t(372)][0][t(321)]?{title:translate_1.tr("select-image"),filters:[{name:translate_1.tr(t(330)),extensions:["jpg",t(366),t(320),t(351)]}]}:{title:translate_1.tr(t(345)),filters:[{name:translate_1.tr(t(313)),extensions:["*"]}]},dialog_1[t(311)](a)}();s[a(368)]?t[a(379)](a(349),""):t[a(379)](a(349),s.filePaths[0])}();break;case n(316):s(!0)}}function forceClosePanel(){const e=_0x56535f;forceClose=!0,Editor.Message[e(379)](namespace_1.ns,e(358))}exports.ready=ready,exports[_0x56535f(314)]=beforeClose,exports[_0x56535f(331)]=close;