const _0x1a65=["whether-close","shell","COCOS_DASHBOARD_VERSION","sendSync","file-filter-name",":panel-ready","image","dom-ready","image-filter-name","file-url","send","methods","info-title","info","../../common-lib/translate","callId","select","filePath","#loading-page","dayjs","env","move","Panel","args","jpeg","addEventListener","total","../../common-lib/dialog","none","download-failed","broadcast","guess","downloadProgress",":panel-win-state-changed","template","type","png","is-ready","plugin","paths","./index.html","join","jpg","__esModule","dirname","close","channel","get-data","silent-check","innerText","getTimezoneOffset","kitControl","update","./host-api.js","display","im-plugin","download","new-window","ipcRenderer","addBroadcastListener","close-panel","electron","download-progress","panels","new-msg","update-toolbar","updateBtn","readFileSync","version","style","default","get-sign-in-url-failed","App","loadingPage","#btn-4","fileName","utf8","assign","info-non-logged-in","ipc-message","User","I18n","removeBroadcastListener","download-canceled","ready","get-redirect-url","select-file",":get-version","url","canceled","save-image","removeEventListener","setAttribute","request","transferred",":force-close-panel","getLanguage","@editor/panel/lib/element","select-image","silent-check-and-update","release","Message","gif","refresh","webview","__importDefault","dayjs/plugin/timezone","download-with-progress","isLoggedIn","file-selected","save","click","openExternal","path","request-data","./style.css","beforeClose"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x1a65,465);const _0xd49f=function(e,t){return _0x1a65[e-=249]},_0x111e6f=_0xd49f;var __importDefault=this&&this[_0x111e6f(357)]||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,_0x111e6f(295),{value:!0}),exports[_0x111e6f(263)]=exports[_0x111e6f(297)]=exports[_0x111e6f(251)]=exports[_0x111e6f(336)]=exports.$=exports.style=exports.template=void 0;const path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),electron_1=require(_0x111e6f(313)),download_1=__importDefault(require("download")),file_url_1=__importDefault(require(_0x111e6f(261))),translate_1=require(_0x111e6f(266)),dialog_1=require(_0x111e6f(279)),namespace_1=require("../../constant/namespace"),os_1=__importDefault(require("os")),pluginVersion=electron_1.ipcRenderer[_0x111e6f(255)](namespace_1.ns+_0x111e6f(339));var utc=require("dayjs/plugin/utc"),timezone=require(_0x111e6f(358)),dayjs=require(_0x111e6f(271));dayjs.extend(utc),dayjs.extend(timezone),module[_0x111e6f(291)].push(path_1[_0x111e6f(322)][_0x111e6f(293)](Editor[_0x111e6f(324)][_0x111e6f(365)],"./node_modules"));const element=require(_0x111e6f(349)),windowsPkg=require("@base/electron-windows/package.json"),ipcFlag=windowsPkg.name+"@"+windowsPkg[_0x111e6f(320)];let forceClose=!1;const template=fs_1[_0x111e6f(322)][_0x111e6f(319)](path_1[_0x111e6f(322)][_0x111e6f(293)](__dirname,_0x111e6f(292)),_0x111e6f(328));exports[_0x111e6f(286)]=template;const style=fs_1.default[_0x111e6f(319)](path_1[_0x111e6f(322)][_0x111e6f(293)](__dirname,_0x111e6f(250)),_0x111e6f(328));exports.style=style;const selector={webview:"#webview",loadingPage:_0x111e6f(270),updateBtn:_0x111e6f(326)};exports.$=selector;let action=_0x111e6f(355);async function controlUpdateBtn(e){const t=_0x111e6f;await Editor[t(353)][t(345)](t(307),t(300))?(e.$.updateBtn.style[t(306)]="block",e.$[t(318)][t(301)]=translate_1.tr("update-btn")||t(304),e.$[t(318)][t(277)]("click",async()=>{const n=t;e.$[n(318)][n(321)][n(306)]=n(280),Editor.Message.send(n(307),n(351))})):(e.$.updateBtn.style.display=t(280),e.$[t(318)][t(343)](t(363),()=>{}))}let that=null;async function ready(){const e=_0x111e6f;if(that=this,await controlUpdateBtn(that),forceClose=!1,Editor[e(274)][e(303)],Editor[e(353)][e(311)](namespace_1.ns+e(347),forceClosePanel),!await Editor[e(332)][e(360)]())return await dialog_1[e(265)](translate_1.tr(e(330)),{title:translate_1.tr("info-title"),buttons:[translate_1.tr("ok")],default:0}),void Editor[e(353)].broadcast(namespace_1.ns+e(347));this.$[e(356)][e(277)](e(259),()=>{Editor[e(353)].send(namespace_1.ns,"dom-ready")}),this.$.webview.setAttribute("webpreferences","contextIsolation=false"),this.$[e(356)][e(344)]("preload",file_url_1[e(322)](path_1[e(322)][e(293)](__dirname,e(305)))),this.$.webview[e(277)](e(331),t=>{const n=e;onIpcMessage(t,this.$[n(356)],this.$[n(325)])});const t=await Editor.Message[e(345)](namespace_1.ns,"get-sign-in-url");if(!t)return dialog_1.info(translate_1.tr(e(323)),{title:translate_1.tr(e(264))}),void Editor[e(353)][e(282)](namespace_1.ns+e(347));this.$.webview.src=t,this.$[e(356)][e(277)](e(309),async t=>{const n=e;electron_1[n(253)][n(364)](await Editor.Message[n(345)](namespace_1.ns,n(337),t[n(340)]))}),electron_1[e(310)].on(ipcFlag+":close",()=>{action="close"}),electron_1[e(310)].on(namespace_1.ns+":panel-win-state-changed",(t,n)=>{const a=e;try{this.$[a(356)][a(262)](namespace_1.ns+a(285),n)}catch(e){}}),electron_1[e(310)][e(262)](namespace_1.ns+e(257))}async function beforeClose(e={}){const t=_0x111e6f;if(forceClose||e[t(273)]||element.panels&&element[t(315)].length>1)return!0;if("refresh"===action)return!0;action=t(355);try{return!!await Editor.Message[t(345)](namespace_1.ns,t(252))||(electron_1[t(310)].send(namespace_1.ns+":hide-panel"),!1)}catch(e){return!0}}function close(){const e=_0x111e6f;Editor[e(353)][e(334)](namespace_1.ns+e(347),forceClosePanel)}function onIpcMessage(e,t,n){const a=_0x111e6f;async function s(n){const a=_0xd49f,s=e[a(275)][0][a(287)],o=e[a(275)][0][a(327)];let r=null;r=a(258)===s?{title:translate_1.tr(a(342)),path:o,filters:[{name:translate_1.tr(a(260)),extensions:["jpg",a(276),a(288),a(354)]}]}:{title:translate_1.tr("save-file"),path:o,filters:[{name:translate_1.tr(a(256)),extensions:["*"]}]};const i=await dialog_1[a(362)](r);if(!i[a(269)])return void(n&&t[a(262)](a(335),e[a(275)][0][a(267)]));const l=e.args[0][a(340)],c=path_1.default[a(296)](i[a(269)]),d=download_1[a(322)](l,c,{filename:path_1[a(322)].basename(i.filePath)});if(n){d.on(a(284),n=>{const s=a;t.send(s(314),{callId:e[s(275)][0].callId,percent:n.percent,transferred:n[s(346)],total:n[s(278)]})});try{await d,t.send("download-succeeded",e[a(275)][0][a(267)])}catch(n){t.send(a(281),{callId:e[a(275)][0].callId,errorStr:n.toString()})}}}switch(e[a(298)]){case a(316):Editor[a(353)].send(namespace_1.ns,a(317),{newMsgCount:e.args[0].newMsgCount});break;case a(289):n[a(321)][a(306)]=a(280);break;case a(308):s(!1);break;case a(338):!async function(){const n=a,s=await function(){const t=_0xd49f;let n;return n=t(258)===e[t(275)][0][t(287)]?{title:translate_1.tr(t(350)),filters:[{name:translate_1.tr("image-filter-name"),extensions:[t(294),"jpeg",t(288),t(354)]}]}:{title:translate_1.tr("select-file"),filters:[{name:translate_1.tr(t(256)),extensions:["*"]}]},dialog_1[t(268)](n)}();s[n(341)]?t[n(262)](n(361),""):t[n(262)](n(361),s.filePaths[0])}();break;case a(359):s(!0);break;case a(249):!async function(){const e=a,n={entry:e(290),languageType:Editor[e(333)][e(348)](),osTimeZone:"UTC"+(-(new Date)[e(302)]()>=0?"+":"")+-(new Date)[e(302)]()/60+" "+dayjs.tz[e(283)](),dashBoardVersion:process[e(272)][e(254)],creatorVersion:Editor[e(324)][e(320)],pluginVersion:pluginVersion,osType:os_1.default[e(287)](),osVersion:os_1[e(322)][e(352)]()};t.send(e(299),Object[e(329)]({},n))}()}}function forceClosePanel(){const e=_0x111e6f;forceClose=!0,Editor[e(353)].send(namespace_1.ns,e(312))}exports[_0x111e6f(336)]=ready,exports[_0x111e6f(251)]=beforeClose,exports.close=close;const methods={async check(){that&&await controlUpdateBtn(that)}};exports[_0x111e6f(263)]=methods;