const _0x39ab=["./host-api.js","image","dom-ready","defineProperty","info-title","save-file","silent-check-and-update","panels","get-data","type","get-redirect-url","env","close-panel","ready","channel","request","downloadProgress","dayjs/plugin/utc","canceled","url","style","dayjs","save-image","gif","extend","__esModule","ipcRenderer","percent","download-canceled",":force-close-panel","image-filter-name","block","info-non-logged-in","close","callId","send","electron","default","download-with-progress","file-selected","basename","update-btn","src","filePaths","length","broadcast","select-file","filePath",":get-version","update","getLanguage","addBroadcastListener","./style.css","join","@base/electron-windows/package.json","beforeClose","update-toolbar","getTimezoneOffset","click","select-image","App","dayjs/plugin/timezone","download","path","silent-check","select","download-succeeded","dirname","newMsgCount","preload","transferred","is-ready","release","info","utf8","args","save",":panel-win-state-changed","download-progress","readFileSync","methods","none","total",":close","guess","get-sign-in-url","name","jpeg","png","addEventListener","updateBtn","paths","im-plugin","innerText","template","jpg","removeEventListener","../../common-lib/dialog","Message","push","fileName","refresh","setAttribute","file-filter-name","removeBroadcastListener","get-sign-in-url-failed","I18n","display","assign","webview","#loading-page","#btn-4","isLoggedIn","./node_modules"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x39ab,376);const _0x5050=function(e,t){return _0x39ab[e-=426]},_0x4e8e4a=_0x5050;var __importDefault=this&&this.__importDefault||function(e){return e&&e[_0x5050(531)]?e:{default:e}};Object[_0x4e8e4a(509)](exports,"__esModule",{value:!0}),exports[_0x4e8e4a(472)]=exports[_0x4e8e4a(539)]=exports[_0x4e8e4a(447)]=exports[_0x4e8e4a(519)]=exports.$=exports[_0x4e8e4a(526)]=exports[_0x4e8e4a(486)]=void 0;const path_1=__importDefault(require(_0x4e8e4a(455))),fs_1=__importDefault(require("fs")),electron_1=require(_0x4e8e4a(428)),download_1=__importDefault(require(_0x4e8e4a(454))),file_url_1=__importDefault(require("file-url")),translate_1=require("../../common-lib/translate"),dialog_1=require(_0x4e8e4a(489)),namespace_1=require("../../constant/namespace"),os_1=__importDefault(require("os")),pluginVersion=electron_1[_0x4e8e4a(532)].sendSync(namespace_1.ns+_0x4e8e4a(440));var utc=require(_0x4e8e4a(523)),timezone=require(_0x4e8e4a(453)),dayjs=require(_0x4e8e4a(527));dayjs[_0x4e8e4a(530)](utc),dayjs[_0x4e8e4a(530)](timezone),module[_0x4e8e4a(483)][_0x4e8e4a(491)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](Editor.App[_0x4e8e4a(455)],_0x4e8e4a(505)));const element=require("@editor/panel/lib/element"),windowsPkg=require(_0x4e8e4a(446)),ipcFlag=windowsPkg[_0x4e8e4a(478)]+"@"+windowsPkg.version;let forceClose=!1;const template=fs_1[_0x4e8e4a(429)][_0x4e8e4a(471)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](__dirname,"./index.html"),_0x4e8e4a(466));exports[_0x4e8e4a(486)]=template;const style=fs_1.default[_0x4e8e4a(471)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](__dirname,_0x4e8e4a(444)),_0x4e8e4a(466));exports[_0x4e8e4a(526)]=style;const selector={webview:"#webview",loadingPage:_0x4e8e4a(502),updateBtn:_0x4e8e4a(503)};exports.$=selector;let action=_0x4e8e4a(493);async function controlUpdateBtn(e){const t=_0x4e8e4a;await Editor[t(490)][t(521)](t(484),t(456))?(e.$.updateBtn[t(526)][t(499)]=t(537),e.$[t(482)][t(485)]=translate_1.tr(t(433))||t(441),e.$[t(482)][t(481)](t(450),async()=>{const a=t;e.$[a(482)][a(526)][a(499)]="none",Editor[a(490)][a(427)]("im-plugin",a(512))})):(e.$[t(482)].style[t(499)]=t(473),e.$[t(482)][t(488)](t(450),()=>{}))}let that=null;async function ready(){const e=_0x4e8e4a;if(that=this,await controlUpdateBtn(that),forceClose=!1,Editor.Panel.kitControl,Editor[e(490)][e(443)](namespace_1.ns+e(535),forceClosePanel),!await Editor.User[e(504)]())return await dialog_1[e(465)](translate_1.tr(e(538)),{title:translate_1.tr(e(510)),buttons:[translate_1.tr("ok")],default:0}),void Editor.Message[e(437)](namespace_1.ns+e(535));this.$[e(501)][e(481)](e(508),()=>{const t=e;Editor[t(490)][t(427)](namespace_1.ns,t(508))}),this.$.webview[e(494)]("webpreferences","contextIsolation=false"),this.$[e(501)][e(494)](e(461),file_url_1.default(path_1.default[e(445)](__dirname,e(506)))),this.$[e(501)][e(481)]("ipc-message",t=>{const a=e;onIpcMessage(t,this.$[a(501)],this.$.loadingPage)});const t=await Editor.Message[e(521)](namespace_1.ns,e(477));if(!t)return dialog_1[e(465)](translate_1.tr(e(497)),{title:translate_1.tr(e(510))}),void Editor[e(490)].broadcast(namespace_1.ns+":force-close-panel");this.$[e(501)][e(434)]=t,this.$[e(501)][e(481)]("new-window",async t=>{const a=e;electron_1.shell.openExternal(await Editor[a(490)][a(521)](namespace_1.ns,a(516),t[a(525)]))}),electron_1[e(532)].on(ipcFlag+e(475),()=>{action=e(539)}),electron_1[e(532)].on(namespace_1.ns+e(469),(t,a)=>{const n=e;try{this.$.webview[n(427)](namespace_1.ns+n(469),a)}catch(e){}}),electron_1[e(532)][e(427)](namespace_1.ns+":panel-ready")}async function beforeClose(e={}){const t=_0x4e8e4a;if(forceClose||e.move||element[t(513)]&&element.panels[t(436)]>1)return!0;if("refresh"===action)return!0;action="refresh";try{return!!await Editor[t(490)][t(521)](namespace_1.ns,"whether-close")||(electron_1[t(532)].send(namespace_1.ns+":hide-panel"),!1)}catch(e){return!0}}function close(){const e=_0x4e8e4a;Editor[e(490)][e(496)](namespace_1.ns+e(535),forceClosePanel)}function onIpcMessage(e,t,a){const n=_0x4e8e4a;async function s(a){const n=_0x5050,s=e[n(467)][0][n(515)],o=e[n(467)][0][n(492)];let r=null;r="image"===s?{title:translate_1.tr(n(528)),path:o,filters:[{name:translate_1.tr(n(536)),extensions:[n(487),"jpeg",n(480),"gif"]}]}:{title:translate_1.tr(n(511)),path:o,filters:[{name:translate_1.tr(n(495)),extensions:["*"]}]};const i=await dialog_1[n(468)](r);if(!i[n(439)])return void(a&&t.send(n(534),e[n(467)][0][n(426)]));const l=e.args[0].url,c=path_1[n(429)][n(459)](i[n(439)]),_=download_1.default(l,c,{filename:path_1[n(429)][n(432)](i.filePath)});if(a){_.on(n(522),a=>{const s=n;t[s(427)](s(470),{callId:e[s(467)][0].callId,percent:a[s(533)],transferred:a[s(462)],total:a[s(474)]})});try{await _,t[n(427)](n(458),e.args[0].callId)}catch(a){t.send("download-failed",{callId:e.args[0].callId,errorStr:a.toString()})}}}switch(e[n(520)]){case"new-msg":Editor[n(490)][n(427)](namespace_1.ns,n(448),{newMsgCount:e[n(467)][0][n(460)]});break;case n(463):a[n(526)][n(499)]="none";break;case n(454):s(!1);break;case n(438):!async function(){const a=n,s=await function(){const t=_0x5050;let a;return a=t(507)===e[t(467)][0][t(515)]?{title:translate_1.tr(t(451)),filters:[{name:translate_1.tr(t(536)),extensions:[t(487),t(479),t(480),t(529)]}]}:{title:translate_1.tr(t(438)),filters:[{name:translate_1.tr(t(495)),extensions:["*"]}]},dialog_1[t(457)](a)}();s[a(524)]?t[a(427)](a(431),""):t[a(427)](a(431),s[a(435)][0])}();break;case n(430):s(!0);break;case"request-data":!async function(){const e=n,a={entry:"plugin",languageType:Editor[e(498)][e(442)](),osTimeZone:"UTC"+(-(new Date)[e(449)]()>=0?"+":"")+-(new Date)[e(449)]()/60+" "+dayjs.tz[e(476)](),dashBoardVersion:process[e(517)].COCOS_DASHBOARD_VERSION,creatorVersion:Editor[e(452)].version,pluginVersion:pluginVersion,osType:os_1[e(429)][e(515)](),osVersion:os_1[e(429)][e(464)]()};t[e(427)](e(514),Object[e(500)]({},a))}()}}function forceClosePanel(){const e=_0x4e8e4a;forceClose=!0,Editor[e(490)][e(427)](namespace_1.ns,e(518))}exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;const methods={async check(){that&&await controlUpdateBtn(that)}};exports[_0x4e8e4a(472)]=methods;