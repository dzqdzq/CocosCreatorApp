const _0x4f7d=["download-failed","now","select-file","sendSync","total","download-with-progress","url","fileName",":get-version","succeeded","ipcRenderer","__esModule","sendToHost","errorStr","default","defineProperty",":panel-win-state-changed","type","download-succeeded","__importDefault","download","path","promises","download-canceled","toString","percent","floor","transferred","replace","hostAPI","new-msg","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx","download-progress","progressCallback","off","file-selected","readFile","basename","callId"];!function(e,n){!function(n){for(;--n;)e.push(e.shift())}(++n)}(_0x4f7d,280);const _0x7ee5=function(e,n){return _0x4f7d[e-=468]},_0x46eb34=_0x7ee5;var __importDefault=this&&this[_0x46eb34(480)]||function(e){return e&&e[_0x46eb34(472)]?e:{default:e}};Object[_0x46eb34(476)](exports,"__esModule",{value:!0});const fs_1=__importDefault(require("fs")),fsPromises=fs_1[_0x46eb34(475)][_0x46eb34(483)],path_1=__importDefault(require(_0x46eb34(482))),namespace_1=require("../../constant/namespace"),electron_1=require("electron"),pluginVersion=electron_1[_0x46eb34(471)][_0x46eb34(503)](namespace_1.ns+_0x46eb34(469)),globalAny=global;let panelWinStateChangedListener=null;function uuid(){const e=_0x46eb34;let n=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance[e(501)]&&(n+=performance[e(501)]()),e(492)[e(489)](/[xy]/g,function(t){const o=e;var r=(n+16*Math.random())%16|0;return n=Math[o(487)](n/16),("x"===t?r:3&r|8)[o(485)](16)})}electron_1[_0x46eb34(471)].on(namespace_1.ns+_0x46eb34(477),(e,n)=>{panelWinStateChangedListener&&panelWinStateChangedListener(n)}),globalAny[_0x46eb34(490)]={imPluginVersion:pluginVersion,sendToHost:(e,n)=>{const t=_0x46eb34;t(491)===e?electron_1[t(471)].sendToHost(t(491),{newMsgCount:n}):t(481)===e&&electron_1[t(471)][t(473)](t(481),{url:n.url,type:n[t(478)],fileName:n.fileName})},isReady(e){const n=_0x46eb34;electron_1[n(471)][n(473)]("is-ready",e)},setWindowListener(e){panelWinStateChangedListener=e},selectFile:async e=>new Promise((n,t)=>{const o=_0x46eb34;electron_1[o(471)].once(o(496),function(e,t){t?async function(e){const n=_0x7ee5,t=path_1.default[n(498)](e),o=await fsPromises[n(497)](e);return new File([o],t)}(t).then(n):n("")}),electron_1[o(471)].sendToHost(o(502),{type:e})}),downloadWithProgress:async e=>new Promise((n,t)=>{const o=_0x46eb34,r=uuid();function s(n,t){const o=_0x7ee5;t[o(499)]===r&&(1==t[o(486)]&&t[o(488)]!==t.total||e.progressCallback&&e[o(494)]({percent:t.percent,transferred:t[o(488)],total:t[o(504)]}))}function a(e,n){n===r&&i({status:_0x7ee5(470)})}function l(e,n){const t=_0x7ee5;n[t(499)]===r&&i({status:"failed",errorStr:n[t(474)]})}function c(e,n){n===r&&i({status:"canceled"})}function i(e){const t=_0x7ee5;n(e),electron_1[t(471)][t(495)](t(493),s),electron_1[t(471)][t(495)](t(479),a),electron_1[t(471)].off(t(500),l),electron_1[t(471)].off("download-canceled",c)}electron_1[o(471)][o(473)](o(505),{url:e[o(506)],type:e[o(478)],fileName:e[o(468)],callId:r}),electron_1.ipcRenderer.on("download-progress",s),electron_1.ipcRenderer.on(o(479),a),electron_1[o(471)].on(o(500),l),electron_1[o(471)].on(o(484),c)})};