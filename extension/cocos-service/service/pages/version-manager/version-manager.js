"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const vue_1=__importDefault(require("../../../vue")),plugin_1=__importDefault(require("../../core/plugin")),utils_1=require("../../../utils");exports.default=vue_1.default.extend({template:utils_1.csFile.readFile(__dirname,"./version-manager.html"),props:{service:{type:Object},action:{type:String,default:()=>"switch"}},data(){return{srv:this.service,srvInfo:plugin_1.default.getServicePluginInfo(this.service.service_component_name),versionStr:"",upgradeStr:"",localVersion:"",remoteVersion:"",enableUpdate:!1,enableSwitch:!1,selected:""}},async created(){var e,t;this.remoteVersion=plugin_1.default.getPluginVerByURL(this.srv.package_download_url),this.localVersion=(null===(e=this.srvInfo)||void 0===e?void 0:e.version)||utils_1.csEditor.tr("not_installed"),"update"===this.action?(this.versionStr=`${utils_1.csEditor.tr("new_ver")} : ${this.remoteVersion}`,this.upgradeStr=this.srv.package_version_desc):"switch"===this.action&&(this.versionStr=`ver : ${this.localVersion}`,this.upgradeStr=(await utils_1.csProtocol.getVersionDesc(this.srv.service_id,this.localVersion)).package_version_desc||"",""===this.upgradeStr&&(null===(t=this.srvInfo)||void 0===t?void 0:t.version)&&(this.upgradeStr=this.srvInfo.upgrade||"")),this.enableSwitch=!1,this.enableUpdate=1===utils_1.csUtil.compareVersion(this.remoteVersion,this.localVersion)},methods:{handleClose(){utils_1.csEvent.emit("hide-verm")},async handleSelectChange(e){this.selected=e.target.value,this.enableSwitch=!(this.selected===utils_1.csEditor.tr("select_version_please")||this.selected===this.localVersion),this.upgradeStr=(await utils_1.csProtocol.getVersionDesc(this.srv.service_id,this.selected)).package_version_desc},handleSwitch(){this.switchVersion(this.selected,"switch")},handleUpdate(){this.switchVersion(this.remoteVersion,"update")},async switchVersion(e,t){if(0!==await utils_1.csEditor.dialogMsgBox("info",utils_1.csEditor.tr("update"===this.action?"update_version_tips":"switch_version_tips"),utils_1.csEditor.tr("dialog_title"),[utils_1.csEditor.tr("btn_ok"),utils_1.csEditor.tr("btn_cancel")],0))return;let i=await utils_1.csProtocol.getVersionDesc(this.srv.service_id,e);utils_1.csEvent.emit("service:switch-version",i.package_download_url,t),utils_1.csEvent.emit("hide-verm")}}});