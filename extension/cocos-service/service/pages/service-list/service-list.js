"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const vue_1=__importDefault(require("../../../vue")),utils_1=require("../../../utils"),core_1=__importDefault(require("../../core"));exports.default=vue_1.default.extend({template:utils_1.csFile.readFile(__dirname,"./service-list.html"),props:{game:{type:Object,default:()=>({app_id:"UNKNOW",name:utils_1.csEditor.tr("unknow_game"),c_id:"0"})},services:{type:Array},config:{type:Object},configs:{type:Array},filter:{type:Object,default:()=>({status:"All"})}},data:()=>({emptyResult:!1,filterStatus:"All",filterPlatforms:new Set}),computed:{groups(){let e=[];return this.services.forEach(t=>{if(this.getServiceShownByFilter(t)&&this.getServiceShownByMode(t))if(void 0===t.service_group&&(t.service_group=""),""!==t.service_group){let i=this.getGroupByName(e,t.service_group);i.services.push(t),1===i.services.length&&e.push(i)}else{var i={name:"",services:[]};i.services.push(t),e.push(i)}}),this.emptyResult=0===e.length,e}},async created(){this.filterStatus=this.filter.status,this.filterPlatforms=new Set(this.filter.platforms)},mounted(){},methods:{getServiceShownByFilter(e){return"All"===this.filterStatus?!!this.filterPlatforms.has("All")||this.checkElementOnSet(e.support_platform,this.filterPlatforms):"Enable"===this.filterStatus&&e.enable?!!this.filterPlatforms.has("All")||this.checkElementOnSet(e.support_platform,this.filterPlatforms):"Disable"===this.filterStatus&&!e.enable&&(!!this.filterPlatforms.has("All")||this.checkElementOnSet(e.support_platform,this.filterPlatforms))},getServiceShownByMode:e=>!!core_1.default.devMode||0!==e.package_versions.length,checkElementOnSet:(e,t)=>e.filter(e=>t.has(e)).length>0,getGroupByName(e,t){for(var i of e)if(t===i.name)return i;return{name:t,services:[]}},handleItemClick(e){this.$emit("item-click",e)},handleConfigChange(e){let t=e.target.value;if("config_set_add"===t)return e.target.value=this.config.config_id,void utils_1.csEvent.emit("service-list-menu",t);if(t===this.config.config_id)return;let i=this.configs.find(e=>e.config_id===t);void 0!==i&&this.$emit("confirm-config",i,!1)},handleShowMenu(e){let t=e.path.find(e=>"cocos-service"===e.id).getBoundingClientRect(),i=e.target.getBoundingClientRect(),s={top:i.top-t.top+i.height+5,right:t.right-i.right},r=[{id:"config_set_add",name:utils_1.csEditor.tr("menu.add")},{id:"config_set_edit",name:utils_1.csEditor.tr("menu.edit")},{id:"config_set_copy",name:utils_1.csEditor.tr("menu.copy")},{id:"config_set_delete",name:utils_1.csEditor.tr("menu.delete")}],l="UNKNOW"===this.game.app_id?[{id:"associate_app",name:utils_1.csEditor.tr("menu.set_app_id")}]:[{id:"edit_app",name:utils_1.csEditor.tr("menu.complete_app")},{id:"app_detail",name:utils_1.csEditor.tr("menu.app_detail")},{id:"exchange_app",name:utils_1.csEditor.tr("menu.switch_app")},{id:"config_set",name:utils_1.csEditor.tr("menu.config_manager"),subMenu:r},{id:"unassociate_app",name:utils_1.csEditor.tr("menu.unlink_app")}];utils_1.csEvent.emit("show-menu",s,l,e=>utils_1.csEvent.emit("service-list-menu",e)),utils_1.csAnalytics.showSettingsMenu()},handleShowFilter(){utils_1.csEvent.emit("show-service-filter")}}});