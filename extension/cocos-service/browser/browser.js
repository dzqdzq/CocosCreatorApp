"use strict";const _0x22a02a=_0x5723;function _0x4d76(e,t){const s=_0x570f();return(_0x4d76=function(e,t){return s[e-=146]})(e,t)}!function(e,t){const s=_0x5723,a=_0x4436();for(;;)try{if(390123===-parseInt(s(428))/1*(parseInt(s(450))/2)+parseInt(s(547))/3+-parseInt(s(426))/4+-parseInt(s(561))/5*(-parseInt(s(557))/6)+parseInt(s(497))/7+-parseInt(s(481))/8*(parseInt(s(422))/9)+parseInt(s(471))/10)break;a.push(a.shift())}catch(e){a.push(a.shift())}}();const _0x2d02d4=_0x4d76;function _0x570f(){const e=_0x5723,t=[e(456),e(511),e(441),e(432),e(430),e(532),e(489),e(467),"Message","all",e(500),e(558),e(454),e(442),e(538),e(562),e(455),"pluginExists",e(503),"default",e(559),"service","openService",e(419),e(514),e(448),e(438),e(530),e(535),e(553),e(534),e(463),e(435),e(545),"147225TxFxDG",e(506),"find",e(485),e(507),e(425),"path","installed",e(533),e(529),e(502),e(444),e(526),e(488),e(427),"service:handle-penetrate-param",e(565),e(519),e(445),"startsWith",e(469),e(560),"delete",e(461),"debug",e(524),"get",e(479),e(464),e(487),e(465),e(563),e(523),e(549),e(470),".prefab",e(501),"size",e(449),"login","package.json",e(483),e(486),e(480),e(498),e(518),e(556),"cocos-service.simple",e(424),"package.json is not found.",e(473),e(516),e(462),e(492),e(554),e(499),e(508),e(540),e(555),"dependency","getServicePluginInfo",e(490),e(468),e(546),e(512),e(520),"node","getProjectPath",e(541),"unload",e(542),"compareVersion",e(443),"UNKNOW",e(437),"scene",e(517),"csProtocol",e(544),e(552),e(537),"info","__esModule","service_name","success",e(446),e(510),"open","requestMsg",e(459),"Panel","sendMsg",e(496),"methods",e(451),e(434),"onServiceStatusChanged",e(436),e(439),"browser.update_tips",e(440),"popup",e(453),e(504),e(460),"userChanged",e(551),e(474),e(493),"readBindGame",e(550),"cloud_json"];return(_0x570f=function(){return t})()}function _0x4436(){const e=["14743YUjIOw","root","csEditor","silence_disable_service","readJSONSync","plugin-msg-service","ensureDir","isLogin","./protocol","close","install.js","ipcMain","1295140pUILjO","message","request","234DVnLqn","fs-extra","plugin-msg","main","info","deleteCache","98400WowCgn","14UiTuoD","then","Panel","36OERBDl","removeListener","dialogMsgBox","185044BDKqLL","default","service_name_error","sender","broadcast","log","package_download_url","values","refresh-asset","existsSync","__importDefault","has","query-uuid","create-node","161990bgdKnZ","6825730jhfLUb","version","defineProperty","asset-db","userChanged","target","../utils","unload","logout","csUtil","1568xweoKU","compareVersion","install","csHttp","User","stringify","require","Project","join","csPlugin","path","getGameDetail","602548jPiFLI","push","browser.update_now","cocos-service","1897504oiimxd","catch","value","csLogger","redirect_url","error","service-","import","./plugin","download_url","getServiceVersion","BrowserWindow","Message","apiPost","3.7.0","../utils/_inner","service","getRedirectUrl","fromWebContents","getCreatorVersion","service_id","popupShow","load","silenceCreateGame","readServiceList","focus","update-extension","64ZGeYOe","browser.cancel","warn","target not exist!","methods","send","assets","cloud-component:update-import","service:userChanged","pluginName","service_component_name","global","scene","name","map","remove","plugin-msg-popup","set","csConfig","requestMsg","broadcastMsg","plugin","enable","223665HPdxlX","copy","cocos-service:popup-show","includes","${name}","wirteEnableService","builder","service_type","cocos-service:service-data-change","config_id","12NefsBC","assets/cloud-component","extension","readServiceParam","959505WaEZzm","getCustomPlugin","cloud-function","shift","registerPluginsI18n","writeBindGame","params","replace","8946MfVIHr","installPlugin","db://assets/cloud-component/","83692JVilay","2895416mwFjHD","app_id"];return(_0x4436=function(){return e})()}!function(e,t){const s=_0x5723,a=_0x4d76,i=_0x570f();for(;;)try{if(303493===parseInt(a(195))/1+parseInt(a(199))/2+parseInt(a(233))/3*(-parseInt(a(189))/4)+-parseInt(a(187))/5+-parseInt(a(271))/6+-parseInt(a(238))/7*(parseInt(a(258))/8)+-parseInt(a(159))/9*(-parseInt(a(267))/10))break;i[s(494)](i[s(564)]())}catch(e){i[s(494)](i.shift())}}();var __importDefault=this&&this[_0x22a02a(466)]||function(e){return e&&e[_0x4d76(169)]?e:{default:e}};Object[_0x2d02d4(283)](exports,_0x2d02d4(169),{value:!0}),exports[_0x2d02d4(156)]=exports[_0x2d02d4(250)]=exports[_0x2d02d4(180)]=void 0;const electron_1=require("electron"),utils_1=require(_0x22a02a(477)),plugin_1=__importDefault(require(_0x22a02a(505))),protocol_1=__importDefault(require(_0x2d02d4(184))),_inner_1=require(_0x2d02d4(151)),fs_extra_1=require(_0x2d02d4(244)),path_1=require(_0x2d02d4(239));let popupWindows=new Map,firstRun=!0;async function load(){const e=_0x22a02a,t=_0x2d02d4;Editor[t(236)].on(t(272),exports[t(180)][t(192)]),Editor[t(236)].on(t(260),exports[e(528)].userChanged),electron_1[t(185)].on(t(266),exports[e(528)][t(278)]),await plugin_1[e(457)][t(249)]()}function unload(){const e=_0x22a02a,t=_0x2d02d4;Editor[e(485)][t(211)]("login",exports[t(180)][e(475)]),Editor.User[t(211)](t(260),exports[t(180)][t(192)]),electron_1[t(185)][e(454)](e(549),exports[t(180)][e(518)])}function _0x5723(e,t){const s=_0x4436();return(_0x5723=function(e,t){return s[e-=419]})(e,t)}exports[_0x2d02d4(180)]={async openServicePanel(e){const t=_0x22a02a,s=_0x2d02d4;await Editor[s(177)][s(206)](s(179))?(await Editor[s(177)][t(522)](s(179)),utils_1[s(203)][s(178)](utils_1[s(203)][t(545)],s(251),s(220),s(248),e)):await Editor.Panel[s(174)](s(179),e)},openPopup(e,t,s){const a=_0x22a02a,i=_0x2d02d4;try{if(!popupWindows[i(206)](e))return void Editor[i(177)][i(174)](i(280),e,t);{let t=popupWindows[i(259)](e);null==t||t[a(522)]()}}catch(t){popupWindows.delete(e)}},closePopup(e){const t=_0x2d02d4;try{if(popupWindows[t(206)](e)){let s=popupWindows[t(259)](e);null==s||s[t(161)](),popupWindows[t(255)](e)}}catch(s){popupWindows[t(255)](e)}},printLog(e,t){const s=_0x22a02a,a=_0x2d02d4;s(502)===e&&console[a(243)](t),s(447)===e&&console[a(168)](t),a(256)===e&&console[a(256)](t),a(245)===e&&console.warn(t)},popupShow(e,t){const s=_0x22a02a,a=_0x2d02d4;let i=electron_1[a(289)][s(515)](e[a(176)]),r=t[a(241)];null!==i&&r&&popupWindows[a(155)](r,i)},async userChanged(){const e=_0x2d02d4;await Editor[e(177)][e(206)](e(179))&&Editor[e(207)][e(242)](e(179),e(251),e(220),e(204))},apiRequest:async(e,t={})=>"redirect_url"===e?await protocol_1[_0x2d02d4(218)][_0x2d02d4(223)](t[_0x2d02d4(269)]):new Promise((s,a)=>protocol_1[_0x22a02a(457)][_0x2d02d4(173)](e,t)[_0x2d02d4(181)](s)[_0x2d02d4(277)](e=>a(new Error(JSON[_0x2d02d4(275)](e))))),async enableService(e,t,s=""){const a=_0x22a02a,i=_0x2d02d4;e[i(252)](i(217))||(e=i(217)+e);let r=(await utils_1[i(157)][a(521)]())[i(235)](t=>t[i(229)]===e);if(void 0===r)throw new Error(utils_1.csEditor.tr(a(458)));let n=(await utils_1[i(157)][i(196)]()||{app_id:i(160)})[a(427)];if(i(160)===n)try{let e=await(0,_inner_1[i(152)])();n=e[i(247)],await utils_1[i(157)][i(222)](e);let t=await utils_1[i(157)].readConfigSet();t&&(s=t[i(279)])}catch(e){return e[i(201)]}try{let e=await utils_1[i(164)][i(286)](n);t&&"0"!==r[i(287)]&&!e[i(220)][i(197)](r[i(163)])&&await utils_1[i(164)][i(221)](n,r[i(163)]),await utils_1[i(157)][i(166)](r[i(163)],t,s)[i(277)](utils_1.csLogger[i(257)]),utils_1[i(209)][a(447)](utils_1[i(203)].tr(t?"silence_open_service":a(431))[a(421)](i(193),r[i(170)]))}catch(e){return e[i(201)]}return plugin_1[i(218)][i(216)](e)||await plugin_1[i(218)][a(423)](e,r[i(285)],(e,t)=>{const s=i;t&&utils_1[s(203)].tr(s(240))}),i(171)},pluginMsg:async(e,t,s={})=>_0x22a02a(513)===e&&await Editor[_0x22a02a(452)][_0x2d02d4(206)](_0x22a02a(496))?await utils_1[_0x22a02a(430)][_0x2d02d4(175)](utils_1[_0x22a02a(430)][_0x22a02a(545)],_0x22a02a(433),t,s):_0x2d02d4(188)===e&&popupWindows[_0x2d02d4(270)]>0?await utils_1[_0x2d02d4(203)][_0x22a02a(543)](utils_1[_0x2d02d4(203)][_0x2d02d4(232)],_0x2d02d4(290),t,s):_0x22a02a(527),serviceReady(){firstRun&&(firstRun=!1,setTimeout(async()=>{const e=_0x5723,t=_0x4d76;if(!await utils_1[t(203)][t(231)]())return;let s=await utils_1[t(164)][t(214)]();if(-1!==utils_1[t(276)][t(158)](utils_1[t(203)][t(284)](),t(200)))return;if(1===utils_1[e(480)][t(158)](s[t(146)],utils_1[e(430)][t(284)]()))return;if(1!==utils_1[e(480)][e(482)](s[e(472)],utils_1[t(203)][t(237)]()))return;if(0!==await utils_1[e(430)][t(215)](e(447),utils_1[e(430)].tr(t(186)),utils_1[t(203)].tr("dialog_title"),[utils_1[t(203)].tr(e(495)),utils_1[t(203)].tr(e(525))],0))return;let a=await utils_1[e(484)][t(259)](s[t(234)],{});utils_1[t(209)][t(168)](utils_1[t(203)].tr("browser.updating_tips")),utils_1[t(203)][t(178)](t(219),t(265),a[t(234)],utils_1[t(203)][t(232)],t(227)),Editor[e(452)][t(161)](utils_1.csEditor[t(232)])},5e3))},async i18nChange(){const e=_0x22a02a,t=_0x2d02d4;utils_1[t(203)][t(165)](t(291)),await Editor[t(177)][t(206)](t(179))&&Editor[e(509)][t(242)](t(179),"plugin-msg",t(220),"service:i18nChange")},async onServiceStatusChanged(e){const t=_0x22a02a,s=_0x2d02d4;var a;try{let i=utils_1[s(148)][s(147)](e[s(229)]);if(void 0===i||!(null===(a=i[s(228)])||void 0===a?void 0:a.main))return;let r={};r.service_id=e[s(163)],r[s(229)]=e.service_component_name,r[s(150)]=e[s(150)]||!1,r[t(420)]=await utils_1[s(157)][s(254)](e[s(163)]);let n=utils_1[s(276)][s(262)](i[t(491)],i[s(228)].main);n[s(183)]&&await n[s(183)](utils_1[s(203)][s(154)](),r)}catch(e){utils_1[s(209)][s(257)](e)}},async dropScene(e,t,s){const a=_0x2d02d4;await Promise[a(208)](s[a(213)](async e=>{const s=_0x5723,i=a;await exports[i(180)][i(190)](e[i(288)]);const r=i(281)+e[i(167)]+"/"+e[i(167)]+i(268),n=await Editor[i(207)][i(212)](s(474),i(149),r);utils_1[i(203)][i(178)](i(162),i(253),{position:t,assetUuid:n})}))},async dropHierarchy(e,t){const s=_0x2d02d4;t=t||e[s(230)],await Promise[s(208)](t[s(213)](async e=>{const t=_0x5723,a=s,i=e[t(476)]||e[a(153)]||e.to;await exports[t(528)][a(190)](e[t(499)]);const r=a(281)+e.name+"/"+e[a(167)]+a(268),n=await Editor[a(207)][a(212)](a(194),a(149),r);utils_1[a(203)][a(178)](t(536),a(253),{parent:i,assetUuid:n})}))},async dropAssets(e,t){const s=_0x22a02a,a=_0x2d02d4;t=t||e[a(230)],await Promise[a(208)](t[a(213)](async e=>await exports[a(180)][a(190)](e[s(499)])))},async import(e){const t=_0x22a02a,s=_0x2d02d4;if(!(0,fs_extra_1[s(263)])(e))return;const a={cloud_json:(0,path_1[t(489)])(e,s(273)),assets:(0,path_1[t(489)])(e,"assets"),function:(0,path_1[s(205)])(e,s(264)),install:(0,path_1[s(205)])(e,s(225))};if(!(0,fs_extra_1[s(263)])(a[s(198)]))throw new Error(s(282));const i=(0,fs_extra_1[s(202)])(a[s(198)]),r={root:(0,path_1[s(205)])(Editor[s(246)][s(239)],s(210)),assets:(0,path_1[s(205)])(Editor[s(246)][s(239)],t(558),i[s(167)])};await(0,fs_extra_1[s(182)])(r[t(429)]);try{(0,fs_extra_1[t(465)])(a[s(226)])&&!(0,fs_extra_1[s(263)])(r[s(226)])&&await(0,fs_extra_1[t(548)])(a[s(226)],r[s(226)]),(0,fs_extra_1[s(263)])(a[s(274)])&&(utils_1[t(480)][s(224)](a[t(483)]),await require(a[t(483)])[s(172)]({assetsPath:r[s(226)]}))}catch(e){utils_1[s(209)][s(243)](e),(0,fs_extra_1[s(263)])(r[s(226)])&&await(0,fs_extra_1[t(539)])(r[s(226)])}await Editor[t(509)][s(212)](s(194),s(261),r[t(429)]),Editor[s(207)][s(191)](t(531))}},exports[_0x2d02d4(250)]=load,exports[_0x22a02a(478)]=unload;