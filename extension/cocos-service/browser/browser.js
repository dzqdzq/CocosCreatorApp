const _0x1177=["csLogger","sendMsg","service_id","plugin","app_id","getGameDetail","cloud-function","fs-extra","browser.update_tips","User","all","dialog_title","map","UNKNOW","name","assets","silence_open_service","copy","defineProperty","login","root","cocos-service","get","openService","popup","default","csUtil","config_id","error","refresh-asset","includes","send","csHttp","package.json is not found.","install","readServiceList","__esModule","unload","cocos-service.simple","readServiceParam","silenceCreateGame","then","../utils","open","getCustomPlugin","../utils/_inner","plugin-msg-popup","stringify","create-node","main","request","catch","${name}","debug","cocos-service:service-data-change","scene","getServicePluginInfo","service","./plugin","fromWebContents","dialogMsgBox","removeListener","install.js","package_download_url","existsSync","service:userChanged","readJSONSync","csProtocol","requestMsg","values","target","node","methods","popupShow","compareVersion","value","info","apiPost","enable","update-extension","csConfig","remove","sender","query-uuid","readConfigSet","installed","writeBindGame","broadcastMsg","cocos-service:popup-show","userChanged","has","Panel","Message","asset-db","pluginName","readBindGame","service_type","cloud-component:update-import","service_name_error","cloud_json","csEditor","params","find","delete","set","extension","broadcast","builder","getServiceVersion","plugin-msg","browser.updating_tips","ipcMain","warn","push","service_component_name","redirect_url","BrowserWindow","browser.cancel","message","onServiceStatusChanged","join","silence_disable_service"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x1177,308);const _0x29a3=function(e,t){return _0x1177[e-=426]},_0x63dc14=_0x29a3,_0x1f11=[_0x63dc14(487),_0x63dc14(501),_0x63dc14(525),_0x63dc14(507),_0x63dc14(504),"ensureDir","__importDefault",_0x63dc14(428),_0x63dc14(515),_0x63dc14(458),"Project","service-",_0x63dc14(466),_0x63dc14(456),_0x63dc14(510),"require","wirteEnableService","./protocol",_0x63dc14(427),_0x63dc14(438),_0x63dc14(540),"download_url",_0x63dc14(435),_0x63dc14(434),_0x63dc14(474),_0x63dc14(497),_0x63dc14(542),_0x63dc14(509),"target not exist!",_0x63dc14(517),_0x63dc14(477),"version","global","getCreatorVersion",_0x63dc14(529),_0x63dc14(486),_0x63dc14(536),"query-uuid",_0x63dc14(437),_0x63dc14(467),_0x63dc14(538),"load",_0x63dc14(492),"__esModule","all","replace","dependency","registerPluginsI18n",_0x63dc14(493),_0x63dc14(442),_0x63dc14(534),_0x63dc14(446),_0x63dc14(524),"success",_0x63dc14(495),_0x63dc14(531),_0x63dc14(506),"pluginExists",_0x63dc14(455),_0x63dc14(476),_0x63dc14(431),_0x63dc14(483),_0x63dc14(518),_0x63dc14(528),_0x63dc14(459),"path",_0x63dc14(498),_0x63dc14(481),_0x63dc14(527),_0x63dc14(436),_0x63dc14(471),"log",_0x63dc14(452),_0x63dc14(526),"electron",_0x63dc14(537),"Message","installPlugin",_0x63dc14(485),_0x63dc14(496),_0x63dc14(489),_0x63dc14(547),_0x63dc14(447),_0x63dc14(535),"csPlugin",_0x63dc14(513),_0x63dc14(545),_0x63dc14(541),".prefab",_0x63dc14(468),"assets/cloud-component",_0x63dc14(512),"focus","import","db://assets/cloud-component/","close",_0x63dc14(432),_0x63dc14(503),_0x63dc14(530),_0x63dc14(491),_0x63dc14(539),_0x63dc14(469),_0x63dc14(521),_0x63dc14(544),_0x63dc14(532),_0x63dc14(478),"join",_0x63dc14(449),"message",_0x63dc14(511),_0x63dc14(519),_0x63dc14(484),"logout",_0x63dc14(457),_0x63dc14(479),_0x63dc14(453),"cocos-service",_0x63dc14(440),_0x63dc14(448),_0x63dc14(439),"size",_0x63dc14(461),_0x63dc14(463),_0x63dc14(499),_0x63dc14(514),_0x63dc14(490),_0x63dc14(444),_0x63dc14(430),_0x63dc14(488),_0x63dc14(451),_0x63dc14(533),_0x63dc14(433),"service:i18nChange",_0x63dc14(462),_0x63dc14(508),_0x63dc14(450),_0x63dc14(426),_0x63dc14(465),_0x63dc14(473),_0x63dc14(429),_0x63dc14(441),_0x63dc14(522)];!function(e,t){!function(t){const s=_0x29a3;for(;--t;)e[s(475)](e.shift())}(++t)}(_0x1f11,107);const _0x46aa=function(e,t){return _0x1f11[e-=412]},_0x4de71b=_0x46aa;var __importDefault=this&&this[_0x4de71b(453)]||function(e){return e&&e[_0x4de71b(490)]?e:{default:e}};Object[_0x63dc14(502)](exports,_0x63dc14(520),{value:!0}),exports[_0x4de71b(549)]=exports[_0x4de71b(488)]=exports[_0x4de71b(470)]=void 0;const electron_1=require(_0x4de71b(521)),utils_1=require(_0x4de71b(520)),plugin_1=__importDefault(require(_0x4de71b(473))),protocol_1=__importDefault(require(_0x4de71b(464))),_inner_1=require(_0x4de71b(481)),fs_extra_1=require(_0x4de71b(546)),path_1=require(_0x4de71b(512));let popupWindows=new Map,firstRun=!0;async function load(){const e=_0x63dc14,t=_0x4de71b;Editor[t(495)].on(t(544),exports[t(470)][e(451)]),Editor[t(495)].on(t(417),exports[t(470)][t(434)]),electron_1[e(473)].on(t(440),exports[t(470)][t(469)]),await plugin_1[t(474)][t(494)]()}function unload(){const e=_0x63dc14,t=_0x4de71b;Editor[t(495)][t(533)](e(503),exports[t(470)][e(451)]),Editor[t(495)][t(533)](t(417),exports[t(470)][t(434)]),electron_1[t(443)][t(533)](t(440),exports[t(470)][e(435)])}exports[_0x4de71b(470)]={async openServicePanel(e){const t=_0x63dc14,s=_0x4de71b;await Editor.Panel[t(452)](s(421))?(await Editor[s(420)][s(539)](s(421)),utils_1[s(438)].sendMsg(utils_1[t(462)][t(487)],s(517),s(534),"service:handle-penetrate-param",e)):await Editor[t(453)][t(527)](t(505),e)},openPopup(e,t,s){const _=_0x63dc14,c=_0x4de71b;try{if(!popupWindows[_(452)](e))return void Editor[c(420)][c(515)](c(446),e,t);{let t=popupWindows[c(503)](e);null==t||t[c(539)]()}}catch(t){popupWindows[_(465)](e)}},closePopup(e){const t=_0x4de71b;try{if(popupWindows[t(519)](e)){let s=popupWindows[t(503)](e);null==s||s[t(542)](),popupWindows[t(442)](e)}}catch(s){popupWindows[t(442)](e)}},printLog(e,t){const s=_0x4de71b;s(538)===e&&console[s(538)](t),s(466)===e&&console[s(466)](t),"log"===e&&console[s(518)](t),s(471)===e&&console[s(471)](t)},popupShow(e,t){const s=_0x63dc14,_=_0x4de71b;let c=electron_1[_(552)][s(543)](e[_(431)]),i=t[_(460)];null!==c&&i&&popupWindows[_(459)](i,c)},async userChanged(){const e=_0x63dc14,t=_0x4de71b;await Editor[e(453)][t(519)](e(505))&&Editor[t(523)][t(455)](e(505),e(471),t(534),t(465))},apiRequest:async(e,t={})=>_0x63dc14(477)===e?await protocol_1[_0x4de71b(474)].getRedirectUrl(t[_0x4de71b(477)]):new Promise((s,_)=>protocol_1[_0x4de71b(474)][_0x4de71b(424)](e,t)[_0x4de71b(449)](s)[_0x4de71b(530)](e=>_(new Error(JSON[_0x4de71b(502)](e))))),async enableService(e,t,s=""){const _=_0x63dc14,c=_0x4de71b;e.startsWith(c(458))||(e="service-"+e);let i=(await utils_1[c(496)][c(415)]())[_(464)](t=>t[c(506)]===e);if(void 0===i)throw new Error(utils_1[_(462)].tr(_(460)));let d=(await utils_1[_(442)][c(418)]()||{app_id:_(497)})[_(488)];if(c(472)===d)try{let e=await _inner_1[c(499)]();d=e[c(433)],await utils_1[c(496)][c(423)](e);let t=await utils_1[_(442)][c(498)]();t&&(s=t[c(414)])}catch(e){return e[c(413)]}try{let e=await utils_1.csProtocol[c(527)](d);t&&"0"!==i[c(456)]&&!e[c(534)][c(429)](i[_(486)])&&await utils_1[c(444)][c(450)](d,i[c(482)]),await utils_1[c(496)][c(463)](i[c(482)],t,s)[c(530)](utils_1[c(416)][c(522)]),utils_1[c(416)][c(466)](utils_1[c(438)].tr(t?_(500):c(508))[c(492)](c(483),i.service_name))}catch(e){return e[_(480)]}return plugin_1[c(474)][c(504)](e)||await plugin_1[c(474)][c(524)](e,i[c(528)],(e,t)=>{const s=c;t&&utils_1[s(438)].tr(s(529))}),c(500)},pluginMsg:async(e,t,s={})=>_0x4de71b(534)===e&&await Editor[_0x4de71b(420)][_0x4de71b(519)]("cocos-service")?await utils_1[_0x4de71b(438)][_0x4de71b(432)](utils_1[_0x4de71b(438)][_0x4de71b(447)],"plugin-msg-service",t,s):_0x4de71b(439)===e&&popupWindows[_0x4de71b(425)]>0?await utils_1[_0x4de71b(438)][_0x4de71b(432)](utils_1[_0x4de71b(438)][_0x4de71b(447)],_0x4de71b(545),t,s):_0x4de71b(475),serviceReady(){firstRun&&(firstRun=!1,setTimeout(async()=>{const e=_0x29a3,t=_0x46aa;let s=await utils_1[t(444)][t(510)]();if(1===utils_1[t(461)][t(516)](s[t(493)],utils_1[t(438)][t(480)]()))return;if(1!==utils_1[t(461)].compareVersion(s[t(478)],utils_1[t(438)][e(470)]()))return;if(0!==await utils_1[t(438)][t(550)](t(466),utils_1[e(462)].tr(t(489)),utils_1[t(438)].tr(t(501)),[utils_1[t(438)].tr("browser.update_now"),utils_1[t(438)].tr(t(419))],0))return;let _=await utils_1[e(516)][t(503)](s[t(468)],{});utils_1[e(484)][t(466)](utils_1.csEditor.tr(e(472))),utils_1[t(438)].sendMsg(t(486),t(445),_.download_url,utils_1[e(462)][t(447)],t(479)),Editor.Panel[t(542)](utils_1[e(462)][t(447)])},5e3))},async i18nChange(){const e=_0x4de71b;utils_1[e(438)][e(412)](e(487)),await Editor[e(420)][e(519)](e(421))&&Editor[e(523)][e(455)](e(421),e(517),e(534),e(437))},async onServiceStatusChanged(e){const t=_0x63dc14,s=_0x4de71b;var _;try{let c=utils_1[s(531)][s(467)](e[s(506)]);if(void 0===c||!(null===(_=c[s(548)])||void 0===_?void 0:_[s(435)]))return;let i={};i[s(482)]=e[t(486)],i[s(506)]=e[s(506)],i[s(422)]=e[s(422)]||!1,i[s(427)]=await utils_1[s(496)][t(523)](e[s(482)]);let d=utils_1[s(461)][s(462)](c[s(512)],c[s(548)][s(435)]);d[t(481)]&&await d[s(514)](utils_1.csEditor.getProjectPath(),i)}catch(e){utils_1[s(416)][s(522)](e)}},async dropScene(e,t,s){const _=_0x4de71b;await Promise.all(s[_(526)](async e=>{const s=_0x29a3,c=_;await exports[c(470)][c(540)](e[c(485)]);const i=c(541)+e[c(513)]+"/"+e[c(513)]+c(535),d=await Editor[c(523)][c(497)](c(505),s(445),i);utils_1[s(462)][c(525)](c(547),s(532),{position:t,assetUuid:d})}))},async dropHierarchy(e,t){const s=_0x63dc14,_=_0x4de71b;t=t||e[_(507)],await Promise[s(494)](t[_(526)](async e=>{const t=s,c=_,i=e[c(543)]||e[c(436)]||e.to;await exports[c(470)][c(540)](e[t(437)]);const d=c(541)+e[c(513)]+"/"+e[c(513)]+c(535),o=await Editor[t(454)].request(c(505),c(484),d);utils_1[c(438)][c(525)](t(539),c(551),{parent:i,assetUuid:o})}))},async dropAssets(e,t){const s=_0x4de71b;t=t||e[s(507)],await Promise[s(491)](t[s(526)](async e=>await exports[s(470)][s(540)](e[s(485)])))},async import(e){const t=_0x63dc14,s=_0x4de71b;if(!fs_extra_1[s(441)](e))return;const _={cloud_json:path_1.join(e,"package.json"),assets:path_1[s(553)](e,s(428)),function:path_1[s(553)](e,s(430)),install:path_1[t(482)](e,t(546))};if(!fs_extra_1[t(426)](_[s(426)]))throw new Error(s(476));const c=fs_extra_1[s(454)](_[s(426)]),i={root:path_1[s(553)](Editor[s(457)][s(512)],s(537)),assets:path_1.join(Editor[s(457)][s(512)],s(537),c.name)};await fs_extra_1[s(452)](i[s(451)]);try{fs_extra_1[t(426)](_[s(428)])&&!fs_extra_1[t(426)](i[s(428)])&&await fs_extra_1[s(448)](_[s(428)],i[s(428)]),fs_extra_1.existsSync(_[s(509)])&&(utils_1[s(461)].deleteCache(_[t(518)]),await require(_[s(509)])[s(435)]({assetsPath:i[s(428)]}))}catch(e){utils_1[s(416)][t(512)](e),fs_extra_1[s(441)](i[s(428)])&&await fs_extra_1[t(443)](i[s(428)])}await Editor[t(454)][s(497)](s(505),s(532),i[s(451)]),Editor[s(523)][s(536)](s(511))}},exports[_0x4de71b(488)]=load,exports[_0x4de71b(549)]=unload;