const _0x1e89=["ipcMain","./protocol","map","assets","update-extension","target not exist!","userChanged","broadcastMsg","builder","asset-db","find","copy","compareVersion","pluginExists","csHttp","cocos-service","create-node","service:handle-penetrate-param","main","query-uuid","service:i18nChange","target","deleteCache","values","set","version","remove","redirect_url","BrowserWindow","csConfig","./plugin","db://assets/cloud-component/","stringify","getProjectPath","existsSync","unload","default","dialog_title","cloud_json","readConfigSet","fs-extra","app_id","service","installed","readBindGame","scene","Project","getGameDetail","enable","debug","dialogMsgBox","apiPost","plugin-msg-popup","node","has","getCreatorVersion","readServiceList","package_download_url","cocos-service:popup-show","csLogger","global","electron","open","message","silence_disable_service","writeBindGame","download_url","${name}","size","plugin-msg","service_type","install","csEditor","cocos-service:service-data-change","plugin-msg-service","defineProperty","service_component_name","includes","config_id","User","cloud-component:update-import","csUtil","wirteEnableService","broadcast","push","load","assets/cloud-component","popup","join","getCustomPlugin","name","registerPluginsI18n","dependency","value","success","startsWith","refresh-asset","close","silenceCreateGame","service_name","service_id","delete","replace","focus","../utils","readServiceParam","getRedirectUrl","import","warn",".prefab","ensureDir","requestMsg","log","onServiceStatusChanged","Panel","cloud-function","sender","fromWebContents","package.json is not found.","installPlugin","error","getServicePluginInfo","send","Message","browser.updating_tips","request","removeListener","methods","then","extension","root","getServiceVersion","info","csProtocol","popupShow","get","readJSONSync","browser.cancel"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x1e89,291);const _0x14ab=function(e,t){return _0x1e89[e-=305]},_0x23d7bb=_0x14ab,_0x2e23=[_0x23d7bb(423),"ipcMain",_0x23d7bb(319),_0x23d7bb(407),_0x23d7bb(420),_0x23d7bb(359),_0x23d7bb(345),_0x23d7bb(346),_0x23d7bb(411),_0x23d7bb(437),_0x23d7bb(393),_0x23d7bb(322),_0x23d7bb(395),_0x23d7bb(371),"package.json",_0x23d7bb(309),_0x23d7bb(397),"map",_0x23d7bb(352),_0x23d7bb(375),"logout",_0x23d7bb(368),"service_name_error",_0x23d7bb(399),_0x23d7bb(390),"csPlugin",_0x23d7bb(440),"onServiceStatusChanged","service:userChanged",_0x23d7bb(357),_0x23d7bb(313),_0x23d7bb(339),_0x23d7bb(338),_0x23d7bb(378),_0x23d7bb(389),_0x23d7bb(306),_0x23d7bb(400),_0x23d7bb(376),_0x23d7bb(412),_0x23d7bb(424),_0x23d7bb(369),_0x23d7bb(311),_0x23d7bb(408),"builder",_0x23d7bb(305),_0x23d7bb(350),_0x23d7bb(335),_0x23d7bb(307),_0x23d7bb(326),"cocos-service.simple",_0x23d7bb(356),"UNKNOW",_0x23d7bb(439),_0x23d7bb(433),_0x23d7bb(341),_0x23d7bb(334),"browser.update_tips","require",_0x23d7bb(419),_0x23d7bb(384),_0x23d7bb(380),"silence_open_service",_0x23d7bb(418),_0x23d7bb(441),_0x23d7bb(387),_0x23d7bb(349),_0x23d7bb(381),_0x23d7bb(405),"__esModule",_0x23d7bb(343),"path","catch",_0x23d7bb(325),_0x23d7bb(354),_0x23d7bb(401),_0x23d7bb(366),_0x23d7bb(328),_0x23d7bb(431),_0x23d7bb(379),_0x23d7bb(332),_0x23d7bb(427),_0x23d7bb(315),_0x23d7bb(362),_0x23d7bb(438),_0x23d7bb(409),"pluginName",_0x23d7bb(358),"all",_0x23d7bb(413),_0x23d7bb(394),_0x23d7bb(361),_0x23d7bb(425),_0x23d7bb(442),_0x23d7bb(434),_0x23d7bb(330),_0x23d7bb(320),_0x23d7bb(415),"service-",_0x23d7bb(421),_0x23d7bb(422),"install.js",_0x23d7bb(353),_0x23d7bb(308),_0x23d7bb(348),_0x23d7bb(327),_0x23d7bb(333),_0x23d7bb(347),_0x23d7bb(355),_0x23d7bb(360),_0x23d7bb(323),_0x23d7bb(373),_0x23d7bb(391),_0x23d7bb(383),_0x23d7bb(342),_0x23d7bb(377),_0x23d7bb(317),_0x23d7bb(416),_0x23d7bb(364),_0x23d7bb(429),_0x23d7bb(404),"login","sendMsg","browser.update_now",_0x23d7bb(410),_0x23d7bb(321),_0x23d7bb(396),"has",_0x23d7bb(406),"params",_0x23d7bb(386),_0x23d7bb(324),_0x23d7bb(417),"plugin",_0x23d7bb(314),"Project","__importDefault",_0x23d7bb(432),_0x23d7bb(392),_0x23d7bb(385),_0x23d7bb(312)];!function(e,t){!function(t){const _=_0x14ab;for(;--t;)e[_(374)](e.shift())}(++t)}(_0x2e23,309);const _0x574c=function(e,t){return _0x2e23[e-=174]},_0x38f396=_0x574c;var __importDefault=this&&this[_0x38f396(280)]||function(e){return e&&e[_0x38f396(213)]?e:{default:e}};Object[_0x23d7bb(365)](exports,_0x38f396(213),{value:!0}),exports[_0x38f396(217)]=exports[_0x38f396(304)]=exports[_0x38f396(276)]=void 0;const electron_1=require(_0x23d7bb(351)),utils_1=require(_0x38f396(234)),plugin_1=__importDefault(require(_0x38f396(240))),protocol_1=__importDefault(require(_0x38f396(263))),_inner_1=require("../utils/_inner"),fs_extra_1=require(_0x38f396(239)),path_1=require(_0x38f396(215));let popupWindows=new Map,firstRun=!0;async function load(){const e=_0x23d7bb,t=_0x38f396;Editor[t(185)].on(t(265),exports[e(417)][t(238)]),Editor[t(185)].on(t(305),exports[e(417)][t(238)]),electron_1[t(286)].on(e(348),exports[t(276)][t(184)]),await plugin_1[t(193)][t(211)]()}function unload(){const e=_0x23d7bb,t=_0x38f396;Editor[e(369)][t(261)](t(265),exports[t(276)][t(238)]),Editor[t(185)][t(261)](t(305),exports[e(417)][t(238)]),electron_1[e(428)].removeListener(t(248),exports[t(276)].popupShow)}exports[_0x23d7bb(417)]={async openServicePanel(e){const t=_0x23d7bb,_=_0x38f396;await Editor[_(264)][_(271)](_(189))?(await Editor[_(264)][_(295)](_(189)),utils_1[_(227)][_(266)](utils_1[t(362)][_(277)],"plugin-msg",_(224),_(192),e)):await Editor[_(264)][_(303)](_(189),e)},openPopup(e,t,_){const s=_0x23d7bb,i=_0x38f396;try{if(!popupWindows[i(271)](e))return void Editor[i(264)][s(352)](i(194),e,t);{let t=popupWindows[i(236)](e);null==t||t[s(393)]()}}catch(t){popupWindows[i(256)](e)}},closePopup(e){const t=_0x23d7bb,_=_0x38f396;try{if(popupWindows[t(344)](e)){let s=popupWindows[_(236)](e);null==s||s[t(387)](),popupWindows[_(256)](e)}}catch(t){popupWindows[_(256)](e)}},printLog(e,t){const _=_0x23d7bb,s=_0x38f396;s(268)===e&&console[s(268)](t),s(244)===e&&console[s(244)](t),_(402)===e&&console[_(402)](t),_(398)===e&&console.warn(t)},popupShow(e,t){const _=_0x38f396;let s=electron_1[_0x23d7bb(318)][_(288)](e[_(272)]),i=t[_(230)];null!==s&&i&&popupWindows[_(278)](i,s)},async userChanged(){const e=_0x23d7bb,t=_0x38f396;await Editor.Panel.has(t(189))&&Editor[t(233)][e(412)](e(305),t(290),t(224),t(313))},apiRequest:async(e,t={})=>_0x38f396(260)===e?await protocol_1[_0x38f396(193)][_0x38f396(270)](t[_0x38f396(260)]):new Promise((_,s)=>protocol_1[_0x38f396(193)][_0x38f396(199)](e,t)[_0x38f396(207)](_)[_0x38f396(216)](e=>s(new Error(JSON[_0x38f396(296)](e))))),async enableService(e,t,_=""){const s=_0x23d7bb,i=_0x38f396;e[i(283)](i(242))||(e=i(242)+e);let b=(await utils_1[s(319)][i(292)]())[i(228)](t=>t[i(220)]===e);if(void 0===b)throw new Error(utils_1[i(227)].tr(i(307)));let o=(await utils_1[i(287)][i(200)]()||{app_id:i(196)}).app_id;if(i(196)===o)try{let e=await _inner_1[s(388)]();o=e[s(331)],await utils_1[s(319)][i(252)](e);let t=await utils_1[s(319)][s(329)]();t&&(_=t[i(306)])}catch(e){return e[i(246)]}try{let e=await utils_1[i(285)][s(337)](o);t&&"0"!==b[i(253)]&&!e[i(224)][s(367)](b[s(390)])&&await utils_1[i(285)].openService(o,b[i(309)]),await utils_1[i(287)][s(372)](b[i(309)],t,_)[i(216)](utils_1[i(210)][i(176)]),utils_1[i(210)][i(244)](utils_1[i(227)].tr(i(t?206:218))[i(282)](i(174),b[i(179)]))}catch(e){return e[s(353)]}return plugin_1[s(326)][i(208)](e)||await plugin_1[i(193)][i(229)](e,b[i(251)],(e,t)=>{const _=i;t&&utils_1[_(227)].tr(_(250))}),i(204)},pluginMsg:async(e,t,_={})=>"service"===e&&await Editor[_0x38f396(264)][_0x38f396(271)](_0x38f396(189))?await utils_1[_0x38f396(227)][_0x38f396(219)](utils_1[_0x38f396(227)][_0x38f396(277)],_0x38f396(262),t,_):_0x38f396(259)===e&&popupWindows[_0x38f396(231)]>0?await utils_1[_0x23d7bb(362)][_0x38f396(219)](utils_1[_0x38f396(227)][_0x38f396(277)],_0x38f396(258),t,_):_0x38f396(198),serviceReady(){firstRun&&(firstRun=!1,setTimeout(async()=>{const e=_0x14ab,t=_0x574c;let _=await utils_1[t(285)][t(223)]();if(1===utils_1[t(298)][e(440)](_[e(382)],utils_1[t(227)][t(291)]()))return;if(1!==utils_1[t(298)][t(311)](_[t(226)],utils_1[t(227)][t(243)]()))return;if(0!==await utils_1[t(227)][e(340)](t(244),utils_1[t(227)].tr(t(201)),utils_1[t(227)].tr(t(249)),[utils_1[e(362)].tr(t(267)),utils_1[t(227)].tr(t(225))],0))return;let s=await utils_1[t(237)][e(425)](_[e(356)],{});utils_1[t(210)][t(244)](utils_1[t(227)].tr(e(414))),utils_1[e(362)][t(266)](t(203),t(281),s[t(195)],utils_1[t(227)][t(277)],t(190)),Editor[t(264)][t(209)](utils_1[t(227)][t(277)])},5e3))},async i18nChange(){const e=_0x23d7bb,t=_0x38f396;utils_1[e(362)][e(435)](e(363)),await Editor[t(264)][e(344)](e(305))&&Editor[t(233)][t(183)](t(189),t(290),t(224),e(310))},async onServiceStatusChanged(e){const t=_0x23d7bb,_=_0x38f396;var s;try{let i=utils_1[_(310)][_(293)](e[_(220)]);if(void 0===i||!(null===(s=i[t(436)])||void 0===s?void 0:s[_(247)]))return;let b={};b[_(309)]=e[_(309)],b[_(220)]=e[_(220)],b[_(177)]=e[_(177)]||!1,b[_(273)]=await utils_1[_(287)][_(297)](e[_(309)]);let o=utils_1[_(298)][_(202)](i[_(215)],i[_(188)][t(308)]);o[_(312)]&&await o[t(403)](utils_1[_(227)][_(254)](),b)}catch(e){utils_1[_(210)][t(339)](e)}},async dropScene(e,t,_){const s=_0x38f396;await Promise[s(232)](_[s(302)](async e=>{const _=_0x14ab,i=s;await exports[i(276)][i(301)](e[i(257)]);const b=_(321)+e[i(205)]+"/"+e[i(205)]+i(308),o=await Editor[i(233)][i(241)](i(294),_(309),b);utils_1[_(362)][i(266)]("scene",i(180),{position:t,assetUuid:o})}))},async dropHierarchy(e,t){const _=_0x38f396;t=t||e[_(175)],await Promise[_(232)](t[_(302)](async e=>{const t=_0x14ab,s=_,i=e[s(186)]||e[s(214)]||e.to;await exports[s(276)][s(301)](e[s(257)]);const b=s(269)+e[s(205)]+"/"+e[s(205)]+s(308),o=await Editor[s(233)][s(241)](t(437),s(300),b);utils_1[s(227)][s(266)](s(191),t(306),{parent:i,assetUuid:o})}))},async dropAssets(e,t){const _=_0x23d7bb,s=_0x38f396;t=t||e.values,await Promise[s(232)](t[_(430)](async e=>await exports[s(276)][s(301)](e[_(383)])))},async import(e){const t=_0x23d7bb,_=_0x38f396;if(!fs_extra_1[_(275)](e))return;const s={cloud_json:path_1[_(178)](e,_(299)),assets:path_1[_(178)](e,_(222)),function:path_1[t(378)](e,_(212)),install:path_1[_(178)](e,_(245))};if(!fs_extra_1[_(275)](s[_(221)]))throw new Error(_(187));const i=fs_extra_1[t(426)](s[_(221)]),b={root:path_1[_(178)](Editor[_(279)][_(215)],_(182)),assets:path_1[_(178)](Editor[t(336)][_(215)],_(182),i[_(205)])};await fs_extra_1[_(181)](b[_(289)]);try{fs_extra_1[_(275)](s[_(222)])&&!fs_extra_1[_(275)](b[t(431)])&&await fs_extra_1[_(197)](s[_(222)],b[_(222)]),fs_extra_1[_(275)](s[_(235)])&&(utils_1[t(371)][_(284)](s[_(235)]),await require(s.install)[_(247)]({assetsPath:b[_(222)]}))}catch(e){utils_1[_(210)][t(410)](e),fs_extra_1.existsSync(b[_(222)])&&await fs_extra_1[t(316)](b[_(222)])}await Editor[_(233)][_(241)](_(294),_(274),b.root),Editor[_(233)][_(255)](t(370))}},exports[_0x38f396(304)]=load,exports[_0x38f396(217)]=unload;