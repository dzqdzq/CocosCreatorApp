const _0x5d91=["userChanged","broadcastMsg","__importDefault","csLogger","main","csProtocol","wirteEnableService","enable","getCustomPlugin","installPlugin","plugin","ipcMain","replace","dialogMsgBox","BrowserWindow","then","service:userChanged","catch","getServicePluginInfo","includes","cocos-service.simple","service:i18nChange","cocos-service:service-data-change","readConfigSet","openService","focus","info","sender","csPlugin","service_name_error","compareVersion","../utils/_inner","./plugin","removeListener","plugin-msg-popup","__esModule","silenceCreateGame","User","send","service","dialog_title","onServiceStatusChanged","service_name","cocos-service","log","Message","methods","writeBindGame","service_id","installed","./protocol","dependency","path","config_id","readBindGame","service_component_name","debug","browser.cancel","builder","target not exist!","service:handle-penetrate-param","browser.update_now","version","use strict","pluginExists","popup","UNKNOW","readServiceList","get","download_url","has","startsWith","csEditor","popupShow","load","getServiceVersion","delete","find","requestMsg","plugin-msg-service","silence_open_service","login","getProjectPath","getGameDetail","pluginName","electron","Panel","error","plugin-msg","app_id","extension","shift","registerPluginsI18n","unload","defineProperty","success","require","close","service-","open","global","csUtil","default","stringify","apiPost","getCreatorVersion","${name}"];!function(e,d){!function(d){for(;--d;)e.push(e.shift())}(++d)}(_0x5d91,384);const _0x6ad8=function(e,d){return _0x5d91[e-=419]},_0x3edc9d=_0x6ad8,_0x285d=[_0x3edc9d(514),"info","readServiceParam",_0x3edc9d(492),_0x3edc9d(461),_0x3edc9d(463),_0x3edc9d(486),_0x3edc9d(459),_0x3edc9d(472),_0x3edc9d(523),_0x3edc9d(431),_0x3edc9d(501),_0x3edc9d(464),_0x3edc9d(508),_0x3edc9d(511),_0x3edc9d(428),"params",_0x3edc9d(518),_0x3edc9d(454),_0x3edc9d(460),_0x3edc9d(456),_0x3edc9d(496),_0x3edc9d(436),_0x3edc9d(476),_0x3edc9d(449),_0x3edc9d(440),_0x3edc9d(420),_0x3edc9d(522),"browser.update_tips",_0x3edc9d(515),"has",_0x3edc9d(495),_0x3edc9d(446),"UNKNOW","cocos-service:popup-show",_0x3edc9d(482),_0x3edc9d(507),"warn",_0x3edc9d(430),_0x3edc9d(457),"get",_0x3edc9d(455),_0x3edc9d(468),_0x3edc9d(450),_0x3edc9d(493),_0x3edc9d(513),_0x3edc9d(448),_0x3edc9d(480),"size",_0x3edc9d(473),_0x3edc9d(481),_0x3edc9d(506),_0x3edc9d(442),"logout",_0x3edc9d(475),_0x3edc9d(504),_0x3edc9d(458),"getRedirectUrl",_0x3edc9d(494),_0x3edc9d(467),"redirect_url",_0x3edc9d(521),_0x3edc9d(462),_0x3edc9d(441),_0x3edc9d(445),_0x3edc9d(488),_0x3edc9d(499),_0x3edc9d(519),_0x3edc9d(479),_0x3edc9d(438),"package_download_url",_0x3edc9d(470),_0x3edc9d(498),_0x3edc9d(491),"csHttp","browser.updating_tips",_0x3edc9d(469),_0x3edc9d(465),_0x3edc9d(505),_0x3edc9d(477),_0x3edc9d(429),_0x3edc9d(432),_0x3edc9d(444),_0x3edc9d(452),_0x3edc9d(516),_0x3edc9d(439),"sendMsg","csConfig","set",_0x3edc9d(525),_0x3edc9d(435),_0x3edc9d(502),_0x3edc9d(451),_0x3edc9d(474),_0x3edc9d(512),_0x3edc9d(520),"methods",_0x3edc9d(524),"service_type",_0x3edc9d(425),_0x3edc9d(466),_0x3edc9d(423),_0x3edc9d(453),_0x3edc9d(437),_0x3edc9d(500)];!function(e,d){!function(d){const t=_0x6ad8;for(;--d;)e.push(e[t(447)]())}(++d)}(_0x285d,186);const _0xd30c=function(e,d){return _0x285d[e-=449]},_0x268aee=_0xd30c;_0x3edc9d(419);var __importDefault=this&&this[_0x268aee(550)]||function(e){return e&&e[_0x268aee(545)]?e:{default:e}};Object[_0x268aee(516)](exports,_0x268aee(545),{value:!0}),exports[_0x268aee(497)]=exports[_0x268aee(511)]=exports[_0x268aee(464)]=void 0;const electron_1=require(_0x268aee(536)),utils_1=require("../utils"),plugin_1=__importDefault(require(_0x268aee(504))),protocol_1=__importDefault(require(_0x268aee(518))),_inner_1=require(_0x268aee(531));let popupWindows=new Map,firstRun=!0;async function load(){const e=_0x3edc9d,d=_0x268aee;Editor[d(472)].on(e(437),exports[d(464)].userChanged),Editor[d(472)].on(d(526),exports[d(464)][d(478)]),electron_1[d(461)].on(d(507),exports[d(464)][d(553)]),await plugin_1.default[d(519)]()}function unload(){const e=_0x3edc9d,d=_0x268aee;Editor[d(472)][d(494)](d(471),exports[d(464)][d(478)]),Editor[d(472)][d(494)](d(526),exports[d(464)][e(463)]),electron_1[d(461)][e(496)](d(507),exports[e(509)][d(553)])}exports[_0x268aee(464)]={async openServicePanel(e){const d=_0x3edc9d,t=_0x268aee;await Editor.Panel[d(426)](t(524))?(await Editor[t(525)][t(538)](t(524)),utils_1[t(488)][t(454)](utils_1[t(488)][t(522)],d(444),t(459),t(482),e)):await Editor[t(525)][t(514)](d(506),e)},openPopup(e,d,t){const _=_0x3edc9d,i=_0x268aee;try{if(!popupWindows[i(503)](e))return void Editor[i(525)][i(514)](_(483),e,d);{let d=popupWindows.get(e);null==d||d[i(538)]()}}catch(d){popupWindows[i(449)](e)}},closePopup(e){const d=_0x3edc9d,t=_0x268aee;try{if(popupWindows[t(503)](e)){let _=popupWindows[d(424)](e);null==_||_[t(470)](),popupWindows[t(449)](e)}}catch(d){popupWindows[t(449)](e)}},printLog(e,d){const t=_0x3edc9d,_=_0x268aee;t(443)===e&&console[t(443)](d),t(489)===e&&console[_(474)](d),_(509)===e&&console[_(509)](d),_(510)===e&&console[_(510)](d)},popupShow(e,d){const t=_0x3edc9d,_=_0x268aee;let i=electron_1[_(552)].fromWebContents(e[t(490)]),c=d[_(498)];null!==i&&c&&popupWindows[_(456)](c,i)},async userChanged(){const e=_0x3edc9d,d=_0x268aee;await Editor[d(525)][e(426)](d(524))&&Editor[d(486)][e(501)](e(506),d(450),d(459),d(541))},apiRequest:async(e,d={})=>_0x268aee(533)===e?await protocol_1[_0x268aee(529)][_0x268aee(530)](d[_0x268aee(533)]):new Promise((t,_)=>protocol_1[_0x268aee(529)][_0x268aee(492)](e,d)[_0x3edc9d(478)](t).catch(e=>_(new Error(JSON[_0x268aee(480)](e))))),async enableService(e,d,t=""){const _=_0x3edc9d,i=_0x268aee;e[_(427)](i(491))||(e=i(491)+e);let c=(await utils_1[i(455)][i(469)]())[_(433)](d=>d[i(490)]===e);if(void 0===c)throw new Error(utils_1[i(488)].tr(i(476)));let s=(await utils_1[i(455)][_(517)]()||{app_id:i(506)})[i(537)];if(_(422)===s){let e=await _inner_1[i(539)]();s=e[i(537)],await utils_1[i(455)][_(510)](e);let d=await utils_1[i(455)][i(479)]();d&&(t=d[i(452)])}let o=await utils_1[i(515)][i(453)](s);return d&&"0"!==c[i(466)]&&!o[i(459)][i(508)](c[_(511)])&&await utils_1[i(515)][_(487)](s,c[i(487)]),await utils_1[i(455)][i(549)](c[i(487)],d,t)[i(520)](utils_1[i(468)][i(540)]),utils_1[_(466)][_(489)](utils_1[_(428)].tr(d?i(495):"silence_disable_service")[i(527)](i(535),c[i(551)])),plugin_1[i(529)][i(499)](e)||await plugin_1[_(458)][i(481)](e,c[i(543)],(e,d)=>{const t=i;d&&utils_1[t(488)].tr(t(462))}),i(460)},pluginMsg:async(e,d,t={})=>_0x3edc9d(502)===e&&await Editor[_0x268aee(525)][_0x268aee(503)](_0x268aee(524))?await utils_1[_0x3edc9d(428)].requestMsg(utils_1.csEditor[_0x268aee(522)],_0x268aee(458),d,t):_0x3edc9d(421)===e&&popupWindows[_0x268aee(521)]>0?await utils_1[_0x268aee(488)][_0x3edc9d(434)](utils_1[_0x268aee(488)][_0x3edc9d(473)],_0x3edc9d(497),d,t):_0x268aee(500),async sceneReady(){const e=_0x3edc9d,d=_0x268aee;if(!firstRun)return;firstRun=!1;let t=await utils_1[d(515)][e(471)]();if(1===utils_1[d(512)][d(517)](t[d(473)],utils_1[e(428)][d(477)]()))return;if(1!==utils_1.csUtil[e(493)](t[d(457)],utils_1[e(428)][d(483)]()))return;if(0!==await utils_1[d(488)][d(496)](d(474),utils_1[e(428)].tr(d(501)),utils_1[d(488)].tr(e(503)),[utils_1[e(428)].tr(d(465)),utils_1[d(488)].tr(d(463))],0))return;let _=await utils_1[d(547)][d(513)](t[d(467)],{});utils_1.csLogger[d(474)](utils_1[d(488)].tr(d(548))),utils_1[d(488)][d(454)](d(505),"update-extension",_[d(467)],utils_1[d(488)][d(522)],d(493)),Editor[d(525)][d(470)](utils_1[d(488)][d(522)])},async i18nChange(){const e=_0x3edc9d,d=_0x268aee;utils_1[d(488)][d(485)](e(485)),await Editor[d(525)][d(503)](e(506))&&Editor.Message[d(484)](d(524),e(444),d(459),e(484))},async onServiceStatusChanged(e){const d=_0x3edc9d,t=_0x268aee;var _;try{let i=utils_1[t(546)][t(523)](e[d(518)]);if(void 0===i||!(null===(_=i[t(534)])||void 0===_?void 0:_[t(532)]))return;let c={};c[t(487)]=e[t(487)],c[t(490)]=e[d(518)],c[d(470)]=e[t(544)]||!1,c[t(489)]=await utils_1[t(455)][t(475)](e[t(487)]);let s=utils_1.csUtil[t(451)](i[t(502)],i[d(521)][d(467)]);s[t(528)]&&await s[t(528)](utils_1[t(488)][t(542)](),c)}catch(e){utils_1.csLogger[t(540)](e)}}},exports[_0x3edc9d(430)]=load,exports[_0x268aee(497)]=unload;