"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.methods=exports.listeners=exports.ready=exports.$=exports.style=exports.template=void 0;const electron_1=require("electron"),plugin_1=__importDefault(require("./plugin")),utils_1=require("../utils");async function ready(e,t){var i;electron_1.ipcRenderer.send("cocos-service:popup-show",{pluginName:e}),await plugin_1.default.loadPopup(e),this.pluginName=e;let o=plugin_1.default.getServicePluginInfo(e),s=null===(i=null===o||void 0===o?void 0:o.contents)||void 0===i?void 0:i.popup;if(document.title=(null===s||void 0===s?void 0:s.title)||e,this.plugin=plugin_1.default.getServicePlugin(e,"popup"),this.plugin){let i=this.$.container;i.attachShadow({mode:"open"}),i.shadowRoot&&plugin_1.default.createInnerHTML(this.plugin,i.shadowRoot,e,"item"),this.plugin.ready&&await this.plugin.ready(t)}}async function beforeClose(){var e;return await(null===(e=this.plugin)||void 0===e?void 0:e.canClose())}async function close(){utils_1.csPlugin.closePopup(this.pluginName)}exports.template=utils_1.csFile.readFile(__dirname,"./panel.html"),exports.style=utils_1.csFile.readFile(__dirname,"./panel.css"),exports.$={container:"#container"},exports.ready=ready,exports.listeners={},exports.methods={pluginMsg:async(e,t={})=>new Promise((i,o)=>{if(void 0===utils_1.csEvent.eventNames().find(t=>t===e))return o(new Error("msg not exist!"));utils_1.csEvent.emit(e,t,(e,t)=>e?o(e instanceof Error?e:new Error(JSON.stringify(e))):i(t))})},exports.beforeClose=beforeClose,exports.close=close;