"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPlatformID=exports.processCommonNativeModule=exports.updateConfigInfos=exports.checkCocosService=exports.checkUsedCocosService=exports.generateServiceConfigInfo=void 0;const path_1=require("path"),utils_1=require("../../utils"),native_1=require("./native");async function generateServiceConfigInfo(e,i,o=""){let a=[];try{await Promise.all(e.map(async e=>{var t;let c=utils_1.csPlugin.getServicePluginInfo(e.service_component_name);if(void 0===c||!(null===(t=c.builder)||void 0===t?void 0:t.main))return;let r={};r.service_id=e.service_id,r.service_component_name=e.service_component_name,r.builder=path_1.join(c.path,c.builder.main),r.enable=i.has(e.service_id),r.params=await utils_1.csConfig.readServiceParam(e.service_id,o),a.push(r)}))}catch(e){utils_1.csLogger.debug(e)}return a}async function checkUsedCocosService(){let e=await utils_1.csConfig.readBindGame();if(void 0===e||null===e)return!1;if(0===(await utils_1.csConfig.readConfigSets()).length)return!1;let i=await utils_1.csConfig.readConfigSet();return void 0!==i&&null!==i}async function checkCocosService(e){var i;return!!await checkUsedCocosService()&&!(null===(i=e.packages["cocos-service"])||void 0===i||!i.configID)}async function updateConfigInfos(e){try{const i=e.packages["cocos-service"].configID,o=await utils_1.csConfig.readServiceList(),a=new Set(await utils_1.csConfig.readEnableServices(i)),t=await generateServiceConfigInfo(o,a,i);e.packages["cocos-service"].services=t}catch(e){utils_1.csLogger.debug(e)}}async function processCommonNativeModule(e){let i=path_1.dirname(e.paths.dir),o=path_1.join(utils_1.csEditor.getProjectPath(),"native");native_1.generateServiceCamke(i),native_1.insertServiceCmakeToCmakeList(o)}function getPlatformID(e){let i=e.packages[e.platform],o="";return["mac","ios","android"].includes(e.platform)?o=i.packageName:"huawei-agc"===e.platform?o=e.packages.android.packageName:["wechatgame","baidu-mini-game","bytedance-mini-game"].includes(e.platform)?o=i.appid:["qtt","oppo-mini-game","vivo-mini-game","huawei-quick-game","xiaomi-quick-game"].includes(e.platform)&&(o=i.package),`${e.platform}$$${o}`}exports.generateServiceConfigInfo=generateServiceConfigInfo,exports.checkUsedCocosService=checkUsedCocosService,exports.checkCocosService=checkCocosService,exports.updateConfigInfos=updateConfigInfos,exports.processCommonNativeModule=processCommonNativeModule,exports.getPlatformID=getPlatformID;