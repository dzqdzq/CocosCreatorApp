const _0x6e65=["csLogger","find","insertServiceCmakeToCmakeList","csAnalytics","serviceIntegrationSuccess","csEditor","getUserData","./native","service_component_name","cocos-service","onAfterCompressSettings","existsSync","onBeforeBuild","readBindGame","push","__esModule","serviceIntegrationFailed","require","onAfterBuild","checkUsedCocosService","./common","Building Time","native","paths","services","generateServiceConfigInfo","debug","onBeforeCompressSettings","readServiceList","generateServiceCamke","path","clear","configID","dirname","csUtil","csConfig","../../utils","cocos_uid","throwError","shift","length","use strict","message","packages","has","service_id","builder","get","stringify","fs-extra"];!function(e,t){!function(t){for(;--t;)e.push(e.shift())}(++t)}(_0x6e65,189);const _0x2b76=function(e,t){return _0x6e65[e-=206]},_0x16f31e=_0x2b76,_0x34e0=["set","onAfterBuild","readEnableServices",_0x16f31e(210),_0x16f31e(226),_0x16f31e(220),_0x16f31e(216),_0x16f31e(222),"getProjectPath",_0x16f31e(253),_0x16f31e(215),"services",_0x16f31e(224),_0x16f31e(207),_0x16f31e(228),"join",_0x16f31e(223),"defineProperty",_0x16f31e(247),_0x16f31e(214),_0x16f31e(229),_0x16f31e(230),_0x16f31e(211),_0x16f31e(234),_0x16f31e(213),_0x16f31e(225),_0x16f31e(250),_0x16f31e(245),_0x16f31e(251),_0x16f31e(254),_0x16f31e(238),_0x16f31e(237),_0x16f31e(252),_0x16f31e(212),_0x16f31e(244),_0x16f31e(232),_0x16f31e(209),_0x16f31e(227),"find"];!function(e,t){!function(t){const i=_0x2b76;for(;--t;)e[i(231)](e[i(206)]())}(++t)}(_0x34e0,319);const _0x1904=function(e,t){return _0x34e0[e-=341]},_0x3f6b27=_0x1904;_0x16f31e(208),Object[_0x3f6b27(351)](exports,_0x3f6b27(369),{value:!0}),exports[_0x16f31e(235)]=exports[_0x3f6b27(371)]=exports[_0x3f6b27(368)]=exports[_0x16f31e(229)]=exports.throwError=void 0;const fs_extra_1=require(_0x3f6b27(379)),path_1=require(_0x3f6b27(352)),utils_1=require(_0x3f6b27(343)),native_1=require(_0x3f6b27(346)),common_1=require(_0x3f6b27(365));exports[_0x16f31e(255)]=!0;let buildCache=new Map,processServiceHooks=async(e,t,i)=>{const o=_0x16f31e,s=_0x3f6b27;let r=e[s(376)][s(377)];if(void 0!==r&&0!==r[s(345)][s(347)]){s(354)===i&&buildCache[o(248)]();for(const c of r[o(241)]){if(!fs_extra_1[s(348)](c[o(213)]))break;buildCache[s(356)](c[s(359)])||buildCache[s(373)](c[o(225)],utils_1[s(362)][s(357)](c[s(358)]));let r=buildCache[s(353)](c.service_component_name);if(void 0===r)break;try{switch(i){case o(229):r[s(354)]&&await r[s(354)](e,t);break;case s(368):r.onBeforeCompressSettings&&await r[s(368)](e,t);break;case s(371):r[s(371)]&&await r[s(371)](e,t);break;case s(374):r[s(374)]&&await r[s(374)](e,t);let n=(await utils_1[s(341)][s(350)]())[s(363)],a=await utils_1[s(366)][s(355)](),f=(await utils_1[s(366)][s(361)]())[s(372)](e=>e[s(367)]===c[s(367)]);if(void 0===f)break;utils_1[o(220)][o(221)](n,a,f,s(364))}}catch(e){let t=(await utils_1[o(222)][s(350)]())[s(363)],i=await utils_1[s(366)][s(355)](),r=(await utils_1[s(366)][s(361)]())[o(218)](e=>e[o(212)]===c[s(367)]);if(void 0===r)break;throw utils_1[s(378)][o(233)](t,i,r,s(364),e instanceof Error?e[s(370)]:JSON[s(344)](e)),e}}}};async function onBeforeBuild(e,t){const i=_0x3f6b27;await checkCocosService(e)&&(await updateConfigInfos(e),await processServiceHooks(e,t,i(354)))}async function onBeforeCompressSettings(e,t){const i=_0x16f31e;await checkCocosService(e)&&await processServiceHooks(e,t,i(244))}async function onAfterCompressSettings(e,t){const i=_0x3f6b27;await checkCocosService(e)&&(processCommonNativeModule(t),await processServiceHooks(e,t,i(371)))}async function onAfterBuild(e,t){const i=_0x3f6b27;await checkCocosService(e)&&await processServiceHooks(e,t,i(374))}async function processCommonNativeModule(e){const t=_0x16f31e,i=_0x3f6b27;let o=path_1[i(360)](e[t(240)].dir),s=path_1[i(349)](utils_1[i(341)][i(342)](),t(239));native_1[t(246)](o),native_1[t(219)](s)}async function checkCocosService(e){const t=_0x16f31e,i=_0x3f6b27;var o;return!!await common_1[t(236)]()&&!!(null===(o=e[t(210)][i(377)])||void 0===o?void 0:o[t(249)])}async function updateConfigInfos(e){const t=_0x16f31e,i=_0x3f6b27;try{const o=e[i(376)][i(377)][t(249)],s=await utils_1[i(366)][t(245)](),r=new Set(await utils_1[i(366)][i(375)](o)),c=await common_1[t(242)](s,r,o);e[i(376)][i(377)][i(345)]=c}catch(e){utils_1[t(217)][t(243)](e)}}exports[_0x16f31e(229)]=onBeforeBuild,exports[_0x3f6b27(368)]=onBeforeCompressSettings,exports[_0x3f6b27(371)]=onAfterCompressSettings,exports[_0x3f6b27(374)]=onAfterBuild;