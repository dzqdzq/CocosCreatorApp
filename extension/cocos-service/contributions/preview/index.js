"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onSettingsSimulator=exports.onSettingsBrowser=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../../utils");async function scanfServiceBuilders(){let e=[];try{let i=await utils_1.csConfig.readServiceList(),t=await utils_1.csConfig.readEnableServices(),s=i.filter(e=>t.includes(e.service_id));await Promise.all(s.map(i=>{var t;let s=utils_1.csPlugin.getServicePluginInfo(i.service_component_name);if(void 0===s||!(null===(t=s.builder)||void 0===t?void 0:t.main))return;let r=path_1.join(s.path,s.builder.main);fs_extra_1.existsSync(r)&&e.push({service_id:i.service_id,builder:utils_1.csUtil.require(r)})}))}catch(e){utils_1.csLogger.debug(e)}return e}async function onCommonSettings(e,i){let t=await scanfServiceBuilders();try{await Promise.all(t.map(async t=>{t.builder.onSettings&&t.builder.onSettings(await utils_1.csConfig.readServiceParam(t.service_id),i,i=>e.jsList.push(i))}))}catch(e){utils_1.csLogger.debug(e)}}async function onSettingsBrowser(e){await onCommonSettings(e,"browser")}async function onSettingsSimulator(e){await onCommonSettings(e,"simulator")}exports.onSettingsBrowser=onSettingsBrowser,exports.onSettingsSimulator=onSettingsSimulator;