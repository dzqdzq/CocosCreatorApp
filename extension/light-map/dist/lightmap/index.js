"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const LFX_App_1=require("./backer/LFX_App"),fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),path_2=require("path");module.paths.push(path_2.join(Editor.App.path,"node_modules"));const cc=__importStar(require("cc")),Chroma=require("chroma-js");class Lightmap{constructor(){this.scene=null,this.renderScene=null}init(){this.lfxApp=new LFX_App_1.LFX_App,this.lfxApp.Baker.on("login",e=>{console.debug("lightMap output info: login",e),Editor.Message.broadcast("scene:lightmap-start")}),this.lfxApp.Baker.on("log",e=>{console.debug("lightMap output info: log",e),Editor.Message.broadcast("scene:lightmap-log",e)}),this.lfxApp.Baker.on("progress",e=>{console.debug("lightMap output info: progress",e),Editor.Message.broadcast("scene:lightmap-progress",e)}),this.lfxApp.Baker.on("fineshed",e=>{console.debug("lightMap output info: fineshed",e),Editor.Message.broadcast("scene:lightmap-finished")}),this.lfxApp.Baker.on("end",e=>{console.debug("lightMap output info: end",e),Editor.Message.broadcast("scene:lightmap-end",e)}),this.lfxApp.Baker.on("cancel",e=>{console.debug("lightMap output info: cancel",e),Editor.Message.broadcast("scene:lightmap-cancel",e)}),this.scene=cc.director.getScene(),cce.Scene.on("open",this.onLoadScene.bind(this)),cce.Scene.on("reload",this.onLoadScene.bind(this))}onLoadScene(e){this.scene=e,this.renderScene=this.scene._renderScene}async apply(e,t){fs_1.default.existsSync(e.path)||fs_1.default.mkdirSync(e.path),t&&(this.lfxApp.Baker.lfxpath=path_1.default.join(t,"../tools/lightmap-tools")),e.aoColor=Chroma(e.aoColor).rgb(),this.lfxApp.Init(e),await this.bake()}clear(){LFX_App_1.LFX_App.Reset(this.scene)}async bake(){await this.lfxApp.Bake(this.scene)}cancel(){this.lfxApp.Cancel()}}exports.default=new Lightmap;