"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.resetProjectDeclaration=exports.addCompileTask=exports.addChromeDebugSetting=exports.vscodeWorkflowError=exports.vscodeWorkflowWarn=exports.vscodeWorkflowLog=void 0;const fs_extra_1=require("fs-extra"),path_1=__importDefault(require("path")),json5_1=__importDefault(require("json5"));function vscodeWorkflowLog(e){console.log("[vscode-workflow]: "+e)}function vscodeWorkflowWarn(e){console.warn("[vscode-workflow]: "+e)}function vscodeWorkflowError(e){console.error("[vscode-workflow]: "+e)}async function addChromeDebugSetting(){const e=Editor.Project.path,o=path_1.default.join(e,".vscode"),r=path_1.default.join(o,"launch.json"),t="localhost:"+await Editor.Message.request("server","query-port"),s={version:"0.2.0",configurations:[{type:"chrome",request:"launch",name:"CocosCreator Launch Chrome against localhost",url:t,webRoot:"${workspaceFolder}"}]};let a;try{const e=await fs_extra_1.readFile(r,"utf-8");a=json5_1.default.parse(e)}catch(e){a=s}fs_extra_1.ensureDirSync(o),a.configurations=a.configurations||[];const n=a.configurations.find(e=>"CocosCreator Launch Chrome against localhost"===e.name);return n?n.url=t:a.configurations.push(...s.configurations),await fs_extra_1.writeFile(r,JSON.stringify(a,null,4),"utf-8"),vscodeWorkflowLog(String.raw`Chrome debug setting has been updated to ${e}\.vscode\launch.json,`+" please install Debugger for Chrome VS Code extension to debug your project."),null}async function addCompileTask(){const e=Editor.Project.path,o=path_1.default.join(e,".vscode"),r=path_1.default.join(o,"tasks.json"),t=[`http://localhost:${await Editor.Message.request("server","query-port")}/asset-db/refresh`],s={version:"0.2.0",tasks:[{label:"CocosCreator compile",command:"curl",args:t,type:"shell",isBackground:!0,group:"build",presentation:{reveal:"always"}}]};let a;try{const e=await fs_extra_1.readFile(r,"utf-8");a=json5_1.default.parse(e)}catch(e){a=s}fs_extra_1.ensureDirSync(o),a.tasks=a.tasks||[];const n=a.tasks.find(e=>"CocosCreator compile"===e.label);n?n.args=t:a.tasks.push(...s.tasks),await fs_extra_1.writeFile(r,JSON.stringify(a,null,4),"utf-8"),vscodeWorkflowLog(String.raw`CocosCreator Compiling task has been added to ${e}\.vscode\tasks.json, please run "${"CocosCreator compile"}" task in VS Code to trigger compile in Cocos Creator.`)}async function resetProjectDeclaration(){const e=Editor.Project.tmpDir,o=path_1.default.join(e,"declarations"),r=path_1.default.join(o,"cc.d.ts"),t=String.raw`
    /// <reference path="${await(await Editor.Message.request("engine","query-info")).path}\bin\.declarations\cc.d.ts"/>
            
    /**
     * @deprecated Global variable 'cc' was dropped since 3.0. Use ES6 module syntax to import Cocos Creator APIs.
    */
    declare const cc: never;
    `;if(fs_extra_1.existsSync(o)){(await fs_extra_1.stat(o)).isDirectory()||fs_extra_1.mkdirSync(o,{recursive:!0})}await fs_extra_1.writeFile(r,t),vscodeWorkflowLog("The declaration of cc was successfully updated ")}exports.vscodeWorkflowLog=vscodeWorkflowLog,exports.vscodeWorkflowWarn=vscodeWorkflowWarn,exports.vscodeWorkflowError=vscodeWorkflowError,exports.addChromeDebugSetting=addChromeDebugSetting,exports.addCompileTask=addCompileTask,exports.resetProjectDeclaration=resetProjectDeclaration;