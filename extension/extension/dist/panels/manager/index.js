"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../public/utils"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;async function ready(){vm=new Vue({el:(panel=this).$.content,data:{ready:!0,packages:[],packagesMap:[],tabs:["internal","project","global"],active:"internal",search:""},mounted(){this.refresh()},components:{"pkg-node":require("./pkg-node")},methods:{t:e=>Editor.I18n.t(`extension.menu.${e}`),refresh(){const e=Editor.Package.getPackages().sort((e,t)=>e.name.localeCompare(t.name));this.packages=e.map(e=>{let t="";if(Editor.Utils.Path.contains(Editor.App.path,e.path))t="internal";else if(Editor.Utils.Path.contains(Editor.Project.path,e.path))t="project";else{if(!Editor.Utils.Path.contains(Editor.App.home,e.path))return;t="global"}return e.type=t,Object.assign({},e)}).filter(Boolean),this.doSearch()},doSearch(){this.search=this.$refs.search.value,this.search?this.packagesMap=this.packages.filter(e=>-1!==e.info.name.search(this.search)):this.packagesMap=this.packages},async scanning(e){await Editor.Message.request("extension","scanning",e),this.refresh()},async install(e){const t=await Editor.Dialog.select({title:Editor.I18n.t("extension.menu.selectDirectory"),filters:[{name:"ZIP",extensions:["zip"]}]});if(!t||!t.filePaths[0])return;const s=path_1.basename(t.filePaths[0],".zip");try{const a=await utils_1.importPackage(e,t.filePaths[0]);await Editor.Message.request("extension","scanning",e),await Editor.Message.request("extension","enable",a,!0),this.refresh()}catch(e){switch(e.message){case"cancel":utils_1.handleCancelImport();break;case"decompress fail":utils_1.handleDecompressFail(t.filePaths[0],s,!0);break;case"invalid path":utils_1.handleInvalidPath(t.filePaths[0]);break;default:utils_1.handleUnexpectedImportError(e)}}}}}),Editor.Package.on("register",vm.refresh),Editor.Package.on("unregister",vm.refresh)}async function beforeClose(){}async function close(){Editor.Package.removeListener("register",vm.refresh),Editor.Package.removeListener("unregister",vm.refresh)}exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../manager.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../../static","/template/manager/index.html"),"utf8"),exports.$={content:".extension"},exports.methods={},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;