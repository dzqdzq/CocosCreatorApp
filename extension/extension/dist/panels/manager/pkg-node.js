"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),fs_1=require("fs"),path_1=require("path"),vue_1=__importDefault(require("vue/dist/vue")),utils_1=require("../../public/utils");exports.default=vue_1.default.extend({name:"pkg-node",template:(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/template/manager/pkg-node.html"),"utf8"),props:{pkg:{type:Object}},data:()=>({dev:Editor.App.dev,description:"",languageMTime:0,_onScroll:null}),methods:{getObjectByKey(e,t){let i=[];if("string"==typeof t?i=t.split("."):t instanceof Array&&(i=t),i.length>0){const t=i.shift();return this.getObjectByKey(e[t],i)}return e},updateDescription(){var e,t;const i=`i18n:${this.pkg.info.name}.`;if(!this.pkg.enable&&(null===(e=this.pkg.info.description)||void 0===e?void 0:e.startsWith(i)))try{const e=this.pkg.info.description.slice(i.length),t=Editor.I18n.getLanguage(),n=(0,path_1.join)(this.pkg.path,"i18n",`${t}.js`);if((0,fs_1.existsSync)(n)){const t=(0,fs_1.statSync)(n).mtime.getTime();if(this.languageMTime!==t){this.languageMTime=t,require.cache[n]=void 0;const i=require(n);this.description=this.getObjectByKey(i,e)}}}catch(e){console.error(e),this.description="Nothing"}else(null===(t=this.pkg.info.description)||void 0===t?void 0:t.startsWith("i18n:"))?this.description=Editor.I18n.t((this.pkg.info.description||"").replace(/^i18n:/,""))||"Nothing":this.description=this.pkg.info.description||"Nothing"},async reload(){const{path:e}=this.pkg;await Editor.Message.request("extension","reload",e),this.updateDescription()},async toggleEnable(){const{enable:e,path:t}=this.pkg;await Editor.Message.request("extension","enable",t,!e),e||this.updateDescription(),this.$parent.refresh()},openFolder(){electron_1.shell.showItemInFolder(this.pkg.path)},async remove(){const{info:e,path:t}=this.pkg,i=(0,utils_1.getPackageType)(t);1!==(await Editor.Dialog.info(`${Editor.I18n.t("extension.menu.removeConfirm").replace("$name",e.name)}`,{title:Editor.I18n.t("extension.menu.confirm"),default:0,cancel:1,detail:"develop"===i?Editor.I18n.t("extension.menu.notDelete"):"",buttons:[Editor.I18n.t("extension.store.confirm"),Editor.I18n.t("extension.store.cancel")]})).response&&await Editor.Message.request("extension","remove",t)&&Editor.Task.addNotice({title:Editor.I18n.t("extension.menu.remove"),message:`${e.name} ${Editor.I18n.t("extension.menu.removeSuccess")}`,type:"success",timeout:5e3})}},mounted(){this.updateDescription(),this._onScroll=this.updateDescription.bind(this),this.$on("scroll",this._onScroll)},destroyed(){this.$off("scroll",this._onScroll)}});