"use strict";var __awaiter=this&&this.__awaiter||function(e,t,_,r){return new(_||(_=Promise))(function(a,i){function n(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof _?t:new _(function(e){e(t)})).then(n,l)}s((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParticleSystem=exports.PARTICLESYSTEM=void 0;const base_1=require("../common/base"),GradientRange_1=require("./GradientRange"),CurveRange_1=require("./CurveRange");exports.PARTICLESYSTEM={__type__:"cc.ParticleSystem",_name:"",_objFlags:0,node:null,_enabled:!0,__prefab:null,_materials:[],_visFlags:0,startColor:{__id__:-1},scaleSpace:1,startSize3D:!1,startSizeX:{__id__:2},startSize:{__id__:2},startSizeY:{__id__:3},startSizeZ:{__id__:4},startSpeed:{__id__:5},startRotation3D:!1,startRotationX:{__id__:6},startRotationY:{__id__:7},startRotationZ:{__id__:8},startRotation:{__id__:8},startDelay:{__id__:9},startLifetime:{__id__:10},duration:5,loop:!0,simulationSpeed:1,playOnAwake:!0,gravityModifier:{__id__:11},rateOverTime:{__id__:12},rateOverDistance:{__id__:13},bursts:[],_colorOverLifetimeModule:null,_shapeModule:null,_sizeOvertimeModule:null,_velocityOvertimeModule:null,_forceOvertimeModule:null,_limitVelocityOvertimeModule:null,_rotationOvertimeModule:null,_textureAnimationModule:null,_trailModule:null,renderer:{__id__:14},enableCulling:!1,_prewarm:!1,_capacity:100,_simulationSpace:1};const PARTICLESYSTEMRENDERER={__type__:"cc.ParticleSystemRenderer",_renderMode:0,_velocityScale:1,_lengthScale:1,_mesh:null,_mainTexture:null,_useGPU:!1};class ParticleSystem{static create(){return JSON.parse(JSON.stringify(exports.PARTICLESYSTEM))}static createRenderer(){return JSON.parse(JSON.stringify(PARTICLESYSTEMRENDERER))}static migrate(e){return __awaiter(this,void 0,void 0,function*(){const t=JSON.parse(JSON.stringify(exports.PARTICLESYSTEM));for(const _ in e){const r=e[_];if("__type__"!==_&&void 0!==r&&null!==r)if("_materials"===_){t._materials=[];for(let e=0;e<r.length;++e){let _=r[e];_&&(_={__uuid__:yield base_1.ImporterBase.getUuid(_.__uuid__)},t._materials.push(_))}}else"_velocityScale"===_||"_lengthScale"===_||"_mesh"===_||"_renderMode"===_||(t[_]=r)}return t})}static apply(e,t,_){return __awaiter(this,void 0,void 0,function*(){const r=t[e],a=yield ParticleSystem.migrate(r),i=ParticleSystem.createRenderer();i._velocityScale=r._velocityScale,i._lengthScale=r._lengthScale,i._renderMode=r._renderMode,r._mesh&&(i._mesh={__uuid__:yield base_1.ImporterBase.getUuid(r._mesh.__uuid__)}),_.push(i),a.renderer.__id__=_.length-1;const n=GradientRange_1.GradientRange.create();_.push(n);let l=CurveRange_1.CurveRange.create();return _.push(l),a.startSizeX=_.length-1,l=CurveRange_1.CurveRange.create(),_.push(l),a.startSizeY=_.length-1,l=CurveRange_1.CurveRange.create(),_.push(l),a.startSizeZ=_.length-1,l=CurveRange_1.CurveRange.create(),_.push(l),a.startRotationX=_.length-1,l=CurveRange_1.CurveRange.create(),_.push(l),a.startRotationY=_.length-1,l=CurveRange_1.CurveRange.create(),_.push(l),a.startRotationZ=_.length-1,_.splice(e,1,a),a})}}exports.ParticleSystem=ParticleSystem;