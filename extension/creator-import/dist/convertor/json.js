"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(a,n){function i(e){try{c(s.next(e))}catch(e){n(e)}}function o(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.JSONImporter=void 0;const base_1=require("../common/base");class JSONImporter extends base_1.ImporterBase{constructor(){super(...arguments),this.type="base"}import(){return __awaiter(this,void 0,void 0,function*(){return this.validateSpine()?(this._3dMeta.ver="1.2.3",this._3dMeta.importer="spine-data"):this.validateDragonBones()?(this._3dMeta.ver="1.0.0",this._3dMeta.importer="dragonbones"):this.validateDragonBonesAtlasAsset()?(this._3dMeta.ver="1.0.0",this._3dMeta.importer="dragonbones-atlas"):(this._3dMeta.ver="1.0.0",this._3dMeta.importer="json"),!0})}validateDragonBonesAtlasAsset(){let e;const t=this.readFileSync(this.sourceFsPath);try{t&&(e=JSON.parse(t))}catch(e){return!1}return"string"==typeof e.imagePath&&Array.isArray(e.SubTexture)}validateDragonBones(){var e;if(this.sourceFsPath.endsWith(".json")){const t=this.readFileSync(this.sourceFsPath);try{t&&(e=JSON.parse(t))}catch(e){return!1}}else{const t=this.readFileSync(this.sourceFsPath);try{e=dragonBones.BinaryDataParser.getInstance().parseDragonBonesData(t.buffer)}catch(e){return!1}}return Array.isArray(e.armature)||!!e.armatures}validateSpine(){if(this.sourceFsPath.endsWith(".skel"))return!0;let e;const t=this.readFileSync(this.sourceFsPath);if(t){const r=t.slice(0,30);if(r.indexOf("slots")>0||r.indexOf("skins")>0||r.indexOf("events")>0||r.indexOf("animations")>0||r.indexOf("bones")>0||r.indexOf("skeleton")>0||r.indexOf('"ik"')>0){try{e=JSON.parse(t)}catch(e){return!1}return Array.isArray(e.bones)}}return!1}}exports.JSONImporter=JSONImporter;