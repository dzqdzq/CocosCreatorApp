"use strict";var __awaiter=this&&this.__awaiter||function(t,e,s,a){return new(s||(s=Promise))(function(i,u){function r(t){try{n(a.next(t))}catch(t){u(t)}}function o(t){try{n(a.throw(t))}catch(t){u(t)}}function n(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(r,o)}n((a=a.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FbxImporter=void 0;const base_1=require("../common/base"),utlis_1=require("../common/utlis"),path_1=require("path");class FbxImporter extends base_1.ImporterBase{constructor(){super(...arguments),this.type="fbx"}import(){return __awaiter(this,void 0,void 0,function*(){if(!this._2dMeta)return!0;this._3dMeta.ver="2.0.8",this._3dMeta.importer="fbx",this._3dMeta.userData.imageMetas=[],this._3dMeta.userData.legacyFbxImporter=!0,this._3dMeta.userData.disableMeshSplit=!0,this._3dMeta.uuid=this._2dMeta.uuid;const t=[];for(let e in this._2dMeta.subMetas){const s=this._2dMeta.subMetas[e],a=(0,utlis_1.isFbxMultKey)(this._2dMeta.subMetas,e);e=(0,utlis_1.getFBXSubMetaNewName)(this.destFsPath,e,a);const i=base_1.ImporterBase.getNameByID(e),u=`${this._2dMeta.uuid}@${i}`;t.push({key:e,name:i,uuid:u}),utlis_1.importSubAssets.set(s.uuid,{baseUuid:this._2dMeta.uuid,uuid:u,meta:s})}const e=JSON.stringify(this._2dMeta.subMetas);let s=e.match(/(?<=uuid":")([a-zA-Z0-9-]+)(?=")/g)||[];s=s.concat(e.match(/(?<=__uuid__":")([a-zA-Z0-9-]+)(?=")/g)||[]);let a=[];for(let t of s){const e=utlis_1.importProjectAssets.get(t),s=e&&e.meta;!s||"sprite"!==s.type&&"raw"!==s.type||a.find(e=>e&&e.uuid===t)||a.push({uuid:t,name:(0,path_1.basename)(e.basePath)})}if(a.length>0){let t="";for(let e of a)t+=`${e.name} {asset(${e.uuid})}`;console.warn(Editor.I18n.t("importer.fbx_tips",{fbxName:(0,path_1.basename)(this.destFsPath)||"",fbxUuid:this._3dMeta.uuid,textureAssets:t}))}return t.length>0&&utlis_1.replaceFbxUuidMap.set(this.destMetaFsPath,t),!0})}}exports.FbxImporter=FbxImporter;