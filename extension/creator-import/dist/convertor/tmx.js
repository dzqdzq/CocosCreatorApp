"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))(function(a,i){function o(t){try{c(s.next(t))}catch(t){i(t)}}function n(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,n)}c((s=s.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TmxImporter=void 0;const base_1=require("../common/base"),utlis_1=require("../common/utlis"),fs_extra_1=require("fs-extra"),IMAGE_EXNAME=[".png",".jpg",".jpeg",".webp"];class TmxImporter extends base_1.ImporterBase{constructor(){super(...arguments),this.type="tmx"}import(){return __awaiter(this,void 0,void 0,function*(){this._3dMeta.ver="1.0.0",this._3dMeta.importer="tiled-map";const t=this.readFileSync();if(t){const e=[];((yield utlis_1.searchTmxDependImages(this.sourceFsPath,t))||[]).forEach(t=>{utlis_1.importProjectAssets.forEach(r=>{IMAGE_EXNAME.includes(r.type)&&r.basePath===t&&e.push(r)})}),e.forEach(t=>{const e=this.readJSONSync(t.outPath);e&&"sprite-frame"!==e.userData.type&&(e.userData.type="sprite-frame",fs_extra_1.writeJSONSync(t.outPath,e,{spaces:2}))})}return!0})}}exports.TmxImporter=TmxImporter;