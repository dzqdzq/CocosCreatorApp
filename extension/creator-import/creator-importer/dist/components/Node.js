"use strict";var __awaiter=this&&this.__awaiter||function(e,t,_,n){return new(_||(_=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function i(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof _?t:new _(function(e){e(t)})).then(s,i)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Node=exports.NODE=void 0;const utlis_1=require("../common/utlis"),UITransform_1=require("./UITransform"),UIOpacity_1=require("./UIOpacity");exports.NODE={__type__:"cc.Node",_name:"New Node",_objFlags:0,_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_lpos:{__type__:"cc.Vec3",x:0,y:0,z:0},_lrot:{__type__:"cc.Quat",x:0,y:0,z:0,w:1},_lscale:{__type__:"cc.Vec3",x:1,y:1,z:1},_layer:1073741824,_euler:{__type__:"cc.Vec3",x:0,y:0,z:0}};class Node{static create(e,t){const _=JSON.parse(JSON.stringify(exports.NODE));return e&&(_._name=e),t&&(_._parent={__id__:t}),_}static addComponents(e,t){e._components.push({__id__:t})}static addChildren(e,t){e._children.push({__id__:t})}static migrate(e,t,_){return __awaiter(this,void 0,void 0,function*(){const n=JSON.parse(JSON.stringify(exports.NODE)),o=t[e];if(o._components)for(const e of o._components){n._components.find(t=>t.__id__===e.__id__)||n._components.push(e)}for(const r in o){const s=o[r];if("__type__"!==r&&void 0!==s&&null!==s)if("_groupIndex"===r||"groupIndex"===r){let e=yield(0,utlis_1.getGroupLayerByIndex)(s);e||(console.warn(`The group layer: ${e} no found. node name: ${o._name}`),e=s),n._layer=e}else{if("_color"===r||"_components"===r)continue;if("_trs"===r){const e=s.array;n._lpos.x=e[0],n._lpos.y=e[1],n._lpos.z=e[2],n._lrot.x=e[3],n._lrot.y=e[4],n._lrot.z=e[5],n._lrot.w=0===e[6]?1:e[6],n._lscale.x=e[7],n._lscale.y=e[8],n._lscale.z=e[9]}else"_eulerAngles"===r?(n._euler.x=s.x,n._euler.y=s.y,n._euler.z=s.z):"_contentSize"===r?(0,utlis_1.hasUIRenderComponent)(n,t)&&UITransform_1.UITransform.setContentSize(n,e,s,_):"_anchorPoint"===r?(0,utlis_1.hasUIRenderComponent)(n,t)&&UITransform_1.UITransform.setAnchorPoint(n,e,s,_):"_opacity"===r?(0,utlis_1.hasUIRenderComponent)(n,t)&&UIOpacity_1.UIOpacity.setOpacity(n,e,s,_):n[r]=s}}return(0,utlis_1.fromEuler)(n._lrot,n._euler.x,n._euler.y,n._euler.z),n})}static apply(e,t,_){return __awaiter(this,void 0,void 0,function*(){const n=yield Node.migrate(e,t,_);return _.splice(e,1,n),n})}}exports.Node=Node;