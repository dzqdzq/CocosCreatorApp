"use strict";var __awaiter=this&&this.__awaiter||function(e,t,_,n){return new(_||(_=Promise))(function(r,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function c(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof _?t:new _(function(e){e(t)})).then(i,c)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrivateNode=exports.PRIVATENODE=void 0;const utlis_1=require("../common/utlis"),UITransform_1=require("./UITransform"),UIOpacity_1=require("./UIOpacity");exports.PRIVATENODE={__type__:"cc.PrivateNode",_name:"New Node",_objFlags:1024,_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_lpos:{__type__:"cc.Vec3",x:0,y:0,z:0},_lrot:{__type__:"cc.Quat",x:0,y:0,z:0,w:1},_lscale:{__type__:"cc.Vec3",x:1,y:1,z:1},_layer:1073741824,_euler:{__type__:"cc.Vec3",x:0,y:0,z:0}};class PrivateNode{static create(){return JSON.parse(JSON.stringify(exports.PRIVATENODE))}static migrate(e,t,_){return __awaiter(this,void 0,void 0,function*(){const n=JSON.parse(JSON.stringify(exports.PRIVATENODE)),r=t[e];for(const t in r){const o=r[t];if("__type__"!==t&&void 0!==o&&null!==o)if("_groupIndex"===t){let t=yield(0,utlis_1.getGroupLayerByIndex)(o);t||(console.warn(`The group layer: ${e} no found. node name: ${r._name}`),t=o),n._layer=t}else if("_trs"===t){const e=o.array;n._lpos.x=e[0],n._lpos.y=e[1],n._lpos.z=e[2],n._lrot.x=e[3],n._lrot.y=e[4],n._lrot.z=e[5],n._lrot.w=e[6],n._lscale.x=e[7],n._lscale.y=e[8],n._lscale.z=e[9]}else if("_eulerAngles"===t)n._euler.x=o.x,n._euler.y=o.y,n._euler.z=o.z;else if("_contentSize"===t||"_anchorPoint"===t){let o=null;n._components.find(e=>{const t=_[e.__id__];if(t&&"cc.UITransform"===t.__type__)return o=t,t}),o||((o=UITransform_1.UITransform.create()).node={__id__:e},_.push(o),n._components.push({__id__:_.length-1})),"_contentSize"===t?o._contentSize=r._contentSize:"_anchorPoint"===t&&(o._anchorPoint=r._anchorPoint)}else if("_opacity"===t){let t=null;n._components.find(e=>{const n=_[e.__id__];if(n&&"cc.UIOpacity"===n.__type__)return t=n,n}),t||((t=UIOpacity_1.UIOpacity.create()).node={__id__:e},_.push(t),n._components.push({__id__:_.length-1})),t._opacity=r._opacity}else n[t]=o}return n})}static apply(e,t,_){return __awaiter(this,void 0,void 0,function*(){const n=yield PrivateNode.migrate(e,t,_);return _.splice(e,1,n),n})}}exports.PrivateNode=PrivateNode;