const os=require("os"),path=require("path"),fse=require("fs-extra"),expect=require("chai")["expect"],file=require("../dist/file");describe("file工具函数的基本使用",()=>{const c=path.join(os.tmpdir(),"cocos-test");before(()=>{fse.emptyDirSync(c)}),after(()=>{fse.removeSync(c)}),describe("resolveFileNameConflict",()=>{let i;const t="test.txt",n="test001.txt",s="check-001.txt",a="1.txt",o="19.scene",r="01.scene",l="019.scene";before(()=>{i=path.join(c,"resolveFileNameConflict"),fse.ensureDirSync(i),fse.ensureFileSync(path.join(i,t)),fse.ensureFileSync(path.join(i,n)),fse.ensureFileSync(path.join(i,s)),fse.ensureFileSync(path.join(i,a)),fse.ensureFileSync(path.join(i,o)),fse.ensureFileSync(path.join(i,r)),fse.ensureFileSync(path.join(i,l))}),after(()=>{fse.removeSync(i)}),it("should return the original filename when the file does not already exist in TEST_DIR",()=>{var e="origin.txt",t=file.resolveFileNameConflict(i,e);expect(t).to.exist,expect(t).to.be.a("string"),expect(t).to.equal(e)}),it('should return an incremented filename ("test-001.txt") when the file already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,t);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("test-001.txt")}),it('should return an incremented filename ("check-001.txt") when the file already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,s);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("check-002.txt")}),it('should return an incremented folder name ("resolveFileNameConflict-001") when the folder already exists in COCOS_TEST_DIR',()=>{var e=file.resolveFileNameConflict(c,"resolveFileNameConflict");expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("resolveFileNameConflict-001")}),it('should return an incremented filename ("test002.txt") when a file of the same name ("test001.txt") already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,n);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("test002.txt")}),it('should return an incremented filename ("2.txt") when a file of the same name ("1.txt") already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,a);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("2.txt")}),it('should return an incremented filename ("20.scene") when a file of the same name ("19.scene") already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,o);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("20.scene")}),it('should return an incremented filename ("02.scene") when a file of the same name ("01.scene") already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,r);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("02.scene")}),it('should return an incremented filename ("020.scene") when a file of the same name ("019.scene") already exists in TEST_DIR',()=>{var e=file.resolveFileNameConflict(i,l);expect(e).to.exist,expect(e).to.be.a("string"),expect(e).to.equal("020.scene")})}),describe("getName",()=>{let i;const n="test.txt",s="test01.txt";before(()=>{i=path.join(c,"getName"),fse.ensureDirSync(i),fse.ensureFileSync(path.join(i,n)),fse.ensureFileSync(path.join(i,s))}),after(()=>{fse.removeSync(i)}),it("should return the original file path if the file does not exist",()=>{var e=path.join(i,"origin.txt"),t=file.getName(e);expect(t).to.exist,expect(t).to.be.a("string"),expect(t).to.equal(e)}),it('should return an incremented file path ("test-001.txt") when a file of the same name exists',()=>{var e=path.join(i,"test-001.txt"),t=file.getName(path.join(i,n));expect(t).to.exist,expect(t).to.be.a("string"),expect(t).to.equal(e)}),it('should return an incremented folder path ("getName-001") when a folder of the same name exists',()=>{var e=path.join(c,"getName-001"),t=file.getName(i);expect(t).to.exist,expect(t).to.be.a("string"),expect(t).to.equal(e)}),it('should return an incremented file path ("test02.txt") when a file of the same name ("test01.txt") exists',()=>{var e=path.join(i,"test02.txt"),t=file.getName(path.join(i,s));expect(t).to.exist,expect(t).to.be.a("string"),expect(t).to.equal(e)})}),describe("copy",()=>{const t=path.join(c,"copy","src"),e=path.join(t,"inner"),i=path.join(e,"test1.txt"),n="test1",s=path.join(e,"test2.txt"),a=path.join(c,"copy","dist");before(()=>{fse.ensureDirSync(t),fse.ensureDirSync(e),fse.writeFileSync(i,n),fse.writeFileSync(s,"test2"),fse.ensureDirSync(a)}),after(()=>{fse.removeSync(path.join(c,"copy"))}),it("should successfully copy a file to the destination",()=>{file.copy(i,path.join(a,"test1.txt"));var e=fse.readFileSync(path.join(a,"test1.txt"),"utf8");expect(e).to.equal(n)}),it("should successfully copy a folder to the destination",()=>{file.copy(t,path.join(a,"src"));var e=path.relative(a,i);expect(fse.existsSync(path.join(a,"src",e))).to.be.true})})});