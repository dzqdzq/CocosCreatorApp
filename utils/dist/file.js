"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.trashItem=exports.copy=exports.unzip=exports.getName=void 0;const fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),path_1=require("path");function getName(e){if(!(0,fs_extra_1.existsSync)(e))return e;const t=(0,path_1.dirname)(e),r=(0,path_1.extname)(e);let s=(0,path_1.basename)(e,r);do{/(\d+)$/.test(s)?s=s.replace(/(\d+)$/,(e,t)=>{let r=parseInt(t,10);return(r=(r+=1).toString().padStart(t.length,"0"))+""}):s+="-001",e=(0,path_1.join)(t,s)}while((0,fs_extra_1.existsSync)(e+r));return e+r}exports.getName=getName;const unzipOfDarwin=function(e,t,r){const s=(0,path_1.dirname)(t);(0,fs_extra_1.ensureDirSync)(s);const n=(0,child_process_1.spawn)("unzip",[e,"-d",t]);let o="";n.stderr.on("data",e=>{o+=e});let a="";n.stdout.on("data",e=>{a+=e}),n.on("close",e=>{a&&console.log(a),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})},unzipOfWin32=function(e,t,r){const s=(0,path_1.dirname)(t);(0,fs_extra_1.ensureDirSync)(s);const n=(0,child_process_1.spawn)((0,path_1.join)(Editor.App.path,"../tools/unzip.exe"),[e,"-d",t]);let o="";n.stderr.on("data",e=>{o+=e});let a="";n.stdout.on("data",e=>{a+=e}),n.on("close",e=>{a&&console.log(a),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})};async function unzip(e,t,r={}){let s;s="win32"===process.platform?unzipOfWin32:unzipOfDarwin;const n=(0,path_1.join)(Editor.Project.tmpDir,".utils_temp",(0,path_1.basename)(e,".zip"));if(await(0,fs_extra_1.remove)(n),await new Promise((t,r)=>{s(e,n,e=>{if(e)return r(e);t()})}),r.peel){const e=(0,fs_extra_1.readdirSync)(n);1===e.length?await(0,fs_extra_1.copy)((0,path_1.join)(n,e[0]),t):await(0,fs_extra_1.copy)(n,t)}else await(0,fs_extra_1.copy)(n,t);await(0,fs_extra_1.remove)(n)}function copy(e,t){!function e(t,r){if(!(0,fs_extra_1.existsSync)(t))return;if((0,fs_extra_1.statSync)(t).isDirectory()){(0,fs_extra_1.ensureDirSync)(r);const s=(0,fs_extra_1.readdirSync)(t);for(const n of s)e((0,path_1.join)(t,n),(0,path_1.join)(r,n))}else(0,fs_extra_1.copySync)(t,r),(0,fs_extra_1.chmodSync)(r,511)}(e,t)}async function trashItem(e){if("browser"===process.type){const{shell:t}=require("electron");await t.trashItem(e)}else{const{shell:t}=require("@electron/remote");await t.trashItem(e)}}exports.unzip=unzip,exports.copy=copy,exports.trashItem=trashItem;