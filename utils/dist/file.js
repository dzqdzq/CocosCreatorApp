"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.trashItem=exports.copy=exports.unzip=exports.getName=exports.resolveFileNameConflict=void 0;const child_process_1=require("child_process"),path_1=require("path"),fs_extra_1=require("fs-extra"),resolveFileNameConflict=(e,t)=>{if(!t)throw new Error("fileName is empty");var r=(0,path_1.extname)(t);let a=(0,path_1.basename)(t,r);for(;(0,fs_extra_1.existsSync)((0,path_1.join)(e,""+a+r));)/(\d+)$/.test(a)?a=a.replace(/^(.+?)(\d+)?$/,(e,t,r)=>{var a=parseInt(r,10);return""+t+(a+=1).toString().padStart(r.length,"0")}):a+="-001";return""+a+r};function getName(e){var t,r;return(0,fs_extra_1.existsSync)(e)?(t=(0,path_1.dirname)(e),r=(0,path_1.basename)(e),r=(0,exports.resolveFileNameConflict)(t,r),(0,path_1.join)(t,r)):e}exports.resolveFileNameConflict=resolveFileNameConflict,exports.getName=getName;const unzipOfDarwin=function(e,t,r){var a=(0,path_1.dirname)(t),a=((0,fs_extra_1.ensureDirSync)(a),(0,child_process_1.spawn)("unzip",[e,"-d",t]));let o="",s=(a.stderr.on("data",e=>{o+=e}),"");a.stdout.on("data",e=>{s+=e}),a.on("close",e=>{s&&console.log(s),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})},unzipOfWin32=function(e,t,r){var a=(0,path_1.dirname)(t),a=((0,fs_extra_1.ensureDirSync)(a),(0,child_process_1.spawn)((0,path_1.join)(Editor.App.path,"../tools/unzip.exe"),[e,"-d",t]));let o="",s=(a.stderr.on("data",e=>{o+=e}),"");a.stdout.on("data",e=>{s+=e}),a.on("close",e=>{s&&console.log(s),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})};async function unzip(e,t,r={}){let a;a="win32"===process.platform?unzipOfWin32:unzipOfDarwin;const o=(0,path_1.join)(Editor.Project.tmpDir,".utils_temp",(0,path_1.basename)(e,".zip"));await(0,fs_extra_1.remove)(o),await new Promise((t,r)=>{a(e,o,e=>{if(e)return r(e);t()})}),r.peel&&1===(r=(0,fs_extra_1.readdirSync)(o)).length?await(0,fs_extra_1.copy)((0,path_1.join)(o,r[0]),t):await(0,fs_extra_1.copy)(o,t),await(0,fs_extra_1.remove)(o)}function copy(e,t){!function e(t,r){if((0,fs_extra_1.existsSync)(t)){var a=(0,fs_extra_1.lstatSync)(t);if(a.isDirectory()){(0,fs_extra_1.ensureDirSync)(r),a.isSymbolicLink()||(0,fs_extra_1.chmodSync)(r,511);for(const o of(0,fs_extra_1.readdirSync)(t))e((0,path_1.join)(t,o),(0,path_1.join)(r,o))}else(0,fs_extra_1.copySync)(t,r),a.isSymbolicLink()||(0,fs_extra_1.chmodSync)(r,511)}}(e,t)}async function trashItem(e){var t;"browser"===process.type?(t=require("electron")["shell"],await t.trashItem(e)):(t=require("@electron/remote")["shell"],await t.trashItem(e))}exports.unzip=unzip,exports.copy=copy,exports.trashItem=trashItem;