# 窗口间通道的通信

## 背景

因为 electron 27 开始，就不支持 ipc `sentTo` 的接口了，改为两个窗口建立 channel 并直接发消息，所以我们需要基于新的 API 去兼容
ipc-base 里面的 sentTo 接口

## 技术方案
- 使用新提供的 `MessageChannelMain` 和 `electronMessagePort` 按照如下的方案进行适配
## 时序图

```mermaid
sequenceDiagram
    participant R2 as RendererProcess2
    participant R1 as RendererProcess1
    participant BP as BrowserProcess
    R1 ->> R1: 检查 R1 R2 的 channel 是否建立
    R1 ->>+ BP: 建立 R1 和 R2 的 channel
    BP ->> R1: 发送 port1 给 R1
    BP ->> R2: 发送 port2 给 R2
    R1 ->> BP: 接收到 port1 建立监听并返回成功给 BrowserProcess
    R2 ->> BP: 接收到 port2 建立监听并返回成功给 BrowserProcess
    BP ->>- R1: 通知通道已建立，可以发消息
    BP ->> R1: 广播通道建立情况给每个 RendererProcess
    R1 ->>+ R2: R1 直接发消息个 R2
    R2 ->>- R1: R2 返回消息给 R1
```
