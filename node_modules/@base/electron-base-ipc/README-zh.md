# Electron base ipc

在 `electron` 的 `ipc` 基础上，简单的封装一层，同进程内使用事件转发，减少 `ipc` 数据量。并增加发送回调等方法。

---

## 对象

---

### event

消息传递过程中的简单事件封装。

- `event.senderType`: (`string`) 发送消息的进程类型，`browser` | `renderer`
- `event.reply`: (`Function`) 如果消息允许回调，运行这个方法会执行发送方的回调

---

## Browser 主进程 & Renderer 渲染进程

### ipc.on(eventName, listener)

- `eventName`: (`string` | `symbol`) 监听消息的名字
- `listener`: (`Function`) 消息的处理器

监听并处理指定消息。

```typescript
ipc.on('test', (event, ...args) => {
    console.log(args);
    event.reply(new Error('监听器很任性，就是要返回错误。'), ...args);
});
```
---

### ipc.once(eventName, listener)

- `eventName`: (`string` | `symbol`) 监听消息的名字
- `listener`: (`Function`) 消息的处理器

只监听并处理一次指定消息。

```typescript
ipc.once('test', (event, ...args) => {
    console.log(args);
    event.reply(new Error('监听器很任性，就是要返回错误。'), ...args);
});
```
---

### ipc.removeListener(eventName, listener)

- `eventName`: (`string` | `symbol`) 监听消息的名字
- `listener`: (`Function`) 消息的处理器

取消监听指定的消息。

```typescript
const callback = (event, ...args) => {
    console.log('this is test');
};
ipc.on('test', callback);
// ...
ipc.removeListener('test', callback);
```

---

### ipc.removeAllListeners(eventName)

- `eventName`: (`string` | `symbol`) 监听消息的名字

取消监听的所有消息处理。

```typescript 
ipc.on('test', (event, ...args) => {
    console.log('this is test 001');
});

ipc.on('test', (event, ...args) => {
    console.log('this is test 002');
});

ipc.removeAllListeners('test');
```

---

### ipc.emit(eventName, ..args)

- `eventName`: (`string` | `symbol`) 触发消息的名称
- `...args`: (`any[]`) 参数

触发浏览器进程自身消息的监听器。

```typescript
ipc.emit('test', 1, 2)
   .callback((error, data) => {
        if (error) {
            console.error(error);
            return;
        }
        console.log(data);
   })
   .timeout(-1);
```
---

### ipc.registerChannel(channel)

- `channel`: (`string`) 通道名

注册一个 `ipc` 通道，发送到指定通道的时候，会直接找到对应的进程，不再需要到主进程进行转发。

```typescript
ipc.registerChannel('test');
```

---

### ipc.unregisterChannel(channel)

- `channel`: (`string`) 通道名

取消一个 `ipc` 通道监听。

```typescript
ipc.unregisterChannel('test');
```

---

### ipc.sendToChannel(channel, eventName, ...args)

- `channel`: (`string`) 通道名
- `eventName`: (`string`) 消息名字
- `...args`: (`any[]`) 参数

通过一个 `channel`，直接发送到指定的位置，减少 `ipc` 中转的次数。

```typescript
ipc.sendToChannel('test', 'test-message', 1);
```

---

## Browser 浏览器进程独有

---

### ipc.broadcast(message, ...args)

- `message`: (`string`) 广播消息的名称
- `...args`: (`any[]`) 参数

向所有 windows 广播消息。

```typescript 
ipc.broadcast('test', (message, ...args) => {
    console.log(...args);
});
```

------

## Renderer 渲染进程独有

---

### ipc.send(eventName, ..args)

- `eventName`: (`string`) 消息的名称
- `...args`: (`any[]`) 参数

发送消息给主进程的监听器。

```typescript
ipc.send('test', 1, 2)
   .callback((error, data) => {
        if (error) {
            console.error(error);
            return;
        }
        console.log(data);
    })
    .timeout(-1);
```

---

### ipc.sendSync(eventName, ..args)

- `eventName`: (`string`)  Name of the send message.
- `...args`: (`any[]`) Arguments.

同步版本的 send。

```typescript
try {
    const data = ipc.sendSync('test', 1, 2);
    console.log(data);
} catch (e) {
    console.error(error);
}
```
