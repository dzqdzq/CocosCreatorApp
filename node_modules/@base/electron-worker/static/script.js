"use stirct";const{basename:basename}=require("path"),{EventEmitter:EventEmitter}=require("events"),vStacks=require("v-stacks"),ipc=require("@base/electron-base-ipc"),logger=require("@base/electron-logger"),pkg=require("../package.json"),ipcFlag=`${pkg.name}@${pkg.version}`,$files=document.getElementById("files");ipc.on(`${ipcFlag}:init`,(e,r)=>{window.__name__=r.name,logger.setLevel(2),logger.setLogHandler(e=>{if(e.message=`[${__name__}] ${e.message}`,("warn"===e.type||"error"===e.type)&&0===e.stack.length){const r=new Error(e.message),n=e.type[0].toLocaleUpperCase()+e.type.slice(1);r.stack=r.stack.replace(new RegExp("^"+r.name),n),r.name=n,e.stack=vStacks.ignoreStack(r.stack,3)}}),document.getElementById("name").innerHTML=r.name,document.title=`Worker - ${r.name}`,process.title=process.title.replace("(Renderer)",`(${r.name})`),r.files.forEach(e=>{require(e);const r=document.createElement("div");r.setAttribute("title",e),r.innerHTML=basename(e),$files.appendChild(r)})}),ipc.on(`${ipcFlag}:require`,(e,r)=>{require(r);const n=document.createElement("div");n.setAttribute("title",r),n.innerHTML=basename(r),$files.appendChild(n)});class Ipc extends EventEmitter{send(e,...r){return ipc.send(`${ipcFlag}:message`,window.__name__,e,r)}}window.ccWorker={Ipc:new Ipc,log:console.log.bind(console)},Object.defineProperty(window.Worker,"Ipc",{get:()=>(console.warn("使用 Worker.Ipc 已被废弃，请使用 ccWorker.Ipc。"),window.ccWorker.Ipc)}),Object.defineProperty(window.Worker,"log",{get:()=>(console.warn("使用 Worker.log 已被废弃，请使用 ccWorker.log。"),window.ccWorker.Ipc)}),ipc.on(`${ipcFlag}:message`,(e,r,n)=>{0!==window.ccWorker.Ipc.listenerCount(r)?window.ccWorker.Ipc.emit(r,e,...n):e.reply(new Error(`The message '${r}' is not registered with the '${window.__name__}' worker`))}),ipc.on(`${ipcFlag}:require`,(e,r)=>{require(r)});