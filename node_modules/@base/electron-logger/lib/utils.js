'use strict';

const util = require('util');

/**
 * 格式化时间
 * @param {Date} time 
 */
let formatDate = function (time) {
    let year = time.getFullYear();
    let mouth = time.getMonth() + 1;
    let date = time.getDate();
    
    let hour = time.getHours();
    let minute = time.getMinutes();
    let second = time.getSeconds();

    if (mouth < 10) {
        mouth = '0' + mouth;
    }
    if (date < 10) {
        date = '0' + date;
    }
    if (hour < 10) {
        hour = '0' + hour;
    }
    if (minute < 10) {
        minute = '0' + minute;
    }
    if (second < 10) {
        second = '0' + second;
    }

    return `${year}-${mouth}-${date} ${hour}:${minute}:${second}`;
};

/**
 * 格式化 console 传入的 message 信息
 * 可能是对象, error 以及字符串
 * @param {*} type 
 * @param {*} info 
 */
let formatMessage = function (type, info) {

    let log = {
        process: process.type,
        type: type,
        message: '',
        stack: '',
        time:  Date.now(),
    };

    if (info instanceof Error) {
        // // 如果消息是 error
        // // message 消息则只有错误输出
        // // stack 第一行则会带有更全面的错误信息
        // // 所以使用 stack 第一行替代 message
        // // 并且将 stack 转成数组使用
        // let stack = info.stack.split(/(\r\n|\r|\n)/);
        // log.message = stack.shift();
        // log.stack = stack.map((message) => {
        //     return message.trim();
        // });
        log.message = info.message;
        log.stack = info.stack;
    } else if (typeof info === 'string') {
        log.message = info;
    } else {
        log.message = util.inspect(info);
        if (log.message.length > 1000000) {
            log.message = '[Object object]'
        }
    }

    return log;
};

/**
 * 格式化一个 log info
 * @param info 
 * @param args 
 */
let format = function (info, ...args) {
    if (typeof info === 'string') {
        info = util.format(info, ...args);
    }
    return info;
};

module.exports = {
    formatDate,
    formatMessage,
    format,
}