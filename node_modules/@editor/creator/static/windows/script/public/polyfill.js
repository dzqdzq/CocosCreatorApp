'use strict';

const { normalize } = require('path');
const { shell } = require('electron');

document.addEventListener('click', function(event) {
    //todo:为了兼容老版本的 event 事件，event.path 在新版本已经变成了 event.composedPath();
    if (!event.path) {
        event.path = event.composedPath();
    }
    let dom;
    // 如果点中的是 a 元素，则需要组织默认事件
    if (event.target.tagName === 'A') {
        dom = event.target;
    }

    if (!dom) {
        for (let i = 0; i<5; i++) {
            if (!event.path[i]) {
                break;
            }
            if (event.path[i].tagName === 'A') {
                dom = event.path[i];
            }
        }
    }

    if (dom) {
        event.preventDefault();

        let href = dom.href;

        if (/^file:\//.test(href)) {
            href = normalize(href.replace(/#.*/, ''));
            if (process.platform === 'darwin') {
                href = `/${href}`;
            }
        }

        shell.openExternal(href);
    }
});
