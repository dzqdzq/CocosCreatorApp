'use strict';

const ipc = require('@base/electron-base-ipc');
const wins = require('@base/electron-windows');
// const $panel = document.getElementById('panel');

window.__MAIN__ = false;

require('../../../../index');

// 首先初始化任务管理器
// require('../../../../task');

// 初始化插件注册到每个窗口的代码
require('../public/windows');

require('../public/polyfill');

Editor.Task.sync();

const panelMap = {};

ipc.on('editor-lib-panel:register-kit-panel', (event, name) => {
    if (!panelMap[name]) {
        panelMap[name] = document.createElement('panel-frame');
        panelMap[name].setAttribute('name', name);
        panelMap[name].style = `display: none; position: absolute; z-indx: 1; top: 0; left: 0; width: 100%; height: 100%;`;
        document.body.appendChild(panelMap[name]);
    }
});

ipc.on('editor-lib-panel:open-kit-panel', (event, name) => {
    Object.keys(panelMap).forEach((key) => {
        panelMap[key].style.display = name !== key ? 'none' : 'block';
    });
});

ipc.on('editor-lib-panel:hide-kit-panel', (event, name) => {
    if (panelMap[name]) {
        panelMap[name].style.display = 'none';
    }
});
