"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeListener=exports.emit=exports.once=exports.on=exports.sync=exports.removeSyncTask=exports.hasSyncTask=exports.updateSyncTask=exports.addSyncTask=void 0;const ipc=require("@base/electron-base-ipc"),events_1=require("events"),utils_1=require("../utils"),emmitter=new events_1.EventEmitter,syncTasks=[],syncTaskMap={};let syncTaskTimer=null,syncRendererMaskAfterRemoveTimer=null,syncRendererMaskAfterRemoveTimeout=300;function _syncRendererMask(){var e=syncTasks[syncTasks.length-1];e?ipc.broadcast("editor-lib-task:show",e.title,e.describe,e.message):ipc.broadcast("editor-lib-task:show",null)}function syncRendererMask(){null===syncTaskTimer&&(_syncRendererMask(),syncTaskTimer=null)}function addSyncTask(e,s,n){syncTaskMap[e]||(s={title:e,describe:s=(0,utils_1.translationI18n)(s),message:n=(0,utils_1.translationI18n)(n)},syncTaskMap[e]=s,syncTasks.push(s),syncRendererMask())}function updateSyncTask(e,s,n){e=syncTaskMap[e];e&&(e.describe=(0,utils_1.translationI18n)(s),e.message=(0,utils_1.translationI18n)(n),syncRendererMask())}async function hasSyncTask(){return!!syncTasks.length}function removeSyncTask(e){var s=syncTaskMap[e];s&&(-1!==(s=syncTasks.indexOf(s))&&syncTasks.splice(s,1),delete syncTaskMap[e],clearTimeout(syncRendererMaskAfterRemoveTimer),syncRendererMaskAfterRemoveTimer=setTimeout(syncRendererMask,syncRendererMaskAfterRemoveTimeout))}function sync(){}function on(e,s){return emmitter.on(e,s)}function once(e,s){return emmitter.once(e,s)}function emit(e,...s){return emmitter.emit(e,...s)}function removeListener(e,s){return emmitter.removeListener(e,s)}exports.addSyncTask=addSyncTask,exports.updateSyncTask=updateSyncTask,exports.hasSyncTask=hasSyncTask,exports.removeSyncTask=removeSyncTask,exports.sync=sync,exports.on=on,exports.once=once,exports.emit=emit,exports.removeListener=removeListener,ipc.on("editor-lib-task:query",e=>{var s=syncTasks[0];s?e.reply(null,s.title,s.describe,s.message):e.reply(null,"")}),ipc.on("editor-lib-task:call-protected",async(s,e,...n)=>{try{var r=await exports[e](...n);return s.reply(null,r),r}catch(e){s.reply(e)}return null});