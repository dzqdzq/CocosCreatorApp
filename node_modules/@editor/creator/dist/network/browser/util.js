"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function u(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,u)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendPostRequest=exports.sendGetRequest=exports.portIsOccupied=exports.canConnectPassport=exports.queryIpList=void 0;const semver=require("semver"),os=require("os"),https=require("https"),net=require("net"),http=require("http"),{parse:parse}=require("url"),{stringify:stringify}=require("querystring");function queryIpList(){const e=os.networkInterfaces();let t=[];for(const r of Object.keys(e))e[r].forEach(e=>{"IPv4"===e.family&&!1===e.internal&&t.push(e.address)});return"win32"===process.platform&&(t=t.filter(e=>/^(?!169\.254)/.test(e))),t}function canConnectPassport(){return new Promise(e=>{const t=https.request({method:"GET",host:"passport.cocos.com",port:443,path:"/oauth/token?xxx",headers:{},timeout:3e3},t=>{if(200!==t.statusCode)return console.warn("failed to connect login server... skipping login"),t.resume(),e(!1);e(!0)}).on("error",t=>{console.warn("failed to connect login server... skipping login"),e(!1)}).on("timeout",()=>{console.warn("failed to connect login server due to request timeout"),e(!1)});t.write(""),t.end()})}function portIsOccupied(e){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,r)=>{const o=net.createServer().listen(e);o.on("listening",function(){o.close(),t(!1)}),o.on("error",function(e){e.code,t(!0)})})})}function sendGetRequest(e,t){return new Promise((r,o)=>{var n=parse(e);t=stringify(t||{});semver.valid(semver.coerce(Editor.App.version));var s={"User-Agent":Editor.App.userAgent},i={method:"GET",host:n.hostname,port:n.port||80,path:n.pathname+(t?"?"+t:""),headers:s,ciphers:"ALL",secureProtocol:"TLSv1_method"},u=[];http.request(i,e=>{if(200!==e.statusCode)return r(null),void e.resume();e.on("data",e=>{u.push(e)}).on("end",()=>{r(Buffer.concat(u))})}).on("error",e=>{o(e)}).setTimeout(8e3,()=>{o(new Error(`POST Timeout: ${e}`))}).end()})}function sendPostRequest(e,t){return new Promise((r,o)=>{let n=parse(e);"object"==typeof t?t=stringify(t||{}):t+="";let s={"Content-Type":"application/x-www-form-urlencoded","Content-Length":t.length,"User-Agent":Editor.App.userAgent},i={method:"POST",host:n.hostname,port:n.port||443,path:n.pathname,headers:s,ciphers:"ALL",secureProtocol:"TLSv1_method"};var u=[];let c=(n.protocol.startsWith("https:")?https:http).request(i,e=>{if(200!==e.statusCode)return o(new Error("Connect Failed")),void e.resume();e.on("data",e=>{u.push(e)}).on("end",()=>{r(Buffer.concat(u))})}).on("error",e=>{o(e)}).setTimeout(8e3,()=>{o(new Error(`POST Timeout: ${e}`))});c.write(t),c.end()})}exports.queryIpList=queryIpList,exports.canConnectPassport=canConnectPassport,exports.portIsOccupied=portIsOccupied,exports.sendGetRequest=sendGetRequest,exports.sendPostRequest=sendPostRequest;