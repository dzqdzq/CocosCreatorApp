"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{p(i.next(e))}catch(e){s(e)}}function a(e){try{p(i.throw(e))}catch(e){s(e)}}function p(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}p((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=exports.builtin=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),app_1=require("../../app"),setting=require("@editor/setting");function init(){return __awaiter(this,void 0,void 0,function*(){try{const e=(0,path_1.join)(app_1.App.path,"../builtin.js"),t=(0,path_1.join)(app_1.App.path,"../builtin.json");let n;if((0,fs_extra_1.existsSync)(e)){const t=require(e);t&&t.main&&(n=yield t.main())}else(0,fs_extra_1.existsSync)(t)&&(n=yield(0,fs_extra_1.readJSON)(t));n&&(Array.isArray(n.disableBuiltin)?exports.builtin.disableBuiltin=n.disableBuiltin:exports.builtin.disableBuiltin=[],Array.isArray(n.extensions)?exports.builtin.extensions=n.extensions.map(e=>(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(app_1.App.path,"..",e)):exports.builtin.extensions=[],n.env&&(exports.builtin.env=n.env,n.env.HOME&&(exports.builtin.env.HOME=n.env.HOME,setting.PATH.HOME=n.env.HOME),n.env.PROJECT&&(exports.builtin.env.PROJECT=n.env.PROJECT,setting.PATH.PROJECT=n.env.PROJECT),n.env.LANGUAGE&&(exports.builtin.env.LANGUAGE=n.env.LANGUAGE,setting.PATH.LANGUAGE=n.env.LANGUAGE),n.env.LAYOUT&&(exports.builtin.env.LAYOUT=normalizePATH(n.env.LAYOUT)),n.env.MAIN_WINDOW_HEADER&&(exports.builtin.env.MAIN_WINDOW_HEADER=normalizePATH(n.env.MAIN_WINDOW_HEADER)),n.env.MAIN_WINDOW_FOOTER&&(exports.builtin.env.MAIN_WINDOW_FOOTER=normalizePATH(n.env.MAIN_WINDOW_FOOTER))))}catch(e){console.error(e),exports.builtin={}}})}function normalizePATH(e){return(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(app_1.App.path,"..",e)}exports.builtin={env:{}},exports.init=init;