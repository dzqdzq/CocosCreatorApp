"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeListener=exports.once=exports.on=exports.getSessionCode=exports.getUserToken=exports.logout=exports.login=exports.isLoggedIn=exports.getData=exports.hideMask=exports.showMask=exports.skip=void 0;const events_1=require("events"),ipc=require("@base/electron-base-ipc"),Profile=require("@base/electron-profile"),flag="editor-lib-user",user=process.send?require("@editor/user/dist/platform/child"):require("@editor/user"),emitter=new events_1.EventEmitter;if(!process.send){const a=Profile.load("global://editor/user.json"),user=require("@editor/user"),b=a.get();user.setData(b),user.on("info-update",async()=>{var e=await user.getData();a.set("session_id",e.session_id),a.set("session_key",e.session_key),a.set("cocos_uid",e.cocos_uid),a.set("email",e.email),a.set("nickname",e.nickname),a.save()})}user.on("login",async()=>{emitter.emit("login"),ipc.broadcast(flag+":emit","login");await user.getData()}),user.on("logout",()=>{emitter.emit("logout"),ipc.broadcast(flag+":emit","logout"),Editor.Menu.__protected__.remove("i18n:menu.develop",{label:"i18n:menu.logout"}),Editor.Menu.__protected__.apply()});let _skip=!1;function skip(){_skip=!0,ipc.broadcast(flag+":hideMask"),emitter.emit("skip"),ipc.broadcast(flag+":emit","skip"),Editor.Menu.__protected__.apply()}function showMask(){ipc.broadcast(flag+":showMask")}function hideMask(){ipc.broadcast(flag+":hideMask")}async function getData(){return user.getData()}async function isLoggedIn(){if(!0===_skip)return!1;try{return await user.isLoggedIn()}catch(e){return!1}}async function login(e,t){return _skip=!1,user.login(e,t)}async function logout(){return user.logout()}async function getUserToken(){return user.getUserToken()}async function getSessionCode(e){return user.getSessionCode(e)}function on(e,t){emitter.on(e,t)}function once(e,t){emitter.once(e,t)}function removeListener(e,t){emitter.removeListener(e,t)}exports.skip=skip,exports.showMask=showMask,exports.hideMask=hideMask,exports.getData=getData,exports.isLoggedIn=isLoggedIn,exports.login=login,exports.logout=logout,exports.getUserToken=getUserToken,exports.getSessionCode=getSessionCode,exports.on=on,exports.once=once,exports.removeListener=removeListener,ipc.on(flag+":call",async(t,e,...o)=>{e=module.exports[e];let s;try{s=await e(...o)}catch(e){return void t.reply(e,null)}t.reply(null,s)}),ipc.on(flag+":check-skip-init",async(e,t)=>(e.reply(null,_skip),_skip));