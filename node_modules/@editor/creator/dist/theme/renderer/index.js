"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),fs_1=require("fs"),path_1=require("path"),Profile=require("@base/electron-profile"),ipc=require("@base/electron-base-ipc"),ps=require("path"),fse=require("fs-extra"),dock=require("@editor/dock"),panel=require("@editor/panel"),Chroma=require("chroma-js"),profile=Profile.load("global://editor/theme.json"),uiKit=require("../../ui-kit"),windows=require("../../windows");function mColor(e,r){if(e){switch(e=Chroma("#"+e),r){case"weakest":e=e.brighten(.6);break;case"weaker":e=e.brighten(.3);break;case"emphasis":e=e.darken(.3);break;case"important":e=e.darken(.6)}return e.name()}}class Theme extends events_1.EventEmitter{$style;$cssVariables;constructor(){super(),this.$style=document.createElement("style"),document.head.appendChild(this.$style),dock.importStyle((0,path_1.join)(__dirname,"../dist/dock.css")),panel.importStyle((0,path_1.join)(__dirname,"../dist/panel.css")),this.$cssVariables=document.createElement("style"),document.head.appendChild(this.$cssVariables),window.addEventListener("resize",()=>{this.cssVariables()})}cssVariables(){this.$cssVariables.innerHTML=`
        body { 
            --device-pixel-ratio: ${devicePixelRatio}; 
        }
        `}getList(){return fse.readdirSync(ps.join(__dirname,"../../../static/theme")).map(e=>{var r=ps.extname(e);return e.replace(r,"")})}use(e){if(!e)return profile.get("theme");ipc.send("editor3d-lib-theme:use",e)}}const manager=module.exports=new Theme;function apply(e){e=e||"creator";e=(require("@editor/dock/lib/renderer/element/dock-resize").line=0,path_1.join)(__dirname,`../../../static/theme/${e}.js`);if((0,fs_1.existsSync)(e)){const i=JSON.parse(JSON.stringify(require(e)));let a="body {\n";Object.keys(i.color).forEach(s=>{Object.keys(i.color[s]).forEach(r=>{let t=i.color[s][r];"string"==typeof t&&(t={normal:t}),a+=`  --color-${s}-${r}: ${t.normal};
`,t.weaker||(t.weaker=Chroma(""+t.normal).brighten(i.contrast).hex()),t.weakest||(t.weakest=Chroma(""+t.weaker).brighten(i.contrast).hex()),t.emphasis||(t.emphasis=Chroma(""+t.normal).darken(i.contrast).hex()),t.important||(t.important=Chroma(""+t.emphasis).darken(i.contrast).hex()),Object.keys(t).forEach(e=>{a+=`  --color-${s}-${r}-${e}: ${t[e]};
`})})}),Object.keys(i.size).forEach(r=>{Object.keys(i.size[r]).forEach(e=>{a+=`  --size-${r}-${e}: ${i.size[r][e]};
`})}),Object.keys(i.font).forEach(e=>{a+=`  --font-${e}: ${i.font[e]};
`}),a+="\n}",manager.$style.innerHTML=a,manager.cssVariables()}else console.log("The theme does not exist. Use the default theme."),manager.use("creator")}apply("creator"),ipc.on("editor3d-lib-theme:use",async(e,r)=>{apply(r)});