"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),fs_1=require("fs"),path_1=require("path"),Profile=require("@base/electron-profile"),ipc=require("@base/electron-base-ipc"),ps=require("path"),fse=require("fs-extra"),dock=require("@editor/dock"),panel=require("@editor/panel"),Chroma=require("chroma-js"),profile=Profile.load("global://editor/theme.json"),uiKit=require("../../ui-kit"),window=require("../../windows");function mColor(e,t){if(e){switch(e=Chroma(`#${e}`),t){case"weakest":e=e.brighten(.6);break;case"weaker":e=e.brighten(.3);break;case"emphasis":e=e.darken(.3);break;case"important":e=e.darken(.6)}return e.name()}}class Theme extends events_1.EventEmitter{constructor(){super(),this.$style=document.createElement("style"),document.head.appendChild(this.$style),dock.importStyle((0,path_1.join)(__dirname,"../dist/dock.css")),panel.importStyle((0,path_1.join)(__dirname,"../dist/panel.css"))}getList(){return fse.readdirSync(ps.join(__dirname,"../../../static/theme")).map(e=>{const t=ps.extname(e);return e.replace(t,"")})}use(e){if(!e)return profile.get("theme");ipc.send("editor3d-lib-theme:use",e)}}const manager=module.exports=new Theme;function apply(e){e||(e="creator");let t=(0,path_1.join)(__dirname,`../../../static/theme/${e}.js`);if(!(0,fs_1.existsSync)(t))return console.log("The theme does not exist. Use the default theme."),void manager.use("creator");const r=JSON.parse(JSON.stringify(require(t)));let n="body {\n";Object.keys(r.color).forEach(e=>{Object.keys(r.color[e]).forEach(t=>{let o=r.color[e][t];"string"==typeof o&&(o={normal:o}),n+=`  --color-${e}-${t}: ${o.normal};\n`,o.weaker||(o.weaker=Chroma(`${o.normal}`).brighten(r.contrast).hex()),o.weakest||(o.weakest=Chroma(`${o.weaker}`).brighten(r.contrast).hex()),o.emphasis||(o.emphasis=Chroma(`${o.normal}`).darken(r.contrast).hex()),o.important||(o.important=Chroma(`${o.emphasis}`).darken(r.contrast).hex()),Object.keys(o).forEach(r=>{n+=`  --color-${e}-${t}-${r}: ${o[r]};\n`})})}),Object.keys(r.size).forEach(e=>{Object.keys(r.size[e]).forEach(t=>{n+=`  --size-${e}-${t}: ${r.size[e][t]};\n`})}),Object.keys(r.font).forEach(e=>{n+=`  --font-${e}: ${r.font[e]};\n`}),n+="\n}",manager.$style.innerHTML=n}apply(profile.get("theme")),ipc.on("editor3d-lib-theme:use",(e,t)=>__awaiter(void 0,void 0,void 0,function*(){apply(t)}));