"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._openDevTools=exports.querySelector=exports.has=exports.focus=exports.close=exports.openBeside=exports.open=exports.openKit=exports.preloadKit=exports.closeKit=exports.holdKit=void 0;const ipc=require("@base/electron-base-ipc"),panel=require("@editor/panel"),path_1=require("path"),electron_1=require("electron");let kitID=1;const cache={id:0,listeners:{}};function holdKit(){return new Promise(e=>{ipc.send("editor-lib-panel:call","holdKit").callback(()=>{e()})})}function closeKit(o){return new Promise(e=>{ipc.send("editor-lib-panel:call","closeKit",o).callback(()=>{e()})})}function preloadKit(){return new Promise(e=>{ipc.send("editor-lib-panel:call","preload").callback(()=>{e()})})}async function openKit(e,o){var t=o.elem.getBoundingClientRect();const l={params:o.params,listeners:Object.keys(o.listeners||o.events||{}),kitID:kitID++,screen:{x:globalThis.screen.availLeft,y:globalThis.screen.availTop,width:globalThis.screen.availWidth,height:globalThis.screen.availHeight},position:{x:t.x,y:t.y+t.height}};return cache.id=l.kitID,cache.listeners=o.listeners,new Promise((t,n)=>{ipc.send("editor-lib-panel:open-kit",e,l).callback((e,o)=>{if(e)return n(e);t(!!o)})})}function open(e,...o){return new Promise(t=>{ipc.send("editor-lib-panel:call","open",e,...o).callback((e,o)=>{t(!!o)})})}function openBeside(e,o,...n){return new Promise(t=>{ipc.send("editor-lib-panel:call","openBeside",e,o,...n).callback((e,o)=>{t(!!o)})})}function close(e){return ipc.send("editor-lib-panel:call","close",e),Promise.resolve(void 0)}function focus(e){return new Promise(t=>{ipc.send("editor-lib-panel:call","focus",e).callback((e,o)=>{t(!!o)})})}async function has(e){return new Promise((t,n)=>{ipc.send("editor-lib-panel:call","has",e).callback((e,o)=>{if(e)return n();t(!!o)})})}async function querySelector(e,o){return panel.query(e).map(e=>Array.from(e.shadowRoot.querySelectorAll(o)))}function _openDevTools(e){ipc.send("editor-lib-panel:call","_openDevTools",e)}exports.holdKit=holdKit,exports.closeKit=closeKit,exports.preloadKit=preloadKit,exports.openKit=openKit,exports.open=open,exports.openBeside=openBeside,exports.close=close,exports.focus=focus,exports.has=has,exports.querySelector=querySelector,ipc.on("editor-lib-panel:close",async(e,o)=>{var t,n=panel.query(o);return n&&n[0]?(t=n[0]).parentElement&&t.parentElement.$groups?(n.length<=1&&t.userData&&t.userData.panel&&(n=(0,path_1.join)(t.userData.packageDir,t.userData.panel),Editor.Module.__protected__.removeCache(n)),n=await t.parentElement.$groups.removePanel(o),e.reply(null,!(!1===n))):(e.reply(null,!0),void("kit"!==document.body.getAttribute("name")&&window.close())):e.reply(null,!0)}),exports._openDevTools=_openDevTools,ipc.on("editor-lib-panel:close",async(e,o)=>{var t,n=panel.query(o);return n&&n[0]?(t=n[0]).parentElement&&t.parentElement.$groups?(n.length<=1&&t.userData&&t.userData.panel&&(n=(0,path_1.join)(t.userData.packageDir,t.userData.panel),Editor.Module.__protected__.removeCache(n)),n=await t.parentElement.$groups.removePanel(o),e.reply(null,!(!1===n))):(e.reply(null,!0),void("kit"!==document.body.getAttribute("name")&&window.close())):e.reply(null,!0)}),ipc.on("editor-lib-panel:query-selection-text",e=>{var o=(window.getSelection()||"").toString();e.reply(null,o)}),ipc.on("editor-lib-panel:query-active-element-tag",(e,o)=>{var t=function e(o){return o&&o.shadowRoot?e(o.shadowRoot.activeElement):o}(document.activeElement);e.reply(null,t?t.tagName.toLowerCase():"")}),ipc.on("editor-lib-panel:open-beside",(e,o,t)=>{var n=document.querySelector("dock-frame");n&&n.appendPanel&&n.appendPanel(o,t)}),electron_1.ipcRenderer.on("editor-lib-panel:kit-panel-emit",(e,o,t,n)=>{o===cache.id&&cache.listeners[t]&&cache.listeners[t](n)});