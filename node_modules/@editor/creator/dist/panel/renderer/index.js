"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,a)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const ipc=require("@base/electron-base-ipc"),panel=require("@editor/panel"),Mousetrap=require("mousetrap"),kitControl=require("./kit-control");class Panel{constructor(){this._kitControl=kitControl}open(e,...t){return __awaiter(this,void 0,void 0,function*(){return new Promise(n=>{ipc.send("editor-lib-panel:call","open",e,...t).callback(()=>{n()})})})}close(e){ipc.send("editor-lib-panel:call","close",e)}focus(e){return new Promise(t=>{ipc.send("editor-lib-panel:call","focus",e).callback(()=>{t()})})}has(e){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,n)=>{ipc.send("editor-lib-panel:call","has",e).callback((e,o)=>{if(e)return n();t(o)})})})}querySelector(e,t){return __awaiter(this,void 0,void 0,function*(){return panel.query(e).map(e=>Array.from(e.shadowRoot.querySelectorAll(t)))})}_openDevTools(e){ipc.send("editor-lib-panel:call","_openDevTools",e)}}module.exports=new Panel,exports.default=module.exports,ipc.on("editor-lib-panel:close",(e,t)=>__awaiter(void 0,void 0,void 0,function*(){const n=panel.query(t);if(!n||!n[0])return e.reply(null,!0);const o=n[0];if(!o.parentElement||!o.parentElement.$groups)return e.reply(null,!0),void("kit"!==document.body.getAttribute("name")&&window.close());const r=yield o.parentElement.$groups.removePanel(t);return e.reply(null,!(!1===r))})),ipc.on("editor-lib-panel:query-selection-text",e=>{const t=(window.getSelection()||"").toString();e.reply(null,t)}),ipc.on("editor-lib-panel:query-active-element-tag",(e,t)=>{const n=function e(t){return t&&t.shadowRoot?e(t.shadowRoot.activeElement):t}(document.activeElement);e.reply(null,n?n.tagName.toLowerCase():"")});