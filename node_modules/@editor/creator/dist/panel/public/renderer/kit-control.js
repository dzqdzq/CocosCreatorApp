"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function l(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const EventEmitter=require("events").EventEmitter,ipc=require("@base/electron-base-ipc");let optionsCache=null,$kit=null;class KitControl extends EventEmitter{getOptionsCache(){return new Promise((e,t)=>{ipc.send("editor-lib-panel-kit:call","getOptionsCache").callback((i,n={})=>{if(i)return t(i);optionsCache=i,e(n)})})}open(e){return __awaiter(this,void 0,void 0,function*(){if(!e)return;const t=($kit=e.$kit).getBoundingClientRect(),i={x:t.x,y:t.y+t.height,screen:{x:screen.availLeft,y:screen.availTop,width:screen.availWidth,height:screen.availHeight},timestamp:Date.now()};optionsCache=Object.assign(i,e),yield this.registerEvent(optionsCache),delete optionsCache.$kit,ipc.send("editor-lib-panel-kit:call","open",JSON.parse(JSON.stringify(optionsCache)))})}move(e,t){return ipc.send("editor-lib-panel-kit:call","move",e,t)}hide(){return optionsCache=null,ipc.send("editor-lib-panel-kit:call","hide")}hold(){return optionsCache=null,ipc.send("editor-lib-panel-kit:call","hold")}register(e){return ipc.send("editor-lib-panel-kit:call","register",e)}unregister(e){return ipc.send("editor-lib-panel-kit:call","unregister",e)}registerEvent(e){return __awaiter(this,void 0,void 0,function*(){"object"==typeof e.events&&Object.keys(e.events).forEach(t=>{this._on(t,e.timestamp,e.events[t])})})}_emit(...e){super.emit(...e)}emit(e,t,...i){ipc.send("editor-lib-panel-kit:call","emit",e,t,...i)}_on(e,t,i){super.on(e,(e,...n)=>{t===e&&i(...n)})}_hide(){this.removeAllListeners()}}const control=new KitControl;exports.default=control,ipc.on("editor-lib-panel-kit:emit",(e,...t)=>{control._emit(...t)}),ipc.on("editor-lib-panel-kit:hide",(e,...t)=>{control._hide()});