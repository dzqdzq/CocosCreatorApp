"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._findPathHandle=void 0;const fs=require("fs"),vm=require("vm"),v8=require("v8"),path=require("path"),Module=require("module"),zlib=require("zlib");let _findPathHandle=function(e){return e},compiler=(exports._findPathHandle=_findPathHandle,null);try{compiler=process._linkedBinding("electron_common_compile")}catch(e){console.log(`(${process.pid}) Develop mode...`)}Module.__findPath=Module._findPath,Module._findPath=function(...e){var[t,r]=(0,exports._findPathHandle)(e),n=Module.__findPath(t,r,e[2]);return n||Module.__findPath(t.replace(/\.js$/,""),r,e[2])},global.__vm__=vm,v8.setFlagsFromString("--no-lazy"),12<=Number.parseInt(process.versions.node.split(".")[0],10)&&v8.setFlagsFromString("--no-flush-bytecode");const readSourceHash=function(e){if(Buffer.isBuffer(e))return process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?e.slice(12,16).reduce((e,t,r)=>e+t*Math.pow(256,r),0):e.slice(8,12).reduce((e,t,r)=>e+t*Math.pow(256,r),0);throw new Error("bytecodeBuffer must be a buffer object.")},compileCode=function(e){if("string"!=typeof e)throw new Error(`javascriptCode must be string. ${typeof e} was given.`);e=new vm.Script(e,{produceCachedData:!0});return e.createCachedData&&e.createCachedData.call?e.createCachedData():e.cachedData};function stripBOM(e){return e=65279===e.charCodeAt(0)?e.slice(1):e}function fixBytecode(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");var t=compileCode('"c_c"');process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?(t.slice(16,20).copy(e,16),t.slice(20,24).copy(e,20)):process.version.startsWith("v12")||process.version.startsWith("v13")?t.slice(12,16).copy(e,12):(t.slice(12,16).copy(e,12),t.slice(16,20).copy(e,16))}const EXTENSIONS=["cjs","js"];let extFunction=function(r,e){var t=path.basename(e,path.extname(e));for(const c of EXTENSIONS){var n=t+"."+c,n=path.join(path.dirname(e),n);if(fs.existsSync(n))return e=n,n=fs.readFileSync(e,"utf8"),r._compile(stripBOM(n),e)}let o;var i=t+".jsc",i=path.join(path.dirname(e),i);function s(e){return r.require(e)}fs.existsSync(i)&&(e=i,o=loadJSC.call(this,i)),s.resolve=function(e,t){return"highlight.js"!==e&&"ipaddr.js"!==e&&(e=e.replace(/\.js$/,"")),Module._resolveFilename(e,r,!1,t)},s.main=process.mainModule,s.extensions=Module._extensions,s.cache=Module._cache;i=path.dirname(e),i=[r.exports,s,r,e,i,process,global];return o.apply(r.exports,i)};const cccFunction=function(r,e){var t=path.basename(e,path.extname(e))+".ccc",t=path.join(path.dirname(e),t);function n(e){return r.require(e)}n.resolve=function(e,t){return"highlight.js"!==e&&"ipaddr.js"!==e&&(e=e.replace(/\.js$/,"")),Module._resolveFilename(e,r,!1,t)},n.main=process.mainModule,n.extensions=Module._extensions,n.cache=Module._cache;var o=path.dirname(t),o=[r.exports,n,r,e,o,process,global];return fs.existsSync(t)?loadCCC.call(this,e=t,...o):null};function loadCCC(e,...t){return compiler.test(e,["exports","require","module","__filename","__dirname"],{filename:e},...t)}function loadJSC(e){return _compileCode(fs.readFileSync(e),e)}function _compileCode(e,t){fixBytecode(e);var r=readSourceHash(e);let n="";1<r&&(n='"'+"â€‹".repeat(r-2)+'"');r=new vm.Script(n,{filename:t,lineOffset:0,displayErrors:!0,cachedData:e});if(r.cachedDataRejected)throw new Error("Invalid or incompatible cached data (cachedDataRejected)");return r.runInThisContext({filename:t,lineOffset:0,columnOffset:0,displayErrors:!0})}function extGFunction(e,t){var r=fs.readFileSync(t),r=zlib.gunzipSync(r);e._compile(r.toString(),t)}Module._extensions[".js"]=extFunction,Module._extensions[".jsc"]=extFunction,Module._extensions[".jsg"]=extGFunction,Module._extensions[".ccc"]=cccFunction;