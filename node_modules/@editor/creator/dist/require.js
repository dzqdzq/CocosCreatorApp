"use strict";const fs=require("fs"),ps=require("path"),vm=require("vm"),v8=require("v8"),path=require("path"),Module=require("module"),zlib=require("zlib");require("fix-electron-require");let compiler=null;try{compiler=process._linkedBinding("electron_common_compile")}catch(e){console.log(`(${process.pid}) Develop mode...`)}Module.prototype.__require=Module.prototype.require,Module.prototype.require=function(e){return"highlight.js"===e||"ipaddr.js"===e||"svg.js"===e||"psd.js"===e?this.__require(e):(e=e.replace(/\.js$/,""),this.__require(e))},global.__vm__=vm,v8.setFlagsFromString("--no-lazy"),Number.parseInt(process.versions.node.split(".")[0],10)>=12&&v8.setFlagsFromString("--no-flush-bytecode");const readSourceHash=function(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");return process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?e.slice(12,16).reduce((e,t,r)=>e+=t*Math.pow(256,r),0):e.slice(8,12).reduce((e,t,r)=>e+=t*Math.pow(256,r),0)},compileCode=function(e){if("string"!=typeof e)throw new Error(`javascriptCode must be string. ${typeof e} was given.`);let t=new vm.Script(e,{produceCachedData:!0});return t.createCachedData&&t.createCachedData.call?t.createCachedData():t.cachedData};function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function fixBytecode(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");let t=compileCode('"c_c"');process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?(t.slice(16,20).copy(e,16),t.slice(20,24).copy(e,20)):process.version.startsWith("v12")||process.version.startsWith("v13")?t.slice(12,16).copy(e,12):(t.slice(12,16).copy(e,12),t.slice(16,20).copy(e,16))}let extFunction=function(e,t){let r,o=path.basename(t,path.extname(t)),i=`${o}.jsc`,s=`${o}.js`,n=`${o}.cjs`,c=path.join(path.dirname(t),s),a=path.join(path.dirname(t),i),l=path.join(path.dirname(t),n);if(fs.existsSync(c)){t=c;const r=fs.readFileSync(t,"utf8");return e._compile(stripBOM(r),t)}if(!fs.existsSync(a)){t=l;const r=fs.readFileSync(t,"utf8");return e._compile(stripBOM(r),t)}function u(t){return e.require(t)}t=a,r=loadJSC.call(this,a),u.resolve=function(t,r){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,r):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,r))},u.main=process.mainModule,u.extensions=Module._extensions,u.cache=Module._cache;let p=path.dirname(t),d=[e.exports,u,e,t,p,process,global];return r.apply(e.exports,d)};const cccFunction=function(e,t){let r=`${path.basename(t,path.extname(t))}.ccc`,o=path.join(path.dirname(t),r);function i(t){return e.require(t)}i.resolve=function(t,r){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,r):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,r))},i.main=process.mainModule,i.extensions=Module._extensions,i.cache=Module._cache;let s=path.dirname(o),n=[e.exports,i,e,t,s,process,global];return fs.existsSync(o)?(t=o,loadCCC.call(this,o,...n)):null};function loadCCC(e,...t){return compiler.test(e,["exports","require","module","__filename","__dirname"],{filename:e},...t)}function loadJSC(e){return _compileCode(fs.readFileSync(e),e)}function _compileCode(e,t){fixBytecode(e);let r=readSourceHash(e),o="";r>1&&(o='"'+"â€‹".repeat(r-2)+'"');let i=new vm.Script(o,{filename:t,lineOffset:0,displayErrors:!0,cachedData:e});if(i.cachedDataRejected)throw new Error("Invalid or incompatible cached data (cachedDataRejected)");return i.runInThisContext({filename:t,lineOffset:0,columnOffset:0,displayErrors:!0})}function extGFunction(e,t){const r=fs.readFileSync(t),o=zlib.gunzipSync(r);e._compile(o.toString(),t)}Module._extensions[".js"]=extFunction,Module._extensions[".jsc"]=extFunction,Module._extensions[".jsg"]=extGFunction,Module._extensions[".ccc"]=cccFunction;