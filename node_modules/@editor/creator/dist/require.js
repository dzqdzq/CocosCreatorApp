"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._findPathHandle=void 0;const fs=require("fs"),vm=require("vm"),v8=require("v8"),path=require("path"),Module=require("module"),zlib=require("zlib");let _findPathHandle=function(e){return e};exports._findPathHandle=_findPathHandle;let compiler=null;try{compiler=process._linkedBinding("electron_common_compile")}catch(e){console.log(`(${process.pid}) Develop mode...`)}Module.__findPath=Module._findPath,Module._findPath=function(...e){const[t,n]=(0,exports._findPathHandle)(e),o=Module.__findPath(t,n,e[2]);return o||Module.__findPath(t.replace(/\.js$/,""),n,e[2])},global.__vm__=vm,v8.setFlagsFromString("--no-lazy"),Number.parseInt(process.versions.node.split(".")[0],10)>=12&&v8.setFlagsFromString("--no-flush-bytecode");const readSourceHash=function(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");return process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?e.slice(12,16).reduce((e,t,n)=>e+=t*Math.pow(256,n),0):e.slice(8,12).reduce((e,t,n)=>e+=t*Math.pow(256,n),0)},compileCode=function(e){if("string"!=typeof e)throw new Error(`javascriptCode must be string. ${typeof e} was given.`);let t=new vm.Script(e,{produceCachedData:!0});return t.createCachedData&&t.createCachedData.call?t.createCachedData():t.cachedData};function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function fixBytecode(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");let t=compileCode('"c_c"');process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?(t.slice(16,20).copy(e,16),t.slice(20,24).copy(e,20)):process.version.startsWith("v12")||process.version.startsWith("v13")?t.slice(12,16).copy(e,12):(t.slice(12,16).copy(e,12),t.slice(16,20).copy(e,16))}const EXTENSIONS=["cjs","js"];let extFunction=function(e,t){const n=path.basename(t,path.extname(t));for(const o of EXTENSIONS){const r=`${n}.${o}`,s=path.join(path.dirname(t),r);if(fs.existsSync(s)){t=s;const n=fs.readFileSync(t,"utf8");return e._compile(stripBOM(n),t)}}let o;const r=`${n}.jsc`,s=path.join(path.dirname(t),r);function i(t){return e.require(t)}fs.existsSync(s)&&(t=s,o=loadJSC.call(this,s)),i.resolve=function(t,n){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,n):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,n))},i.main=process.mainModule,i.extensions=Module._extensions,i.cache=Module._cache;let c=path.dirname(t),a=[e.exports,i,e,t,c,process,global];return o.apply(e.exports,a)};const cccFunction=function(e,t){let n=`${path.basename(t,path.extname(t))}.ccc`,o=path.join(path.dirname(t),n);function r(t){return e.require(t)}r.resolve=function(t,n){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,n):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,n))},r.main=process.mainModule,r.extensions=Module._extensions,r.cache=Module._cache;let s=path.dirname(o),i=[e.exports,r,e,t,s,process,global];return fs.existsSync(o)?(t=o,loadCCC.call(this,o,...i)):null};function loadCCC(e,...t){return compiler.test(e,["exports","require","module","__filename","__dirname"],{filename:e},...t)}function loadJSC(e){return _compileCode(fs.readFileSync(e),e)}function _compileCode(e,t){fixBytecode(e);let n=readSourceHash(e),o="";n>1&&(o='"'+"â€‹".repeat(n-2)+'"');let r=new vm.Script(o,{filename:t,lineOffset:0,displayErrors:!0,cachedData:e});if(r.cachedDataRejected)throw new Error("Invalid or incompatible cached data (cachedDataRejected)");return r.runInThisContext({filename:t,lineOffset:0,columnOffset:0,displayErrors:!0})}function extGFunction(e,t){const n=fs.readFileSync(t),o=zlib.gunzipSync(n);e._compile(o.toString(),t)}Module._extensions[".js"]=extFunction,Module._extensions[".jsc"]=extFunction,Module._extensions[".jsg"]=extGFunction,Module._extensions[".ccc"]=cccFunction;