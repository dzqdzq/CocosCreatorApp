"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.trashItem=exports.copy=exports.unzip=exports.getName=void 0;const fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),{existsSync:existsSync}=require("fs"),{basename:basename,dirname:dirname,extname:extname,join:join}=require("path");function getName(e){if(!existsSync(e))return e;const t=dirname(e),n=extname(e);let r=basename(e,n);do{/(\d+)$/.test(r)?r=r.replace(/(\d+)$/,(e,t)=>{let n=parseInt(t,10);return n=(n+=1).toString().padStart(t.length,"0")}):r+="-001",e=join(t,r)}while(existsSync(e+n));return e+n}exports.getName=getName;const unzipOfDarwin=function(e,t,n){const r=dirname(t);(0,fs_extra_1.ensureDirSync)(r);const o=(0,child_process_1.spawn)("unzip",[e,"-d",t]);let s="";o.stderr.on("data",e=>{s+=e});let i="";o.stdout.on("data",e=>{i+=e}),o.on("close",e=>{i&&console.log(i),s&&console.warn(s);let t=null;0!==e&&(t=new Error("The decompression has failed")),n(t)})},unzipOfWin32=function(e,t,n){const r=dirname(t);(0,fs_extra_1.ensureDirSync)(r);const o=(0,child_process_1.spawn)(join(Editor.App.path,"../tools/unzip.exe"),[e,"-d",t]);let s="";o.stderr.on("data",e=>{s+=e});let i="";o.stdout.on("data",e=>{i+=e}),o.on("close",e=>{i&&console.log(i),s&&console.warn(s);let t=null;0!==e&&(t=new Error("The decompression has failed")),n(t)})};function unzip(e,t,n={}){return __awaiter(this,void 0,void 0,function*(){let r;r="win32"===process.platform?unzipOfWin32:unzipOfDarwin;const o=join(Editor.Project.tmpDir,".utils_temp",basename(e,".zip"));if(yield(0,fs_extra_1.remove)(o),yield new Promise((t,n)=>{r(e,o,e=>{if(e)return n(e);t()})}),n.peel){const e=(0,fs_extra_1.readdirSync)(o);1===e.length?yield(0,fs_extra_1.copy)(join(o,e[0]),t):yield(0,fs_extra_1.copy)(o,t)}else yield(0,fs_extra_1.copy)(o,t);yield(0,fs_extra_1.remove)(o)})}function copy(e,t){!function e(t,n){if(!existsSync(t))return;if((0,fs_extra_1.statSync)(t).isDirectory()){(0,fs_extra_1.ensureDirSync)(n);const r=(0,fs_extra_1.readdirSync)(t);for(const o of r)e(join(t,o),join(n,o))}else(0,fs_extra_1.copySync)(t,n),(0,fs_extra_1.chmodSync)(n,511)}(e,t)}exports.unzip=unzip,exports.copy=copy,exports.trashItem="browser"===process.type?require("../browser/file").trashItem:require("../renderer/file").trashItem;