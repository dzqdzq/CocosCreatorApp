"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateProject=exports.migrateLocal=exports.migrateGlobal=exports._unregisterMigration=exports._registerMigration=void 0;const migrationsMap={},StartVerison="0.0.0";function _registerMigration(r,e){e=e.filter(r=>r.profile),migrationsMap[r]=e}function _unregisterMigration(r){migrationsMap[r]&&(migrationsMap[r].forEach(r=>{Editor.Module.__protected__.removeCache(r.profile)}),delete migrationsMap[r])}async function migrateGlobal(r,e,t,i){return!!migrationsMap[r]&&runMigrateHandle("migrateGlobal",r,e,t,i)}async function migrateLocal(r,e,t,i){return!!migrationsMap[r]&&runMigrateHandle("migrateLocal",r,e,t,i)}async function migrateProject(r,e,t,i){return!!migrationsMap[r]&&runMigrateHandle("migrateProject",r,e,t,i)}async function runMigrateHandle(e,t,i,r,o){let a=[];if(i===StartVerison){var n=migrationsMap[t].find(r=>r.version===StartVerison);if(!n)return;a=[n]}else a=i?migrationsMap[t].filter(r=>0<Editor.Package.__protected__.compareVersion(r.version,i)&&(!o||Editor.Package.__protected__.compareVersion(r.version,o)<=0)):migrationsMap[t].filter(r=>r.version!==StartVerison&&(!o||Editor.Package.__protected__.compareVersion(r.version,o)<=0));if(!a.length)return!1;for(const g of a){var s=Editor.Module.__protected__.requireFile(g.profile);if(s[e])try{await s[e](r),console.debug(`[Package] Profile ${e}: ${t}(${g.version})...`)}catch(r){console.error(r),console.error(`[Package] Profile ${e}: ${t}(${g.version}) failed!`)}}return!0}exports._registerMigration=_registerMigration,exports._unregisterMigration=_unregisterMigration,exports.migrateGlobal=migrateGlobal,exports.migrateLocal=migrateLocal,exports.migrateProject=migrateProject;