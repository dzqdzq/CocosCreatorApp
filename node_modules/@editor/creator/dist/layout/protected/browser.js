"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeListener=exports.emit=exports.once=exports.on=exports.queryList=exports.remove=exports.add=exports.query=exports.init=void 0;const fs_extra_1=require("fs-extra"),events_1=require("events"),path_1=require("path"),app_1=require("../../app"),ipc=(require("@editor/dock"),require("@base/electron-base-ipc")),windows=require("@base/electron-windows"),LAYOUT_CACHE_PATH=(0,path_1.join)(app_1.App.home,"editor","layout.json");let LAYOUT_INFO={version:"1.0.0",layoutMap:{}};const emitter=new events_1.EventEmitter;async function init(e){if((0,fs_extra_1.existsSync)(LAYOUT_CACHE_PATH))try{LAYOUT_INFO=await(0,fs_extra_1.readJSON)(LAYOUT_CACHE_PATH)}catch(e){console.warn(e)}e&&add("default",e)}async function query(e){return e?LAYOUT_INFO.layoutMap[e]:(e=windows.uuids[0],(e=windows.uuid2info[e])&&e.userData?e.userData.layout:null)}async function save(){Object.keys(LAYOUT_INFO.layoutMap).length&&await(0,fs_extra_1.outputJSON)(LAYOUT_CACHE_PATH,LAYOUT_INFO)}async function add(e,t){t=t||await this.query(),LAYOUT_INFO.layoutMap[e]=t,emit("layout-added"),save()}async function remove(e){delete LAYOUT_INFO.layoutMap[e],emit("layout-deleted"),save()}async function queryList(){return JSON.parse(JSON.stringify(LAYOUT_INFO.layoutMap))}function on(e,t){return emitter.on(e,t)}function once(e,t){return emitter.once(e,t)}function emit(e){return ipc.broadcast("editor3d-lib-layout:emit",e),emitter.emit(e)}function removeListener(e,t){return emitter.removeListener(e,t)}exports.init=init,exports.query=query,exports.add=add,exports.remove=remove,exports.queryList=queryList,exports.on=on,exports.once=once,exports.emit=emit,exports.removeListener=removeListener,ipc.on("editor-lib-layout:call",async(t,e,...r)=>{try{var o=await exports[e](...r);t.reply(null,o)}catch(e){t.reply(e)}});