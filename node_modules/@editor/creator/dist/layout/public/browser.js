"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.query=exports.apply=void 0;const electron_1=require("electron"),panel=require("@editor/panel"),ipc=require("@base/electron-base-ipc");let mainID=null;async function apply(e){if(null!==mainID){const t=[];!function e(o){o.panels&&o.panels.forEach(e=>{t.push(e)}),o.children&&o.children.forEach(e)}(e.layout);for(let e=0;e<t.length;e++){var o=t[e],r=panel.getWindow(o)||[];if(!await tryClose(o,r))return void console.warn(`Failed to change layout: ${o} Panels are not allowed to close`);1===r.length&&r[0]===mainID&&t.splice(e--,1)}for(let e=0;e<t.length;e++){var n=t[e];if(!await Editor.Panel.close(n))return void console.warn(`Failed to change layout: ${n} Panels are not allowed to close`)}var l=electron_1.BrowserWindow.fromId(mainID);ipc.sendToWin(l,"editor-lib-layout:apply",e)}}async function query(e){return Editor.Layout.__protected__.query(e)}async function tryClose(l,e){return null==e||(e=e.map(n=>new Promise((r,e)=>{var o=electron_1.BrowserWindow.fromId(n);ipc.sendToWin(o,"editor-lib-layout:try-close",l).callback((e,o)=>{r(o)})})),(await Promise.all(e)).every(Boolean))}exports.apply=apply,exports.query=query,ipc.on("editor-lib-layout:main",e=>{mainID=e.sender&&(e=electron_1.BrowserWindow.fromWebContents(e.sender),e)&&"number"==typeof e.id?e.id:null});