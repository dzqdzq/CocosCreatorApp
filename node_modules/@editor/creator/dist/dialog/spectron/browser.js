"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function l(e){try{a(o.next(e))}catch(e){r(e)}}function s(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.error=exports.warn=exports.info=exports.save=exports.select=exports.confirmDialog=exports.queryAllDialog=exports.queryDialog=void 0;const setting=require("@editor/setting"),electron_1=require("electron"),fs_1=require("fs"),path_1=require("path"),ipc=require("@base/electron-base-ipc");let ready=electron_1.app.isReady();electron_1.app.once("ready",()=>{ready=!0});const taskQueue=[];function dialogHandler(e,t={},n=null){return new Promise((o,i)=>{taskQueue.push({options:Object.assign({id:Date.now()+"",dialogType:e},t),window:n,promise:{resolve:o,reject:i}})})}function queryDialog(){return taskQueue[taskQueue.length-1]&&taskQueue[taskQueue.length-1].options}function queryAllDialog(){return taskQueue.map(e=>e.options)}function confirmDialog(e,t){const n=taskQueue.findIndex(t=>t.options.id===e);return e&&t&&-1!==n?(taskQueue.splice(n,1)[0].promise.resolve(t),!0):(console.debug(`Dialog id=${e} is not exsist!`),!1)}function select(e={},t=null){return __awaiter(this,void 0,void 0,function*(){e.path&&(0,fs_1.existsSync)(e.path)||(e.path=setting.PATH.PROJECT);const n={defaultPath:e.path||"",properties:["directory"===e.type?"openDirectory":"openFile"],buttonLabel:e.button||""};return e.multi&&(n.properties||(n.properties=[]),n.properties.push("multiSelections")),e.title&&(n.title=e.title),e.extensions&&(n.filters=[{name:e.extensions,extensions:e.extensions.split(",").filter(Boolean)}]),e.filters&&(n.filters=e.filters),t&&!t.isVisible()&&(t=null),dialogHandler("select",n,t)})}function save(e={},t=null){return __awaiter(this,void 0,void 0,function*(){e.path&&(0,fs_1.existsSync)((0,path_1.dirname)(e.path))||(e.path=(0,path_1.join)(setting.PATH.PROJECT,e.path?(0,path_1.basename)(e.path):""));const n={defaultPath:e.path,properties:[],buttonLabel:e.button||void 0};return e.title&&(n.title=e.title),e.filters&&(n.filters=e.filters),t&&!t.isVisible()&&(t=null),dialogHandler("save",n,t)})}function info(e,t={},n=null){if(!e)throw new Error("The dialog must input in the message");const o={title:t.title||"Info",message:e,detail:t.detail||"",type:"none",checkboxLabel:t.checkboxLabel||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons||["Cancel"]};return n&&!n.isVisible()&&(n=null),dialogHandler("info",o,n)}function warn(e,t={},n=null){if(!e)throw new Error("The dialog must input in the message");const o={title:t.title||"Warn",message:e,detail:t.detail||"",type:"warning",checkboxLabel:t.checkboxLabel||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons||["Cancel"]};return n&&!n.isVisible()&&(n=null),dialogHandler("warn",o,n)}function error(e,t={},n=null){if(!e)throw new Error("The dialog must input in the message");const o={title:t.title||"Error",message:e,detail:t.detail||"",type:"error",checkboxLabel:t.checkboxLabel||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons||["Cancel"]};return n&&!n.isVisible()&&(n=null),dialogHandler("error",o,n)}exports.queryDialog=queryDialog,exports.queryAllDialog=queryAllDialog,exports.confirmDialog=confirmDialog,exports.select=select,exports.save=save,exports.info=info,exports.warn=warn,exports.error=error,ipc.on("editor-lib-dialog:call",(e,t,...n)=>__awaiter(void 0,void 0,void 0,function*(){try{const o=yield module.exports[t](...n,e.sender?electron_1.BrowserWindow.fromWebContents(e.sender.hostWebContents||e.sender):null);return e.reply(null,o),o}catch(t){return e.reply(t),null}}));