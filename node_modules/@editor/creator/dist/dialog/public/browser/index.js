"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.error=exports.warn=exports.info=exports.save=exports.select=void 0;const utils_1=require("../../utils"),setting=require("@editor/setting"),browser_1=require("../../protected/browser"),electron_1=require("electron"),fs_1=require("fs"),path_1=require("path"),ipc=require("@base/electron-base-ipc");let ready=electron_1.app.isReady();const waitList=[];function select(e={},t=null){return __awaiter(this,void 0,void 0,function*(){if("command"===(0,browser_1.getMode)())return console.log(e),new Promise(e=>{e({canceled:!1,filePaths:[]})});if(!ready)return new Promise((r,n)=>{waitList.push({method:"select",params:[e,t],resolve:r,reject:n})});e.path&&(0,fs_1.existsSync)(e.path)||(e.path=setting.PATH.PROJECT);const r={defaultPath:e.path||"",properties:"win32"===process.platform?e.type?["directory"===e.type?"openDirectory":"openFile"]:void 0:e.type?["directory"===e.type?"openDirectory":"openFile"]:["openDirectory","openFile"],buttonLabel:(0,utils_1.translateI18n)(e.button)||""};e.multi&&(r.properties||(r.properties=[]),r.properties.push("multiSelections")),e.title&&(r.title=(0,utils_1.translateI18n)(e.title)),e.extensions&&(r.filters=[{name:e.extensions,extensions:e.extensions.split(",").filter(Boolean)}]),e.filters&&(r.filters=e.filters),t&&!t.isVisible()&&(t=null);const n=yield electron_1.dialog.showOpenDialog(t,r);if(Array.isArray(n.filePaths))for(let e=0;e<n.filePaths.length;e++)n.filePaths[e]=(0,path_1.normalize)(n.filePaths[e]);return n})}function save(e={},t=null){return __awaiter(this,void 0,void 0,function*(){if("command"===(0,browser_1.getMode)())return console.log(e),new Promise(e=>{e({canceled:!1})});if(!ready)return new Promise((r,n)=>{waitList.push({method:"save",params:[e,t],resolve:r,reject:n})});e.path&&(0,fs_1.existsSync)((0,path_1.dirname)(e.path))||(e.path=(0,path_1.join)(setting.PATH.PROJECT,e.path?(0,path_1.basename)(e.path):""));const r={defaultPath:e.path,properties:[],buttonLabel:(0,utils_1.translateI18n)(e.button)||void 0};e.title&&(r.title=(0,utils_1.translateI18n)(e.title)),e.filters&&(r.filters=e.filters),t&&!t.isVisible()&&(t=null);const n=yield electron_1.dialog.showSaveDialog(t,r);return n.filePath&&(n.filePath=(0,path_1.normalize)(n.filePath)),n})}function info(e,t={},r=null){if(!e)throw new Error("The dialog must input in the message");if("command"===(0,browser_1.getMode)())return console.log(e),new Promise(e=>{e({response:t.default,checkboxChecked:!1})});if(!ready)return new Promise((n,o)=>{waitList.push({method:"info",params:[e,t,r],resolve:n,reject:o})});const n={title:(0,utils_1.translateI18n)(t.title)||"Info",message:(0,utils_1.translateI18n)(e),detail:(0,utils_1.translateI18n)(t.detail)||"",type:"none",checkboxLabel:(0,utils_1.translateI18n)(t.checkboxLabel)||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons?t.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"]};return r&&!r.isVisible()&&(r=null),n.noLink=!0,electron_1.dialog.showMessageBox(r,n)}function warn(e,t={},r=null){if(!e)throw new Error("The dialog must input in the message");if("command"===(0,browser_1.getMode)())return console.log(e),new Promise(e=>{e({response:t.default,checkboxChecked:!1})});if(!ready)return new Promise((n,o)=>{waitList.push({method:"warn",params:[e,t,r],resolve:n,reject:o})});const n={title:(0,utils_1.translateI18n)(t.title)||"Warn",message:(0,utils_1.translateI18n)(e),detail:(0,utils_1.translateI18n)(t.detail)||"",type:"warning",checkboxLabel:(0,utils_1.translateI18n)(t.checkboxLabel)||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons?t.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"],noLink:!0};return r&&!r.isVisible()&&(r=null),electron_1.dialog.showMessageBox(r,n)}function error(e,t={},r=null){if(!e)throw new Error("The dialog must input in the message");if("command"===(0,browser_1.getMode)())return console.log(e),new Promise(e=>{e({response:t.default,checkboxChecked:!1})});if(!ready)return new Promise((n,o)=>{waitList.push({method:"error",params:[e,t,r],resolve:n,reject:o})});const n={title:(0,utils_1.translateI18n)(t.title)||"Error",message:(0,utils_1.translateI18n)(e),detail:(0,utils_1.translateI18n)(t.detail)||"",type:"error",checkboxLabel:(0,utils_1.translateI18n)(t.checkboxLabel)||"",checkboxChecked:t.checkboxChecked||!1,defaultId:t.default,cancelId:t.cancel,buttons:t.buttons?t.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"],noLink:!0};return r&&!r.isVisible()&&(r=null),electron_1.dialog.showMessageBox(r,n)}electron_1.app.once("ready",()=>{ready=!0,waitList.forEach(e=>{try{const t=module.exports[e.method](...e.params);e.resolve(t)}catch(t){e.reject(t)}})}),exports.select=select,exports.save=save,exports.info=info,exports.warn=warn,exports.error=error,ipc.on("editor-lib-dialog:call",(e,t,...r)=>__awaiter(void 0,void 0,void 0,function*(){try{const n=yield module.exports[t](...r,e.sender?electron_1.BrowserWindow.fromWebContents(e.sender.hostWebContents||e.sender):null);return e.reply(null,n),n}catch(t){return e.reply(t),null}}));