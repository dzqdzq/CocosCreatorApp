"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.error=exports.warn=exports.info=exports.save=exports.select=void 0;const utils_1=require("../../utils"),setting=require("@editor/setting"),browser_1=require("../../protected/browser"),electron_1=require("electron"),fs_1=require("fs"),path_1=require("path"),ipc=require("@base/electron-base-ipc");let ready=electron_1.app.isReady();const waitList=[];async function select(r={},s=null){if("command"===(0,browser_1.getMode)())return console.log(r),new Promise(e=>{e({canceled:!1,filePaths:[]})});if(!ready)return new Promise((e,t)=>{waitList.push({method:"select",params:[r,s],resolve:e,reject:t})});r.path&&(0,fs_1.existsSync)(r.path)||(r.path=setting.PATH.PROJECT);var e={defaultPath:r.path||"",properties:"win32"===process.platform?r.type?["directory"===r.type?"openDirectory":"openFile"]:void 0:r.type?["directory"===r.type?"openDirectory":"openFile"]:["openDirectory","openFile"],buttonLabel:(0,utils_1.translateI18n)(r.button)||""},t=(r.multi&&(e.properties||(e.properties=[]),e.properties.push("multiSelections")),r.title&&(e.title=(0,utils_1.translateI18n)(r.title)),r.extensions&&(e.filters=[{name:r.extensions,extensions:r.extensions.split(",").filter(Boolean)}]),r.filters&&(e.filters=r.filters),s&&!s.isVisible()&&(s=null),await electron_1.dialog.showOpenDialog(s,e));if(Array.isArray(t.filePaths))for(let e=0;e<t.filePaths.length;e++)t.filePaths[e]=(0,path_1.normalize)(t.filePaths[e]);return t}async function save(r={},s=null){if("command"===(0,browser_1.getMode)())return console.log(r),new Promise(e=>{e({canceled:!1,filePath:""})});if(!ready)return new Promise((e,t)=>{waitList.push({method:"save",params:[r,s],resolve:e,reject:t})});r.path&&(0,fs_1.existsSync)((0,path_1.dirname)(r.path))||(r.path=(0,path_1.join)(setting.PATH.PROJECT,r.path?(0,path_1.basename)(r.path):""));var e={defaultPath:r.path,properties:[],buttonLabel:(0,utils_1.translateI18n)(r.button)||void 0},e=(r.title&&(e.title=(0,utils_1.translateI18n)(r.title)),r.filters&&(e.filters=r.filters),s&&!s.isVisible()&&(s=null),await electron_1.dialog.showSaveDialog(s,e));return e.filePath&&(e.filePath=(0,path_1.normalize)(e.filePath)),e}function info(r,s={},n=null){var e;if(r)return"command"===(0,browser_1.getMode)()?(console.log(r),new Promise(e=>{e({response:s.default,checkboxChecked:!1})})):ready?(e={title:(0,utils_1.translateI18n)(s.title)||"Info",message:(0,utils_1.translateI18n)(r),detail:(0,utils_1.translateI18n)(s.detail)||"",type:"none",checkboxLabel:(0,utils_1.translateI18n)(s.checkboxLabel)||"",checkboxChecked:s.checkboxChecked||!1,defaultId:s.default,cancelId:s.cancel,buttons:s.buttons?s.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"]},n&&!n.isVisible()&&(n=null),e.noLink=!0,electron_1.dialog.showMessageBox(n,e)):new Promise((e,t)=>{waitList.push({method:"info",params:[r,s,n],resolve:e,reject:t})});throw new Error("The dialog must input in the message")}function warn(r,s={},n=null){var e;if(r)return"command"===(0,browser_1.getMode)()?(console.log(r),new Promise(e=>{e({response:s.default,checkboxChecked:!1})})):ready?(e={title:(0,utils_1.translateI18n)(s.title)||"Warn",message:(0,utils_1.translateI18n)(r),detail:(0,utils_1.translateI18n)(s.detail)||"",type:"warning",checkboxLabel:(0,utils_1.translateI18n)(s.checkboxLabel)||"",checkboxChecked:s.checkboxChecked||!1,defaultId:s.default,cancelId:s.cancel,buttons:s.buttons?s.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"],noLink:!0},n&&!n.isVisible()&&(n=null),electron_1.dialog.showMessageBox(n,e)):new Promise((e,t)=>{waitList.push({method:"warn",params:[r,s,n],resolve:e,reject:t})});throw new Error("The dialog must input in the message")}function error(r,s={},n=null){var e;if(r)return"command"===(0,browser_1.getMode)()?(console.log(r),new Promise(e=>{e({response:s.default,checkboxChecked:!1})})):ready?(e={title:(0,utils_1.translateI18n)(s.title)||"Error",message:(0,utils_1.translateI18n)(r),detail:(0,utils_1.translateI18n)(s.detail)||"",type:"error",checkboxLabel:(0,utils_1.translateI18n)(s.checkboxLabel)||"",checkboxChecked:s.checkboxChecked||!1,defaultId:s.default,cancelId:s.cancel,buttons:s.buttons?s.buttons.map(e=>(0,utils_1.translateI18n)(e)):["Cancel"],noLink:!0},n&&!n.isVisible()&&(n=null),electron_1.dialog.showMessageBox(n,e)):new Promise((e,t)=>{waitList.push({method:"error",params:[r,s,n],resolve:e,reject:t})});throw new Error("The dialog must input in the message")}electron_1.app.once("ready",()=>{ready=!0,waitList.forEach(t=>{try{var e=module.exports[t.method](...t.params);t.resolve(e)}catch(e){t.reject(e)}})}),exports.select=select,exports.save=save,exports.info=info,exports.warn=warn,exports.error=error,ipc.on("editor-lib-dialog:call",async(t,e,...r)=>{try{var s=await module.exports[e](...r,t.sender?electron_1.BrowserWindow.fromWebContents(t.sender.hostWebContents||t.sender):null);return t.reply(null,s),s}catch(e){return t.reply(e),null}});