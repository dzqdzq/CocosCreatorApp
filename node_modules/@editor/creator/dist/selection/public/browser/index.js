"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSelected=exports.getLastSelected=exports.getLastSelectedType=exports.hover=exports.update=exports.clear=exports.unselect=exports.select=void 0;const ipc=require("@base/electron-base-ipc"),cache={},hoverTimer={},activatedTimer={};function _broadcastActivated(t){clearTimeout(hoverTimer[t]),hoverTimer[t]=setTimeout(()=>{var e=cache[t]=cache[t]||[];Editor.Message.broadcast("selection:activated",t,e.map(e=>e.id))},50)}function _select(e,t){if("string"==typeof t){var c=cache[e]=cache[e]||[];for(let e=c.length-1;0<=e;e--){var r=c[e];if(r&&r.id===t){c.splice(e,1);break}}c.push({id:t,time:Date.now()}),Editor.Message.broadcast("selection:select",e,t)}}function select(t,e){"string"==typeof t&&(Array.isArray(e)?e.forEach(e=>{_select(t,e)}):_select(t,e),_broadcastActivated(t))}function _unselect(t,c){var r=cache[t];if(r)for(let e=r.length-1;0<=e;e--){var s=r[e];if(s&&s.id===c){r.splice(e,1),Editor.Message.broadcast("selection:unselect",t,c);break}}}function unselect(t,e){"string"==typeof t&&(Array.isArray(e)?e.forEach(e=>{_unselect(t,e)}):_unselect(t,e),_broadcastActivated(t))}function clear(t){cache[t]&&(cache[t].forEach(e=>{Editor.Message.broadcast("selection:unselect",t,e.id)}),cache[t].length=0,_broadcastActivated(t))}function update(t,e){const r=[],s=cache[t]||[];e.forEach(e=>{if("string"==typeof e){const c={id:e,time:Date.now()};r.push(c),s.find((e,t)=>e.id===c.id&&(s.splice(t,1),!0))||Editor.Message.broadcast("selection:select",t,c.id)}});for(let e=0;e<s.length;e++)Editor.Message.broadcast("selection:unselect",t,s[e].id);cache[t]=r,_broadcastActivated(t)}function hover(e,t){"string"==typeof e&&(clearTimeout(hoverTimer[e]),hoverTimer[e]=setTimeout(()=>{"string"!=typeof t&&Editor.Message.broadcast("selection:hover",e),Editor.Message.broadcast("selection:hover",e,t)},50))}function getLastSelectedType(){var e=Object.keys(cache);let c;return e.forEach(e=>{var t=cache[e];t&&(t=t[t.length-1])&&(!c||c.time<t.time)&&(c={type:e,uuid:t.id,time:t.time})}),c?c.type:""}function getLastSelected(e){return"string"==typeof e&&cache[e]&&(e=(e=cache[e])[e.length-1])?e.id:""}function getSelected(e){return"string"!=typeof e?[]:(cache[e]||[]).map(e=>e.id)}exports.select=select,exports.unselect=unselect,exports.clear=clear,exports.update=update,exports.hover=hover,exports.getLastSelectedType=getLastSelectedType,exports.getLastSelected=getLastSelected,exports.getSelected=getSelected,ipc.on("editor-lib-selection:call",(e,t,c=[])=>{if(module.exports[t])return t=module.exports[t](...c),e.reply(null,t),t});