"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fileUrlManager=void 0;const path_1=require("path"),ipc=require("@base/electron-base-ipc");class FileUrlManager{register(e,r){return FileUrlManager.urlMap||(FileUrlManager.urlMap={}),FileUrlManager.urlMap[e]||"file"===e?(console.warn(`[UI-File] Register protocol(${e}) failed! protocol(${e}) has exist!`),!1):(FileUrlManager.urlMap[e]=r,this.emitChanges(),!0)}unregister(e){return delete FileUrlManager.urlMap[e],!0}getAllFileProtocol(){return Object.keys(FileUrlManager.urlMap).map(e=>({protocol:e,label:FileUrlManager.urlMap[e].label,path:FileUrlManager.urlMap[e].path}))}resolveToRaw(e){const r=e.match(/^([a-zA-z]*):\/\/(.*)$/);if(r){const e=r[2].replace(/\\/g,"/"),l=this.getProtocalInfo(r[1]);if(l)return(0,path_1.join)(l.path,e)}return e}resolveToUrl(e,r){if(!e||!(0,path_1.isAbsolute)(e)||!r)return"";const l=this.getProtocalInfo(r);return l?l.protocol+"://"+(0,path_1.relative)(l.path,e).replace(/\\/g,"/"):""}getProtocalInfo(e){if(FileUrlManager.urlMap[e])return Object.assign({protocol:e},FileUrlManager.urlMap[e])}emitChanges(){ipc.broadcast("editor-lib-ui-kit:protocols-change",FileUrlManager.urlMap)}}FileUrlManager.urlMap={},exports.fileUrlManager=new FileUrlManager,ipc.on("editor-lib-ui-kit:query-protocols",e=>{e.reply(null,FileUrlManager.urlMap)});