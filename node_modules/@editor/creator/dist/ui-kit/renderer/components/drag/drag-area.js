"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DragArea=void 0;const ipc=require("@base/electron-base-ipc");let dragInfo=null;ipc.on("editor-lib-ui-kit:drag-start",(t,e)=>{dragInfo=e}),ipc.on("editor-lib-ui-kit:drag-end",t=>{dragInfo=null});class DragArea extends HTMLElement{constructor(){super(...arguments),this._types=[]}static get currentDragInfo(){return dragInfo}get additional(){return null!==this.getAttribute("additional")}set additional(t){clearTimeout(this.additionalTimer),(t=!!t)?this.setAttribute("additional",""):this.removeAttribute("additional")}get hoving(){return null!==this.getAttribute("hoving")}get droppable(){return(this.getAttribute("droppable")||"").split(",")}set droppable(t){Array.isArray(t)||(t=[t+""]),t?this.setAttribute("droppable",t.join(",")):this.removeAttribute("droppable")}connectedCallback(){this.addEventListener("dragover",this._onDragOver),this.addEventListener("dragleave",this._onDragLevel),this.addEventListener("drop",this._onDrop),this.addEventListener("drop",this._onPreDrop,!0)}disconnectedCallback(){this.removeEventListener("dragover",this._onDragOver),this.removeEventListener("dragleave",this._onDragLevel),this.removeEventListener("drop",this._onDrop),this.removeEventListener("drop",this._onPreDrop,!0)}static get observedAttributes(){return["focused","readonly","disabled","invalid","droppable"]}attributeChangedCallback(t,e,i){switch(t){case"droppable":this._types=i?i.split(",").map(t=>t.trim()):[]}}_onDragOver(t){t.preventDefault();let e=dragInfo?dragInfo.type:null;-1!==t.dataTransfer.types.indexOf("Files")&&(e="file");const i=this._types;let r=i&&-1!==i.indexOf(e);!r&&dragInfo&&Array.isArray(dragInfo.extends)&&(r=dragInfo.extends.some(t=>i&&-1!==i.indexOf(t))),this.additional=!1,dragInfo&&dragInfo.additional&&Array.isArray(dragInfo.additional)&&(this.additional=dragInfo.additional.some(t=>i&&-1!==i.indexOf(t.type))),(r||this.additional)&&(clearTimeout(this.hovingTimer),this.setAttribute("hoving",""),t.stopPropagation())}_onDragLevel(){clearTimeout(this.hovingTimer),this.hovingTimer=setTimeout(()=>{this.removeAttribute("hoving")},200)}_onDrop(t){this.hasAttribute("hoving")&&(t.stopPropagation(),t.preventDefault(),this.focus())}_onPreDrop(t){clearTimeout(this.hovingTimer),this.hovingTimer=setTimeout(()=>{this.removeAttribute("hoving")},200)}}exports.DragArea=DragArea;