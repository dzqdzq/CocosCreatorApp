"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GridCtrl=void 0;const grid_1=require("../curve-editor/lib/grid"),utils_1=require("../curve-editor/lib/utils"),events_1=require("events"),defaultConfig={preci:2,minScale:0};class GridCtrl extends events_1.EventEmitter{constructor(e,i){super(),this._readonly=!1,this.eventHandlers=null,!i.axisXConfig&&i.showX&&(i.axisXConfig=JSON.parse(JSON.stringify(defaultConfig))),!i.axisYConfig&&i.showY&&(i.axisYConfig=JSON.parse(JSON.stringify(defaultConfig))),this._grid=new grid_1.Grid(e,i),this._config=i,this._readonly=!!i.readonly}init(){this._readonly||this.eventHandlers||(this.eventHandlers={wheel:this._onWheel.bind(this)},this._grid.canvas.addEventListener("wheel",this.eventHandlers.wheel)),this.render()}resetConfig(e){this._grid=new grid_1.Grid(this._grid.canvas,e),this.render()}render(){this._grid.render()}_onWheel(e){e.stopPropagation(),e.preventDefault();let i=!0;Math.abs(e.deltaX)>Math.abs(e.deltaY)?this.translate(e.deltaY,0):i=this.scaleAt(e.offsetX,e.clientY,-e.deltaY),i&&(this.emit("change"),this.render())}getValueRang(){return{start:this.pixelToValueX(0),end:this.pixelToValueX(this._grid.canvas.width)}}scaleAt(e,i,t){let r=!0;if(i>0&&this._grid.yAxisScaleAt){const{yAxisScale:e}=this._grid;this._grid.yAxisScaleAt(i,(0,utils_1.smoothScale)(t,e)),r=r&&e!==this._grid.yAxisScale}if(this._grid.xAxisScaleAt){const{xAxisScale:i}=this._grid;this._grid.xAxisScaleAt(e,(0,utils_1.smoothScale)(t,i)),r=r&&i!==this._grid.xAxisScale}return r}translate(e,i){e&&this._grid.transferX&&this._grid.transferX(e),i&&this._grid.transferY&&this._grid.transferY(i)}valueToPixelX(e){if(!this._grid.showX)return e;if(!this._grid.xFormatReverse)return this._grid.valueToPixelX(e);const i=this._grid.xFormatReverse(e);return this._grid.valueToPixelX(i)}pixelToValueX(e){return this._grid.showX?this._grid.xFormat(this._grid.pixelToValueX(e)):e}}exports.GridCtrl=GridCtrl;