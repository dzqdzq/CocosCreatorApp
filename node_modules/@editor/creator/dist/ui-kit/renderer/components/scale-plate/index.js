"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scaleplate=void 0;const fs=require("fs"),path=require("path"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./scale-plate.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./scale-plate.html"),"utf8")}`,customStyle="",GRID_MARGIN=8;class Scaleplate extends HTMLElement{constructor(){if(super(),this._time=0,this.hasInit=!1,this.attachShadow({mode:"open"}),!this.shadowRoot)return;this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$grid=this.shadowRoot.querySelector("ui-grid"),this.$container=this.shadowRoot.querySelector(".container"),this.$label=this.shadowRoot.querySelector(".label"),this.$pointer=this.shadowRoot.querySelector(".pointer"),this.$container.$root=this.$pointer.$root=this.$grid.$root=this;const t=this;this.$grid.addEventListener("change",e=>{t.dispatch("transform"),this.$pointer.style.transform=`translateX(${this.$grid.valueToPixelX(this._time)-GRID_MARGIN}px)`}),this.$grid.addEventListener("mousedown",this._onGridMouseDown),this.resizeObserver=new window.ResizeObserver(()=>{this.setConfig()})}get value(){return this._time||0}set value(t){this.setAttribute("value",String(t))}get disabled(){return null!==this.getAttribute("disabled")}set disabled(t){(t=!!t)?(this.setAttribute("disabled",""),this.setAttribute("tabindex","-1")):(this.removeAttribute("disabled"),this.setAttribute("tabindex","0"))}get readonly(){return null!==this.getAttribute("readonly")}set readonly(t){(t=!!t)?this.setAttribute("readonly",""):this.removeAttribute("readonly")}connectedCallback(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle),this.setConfig(this.getAttribute("config")),this.hasInit=!0;const e=this.getAttribute("value");this._updateValue(e),this.resizeObserver.observe(this.$container)}disconnectedCallback(){this.resizeObserver.unobserve(this.$container)}static get observedAttributes(){return["focused","readonly","disabled","value"]}attributeChangedCallback(t,e,i){switch(t){case"value":if(!this.hasInit)break;this._updateValue(i);break;case"config":if(!this.hasInit)break;this.setConfig(i)}}_onGridMouseDown(t){if(0===t.button){const e=this.$root;return e.$pointer.style.transform=`translateX(${t.offsetX-GRID_MARGIN}px)`,this.$root._time=this.$root.$grid.pixelToValueX(t.offsetX),t.preventDefault(),t.stopPropagation(),e.dispatch("change"),void e.dispatch("confirm")}}_updateValue(t){const e=Number(t);this.showTimeInViewRange(e),this._time="number"==typeof e?e:0,this.$pointer.style.transform=`translateX(${this.valueToPixel(this._time)}px)`}dispatch(t){const e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!0),this.dispatchEvent(e)}legalConfig(t){try{"string"==typeof t?this._config=JSON.parse(t)||{}:t?this._config=t:this._config||(this._config={})}catch(t){console.error(`Error: the config of ui-scale-plate element is illegal\n${t}`),this._config={}}}setConfig(t){this.legalConfig(t),this.$grid.setConfig({showY:!1,showX:!0,axisXConfig:{minScale:this._config.minStep||1,maxScale:this._config.max||100,maxValue:this._config.max||100,$container:this.$label,preci:this._config.preci||0},axisMargin:0,lineColor:"#ccc",precision:0}),this.$grid.initGrid()}valueToPixel(t){return this.$grid.valueToPixelX(t)-GRID_MARGIN}pixelToValue(t){return this.$grid.pixelToValueX(t+GRID_MARGIN)}showTimeInViewRange(t=this._time){const{start:e,end:i}=this.$grid.getValueRang();t<e?this.jumpTimeInHeader(t):t>i&&this.jumpTimeInFooter(t)}jumpTimeInHeader(t){const e=this.$grid.valueToPixelX(t);return this.$grid.move(0-e,0)}jumpTimeInFooter(t){const e=this.$grid.valueToPixelX(t);return this.$grid.move(this.$grid.$ctrlCanvas.width-e,0)}}exports.Scaleplate=Scaleplate;