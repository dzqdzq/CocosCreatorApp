"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Select=void 0;const fs=require("fs"),path=require("path"),{nodeList:nodeList}=require("../../utils"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./select.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./select.html"),"utf8")}`,instanceArray=[];let customStyle="";class Select extends base_1.Base{constructor(){super(),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$slot=this.shadowRoot.querySelectorAll("slot")[0],this.$placeholder=this.shadowRoot.querySelector("#placeholder"),this.$child=this.$select=this.shadowRoot.querySelector("#content"),this.$slot.$root=this.$placeholder.$root=this.$select.$root=this,this.$select.addEventListener("change",this._selectChange),this.$slot.addEventListener("slotchange",this._slotChange))}static importStyle(e){fs.existsSync(e)&&(customStyle=fs.readFileSync(e,"utf8"),instanceArray.map(e=>{e.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}static get observedAttributes(){return["readonly","disabled","invalid","path","value","placeholder"]}attributeChangedCallback(e,t,s){switch(super.attributeChangedCallback(e,t,s),e){case"invalid":null!==s?process.nextTick(()=>{this.$select.value=""}):process.nextTick(()=>{this.$select.value=this.value});break;case"readonly":null!==s?this.$select.setAttribute("readonly",""):this.$select.removeAttribute("readonly");break;case"value":this.invalid&&(this.invalid=!1),this.value=s,this.value&&"null"!==this.value&&"undifined"!==this.value?this.$placeholder.style.display="none":this.$placeholder.style.display="block";break;case"placeholder":this.$placeholder.innerHTML=s}}get value(){return this.$select.getAttribute("value")}set value(e){this.$select.value=e,this.$select.setAttribute("value",e)}connectedCallback(){if(super.connectedCallback(),nodeList.push(this),instanceArray.push(this),this.shadowRoot){const e=this.shadowRoot.querySelector("#custom-style");e&&(e.innerHTML=customStyle)}}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this),t=nodeList.indexOf(this);instanceArray.splice(e,1),nodeList.splice(t,1)}_onFocus(e){super._onFocus(e),this.$select.focus()}_selectChange(){const e=this;e.$root.disabled||e.$root.readonly?e.value=e.$root.getAttribute("value"):(e.$root.setAttribute("value",e.value),e.$root.dispatch("change"),e.$root.dispatch("confirm"))}_slotChange(){const e=this;e.$root.$select.innerHTML="";let t=e.assignedNodes();for(let s of t)if("OPTION"===s.tagName||"OPTGROUP"===s.tagName){let t=document.importNode(s,!0);e.$root.$select.appendChild(t)}e.$root.$select.value=e.$root.value}}exports.Select=Select;