"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.nodeList=exports.mathUtils=exports.domUtils=void 0;const Chroma=require("chroma-js");let startClick;exports.domUtils={},exports.mathUtils={},exports.nodeList=[],document.addEventListener("mousedown",e=>{startClick=e}),document.addEventListener("mouseup",e=>{exports.nodeList.forEach(t=>{t.handleClickOutside&&t.handleClickOutside(e,startClick)})}),exports.domUtils.fire=((e,t,o={})=>{e.dispatchEvent(new CustomEvent(t,o))}),exports.domUtils.fireKey=((e,t,o={})=>{document.createEvent("KeyboardEvent")}),exports.domUtils.acceptEvent=(e=>{e.preventDefault(),e.stopImmediatePropagation()});let isDragging=!1,onSelectStart=null,onDragStart=null;exports.domUtils.controlDragEvent=((e,t,o=!1)=>{exports.domUtils._mouseHandles=function(e){const o=e=>{t.drag&&t.drag(e)},r=e=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",r),document.onselectstart=onSelectStart,document.ondragstart=onDragStart,isDragging=!1,t.end&&t.end(e)};return{_onMouseDown:e=>{isDragging||(onSelectStart=document.onselectstart,onDragStart=document.ondragstart,document.onselectstart=(()=>!1),document.ondragstart=(()=>!1),document.addEventListener("mousemove",o),document.addEventListener("mouseup",r),isDragging=!0,t.start&&t.start(e))},_onMouseMove:o,_onMouseUp:r}}(),o?(e.removeEventListener("mousedown",exports.domUtils._mouseHandles._onMouseDown),e.removeEventListener("mouseup",exports.domUtils._mouseHandles._onMouseUp),e.removeEventListener("mousemove",exports.domUtils._mouseHandles._onMouseUp)):(e.addEventListener("mousedown",exports.domUtils._mouseHandles._onMouseDown),e.addEventListener("mouseup",exports.domUtils._mouseHandles._onMouseUp))});const DEFAULT_CORLOR=[0,0,0,255],INVALID_COLOR=[0,0,0,0];exports.domUtils.getValidColor=(e=>{if("-"===e)return INVALID_COLOR;if(Array.isArray(e)){if(e.length<3&&e.length>4)return void console.error(`The color value is invalid: ${e}`);for(let t of e)if("number"!=typeof t)return DEFAULT_CORLOR;return e}let t;try{t=JSON.parse(e)}catch(o){e?(t=Chroma(e).rgba())[3]*=255:t=DEFAULT_CORLOR}return t}),exports.domUtils.changeToRgba=(e=>{if(!Array.isArray(e))try{e=JSON.parse(e)}catch(t){(e=Chroma(e).rgba())[3]*=255}return(!e||!Array.isArray(e))&&(e=Array.from(DEFAULT_CORLOR)),e.length>3?`rgba(${e[0]},${e[1]},${e[2]},${e[3]/255})`:`rgba(${e[0]},${e[1]},${e[2]},1)`}),exports.domUtils.isUIComponent=(e=>{return/^UI-/.test(e.tagName)}),exports.domUtils.setStyle=((e,t)=>{if("object"==typeof t)for(let o of Object.keys(t))e.style[o]=t[o]}),exports.mathUtils.accAdd=((e,t)=>{let{maxPow:o,num1:r,num2:s}=exports.mathUtils.computMaxPow(e,t);return(r+s)/o}),exports.mathUtils.accSub=((e,t)=>{let{maxPow:o,maxPreci:r}=exports.mathUtils.computMaxPow(e,t);return((Number(e)*o-Number(t)*o)/o).toFixed(r)}),exports.mathUtils.computMaxPow=((e,t)=>{let o,r,s,n=Number(e),a=Number(t);o=exports.mathUtils.comPreci(e),r=exports.mathUtils.comPreci(t),s=Math.max(o,r);let m=Math.pow(10,s);return s>20&&(s=20),{maxPow:m,maxPreci:s,num1:n*=m,num2:a*=m}}),exports.mathUtils.comPreci=(e=>{if(null===e||void 0===e)return 0;const t=e.toString();return-1===t.indexOf(".")?0:(t.split(".").pop()||"").length}),exports.mathUtils.clamp=((e,t,o)=>("number"==typeof t&&(e=Math.max.call(null,e,t)),"number"==typeof o&&(e=Math.min.call(null,e,o)),e));