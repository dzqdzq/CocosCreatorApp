'use strict';

const { createServer, stopServer, URL } = require('./network/server');
const { sendGetRequest, sendPostRequest } = require('../dev/network/browser/util');
const assert = require('assert');

describe('Network', () => {
    before(() => {
        createServer();
        global.Editor = {
            App: {
                userAgent: `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.106 Safari/537.36`,
            },
        };
    });

    after(() => {
        stopServer();
    });

    describe('GET', () => {
        it('200', async () => {
            const result = await sendGetRequest(`${URL}/200`);
            assert.equal(true, Buffer.isBuffer(result));
            assert.equal('success', result + '');
        });
    
        it('301', async () => {
            const result = await sendGetRequest(`${URL}/301`);
            assert.equal(true, Buffer.isBuffer(result));
            assert.equal('success', result + '');
        });
    
        it('302', async () => {
            const result = await sendGetRequest(`${URL}/302`);
            assert.equal(true, Buffer.isBuffer(result));
            assert.equal('success', result + '');
        });
    });

    describe('POST', () => {

    it('200', async () => {
        const result = await sendPostRequest(`${URL}/200`);
        assert.equal(true, Buffer.isBuffer(result));
        assert.equal('success', result + '');
    });

    it('301', async () => {
        const result = await sendPostRequest(`${URL}/301`);
        assert.equal(true, Buffer.isBuffer(result));
        assert.equal('success', result + '');
    });

    it('302', async () => {
        const result = await sendPostRequest(`${URL}/302`);
        assert.equal(true, Buffer.isBuffer(result));
        assert.equal('success', result + '');
    });
    });
});