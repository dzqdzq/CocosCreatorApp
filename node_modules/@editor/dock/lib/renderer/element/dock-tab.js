"use strict";const ps=require("path"),i18n=require("@base/electron-i18n"),panel=require("@editor/panel"),utils=require("../../utils");let $tabs=[],updateInfo=function(t){let e=panel.queryInfo(t.name);if(t.$img)if(e&&e.userData&&e.userData.icon){let i=e.userData.packageDir||e.dirname,a=ps.join(i,e.userData.icon);a=encodeURI(a).replace(/[!'()#\?*]/g,function(t){return"%"+t.charCodeAt(0).toString(16)}).replace(/%5C/gi,"/"),t.$img.innerHTML=`<img src="${a}" />`}else t.$img.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n                <path d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"/>\n            </svg>\n            ';if(e&&e.userData&&e.userData.title){let i=e.userData.title;i.startsWith("i18n:")&&(i=i.substr(5),i=i18n.translation(i)||i),t.$name.innerHTML=i}else t.$name.innerHTML=t.data.name};class DockTab extends window.HTMLElement{constructor(){super(),this.data={name:"",title:"",active:!1},this.$tabs=null,this.addEventListener("click",()=>{this.$tabs.$groups.active=this.name}),this.addEventListener("dblclick",()=>{const t=this.$tabs.$groups.parentElement;if(!t||!t.parentElement||"DOCK-LAYOUT"!==t.parentElement.tagName)return;const e=!t.minimize,i=t.parentElement.children;e&&Array.prototype.every.call(i,e=>"DOCK-LAYOUT"!==e.tagName||t===e||e.minimize)||(t.minimize=e,e||Array.prototype.forEach.call(i,e=>"DOCK-LAYOUT"!==e.tagName||t===e||(e.data.percent*=1-t.data.percent)))}),this.addEventListener("dragover",t=>{utils.drag.tab(t,this)}),this.addEventListener("dragleave",t=>{utils.drag.switchLine(!1)}),this.addEventListener("dragstart",t=>{utils.drag.start(t,this)}),this.addEventListener("dragend",t=>{utils.drag.end(t,this),utils.drag.switchMask(!1)}),this.addEventListener("drop",t=>{utils.drag.dropTab(t,this)})}connectedCallback(){$tabs.push(this),this.setAttribute("draggable","true"),this.$img=document.createElement("span"),this.$img.classList.add("img"),this.insertBefore(this.$img,this.firstElementChild),updateInfo(this)}disconnectedCallback(){let t=$tabs.indexOf(this);$tabs.splice(t,1),this.removeChild(this.$img)}get name(){return this.data.name}set name(t){this.data.name=t,this.$name||(this.$name=document.createElement("span"),this.appendChild(this.$name)),updateInfo(this)}get title(){return this._title}set title(t){this._title=t}get active(){return this.data.active}set active(t){t=!!t,this.data.active=t,t?this.setAttribute("active",t):this.removeAttribute("active")}}module.exports=DockTab,panel.on("register",t=>{$tabs.forEach(e=>{e.name===t&&updateInfo(e)})}),i18n.on("switch",()=>{$tabs.forEach(t=>{updateInfo(t)})});