'use strict';

// 依赖于 panel，panel-frame 需要先注册
const panel = require('@editor/panel');

const DockFrame = require('./element/dock-frame');
const DockLayout = require('./element/dock-layout');
const DockResize = require('./element/dock-resize');
const DockGroups = require('./element/dock-groups');
const DockTabs = require('./element/dock-tabs');
const DockTab = require('./element/dock-tab');
const DockPanels = require('./element/dock-panels');

window.customElements.define('dock-frame', DockFrame);
window.customElements.define('dock-layout', DockLayout);
window.customElements.define('dock-resize', DockResize);
window.customElements.define('dock-groups', DockGroups);
window.customElements.define('dock-tabs', DockTabs);
window.customElements.define('dock-tab', DockTab);
window.customElements.define('dock-panels', DockPanels);

const elUtils = require('../utils/element');

/**
 * 再 docker 内加载某个 style 文件
 * 只有一个 css 文件生效
 * @param {*} path 
 */
exports.importStyle = function (path) {
    DockFrame.importStyle(path);
};

/**
 * 注册一个菜单解析器
 * return 出一个 menu template 则会显示在菜单内
 * 如果没有返回，则忽略这个参数
 * 
 * func 传入的参数是 panel 对应 userData 内的数据
 * func(panelUserData[name]);
 */
exports.registerMenuParser = function (name, func) {
    DockTabs.registerMenuParser(name, func)
};

/**
 * 最大化一个面板
 */
exports.max = function(name) {
    const $elemList = panel.query(name);
    $elemList.forEach(($elem) => {
        // 第一层，跳过 panels、groups 等父级节点
        let $current = $elem.parentElement.parentElement.parentElement;
        let $prev = null;
        while($current && $current.tagName === 'DOCK-LAYOUT') {
            $current.data.percent = 99999999;
            $prev = $current;
            $current = $current.parentElement;
        }
        if ($prev) {
            elUtils.refresh($prev);
        }
    });
};

/**
 * 最小化一个面板
 * @param {*} name 
 */
exports.min = function(name) {
    const $elemList = panel.query(name);
    $elemList.forEach(($elem) => {
        // 第一层，跳过 panels、groups 等父级节点
        let $current = $elem.parentElement.parentElement.parentElement;
        let $prev = null;
        while($current && $current.tagName === 'DOCK-LAYOUT') {
            $current.data.percent = 0.000000001;
            $prev = $current;
            $current = $current.parentElement;
        }
        if ($prev) {
            elUtils.refresh($prev);
        }
    });
};
