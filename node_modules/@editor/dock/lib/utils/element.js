"use stirct";const Resize=require("../renderer/element/dock-resize");let addLayout=function(e,t,n,i){const d=e,r=document.createElement("dock-layout"),l=document.createElement("dock-resize"),h=e.parentElement;if(null===h){const e=document.createElement("dock-layout");for(e.direction=d.direction;d.children.length;){let t=d.children[0];d.removeChild(t),e.appendChild(t)}return"left"===n||"right"===n?(d.direction="row",i.width&&(t.percent=i.width/(d.clientWidth-(d.children.length/2|0)*Resize.line),t.percent*=1+t.percent)):(d.direction="column",i.height&&(t.percent=i.height/(d.clientHeight-(d.children.length/2|0)*Resize.line),t.percent*=1+t.percent)),"left"===n||"top"===n?(d.appendChild(r),d.appendChild(l),d.appendChild(e)):(d.appendChild(e),d.appendChild(l),d.appendChild(r)),void r.layout(t)}if("none"!==d.direction){if("row"===d.direction&&("left"===n||"right"===n)||"column"===d.direction&&("top"===n||"bottom"===n))"row"===d.direction?i.width&&(t.percent=i.width/(d.clientWidth-(d.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(d.clientHeight-(d.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n?(d.insertBefore(l,d.firstElementChild),d.insertBefore(r,d.firstElementChild)):(d.appendChild(l),d.appendChild(r));else if("row"===h.direction?i.width&&(t.percent=i.width/(h.clientWidth-(h.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(h.clientHeight-(h.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n)h.insertBefore(r,d),h.insertBefore(l,d);else{let e=d.nextElementSibling;e?(h.insertBefore(l,e),h.insertBefore(r,e)):(h.appendChild(l),h.appendChild(r))}r.layout(t)}else{if("row"===h.direction&&("left"===n||"right"===n)||"column"===h.direction&&("top"===n||"bottom"===n))if("row"===h.direction?i.width&&(t.percent=i.width/(h.clientWidth-(h.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(h.clientHeight-(h.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n)h.insertBefore(r,d),h.insertBefore(l,d);else{let e=d.nextElementSibling;e?(h.insertBefore(l,e),h.insertBefore(r,e)):(h.appendChild(l),h.appendChild(r))}else{let e=document.createElement("dock-layout");"row"===h.direction?(e.direction="column",i.width&&(t.percent=i.width/(e.clientWidth-(e.children.length/2|0)*Resize.line),t.percent*=1+t.percent)):(e.direction="row",i.height&&(t.percent=i.height/(e.clientHeight-(e.children.length/2|0)*Resize.line),t.percent*=1+t.percent)),e.data._percent=d.data._percent,r.data._percent=d.data._percent=.5,h.insertBefore(e,d),h.removeChild(d),"left"===n||"top"===n?(e.appendChild(r),e.appendChild(l),e.appendChild(d)):(e.appendChild(d),e.appendChild(l),e.appendChild(r))}r.layout(t)}},addPanel=function(e,t,n){e.parentElement.parentElement.parentElement.addPanel(t,n)},refreshLayout=function(e){e.data.minWidth=0,e.data.minHeight=0;for(let t=0;t<e.children.length;t++){let n=e.children[t];switch(n.tagName){case"DOCK-GROUPS":e.data.minWidth=n.minWidth||200,e.data.minHeight=n.minHeight||150,0===n.panels.length&&(e.removeChild(n),t--);continue;case"DOCK-RESIZE":continue;case"DOCK-LAYOUT":if(refreshLayout(n),0===n.children.length){n.nextElementSibling&&"DOCK-RESIZE"===n.nextElementSibling.tagName?e.removeChild(n.nextElementSibling):n.previousElementSibling&&(e.removeChild(n.previousElementSibling),t--),e.removeChild(n),t--;continue}"row"===e.direction?(e.data.minWidth+=n.data.minWidth,0!==t&&(e.data.minWidth+=Resize.line),e.data.minHeight=Math.max(e.data.minHeight,n.data.minHeight)):"column"===e.direction?(e.data.minWidth=Math.max(e.data.minWidth,n.data.minWidth),e.data.minHeight+=n.data.minHeight,0!==t&&(e.data.minHeight+=Resize.line)):(e.data.minWidth=Math.max(e.data.minWidth,n.data.minWidth),e.data.minHeight=Math.max(e.data.minHeight,n.data.minHeight));continue}}if(1===e.children.length&&"DOCK-LAYOUT"===e.children[0].tagName){let t=e.children[0];for(e.removeChild(t);t.children.length;){let n=t.children[0];t.removeChild(n),e.appendChild(n)}e.direction=t.direction}let t=0,n=[],i=[];for(let d=0;d<e.children.length;d++){let r=e.children[d];"DOCK-LAYOUT"===r.tagName&&(r.data.percent?(t+=r.data.percent,i.push(r)):!0!==r.data.minimize&&n.push(r))}if(t<1)if(n.length>0){let e=(1-t)/n.length;n.forEach(t=>{t.data.percent=e;let n=document.createEvent("HTMLEvents");n.initEvent("resize",!1,!1),t.dispatchEvent(n)})}else{let e=(1-t)/i.length;i.forEach(t=>{t.data.percent+=e;let n=document.createEvent("HTMLEvents");n.initEvent("resize",!1,!1),t.dispatchEvent(n)})}else for(let n=0;n<e.children.length;n++){let i=e.children[n];if("DOCK-LAYOUT"===i.tagName&&!0!==i.data.minimize){i.data.percent/=t;let e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1),i.dispatchEvent(e)}}},refresh=function(e){let t=e;for(;t.parentElement;)t=t.parentElement;"DOCK-LAYOUT"===t.tagName&&(refreshLayout(t),emit(t))},emit=function(e){let t=e;for(;t.parentElement;)t=t.parentElement;if(t.$parent){let e=document.createEvent("HTMLEvents");e.initEvent("layout",!1,!1),t.$parent.dispatchEvent(e)}};exports.addLayout=addLayout,exports.addPanel=addPanel,exports.refresh=refresh,exports.emit=emit;