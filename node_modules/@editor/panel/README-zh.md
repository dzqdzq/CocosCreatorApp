# Creator Panel

`Creator` 内负责 `panel` 渲染以及逻辑处理的模块

---

```typescript
// panel 的模版数据
exports.template = `<h1 id="h1">Panel</h1>`;

// panel 内置的样式表
exports.style = `:host { display: flex; flex: 1; }`;

// 注册自定义的字体
exports.fonts = [
    {
        name: 'panel',
        file: 'xxx.woff',
    }
];

// 内置的元素快捷方式，传入 css 选择器，可以直接使用 this.$.xx 来调用某个指定的节点
exports.$ = {
    h1: '#h1',
};

// 监听 element 上的某个事件
exports.listeners = Object.create(null);

// 监听发送给 panel 的消息
exports.messages = Object.create(null);

// panel 内置的函数方法，可以在 messages、lisreners、生命周期函数内直接使用 this.xxx 调用
exports.methods = Object.create(null);

// 生命周期函数，在 panel 准备就绪的时候触发
exports.ready = function () {};

// 生命周期函数，在 panel 准备关闭的时候触发
// 可以是一个 promise 函数，如果 return false，则会中断关闭流程
exports.beforeClose = function () {};

// 生命周期函数，panel 实际开始关闭
// 在这个方法内，应该忽略所有已有的数据，注销之前注册的事件等
exports.close = function () {};
```

---

## Browser 进程 & Renderer 进程

---

### panel.send(name, message, ...args)

- `name`: (`string`) 面板名
- `message`: (`string`) 消息名
- `...args`: (`string`) 参数

发送消息给某个 `panel`

```typescript
panel.send('test', 'test-message', true);
```

---

### panel.broadcast(message, ...args)

- `message`: (`string`) 消息名
- `...args`: (`string`) 参数

广播消息给所有当前进程的 `panel`

```typescript
panel.broadcast('test-message', true);
```

---

### panel.queryInfo(name)

- `name`: (`string`) 面板名

查询某个 `panel` 的 `info`

```typescript
const info = panel.queryInfo('test');
console.log(info);
```

---

### panel.queryInfos();

查询所有 `panel` 的 `info` 数据

```typescript
const infos = panel.queryInfos();
console.log(infos);
```

---

## Browser 进程

---

主进程内 `panel` 主要管理一些注册反注册以及消息发送等功能。

---

### panel.register(name, path, userData)

- `name`: (`string`) 面板名
- `path`: (`string`) 面板的路径
- `userData`: (`object`) 自定义数据

注册一个 `panel`

```typescript
panel.register('test', '/test/test', { test: true });
```

---

### panel.unregister (name)

- `name`: (`string`) 面板名

注销一个 `panel`

```typescript
panel.unregister('test');
```

---

### panel.focus(name)

- `name`: (`string`) 面板名

传递焦点到某个 `panel` 上

```typescript
panel.focus('test');
```

---

## Renderer 渲染进程

### panel.query(name)

- `name`: (`string`) 面板名

查询当前页面是否有指定的 `panel`

```typescript
panel.query('test');
```

---

### panel.addLoadListener(handler)

- `handler`: (`object`) 处理函数对象

每个 `panel` 在加载的时候会调用的处理函数

```typescript
panel.addLoadListener({
    onTestChange() {
        console.log('test');
    }
});
```

---

### panel.removeLoadListener(handler)

- `handler`: (`object`) 处理函数对象

移除 `panel` 在 `load` 时处理的函数

```typescript
panel.removeLoadListener({
    onTestChange() {
        console.log('test');
    }
});
```

---

## userData 机制

`panel` 内定义的只有页面渲染相关的参数，如果需要附加一些通用参数，我们提供了一套 `userData` 管理机制。

---

### 定义 userData

`userData` 定义的时候是一个 `object`，可以在注册 `panel` 的时候一并传入到管理器内。

```typescript
Paenl.register('test', '/test/test', { test: true });
```

---

### 使用 userData

`userData` 可以从 `panel` 元素上直接使用 `getData` 方法取出。

```typescript
const value = panelElement.getData('key');
```

---
