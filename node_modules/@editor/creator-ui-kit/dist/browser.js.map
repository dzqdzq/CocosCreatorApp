{"version":3,"file":"browser.js","mappings":";;;;;;;;;;;;;AAAa;AACqC;AAClD;AACA,gDAAU;AACV;AACA,oBAAoB,iEAA2B;AAC/C;AACA;AACA;AACA;AACA,CAAC;AACD,gDAAU;AACV,oBAAoB,iEAA2B;AAC/C;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;;;;;ACjBY;AACqC;AAClD,QAAQ,uBAAuB,EAAE,mBAAO,CAAC,0BAAU;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,SAAS,qBAAqB,SAAS;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,0CAAI;AAC3B;AACA;AACA;AACA;AACA;AACA,qBAAqB,gDAAU;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,8CAAQ;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACO;AACP;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;;;;;AClFY;AACb,QAAQ,iCAAiC,EAAE,mBAAO,CAAC,0BAAU;AACjB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,iFAAiF;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,8DAAuB;AACtC;AACA;AACA,eAAe,gEAAyB;AACxC;AACA;AACA,eAAe,kEAA2B;AAC1C;AACA;AACA,eAAe,kEAA2B;AAC1C;AACA;AACA,oCAAoC,wEAAiC;AACrE;AACA;;;;;;;;;;;AChFA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;ACNa;AACiB;AACoB;AAClC","sources":["webpack://@editor/creator-ui-kit/./source/browser/ipcComponents/drag/index.ts","webpack://@editor/creator-ui-kit/./source/browser/ipcComponents/file/file-url.ts","webpack://@editor/creator-ui-kit/./source/browser/ipcComponents/file/index.ts","webpack://@editor/creator-ui-kit/external node-commonjs \"electron\"","webpack://@editor/creator-ui-kit/external node-commonjs \"path\"","webpack://@editor/creator-ui-kit/webpack/bootstrap","webpack://@editor/creator-ui-kit/webpack/runtime/compat get default export","webpack://@editor/creator-ui-kit/webpack/runtime/define property getters","webpack://@editor/creator-ui-kit/webpack/runtime/hasOwnProperty shorthand","webpack://@editor/creator-ui-kit/webpack/runtime/make namespace object","webpack://@editor/creator-ui-kit/./source/browser/index.ts"],"sourcesContent":["'use strict';\nimport { ipcMain, BrowserWindow } from 'electron';\n// 主进程监听 drag 组件事件\nipcMain.on('ui-drag-item-start', (event, arg) => {\n    // @TODO 暂时先这么处理\n    const windows = BrowserWindow.getAllWindows() ?? [];\n    for (const win of windows) {\n        // @ts-ignore\n        win?.webContents.send('ui-drag-area-start', arg);\n    }\n});\nipcMain.on('ui-drag-item-end', (event, arg) => {\n    const windows = BrowserWindow.getAllWindows() ?? [];\n    for (const win of windows) {\n        // @ts-ignore\n        win?.webContents.send('ui-drag-area-end', arg);\n    }\n});\n","'use strict';\nimport { relative, join, isAbsolute } from 'path';\nconst { ipcMain, webContents } = require('electron');\nclass FileUrlManager {\n    /**\n     * 注册某个协议信息\n     * @param protocol\n     * @param protocolInfo\n     */\n    register(protocol, protocolInfo) {\n        if (!FileUrlManager.urlMap) {\n            FileUrlManager.urlMap = {};\n        }\n        if (FileUrlManager.urlMap[protocol] || protocol === 'file') {\n            console.warn(`[UI-File] Register protocol(${protocol}) failed! protocol(${protocol}) has exist!`);\n            return false;\n        }\n        FileUrlManager.urlMap[protocol] = protocolInfo;\n        this.emitChanges();\n        return true;\n    }\n    /**\n     * 反注册某个协议信息\n     * @param protocol 协议头\n     */\n    unregister(protocol) {\n        delete FileUrlManager.urlMap[protocol];\n        return true;\n    }\n    getAllFileProtocol() {\n        return Object.keys(FileUrlManager.urlMap).map((protocol) => {\n            return {\n                protocol,\n                label: FileUrlManager.urlMap[protocol].label,\n                path: FileUrlManager.urlMap[protocol].path,\n            };\n        });\n    }\n    resolveToRaw(url) {\n        const matchInfo = url.match(/^([a-zA-z]*):\\/\\/(.*)$/);\n        if (matchInfo) {\n            const relPath = matchInfo[2].replace(/\\\\/g, '/');\n            const info = this.getProtocalInfo(matchInfo[1]);\n            if (info) {\n                return join(info.path, relPath);\n            }\n        }\n        return url;\n    }\n    resolveToUrl(raw, protocol) {\n        if (!raw || !isAbsolute(raw) || !protocol) {\n            return '';\n        }\n        const info = this.getProtocalInfo(protocol);\n        if (!info) {\n            return '';\n        }\n        return info.protocol + '://' + relative(info.path, raw).replace(/\\\\/g, '/');\n    }\n    getProtocalInfo(protocol) {\n        if (!FileUrlManager.urlMap[protocol]) {\n            return;\n        }\n        return {\n            protocol,\n            ...FileUrlManager.urlMap[protocol],\n        };\n    }\n    emitChanges() {\n        // 广播\n        const message = FileUrlManager.urlMap;\n        const windowsArr = webContents.getAllWebContents();\n        windowsArr.forEach((item) => {\n            item.send('main-protocols-change', message);\n        });\n    }\n}\nFileUrlManager.urlMap = {};\nexport const fileUrlManager = new FileUrlManager();\n// 监听 protocols 数据查询\nipcMain.on('ui-file-query-protocols', (event) => {\n    event.reply('main-query-protocols', FileUrlManager.urlMap);\n});\n","'use strict';\nconst { ipcMain, dialog, BrowserWindow } = require('electron');\nimport { fileUrlManager } from './file-url';\n// 监听 file 点击选择文件/目录事件\nipcMain.on('ui-file-select-file', (event, options) => {\n    options = options || {};\n    const win = BrowserWindow.fromWebContents(event.sender);\n    const config = {\n        defaultPath: options.defaultPath || '',\n        properties: ['openFile'],\n        buttonLabel: options.buttonLabel || '',\n    };\n    if (options.type === 'directory') {\n        config.properties = ['openDirectory'];\n    }\n    else if (options.type === 'app') {\n        config.filters = [\n            { name: 'Application', extensions: [process.platform === 'win32' ? 'exe' : 'app'] },\n        ];\n    }\n    if (options.multi) {\n        config.properties.push('multiSelections');\n    }\n    if (options.extensions) {\n        config.filters = [{\n                name: options.extensions,\n                extensions: options.extensions.split(',').filter(Boolean),\n            }];\n    }\n    // @ts-ignore\n    dialog.showOpenDialog(win, config).then((result) => {\n        if (!result.filePaths) {\n            return event.reply('main-select-file', undefined);\n        }\n        if (options.multi) {\n            event.reply('main-select-file', result.filePaths);\n        }\n        else {\n            event.reply('main-select-file', result.filePaths[0]);\n        }\n        return true;\n    });\n});\n// 监听 file 打开文件不存在提示\nipcMain.on('ui-file-not-exist', (event, options) => {\n    dialog.showMessageBox({\n        type: 'warning',\n        title: 'warning',\n        message: 'File does not exist.',\n    });\n});\n// //////////////////////////////////\nexport const defaultProtocol = {\n    label: 'file://',\n    path: '',\n    protocol: 'file',\n    description: '',\n    invalidInfo: '',\n};\nexport class File {\n    static registerProtocol(protocol, protocolInfo) {\n        if (protocol === 'file') {\n            Object.assign(defaultProtocol, protocolInfo);\n            return true;\n        }\n        protocolInfo.label = protocol + '://';\n        return fileUrlManager.register(protocol, protocolInfo);\n    }\n    static unregisterProtocol(protocol) {\n        return fileUrlManager.unregister(protocol);\n    }\n    static resolveToRaw(url) {\n        return fileUrlManager.resolveToRaw(url);\n    }\n    static resolveToUrl(raw, protocol) {\n        return fileUrlManager.resolveToUrl(raw, protocol);\n    }\n    static getAllProtocolInfos() {\n        return [defaultProtocol, ...fileUrlManager.getAllFileProtocol()];\n    }\n}\n","module.exports = require(\"electron\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\nimport './ipcComponents/drag';\nimport { File } from './ipcComponents/file/index';\nexport { File };\n"],"names":[],"sourceRoot":""}