"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.detectImports = exports.createBabelPluginDetectAndRewriteImports = void 0;
const babel = __importStar(require("@babel/core"));
function createBabelPluginDetectAndRewriteImports({ rewrite, specifiers, }) {
    const add = (specifier, loc) => {
        const rewritten = rewrite === null || rewrite === void 0 ? void 0 : rewrite(specifier);
        specifiers.push({
            value: specifier,
            rewritten,
            loc: loc ? {
                start: { line: loc.start.line, column: loc.start.column },
                end: { line: loc.end.line, column: loc.end.column },
            } : undefined,
        });
        return rewritten;
    };
    const addStringLiteralSpecifier = (specifier) => {
        return add(specifier.value, specifier.loc);
    };
    const createRewrittenStringLiteralSpecifier = (value, original) => {
        const stringLiteral = babel.types.stringLiteral(value);
        babel.types.addComment(stringLiteral, 'trailing', original);
        return stringLiteral;
    };
    return {
        visitor: visitImportSpecifiers({
            stringLiteral(path) {
                const rewritten = addStringLiteralSpecifier(path.node);
                if (rewritten) {
                    path.replaceWith(createRewrittenStringLiteralSpecifier(rewritten, path.node.value));
                }
            },
            simpleTemplateLiteral(path, raw) {
                const rewritten = add(raw, path.node.loc);
                if (rewritten) {
                    path.replaceWith(createRewrittenStringLiteralSpecifier(rewritten, raw));
                }
            },
        }),
    };
}
exports.createBabelPluginDetectAndRewriteImports = createBabelPluginDetectAndRewriteImports;
async function detectImports(ast) {
    const result = [];
    const add = (specifier, loc) => {
        result.push({
            value: specifier,
            loc: loc ? {
                start: { line: loc.start.line, column: loc.start.column },
                end: { line: loc.end.line, column: loc.end.column },
            } : undefined,
        });
    };
    const addStringLiteralSpecifier = (specifier) => {
        add(specifier.value, specifier.loc);
    };
    babel.traverse(ast, visitImportSpecifiers({
        stringLiteral(path) {
            addStringLiteralSpecifier(path.node);
        },
        simpleTemplateLiteral(path, raw) {
            add(raw, path.node.loc);
        },
    }));
    return result;
}
exports.detectImports = detectImports;
function visitImportSpecifiers(visitor) {
    return {
        ImportDeclaration: (path) => visitor.stringLiteral(path.get('source')),
        ExportAllDeclaration: (path) => visitor.stringLiteral(path.get('source')),
        ExportNamedDeclaration: (path) => {
            if (path.node.source) {
                visitor.stringLiteral(path.get('source'));
            }
        },
        CallExpression: (path) => {
            const { callee, arguments: args } = path.node;
            if (callee.type === 'Import' && args.length === 1) {
                const specifierNode = args[0];
                if (specifierNode.type === 'StringLiteral') {
                    visitor.stringLiteral(path.get('arguments')[0]);
                }
                else if (specifierNode.type === 'TemplateLiteral' &&
                    specifierNode.expressions.length === 0 &&
                    specifierNode.quasis.length === 1) {
                    visitor.simpleTemplateLiteral(path.get('arguments')[0], specifierNode.quasis[0].value.raw);
                }
            }
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0ZWN0LWltcG9ydHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kLWFzc2VtYmxpbmcvcXVpY2stcGFjay91dGlscy9kZXRlY3QtaW1wb3J0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsbURBQXFDO0FBbUJyQyxTQUFnQix3Q0FBd0MsQ0FBQyxFQUNyRCxPQUFPLEVBQ1AsVUFBVSxHQUliO0lBQ0csTUFBTSxHQUFHLEdBQUcsQ0FBQyxTQUFpQixFQUFFLEdBQXVDLEVBQUUsRUFBRTtRQUN2RSxNQUFNLFNBQVMsR0FBRyxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUcsU0FBUyxDQUFDLENBQUM7UUFDdkMsVUFBVSxDQUFDLElBQUksQ0FBQztZQUNaLEtBQUssRUFBRSxTQUFTO1lBQ2hCLFNBQVM7WUFDVCxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUCxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO2dCQUN6RCxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFO2FBQ3RELENBQUMsQ0FBQyxDQUFDLFNBQVM7U0FDaEIsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQyxDQUFDO0lBQ0YsTUFBTSx5QkFBeUIsR0FBRyxDQUFDLFNBQW9DLEVBQUUsRUFBRTtRQUN2RSxPQUFPLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQyxDQUFDLENBQUM7SUFDRixNQUFNLHFDQUFxQyxHQUFHLENBQUMsS0FBYSxFQUFFLFFB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c0IsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzdCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ2xCLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQThDLENBQUMsQ0FBQzthQUMxRjtRQUNMLENBQUM7UUFDRCxjQUFjLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNyQixNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzlDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQy9DLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxhQUFhLENBQUMsSUFBSSxLQUFLLGVBQWUsRUFBRTtvQkFDeEMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBOEMsQ0FBQyxDQUFDO2lCQUNoRztxQkFBTSxJQUNILGFBQWEsQ0FBQyxJQUFJLEtBQUssaUJBQWlCO29CQUN4QyxhQUFhLENBQUMsV0FBVyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUN0QyxhQUFhLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7b0JBQ25DLE9BQU8sQ0FBQyxxQkFBcUIsQ0FDekIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQWdELEVBQ3ZFLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FDcEMsQ0FBQztpQkFDTDthQUNKO1FBQ0wsQ0FBQztLQUNKLENBQUM7QUFDTixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCAqIGFzIGJhYmVsIGZyb20gJ0BiYWJlbC9jb3JlJztcclxuaW1wb3J0IHsgQXN0IH0gZnJvbSAnLi4vLi4vbW9kLWxvL21vZC1sbyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNwZWNpZmllciB7XHJcbiAgICB2YWx1ZTogc3RyaW5nO1xyXG4gICAgcmV3cml0dGVuPzogc3RyaW5nO1xyXG4gICAgbG9jPzogU291cmNlTG9jYXRpb247XHJcbn1cclxuXHJcbmludGVyZmFjZSBMaW5lQ29sdW1uIHtcclxuICAgIGxpbmU6IG51bWJlcjtcclxuICAgIGNvbHVtbjogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgU291cmNlTG9jYXRpb24ge1xyXG4gICAgc3RhcnQ6IExpbmVDb2x1bW47XHJcbiAgICBlbmQ6IExpbmVDb2x1bW47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCYWJlbFBsdWdpbkRldGVjdEFuZFJld3JpdGVJbXBvcnRzKHtcclxuICAgIHJld3JpdGUsXHJcbiAgICBzcGVjaWZpZXJzLFxyXG59OiB7XHJcbiAgICByZXdyaXRlPzogKHNwZWNpZmllcjogc3RyaW5nKSA9PiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICBzcGVjaWZpZXJzOiBTcGVjaWZpZXJbXTtcclxufSkge1xyXG4gICAgY29uc3QgYWRkID0gKHNwZWNpZmllcjogc3RyaW5nLCBsb2M/OiBiYWJlbC50eXBlcy5Tb3VyY2VMb2NhdGlvbiB8IG51bGwpID0+IHtcclxuICAgICAgICBjb25zdCByZXdyaXR0ZW4gPSByZXdyaXRlPy4oc3BlY2lmaWVyKTtcclxuICAgICAgICBzcGVjaWZpZXJzLnB1c2goe1xyXG4gICAgICAgICAgICB2YWx1ZTogc3BlY2lmaWVyLFxyXG4gICAgICAgICAgICByZXdyaXR0ZW4sXHJcbiAgICAgICAgICAgIGxvYzogbG9jID8ge1xyXG4gICAgICAgICAgICAgICAgc3RhcnQ6IHsgbGluZTogbG9jLnN0YXJ0LmxpbmUsIGNvbHVtbjogbG9jLnN0YXJ0LmNvbHVtbiB9LFxyXG4gICAgICAgICAgICAgICAgZW5kOiB7IGxpbmU6IGxvYy5lbmQubGluZSwgY29sdW1uOiBsb2MuZW5kLmNvbHVtbiB9LFxyXG4gICAgICAgICAgICB9IDogdW5kZWZpbmVkLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXdyaXR0ZW47XHJcbiAgICB9O1xyXG4gICAgY29uc3QgYWRkU3RyaW5nTGl0ZXJhbFNwZWNpZmllciA9IChzcGVjaWZpZXI6IGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWwpID0+IHtcclxuICAgICAgICByZXR1cm4gYWRkKHNwZWNpZmllci52YWx1ZSwgc3BlY2lmaWVyLmxvYyk7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgY3JlYXRlUmV3cml0dGVuU3RyaW5nTGl0ZXJhbFNwZWNpZmllciA9ICh2YWx1ZTogc3RyaW5nLCBvcmlnaW5hbDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc3RyaW5nTGl0ZXJhbCA9IGJhYmVsLnR5cGVzLnN0cmluZ0xpdGVyYWwodmFsdWUpO1xyXG4gICAgICAgIGJhYmVsLnR5cGVzLmFkZENvbW1lbnQoc3RyaW5nTGl0ZXJhbCwgJ3RyYWlsaW5nJywgb3JpZ2luYWwpO1xyXG4gICAgICAgIHJldHVybiBzdHJpbmdMaXRlcmFsO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdmlzaXRvcjogdmlzaXRJbXBvcnRTcGVjaWZpZXJzKHtcclxuICAgICAgICAgICAgc3RyaW5nTGl0ZXJhbChwYXRoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXdyaXR0ZW4gPSBhZGRTdHJpbmdMaXRlcmFsU3BlY2lmaWVyKHBhdGgubm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmV3cml0dGVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aC5yZXBsYWNlV2l0aChjcmVhdGVSZXdyaXR0ZW5TdHJpbmdMaXRlcmFsU3BlY2lmaWVyKHJld3JpdHRlbiwgcGF0aC5ub2RlLnZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNpbXBsZVRlbXBsYXRlTGl0ZXJhbChwYXRoLCByYXcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJld3JpdHRlbiA9IGFkZChyYXcsIHBhdGgubm9kZS5sb2MpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJld3JpdHRlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGgucmVwbGFjZVdpdGgoY3JlYXRlUmV3cml0dGVuU3RyaW5nTGl0ZXJhbFNwZWNpZmllcihyZXdyaXR0ZW4sIHJhdykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pLFxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRldGVjdEltcG9ydHMoYXN0OiBBc3QpOiBQcm9taXNlPFNwZWNpZmllcltdPiB7XHJcbiAgICBjb25zdCByZXN1bHQ6IFNwZWNpZmllcltdID0gW107XHJcbiAgICBjb25zdCBhZGQgPSAoc3BlY2lmaWVyOiBzdHJpbmcsIGxvYz86IGJhYmVsLnR5cGVzLlNvdXJjZUxvY2F0aW9uIHwgbnVsbCkgPT4ge1xyXG4gICAgICAgIHJlc3VsdC5wdXNoKHtcclxuICAgICAgICAgICAgdmFsdWU6IHNwZWNpZmllcixcclxuICAgICAgICAgICAgbG9jOiBsb2MgPyB7XHJcbiAgICAgICAgICAgICAgICBzdGFydDogeyBsaW5lOiBsb2Muc3RhcnQubGluZSwgY29sdW1uOiBsb2Muc3RhcnQuY29sdW1uIH0sXHJcbiAgICAgICAgICAgICAgICBlbmQ6IHsgbGluZTogbG9jLmVuZC5saW5lLCBjb2x1bW46IGxvYy5lbmQuY29sdW1uIH0sXHJcbiAgICAgICAgICAgIH0gOiB1bmRlZmluZWQsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgYWRkU3RyaW5nTGl0ZXJhbFNwZWNpZmllciA9IChzcGVjaWZpZXI6IGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWwpID0+IHtcclxuICAgICAgICBhZGQoc3BlY2lmaWVyLnZhbHVlLCBzcGVjaWZpZXIubG9jKTtcclxuICAgIH07XHJcbiAgICBiYWJlbC50cmF2ZXJzZShhc3QsIHZpc2l0SW1wb3J0U3BlY2lmaWVycyh7XHJcbiAgICAgICAgc3RyaW5nTGl0ZXJhbChwYXRoKSB7XHJcbiAgICAgICAgICAgIGFkZFN0cmluZ0xpdGVyYWxTcGVjaWZpZXIocGF0aC5ub2RlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNpbXBsZVRlbXBsYXRlTGl0ZXJhbChwYXRoLCByYXcpIHtcclxuICAgICAgICAgICAgYWRkKHJhdywgcGF0aC5ub2RlLmxvYyk7XHJcbiAgICAgICAgfSxcclxuICAgIH0pKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJbXBvcnRTcGVjaWZpZXJWaXNpdG9yIHtcclxuICAgIHN0cmluZ0xpdGVyYWwocGF0aDogYmFiZWwuTm9kZVBhdGg8YmFiZWwudHlwZXMuU3RyaW5nTGl0ZXJhbD4pOiB2b2lkO1xyXG5cclxuICAgIHNpbXBsZVRlbXBsYXRlTGl0ZXJhbChwYXRoOiBiYWJlbC5Ob2RlUGF0aDxiYWJlbC50eXBlcy5UZW1wbGF0ZUxpdGVyYWw+LCB2YWx1ZTogc3RyaW5nKTogdm9pZDtcclxufVxyXG5cclxuZnVuY3Rpb24gdmlzaXRJbXBvcnRTcGVjaWZpZXJzPFM+KHZpc2l0b3I6IEltcG9ydFNwZWNpZmllclZpc2l0b3IpOiBiYWJlbC5WaXNpdG9yPFM+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgSW1wb3J0RGVjbGFyYXRpb246IChwYXRoKSA9PiB2aXNpdG9yLnN0cmluZ0xpdGVyYWwocGF0aC5nZXQoJ3NvdXJjZScpKSxcclxuICAgICAgICBFeHBvcnRBbGxEZWNsYXJhdGlvbjogKHBhdGgpID0+IHZpc2l0b3Iuc3RyaW5nTGl0ZXJhbChwYXRoLmdldCgnc291cmNlJykpLFxyXG4gICAgICAgIEV4cG9ydE5hbWVkRGVjbGFyYXRpb246IChwYXRoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwYXRoLm5vZGUuc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICB2aXNpdG9yLnN0cmluZ0xpdGVyYWwocGF0aC5nZXQoJ3NvdXJjZScpIGFzIGJhYmVsLk5vZGVQYXRoPGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWw+KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgQ2FsbEV4cHJlc3Npb246IChwYXRoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgY2FsbGVlLCBhcmd1bWVudHM6IGFyZ3MgfSA9IHBhdGgubm9kZTtcclxuICAgICAgICAgICAgaWYgKGNhbGxlZS50eXBlID09PSAnSW1wb3J0JyAmJiBhcmdzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3BlY2lmaWVyTm9kZSA9IGFyZ3NbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAoc3BlY2lmaWVyTm9kZS50eXBlID09PSAnU3RyaW5nTGl0ZXJhbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aXNpdG9yLnN0cmluZ0xpdGVyYWwocGF0aC5nZXQoJ2FyZ3VtZW50cycpWzBdIGFzIGJhYmVsLk5vZGVQYXRoPGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWw+KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVyTm9kZS50eXBlID09PSAnVGVtcGxhdGVMaXRlcmFsJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHNwZWNpZmllck5vZGUuZXhwcmVzc2lvbnMubGVuZ3RoID09PSAwICYmXHJcbiAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVyTm9kZS5xdWFzaXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaXRvci5zaW1wbGVUZW1wbGF0ZUxpdGVyYWwoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGguZ2V0KCdhcmd1bWVudHMnKVswXSBhcyBiYWJlbC5Ob2RlUGF0aDxiYWJlbC50eXBlcy5UZW1wbGF0ZUxpdGVyYWw+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpZXJOb2RlLnF1YXNpc1swXS52YWx1ZS5yYXcsXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICB9O1xyXG59XHJcbiJdfQ==