"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.detectImports = exports.createBabelPluginDetectAndRewriteImports = void 0;
const babel = __importStar(require("@babel/core"));
function createBabelPluginDetectAndRewriteImports({ rewrite, specifiers, }) {
    const add = (specifier, loc) => {
        const rewritten = rewrite === null || rewrite === void 0 ? void 0 : rewrite(specifier);
        specifiers.push({
            value: specifier,
            rewritten,
            loc: loc ? {
                start: { line: loc.start.line, column: loc.start.column },
                end: { line: loc.end.line, column: loc.end.column },
            } : undefined,
        });
        return rewritten;
    };
    const addStringLiteralSpecifier = (specifier) => {
        return add(specifier.value, specifier.loc);
    };
    const createRewrittenStringLiteralSpecifier = (value, original) => {
        const stringLiteral = babel.types.stringLiteral(value);
        babel.types.addComment(stringLiteral, 'trailing', original);
        return stringLiteral;
    };
    return {
        visitor: visitImportSpecifiers({
            stringLiteral(path) {
                const rewritten = addStringLiteralSpecifier(path.node);
                if (rewritten) {
                    path.replaceWith(createRewrittenStringLiteralSpecifier(rewritten, path.node.value));
                }
            },
            simpleTemplateLiteral(path, raw) {
                const rewritten = add(raw, path.node.loc);
                if (rewritten) {
                    path.replaceWith(createRewrittenStringLiteralSpecifier(rewritten, raw));
                }
            },
        }),
    };
}
exports.createBabelPluginDetectAndRewriteImports = createBabelPluginDetectAndRewriteImports;
async function detectImports(ast) {
    const result = [];
    const add = (specifier, loc) => {
        result.push({
            value: specifier,
            loc: loc ? {
                start: { line: loc.start.line, column: loc.start.column },
                end: { line: loc.end.line, column: loc.end.column },
            } : undefined,
        });
    };
    const addStringLiteralSpecifier = (specifier) => {
        add(specifier.value, specifier.loc);
    };
    babel.traverse(ast, visitImportSpecifiers({
        stringLiteral(path) {
            addStringLiteralSpecifier(path.node);
        },
        simpleTemplateLiteral(path, raw) {
            add(raw, path.node.loc);
        },
    }));
    return result;
}
exports.detectImports = detectImports;
function visitImportSpecifiers(visitor) {
    return {
        ImportDeclaration: (path) => visitor.stringLiteral(path.get('source')),
        ExportAllDeclaration: (path) => visitor.stringLiteral(path.get('source')),
        ExportNamedDeclaration: (path) => {
            if (path.node.source) {
                visitor.stringLiteral(path.get('source'));
            }
        },
        CallExpression: (path) => {
            const { callee, arguments: args } = path.node;
            if (callee.type === 'Import' && args.length === 1) {
                const specifierNode = args[0];
                if (specifierNode.type === 'StringLiteral') {
                    visitor.stringLiteral(path.get('arguments')[0]);
                }
                else if (specifierNode.type === 'TemplateLiteral' &&
                    specifierNode.expressions.length === 0 &&
                    specifierNode.quasis.length === 1) {
                    visitor.simpleTemplateLiteral(path.get('arguments')[0], specifierNode.quasis[0].value.raw);
                }
            }
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0ZWN0LWltcG9ydHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kLWFzc2VtYmxpbmcvcXVpY2stcGFjay91dGlscy9kZXRlY3QtaW1wb3J0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsbURBQXFDO0FBbUJyQyxTQUFnQix3Q0FBd0MsQ0FBQyxFQUNyRCxPQUFPLEVBQ1AsVUFBVSxHQUliO0lBQ0csTUFBTSxHQUFHLEdBQUcsQ0FBQyxTQUFpQixFQUFFLEdBQXVDLEVBQUUsRUFBRTtRQUN2RSxNQUFNLFNBQVMsR0FBRyxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUcsU0FBUyxDQUFDLENBQUM7UUFDdkMsVUFBVSxDQUFDLElBQUksQ0FBQztZQUNaLEtBQUssRUFBRSxTQUFTO1lBQ2hCLFNBQVM7WUFDVCxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUCxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO2dCQUN6RCxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFO2FBQ3RELENBQUMsQ0FBQyxDQUFDLFNBQVM7U0FDaEIsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQyxDQUFDO0lBQ0YsTUFBTSx5QkFBeUIsR0FBRyxDQUFDLFNBQW9DLEVBQUUsRUFBRTtRQUN2RSxPQUFPLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQyxDQUFDLENBQUM7SUFDRixNQUFNLHFDQUFxQyxHQUFHLENBQUMsS0FBYSxFQUFFLFFB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c0IsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzdCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ2xCLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQThDLENBQUMsQ0FBQzthQUMxRjtRQUNMLENBQUM7UUFDRCxjQUFjLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNyQixNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzlDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQy9DLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxhQUFhLENBQUMsSUFBSSxLQUFLLGVBQWUsRUFBRTtvQkFDeEMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBOEMsQ0FBQyxDQUFDO2lCQUNoRztxQkFBTSxJQUNILGFBQWEsQ0FBQyxJQUFJLEtBQUssaUJBQWlCO29CQUN4QyxhQUFhLENBQUMsV0FBVyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUN0QyxhQUFhLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7b0JBQ25DLE9BQU8sQ0FBQyxxQkFBcUIsQ0FDekIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQWdELEVBQ3ZFLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FDcEMsQ0FBQztpQkFDTDthQUNKO1FBQ0wsQ0FBQztLQUNKLENBQUM7QUFDTixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBiYWJlbCBmcm9tICdAYmFiZWwvY29yZSc7XG5pbXBvcnQgeyBBc3QgfSBmcm9tICcuLi8uLi9tb2QtbG8vbW9kLWxvJztcblxuZXhwb3J0IGludGVyZmFjZSBTcGVjaWZpZXIge1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgcmV3cml0dGVuPzogc3RyaW5nO1xuICAgIGxvYz86IFNvdXJjZUxvY2F0aW9uO1xufVxuXG5pbnRlcmZhY2UgTGluZUNvbHVtbiB7XG4gICAgbGluZTogbnVtYmVyO1xuICAgIGNvbHVtbjogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU291cmNlTG9jYXRpb24ge1xuICAgIHN0YXJ0OiBMaW5lQ29sdW1uO1xuICAgIGVuZDogTGluZUNvbHVtbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUJhYmVsUGx1Z2luRGV0ZWN0QW5kUmV3cml0ZUltcG9ydHMoe1xuICAgIHJld3JpdGUsXG4gICAgc3BlY2lmaWVycyxcbn06IHtcbiAgICByZXdyaXRlPzogKHNwZWNpZmllcjogc3RyaW5nKSA9PiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgc3BlY2lmaWVyczogU3BlY2lmaWVyW107XG59KSB7XG4gICAgY29uc3QgYWRkID0gKHNwZWNpZmllcjogc3RyaW5nLCBsb2M/OiBiYWJlbC50eXBlcy5Tb3VyY2VMb2NhdGlvbiB8IG51bGwpID0+IHtcbiAgICAgICAgY29uc3QgcmV3cml0dGVuID0gcmV3cml0ZT8uKHNwZWNpZmllcik7XG4gICAgICAgIHNwZWNpZmllcnMucHVzaCh7XG4gICAgICAgICAgICB2YWx1ZTogc3BlY2lmaWVyLFxuICAgICAgICAgICAgcmV3cml0dGVuLFxuICAgICAgICAgICAgbG9jOiBsb2MgPyB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHsgbGluZTogbG9jLnN0YXJ0LmxpbmUsIGNvbHVtbjogbG9jLnN0YXJ0LmNvbHVtbiB9LFxuICAgICAgICAgICAgICAgIGVuZDogeyBsaW5lOiBsb2MuZW5kLmxpbmUsIGNvbHVtbjogbG9jLmVuZC5jb2x1bW4gfSxcbiAgICAgICAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmV3cml0dGVuO1xuICAgIH07XG4gICAgY29uc3QgYWRkU3RyaW5nTGl0ZXJhbFNwZWNpZmllciA9IChzcGVjaWZpZXI6IGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWwpID0+IHtcbiAgICAgICAgcmV0dXJuIGFkZChzcGVjaWZpZXIudmFsdWUsIHNwZWNpZmllci5sb2MpO1xuICAgIH07XG4gICAgY29uc3QgY3JlYXRlUmV3cml0dGVuU3RyaW5nTGl0ZXJhbFNwZWNpZmllciA9ICh2YWx1ZTogc3RyaW5nLCBvcmlnaW5hbDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0cmluZ0xpdGVyYWwgPSBiYWJlbC50eXBlcy5zdHJpbmdMaXRlcmFsKHZhbHVlKTtcbiAgICAgICAgYmFiZWwudHlwZXMuYWRkQ29tbWVudChzdHJpbmdMaXRlcmFsLCAndHJhaWxpbmcnLCBvcmlnaW5hbCk7XG4gICAgICAgIHJldHVybiBzdHJpbmdMaXRlcmFsO1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdmlzaXRvcjogdmlzaXRJbXBvcnRTcGVjaWZpZXJzKHtcbiAgICAgICAgICAgIHN0cmluZ0xpdGVyYWwocGF0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJld3JpdHRlbiA9IGFkZFN0cmluZ0xpdGVyYWxTcGVjaWZpZXIocGF0aC5ub2RlKTtcbiAgICAgICAgICAgICAgICBpZiAocmV3cml0dGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdGgucmVwbGFjZVdpdGgoY3JlYXRlUmV3cml0dGVuU3RyaW5nTGl0ZXJhbFNwZWNpZmllcihyZXdyaXR0ZW4sIHBhdGgubm9kZS52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaW1wbGVUZW1wbGF0ZUxpdGVyYWwocGF0aCwgcmF3KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmV3cml0dGVuID0gYWRkKHJhdywgcGF0aC5ub2RlLmxvYyk7XG4gICAgICAgICAgICAgICAgaWYgKHJld3JpdHRlbikge1xuICAgICAgICAgICAgICAgICAgICBwYXRoLnJlcGxhY2VXaXRoKGNyZWF0ZVJld3JpdHRlblN0cmluZ0xpdGVyYWxTcGVjaWZpZXIocmV3cml0dGVuLCByYXcpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGV0ZWN0SW1wb3J0cyhhc3Q6IEFzdCk6IFByb21pc2U8U3BlY2lmaWVyW10+IHtcbiAgICBjb25zdCByZXN1bHQ6IFNwZWNpZmllcltdID0gW107XG4gICAgY29uc3QgYWRkID0gKHNwZWNpZmllcjogc3RyaW5nLCBsb2M/OiBiYWJlbC50eXBlcy5Tb3VyY2VMb2NhdGlvbiB8IG51bGwpID0+IHtcbiAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IHNwZWNpZmllcixcbiAgICAgICAgICAgIGxvYzogbG9jID8ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiB7IGxpbmU6IGxvYy5zdGFydC5saW5lLCBjb2x1bW46IGxvYy5zdGFydC5jb2x1bW4gfSxcbiAgICAgICAgICAgICAgICBlbmQ6IHsgbGluZTogbG9jLmVuZC5saW5lLCBjb2x1bW46IGxvYy5lbmQuY29sdW1uIH0sXG4gICAgICAgICAgICB9IDogdW5kZWZpbmVkLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNvbnN0IGFkZFN0cmluZ0xpdGVyYWxTcGVjaWZpZXIgPSAoc3BlY2lmaWVyOiBiYWJlbC50eXBlcy5TdHJpbmdMaXRlcmFsKSA9PiB7XG4gICAgICAgIGFkZChzcGVjaWZpZXIudmFsdWUsIHNwZWNpZmllci5sb2MpO1xuICAgIH07XG4gICAgYmFiZWwudHJhdmVyc2UoYXN0LCB2aXNpdEltcG9ydFNwZWNpZmllcnMoe1xuICAgICAgICBzdHJpbmdMaXRlcmFsKHBhdGgpIHtcbiAgICAgICAgICAgIGFkZFN0cmluZ0xpdGVyYWxTcGVjaWZpZXIocGF0aC5ub2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2ltcGxlVGVtcGxhdGVMaXRlcmFsKHBhdGgsIHJhdykge1xuICAgICAgICAgICAgYWRkKHJhdywgcGF0aC5ub2RlLmxvYyk7XG4gICAgICAgIH0sXG4gICAgfSkpO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmludGVyZmFjZSBJbXBvcnRTcGVjaWZpZXJWaXNpdG9yIHtcbiAgICBzdHJpbmdMaXRlcmFsKHBhdGg6IGJhYmVsLk5vZGVQYXRoPGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWw+KTogdm9pZDtcblxuICAgIHNpbXBsZVRlbXBsYXRlTGl0ZXJhbChwYXRoOiBiYWJlbC5Ob2RlUGF0aDxiYWJlbC50eXBlcy5UZW1wbGF0ZUxpdGVyYWw+LCB2YWx1ZTogc3RyaW5nKTogdm9pZDtcbn1cblxuZnVuY3Rpb24gdmlzaXRJbXBvcnRTcGVjaWZpZXJzPFM+KHZpc2l0b3I6IEltcG9ydFNwZWNpZmllclZpc2l0b3IpOiBiYWJlbC5WaXNpdG9yPFM+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICBJbXBvcnREZWNsYXJhdGlvbjogKHBhdGgpID0+IHZpc2l0b3Iuc3RyaW5nTGl0ZXJhbChwYXRoLmdldCgnc291cmNlJykpLFxuICAgICAgICBFeHBvcnRBbGxEZWNsYXJhdGlvbjogKHBhdGgpID0+IHZpc2l0b3Iuc3RyaW5nTGl0ZXJhbChwYXRoLmdldCgnc291cmNlJykpLFxuICAgICAgICBFeHBvcnROYW1lZERlY2xhcmF0aW9uOiAocGF0aCkgPT4ge1xuICAgICAgICAgICAgaWYgKHBhdGgubm9kZS5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB2aXNpdG9yLnN0cmluZ0xpdGVyYWwocGF0aC5nZXQoJ3NvdXJjZScpIGFzIGJhYmVsLk5vZGVQYXRoPGJhYmVsLnR5cGVzLlN0cmluZ0xpdGVyYWw+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgQ2FsbEV4cHJlc3Npb246IChwYXRoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNhbGxlZSwgYXJndW1lbnRzOiBhcmdzIH0gPSBwYXRoLm5vZGU7XG4gICAgICAgICAgICBpZiAoY2FsbGVlLnR5cGUgPT09ICdJbXBvcnQnICYmIGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3BlY2lmaWVyTm9kZSA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgaWYgKHNwZWNpZmllck5vZGUudHlwZSA9PT0gJ1N0cmluZ0xpdGVyYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2l0b3Iuc3RyaW5nTGl0ZXJhbChwYXRoLmdldCgnYXJndW1lbnRzJylbMF0gYXMgYmFiZWwuTm9kZVBhdGg8YmFiZWwudHlwZXMuU3RyaW5nTGl0ZXJhbD4pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHNwZWNpZmllck5vZGUudHlwZSA9PT0gJ1RlbXBsYXRlTGl0ZXJhbCcgJiZcbiAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVyTm9kZS5leHByZXNzaW9ucy5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVyTm9kZS5xdWFzaXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2l0b3Iuc2ltcGxlVGVtcGxhdGVMaXRlcmFsKFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aC5nZXQoJ2FyZ3VtZW50cycpWzBdIGFzIGJhYmVsLk5vZGVQYXRoPGJhYmVsLnR5cGVzLlRlbXBsYXRlTGl0ZXJhbD4sXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpZXJOb2RlLnF1YXNpc1swXS52YWx1ZS5yYXcsXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH07XG59XG4iXX0=