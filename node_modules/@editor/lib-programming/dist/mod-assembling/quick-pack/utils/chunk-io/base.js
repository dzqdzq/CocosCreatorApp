"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChunkIOBase = void 0;
const url_1 = require("url");
const path_1 = __importDefault(require("path"));
const fs_extra_1 = __importDefault(require("fs-extra"));
class ChunkIOBase {
    constructor({ chunkRecordFile, sourceCacheDir, }) {
        this._chunks = {};
        this._chunkRecordFile = chunkRecordFile;
        this._sourceCacheDirUrl = url_1.pathToFileURL(sourceCacheDir + path_1.default.sep);
    }
    _getChunkSourceFile(physicalLocation) {
        return url_1.fileURLToPath(new url_1.URL(`${physicalLocation}`, this._sourceCacheDirUrl));
    }
    async _loadChunkRecord() {
        try {
            this._chunks = await fs_extra_1.default.readJson(this._chunkRecordFile, { encoding: 'utf8' });
        }
        catch (_a) {
            return false;
        }
    }
    async _writeChunkRecord() {
        await fs_extra_1.default.outputJson(this._chunkRecordFile, this._chunks, { encoding: 'utf8', spaces: 2 });
    }
}
exports.ChunkIOBase = ChunkIOBase;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9tb2QtYXNzZW1ibGluZy9xdWljay1wYWNrL3V0aWxzL2NodW5rLWlvL2Jhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsNkJBQXdEO0FBQ3hELGdEQUFzQjtBQUN0Qix3REFBMEI7QUFJMUIsTUFBYSxXQUFXO0lBQ3BCLFlBQVksRUFDUixlQUFlLEVBQ2YsY0FBYyxHQUlqQjtRQXVCUyxZQUFPLEdBQTJCLEVBQUUsQ0FBQztRQXRCM0MsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztRQUN4QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsbUJBQWEsQ0FBQyxjQUFjLEdBQUcsY0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFUyxtQkFBbUIsQ0FBQyxnQkFBa0M7UUFDNUQsT0FBTyxtQkFBYSxDQUFDLElBQUksU0FBRyxDQUFDLEdBQUcsZ0JBQWdCLEVBQUUsRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO0lBQ2xGLENBQUM7SUFFUyxLQUFLLENBQUMsZ0JBQWdCO1FBQzVCLElBQUk7WUFDQSxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sa0JBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7U0FDakY7UUFBQyxXQUFNO1lBQ0osT0FBTyxLQUFLLENBQUM7U0FDaEI7SUFDTCxDQUFDO0lBRVMsS0FBSyxDQUFDLGlCQUFpQjtRQUM3QixNQUFNLGtCQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM5RixDQUFDO0NBS0o7QUEvQkQsa0NBK0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCwgcGF0aFRvRmlsZVVSTCwgVVJMIH0gZnJvbSAndXJsJztcbmltcG9ydCBwcyBmcm9tICdwYXRoJztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgeyBDaHVuaywgUGh5c2ljYWxMb2NhdGlvbiB9IGZyb20gJy4uL2NodW5rJztcbmltcG9ydCB7IENodW5rSWQgfSBmcm9tICcuLi9jaHVuay1pZCc7XG5cbmV4cG9ydCBjbGFzcyBDaHVua0lPQmFzZSB7XG4gICAgY29uc3RydWN0b3Ioe1xuICAgICAgICBjaHVua1JlY29yZEZpbGUsXG4gICAgICAgIHNvdXJjZUNhY2hlRGlyLFxuICAgIH06IHtcbiAgICAgICAgY2h1bmtSZWNvcmRGaWxlOiBzdHJpbmc7XG4gICAgICAgIHNvdXJjZUNhY2hlRGlyOiBzdHJpbmc7XG4gICAgfSkge1xuICAgICAgICB0aGlzLl9jaHVua1JlY29yZEZpbGUgPSBjaHVua1JlY29yZEZpbGU7XG4gICAgICAgIHRoaXMuX3NvdXJjZUNhY2hlRGlyVXJsID0gcGF0aFRvRmlsZVVSTChzb3VyY2VDYWNoZURpciArIHBzLnNlcCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9nZXRDaHVua1NvdXJjZUZpbGUocGh5c2ljYWxMb2NhdGlvbjogUGh5c2ljYWxMb2NhdGlvbikge1xuICAgICAgICByZXR1cm4gZmlsZVVSTFRvUGF0aChuZXcgVVJMKGAke3BoeXNpY2FsTG9jYXRpb259YCwgdGhpcy5fc291cmNlQ2FjaGVEaXJVcmwpKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgX2xvYWRDaHVua1JlY29yZCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuX2NodW5rcyA9IGF3YWl0IGZzLnJlYWRKc29uKHRoaXMuX2NodW5rUmVjb3JkRmlsZSwgeyBlbmNvZGluZzogJ3V0ZjgnIH0pO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBfd3JpdGVDaHVua1JlY29yZCgpIHtcbiAgICAgICAgYXdhaXQgZnMub3V0cHV0SnNvbih0aGlzLl9jaHVua1JlY29yZEZpbGUsIHRoaXMuX2NodW5rcywgeyBlbmNvZGluZzogJ3V0ZjgnLCBzcGFjZXM6IDIgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY2h1bmtSZWNvcmRGaWxlOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfc291cmNlQ2FjaGVEaXJVcmw6IFVSTDtcbiAgICBwcm90ZWN0ZWQgX2NodW5rczogUmVjb3JkPENodW5rSWQsIENodW5rPiA9IHt9O1xufVxuIl19