"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.mTimestampToString = exports.isEqualMTimestamp = exports.FetchFileError = exports.AccessDeniedError = exports.ModLo = exports.MemoryModule = void 0;
const fs_extra_1 = __importDefault(require("fs-extra"));
const babel = __importStar(require("@babel/core"));
const wrapper_1 = require("./cjs/wrapper");
const detect_1 = require("./cjs/detect");
const url_1 = require("url");
const mod_lo_builtin_mods_1 = require("./utils/mod-lo-builtin-mods");
const asserts_1 = require("../../utils/asserts");
const preset_env_1 = __importDefault(require("@babel/preset-env"));
const perf_hooks_1 = require("perf_hooks");
const url_2 = require("../utils/url");
const logger_1 = require("../utils/logger");
const plugin_annotate_ccclass_1 = __importDefault(require("../../babel/plugin-annotate-ccclass"));
const plugin_detect_circular_1 = __importDefault(require("../../babel/plugin-detect-circular"));
const esm_resolve_1 = require("./resolver/esm-resolve");
const resolve_error_1 = require("./resolver/resolve-error");
const parse_import_map_1 = require("./resolver/parse-import-map");
const cjs_resolve_1 = require("./resolver/cjs-resolve");
const specifier_1 = require("../utils/specifier");
const i18n_1 = require("../../utils/i18n");
const plugin_import_helper_1 = __importDefault(require("../../babel/plugin-import-helper"));
// @ts-expect-error
const plugin_syntax_top_level_await_1 = __importDefault(require("@babel/plugin-syntax-top-level-await"));
class MemoryModule {
    constructor(source) {
        this.source = source;
    }
    get source() {
        return this._source;
    }
    set source(value) {
        this._source = value;
        this._mTimestamp = perf_hooks_1.performance.now();
    }
    get mTimestamp() {
        return this._mTimestamp;
    }
}
exports.MemoryModule = MemoryModule;
/**
 * The uniform Module Loader.
 */
class ModLo {
    constructor({ targets, loose, exportsConditions, guessCommonJsExports, _cc, cr, _internalTransform, _compressUUID, _helperModule = '', importMap, loadMappings, externals, logger, }) {
        this._assetPrefixes = [];
        this._uuidMap = new Map();
        this._loadMappings = [];
        this._memoryModules = {};
        this._conditions = [];
        this._targets = targets;
        this._loose = loose !== null && loose !== void 0 ? loose : false;
        this._guessCjsExports = guessCommonJsExports !== null && guessCommonJsExports !== void 0 ? guessCommonJsExports : false;
        this._cc = _cc;
        this._cr = cr;
        this._internalTransform = _internalTransform;
        this._compressUUID = _compressUUID;
        this._conditions = [...esm_resolve_1.defaultConditions, ...(exportsConditions !== null && exportsConditions !== void 0 ? exportsConditions : [])];
        // TODO: verify bare or URLs
        this._externals = externals !== null && externals !== void 0 ? externals : [];
        this._logger = logger !== null && logger !== void 0 ? logger : logger_1.createLogger({});
        if (importMap) {
            this.setImportMap(importMap.json, importMap.url);
        }
        this._loadMappings.push(...normalizeLoadMappings(mod_lo_builtin_mods_1.modLoBuiltinLoadMappings));
        if (loadMappings) {
            this._loadMappings.push(...normalizeLoadMappings(loadMappings));
        }
        this._loadMappings.sort(([a], [b]) => a > b ? 1 : -1);
        if (_helperModule) {
            this._babelPluginImportHelper = plugin_import_helper_1.default({ helperModule: _helperModule });
        }
    }
    async getMTimestamp(url) {
        const loadURL = this._getLoadURL(url);
        return await this._getMtime(loadURL);
    }
    async load(url) {
        const loadURL = this._getLoadURL(url);
        const source = await this._loadSource(loadURL);
        const moduleType = await this._determinateModuleType(url);
        const metadata = { type: moduleType };
        let code;
        let map;
        if (moduleType === 'esm') {
            ({ code, map } = await this._transform(url, source, undefined));
        }
        else if (moduleType === 'cjs') {
            const cjsInfo = await this._detectCjsInfo(source, url);
            ({ code, map } = await this._transform(url, source, undefined, cjsInfo));
            metadata.cjs = {
                exports: cjsInfo.exports,
                reexports: cjsInfo.reexports,
            };
        }
        else {
            throw new Error(`Unknown module system.`);
        }
        return {
            originalSource: source,
            code,
            map,
            modLoMetadata: metadata,
        };
    }
    async resolve(specifier, from, metadata) {
        const resolved = await this._resolveUnchecked(specifier, from, metadata);
        if (!resolved.isExternal &&
            resolved.url.protocol !== 'node:') { // We do not treat node: URL as unresolved
            const { url } = resolved;
            if (!url.pathname.startsWith('/')) {
                throw new resolve_error_1.CanNotBeBaseURLError(url);
            }
        }
        return resolved;
    }
    async parse(code, map) {
        const inputSourceMap = typeof map === 'string' ? JSON.parse(map) : map;
        const parsed = await babel.parseAsync(code, {
            configFile: false,
            sourceType: 'module',
            inputSourceMap,
            parserOpts: {
                plugins: parserPlugins,
            },
        });
        asserts_1.assertsNonNullable(parsed);
        return parsed;
    }
    /**
     * @param externals Can be bare specifiers or URLs.
     */
    setExternals(externals) {
        this._externals.push(...externals);
    }
    addMemoryModule(url, source) {
        const urlObject = normalizeURLArg(url);
        return this._memoryModules[urlObject.href] = new MemoryModule(source);
    }
    setUUID(url, uuid) {
        assertIsURL(url);
        this._uuidMap.set(url, uuid);
    }
    unsetUUID(url) {
        assertIsURL(url);
        this._uuidMap.delete(url);
    }
    setImportMap(importMap, url) {
        this._parsedImportMap = parse_import_map_1.parseImportMap(importMap, url);
    }
    /**
     * 设置属于 asset 的模块 URL 的前缀。
     * @param prefixes
     */
    setAssetPrefixes(prefixes) {
        this._assetPrefixes = prefixes.slice();
    }
    /**
     * Throws if babel transform failed.
     */
    _throwBabelReturnNull() {
        throw new Error(`Failed to transform.`);
    }
    async _getMtime(url) {
        if (url.href in this._memoryModules) {
            return this._memoryModules[url.href].mTimestamp;
        }
        const filePath = tryConvertAsPath(url);
        if (filePath) {
            let sourceMtime;
            try {
                sourceMtime = (await fs_extra_1.default.stat(filePath)).mtimeMs;
            }
            catch (err) {
                this._logger.debug(`Failed to stat file '${url}' when get mtime:` + err);
                return 0;
            }
            const uuid = this._uuidMap.get(url.href);
            if (uuid) {
                return {
                    mtime: sourceMtime,
                    uuid,
                };
            }
            else {
                return sourceMtime;
            }
        }
        else {
            // TODO: may be we should relax?
            this._logger.debug(`Failed to get mtime of ${url}: not file URL`);
            return 0;
        }
    }
    _getLoadURL(url) {
        if (url.pathname.endsWith('/')) {
            asserts_1.asserts(false, `Module URL shall not ends with /.`);
            return url;
        }
        const href = url.href;
        for (const [prefix, mapped] of this._loadMappings) {
            if (href === prefix) {
                return mapped;
            }
            else if (prefix.endsWith('/') && href.startsWith(prefix)) {
                asserts_1.asserts(mapped.pathname.endsWith('/'));
                return new url_1.URL(href.substr(prefix.length), mapped);
            }
        }
        return url;
    }
    async _loadSource(url) {
        if (url.href in this._memoryModules) {
            return this._memoryModules[url.href].source;
        }
        else if (isCjsInteropUrl(url)) {
            return getCjsInteropSource(url);
        }
        else if (isFileURL(url)) {
            const path = url_1.fileURLToPath(url);
            try {
                return await fs_extra_1.default.readFile(path, 'utf8');
            }
            catch (err) {
                throw new FetchFileError(path, err);
            }
        }
        else {
            throw new AccessDeniedError(url.href);
        }
    }
    async _resolveUnchecked(specifier, from, metadata) {
        if (this._isExternal(specifier)) {
            return {
                specifierOrURL: specifier,
                isExternal: true,
            };
        }
        if (metadata.type === 'esm') {
            const resolved = await this._doEsmResolve(specifier, from, metadata);
            if (!resolved.isExternal) {
                const { url } = resolved;
                if (!isCjsInteropUrl(from) && await this._determinateModuleType(url) === 'cjs') {
                    this._logger.debug(`Create cjs interop url for '${url.href}'`);
                    const cjsInteropURL = createCjsInteropUrl(url);
                    return {
                        isExternal: false,
                        url: cjsInteropURL,
                    };
                }
            }
            return resolved;
        }
        return await this._doCjsResolve(specifier, from, metadata);
    }
    async _doEsmResolve(specifier, from, _metadata) {
        var _a;
        const stdResolved = await esm_resolve_1.esmResolve(specifier, from, {
            importMap: this._parsedImportMap,
            conditions: this._conditions,
        });
        // 对于项目脚本直接的互相导入，在标准解析的基础上，我们允许 extension-less 式的解析。
        const extensionLessResolved = this._isAssetModule(stdResolved) && this._isAssetModule(from)
            ? (_a = await this._tryExtensionLessResolve(stdResolved, ['.ts'])) !== null && _a !== void 0 ? _a : stdResolved : stdResolved;
        if (extensionLessResolved.protocol === 'file:') {
            const path = url_1.fileURLToPath(extensionLessResolved);
            const stat = await this._tryStat(path);
            if (stat.isDirectory()) {
                throw new resolve_error_1.UnsupportedDirectoryImportError();
            }
            else if (!stat.isFile()) {
                throw new resolve_error_1.ModuleNotFoundError(specifier, from);
            }
        }
        // Note: we do not have "post isExternal()"
        return {
            isExternal: false,
            url: extensionLessResolved,
        };
    }
    async _tryExtensionLessResolve(url, extensions) {
        if (await this._fileExists(url)) {
            return url;
        }
        const baseName = url.pathname.split('/').pop();
        if (!baseName || baseName === '') {
            return undefined;
        }
        for (const extension of extensions) {
            let guess;
            if (await this._fileExists(guess = new url_1.URL(`./${baseName}${extension}`, url))) {
                return guess;
            }
        }
        for (const extension of extensions) {
            let guess;
            if (await this._fileExists(guess = new url_1.URL(`./${baseName}/index${extension}`, url))) {
                return guess;
            }
        }
        return undefined;
    }
    async _doCjsResolve(specifier, from, _metadata) {
        // 如果 CommonJS 模块引用了一个不是文件 URL 的 URL，那么直接算解析成功。
        // 因为这里我们要插入 `cjs-loader` 的引用。
        // TODO：或许除了 `cjs-loader` 之外其它的都应该走 legacy resolve？
        if (!specifier_1.isRelativeSpecifier(specifier)) {
            const url = url_2.tryParseURL(specifier);
            if (url && !url_2.hasFileProtocol(url)) {
                return {
                    isExternal: false,
                    url,
                };
            }
        }
        const resolved = await cjs_resolve_1.cjsResolve(specifier, from);
        return {
            isExternal: false,
            url: resolved,
        };
    }
    _isExternal(specifierOrURL) {
        return this._externals.includes(specifierOrURL);
    }
    async _determinateModuleType(file) {
        // https://nodejs.org/api/packages.html#packages_determining_module_system
        switch (true) {
            case !isFileURL(file):
            case file.pathname.endsWith('.mjs'):
            case file.pathname.endsWith('.ts'):
            default:
                return 'esm';
            case file.pathname.endsWith('.cjs'):
                return 'cjs';
            case file.pathname.endsWith('.js'): {
                const packageJson = await esm_resolve_1.readPackageScope(file);
                if ((packageJson === null || packageJson === void 0 ? void 0 : packageJson.type) === 'module') {
                    return 'esm';
                }
                else {
                    return 'cjs';
                }
            }
        }
    }
    async _detectCjsInfo(source, _url) {
        return detect_1.detectCjsInfo(source);
    }
    async _transform(url, source, map, cjs) {
        const inputSourceMap = typeof map === 'string' ? JSON.parse(map) : map;
        const babelPresetEnvOptions = {
            modules: false,
            targets: this._targets,
            loose: this._loose,
        };
        if (this._internalTransform) {
            babelPresetEnvOptions.include = this._internalTransform.includes;
            babelPresetEnvOptions.exclude = this._internalTransform.excludes;
        }
        const babelPresets = [
            [preset_env_1.default, babelPresetEnvOptions],
        ];
        const babelPlugins = [];
        if (cjs) {
            babelPresets.push({
                plugins: [wrapper_1.wrapCjs(cjs.requires, this._guessCjsExports ? cjs.exports : [], this._guessCjsExports ? cjs.reexports : [])],
            });
        }
        else {
            babelPlugins.push(plugin_syntax_top_level_await_1.default);
            babelPresets.push(this._cc);
            const uuid = this._uuidMap.get(url.href);
            if (uuid !== undefined) {
                const baseName = url_2.getBaseName(url);
                const compressedUUID = this._compressUUID(uuid);
                babelPlugins.push([plugin_annotate_ccclass_1.default, {
                        baseName,
                        compressedUUID,
                    }]);
            }
            if (this._cr && this._isAssetModule(url)) {
                babelPlugins.push([plugin_detect_circular_1.default, this._cr]);
            }
        }
        if (!cjs && this._babelPluginImportHelper) {
            babelPlugins.push(this._babelPluginImportHelper);
        }
        const sourceType = cjs ? 'script' : 'module';
        const babelResult = await babel.transformAsync(source, {
            code: false,
            ast: true,
            sourceType,
            inputSourceMap,
            configFile: false,
            presets: babelPresets,
            plugins: babelPlugins,
        });
        asserts_1.asserts(babelResult);
        asserts_1.asserts(babelResult.ast);
        return {
            code: babelResult.ast,
            map: babelResult.map,
        };
    }
    async _tryStat(path) {
        try {
            return await fs_extra_1.default.stat(path);
        }
        catch (_a) {
            return new fs_extra_1.default.Stats();
        }
    }
    async _fileExists(url) {
        return (await this._tryStat(url_1.fileURLToPath(url))).isFile();
    }
    _isAssetModule(url) {
        const href = url.href;
        return this._assetPrefixes.some((assetPrefix) => href.startsWith(assetPrefix));
    }
}
exports.ModLo = ModLo;
class AccessDeniedError extends Error {
    constructor(url) {
        super(i18n_1.i18nTranslate('modLo_access_denied_error', { url }));
    }
}
exports.AccessDeniedError = AccessDeniedError;
class FetchFileError extends Error {
    constructor(file, err) {
        super(i18n_1.i18nTranslate('modLo_fetch_file_error', { path: file, cause: err }));
    }
}
exports.FetchFileError = FetchFileError;
function isEqualMTimestamp(lhs, rhs) {
    if (typeof lhs !== 'object') {
        return lhs === rhs;
    }
    else if (typeof rhs !== 'object') {
        return false;
    }
    else {
        return lhs.mtime === rhs.mtime && lhs.uuid === rhs.uuid;
    }
}
exports.isEqualMTimestamp = isEqualMTimestamp;
function mTimestampToString(mTimestamp) {
    return typeof mTimestamp === 'object'
        ? `${new Date(mTimestamp.mtime)}@${mTimestamp.uuid}`
        : `${new Date(mTimestamp)}`;
}
exports.mTimestampToString = mTimestampToString;
function normalizeURLArg(url) {
    return typeof url === 'string' ? new url_1.URL(url) : url;
}
function assertIsURL(url) {
    asserts_1.asserts(new url_1.URL(url));
}
function isFileURL(url) {
    return url.protocol === 'file:';
}
function tryConvertAsPath(url) {
    if (isCjsInteropUrl(url)) {
        return tryConvertAsPath(getCjsInteropTarget(url));
    }
    else if (isFileURL(url)) {
        return url_1.fileURLToPath(url);
    }
}
function createCjsInteropUrl(url) {
    try {
        const result = new url_1.URL(`?cjs`, url);
        const originalExtension = url_2.replaceExtension(result, '.mjs');
        if (originalExtension) {
            result.searchParams.append('original', originalExtension);
        }
        return result;
    }
    catch (err) {
        throw new resolve_error_1.CjsInteropError(url, err);
    }
}
function isCjsInteropUrl(url) {
    return url.searchParams.has('cjs');
}
function getCjsInteropTarget(url) {
    const target = new url_1.URL(url.href);
    target.searchParams.delete('cjs');
    const originalExtension = target.searchParams.get('original');
    if (originalExtension) {
        target.searchParams.delete('original');
        url_2.replaceExtension(target, originalExtension);
    }
    return target;
}
function getCjsInteropSource(url) {
    const target = getCjsInteropTarget(url);
    return wrapper_1.getCjsInteropModuleSource(`./${target.pathname.split('/').pop()}`);
}
function normalizeLoadMappings(loadMappings) {
    const normalized = [];
    for (const [from, to] of Object.entries(loadMappings)) {
        if (!from.endsWith('/') && to.endsWith('/')) {
            throw new Error(`Bad load mapping: '${from}': '${to}'`);
        }
        const fromURL = new url_1.URL(from);
        const toURL = new url_1.URL(to);
        normalized.push([fromURL.href, toURL]);
    }
    return normalized;
}
const parserPlugins = [
    'asyncGenerators',
    'bigInt',
    'classPrivateMethods',
    'classPrivateProperties',
    'classProperties',
    // 'classStaticBlock',
    'decimal',
    // 'decorators',
    'decorators-legacy',
    // 'doExpressions',
    'dynamicImport',
    // 'estree',
    'exportDefaultFrom',
    // 'exportNamespaceFrom', // deprecated
    // 'flow',
    // 'flowComments',
    // 'functionBind',
    'functionSent',
    'importMeta',
    // 'jsx',
    'logicalAssignment',
    // 'importAssertions',
    'moduleStringNames',
    'nullishCoalescingOperator',
    'numericSeparator',
    'objectRestSpread',
    'optionalCatchBinding',
    'optionalChaining',
    // 'partialApplication',
    // 'pipelineOperator',
    'placeholders',
    // 'privateIn',
    // 'throwExpressions',
    'topLevelAwait',
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kLWxvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZC1hc3NlbWJsaW5nL21vZC1sby9tb2QtbG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLHdEQUEwQjtBQUMxQixtREFBcUM7QUFFckMsMkNBQW1FO0FBQ25FLHlDQUFzRDtBQUN0RCw2QkFBeUM7QUFDekMscUVBQXVFO0FBQ3ZFLGlEQUFrRTtBQUNsRSxtRUFBK0M7QUFDL0MsMkNBQXlDO0FBQ3pDLHNDQUF5SDtBQUN6SCw0Q0FBdUQ7QUFFdkQsa0dBQTZFO0FBQzdFLGdHQUEyRTtBQUMzRSx3REFBeUY7QUFDekYsNERBQXVJO0FBR3ZJLGtFQUE2RDtBQUM3RCx3REFBb0Q7QUFDcEQsa0RBQXlEO0FBQ3pELDJDQUFpRDtBQUNqRCw0RkFBNEQ7QUFDNUQsbUJBQW1CO0FBQ25CLHlHQUFrRjtBQUlsRixNQUFhLFlBQVk7SUFDckIsWUFBWSxNQUFjO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLEtBQWE7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyx3QkFBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDVixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDNUIsQ0FBQztDQUlKO0FBcEJELG9DQW9CQztBQUVEOztHQUVHO0FBQ0gsTUFBYSxLQUFLO0lBQ2QsWUFBWSxFQUNSLE9BQU8sRUFDUCxLQUFLLEVBQ0wsaUJBQWlCLEVBQ2pCLG9CQUFvQixFQUNwQixHQUFHLEVBQ0gsRUFBRSxFQUNGLGtCQUFrQixFQUNsQixhQUFhLEVB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LENBQUMsc0JBQXNCLElBQUksT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQzNEO1FBQ0QsTUFBTSxPQUFPLEdBQUcsSUFBSSxTQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxTQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUIsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztLQUMxQztJQUNELE9BQU8sVUFBVSxDQUFDO0FBQ3RCLENBQUM7QUFFRCxNQUFNLGFBQWEsR0FBbUI7SUFDbEMsaUJBQWlCO0lBQ2pCLFFBQVE7SUFDUixxQkFBcUI7SUFDckIsd0JBQXdCO0lBQ3hCLGlCQUFpQjtJQUNqQixzQkFBc0I7SUFDdEIsU0FBUztJQUNULGdCQUFnQjtJQUNoQixtQkFBbUI7SUFDbkIsbUJBQW1CO0lBQ25CLGVBQWU7SUFDZixZQUFZO0lBQ1osbUJBQW1CO0lBQ25CLHVDQUF1QztJQUN2QyxVQUFVO0lBQ1Ysa0JBQWtCO0lBQ2xCLGtCQUFrQjtJQUNsQixjQUFjO0lBQ2QsWUFBWTtJQUNaLFNBQVM7SUFDVCxtQkFBbUI7SUFDbkIsc0JBQXNCO0lBQ3RCLG1CQUFtQjtJQUNuQiwyQkFBMkI7SUFDM0Isa0JBQWtCO0lBQ2xCLGtCQUFrQjtJQUNsQixzQkFBc0I7SUFDdEIsa0JBQWtCO0lBQ2xCLHdCQUF3QjtJQUN4QixzQkFBc0I7SUFDdEIsY0FBYztJQUNkLGVBQWU7SUFDZixzQkFBc0I7SUFDdEIsZUFBZTtDQVlsQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCBub2RlUmVzb2x2ZSBmcm9tICdyZXNvbHZlJztcclxuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcclxuaW1wb3J0ICogYXMgYmFiZWwgZnJvbSAnQGJhYmVsL2NvcmUnO1xyXG5pbXBvcnQgeyBSYXdTb3VyY2VNYXAgfSBmcm9tICdzb3VyY2UtbWFwJztcclxuaW1wb3J0IHsgZ2V0Q2pzSW50ZXJvcE1vZHVsZVNvdXJjZSwgd3JhcENqcyB9IGZyb20gJy4vY2pzL3dyYXBwZXInO1xyXG5pbXBvcnQgeyBDanNJbmZvLCBkZXRlY3RDanNJbmZvIH0gZnJvbSAnLi9janMvZGV0ZWN0JztcclxuaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCwgVVJMIH0gZnJvbSAndXJsJztcclxuaW1wb3J0IHsgbW9kTG9CdWlsdGluTG9hZE1hcHBpbmdzIH0gZnJvbSAnLi91dGlscy9tb2QtbG8tYnVpbHRpbi1tb2RzJztcclxuaW1wb3J0IHsgYXNzZXJ0cywgYXNzZXJ0c05vbk51bGxhYmxlIH0gZnJvbSAnLi4vLi4vdXRpbHMvYXNzZXJ0cyc7XHJcbmltcG9ydCBiYWJlbFByZXNldEVudiBmcm9tICdAYmFiZWwvcHJlc2V0LWVudic7XHJcbmltcG9ydCB7IHBlcmZvcm1hbmNlIH0gZnJvbSAncGVyZl9ob29rcyc7XHJcbmltcG9ydCB7IGFzc2lnblBhdGhuYW1lLCBnZXRCYXNlTmFtZSwgaGFzRXh0ZW5zaW9uLCBoYXNGaWxlUHJvdG9jb2wsIHJlcGxhY2VFeHRlbnNpb24sIHRyeVBhcnNlVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXJsJztcclxuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyLCBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xyXG5pbXBvcnQgeyBQYXJzZXJQbHVnaW4gfSBmcm9tICdAYmFiZWwvcGFyc2VyJztcclxuaW1wb3J0IGJhYmVsUGx1Z2luQW5ub3RhdGVDQ0NsYXNzIGZyb20gJy4uLy4uL2JhYmVsL3BsdWdpbi1hbm5vdGF0ZS1jY2NsYXNzJztcclxuaW1wb3J0IGJwRGV0ZWN0Q2lyY3VsYXJSZWZlcmVuY2UgZnJvbSAnLi4vLi4vYmFiZWwvcGx1Z2luLWRldGVjdC1jaXJjdWxhcic7XHJcbmltcG9ydCB7IGRlZmF1bHRDb25kaXRpb25zLCBlc21SZXNvbHZlLCByZWFkUGFja2FnZVNjb3BlIH0gZnJvbSAnLi9yZXNvbHZlci9lc20tcmVzb2x2ZSc7XHJcbmltcG9ydCB7IENhbk5vdEJlQmFzZVVSTEVycm9yLCBDanNJbnRlcm9wRXJyb3IsIE1vZHVsZU5vdEZvdW5kRXJyb3IsIFVuc3VwcG9ydGVkRGlyZWN0b3J5SW1wb3J0RXJyb3IgfSBmcm9tICcuL3Jlc29sdmVyL3Jlc29sdmUtZXJyb3InO1xyXG5pbXBvcnQgeyBJbXBvcnRNYXAgfSBmcm9tICcuL3Jlc29sdmVyL2ltcG9ydC1tYXAnO1xyXG5pbXBvcnQgeyBQYXJzZWRJbXBvcnRNYXAgfSBmcm9tICcuL3Jlc29sdmVyL3BhcnNlZC1pbXBvcnQtbWFwJztcclxuaW1wb3J0IHsgcGFyc2VJbXBvcnRNYXAgfSBmcm9tICcuL3Jlc29sdmVyL3BhcnNlLWltcG9ydC1tYXAnO1xyXG5pbXBvcnQgeyBjanNSZXNvbHZlIH0gZnJvbSAnLi9yZXNvbHZlci9janMtcmVzb2x2ZSc7XHJcbmltcG9ydCB7IGlzUmVsYXRpdmVTcGVjaWZpZXIgfSBmcm9tICcuLi91dGlscy9zcGVjaWZpZXInO1xyXG5pbXBvcnQgeyBpMThuVHJhbnNsYXRlIH0gZnJvbSAnLi4vLi4vdXRpbHMvaTE4bic7XHJcbmltcG9ydCBpbXBvcnRIZWxwZXIgZnJvbSAnLi4vLi4vYmFiZWwvcGx1Z2luLWltcG9ydC1oZWxwZXInO1xyXG4vLyBAdHMtZXhwZWN0LWVycm9yXHJcbmltcG9ydCBiYWJlbFBsdWdpblN5bnRheFRvcExldmVsQXdhaXQgZnJvbSAnQGJhYmVsL3BsdWdpbi1zeW50YXgtdG9wLWxldmVsLWF3YWl0JztcclxuXHJcbnR5cGUgUGFja2FnZU1ldGEgPSBOb25OdWxsYWJsZTxQYXJhbWV0ZXJzPFBhcmFtZXRlcnM8dHlwZW9mIG5vZGVSZXNvbHZlPlsyXT5bMl0+O1xyXG5cclxuZXhwb3J0IGNsYXNzIE1lbW9yeU1vZHVsZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2U6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzb3VyY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc291cmNlKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9zb3VyY2UgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9tVGltZXN0YW1wID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1UaW1lc3RhbXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21UaW1lc3RhbXA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkZWNsYXJlIF9tVGltZXN0YW1wOiBNVGltZXN0YW1wO1xyXG4gICAgcHJpdmF0ZSBkZWNsYXJlIF9zb3VyY2U6IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIFRoZSB1bmlmb3JtIE1vZHVsZSBMb2FkZXIuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTW9kTG8ge1xyXG4gICAgY29uc3RydWN0b3Ioe1xyXG4gICAgICAgIHRhcmdldHMsXHJcbiAgICAgICAgbG9vc2UsXHJcbiAgICAgICAgZXhwb3J0c0NvbmRpdGlvbnMsXHJcbiAgICAgICAgZ3Vlc3NDb21tb25Kc0V4cG9ydHMsXHJcbiAgICAgICAgX2NjLFxyXG4gICAgICAgIGNyLFxyXG4gICAgICAgIF9pbnRlcm5hbFRyYW5zZm9ybSxcclxuICAgICAgICBfY29tcHJlc3NVVUlELFxyXG4gICAgICAgIF9oZWxwZXJNb2R1bGUgPSAnJyxcclxuICAgICAgICBpbXBvcnRNYXAsXHJcbiAgICAgICAgbG9hZE1hcHBpbmdzLFxyXG4gICAgICAgIGV4dGVybmFscyxcclxuICAgICAgICBsb2dnZXIsXHJcbiAgICB9OiBNb2RMb09wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLl90YXJnZXRzID0gdGFyZ2V0cztcclxuICAgICAgICB0aGlzLl9sb29zZSA9IGxvb3NlID8/IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2d1ZXNzQ2pzRXhwb3J0cyA9IGd1ZXNzQ29tbW9uSnNFeHBvcnRzID8/IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2NjID0gX2NjO1xyXG4gICAgICAgIHRoaXMuX2NyID0gY3I7XHJcbiAgICAgICAgdGhpcy5faW50ZXJuYWxUcmFuc2Zvcm0gPSBfaW50ZXJuYWxUcmFuc2Zvcm07XHJcbiAgICAgICAgdGhpcy5fY29tcHJlc3NVVUlEID0gX2NvbXByZXNzVVVJRDtcclxuICAgICAgICB0aGlzLl9jb25kaXRpb25zID0gWy4uLmRlZmF1bHRDb25kaXRpb25zLCAuLi4oZXhwb3J0c0NvbmRpdGlvbnMgPz8gW10pXTtcclxuXHJcbiAgICAgICAgLy8gVE9ETzogdmVyaWZ5IGJhcmUgb3IgVVJMc1xyXG4gICAgICAgIHRoaXMuX2V4dGVybmFscyA9IGV4dGVybmFscyA/PyBbXTtcclxuICAgICAgICB0aGlzLl9sb2dnZXIgPSBsb2dnZXIgPz8gY3JlYXRlTG9nZ2VyKHt9KTtcclxuXHJcbiAgICAgICAgaWYgKGltcG9ydE1hcCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEltcG9ydE1hcChpbXBvcnRNYXAuanNvbiwgaW1wb3J0TWFwLnVybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9sb2FkTWFwcGluZ3MucHVzaCguLi5ub3JtYWxpemVMb2FkTWFwcGluZ3MobW9kTG9CdWlsdGluTG9hZE1hcHBpbmdzKSk7XHJcbiAgICAgICAgaWYgKGxvYWRNYXBwaW5ncykge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2FkTWFwcGluZ3MucHVzaCguLi5ub3JtYWxpemVMb2FkTWFwcGluZ3MobG9hZE1hcHBpbmdzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2xvYWRNYXBwaW5ncy5zb3J0KChbYV0sIFtiXSkgPT4gYSA+IGIgPyAxIDogLTEpO1xyXG5cclxuICAgICAgICBpZiAoX2hlbHBlck1vZHVsZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9iYWJlbFBsdWdpbkltcG9ydEhlbHBlciA9IGltcG9ydEhlbHBlcih7IGhlbHBlck1vZHVsZTogX2hlbHBlck1vZHVsZSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGdldE1UaW1lc3RhbXAodXJsOiBVUkwpOiBQcm9taXNlPE1UaW1lc3RhbXA+IHtcclxuICAgICAgICBjb25zdCBsb2FkVVJMID0gdGhpcy5fZ2V0TG9hZFVSTCh1cmwpO1xyXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9nZXRNdGltZShsb2FkVVJMKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgbG9hZCh1cmw6IFVSTCk6IFByb21pc2U8TW9kPiB7XHJcbiAgICAgICAgY29uc3QgbG9hZFVSTCA9IHRoaXMuX2dldExvYWRVUkwodXJsKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc291cmNlID0gYXdhaXQgdGhpcy5fbG9hZFNvdXJjZShsb2FkVVJMKTtcclxuXHJcbiAgICAgICAgY29uc3QgbW9kdWxlVHlwZSA9IGF3YWl0IHRoaXMuX2RldGVybWluYXRlTW9kdWxlVHlwZSh1cmwpO1xyXG5cclxuICAgICAgICBjb25zdCBtZXRhZGF0YTogTW9kTG9NZXRhZGF0YSA9IHsgdHlwZTogbW9kdWxlVHlwZSB9O1xyXG4gICAgICAgIGxldCBjb2RlOiBTb3VyY2U7XHJcbiAgICAgICAgbGV0IG1hcDogUmF3U291cmNlTWFwIHwgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICBpZiAobW9kdWxlVHlwZSA9PT0gJ2VzbScpIHtcclxuICAgICAgICAgICAgKHsgY29kZSwgbWFwIH0gPSBhd2FpdCB0aGlzLl90cmFuc2Zvcm0odXJsLCBzb3VyY2UsIHVuZGVmaW5lZCkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobW9kdWxlVHlwZSA9PT0gJ2NqcycpIHtcclxuICAgICAgICAgICAgY29uc3QgY2pzSW5mbzogUmVhZG9ubHk8Q2pzSW5mbz4gPSBhd2FpdCB0aGlzLl9kZXRlY3RDanNJbmZvKHNvdXJjZSwgdXJsKTtcclxuICAgICAgICAgICAgKHsgY29kZSwgbWFwIH0gPSBhd2FpdCB0aGlzLl90cmFuc2Zvcm0oXHJcbiAgICAgICAgICAgICAgICB1cmwsXHJcbiAgICAgICAgICAgICAgICBzb3VyY2UsXHJcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsIGNqc0luZm8sXHJcbiAgICAgICAgICAgICkpO1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5janMgPSB7XHJcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBjanNJbmZvLmV4cG9ydHMsXHJcbiAgICAgICAgICAgICAgICByZWV4cG9ydHM6IGNqc0luZm8ucmVleHBvcnRzLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBtb2R1bGUgc3lzdGVtLmApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgb3JpZ2luYWxTb3VyY2U6IHNvdXJjZSxcclxuICAgICAgICAgICAgY29kZSxcclxuICAgICAgICAgICAgbWFwLFxyXG4gICAgICAgICAgICBtb2RMb01ldGFkYXRhOiBtZXRhZGF0YSxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyByZXNvbHZlKHNwZWNpZmllcjogc3RyaW5nLCBmcm9tOiBVUkwsIG1ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XHJcbiAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCB0aGlzLl9yZXNvbHZlVW5jaGVja2VkKHNwZWNpZmllciwgZnJvbSwgbWV0YWRhdGEpO1xyXG5cclxuICAgICAgICBpZiAoIXJlc29sdmVkLmlzRXh0ZXJuYWwgJiZcclxuICAgICAgICAgICAgcmVzb2x2ZWQudXJsLnByb3RvY29sICE9PSAnbm9kZTonKSB7IC8vIFdlIGRvIG5vdCB0cmVhdCBub2RlOiBVUkwgYXMgdW5yZXNvbHZlZFxyXG4gICAgICAgICAgICBjb25zdCB7IHVybCB9ID0gcmVzb2x2ZWQ7XHJcbiAgICAgICAgICAgIGlmICghdXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoJy8nKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IENhbk5vdEJlQmFzZVVSTEVycm9yKHVybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlZDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgcGFyc2UoY29kZTogc3RyaW5nLCBtYXA/OiBTb3VyY2VNYXApIHtcclxuICAgICAgICBjb25zdCBpbnB1dFNvdXJjZU1hcCA9IHR5cGVvZiBtYXAgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShtYXApIDogbWFwO1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IGJhYmVsLnBhcnNlQXN5bmMoY29kZSwge1xyXG4gICAgICAgICAgICBjb25maWdGaWxlOiBmYWxzZSxcclxuICAgICAgICAgICAgc291cmNlVHlwZTogJ21vZHVsZScsXHJcbiAgICAgICAgICAgIGlucHV0U291cmNlTWFwLFxyXG4gICAgICAgICAgICBwYXJzZXJPcHRzOiB7XHJcbiAgICAgICAgICAgICAgICBwbHVnaW5zOiBwYXJzZXJQbHVnaW5zLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGFzc2VydHNOb25OdWxsYWJsZShwYXJzZWQpO1xyXG4gICAgICAgIHJldHVybiBwYXJzZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gZXh0ZXJuYWxzIENhbiBiZSBiYXJlIHNwZWNpZmllcnMgb3IgVVJMcy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldEV4dGVybmFscyhleHRlcm5hbHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgdGhpcy5fZXh0ZXJuYWxzLnB1c2goLi4uZXh0ZXJuYWxzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkTWVtb3J5TW9kdWxlKHVybDogUmVhZG9ubHk8VVJMPiB8IHN0cmluZywgc291cmNlOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCB1cmxPYmplY3QgPSBub3JtYWxpemVVUkxBcmcodXJsKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWVtb3J5TW9kdWxlc1t1cmxPYmplY3QuaHJlZl0gPSBuZXcgTWVtb3J5TW9kdWxlKHNvdXJjZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFVVSUQodXJsOiBzdHJpbmcsIHV1aWQ6IHN0cmluZykge1xyXG4gICAgICAgIGFzc2VydElzVVJMKHVybCk7XHJcbiAgICAgICAgdGhpcy5fdXVpZE1hcC5zZXQodXJsLCB1dWlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdW5zZXRVVUlEKHVybDogc3RyaW5nKSB7XHJcbiAgICAgICAgYXNzZXJ0SXNVUkwodXJsKTtcclxuICAgICAgICB0aGlzLl91dWlkTWFwLmRlbGV0ZSh1cmwpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRJbXBvcnRNYXAoaW1wb3J0TWFwOiBJbXBvcnRNYXAsIHVybDogVVJMKSB7XHJcbiAgICAgICAgdGhpcy5fcGFyc2VkSW1wb3J0TWFwID0gcGFyc2VJbXBvcnRNYXAoaW1wb3J0TWFwLCB1cmwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5bGe5LqOIGFzc2V0IOeahOaooeWdlyBVUkwg55qE5YmN57yA44CCXHJcbiAgICAgKiBAcGFyYW0gcHJlZml4ZXMgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXRBc3NldFByZWZpeGVzKHByZWZpeGVzOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX2Fzc2V0UHJlZml4ZXMgPSBwcmVmaXhlcy5zbGljZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhyb3dzIGlmIGJhYmVsIHRyYW5zZm9ybSBmYWlsZWQuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX3Rocm93QmFiZWxSZXR1cm5OdWxsKCk6IG5ldmVyIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB0cmFuc2Zvcm0uYCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0TXRpbWUodXJsOiBVUkwpOiBQcm9taXNlPE1UaW1lc3RhbXA+IHtcclxuICAgICAgICBpZiAodXJsLmhyZWYgaW4gdGhpcy5fbWVtb3J5TW9kdWxlcykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVtb3J5TW9kdWxlc1t1cmwuaHJlZl0ubVRpbWVzdGFtcDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gdHJ5Q29udmVydEFzUGF0aCh1cmwpO1xyXG4gICAgICAgIGlmIChmaWxlUGF0aCkge1xyXG4gICAgICAgICAgICBsZXQgc291cmNlTXRpbWU6IG51bWJlcjtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZU10aW1lID0gKGF3YWl0IGZzLnN0YXQoZmlsZVBhdGgpKS5tdGltZU1zO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgRmFpbGVkIHRvIHN0YXQgZmlsZSAnJHt1cmx9JyB3aGVuIGdldCBtdGltZTpgICsgZXJyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHV1aWQgPSB0aGlzLl91dWlkTWFwLmdldCh1cmwuaHJlZik7XHJcbiAgICAgICAgICAgIGlmICh1dWlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG10aW1lOiBzb3VyY2VNdGltZSxcclxuICAgICAgICAgICAgICAgICAgICB1dWlkLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3VyY2VNdGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IG1heSBiZSB3ZSBzaG91bGQgcmVsYXg/XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgRmFpbGVkIHRvIGdldCBtdGltZSBvZiAke3VybH06IG5vdCBmaWxlIFVSTGApO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0TG9hZFVSTCh1cmw6IFVSTCkge1xyXG4gICAgICAgIGlmICh1cmwucGF0aG5hbWUuZW5kc1dpdGgoJy8nKSkge1xyXG4gICAgICAgICAgICBhc3NlcnRzKGZhbHNlLCBgTW9kdWxlIFVSTCBzaGFsbCBub3QgZW5kcyB3aXRoIC8uYCk7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGhyZWYgPSB1cmwuaHJlZjtcclxuICAgICAgICBmb3IgKGNvbnN0IFtwcmVmaXgsIG1hcHBlZF0gb2YgdGhpcy5fbG9hZE1hcHBpbmdzKSB7XHJcbiAgICAgICAgICAgIGlmIChocmVmID09PSBwcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtYXBwZWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlZml4LmVuZHNXaXRoKCcvJykgJiYgaHJlZi5zdGFydHNXaXRoKHByZWZpeCkpIHtcclxuICAgICAgICAgICAgICAgIGFzc2VydHMobWFwcGVkLnBhdGhuYW1lLmVuZHNXaXRoKCcvJykpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkwoaHJlZi5zdWJzdHIocHJlZml4Lmxlbmd0aCksIG1hcHBlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVybDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9sb2FkU291cmNlKHVybDogVVJMKSB7XHJcbiAgICAgICAgaWYgKHVybC5ocmVmIGluIHRoaXMuX21lbW9yeU1vZHVsZXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lbW9yeU1vZHVsZXNbdXJsLmhyZWZdLnNvdXJjZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlzQ2pzSW50ZXJvcFVybCh1cmwpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRDanNJbnRlcm9wU291cmNlKHVybCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpc0ZpbGVVUkwodXJsKSkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXRoID0gZmlsZVVSTFRvUGF0aCh1cmwpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGZzLnJlYWRGaWxlKHBhdGgsICd1dGY4Jyk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZldGNoRmlsZUVycm9yKHBhdGgsIGVyciBhcyBFcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQWNjZXNzRGVuaWVkRXJyb3IodXJsLmhyZWYpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9yZXNvbHZlVW5jaGVja2VkKHNwZWNpZmllcjogc3RyaW5nLCBmcm9tOiBVUkwsIG1ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzRXh0ZXJuYWwoc3BlY2lmaWVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc3BlY2lmaWVyT3JVUkw6IHNwZWNpZmllcixcclxuICAgICAgICAgICAgICAgIGlzRXh0ZXJuYWw6IHRydWUsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobWV0YWRhdGEudHlwZSA9PT0gJ2VzbScpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCB0aGlzLl9kb0VzbVJlc29sdmUoc3BlY2lmaWVyLCBmcm9tLCBtZXRhZGF0YSk7XHJcbiAgICAgICAgICAgIGlmICghcmVzb2x2ZWQuaXNFeHRlcm5hbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyB1cmwgfSA9IHJlc29sdmVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc0Nqc0ludGVyb3BVcmwoZnJvbSkgJiYgYXdhaXQgdGhpcy5fZGV0ZXJtaW5hdGVNb2R1bGVUeXBlKHVybCkgPT09ICdjanMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKGBDcmVhdGUgY2pzIGludGVyb3AgdXJsIGZvciAnJHt1cmwuaHJlZn0nYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2pzSW50ZXJvcFVSTCA9IGNyZWF0ZUNqc0ludGVyb3BVcmwodXJsKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0V4dGVybmFsOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBjanNJbnRlcm9wVVJMLFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2RvQ2pzUmVzb2x2ZShzcGVjaWZpZXIsIGZyb20sIG1ldGFkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9kb0VzbVJlc29sdmUoc3BlY2lmaWVyOiBzdHJpbmcsIGZyb206IFVSTCwgX21ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XHJcbiAgICAgICAgY29uc3Qgc3RkUmVzb2x2ZWQgPSBhd2FpdCBlc21SZXNvbHZlKHNwZWNpZmllciwgZnJvbSwge1xyXG4gICAgICAgICAgICBpbXBvcnRNYXA6IHRoaXMuX3BhcnNlZEltcG9ydE1hcCxcclxuICAgICAgICAgICAgY29uZGl0aW9uczogdGhpcy5fY29uZGl0aW9ucyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5a+55LqO6aG555uu6ISa5pys55u05o6l55qE5LqS55u45a+85YWl77yM5Zyo5qCH5YeG6Kej5p6Q55qE5Z+656GA5LiK77yM5oiR5Lus5YWB6K64IGV4dGVuc2lvbi1sZXNzIOW8j+eahOino+aekOOAglxyXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbkxlc3NSZXNvbHZlZCA9IHRoaXMuX2lzQXNzZXRNb2R1bGUoc3RkUmVzb2x2ZWQpICYmIHRoaXMuX2lzQXNzZXRNb2R1bGUoZnJvbSlcclxuICAgICAgICAgICAgPyBhd2FpdCB0aGlzLl90cnlFeHRlbnNpb25MZXNzUmVzb2x2ZShzdGRSZXNvbHZlZCwgWycudHMnXSkgPz8gc3RkUmVzb2x2ZWRcclxuICAgICAgICAgICAgOiBzdGRSZXNvbHZlZDtcclxuXHJcbiAgICAgICAgaWYgKGV4dGVuc2lvbkxlc3NSZXNvbHZlZC5wcm90b2NvbCA9PT0gJ2ZpbGU6Jykge1xyXG4gICAgICAgICAgICBjb25zdCBwYXRoID0gZmlsZVVSTFRvUGF0aChleHRlbnNpb25MZXNzUmVzb2x2ZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ID0gYXdhaXQgdGhpcy5fdHJ5U3RhdChwYXRoKTtcclxuICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRGlyZWN0b3J5SW1wb3J0RXJyb3IoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghc3RhdC5pc0ZpbGUoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1vZHVsZU5vdEZvdW5kRXJyb3Ioc3BlY2lmaWVyLCBmcm9tKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTm90ZTogd2UgZG8gbm90IGhhdmUgXCJwb3N0IGlzRXh0ZXJuYWwoKVwiXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGlzRXh0ZXJuYWw6IGZhbHNlLFxyXG4gICAgICAgICAgICB1cmw6IGV4dGVuc2lvbkxlc3NSZXNvbHZlZCxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgX3RyeUV4dGVuc2lvbkxlc3NSZXNvbHZlKHVybDogVVJMLCBleHRlbnNpb25zOiByZWFkb25seSBzdHJpbmdbXSkge1xyXG4gICAgICAgIGlmIChhd2FpdCB0aGlzLl9maWxlRXhpc3RzKHVybCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYmFzZU5hbWUgPSB1cmwucGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKTtcclxuICAgICAgICBpZiAoIWJhc2VOYW1lIHx8IGJhc2VOYW1lID09PSAnJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IGV4dGVuc2lvbiBvZiBleHRlbnNpb25zKSB7XHJcbiAgICAgICAgICAgIGxldCBndWVzczogVVJMO1xyXG4gICAgICAgICAgICBpZiAoYXdhaXQgdGhpcy5fZmlsZUV4aXN0cyhndWVzcyA9IG5ldyBVUkwoYC4vJHtiYXNlTmFtZX0ke2V4dGVuc2lvbn1gLCB1cmwpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGd1ZXNzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgZXh0ZW5zaW9uIG9mIGV4dGVuc2lvbnMpIHtcclxuICAgICAgICAgICAgbGV0IGd1ZXNzOiBVUkw7XHJcbiAgICAgICAgICAgIGlmIChhd2FpdCB0aGlzLl9maWxlRXhpc3RzKGd1ZXNzID0gbmV3IFVSTChgLi8ke2Jhc2VOYW1lfS9pbmRleCR7ZXh0ZW5zaW9ufWAsIHVybCkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3Vlc3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9kb0Nqc1Jlc29sdmUoc3BlY2lmaWVyOiBzdHJpbmcsIGZyb206IFVSTCwgX21ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XHJcbiAgICAgICAgLy8g5aaC5p6cIENvbW1vbkpTIOaooeWdl+W8leeUqOS6huS4gOS4quS4jeaYr+aWh+S7tiBVUkwg55qEIFVSTO+8jOmCo+S5iOebtOaOpeeul+ino+aekOaIkOWKn+OAglxyXG4gICAgICAgIC8vIOWboOS4uui/memHjOaIkeS7rOimgeaPkuWFpSBgY2pzLWxvYWRlcmAg55qE5byV55So44CCXHJcbiAgICAgICAgLy8gVE9ET++8muaIluiuuOmZpOS6hiBgY2pzLWxvYWRlcmAg5LmL5aSW5YW25a6D55qE6YO95bqU6K+l6LWwIGxlZ2FjeSByZXNvbHZl77yfXHJcbiAgICAgICAgaWYgKCFpc1JlbGF0aXZlU3BlY2lmaWVyKHNwZWNpZmllcikpIHtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gdHJ5UGFyc2VVUkwoc3BlY2lmaWVyKTtcclxuICAgICAgICAgICAgaWYgKHVybCAmJiAhaGFzRmlsZVByb3RvY29sKHVybCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNFeHRlcm5hbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCBjanNSZXNvbHZlKHNwZWNpZmllciwgZnJvbSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaXNFeHRlcm5hbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHVybDogcmVzb2x2ZWQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9pc0V4dGVybmFsKHNwZWNpZmllck9yVVJMOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZXh0ZXJuYWxzLmluY2x1ZGVzKHNwZWNpZmllck9yVVJMKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9kZXRlcm1pbmF0ZU1vZHVsZVR5cGUoZmlsZTogVVJMKSB7XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9ub2RlanMub3JnL2FwaS9wYWNrYWdlcy5odG1sI3BhY2thZ2VzX2RldGVybWluaW5nX21vZHVsZV9zeXN0ZW1cclxuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcclxuICAgICAgICAgICAgY2FzZSAhaXNGaWxlVVJMKGZpbGUpOlxyXG4gICAgICAgICAgICBjYXNlIGZpbGUucGF0aG5hbWUuZW5kc1dpdGgoJy5tanMnKTpcclxuICAgICAgICAgICAgY2FzZSBmaWxlLnBhdGhuYW1lLmVuZHNXaXRoKCcudHMnKTpcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAnZXNtJztcclxuICAgICAgICAgICAgY2FzZSBmaWxlLnBhdGhuYW1lLmVuZHNXaXRoKCcuY2pzJyk6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2Nqcyc7XHJcbiAgICAgICAgICAgIGNhc2UgZmlsZS5wYXRobmFtZS5lbmRzV2l0aCgnLmpzJyk6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VKc29uID0gYXdhaXQgcmVhZFBhY2thZ2VTY29wZShmaWxlKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYWNrYWdlSnNvbj8udHlwZSA9PT0gJ21vZHVsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2VzbSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnY2pzJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF9kZXRlY3RDanNJbmZvKHNvdXJjZTogc3RyaW5nLCBfdXJsOiBVUkwpIHtcclxuICAgICAgICByZXR1cm4gZGV0ZWN0Q2pzSW5mbyhzb3VyY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgX3RyYW5zZm9ybShcclxuICAgICAgICB1cmw6IFVSTCxcclxuICAgICAgICBzb3VyY2U6IHN0cmluZyxcclxuICAgICAgICBtYXA/OiBSYXdTb3VyY2VNYXAgfCBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgICAgICAgY2pzPzogUmVhZG9ubHk8Q2pzSW5mbz4sXHJcbiAgICApOiBQcm9taXNlPFRyYW5zZm9ybVJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGlucHV0U291cmNlTWFwID0gdHlwZW9mIG1hcCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKG1hcCkgOiBtYXA7XHJcblxyXG4gICAgICAgIGNvbnN0IGJhYmVsUHJlc2V0RW52T3B0aW9uczogYmFiZWxQcmVzZXRFbnYuT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbW9kdWxlczogZmFsc2UsXHJcbiAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuX3RhcmdldHMsXHJcbiAgICAgICAgICAgIGxvb3NlOiB0aGlzLl9sb29zZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLl9pbnRlcm5hbFRyYW5zZm9ybSkge1xyXG4gICAgICAgICAgICBiYWJlbFByZXNldEVudk9wdGlvbnMuaW5jbHVkZSA9IHRoaXMuX2ludGVybmFsVHJhbnNmb3JtLmluY2x1ZGVzO1xyXG4gICAgICAgICAgICBiYWJlbFByZXNldEVudk9wdGlvbnMuZXhjbHVkZSA9IHRoaXMuX2ludGVybmFsVHJhbnNmb3JtLmV4Y2x1ZGVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYmFiZWxQcmVzZXRzOiBiYWJlbC5QbHVnaW5JdGVtW10gPSBbXHJcbiAgICAgICAgICAgIFtiYWJlbFByZXNldEVudiwgYmFiZWxQcmVzZXRFbnZPcHRpb25zXSxcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBjb25zdCBiYWJlbFBsdWdpbnM6IGJhYmVsLlBsdWdpbkl0ZW1bXSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoY2pzKSB7XHJcbiAgICAgICAgICAgIGJhYmVsUHJlc2V0cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHBsdWdpbnM6IFt3cmFwQ2pzKFxyXG4gICAgICAgICAgICAgICAgICAgIGNqcy5yZXF1aXJlcyxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9ndWVzc0Nqc0V4cG9ydHMgPyBjanMuZXhwb3J0cyA6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2d1ZXNzQ2pzRXhwb3J0cyA/IGNqcy5yZWV4cG9ydHMgOiBbXSxcclxuICAgICAgICAgICAgICAgICldLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBiYWJlbFBsdWdpbnMucHVzaChiYWJlbFBsdWdpblN5bnRheFRvcExldmVsQXdhaXQpO1xyXG5cclxuICAgICAgICAgICAgYmFiZWxQcmVzZXRzLnB1c2godGhpcy5fY2MpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdXVpZCA9IHRoaXMuX3V1aWRNYXAuZ2V0KHVybC5ocmVmKTtcclxuICAgICAgICAgICAgaWYgKHV1aWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBnZXRCYXNlTmFtZSh1cmwpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcHJlc3NlZFVVSUQgPSB0aGlzLl9jb21wcmVzc1VVSUQodXVpZCk7XHJcbiAgICAgICAgICAgICAgICBiYWJlbFBsdWdpbnMucHVzaChbYmFiZWxQbHVnaW5Bbm5vdGF0ZUNDQ2xhc3MsIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2VkVVVJRCxcclxuICAgICAgICAgICAgICAgIH0gYXMgYmFiZWxQbHVnaW5Bbm5vdGF0ZUNDQ2xhc3MuT3B0aW9uc10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY3IgJiYgdGhpcy5faXNBc3NldE1vZHVsZSh1cmwpKSB7XHJcbiAgICAgICAgICAgICAgICBiYWJlbFBsdWdpbnMucHVzaChbYnBEZXRlY3RDaXJjdWxhclJlZmVyZW5jZSwgdGhpcy5fY3JdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFjanMgJiYgdGhpcy5fYmFiZWxQbHVnaW5JbXBvcnRIZWxwZXIpIHtcclxuICAgICAgICAgICAgYmFiZWxQbHVnaW5zLnB1c2godGhpcy5fYmFiZWxQbHVnaW5JbXBvcnRIZWxwZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc291cmNlVHlwZSA9IGNqcyA/ICdzY3JpcHQnIDogJ21vZHVsZSc7XHJcbiAgICAgICAgY29uc3QgYmFiZWxSZXN1bHQgPSBhd2FpdCBiYWJlbC50cmFuc2Zvcm1Bc3luYyhzb3VyY2UsIHtcclxuICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGFzdDogdHJ1ZSxcclxuICAgICAgICAgICAgc291cmNlVHlwZSxcclxuICAgICAgICAgICAgaW5wdXRTb3VyY2VNYXAsXHJcbiAgICAgICAgICAgIGNvbmZpZ0ZpbGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBwcmVzZXRzOiBiYWJlbFByZXNldHMsXHJcbiAgICAgICAgICAgIHBsdWdpbnM6IGJhYmVsUGx1Z2lucyxcclxuICAgICAgICAgICAgLy8gcGFyc2VyT3B0czoge1xyXG4gICAgICAgICAgICAvLyAgICAgcGx1Z2luczogcGFyc2VyUGx1Z2lucyxcclxuICAgICAgICAgICAgLy8gfSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnRzKGJhYmVsUmVzdWx0KTtcclxuICAgICAgICBhc3NlcnRzKGJhYmVsUmVzdWx0LmFzdCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY29kZTogYmFiZWxSZXN1bHQuYXN0LFxyXG4gICAgICAgICAgICBtYXA6IGJhYmVsUmVzdWx0Lm1hcCBhcyBSYXdTb3VyY2VNYXAgfCB1bmRlZmluZWQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIF90cnlTdGF0KHBhdGg6IHN0cmluZykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBmcy5zdGF0KHBhdGgpO1xyXG4gICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IGZzLlN0YXRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgX2ZpbGVFeGlzdHModXJsOiBVUkwpIHtcclxuICAgICAgICByZXR1cm4gKGF3YWl0IHRoaXMuX3RyeVN0YXQoZmlsZVVSTFRvUGF0aCh1cmwpKSkuaXNGaWxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNBc3NldE1vZHVsZSh1cmw6IFVSTCkge1xyXG4gICAgICAgIGNvbnN0IGhyZWYgPSB1cmwuaHJlZjtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXNzZXRQcmVmaXhlcy5zb21lKChhc3NldFByZWZpeCkgPT4gaHJlZi5zdGFydHNXaXRoKGFzc2V0UHJlZml4KSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfbG9nZ2VyOiBMb2dnZXI7XHJcbiAgICBwcml2YXRlIF90YXJnZXRzPzogQnJvd3NlcnNMaXN0VGFyZ2V0cztcclxuICAgIHByaXZhdGUgX2xvb3NlOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfYXNzZXRQcmVmaXhlczogc3RyaW5nW10gPSBbXTtcclxuICAgIHByaXZhdGUgX2d1ZXNzQ2pzRXhwb3J0czogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX2NjOiBpbXBvcnQoJ0BiYWJlbC9jb3JlJykuUGx1Z2luSXRlbTtcclxuICAgIHByaXZhdGUgX2NyPzogYnBEZXRlY3RDaXJjdWxhclJlZmVyZW5jZS5PcHRpb25zO1xyXG4gICAgcHJpdmF0ZSBfYmFiZWxQbHVnaW5JbXBvcnRIZWxwZXI6IGJhYmVsLlBsdWdpbkl0ZW0gfCB1bmRlZmluZWQ7XHJcbiAgICBwcml2YXRlIF9jb21wcmVzc1VVSUQ6ICh1dWlkOiBzdHJpbmcpID0+IHN0cmluZztcclxuICAgIHByaXZhdGUgX3V1aWRNYXA6IE1hcDxzdHJpbmcsIHN0cmluZz4gPSBuZXcgTWFwKCk7XHJcbiAgICBwcml2YXRlIF9pbnRlcm5hbFRyYW5zZm9ybT86IEludGVybmFsVHJhbnNmb3JtT3B0aW9ucztcclxuICAgIHByaXZhdGUgX2V4dGVybmFsczogQXJyYXk8c3RyaW5nPjtcclxuICAgIHByaXZhdGUgX2xvYWRNYXBwaW5nczogQXJyYXk8W3N0cmluZywgVVJMXT4gPSBbXTtcclxuICAgIHByaXZhdGUgX3BhcnNlZEltcG9ydE1hcDogUGFyc2VkSW1wb3J0TWFwIHwgdW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSBfbWVtb3J5TW9kdWxlczogUmVjb3JkPHN0cmluZywgTWVtb3J5TW9kdWxlPiA9IHt9O1xyXG4gICAgcHJpdmF0ZSBfY29uZGl0aW9uczogcmVhZG9ubHkgc3RyaW5nW10gPSBbXTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEFjY2Vzc0RlbmllZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gICAgY29uc3RydWN0b3IodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcihpMThuVHJhbnNsYXRlKCdtb2RMb19hY2Nlc3NfZGVuaWVkX2Vycm9yJywgeyB1cmwgfSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmV0Y2hGaWxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihmaWxlOiBzdHJpbmcsIGVycjogRXJyb3IpIHtcclxuICAgICAgICBzdXBlcihpMThuVHJhbnNsYXRlKCdtb2RMb19mZXRjaF9maWxlX2Vycm9yJywgeyBwYXRoOiBmaWxlLCBjYXVzZTogZXJyIH0pKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNb2RMb09wdGlvbnMge1xyXG4gICAgdGFyZ2V0cz86IEJyb3dzZXJzTGlzdFRhcmdldHM7XHJcblxyXG4gICAgbG9vc2U/OiBib29sZWFuO1xyXG5cclxuICAgIGV4cG9ydHNDb25kaXRpb25zPzogc3RyaW5nW107XHJcblxyXG4gICAgZ3Vlc3NDb21tb25Kc0V4cG9ydHM/OiBib29sZWFuO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YaF6YOo5L2/55So44CC5Lul5ZCO5Y+v6IO96LCD5pW044CCXHJcbiAgICAgKiBCYWJlbCBwcmVzZXQgYEBjb2Nvcy9iYWJlbC1wcmVzZXQtY2NgIOaPkuS7tuS7peWPiuWug+eahOmAiemhueOAglxyXG4gICAgICovXHJcbiAgICBfY2M6IGltcG9ydCgnQGJhYmVsL2NvcmUnKS5QbHVnaW5JdGVtO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b6q546v5byV55So5qOA5rWL6YCJ6aG544CC5Y+q5Lya5a+5IGFzc2V0IOexu+Wei+eahOaooeWdl+eUn+aViOOAglxyXG4gICAgICovXHJcbiAgICBjcj86IGJwRGV0ZWN0Q2lyY3VsYXJSZWZlcmVuY2UuT3B0aW9ucztcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWGhemDqOS9v+eUqOOAguS7peWQjuWPr+iDveiwg+aVtOOAglxyXG4gICAgICovXHJcbiAgICBfY29tcHJlc3NVVUlEOiAodXVpZDogc3RyaW5nKSA9PiBzdHJpbmc7XHJcblxyXG4gICAgX2ludGVybmFsVHJhbnNmb3JtPzogSW50ZXJuYWxUcmFuc2Zvcm1PcHRpb25zO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSGVscGVyIOaooeWdl+eahCBJROOAglxyXG4gICAgICovXHJcbiAgICBfaGVscGVyTW9kdWxlPzogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW1wb3J0IG1hcOOAglxyXG4gICAgICovXHJcbiAgICBpbXBvcnRNYXA/OiB7XHJcbiAgICAgICAgdXJsOiBVUkw7XHJcbiAgICAgICAganNvbjogSW1wb3J0TWFwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5LiA5LqbIFVSTCDmmKDlsITliLDlj6bkuIDkupsgVVJM44CC5Li76KaB55So5LqO5pig5bCE5LiA5LqbIFVSTCDliLDmlofku7bns7vnu5/kuIrjgIJcclxuICAgICAqIOazqOaEj++8mlxyXG4gICAgICogLSDov5nkuKrlkowgaW1wb3J0IG1hcCDkuI3lkIzjgILlroPkuI3kvJrmlLnlj5jmqKHlnZfnmoQgVVJM77yM5Y+q5Lya5Zyo5Yqg6L295qih5Z2X5rqQ56CB5pe26L2s6ICM5Y675Yqg6L295paH5Lu257O757uf5LiK55qE44CCXHJcbiAgICAgKiAtIOmUruWSjOWAvOimgeS5iOmDveS7pSAvIOe7k+Wwvu+8jOimgeS5iOmDveS4jeS7pSAvIOe7k+WwvuOAguWmguaenOS7pSAvIOe7k+WwvuihqOekuuaVtOS4quebruW9leaYoOWwhOOAglxyXG4gICAgICovXHJcbiAgICBsb2FkTWFwcGluZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FuIGJlIGJhcmUgc3BlY2lmaWVycyBvciBVUkxzLlxyXG4gICAgICovXHJcbiAgICBleHRlcm5hbHM/OiBzdHJpbmdbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIExvZ2dlci5cclxuICAgICAqL1xyXG4gICAgbG9nZ2VyPzogTG9nZ2VyO1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBBc3QgPSBiYWJlbC50eXBlcy5GaWxlIHwgYmFiZWwudHlwZXMuUHJvZ3JhbTtcclxuXHJcbmV4cG9ydCB0eXBlIFNvdXJjZSA9IHN0cmluZyB8IEFzdDtcclxuXHJcbmV4cG9ydCB0eXBlIEJyb3dzZXJzTGlzdFRhcmdldHMgPSBzdHJpbmcgfCBzdHJpbmdbXSB8IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XHJcblxyXG5leHBvcnQgdHlwZSB7IEltcG9ydE1hcCB9O1xyXG5cclxuaW50ZXJmYWNlIEludGVybmFsVHJhbnNmb3JtT3B0aW9ucyB7XHJcbiAgICBleGNsdWRlcz86IEFycmF5PFJlZ0V4cCB8c3RyaW5nPjtcclxuICAgIGluY2x1ZGVzPzogQXJyYXk8UmVnRXhwIHxzdHJpbmc+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1vZCB7XHJcbiAgICBvcmlnaW5hbFNvdXJjZTogc3RyaW5nO1xyXG4gICAgY29kZTogU291cmNlO1xyXG4gICAgbWFwPzogU291cmNlTWFwO1xyXG4gICAgbW9kTG9NZXRhZGF0YTogTW9kTG9NZXRhZGF0YTtcclxufVxyXG5cclxudHlwZSBNYXliZVByb21pc2VkPFQ+PSBUIHwgUHJvbWlzZTxUPjtcclxuXHJcbi8qKlxyXG4gKiBTdGFtcCB0byBpbmRpY2F0ZSB3aGV0aGVyIHRoZSBtb2R1bGUgc291cmNlIGlzIGV4cGlyZWQuXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBNVGltZXN0YW1wID0gbnVtYmVyIHwge1xyXG4gICAgbXRpbWU6IG51bWJlcjtcclxuICAgIHV1aWQ6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0VxdWFsTVRpbWVzdGFtcChsaHM6IE1UaW1lc3RhbXAsIHJoczogTVRpbWVzdGFtcCkge1xyXG4gICAgaWYgKHR5cGVvZiBsaHMgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgcmV0dXJuIGxocyA9PT0gcmhzO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmhzICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGxocy5tdGltZSA9PT0gcmhzLm10aW1lICYmIGxocy51dWlkID09PSByaHMudXVpZDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1UaW1lc3RhbXBUb1N0cmluZyhtVGltZXN0YW1wOiBNVGltZXN0YW1wKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG1UaW1lc3RhbXAgPT09ICdvYmplY3QnXHJcbiAgICAgICAgPyBgJHtuZXcgRGF0ZShtVGltZXN0YW1wLm10aW1lKX1AJHttVGltZXN0YW1wLnV1aWR9YFxyXG4gICAgICAgIDogYCR7bmV3IERhdGUobVRpbWVzdGFtcCl9YDtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgUmVzb2x2ZVJlc3VsdCA9IHtcclxuICAgIGlzRXh0ZXJuYWw6IGZhbHNlO1xyXG4gICAgdXJsOiBVUkxcclxufSB8IHtcclxuICAgIGlzRXh0ZXJuYWw6IHRydWU7XHJcbiAgICBzcGVjaWZpZXJPclVSTDogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgU291cmNlTWFwID0gUmF3U291cmNlTWFwIHwgc3RyaW5nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNb2RMb01ldGFkYXRhIHtcclxuICAgIHR5cGU6ICdlc20nIHwgJ2Nqcyc7XHJcbiAgICBjanM/OiB7XHJcbiAgICAgICAgZXhwb3J0czogc3RyaW5nW107XHJcbiAgICAgICAgcmVleHBvcnRzOiBzdHJpbmdbXTtcclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZVVSTEFyZyh1cmw6IHN0cmluZyB8IFJlYWRvbmx5PFVSTD4pIHtcclxuICAgIHJldHVybiB0eXBlb2YgdXJsID09PSAnc3RyaW5nJyA/IG5ldyBVUkwodXJsKSA6IHVybDtcclxufVxyXG5cclxuZnVuY3Rpb24gYXNzZXJ0SXNVUkwodXJsOiBzdHJpbmcpIHtcclxuICAgIGFzc2VydHMobmV3IFVSTCh1cmwpKTtcclxufVxyXG5cclxuaW50ZXJmYWNlIFRyYW5zZm9ybVJlc3VsdCB7XHJcbiAgICBjb2RlOiBTb3VyY2U7XHJcbiAgICBtYXA/OiBSYXdTb3VyY2VNYXAgfCBzdHJpbmc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzRmlsZVVSTCh1cmw6IFVSTCkge1xyXG4gICAgcmV0dXJuIHVybC5wcm90b2NvbCA9PT0gJ2ZpbGU6JztcclxufVxyXG5cclxuZnVuY3Rpb24gdHJ5Q29udmVydEFzUGF0aCh1cmw6IFVSTCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAoaXNDanNJbnRlcm9wVXJsKHVybCkpIHtcclxuICAgICAgICByZXR1cm4gdHJ5Q29udmVydEFzUGF0aChnZXRDanNJbnRlcm9wVGFyZ2V0KHVybCkpO1xyXG4gICAgfSBlbHNlIGlmIChpc0ZpbGVVUkwodXJsKSkge1xyXG4gICAgICAgIHJldHVybiBmaWxlVVJMVG9QYXRoKHVybCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNqc0ludGVyb3BVcmwodXJsOiBVUkwpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFVSTChgP2Nqc2AsIHVybCk7XHJcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxFeHRlbnNpb24gPSByZXBsYWNlRXh0ZW5zaW9uKHJlc3VsdCwgJy5tanMnKTtcclxuICAgICAgICBpZiAob3JpZ2luYWxFeHRlbnNpb24pIHtcclxuICAgICAgICAgICAgcmVzdWx0LnNlYXJjaFBhcmFtcy5hcHBlbmQoJ29yaWdpbmFsJywgb3JpZ2luYWxFeHRlbnNpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IENqc0ludGVyb3BFcnJvcih1cmwsIGVyciBhcyBFcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ2pzSW50ZXJvcFVybCh1cmw6IFVSTCkge1xyXG4gICAgcmV0dXJuIHVybC5zZWFyY2hQYXJhbXMuaGFzKCdjanMnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q2pzSW50ZXJvcFRhcmdldCh1cmw6IFVSTCkge1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gbmV3IFVSTCh1cmwuaHJlZik7XHJcbiAgICB0YXJnZXQuc2VhcmNoUGFyYW1zLmRlbGV0ZSgnY2pzJyk7XHJcbiAgICBjb25zdCBvcmlnaW5hbEV4dGVuc2lvbiA9IHRhcmdldC5zZWFyY2hQYXJhbXMuZ2V0KCdvcmlnaW5hbCcpO1xyXG4gICAgaWYgKG9yaWdpbmFsRXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgdGFyZ2V0LnNlYXJjaFBhcmFtcy5kZWxldGUoJ29yaWdpbmFsJyk7XHJcbiAgICAgICAgcmVwbGFjZUV4dGVuc2lvbih0YXJnZXQsIG9yaWdpbmFsRXh0ZW5zaW9uKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0YXJnZXQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENqc0ludGVyb3BTb3VyY2UodXJsOiBVUkwpIHtcclxuICAgIGNvbnN0IHRhcmdldCA9IGdldENqc0ludGVyb3BUYXJnZXQodXJsKTtcclxuICAgIHJldHVybiBnZXRDanNJbnRlcm9wTW9kdWxlU291cmNlKGAuLyR7dGFyZ2V0LnBhdGhuYW1lLnNwbGl0KCcvJykucG9wKCkhfWApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBub3JtYWxpemVMb2FkTWFwcGluZ3MobG9hZE1hcHBpbmdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XHJcbiAgICBjb25zdCBub3JtYWxpemVkOiBBcnJheTxbc3RyaW5nLCBSZWFkb25seTxVUkw+XT4gPSBbXTtcclxuICAgIGZvciAoY29uc3QgW2Zyb20sIHRvXSBvZiBPYmplY3QuZW50cmllcyhsb2FkTWFwcGluZ3MpKSB7XHJcbiAgICAgICAgaWYgKCFmcm9tLmVuZHNXaXRoKCcvJykgJiYgdG8uZW5kc1dpdGgoJy8nKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBsb2FkIG1hcHBpbmc6ICcke2Zyb219JzogJyR7dG99J2ApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmcm9tVVJMID0gbmV3IFVSTChmcm9tKTtcclxuICAgICAgICBjb25zdCB0b1VSTCA9IG5ldyBVUkwodG8pO1xyXG4gICAgICAgIG5vcm1hbGl6ZWQucHVzaChbZnJvbVVSTC5ocmVmLCB0b1VSTF0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5vcm1hbGl6ZWQ7XHJcbn1cclxuXHJcbmNvbnN0IHBhcnNlclBsdWdpbnM6IFBhcnNlclBsdWdpbltdID0gW1xyXG4gICAgJ2FzeW5jR2VuZXJhdG9ycycsXHJcbiAgICAnYmlnSW50JyxcclxuICAgICdjbGFzc1ByaXZhdGVNZXRob2RzJyxcclxuICAgICdjbGFzc1ByaXZhdGVQcm9wZXJ0aWVzJyxcclxuICAgICdjbGFzc1Byb3BlcnRpZXMnLFxyXG4gICAgLy8gJ2NsYXNzU3RhdGljQmxvY2snLFxyXG4gICAgJ2RlY2ltYWwnLFxyXG4gICAgLy8gJ2RlY29yYXRvcnMnLFxyXG4gICAgJ2RlY29yYXRvcnMtbGVnYWN5JyxcclxuICAgIC8vICdkb0V4cHJlc3Npb25zJyxcclxuICAgICdkeW5hbWljSW1wb3J0JyxcclxuICAgIC8vICdlc3RyZWUnLFxyXG4gICAgJ2V4cG9ydERlZmF1bHRGcm9tJyxcclxuICAgIC8vICdleHBvcnROYW1lc3BhY2VGcm9tJywgLy8gZGVwcmVjYXRlZFxyXG4gICAgLy8gJ2Zsb3cnLFxyXG4gICAgLy8gJ2Zsb3dDb21tZW50cycsXHJcbiAgICAvLyAnZnVuY3Rpb25CaW5kJyxcclxuICAgICdmdW5jdGlvblNlbnQnLFxyXG4gICAgJ2ltcG9ydE1ldGEnLFxyXG4gICAgLy8gJ2pzeCcsXHJcbiAgICAnbG9naWNhbEFzc2lnbm1lbnQnLFxyXG4gICAgLy8gJ2ltcG9ydEFzc2VydGlvbnMnLFxyXG4gICAgJ21vZHVsZVN0cmluZ05hbWVzJyxcclxuICAgICdudWxsaXNoQ29hbGVzY2luZ09wZXJhdG9yJyxcclxuICAgICdudW1lcmljU2VwYXJhdG9yJyxcclxuICAgICdvYmplY3RSZXN0U3ByZWFkJyxcclxuICAgICdvcHRpb25hbENhdGNoQmluZGluZycsXHJcbiAgICAnb3B0aW9uYWxDaGFpbmluZycsXHJcbiAgICAvLyAncGFydGlhbEFwcGxpY2F0aW9uJyxcclxuICAgIC8vICdwaXBlbGluZU9wZXJhdG9yJyxcclxuICAgICdwbGFjZWhvbGRlcnMnLFxyXG4gICAgLy8gJ3ByaXZhdGVJbicsXHJcbiAgICAvLyAndGhyb3dFeHByZXNzaW9ucycsXHJcbiAgICAndG9wTGV2ZWxBd2FpdCcsXHJcbiAgICAvLyAndHlwZXNjcmlwdCcsXHJcbiAgICAvLyAndjhpbnRyaW5zaWMnLFxyXG4gICAgLy8gWydkZWNvcmF0b3JzJywge1xyXG4gICAgLy8gICAgIGRlY29yYXRvcnNCZWZvcmVFeHBvcnQ6IHRydWUsXHJcbiAgICAvLyB9XSxcclxuICAgIC8vIFsncGlwZWxpbmVPcGVyYXRvcicsIHtcclxuICAgIC8vICAgICBwcm9wb3NhbDogJ21pbmltYWwnLFxyXG4gICAgLy8gfV0sXHJcbiAgICAvLyBbJ2Zsb3cnLCB7XHJcbiAgICAvLyAgICAgYWxsOiB0cnVlLFxyXG4gICAgLy8gfV0sXHJcbl07XHJcbiJdfQ==