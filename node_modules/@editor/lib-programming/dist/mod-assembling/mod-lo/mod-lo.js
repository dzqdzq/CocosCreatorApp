"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FetchFileError = exports.AccessDeniedError = exports.ModLo = exports.MemoryModule = void 0;
const fs_extra_1 = __importDefault(require("fs-extra"));
const babel = __importStar(require("@babel/core"));
const wrapper_1 = require("./cjs/wrapper");
const detect_1 = require("./cjs/detect");
const url_1 = require("url");
const mod_lo_builtin_mods_1 = require("./utils/mod-lo-builtin-mods");
const asserts_1 = require("../../utils/asserts");
const preset_env_1 = __importDefault(require("@babel/preset-env"));
const perf_hooks_1 = require("perf_hooks");
const url_2 = require("../utils/url");
const logger_1 = require("../utils/logger");
const plugin_annotate_ccclass_1 = __importDefault(require("../../babel/plugin-annotate-ccclass"));
const plugin_detect_circular_1 = __importDefault(require("../../babel/plugin-detect-circular"));
const esm_resolve_1 = require("./resolver/esm-resolve");
const resolve_error_1 = require("./resolver/resolve-error");
const parse_import_map_1 = require("./resolver/parse-import-map");
const cjs_resolve_1 = require("./resolver/cjs-resolve");
const specifier_1 = require("../utils/specifier");
const i18n_1 = require("../../utils/i18n");
class MemoryModule {
    constructor(source) {
        this.source = source;
    }
    get source() {
        return this._source;
    }
    set source(value) {
        this._source = value;
        this._mTimestamp = perf_hooks_1.performance.now();
    }
    get mTimestamp() {
        return this._mTimestamp;
    }
}
exports.MemoryModule = MemoryModule;
/**
 * The uniform Module Loader.
 */
class ModLo {
    constructor({ targets, loose, guessCommonJsExports, assetPrefix, _cc, cr, _internalTransform, _compressUUID, importMap, loadMappings, externals, logger, }) {
        this._uuidMap = new Map();
        this._loadMappings = [];
        this._memoryModules = {};
        this._conditions = [];
        this._targets = targets;
        this._loose = loose !== null && loose !== void 0 ? loose : false;
        this._guessCjsExports = guessCommonJsExports !== null && guessCommonJsExports !== void 0 ? guessCommonJsExports : false;
        this._assetPrefix = assetPrefix !== null && assetPrefix !== void 0 ? assetPrefix : '';
        this._cc = _cc;
        this._cr = cr;
        this._internalTransform = _internalTransform;
        this._compressUUID = _compressUUID;
        this._conditions = [...esm_resolve_1.defaultConditions];
        // TODO: verify bare or URLs
        this._externals = externals !== null && externals !== void 0 ? externals : [];
        this._logger = logger !== null && logger !== void 0 ? logger : logger_1.createLogger({});
        if (importMap) {
            this._parsedImportMap = parse_import_map_1.parseImportMap(importMap, new url_1.URL('foo:/bar'));
        }
        this._loadMappings.push(...normalizeLoadMappings(mod_lo_builtin_mods_1.modLoBuiltinLoadMappings));
        if (loadMappings) {
            this._loadMappings.push(...normalizeLoadMappings(loadMappings));
        }
        this._loadMappings.sort(([a], [b]) => a > b ? 1 : -1);
    }
    async getMTimestamp(url) {
        const loadURL = this._getLoadURL(url);
        return await this._getMtime(loadURL);
    }
    async load(url) {
        const loadURL = this._getLoadURL(url);
        const source = await this._loadSource(loadURL);
        const moduleType = await this._determinateModuleType(url);
        const metadata = { type: moduleType };
        let code;
        let map;
        if (moduleType === 'esm') {
            ({ code, map } = await this._transform(url, source, undefined));
        }
        else if (moduleType === 'cjs') {
            const cjsInfo = await this._detectCjsInfo(source, url);
            ({ code, map } = await this._transform(url, source, undefined, cjsInfo));
            metadata.cjs = {
                exports: cjsInfo.exports,
                reexports: cjsInfo.reexports,
            };
        }
        else {
            throw new Error(`Unknown module system.`);
        }
        return {
            originalSource: source,
            code,
            map,
            modLoMetadata: metadata,
        };
    }
    async resolve(specifier, from, metadata) {
        const resolved = await this._resolveUnchecked(specifier, from, metadata);
        if (!resolved.isExternal) {
            const { url } = resolved;
            if (!url.pathname.startsWith('/')) {
                throw new resolve_error_1.CanNotBeBaseURLError(url);
            }
        }
        return resolved;
    }
    async parse(code, map) {
        const inputSourceMap = typeof map === 'string' ? JSON.parse(map) : map;
        const parsed = await babel.parseAsync(code, {
            configFile: false,
            sourceType: 'module',
            inputSourceMap,
            parserOpts: {
                plugins: parserPlugins,
            },
        });
        asserts_1.assertsNonNullable(parsed);
        return parsed;
    }
    /**
     * @param externals Can be bare specifiers or URLs.
     */
    setExternals(externals) {
        this._externals.push(...externals);
    }
    addMemoryModule(url, source) {
        const urlObject = normalizeURLArg(url);
        return this._memoryModules[urlObject.href] = new MemoryModule(source);
    }
    setUUID(url, uuid) {
        assertIsURL(url);
        this._uuidMap.set(url, uuid);
    }
    unsetUUID(url) {
        assertIsURL(url);
        this._uuidMap.delete(url);
    }
    /**
     * Throws if babel transform failed.
     */
    _throwBabelReturnNull() {
        throw new Error(`Failed to transform.`);
    }
    async _getMtime(url) {
        if (url.href in this._memoryModules) {
            return this._memoryModules[url.href].mTimestamp;
        }
        const filePath = tryConvertAsPath(url);
        if (filePath) {
            let sourceMtime;
            try {
                return sourceMtime = (await fs_extra_1.default.stat(filePath)).mtimeMs;
            }
            catch (err) {
                this._logger.debug(`Failed to stat file '${url}' when get mtime:` + err);
                return 0;
            }
        }
        else {
            // TODO: may be we should relax?
            this._logger.debug(`Failed to get mtime of ${url}: not file URL`);
            return 0;
        }
    }
    _getLoadURL(url) {
        if (url.pathname.endsWith('/')) {
            asserts_1.asserts(false, `Module URL shall not ends with /.`);
            return url;
        }
        const href = url.href;
        for (const [prefix, mapped] of this._loadMappings) {
            if (href === prefix) {
                return mapped;
            }
            else if (prefix.endsWith('/') && href.startsWith(prefix)) {
                asserts_1.asserts(mapped.pathname.endsWith('/'));
                return new url_1.URL(href.substr(prefix.length), mapped);
            }
        }
        return url;
    }
    async _loadSource(url) {
        if (url.href in this._memoryModules) {
            return this._memoryModules[url.href].source;
        }
        else if (isCjsInteropUrl(url)) {
            return getCjsInteropSource(url);
        }
        else if (isFileURL(url)) {
            const path = url_1.fileURLToPath(url);
            try {
                return await fs_extra_1.default.readFile(path, 'utf8');
            }
            catch (err) {
                throw new FetchFileError(path, err);
            }
        }
        else {
            throw new AccessDeniedError(url.href);
        }
    }
    async _resolveUnchecked(specifier, from, metadata) {
        if (this._isExternal(specifier)) {
            return {
                specifierOrURL: specifier,
                isExternal: true,
            };
        }
        if (metadata.type === 'esm') {
            const resolved = await this._doEsmResolve(specifier, from, metadata);
            if (!resolved.isExternal) {
                const { url } = resolved;
                if (!isCjsInteropUrl(from) && await this._determinateModuleType(url) === 'cjs') {
                    this._logger.debug(`Create cjs interop url for '${url.href}'`);
                    const cjsInteropURL = createCjsInteropUrl(url);
                    return {
                        isExternal: false,
                        url: cjsInteropURL,
                    };
                }
            }
            return resolved;
        }
        return await this._doCjsResolve(specifier, from, metadata);
    }
    async _doEsmResolve(specifier, from, _metadata) {
        var _a;
        const stdResolved = await esm_resolve_1.esmResolve(specifier, from, {
            importMap: this._parsedImportMap,
            conditions: this._conditions,
        });
        // 对于项目脚本直接的互相导入，在标准解析的基础上，我们允许 extension-less 式的解析。
        const extensionLessResolved = this._assetPrefix && stdResolved.href.startsWith(this._assetPrefix) && from.href.startsWith(this._assetPrefix)
            ? (_a = await this._tryExtensionLessResolve(stdResolved, ['.ts'])) !== null && _a !== void 0 ? _a : stdResolved : stdResolved;
        if (extensionLessResolved.protocol === 'node:') {
            return {
                isExternal: true,
                specifierOrURL: extensionLessResolved.href,
            };
        }
        // Note: we do not have "post isExternal()"
        return {
            isExternal: false,
            url: extensionLessResolved,
        };
    }
    async _tryExtensionLessResolve(url, extensions) {
        if (await this._fileExists(url)) {
            return url;
        }
        const baseName = url.pathname.split('/').pop();
        if (!baseName || baseName === '') {
            return undefined;
        }
        for (const extension of extensions) {
            let guess;
            if (await this._fileExists(guess = new url_1.URL(`./${baseName}${extension}`, url))) {
                return guess;
            }
        }
        for (const extension of extensions) {
            let guess;
            if (await this._fileExists(guess = new url_1.URL(`./${baseName}/index${extension}`, url))) {
                return guess;
            }
        }
        return undefined;
    }
    async _doCjsResolve(specifier, from, _metadata) {
        // 如果 CommonJS 模块引用了一个不是文件 URL 的 URL，那么直接算解析成功。
        // 因为这里我们要插入 `cjs-loader` 的引用。
        // TODO：或许除了 `cjs-loader` 之外其它的都应该走 legacy resolve？
        if (!specifier_1.isRelativeSpecifier(specifier)) {
            const url = url_2.tryParseURL(specifier);
            if (url && !url_2.hasFileProtocol(url)) {
                return {
                    isExternal: false,
                    url,
                };
            }
        }
        const resolved = await cjs_resolve_1.cjsResolve(specifier, from);
        return {
            isExternal: false,
            url: resolved,
        };
    }
    _isExternal(specifierOrURL) {
        return this._externals.includes(specifierOrURL);
    }
    async _determinateModuleType(file) {
        // https://nodejs.org/api/packages.html#packages_determining_module_system
        switch (true) {
            case !isFileURL(file):
            case file.pathname.endsWith('.mjs'):
            case file.pathname.endsWith('.ts'):
            default:
                return 'esm';
            case file.pathname.endsWith('.cjs'):
                return 'cjs';
            case file.pathname.endsWith('.js'):
                const packageJson = await esm_resolve_1.readPackageScope(file);
                if ((packageJson === null || packageJson === void 0 ? void 0 : packageJson.type) === 'module') {
                    return 'esm';
                }
                else {
                    return 'cjs';
                }
        }
    }
    async _detectCjsInfo(source, _url) {
        return detect_1.detectCjsInfo(source);
    }
    async _transform(url, source, map, cjs) {
        const inputSourceMap = typeof map === 'string' ? JSON.parse(map) : map;
        const babelPresetEnvOptions = {
            modules: false,
            targets: this._targets,
            loose: this._loose,
        };
        if (this._internalTransform) {
            babelPresetEnvOptions.include = this._internalTransform.includes;
            babelPresetEnvOptions.exclude = this._internalTransform.excludes;
        }
        const babelPresets = [
            [preset_env_1.default, babelPresetEnvOptions],
        ];
        const babelPlugins = [];
        if (cjs) {
            babelPresets.push({
                plugins: [wrapper_1.wrapCjs(cjs.requires, this._guessCjsExports ? cjs.exports : [], this._guessCjsExports ? cjs.reexports : [])],
            });
        }
        else {
            babelPresets.push(this._cc);
            const uuid = this._uuidMap.get(url.href);
            if (uuid !== undefined) {
                const baseName = url_2.getBaseName(url);
                const compressedUUID = this._compressUUID(uuid);
                babelPlugins.push([plugin_annotate_ccclass_1.default, {
                        baseName,
                        compressedUUID,
                    }]);
            }
            if (this._cr && this._assetPrefix && url.href.startsWith(this._assetPrefix)) {
                babelPlugins.push([plugin_detect_circular_1.default, this._cr]);
            }
        }
        const sourceType = cjs ? 'script' : 'module';
        const babelResult = await babel.transformAsync(source, {
            code: false,
            ast: true,
            sourceType,
            inputSourceMap,
            configFile: false,
            presets: babelPresets,
            plugins: babelPlugins,
            parserOpts: {
                plugins: parserPlugins,
            },
        });
        asserts_1.asserts(babelResult);
        asserts_1.asserts(babelResult.ast);
        return {
            code: babelResult.ast,
            map: babelResult.map,
        };
    }
    async _tryStat(path) {
        try {
            return await fs_extra_1.default.stat(path);
        }
        catch (_a) {
            return new fs_extra_1.default.Stats();
        }
    }
    async _fileExists(url) {
        return (await this._tryStat(url_1.fileURLToPath(url))).isFile();
    }
}
exports.ModLo = ModLo;
class AccessDeniedError extends Error {
    constructor(url) {
        super(i18n_1.i18nTranslate('modLo_access_denied_error', { url }));
    }
}
exports.AccessDeniedError = AccessDeniedError;
class FetchFileError extends Error {
    constructor(file, err) {
        super(i18n_1.i18nTranslate('modLo_fetch_file_error', { path: file, cause: err }));
    }
}
exports.FetchFileError = FetchFileError;
function normalizeURLArg(url) {
    return typeof url === 'string' ? new url_1.URL(url) : url;
}
function assertIsURL(url) {
    asserts_1.asserts(new url_1.URL(url));
}
function isFileURL(url) {
    return url.protocol === 'file:';
}
function tryConvertAsPath(url) {
    if (isCjsInteropUrl(url)) {
        return tryConvertAsPath(getCjsInteropTarget(url));
    }
    else if (isFileURL(url)) {
        return url_1.fileURLToPath(url);
    }
}
function createCjsInteropUrl(url) {
    try {
        const result = new url_1.URL(`?cjs`, url);
        const originalExtension = url_2.replaceExtension(result, '.mjs');
        if (originalExtension) {
            result.searchParams.append('original', originalExtension);
        }
        return result;
    }
    catch (err) {
        throw new resolve_error_1.CjsInteropError(url, err);
    }
}
function isCjsInteropUrl(url) {
    return url.searchParams.has('cjs');
}
function getCjsInteropTarget(url) {
    const target = new url_1.URL(url.href);
    target.searchParams.delete('cjs');
    const originalExtension = target.searchParams.get('original');
    if (originalExtension) {
        target.searchParams.delete('original');
        url_2.replaceExtension(target, originalExtension);
    }
    return target;
}
function getCjsInteropSource(url) {
    const target = getCjsInteropTarget(url);
    return wrapper_1.getCjsInteropModuleSource(`./${target.pathname.split('/').pop()}`);
}
function normalizeLoadMappings(loadMappings) {
    const normalized = [];
    for (const [from, to] of Object.entries(loadMappings)) {
        if (!from.endsWith('/') && to.endsWith('/')) {
            throw new Error(`Bad load mapping: '${from}': '${to}'`);
        }
        const fromURL = new url_1.URL(from);
        const toURL = new url_1.URL(to);
        normalized.push([fromURL.href, toURL]);
    }
    return normalized;
}
const parserPlugins = [
    'asyncGenerators',
    'bigInt',
    'classPrivateMethods',
    'classPrivateProperties',
    'classProperties',
    // 'classStaticBlock',
    'decimal',
    // 'decorators',
    'decorators-legacy',
    // 'doExpressions',
    'dynamicImport',
    // 'estree',
    'exportDefaultFrom',
    // 'exportNamespaceFrom', // deprecated
    // 'flow',
    // 'flowComments',
    // 'functionBind',
    'functionSent',
    'importMeta',
    // 'jsx',
    'logicalAssignment',
    // 'importAssertions',
    'moduleStringNames',
    'nullishCoalescingOperator',
    'numericSeparator',
    'objectRestSpread',
    'optionalCatchBinding',
    'optionalChaining',
    // 'partialApplication',
    // 'pipelineOperator',
    'placeholders',
    // 'privateIn',
    // 'throwExpressions',
    'topLevelAwait',
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kLWxvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZC1hc3NlbWJsaW5nL21vZC1sby9tb2QtbG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLHdEQUEwQjtBQUMxQixtREFBcUM7QUFFckMsMkNBQW1FO0FBQ25FLHlDQUFzRDtBQUN0RCw2QkFBeUM7QUFDekMscUVBQXVFO0FBQ3ZFLGlEQUFrRTtBQUNsRSxtRUFBK0M7QUFDL0MsMkNBQXlDO0FBQ3pDLHNDQUF5SDtBQUN6SCw0Q0FBdUQ7QUFFdkQsa0dBQTZFO0FBQzdFLGdHQUEyRTtBQUMzRSx3REFBeUY7QUFDekYsNERBQWlGO0FBR2pGLGtFQUE2RDtBQUM3RCx3REFBb0Q7QUFDcEQsa0RBQXlEO0FBQ3pELDJDQUFpRDtBQUlqRCxNQUFhLFlBQVk7SUFDckIsWUFBWSxNQUFjO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLEtBQWE7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyx3QkFBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDVixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDNUIsQ0FBQztDQUlKO0FBcEJELG9DQW9CQztBQUVEOztHQUVHO0FBQ0gsTUFBYSxLQUFLO0lBQ2QsWUFBWSxFQUNSLE9BQU8sRUFDUCxLQUFLLEVBQ0wsb0JBQW9CLEVBQ3BCLFdBQVcsRUFDWCxHQUFHLEVBQ0gsRUFBRSxFQUNGLGtCQUFrQixFQUNsQixhQUFhLEVBQ2IsU0FBUyxFQUNULFlBQVksRUFDWixTQUFTLEVBQ1QsTUFBTSxHQUNL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LHNCQUFzQjtJQUN0QixjQUFjO0lBQ2QsZUFBZTtJQUNmLHNCQUFzQjtJQUN0QixlQUFlO0NBWWxCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBub2RlUmVzb2x2ZSBmcm9tICdyZXNvbHZlJztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBiYWJlbCBmcm9tICdAYmFiZWwvY29yZSc7XG5pbXBvcnQgeyBSYXdTb3VyY2VNYXAgfSBmcm9tICdzb3VyY2UtbWFwJztcbmltcG9ydCB7IGdldENqc0ludGVyb3BNb2R1bGVTb3VyY2UsIHdyYXBDanMgfSBmcm9tICcuL2Nqcy93cmFwcGVyJztcbmltcG9ydCB7IENqc0luZm8sIGRldGVjdENqc0luZm8gfSBmcm9tICcuL2Nqcy9kZXRlY3QnO1xuaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCwgVVJMIH0gZnJvbSAndXJsJztcbmltcG9ydCB7IG1vZExvQnVpbHRpbkxvYWRNYXBwaW5ncyB9IGZyb20gJy4vdXRpbHMvbW9kLWxvLWJ1aWx0aW4tbW9kcyc7XG5pbXBvcnQgeyBhc3NlcnRzLCBhc3NlcnRzTm9uTnVsbGFibGUgfSBmcm9tICcuLi8uLi91dGlscy9hc3NlcnRzJztcbmltcG9ydCBiYWJlbFByZXNldEVudiBmcm9tICdAYmFiZWwvcHJlc2V0LWVudic7XG5pbXBvcnQgeyBwZXJmb3JtYW5jZSB9IGZyb20gJ3BlcmZfaG9va3MnO1xuaW1wb3J0IHsgYXNzaWduUGF0aG5hbWUsIGdldEJhc2VOYW1lLCBoYXNFeHRlbnNpb24sIGhhc0ZpbGVQcm90b2NvbCwgcmVwbGFjZUV4dGVuc2lvbiwgdHJ5UGFyc2VVUkwgfSBmcm9tICcuLi91dGlscy91cmwnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyLCBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgUGFyc2VyUGx1Z2luIH0gZnJvbSAnQGJhYmVsL3BhcnNlcic7XG5pbXBvcnQgYmFiZWxQbHVnaW5Bbm5vdGF0ZUNDQ2xhc3MgZnJvbSAnLi4vLi4vYmFiZWwvcGx1Z2luLWFubm90YXRlLWNjY2xhc3MnO1xuaW1wb3J0IGJwRGV0ZWN0Q2lyY3VsYXJSZWZlcmVuY2UgZnJvbSAnLi4vLi4vYmFiZWwvcGx1Z2luLWRldGVjdC1jaXJjdWxhcic7XG5pbXBvcnQgeyBkZWZhdWx0Q29uZGl0aW9ucywgZXNtUmVzb2x2ZSwgcmVhZFBhY2thZ2VTY29wZSB9IGZyb20gJy4vcmVzb2x2ZXIvZXNtLXJlc29sdmUnO1xuaW1wb3J0IHsgQ2FuTm90QmVCYXNlVVJMRXJyb3IsIENqc0ludGVyb3BFcnJvciB9IGZyb20gJy4vcmVzb2x2ZXIvcmVzb2x2ZS1lcnJvcic7XG5pbXBvcnQgeyBJbXBvcnRNYXAgfSBmcm9tICcuL3Jlc29sdmVyL2ltcG9ydC1tYXAnO1xuaW1wb3J0IHsgUGFyc2VkSW1wb3J0TWFwIH0gZnJvbSAnLi9yZXNvbHZlci9wYXJzZWQtaW1wb3J0LW1hcCc7XG5pbXBvcnQgeyBwYXJzZUltcG9ydE1hcCB9IGZyb20gJy4vcmVzb2x2ZXIvcGFyc2UtaW1wb3J0LW1hcCc7XG5pbXBvcnQgeyBjanNSZXNvbHZlIH0gZnJvbSAnLi9yZXNvbHZlci9janMtcmVzb2x2ZSc7XG5pbXBvcnQgeyBpc1JlbGF0aXZlU3BlY2lmaWVyIH0gZnJvbSAnLi4vdXRpbHMvc3BlY2lmaWVyJztcbmltcG9ydCB7IGkxOG5UcmFuc2xhdGUgfSBmcm9tICcuLi8uLi91dGlscy9pMThuJztcblxudHlwZSBQYWNrYWdlTWV0YSA9IE5vbk51bGxhYmxlPFBhcmFtZXRlcnM8UGFyYW1ldGVyczx0eXBlb2Ygbm9kZVJlc29sdmU+WzJdPlsyXT47XG5cbmV4cG9ydCBjbGFzcyBNZW1vcnlNb2R1bGUge1xuICAgIGNvbnN0cnVjdG9yKHNvdXJjZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgIH1cblxuICAgIGdldCBzb3VyY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2U7XG4gICAgfVxuXG4gICAgc2V0IHNvdXJjZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX3NvdXJjZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLl9tVGltZXN0YW1wID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfVxuXG4gICAgZ2V0IG1UaW1lc3RhbXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tVGltZXN0YW1wO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGVjbGFyZSBfbVRpbWVzdGFtcDogTVRpbWVzdGFtcDtcbiAgICBwcml2YXRlIGRlY2xhcmUgX3NvdXJjZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRoZSB1bmlmb3JtIE1vZHVsZSBMb2FkZXIuXG4gKi9cbmV4cG9ydCBjbGFzcyBNb2RMbyB7XG4gICAgY29uc3RydWN0b3Ioe1xuICAgICAgICB0YXJnZXRzLFxuICAgICAgICBsb29zZSxcbiAgICAgICAgZ3Vlc3NDb21tb25Kc0V4cG9ydHMsXG4gICAgICAgIGFzc2V0UHJlZml4LFxuICAgICAgICBfY2MsXG4gICAgICAgIGNyLFxuICAgICAgICBfaW50ZXJuYWxUcmFuc2Zvcm0sXG4gICAgICAgIF9jb21wcmVzc1VVSUQsXG4gICAgICAgIGltcG9ydE1hcCxcbiAgICAgICAgbG9hZE1hcHBpbmdzLFxuICAgICAgICBleHRlcm5hbHMsXG4gICAgICAgIGxvZ2dlcixcbiAgICB9OiBNb2RMb09wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5fdGFyZ2V0cyA9IHRhcmdldHM7XG4gICAgICAgIHRoaXMuX2xvb3NlID0gbG9vc2UgPz8gZmFsc2U7XG4gICAgICAgIHRoaXMuX2d1ZXNzQ2pzRXhwb3J0cyA9IGd1ZXNzQ29tbW9uSnNFeHBvcnRzID8/IGZhbHNlO1xuICAgICAgICB0aGlzLl9hc3NldFByZWZpeCA9IGFzc2V0UHJlZml4ID8/ICcnO1xuICAgICAgICB0aGlzLl9jYyA9IF9jYztcbiAgICAgICAgdGhpcy5fY3IgPSBjcjtcbiAgICAgICAgdGhpcy5faW50ZXJuYWxUcmFuc2Zvcm0gPSBfaW50ZXJuYWxUcmFuc2Zvcm07XG4gICAgICAgIHRoaXMuX2NvbXByZXNzVVVJRCA9IF9jb21wcmVzc1VVSUQ7XG4gICAgICAgIHRoaXMuX2NvbmRpdGlvbnMgPSBbLi4uZGVmYXVsdENvbmRpdGlvbnNdO1xuXG4gICAgICAgIC8vIFRPRE86IHZlcmlmeSBiYXJlIG9yIFVSTHNcbiAgICAgICAgdGhpcy5fZXh0ZXJuYWxzID0gZXh0ZXJuYWxzID8/IFtdO1xuICAgICAgICB0aGlzLl9sb2dnZXIgPSBsb2dnZXIgPz8gY3JlYXRlTG9nZ2VyKHt9KTtcblxuICAgICAgICBpZiAoaW1wb3J0TWFwKSB7XG4gICAgICAgICAgICB0aGlzLl9wYXJzZWRJbXBvcnRNYXAgPSBwYXJzZUltcG9ydE1hcChpbXBvcnRNYXAsIG5ldyBVUkwoJ2ZvbzovYmFyJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbG9hZE1hcHBpbmdzLnB1c2goLi4ubm9ybWFsaXplTG9hZE1hcHBpbmdzKG1vZExvQnVpbHRpbkxvYWRNYXBwaW5ncykpO1xuICAgICAgICBpZiAobG9hZE1hcHBpbmdzKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2FkTWFwcGluZ3MucHVzaCguLi5ub3JtYWxpemVMb2FkTWFwcGluZ3MobG9hZE1hcHBpbmdzKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbG9hZE1hcHBpbmdzLnNvcnQoKFthXSwgW2JdKSA9PiBhID4gYiA/IDEgOiAtMSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldE1UaW1lc3RhbXAodXJsOiBVUkwpOiBQcm9taXNlPE1UaW1lc3RhbXA+IHtcbiAgICAgICAgY29uc3QgbG9hZFVSTCA9IHRoaXMuX2dldExvYWRVUkwodXJsKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2dldE10aW1lKGxvYWRVUkwpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBsb2FkKHVybDogVVJMKTogUHJvbWlzZTxNb2Q+IHtcbiAgICAgICAgY29uc3QgbG9hZFVSTCA9IHRoaXMuX2dldExvYWRVUkwodXJsKTtcblxuICAgICAgICBjb25zdCBzb3VyY2UgPSBhd2FpdCB0aGlzLl9sb2FkU291cmNlKGxvYWRVUkwpO1xuXG4gICAgICAgIGNvbnN0IG1vZHVsZVR5cGUgPSBhd2FpdCB0aGlzLl9kZXRlcm1pbmF0ZU1vZHVsZVR5cGUodXJsKTtcblxuICAgICAgICBjb25zdCBtZXRhZGF0YTogTW9kTG9NZXRhZGF0YSA9IHsgdHlwZTogbW9kdWxlVHlwZSB9O1xuICAgICAgICBsZXQgY29kZTogU291cmNlO1xuICAgICAgICBsZXQgbWFwOiBSYXdTb3VyY2VNYXAgfCBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKG1vZHVsZVR5cGUgPT09ICdlc20nKSB7XG4gICAgICAgICAgICAoeyBjb2RlLCBtYXAgfSA9IGF3YWl0IHRoaXMuX3RyYW5zZm9ybSh1cmwsIHNvdXJjZSwgdW5kZWZpbmVkKSk7XG4gICAgICAgIH0gZWxzZSBpZiAobW9kdWxlVHlwZSA9PT0gJ2NqcycpIHtcbiAgICAgICAgICAgIGNvbnN0IGNqc0luZm86IFJlYWRvbmx5PENqc0luZm8+ID0gYXdhaXQgdGhpcy5fZGV0ZWN0Q2pzSW5mbyhzb3VyY2UsIHVybCk7XG4gICAgICAgICAgICAoeyBjb2RlLCBtYXAgfSA9IGF3YWl0IHRoaXMuX3RyYW5zZm9ybShcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgc291cmNlLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCwgY2pzSW5mbyxcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgbWV0YWRhdGEuY2pzID0ge1xuICAgICAgICAgICAgICAgIGV4cG9ydHM6IGNqc0luZm8uZXhwb3J0cyxcbiAgICAgICAgICAgICAgICByZWV4cG9ydHM6IGNqc0luZm8ucmVleHBvcnRzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBtb2R1bGUgc3lzdGVtLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9yaWdpbmFsU291cmNlOiBzb3VyY2UsXG4gICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgbWFwLFxuICAgICAgICAgICAgbW9kTG9NZXRhZGF0YTogbWV0YWRhdGEsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHJlc29sdmUoc3BlY2lmaWVyOiBzdHJpbmcsIGZyb206IFVSTCwgbWV0YWRhdGE6IE1vZExvTWV0YWRhdGEpOiBQcm9taXNlPFJlc29sdmVSZXN1bHQ+IHtcbiAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCB0aGlzLl9yZXNvbHZlVW5jaGVja2VkKHNwZWNpZmllciwgZnJvbSwgbWV0YWRhdGEpO1xuXG4gICAgICAgIGlmICghcmVzb2x2ZWQuaXNFeHRlcm5hbCkge1xuICAgICAgICAgICAgY29uc3QgeyB1cmwgfSA9IHJlc29sdmVkO1xuICAgICAgICAgICAgaWYgKCF1cmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnLycpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IENhbk5vdEJlQmFzZVVSTEVycm9yKHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzb2x2ZWQ7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHBhcnNlKGNvZGU6IHN0cmluZywgbWFwPzogU291cmNlTWFwKSB7XG4gICAgICAgIGNvbnN0IGlucHV0U291cmNlTWFwID0gdHlwZW9mIG1hcCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKG1hcCkgOiBtYXA7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IGJhYmVsLnBhcnNlQXN5bmMoY29kZSwge1xuICAgICAgICAgICAgY29uZmlnRmlsZTogZmFsc2UsXG4gICAgICAgICAgICBzb3VyY2VUeXBlOiAnbW9kdWxlJyxcbiAgICAgICAgICAgIGlucHV0U291cmNlTWFwLFxuICAgICAgICAgICAgcGFyc2VyT3B0czoge1xuICAgICAgICAgICAgICAgIHBsdWdpbnM6IHBhcnNlclBsdWdpbnMsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgYXNzZXJ0c05vbk51bGxhYmxlKHBhcnNlZCk7XG4gICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGV4dGVybmFscyBDYW4gYmUgYmFyZSBzcGVjaWZpZXJzIG9yIFVSTHMuXG4gICAgICovXG4gICAgcHVibGljIHNldEV4dGVybmFscyhleHRlcm5hbHM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHRoaXMuX2V4dGVybmFscy5wdXNoKC4uLmV4dGVybmFscyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZE1lbW9yeU1vZHVsZSh1cmw6IFJlYWRvbmx5PFVSTD4gfCBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHVybE9iamVjdCA9IG5vcm1hbGl6ZVVSTEFyZyh1cmwpO1xuICAgICAgICByZXR1cm4gdGhpcy5fbWVtb3J5TW9kdWxlc1t1cmxPYmplY3QuaHJlZl0gPSBuZXcgTWVtb3J5TW9kdWxlKHNvdXJjZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFVVSUQodXJsOiBzdHJpbmcsIHV1aWQ6IHN0cmluZykge1xuICAgICAgICBhc3NlcnRJc1VSTCh1cmwpO1xuICAgICAgICB0aGlzLl91dWlkTWFwLnNldCh1cmwsIHV1aWQpO1xuICAgIH1cblxuICAgIHB1YmxpYyB1bnNldFVVSUQodXJsOiBzdHJpbmcpIHtcbiAgICAgICAgYXNzZXJ0SXNVUkwodXJsKTtcbiAgICAgICAgdGhpcy5fdXVpZE1hcC5kZWxldGUodXJsKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaHJvd3MgaWYgYmFiZWwgdHJhbnNmb3JtIGZhaWxlZC5cbiAgICAgKi9cbiAgICBwcml2YXRlIF90aHJvd0JhYmVsUmV0dXJuTnVsbCgpOiBuZXZlciB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHRyYW5zZm9ybS5gKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9nZXRNdGltZSh1cmw6IFVSTCk6IFByb21pc2U8TVRpbWVzdGFtcD4ge1xuICAgICAgICBpZiAodXJsLmhyZWYgaW4gdGhpcy5fbWVtb3J5TW9kdWxlcykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lbW9yeU1vZHVsZXNbdXJsLmhyZWZdLm1UaW1lc3RhbXA7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHRyeUNvbnZlcnRBc1BhdGgodXJsKTtcbiAgICAgICAgaWYgKGZpbGVQYXRoKSB7XG4gICAgICAgICAgICBsZXQgc291cmNlTXRpbWU6IG51bWJlcjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZU10aW1lID0gKGF3YWl0IGZzLnN0YXQoZmlsZVBhdGgpKS5tdGltZU1zO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKGBGYWlsZWQgdG8gc3RhdCBmaWxlICcke3VybH0nIHdoZW4gZ2V0IG10aW1lOmAgKyBlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVE9ETzogbWF5IGJlIHdlIHNob3VsZCByZWxheD9cbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgRmFpbGVkIHRvIGdldCBtdGltZSBvZiAke3VybH06IG5vdCBmaWxlIFVSTGApO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9nZXRMb2FkVVJMKHVybDogVVJMKSB7XG4gICAgICAgIGlmICh1cmwucGF0aG5hbWUuZW5kc1dpdGgoJy8nKSkge1xuICAgICAgICAgICAgYXNzZXJ0cyhmYWxzZSwgYE1vZHVsZSBVUkwgc2hhbGwgbm90IGVuZHMgd2l0aCAvLmApO1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBocmVmID0gdXJsLmhyZWY7XG4gICAgICAgIGZvciAoY29uc3QgW3ByZWZpeCwgbWFwcGVkXSBvZiB0aGlzLl9sb2FkTWFwcGluZ3MpIHtcbiAgICAgICAgICAgIGlmIChocmVmID09PSBwcmVmaXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFwcGVkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwcmVmaXguZW5kc1dpdGgoJy8nKSAmJiBocmVmLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgICAgICAgICAgIGFzc2VydHMobWFwcGVkLnBhdGhuYW1lLmVuZHNXaXRoKCcvJykpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVVJMKGhyZWYuc3Vic3RyKHByZWZpeC5sZW5ndGgpLCBtYXBwZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfbG9hZFNvdXJjZSh1cmw6IFVSTCkge1xuICAgICAgICBpZiAodXJsLmhyZWYgaW4gdGhpcy5fbWVtb3J5TW9kdWxlcykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lbW9yeU1vZHVsZXNbdXJsLmhyZWZdLnNvdXJjZTtcbiAgICAgICAgfSBlbHNlIGlmIChpc0Nqc0ludGVyb3BVcmwodXJsKSkge1xuICAgICAgICAgICAgcmV0dXJuIGdldENqc0ludGVyb3BTb3VyY2UodXJsKTtcbiAgICAgICAgfSBlbHNlIGlmIChpc0ZpbGVVUkwodXJsKSkge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGZpbGVVUkxUb1BhdGgodXJsKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGZzLnJlYWRGaWxlKHBhdGgsICd1dGY4Jyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmV0Y2hGaWxlRXJyb3IocGF0aCwgZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBBY2Nlc3NEZW5pZWRFcnJvcih1cmwuaHJlZik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9yZXNvbHZlVW5jaGVja2VkKHNwZWNpZmllcjogc3RyaW5nLCBmcm9tOiBVUkwsIG1ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XG4gICAgICAgIGlmICh0aGlzLl9pc0V4dGVybmFsKHNwZWNpZmllcikpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3BlY2lmaWVyT3JVUkw6IHNwZWNpZmllcixcbiAgICAgICAgICAgICAgICBpc0V4dGVybmFsOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtZXRhZGF0YS50eXBlID09PSAnZXNtJykge1xuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCB0aGlzLl9kb0VzbVJlc29sdmUoc3BlY2lmaWVyLCBmcm9tLCBtZXRhZGF0YSk7XG4gICAgICAgICAgICBpZiAoIXJlc29sdmVkLmlzRXh0ZXJuYWwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHVybCB9ID0gcmVzb2x2ZWQ7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0Nqc0ludGVyb3BVcmwoZnJvbSkgJiYgYXdhaXQgdGhpcy5fZGV0ZXJtaW5hdGVNb2R1bGVUeXBlKHVybCkgPT09ICdjanMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgQ3JlYXRlIGNqcyBpbnRlcm9wIHVybCBmb3IgJyR7dXJsLmhyZWZ9J2ApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjanNJbnRlcm9wVVJMID0gY3JlYXRlQ2pzSW50ZXJvcFVybCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNFeHRlcm5hbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGNqc0ludGVyb3BVUkwsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2RvQ2pzUmVzb2x2ZShzcGVjaWZpZXIsIGZyb20sIG1ldGFkYXRhKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9kb0VzbVJlc29sdmUoc3BlY2lmaWVyOiBzdHJpbmcsIGZyb206IFVSTCwgX21ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XG4gICAgICAgIGNvbnN0IHN0ZFJlc29sdmVkID0gYXdhaXQgZXNtUmVzb2x2ZShzcGVjaWZpZXIsIGZyb20sIHtcbiAgICAgICAgICAgIGltcG9ydE1hcDogdGhpcy5fcGFyc2VkSW1wb3J0TWFwLFxuICAgICAgICAgICAgY29uZGl0aW9uczogdGhpcy5fY29uZGl0aW9ucyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g5a+55LqO6aG555uu6ISa5pys55u05o6l55qE5LqS55u45a+85YWl77yM5Zyo5qCH5YeG6Kej5p6Q55qE5Z+656GA5LiK77yM5oiR5Lus5YWB6K64IGV4dGVuc2lvbi1sZXNzIOW8j+eahOino+aekOOAglxuICAgICAgICBjb25zdCBleHRlbnNpb25MZXNzUmVzb2x2ZWQgPVxuICAgICAgICAgICAgdGhpcy5fYXNzZXRQcmVmaXggJiYgc3RkUmVzb2x2ZWQuaHJlZi5zdGFydHNXaXRoKHRoaXMuX2Fzc2V0UHJlZml4KSAmJiBmcm9tLmhyZWYuc3RhcnRzV2l0aCh0aGlzLl9hc3NldFByZWZpeClcbiAgICAgICAgICAgICAgICA/IGF3YWl0IHRoaXMuX3RyeUV4dGVuc2lvbkxlc3NSZXNvbHZlKHN0ZFJlc29sdmVkLCBbJy50cyddKSA/PyBzdGRSZXNvbHZlZFxuICAgICAgICAgICAgICAgIDogc3RkUmVzb2x2ZWQ7XG5cbiAgICAgICAgaWYgKGV4dGVuc2lvbkxlc3NSZXNvbHZlZC5wcm90b2NvbCA9PT0gJ25vZGU6Jykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpc0V4dGVybmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNwZWNpZmllck9yVVJMOiBleHRlbnNpb25MZXNzUmVzb2x2ZWQuaHJlZixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb3RlOiB3ZSBkbyBub3QgaGF2ZSBcInBvc3QgaXNFeHRlcm5hbCgpXCJcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNFeHRlcm5hbDogZmFsc2UsXG4gICAgICAgICAgICB1cmw6IGV4dGVuc2lvbkxlc3NSZXNvbHZlZCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF90cnlFeHRlbnNpb25MZXNzUmVzb2x2ZSh1cmw6IFVSTCwgZXh0ZW5zaW9uczogcmVhZG9ubHkgc3RyaW5nW10pIHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuX2ZpbGVFeGlzdHModXJsKSkge1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBiYXNlTmFtZSA9IHVybC5wYXRobmFtZS5zcGxpdCgnLycpLnBvcCgpO1xuICAgICAgICBpZiAoIWJhc2VOYW1lIHx8IGJhc2VOYW1lID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGV4dGVuc2lvbiBvZiBleHRlbnNpb25zKSB7XG4gICAgICAgICAgICBsZXQgZ3Vlc3M6IFVSTDtcbiAgICAgICAgICAgIGlmIChhd2FpdCB0aGlzLl9maWxlRXhpc3RzKGd1ZXNzID0gbmV3IFVSTChgLi8ke2Jhc2VOYW1lfSR7ZXh0ZW5zaW9ufWAsIHVybCkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGd1ZXNzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZXh0ZW5zaW9uIG9mIGV4dGVuc2lvbnMpIHtcbiAgICAgICAgICAgIGxldCBndWVzczogVVJMO1xuICAgICAgICAgICAgaWYgKGF3YWl0IHRoaXMuX2ZpbGVFeGlzdHMoZ3Vlc3MgPSBuZXcgVVJMKGAuLyR7YmFzZU5hbWV9L2luZGV4JHtleHRlbnNpb259YCwgdXJsKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3Vlc3M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9kb0Nqc1Jlc29sdmUoc3BlY2lmaWVyOiBzdHJpbmcsIGZyb206IFVSTCwgX21ldGFkYXRhOiBNb2RMb01ldGFkYXRhKTogUHJvbWlzZTxSZXNvbHZlUmVzdWx0PiB7XG4gICAgICAgIC8vIOWmguaenCBDb21tb25KUyDmqKHlnZflvJXnlKjkuobkuIDkuKrkuI3mmK/mlofku7YgVVJMIOeahCBVUkzvvIzpgqPkuYjnm7TmjqXnrpfop6PmnpDmiJDlip/jgIJcbiAgICAgICAgLy8g5Zug5Li66L+Z6YeM5oiR5Lus6KaB5o+S5YWlIGBjanMtbG9hZGVyYCDnmoTlvJXnlKjjgIJcbiAgICAgICAgLy8gVE9ET++8muaIluiuuOmZpOS6hiBgY2pzLWxvYWRlcmAg5LmL5aSW5YW25a6D55qE6YO95bqU6K+l6LWwIGxlZ2FjeSByZXNvbHZl77yfXG4gICAgICAgIGlmICghaXNSZWxhdGl2ZVNwZWNpZmllcihzcGVjaWZpZXIpKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSB0cnlQYXJzZVVSTChzcGVjaWZpZXIpO1xuICAgICAgICAgICAgaWYgKHVybCAmJiAhaGFzRmlsZVByb3RvY29sKHVybCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBpc0V4dGVybmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXNvbHZlZCA9IGF3YWl0IGNqc1Jlc29sdmUoc3BlY2lmaWVyLCBmcm9tKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzRXh0ZXJuYWw6IGZhbHNlLFxuICAgICAgICAgICAgdXJsOiByZXNvbHZlZCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9pc0V4dGVybmFsKHNwZWNpZmllck9yVVJMOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V4dGVybmFscy5pbmNsdWRlcyhzcGVjaWZpZXJPclVSTCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZGV0ZXJtaW5hdGVNb2R1bGVUeXBlKGZpbGU6IFVSTCkge1xuICAgICAgICAvLyBodHRwczovL25vZGVqcy5vcmcvYXBpL3BhY2thZ2VzLmh0bWwjcGFja2FnZXNfZGV0ZXJtaW5pbmdfbW9kdWxlX3N5c3RlbVxuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgIWlzRmlsZVVSTChmaWxlKTpcbiAgICAgICAgICAgIGNhc2UgZmlsZS5wYXRobmFtZS5lbmRzV2l0aCgnLm1qcycpOlxuICAgICAgICAgICAgY2FzZSBmaWxlLnBhdGhuYW1lLmVuZHNXaXRoKCcudHMnKTpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdlc20nO1xuICAgICAgICAgICAgY2FzZSBmaWxlLnBhdGhuYW1lLmVuZHNXaXRoKCcuY2pzJyk6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdjanMnO1xuICAgICAgICAgICAgY2FzZSBmaWxlLnBhdGhuYW1lLmVuZHNXaXRoKCcuanMnKTpcbiAgICAgICAgICAgICAgICBjb25zdCBwYWNrYWdlSnNvbiA9IGF3YWl0IHJlYWRQYWNrYWdlU2NvcGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKHBhY2thZ2VKc29uPy50eXBlID09PSAnbW9kdWxlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2VzbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdjanMnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2RldGVjdENqc0luZm8oc291cmNlOiBzdHJpbmcsIF91cmw6IFVSTCkge1xuICAgICAgICByZXR1cm4gZGV0ZWN0Q2pzSW5mbyhzb3VyY2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX3RyYW5zZm9ybShcbiAgICAgICAgdXJsOiBVUkwsXG4gICAgICAgIHNvdXJjZTogc3RyaW5nLFxuICAgICAgICBtYXA/OiBSYXdTb3VyY2VNYXAgfCBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgICAgIGNqcz86IFJlYWRvbmx5PENqc0luZm8+LFxuICAgICk6IFByb21pc2U8VHJhbnNmb3JtUmVzdWx0PiB7XG4gICAgICAgIGNvbnN0IGlucHV0U291cmNlTWFwID0gdHlwZW9mIG1hcCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKG1hcCkgOiBtYXA7XG5cbiAgICAgICAgY29uc3QgYmFiZWxQcmVzZXRFbnZPcHRpb25zOiBiYWJlbFByZXNldEVudi5PcHRpb25zID0ge1xuICAgICAgICAgICAgbW9kdWxlczogZmFsc2UsXG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLl90YXJnZXRzLFxuICAgICAgICAgICAgbG9vc2U6IHRoaXMuX2xvb3NlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5faW50ZXJuYWxUcmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIGJhYmVsUHJlc2V0RW52T3B0aW9ucy5pbmNsdWRlID0gdGhpcy5faW50ZXJuYWxUcmFuc2Zvcm0uaW5jbHVkZXM7XG4gICAgICAgICAgICBiYWJlbFByZXNldEVudk9wdGlvbnMuZXhjbHVkZSA9IHRoaXMuX2ludGVybmFsVHJhbnNmb3JtLmV4Y2x1ZGVzO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYmFiZWxQcmVzZXRzOiBiYWJlbC5QbHVnaW5JdGVtW10gPSBbXG4gICAgICAgICAgICBbYmFiZWxQcmVzZXRFbnYsIGJhYmVsUHJlc2V0RW52T3B0aW9uc10sXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgYmFiZWxQbHVnaW5zOiBiYWJlbC5QbHVnaW5JdGVtW10gPSBbXTtcblxuICAgICAgICBpZiAoY2pzKSB7XG4gICAgICAgICAgICBiYWJlbFByZXNldHMucHVzaCh7XG4gICAgICAgICAgICAgICAgcGx1Z2luczogW3dyYXBDanMoXG4gICAgICAgICAgICAgICAgICAgIGNqcy5yZXF1aXJlcyxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ3Vlc3NDanNFeHBvcnRzID8gY2pzLmV4cG9ydHMgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ3Vlc3NDanNFeHBvcnRzID8gY2pzLnJlZXhwb3J0cyA6IFtdLFxuICAgICAgICAgICAgICAgICldLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBiYWJlbFByZXNldHMucHVzaCh0aGlzLl9jYyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHV1aWQgPSB0aGlzLl91dWlkTWFwLmdldCh1cmwuaHJlZik7XG4gICAgICAgICAgICBpZiAodXVpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBnZXRCYXNlTmFtZSh1cmwpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRVVUlEID0gdGhpcy5fY29tcHJlc3NVVUlEKHV1aWQpO1xuICAgICAgICAgICAgICAgIGJhYmVsUGx1Z2lucy5wdXNoKFtiYWJlbFBsdWdpbkFubm90YXRlQ0NDbGFzcywge1xuICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZFVVSUQsXG4gICAgICAgICAgICAgICAgfSBhcyBiYWJlbFBsdWdpbkFubm90YXRlQ0NDbGFzcy5PcHRpb25zXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9jciAmJiB0aGlzLl9hc3NldFByZWZpeCAmJiB1cmwuaHJlZi5zdGFydHNXaXRoKHRoaXMuX2Fzc2V0UHJlZml4KSkge1xuICAgICAgICAgICAgICAgIGJhYmVsUGx1Z2lucy5wdXNoKFticERldGVjdENpcmN1bGFyUmVmZXJlbmNlLCB0aGlzLl9jcl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc291cmNlVHlwZSA9IGNqcyA/ICdzY3JpcHQnIDogJ21vZHVsZSc7XG4gICAgICAgIGNvbnN0IGJhYmVsUmVzdWx0ID0gYXdhaXQgYmFiZWwudHJhbnNmb3JtQXN5bmMoc291cmNlLCB7XG4gICAgICAgICAgICBjb2RlOiBmYWxzZSxcbiAgICAgICAgICAgIGFzdDogdHJ1ZSxcbiAgICAgICAgICAgIHNvdXJjZVR5cGUsXG4gICAgICAgICAgICBpbnB1dFNvdXJjZU1hcCxcbiAgICAgICAgICAgIGNvbmZpZ0ZpbGU6IGZhbHNlLFxuICAgICAgICAgICAgcHJlc2V0czogYmFiZWxQcmVzZXRzLFxuICAgICAgICAgICAgcGx1Z2luczogYmFiZWxQbHVnaW5zLFxuICAgICAgICAgICAgcGFyc2VyT3B0czoge1xuICAgICAgICAgICAgICAgIHBsdWdpbnM6IHBhcnNlclBsdWdpbnMsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgYXNzZXJ0cyhiYWJlbFJlc3VsdCk7XG4gICAgICAgIGFzc2VydHMoYmFiZWxSZXN1bHQuYXN0KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvZGU6IGJhYmVsUmVzdWx0LmFzdCxcbiAgICAgICAgICAgIG1hcDogYmFiZWxSZXN1bHQubWFwIGFzIFJhd1NvdXJjZU1hcCB8IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF90cnlTdGF0KHBhdGg6IHN0cmluZykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGZzLnN0YXQocGF0aCk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBmcy5TdGF0cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZmlsZUV4aXN0cyh1cmw6IFVSTCkge1xuICAgICAgICByZXR1cm4gKGF3YWl0IHRoaXMuX3RyeVN0YXQoZmlsZVVSTFRvUGF0aCh1cmwpKSkuaXNGaWxlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfbG9nZ2VyOiBMb2dnZXI7XG4gICAgcHJpdmF0ZSBfdGFyZ2V0cz86IEJyb3dzZXJzTGlzdFRhcmdldHM7XG4gICAgcHJpdmF0ZSBfbG9vc2U6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBfYXNzZXRQcmVmaXg6IHN0cmluZztcbiAgICBwcml2YXRlIF9ndWVzc0Nqc0V4cG9ydHM6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBfY2M6IGltcG9ydCgnQGJhYmVsL2NvcmUnKS5QbHVnaW5JdGVtO1xuICAgIHByaXZhdGUgX2NyPzogYnBEZXRlY3RDaXJjdWxhclJlZmVyZW5jZS5PcHRpb25zO1xuICAgIHByaXZhdGUgX2NvbXByZXNzVVVJRDogKHV1aWQ6IHN0cmluZykgPT4gc3RyaW5nO1xuICAgIHByaXZhdGUgX3V1aWRNYXA6IE1hcDxzdHJpbmcsIHN0cmluZz4gPSBuZXcgTWFwKCk7XG4gICAgcHJpdmF0ZSBfaW50ZXJuYWxUcmFuc2Zvcm0/OiBJbnRlcm5hbFRyYW5zZm9ybU9wdGlvbnM7XG4gICAgcHJpdmF0ZSBfZXh0ZXJuYWxzOiBBcnJheTxzdHJpbmc+O1xuICAgIHByaXZhdGUgX2xvYWRNYXBwaW5nczogQXJyYXk8W3N0cmluZywgVVJMXT4gPSBbXTtcbiAgICBwcml2YXRlIF9wYXJzZWRJbXBvcnRNYXA6IFBhcnNlZEltcG9ydE1hcCB8IHVuZGVmaW5lZDtcbiAgICBwcml2YXRlIF9tZW1vcnlNb2R1bGVzOiBSZWNvcmQ8c3RyaW5nLCBNZW1vcnlNb2R1bGU+ID0ge307XG4gICAgcHJpdmF0ZSBfY29uZGl0aW9uczogcmVhZG9ubHkgc3RyaW5nW10gPSBbXTtcbn1cblxuZXhwb3J0IGNsYXNzIEFjY2Vzc0RlbmllZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHVybDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKGkxOG5UcmFuc2xhdGUoJ21vZExvX2FjY2Vzc19kZW5pZWRfZXJyb3InLCB7IHVybCB9KSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmV0Y2hGaWxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IoZmlsZTogc3RyaW5nLCBlcnI6IEVycm9yKSB7XG4gICAgICAgIHN1cGVyKGkxOG5UcmFuc2xhdGUoJ21vZExvX2ZldGNoX2ZpbGVfZXJyb3InLCB7IHBhdGg6IGZpbGUsIGNhdXNlOiBlcnIgfSkpO1xuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RMb09wdGlvbnMge1xuICAgIHRhcmdldHM/OiBCcm93c2Vyc0xpc3RUYXJnZXRzO1xuXG4gICAgbG9vc2U/OiBib29sZWFuO1xuXG4gICAgZ3Vlc3NDb21tb25Kc0V4cG9ydHM/OiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICog562b6YCJ5ZOq5Lqb5piv5bGe5LqOIGFzc2V0IOexu+Wei+eahOaooeWdl+OAglxuICAgICAqL1xuICAgIGFzc2V0UHJlZml4Pzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICog5YaF6YOo5L2/55So44CC5Lul5ZCO5Y+v6IO96LCD5pW044CCXG4gICAgICogQmFiZWwgcHJlc2V0IGBAY29jb3MvYmFiZWwtcHJlc2V0LWNjYCDmj5Lku7bku6Xlj4rlroPnmoTpgInpobnjgIJcbiAgICAgKi9cbiAgICBfY2M6IGltcG9ydCgnQGJhYmVsL2NvcmUnKS5QbHVnaW5JdGVtO1xuXG4gICAgLyoqXG4gICAgICog5b6q546v5byV55So5qOA5rWL6YCJ6aG544CC5Y+q5Lya5a+5IGFzc2V0IOexu+Wei+eahOaooeWdl+eUn+aViOOAglxuICAgICAqL1xuICAgIGNyPzogYnBEZXRlY3RDaXJjdWxhclJlZmVyZW5jZS5PcHRpb25zO1xuXG4gICAgLyoqXG4gICAgICog5YaF6YOo5L2/55So44CC5Lul5ZCO5Y+v6IO96LCD5pW044CCXG4gICAgICovXG4gICAgX2NvbXByZXNzVVVJRDogKHV1aWQ6IHN0cmluZykgPT4gc3RyaW5nO1xuXG4gICAgX2ludGVybmFsVHJhbnNmb3JtPzogSW50ZXJuYWxUcmFuc2Zvcm1PcHRpb25zO1xuXG4gICAgLyoqXG4gICAgICogSW1wb3J0IG1hcOOAglxuICAgICAqL1xuICAgIGltcG9ydE1hcD86IEltcG9ydE1hcDtcblxuICAgIC8qKlxuICAgICAqIOWwhuS4gOS6myBVUkwg5pig5bCE5Yiw5Y+m5LiA5LqbIFVSTOOAguS4u+imgeeUqOS6juaYoOWwhOS4gOS6myBVUkwg5Yiw5paH5Lu257O757uf5LiK44CCXG4gICAgICog5rOo5oSP77yaXG4gICAgICogLSDov5nkuKrlkowgaW1wb3J0IG1hcCDkuI3lkIzjgILlroPkuI3kvJrmlLnlj5jmqKHlnZfnmoQgVVJM77yM5Y+q5Lya5Zyo5Yqg6L295qih5Z2X5rqQ56CB5pe26L2s6ICM5Y675Yqg6L295paH5Lu257O757uf5LiK55qE44CCXG4gICAgICogLSDplK7lkozlgLzopoHkuYjpg73ku6UgLyDnu5PlsL7vvIzopoHkuYjpg73kuI3ku6UgLyDnu5PlsL7jgILlpoLmnpzku6UgLyDnu5PlsL7ooajnpLrmlbTkuKrnm67lvZXmmKDlsITjgIJcbiAgICAgKi9cbiAgICBsb2FkTWFwcGluZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuXG4gICAgLyoqXG4gICAgICogQ2FuIGJlIGJhcmUgc3BlY2lmaWVycyBvciBVUkxzLlxuICAgICAqL1xuICAgIGV4dGVybmFscz86IHN0cmluZ1tdO1xuXG4gICAgLyoqXG4gICAgICogTG9nZ2VyLlxuICAgICAqL1xuICAgIGxvZ2dlcj86IExvZ2dlcjtcbn1cblxuZXhwb3J0IHR5cGUgQXN0ID0gYmFiZWwudHlwZXMuRmlsZSB8IGJhYmVsLnR5cGVzLlByb2dyYW07XG5cbmV4cG9ydCB0eXBlIFNvdXJjZSA9IHN0cmluZyB8IEFzdDtcblxuZXhwb3J0IHR5cGUgQnJvd3NlcnNMaXN0VGFyZ2V0cyA9IHN0cmluZyB8IHN0cmluZ1tdIHwgUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuZXhwb3J0IHR5cGUgeyBJbXBvcnRNYXAgfTtcblxuaW50ZXJmYWNlIEludGVybmFsVHJhbnNmb3JtT3B0aW9ucyB7XG4gICAgZXhjbHVkZXM/OiBBcnJheTxSZWdFeHAgfHN0cmluZz47XG4gICAgaW5jbHVkZXM/OiBBcnJheTxSZWdFeHAgfHN0cmluZz47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kIHtcbiAgICBvcmlnaW5hbFNvdXJjZTogc3RyaW5nO1xuICAgIGNvZGU6IFNvdXJjZTtcbiAgICBtYXA/OiBTb3VyY2VNYXA7XG4gICAgbW9kTG9NZXRhZGF0YTogTW9kTG9NZXRhZGF0YTtcbn1cblxudHlwZSBNYXliZVByb21pc2VkPFQ+PSBUIHwgUHJvbWlzZTxUPjtcblxuLyoqXG4gKiBTdGFtcCB0byBpbmRpY2F0ZSB3aGV0aGVyIHRoZSBtb2R1bGUgc291cmNlIGlzIGV4cGlyZWQuXG4gKi9cbmV4cG9ydCB0eXBlIE1UaW1lc3RhbXAgPSBudW1iZXI7XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVSZXN1bHQgPSB7XG4gICAgaXNFeHRlcm5hbDogZmFsc2U7XG4gICAgdXJsOiBVUkxcbn0gfCB7XG4gICAgaXNFeHRlcm5hbDogdHJ1ZTtcbiAgICBzcGVjaWZpZXJPclVSTDogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgU291cmNlTWFwID0gUmF3U291cmNlTWFwIHwgc3RyaW5nO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1vZExvTWV0YWRhdGEge1xuICAgIHR5cGU6ICdlc20nIHwgJ2Nqcyc7XG4gICAgY2pzPzoge1xuICAgICAgICBleHBvcnRzOiBzdHJpbmdbXTtcbiAgICAgICAgcmVleHBvcnRzOiBzdHJpbmdbXTtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVVUkxBcmcodXJsOiBzdHJpbmcgfCBSZWFkb25seTxVUkw+KSB7XG4gICAgcmV0dXJuIHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnID8gbmV3IFVSTCh1cmwpIDogdXJsO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRJc1VSTCh1cmw6IHN0cmluZykge1xuICAgIGFzc2VydHMobmV3IFVSTCh1cmwpKTtcbn1cblxuaW50ZXJmYWNlIFRyYW5zZm9ybVJlc3VsdCB7XG4gICAgY29kZTogU291cmNlO1xuICAgIG1hcD86IFJhd1NvdXJjZU1hcCB8IHN0cmluZztcbn1cblxuZnVuY3Rpb24gaXNGaWxlVVJMKHVybDogVVJMKSB7XG4gICAgcmV0dXJuIHVybC5wcm90b2NvbCA9PT0gJ2ZpbGU6Jztcbn1cblxuZnVuY3Rpb24gdHJ5Q29udmVydEFzUGF0aCh1cmw6IFVSTCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKGlzQ2pzSW50ZXJvcFVybCh1cmwpKSB7XG4gICAgICAgIHJldHVybiB0cnlDb252ZXJ0QXNQYXRoKGdldENqc0ludGVyb3BUYXJnZXQodXJsKSk7XG4gICAgfSBlbHNlIGlmIChpc0ZpbGVVUkwodXJsKSkge1xuICAgICAgICByZXR1cm4gZmlsZVVSTFRvUGF0aCh1cmwpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2pzSW50ZXJvcFVybCh1cmw6IFVSTCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBVUkwoYD9janNgLCB1cmwpO1xuICAgICAgICBjb25zdCBvcmlnaW5hbEV4dGVuc2lvbiA9IHJlcGxhY2VFeHRlbnNpb24ocmVzdWx0LCAnLm1qcycpO1xuICAgICAgICBpZiAob3JpZ2luYWxFeHRlbnNpb24pIHtcbiAgICAgICAgICAgIHJlc3VsdC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdvcmlnaW5hbCcsIG9yaWdpbmFsRXh0ZW5zaW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aHJvdyBuZXcgQ2pzSW50ZXJvcEVycm9yKHVybCwgZXJyKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGlzQ2pzSW50ZXJvcFVybCh1cmw6IFVSTCkge1xuICAgIHJldHVybiB1cmwuc2VhcmNoUGFyYW1zLmhhcygnY2pzJyk7XG59XG5cbmZ1bmN0aW9uIGdldENqc0ludGVyb3BUYXJnZXQodXJsOiBVUkwpIHtcbiAgICBjb25zdCB0YXJnZXQgPSBuZXcgVVJMKHVybC5ocmVmKTtcbiAgICB0YXJnZXQuc2VhcmNoUGFyYW1zLmRlbGV0ZSgnY2pzJyk7XG4gICAgY29uc3Qgb3JpZ2luYWxFeHRlbnNpb24gPSB0YXJnZXQuc2VhcmNoUGFyYW1zLmdldCgnb3JpZ2luYWwnKTtcbiAgICBpZiAob3JpZ2luYWxFeHRlbnNpb24pIHtcbiAgICAgICAgdGFyZ2V0LnNlYXJjaFBhcmFtcy5kZWxldGUoJ29yaWdpbmFsJyk7XG4gICAgICAgIHJlcGxhY2VFeHRlbnNpb24odGFyZ2V0LCBvcmlnaW5hbEV4dGVuc2lvbik7XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIGdldENqc0ludGVyb3BTb3VyY2UodXJsOiBVUkwpIHtcbiAgICBjb25zdCB0YXJnZXQgPSBnZXRDanNJbnRlcm9wVGFyZ2V0KHVybCk7XG4gICAgcmV0dXJuIGdldENqc0ludGVyb3BNb2R1bGVTb3VyY2UoYC4vJHt0YXJnZXQucGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKSF9YCk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUxvYWRNYXBwaW5ncyhsb2FkTWFwcGluZ3M6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pIHtcbiAgICBjb25zdCBub3JtYWxpemVkOiBBcnJheTxbc3RyaW5nLCBSZWFkb25seTxVUkw+XT4gPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtmcm9tLCB0b10gb2YgT2JqZWN0LmVudHJpZXMobG9hZE1hcHBpbmdzKSkge1xuICAgICAgICBpZiAoIWZyb20uZW5kc1dpdGgoJy8nKSAmJiB0by5lbmRzV2l0aCgnLycpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBsb2FkIG1hcHBpbmc6ICcke2Zyb219JzogJyR7dG99J2ApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZyb21VUkwgPSBuZXcgVVJMKGZyb20pO1xuICAgICAgICBjb25zdCB0b1VSTCA9IG5ldyBVUkwodG8pO1xuICAgICAgICBub3JtYWxpemVkLnB1c2goW2Zyb21VUkwuaHJlZiwgdG9VUkxdKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vcm1hbGl6ZWQ7XG59XG5cbmNvbnN0IHBhcnNlclBsdWdpbnM6IFBhcnNlclBsdWdpbltdID0gW1xuICAgICdhc3luY0dlbmVyYXRvcnMnLFxuICAgICdiaWdJbnQnLFxuICAgICdjbGFzc1ByaXZhdGVNZXRob2RzJyxcbiAgICAnY2xhc3NQcml2YXRlUHJvcGVydGllcycsXG4gICAgJ2NsYXNzUHJvcGVydGllcycsXG4gICAgLy8gJ2NsYXNzU3RhdGljQmxvY2snLFxuICAgICdkZWNpbWFsJyxcbiAgICAvLyAnZGVjb3JhdG9ycycsXG4gICAgJ2RlY29yYXRvcnMtbGVnYWN5JyxcbiAgICAvLyAnZG9FeHByZXNzaW9ucycsXG4gICAgJ2R5bmFtaWNJbXBvcnQnLFxuICAgIC8vICdlc3RyZWUnLFxuICAgICdleHBvcnREZWZhdWx0RnJvbScsXG4gICAgLy8gJ2V4cG9ydE5hbWVzcGFjZUZyb20nLCAvLyBkZXByZWNhdGVkXG4gICAgLy8gJ2Zsb3cnLFxuICAgIC8vICdmbG93Q29tbWVudHMnLFxuICAgIC8vICdmdW5jdGlvbkJpbmQnLFxuICAgICdmdW5jdGlvblNlbnQnLFxuICAgICdpbXBvcnRNZXRhJyxcbiAgICAvLyAnanN4JyxcbiAgICAnbG9naWNhbEFzc2lnbm1lbnQnLFxuICAgIC8vICdpbXBvcnRBc3NlcnRpb25zJyxcbiAgICAnbW9kdWxlU3RyaW5nTmFtZXMnLFxuICAgICdudWxsaXNoQ29hbGVzY2luZ09wZXJhdG9yJyxcbiAgICAnbnVtZXJpY1NlcGFyYXRvcicsXG4gICAgJ29iamVjdFJlc3RTcHJlYWQnLFxuICAgICdvcHRpb25hbENhdGNoQmluZGluZycsXG4gICAgJ29wdGlvbmFsQ2hhaW5pbmcnLFxuICAgIC8vICdwYXJ0aWFsQXBwbGljYXRpb24nLFxuICAgIC8vICdwaXBlbGluZU9wZXJhdG9yJyxcbiAgICAncGxhY2Vob2xkZXJzJyxcbiAgICAvLyAncHJpdmF0ZUluJyxcbiAgICAvLyAndGhyb3dFeHByZXNzaW9ucycsXG4gICAgJ3RvcExldmVsQXdhaXQnLFxuICAgIC8vICd0eXBlc2NyaXB0JyxcbiAgICAvLyAndjhpbnRyaW5zaWMnLFxuICAgIC8vIFsnZGVjb3JhdG9ycycsIHtcbiAgICAvLyAgICAgZGVjb3JhdG9yc0JlZm9yZUV4cG9ydDogdHJ1ZSxcbiAgICAvLyB9XSxcbiAgICAvLyBbJ3BpcGVsaW5lT3BlcmF0b3InLCB7XG4gICAgLy8gICAgIHByb3Bvc2FsOiAnbWluaW1hbCcsXG4gICAgLy8gfV0sXG4gICAgLy8gWydmbG93Jywge1xuICAgIC8vICAgICBhbGw6IHRydWUsXG4gICAgLy8gfV0sXG5dO1xuIl19