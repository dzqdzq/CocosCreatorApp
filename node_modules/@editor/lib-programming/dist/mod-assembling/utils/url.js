"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasFileProtocol = exports.getBaseName = exports.assignPathname = exports.tryParseURL = exports.replaceExtension = exports.hasExtension = exports.parseExtensionName = void 0;
const url_1 = require("url");
function parseExtensionName(pathname) {
    const segments = pathname.split('/');
    if (segments.length > 0) {
        const last = segments[segments.length - 1];
        if (last.length > 1) {
            const iLastDot = last.lastIndexOf('.');
            if (iLastDot >= 0) {
                return last.substr(iLastDot);
            }
        }
    }
    return '';
}
exports.parseExtensionName = parseExtensionName;
function hasExtension(pathname) {
    return !!parseExtensionName(pathname);
}
exports.hasExtension = hasExtension;
function replaceExtension(url, ext) {
    const parts = url.pathname.split('/');
    if (parts.length !== 0) {
        const baseName = parts[parts.length - 1];
        const dot = baseName.lastIndexOf('.');
        if (dot >= 0) {
            const originalExtension = baseName.substr(dot + 1);
            parts[parts.length - 1] = `${baseName.substr(0, dot)}${ext}`;
            assignPathname(url, parts.join('/'));
            return '.' + originalExtension;
        }
    }
}
exports.replaceExtension = replaceExtension;
function tryParseURL(input, base) {
    try {
        return new url_1.URL(input, base);
    }
    catch (_a) {
        return;
    }
}
exports.tryParseURL = tryParseURL;
function assignPathname(url, pathname) {
    if (!url.pathname.startsWith('/')) {
        console.warn(`Cannot change pathname of URL ${url} since it's a 'cannot-be-a-base-URL' URL.`);
    }
    // https://gist.github.com/shrinktofit/50f2380782b6219ed6a4cb3a210a75f7
    url.pathname = pathname;
    return url;
}
exports.assignPathname = assignPathname;
function getBaseName(url) {
    const segments = url.pathname.split('/');
    if (segments.length === 0) {
        return '';
    }
    else {
        const last = segments[segments.length - 1];
        const iDot = last.lastIndexOf('.');
        if (iDot >= 0) {
            return last.substr(0, iDot);
        }
        else {
            return last;
        }
    }
}
exports.getBaseName = getBaseName;
function hasFileProtocol(url) {
    return url.protocol === 'file:';
}
exports.hasFileProtocol = hasFileProtocol;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZC1hc3NlbWJsaW5nL3V0aWxzL3VybC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2QkFBMEI7QUFHMUIsU0FBZ0Isa0JBQWtCLENBQUMsUUFBZ0I7SUFDL0MsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNyQyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxJQUFJLFFBQVEsSUFBSSxDQUFDLEVBQUU7Z0JBQ2YsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ2hDO1NBQ0o7S0FDSjtJQUNELE9BQU8sRUFBRSxDQUFDO0FBQ2QsQ0FBQztBQVpELGdEQVlDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLFFBQWdCO0lBQ3pDLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFGRCxvQ0FFQztBQUVELFNBQWdCLGdCQUFnQixDQUFDLEdBQVEsRUFBRSxHQUFXO0lBQ2xELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RDLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDcEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDVixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ25ELEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDN0QsY0FBYyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDckMsT0FBTyxHQUFHLEdBQUcsaUJBQWlCLENBQUM7U0FDbEM7S0FDSjtBQUNMLENBQUM7QUFaRCw0Q0FZQztBQUVELFNBQWdCLFdBQVcsQ0FBQyxLQUFhLEVBQUUsSUFBVTtJQUNqRCxJQUFJO1FBQ0EsT0FBTyxJQUFJLFNBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDL0I7SUFBQyxXQUFNO1FBQ0osT0FBTztLQUNWO0FBQ0wsQ0FBQztBQU5ELGtDQU1DO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLEdBQVEsRUFBRSxRQUFnQjtJQUNyRCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDL0IsT0FBTyxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsR0FBRywyQ0FBMkMsQ0FBQyxDQUFDO0tBQ2pHO0lBQ0QsdUVBQXVFO0lBQ3ZFLEdBQUcsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQ3hCLE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQVBELHdDQU9DO0FBRUQsU0FBZ0IsV0FBVyxDQUFDLEdBQVE7SUFDaEMsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekMsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUN2QixPQUFPLEVBQUUsQ0FBQztLQUNiO1NBQU07UUFDSCxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMzQyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRTtZQUNYLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDL0I7YUFBTTtZQUNILE9BQU8sSUFBSSxDQUFDO1NBQ2Y7S0FDSjtBQUNMLENBQUM7QUFiRCxrQ0FhQztBQUVELFNBQWdCLGVBQWUsQ0FBQyxHQUFRO0lBQ3BDLE9BQU8sR0FBRyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7QUFDcEMsQ0FBQztBQUZELDBDQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVVJMIH0gZnJvbSAndXJsJztcclxuaW1wb3J0IHsgYXNzZXJ0cyB9IGZyb20gJy4uLy4uL3V0aWxzL2Fzc2VydHMnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRXh0ZW5zaW9uTmFtZShwYXRobmFtZTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzZWdtZW50cyA9IHBhdGhuYW1lLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGxhc3QgPSBzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXTtcclxuICAgICAgICBpZiAobGFzdC5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlMYXN0RG90ID0gbGFzdC5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgICAgICAgICBpZiAoaUxhc3REb3QgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxhc3Quc3Vic3RyKGlMYXN0RG90KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhc0V4dGVuc2lvbihwYXRobmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gISFwYXJzZUV4dGVuc2lvbk5hbWUocGF0aG5hbWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUV4dGVuc2lvbih1cmw6IFVSTCwgZXh0OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHBhcnRzID0gdXJsLnBhdGhuYW1lLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAocGFydHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcclxuICAgICAgICBjb25zdCBkb3QgPSBiYXNlTmFtZS5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgICAgIGlmIChkb3QgPj0gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbEV4dGVuc2lvbiA9IGJhc2VOYW1lLnN1YnN0cihkb3QgKyAxKTtcclxuICAgICAgICAgICAgcGFydHNbcGFydHMubGVuZ3RoIC0gMV0gPSBgJHtiYXNlTmFtZS5zdWJzdHIoMCwgZG90KX0ke2V4dH1gO1xyXG4gICAgICAgICAgICBhc3NpZ25QYXRobmFtZSh1cmwsIHBhcnRzLmpvaW4oJy8nKSk7XHJcbiAgICAgICAgICAgIHJldHVybiAnLicgKyBvcmlnaW5hbEV4dGVuc2lvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cnlQYXJzZVVSTChpbnB1dDogc3RyaW5nLCBiYXNlPzogVVJMKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVVJMKGlucHV0LCBiYXNlKTtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFzc2lnblBhdGhuYW1lKHVybDogVVJMLCBwYXRobmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvJykpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oYENhbm5vdCBjaGFuZ2UgcGF0aG5hbWUgb2YgVVJMICR7dXJsfSBzaW5jZSBpdCdzIGEgJ2Nhbm5vdC1iZS1hLWJhc2UtVVJMJyBVUkwuYCk7XHJcbiAgICB9XHJcbiAgICAvLyBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9zaHJpbmt0b2ZpdC81MGYyMzgwNzgyYjYyMTllZDZhNGNiM2EyMTBhNzVmN1xyXG4gICAgdXJsLnBhdGhuYW1lID0gcGF0aG5hbWU7XHJcbiAgICByZXR1cm4gdXJsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmFzZU5hbWUodXJsOiBVUkwpIHtcclxuICAgIGNvbnN0IHNlZ21lbnRzID0gdXJsLnBhdGhuYW1lLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBsYXN0ID0gc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgY29uc3QgaURvdCA9IGxhc3QubGFzdEluZGV4T2YoJy4nKTtcclxuICAgICAgICBpZiAoaURvdCA+PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsYXN0LnN1YnN0cigwLCBpRG90KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbGFzdDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYXNGaWxlUHJvdG9jb2wodXJsOiBVUkwpIHtcclxuICAgIHJldHVybiB1cmwucHJvdG9jb2wgPT09ICdmaWxlOic7XHJcbn1cclxuIl19