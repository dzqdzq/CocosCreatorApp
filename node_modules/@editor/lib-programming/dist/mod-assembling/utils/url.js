"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasFileProtocol = exports.getBaseName = exports.assignPathname = exports.tryParseURL = exports.replaceExtension = exports.hasExtension = exports.parseExtensionName = void 0;
const url_1 = require("url");
function parseExtensionName(pathname) {
    const segments = pathname.split('/');
    if (segments.length > 0) {
        const last = segments[segments.length - 1];
        if (last.length > 1) {
            const iLastDot = last.lastIndexOf('.');
            if (iLastDot >= 0) {
                return last.substr(iLastDot);
            }
        }
    }
    return '';
}
exports.parseExtensionName = parseExtensionName;
function hasExtension(pathname) {
    return !!parseExtensionName(pathname);
}
exports.hasExtension = hasExtension;
function replaceExtension(url, ext) {
    const parts = url.pathname.split('/');
    if (parts.length !== 0) {
        const baseName = parts[parts.length - 1];
        const dot = baseName.lastIndexOf('.');
        if (dot >= 0) {
            const originalExtension = baseName.substr(dot + 1);
            parts[parts.length - 1] = `${baseName.substr(0, dot)}${ext}`;
            assignPathname(url, parts.join('/'));
            return '.' + originalExtension;
        }
    }
}
exports.replaceExtension = replaceExtension;
function tryParseURL(input, base) {
    try {
        return new url_1.URL(input, base);
    }
    catch (_a) {
        return;
    }
}
exports.tryParseURL = tryParseURL;
function assignPathname(url, pathname) {
    if (!url.pathname.startsWith('/')) {
        console.warn(`Cannot change pathname of URL ${url} since it's a 'cannot-be-a-base-URL' URL.`);
    }
    // https://gist.github.com/shrinktofit/50f2380782b6219ed6a4cb3a210a75f7
    url.pathname = pathname;
    return url;
}
exports.assignPathname = assignPathname;
function getBaseName(url) {
    const segments = url.pathname.split('/');
    if (segments.length === 0) {
        return '';
    }
    else {
        const last = segments[segments.length - 1];
        const iDot = last.lastIndexOf('.');
        if (iDot >= 0) {
            return last.substr(0, iDot);
        }
        else {
            return last;
        }
    }
}
exports.getBaseName = getBaseName;
function hasFileProtocol(url) {
    return url.protocol === 'file:';
}
exports.hasFileProtocol = hasFileProtocol;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZC1hc3NlbWJsaW5nL3V0aWxzL3VybC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2QkFBMEI7QUFHMUIsU0FBZ0Isa0JBQWtCLENBQUMsUUFBZ0I7SUFDL0MsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNyQyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxJQUFJLFFBQVEsSUFBSSxDQUFDLEVBQUU7Z0JBQ2YsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ2hDO1NBQ0o7S0FDSjtJQUNELE9BQU8sRUFBRSxDQUFDO0FBQ2QsQ0FBQztBQVpELGdEQVlDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLFFBQWdCO0lBQ3pDLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFGRCxvQ0FFQztBQUVELFNBQWdCLGdCQUFnQixDQUFDLEdBQVEsRUFBRSxHQUFXO0lBQ2xELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RDLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDcEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDVixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ25ELEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDN0QsY0FBYyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDckMsT0FBTyxHQUFHLEdBQUcsaUJBQWlCLENBQUM7U0FDbEM7S0FDSjtBQUNMLENBQUM7QUFaRCw0Q0FZQztBQUVELFNBQWdCLFdBQVcsQ0FBQyxLQUFhLEVBQUUsSUFBVTtJQUNqRCxJQUFJO1FBQ0EsT0FBTyxJQUFJLFNBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDL0I7SUFBQyxXQUFNO1FBQ0osT0FBTztLQUNWO0FBQ0wsQ0FBQztBQU5ELGtDQU1DO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLEdBQVEsRUFBRSxRQUFnQjtJQUNyRCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDL0IsT0FBTyxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsR0FBRywyQ0FBMkMsQ0FBQyxDQUFDO0tBQ2pHO0lBQ0QsdUVBQXVFO0lBQ3ZFLEdBQUcsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQ3hCLE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQVBELHdDQU9DO0FBRUQsU0FBZ0IsV0FBVyxDQUFDLEdBQVE7SUFDaEMsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekMsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUN2QixPQUFPLEVBQUUsQ0FBQztLQUNiO1NBQU07UUFDSCxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMzQyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRTtZQUNYLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDL0I7YUFBTTtZQUNILE9BQU8sSUFBSSxDQUFDO1NBQ2Y7S0FDSjtBQUNMLENBQUM7QUFiRCxrQ0FhQztBQUVELFNBQWdCLGVBQWUsQ0FBQyxHQUFRO0lBQ3BDLE9BQU8sR0FBRyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7QUFDcEMsQ0FBQztBQUZELDBDQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVVJMIH0gZnJvbSAndXJsJztcbmltcG9ydCB7IGFzc2VydHMgfSBmcm9tICcuLi8uLi91dGlscy9hc3NlcnRzJztcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRXh0ZW5zaW9uTmFtZShwYXRobmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2VnbWVudHMgPSBwYXRobmFtZS5zcGxpdCgnLycpO1xuICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGxhc3QgPSBzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKGxhc3QubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgY29uc3QgaUxhc3REb3QgPSBsYXN0Lmxhc3RJbmRleE9mKCcuJyk7XG4gICAgICAgICAgICBpZiAoaUxhc3REb3QgPj0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBsYXN0LnN1YnN0cihpTGFzdERvdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzRXh0ZW5zaW9uKHBhdGhuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gISFwYXJzZUV4dGVuc2lvbk5hbWUocGF0aG5hbWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUV4dGVuc2lvbih1cmw6IFVSTCwgZXh0OiBzdHJpbmcpIHtcbiAgICBjb25zdCBwYXJ0cyA9IHVybC5wYXRobmFtZS5zcGxpdCgnLycpO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgZG90ID0gYmFzZU5hbWUubGFzdEluZGV4T2YoJy4nKTtcbiAgICAgICAgaWYgKGRvdCA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbEV4dGVuc2lvbiA9IGJhc2VOYW1lLnN1YnN0cihkb3QgKyAxKTtcbiAgICAgICAgICAgIHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdID0gYCR7YmFzZU5hbWUuc3Vic3RyKDAsIGRvdCl9JHtleHR9YDtcbiAgICAgICAgICAgIGFzc2lnblBhdGhuYW1lKHVybCwgcGFydHMuam9pbignLycpKTtcbiAgICAgICAgICAgIHJldHVybiAnLicgKyBvcmlnaW5hbEV4dGVuc2lvbjtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyeVBhcnNlVVJMKGlucHV0OiBzdHJpbmcsIGJhc2U/OiBVUkwpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gbmV3IFVSTChpbnB1dCwgYmFzZSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NpZ25QYXRobmFtZSh1cmw6IFVSTCwgcGF0aG5hbWU6IHN0cmluZykge1xuICAgIGlmICghdXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoJy8nKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYENhbm5vdCBjaGFuZ2UgcGF0aG5hbWUgb2YgVVJMICR7dXJsfSBzaW5jZSBpdCdzIGEgJ2Nhbm5vdC1iZS1hLWJhc2UtVVJMJyBVUkwuYCk7XG4gICAgfVxuICAgIC8vIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3Nocmlua3RvZml0LzUwZjIzODA3ODJiNjIxOWVkNmE0Y2IzYTIxMGE3NWY3XG4gICAgdXJsLnBhdGhuYW1lID0gcGF0aG5hbWU7XG4gICAgcmV0dXJuIHVybDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEJhc2VOYW1lKHVybDogVVJMKSB7XG4gICAgY29uc3Qgc2VnbWVudHMgPSB1cmwucGF0aG5hbWUuc3BsaXQoJy8nKTtcbiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsYXN0ID0gc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV07XG4gICAgICAgIGNvbnN0IGlEb3QgPSBsYXN0Lmxhc3RJbmRleE9mKCcuJyk7XG4gICAgICAgIGlmIChpRG90ID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBsYXN0LnN1YnN0cigwLCBpRG90KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYXN0O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzRmlsZVByb3RvY29sKHVybDogVVJMKSB7XG4gICAgcmV0dXJuIHVybC5wcm90b2NvbCA9PT0gJ2ZpbGU6Jztcbn1cbiJdfQ==