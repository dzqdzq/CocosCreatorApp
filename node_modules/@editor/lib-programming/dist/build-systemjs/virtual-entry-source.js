"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PREFIX = void 0;
const path_1 = __importDefault(require("path"));
exports.PREFIX = `\0virtual:`;
function virtual(modules) {
    const resolvedIds = new Map();
    Object.keys(modules).forEach((id) => {
        resolvedIds.set(path_1.default.resolve(id), modules[id]);
    });
    return {
        name: 'virtual',
        async resolveId(id, importer) {
            if (id in modules) {
                return exports.PREFIX + id;
            }
            if (importer) {
                const importerNoPrefix = importer.startsWith(exports.PREFIX)
                    ? importer.slice(exports.PREFIX.length)
                    : importer;
                const resolved = await this.resolve(id, importerNoPrefix, { skipSelf: true });
                if (resolved && resolvedIds.has(resolved.id)) {
                    return exports.PREFIX + resolved;
                }
                else {
                    return resolved;
                }
            }
            return null;
        },
        load(id) {
            if (id.startsWith(exports.PREFIX)) {
                const idNoPrefix = id.slice(exports.PREFIX.length);
                return idNoPrefix in modules ? modules[idNoPrefix] : resolvedIds.get(idNoPrefix);
            }
            return null;
        },
    };
}
exports.default = virtual;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlydHVhbC1lbnRyeS1zb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYnVpbGQtc3lzdGVtanMvdmlydHVhbC1lbnRyeS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsZ0RBQXNCO0FBRVQsUUFBQSxNQUFNLEdBQUcsWUFBWSxDQUFDO0FBRW5DLFNBQXdCLE9BQU8sQ0FBQyxPQUErQjtJQUMzRCxNQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztJQUU5QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFO1FBQ2hDLFdBQVcsQ0FBQyxHQUFHLENBQUMsY0FBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU87UUFDSCxJQUFJLEVBQUUsU0FBUztRQUVmLEtBQUssQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLFFBQVE7WUFDeEIsSUFBSSxFQUFFLElBQUksT0FBTyxFQUFFO2dCQUNmLE9BQU8sY0FBTSxHQUFHLEVBQUUsQ0FBQzthQUN0QjtZQUVELElBQUksUUFBUSxFQUFFO2dCQUNWLE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxjQUFNLENBQUM7b0JBQ2hELENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLGNBQU0sQ0FBQyxNQUFNLENBQUM7b0JBQy9CLENBQUMsQ0FBQyxRQUFRLENBQUM7Z0JBQ2YsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUM5RSxJQUFJLFFBQVEsSUFBSSxXQUFXLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRTtvQkFDMUMsT0FBTyxjQUFNLEdBQUcsUUFBUSxDQUFDO2lCQUM1QjtxQkFBTTtvQkFDSCxPQUFPLFFBQVEsQ0FBQztpQkFDbkI7YUFDSjtZQUVELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxJQUFJLENBQUMsRUFBRTtZQUNILElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxjQUFNLENBQUMsRUFBRTtnQkFDdkIsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxjQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzNDLE9BQU8sVUFBVSxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ3BGO1lBRUQsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztLQUNKLENBQUM7QUFDTixDQUFDO0FBdkNELDBCQXVDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlICogYXMgcm9sbHVwIGZyb20gJ3JvbGx1cCc7XHJcbmltcG9ydCBwcyBmcm9tICdwYXRoJztcclxuXHJcbmV4cG9ydCBjb25zdCBQUkVGSVggPSBgXFwwdmlydHVhbDpgO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdmlydHVhbChtb2R1bGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogcm9sbHVwLlBsdWdpbiB7XHJcbiAgICBjb25zdCByZXNvbHZlZElkcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcblxyXG4gICAgT2JqZWN0LmtleXMobW9kdWxlcykuZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgICByZXNvbHZlZElkcy5zZXQocHMucmVzb2x2ZShpZCksIG1vZHVsZXNbaWRdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmFtZTogJ3ZpcnR1YWwnLFxyXG5cclxuICAgICAgICBhc3luYyByZXNvbHZlSWQoaWQsIGltcG9ydGVyKSB7XHJcbiAgICAgICAgICAgIGlmIChpZCBpbiBtb2R1bGVzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUFJFRklYICsgaWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpbXBvcnRlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0ZXJOb1ByZWZpeCA9IGltcG9ydGVyLnN0YXJ0c1dpdGgoUFJFRklYKVxyXG4gICAgICAgICAgICAgICAgICAgID8gaW1wb3J0ZXIuc2xpY2UoUFJFRklYLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICA6IGltcG9ydGVyO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhd2FpdCB0aGlzLnJlc29sdmUoaWQsIGltcG9ydGVyTm9QcmVmaXgsIHsgc2tpcFNlbGY6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzb2x2ZWQgJiYgcmVzb2x2ZWRJZHMuaGFzKHJlc29sdmVkLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQUkVGSVggKyByZXNvbHZlZDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBsb2FkKGlkKSB7XHJcbiAgICAgICAgICAgIGlmIChpZC5zdGFydHNXaXRoKFBSRUZJWCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkTm9QcmVmaXggPSBpZC5zbGljZShQUkVGSVgubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpZE5vUHJlZml4IGluIG1vZHVsZXMgPyBtb2R1bGVzW2lkTm9QcmVmaXhdIDogcmVzb2x2ZWRJZHMuZ2V0KGlkTm9QcmVmaXgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxufVxyXG4iXX0=