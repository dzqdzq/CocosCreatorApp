"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPluginScriptDependencies = exports.sortPluginScripts = void 0;
function sortPluginScripts(scripts, circularDependencyHandler) {
    const permanentMark = 1 << 0;
    const temporaryMark = 1 << 1;
    const states = {};
    scripts.forEach((script) => {
        states[script[0]] = 0;
    });
    const sorted = [];
    const visitStack = [];
    const visit = (id) => {
        const state = states[id];
        if (state & permanentMark) {
            return;
        }
        else if (state & temporaryMark) {
            circularDependencyHandler === null || circularDependencyHandler === void 0 ? void 0 : circularDependencyHandler(visitStack);
            return;
        }
        visitStack.push(id);
        states[id] |= temporaryMark;
        const script = scripts.find((script) => script[0] === id);
        script === null || script === void 0 ? void 0 : script[1].forEach((dependency) => {
            visit(dependency);
        });
        states[id] &= ~temporaryMark;
        states[id] |= permanentMark;
        sorted.push(id);
        visitStack.pop();
    };
    Object.keys(states).forEach((id) => {
        if (!(states[id] & permanentMark)) {
            visit(id);
        }
    });
    return sorted;
}
exports.sortPluginScripts = sortPluginScripts;
function getPluginScriptDependencies(meta) {
    var _a, _b;
    return (_b = (_a = meta.dependencies) === null || _a === void 0 ? void 0 : _a.filter((dependency) => dependency.length !== 0)) !== null && _b !== void 0 ? _b : [];
}
exports.getPluginScriptDependencies = getPluginScriptDependencies;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1wbHVnaW4tc2NyaXB0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leGVjdXRvci9zb3J0LXBsdWdpbi1zY3JpcHRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLFNBQWdCLGlCQUFpQixDQUM3QixPQUFtRCxFQUNuRCx5QkFBaUU7SUFHakUsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixNQUFNLGFBQWEsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdCLE1BQU0sTUFBTSxHQUEwQixFQUFFLENBQUM7SUFDekMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFFNUIsTUFBTSxVQUFVLEdBQWEsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sS0FBSyxHQUFHLENBQUMsRUFBVSxFQUFFLEVBQUU7UUFDekIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pCLElBQUksS0FBSyxHQUFHLGFBQWEsRUFBRTtZQUN2QixPQUFPO1NBQ1Y7YUFBTSxJQUFJLEtBQUssR0FBRyxhQUFhLEVBQUU7WUFDOUIseUJBQXlCLGFBQXpCLHlCQUF5Qix1QkFBekIseUJBQXlCLENBQUcsVUFBVSxFQUFFO1lBQ3hDLE9BQU87U0FDVjtRQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFcEIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLGFBQWEsQ0FBQztRQUM1QixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDMUQsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFHLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUMvQixLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdEIsQ0FBQyxFQUFFO1FBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxhQUFhLENBQUM7UUFFNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVoQixVQUFVLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDckIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtRQUMvQixJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDLEVBQUU7WUFDL0IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2I7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUEvQ0QsOENBK0NDO0FBRUQsU0FBZ0IsMkJBQTJCLENBQUMsSUFFM0M7O0lBQ0csbUJBQU8sSUFBSSxDQUFDLFlBQVksMENBQUUsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsb0NBQUssRUFBRSxDQUFDO0FBQ3BGLENBQUM7QUFKRCxrRUFJQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRQbHVnaW5TY3JpcHRzKFxyXG4gICAgc2NyaXB0czogUmVhZG9ubHlBcnJheTxbc3RyaW5nLCByZWFkb25seSBzdHJpbmdbXV0+LFxyXG4gICAgY2lyY3VsYXJEZXBlbmRlbmN5SGFuZGxlcj86IChjaXJjdWxhcjogcmVhZG9ubHkgc3RyaW5nW10pID0+IHZvaWQsXHJcbikge1xyXG4gICAgdHlwZSBTdGF0ZSA9IG51bWJlcjtcclxuICAgIGNvbnN0IHBlcm1hbmVudE1hcmsgPSAxIDw8IDA7XHJcbiAgICBjb25zdCB0ZW1wb3JhcnlNYXJrID0gMSA8PCAxO1xyXG5cclxuICAgIGNvbnN0IHN0YXRlczogUmVjb3JkPHN0cmluZywgU3RhdGU+ID0ge307XHJcbiAgICBzY3JpcHRzLmZvckVhY2goKHNjcmlwdCkgPT4ge1xyXG4gICAgICAgIHN0YXRlc1tzY3JpcHRbMF1dID0gMDtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNvcnRlZDogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBjb25zdCB2aXNpdFN0YWNrOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgdmlzaXQgPSAoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0YXRlID0gc3RhdGVzW2lkXTtcclxuICAgICAgICBpZiAoc3RhdGUgJiBwZXJtYW5lbnRNYXJrKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlICYgdGVtcG9yYXJ5TWFyaykge1xyXG4gICAgICAgICAgICBjaXJjdWxhckRlcGVuZGVuY3lIYW5kbGVyPy4odmlzaXRTdGFjayk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZpc2l0U3RhY2sucHVzaChpZCk7XHJcblxyXG4gICAgICAgIHN0YXRlc1tpZF0gfD0gdGVtcG9yYXJ5TWFyaztcclxuICAgICAgICBjb25zdCBzY3JpcHQgPSBzY3JpcHRzLmZpbmQoKHNjcmlwdCkgPT4gc2NyaXB0WzBdID09PSBpZCk7XHJcbiAgICAgICAgc2NyaXB0Py5bMV0uZm9yRWFjaCgoZGVwZW5kZW5jeSkgPT4ge1xyXG4gICAgICAgICAgICB2aXNpdChkZXBlbmRlbmN5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzdGF0ZXNbaWRdICY9IH50ZW1wb3JhcnlNYXJrO1xyXG4gICAgICAgIHN0YXRlc1tpZF0gfD0gcGVybWFuZW50TWFyaztcclxuXHJcbiAgICAgICAgc29ydGVkLnB1c2goaWQpO1xyXG5cclxuICAgICAgICB2aXNpdFN0YWNrLnBvcCgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgT2JqZWN0LmtleXMoc3RhdGVzKS5mb3JFYWNoKChpZCkgPT4ge1xyXG4gICAgICAgIGlmICghKHN0YXRlc1tpZF0gJiBwZXJtYW5lbnRNYXJrKSkge1xyXG4gICAgICAgICAgICB2aXNpdChpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiBzb3J0ZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQbHVnaW5TY3JpcHREZXBlbmRlbmNpZXMobWV0YToge1xyXG4gICAgZGVwZW5kZW5jaWVzPzogc3RyaW5nW107XHJcbn0pIHtcclxuICAgIHJldHVybiBtZXRhLmRlcGVuZGVuY2llcz8uZmlsdGVyKChkZXBlbmRlbmN5KSA9PiBkZXBlbmRlbmN5Lmxlbmd0aCAhPT0gMCkgPz8gW107XHJcbn1cclxuIl19