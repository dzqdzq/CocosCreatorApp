"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPluginScriptDependencies = exports.sortPluginScripts = void 0;
function sortPluginScripts(scripts, circularDependencyHandler) {
    const permanentMark = 1 << 0;
    const temporaryMark = 1 << 1;
    const states = {};
    scripts.forEach((script) => {
        states[script[0]] = 0;
    });
    const sorted = [];
    const visitStack = [];
    const visit = (id) => {
        const state = states[id];
        if (state & permanentMark) {
            return;
        }
        else if (state & temporaryMark) {
            circularDependencyHandler === null || circularDependencyHandler === void 0 ? void 0 : circularDependencyHandler(visitStack);
            return;
        }
        visitStack.push(id);
        states[id] |= temporaryMark;
        const script = scripts.find((script) => script[0] === id);
        script === null || script === void 0 ? void 0 : script[1].forEach((dependency) => {
            visit(dependency);
        });
        states[id] &= ~temporaryMark;
        states[id] |= permanentMark;
        sorted.push(id);
        visitStack.pop();
    };
    Object.keys(states).forEach((id) => {
        if (!(states[id] & permanentMark)) {
            visit(id);
        }
    });
    return sorted;
}
exports.sortPluginScripts = sortPluginScripts;
function getPluginScriptDependencies(meta) {
    var _a, _b;
    return (_b = (_a = meta.dependencies) === null || _a === void 0 ? void 0 : _a.filter((dependency) => dependency.length !== 0)) !== null && _b !== void 0 ? _b : [];
}
exports.getPluginScriptDependencies = getPluginScriptDependencies;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1wbHVnaW4tc2NyaXB0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leGVjdXRvci9zb3J0LXBsdWdpbi1zY3JpcHRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLFNBQWdCLGlCQUFpQixDQUM3QixPQUFtRCxFQUNuRCx5QkFBaUU7SUFHakUsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixNQUFNLGFBQWEsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdCLE1BQU0sTUFBTSxHQUEwQixFQUFFLENBQUM7SUFDekMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFFNUIsTUFBTSxVQUFVLEdBQWEsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sS0FBSyxHQUFHLENBQUMsRUFBVSxFQUFFLEVBQUU7UUFDekIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pCLElBQUksS0FBSyxHQUFHLGFBQWEsRUFBRTtZQUN2QixPQUFPO1NBQ1Y7YUFBTSxJQUFJLEtBQUssR0FBRyxhQUFhLEVBQUU7WUFDOUIseUJBQXlCLGFBQXpCLHlCQUF5Qix1QkFBekIseUJBQXlCLENBQUcsVUFBVSxFQUFFO1lBQ3hDLE9BQU87U0FDVjtRQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFcEIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLGFBQWEsQ0FBQztRQUM1QixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDMUQsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFHLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUMvQixLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdEIsQ0FBQyxFQUFFO1FBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxhQUFhLENBQUM7UUFFNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVoQixVQUFVLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDckIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtRQUMvQixJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDLEVBQUU7WUFDL0IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2I7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUEvQ0QsOENBK0NDO0FBRUQsU0FBZ0IsMkJBQTJCLENBQUUsSUFFNUM7O0lBQ0csbUJBQU8sSUFBSSxDQUFDLFlBQVksMENBQUUsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsb0NBQUssRUFBRSxDQUFDO0FBQ3BGLENBQUM7QUFKRCxrRUFJQyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5leHBvcnQgZnVuY3Rpb24gc29ydFBsdWdpblNjcmlwdHMoXG4gICAgc2NyaXB0czogUmVhZG9ubHlBcnJheTxbc3RyaW5nLCByZWFkb25seSBzdHJpbmdbXV0+LFxuICAgIGNpcmN1bGFyRGVwZW5kZW5jeUhhbmRsZXI/OiAoY2lyY3VsYXI6IHJlYWRvbmx5IHN0cmluZ1tdKSA9PiB2b2lkLFxuKSB7XG4gICAgdHlwZSBTdGF0ZSA9IG51bWJlcjtcbiAgICBjb25zdCBwZXJtYW5lbnRNYXJrID0gMSA8PCAwO1xuICAgIGNvbnN0IHRlbXBvcmFyeU1hcmsgPSAxIDw8IDE7XG5cbiAgICBjb25zdCBzdGF0ZXM6IFJlY29yZDxzdHJpbmcsIFN0YXRlPiA9IHt9O1xuICAgIHNjcmlwdHMuZm9yRWFjaCgoc2NyaXB0KSA9PiB7XG4gICAgICAgIHN0YXRlc1tzY3JpcHRbMF1dID0gMDtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNvcnRlZDogc3RyaW5nW10gPSBbXTtcblxuICAgIGNvbnN0IHZpc2l0U3RhY2s6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmlzaXQgPSAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHN0YXRlc1tpZF07XG4gICAgICAgIGlmIChzdGF0ZSAmIHBlcm1hbmVudE1hcmspIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSAmIHRlbXBvcmFyeU1hcmspIHtcbiAgICAgICAgICAgIGNpcmN1bGFyRGVwZW5kZW5jeUhhbmRsZXI/Lih2aXNpdFN0YWNrKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZpc2l0U3RhY2sucHVzaChpZCk7XG5cbiAgICAgICAgc3RhdGVzW2lkXSB8PSB0ZW1wb3JhcnlNYXJrO1xuICAgICAgICBjb25zdCBzY3JpcHQgPSBzY3JpcHRzLmZpbmQoKHNjcmlwdCkgPT4gc2NyaXB0WzBdID09PSBpZCk7XG4gICAgICAgIHNjcmlwdD8uWzFdLmZvckVhY2goKGRlcGVuZGVuY3kpID0+IHtcbiAgICAgICAgICAgIHZpc2l0KGRlcGVuZGVuY3kpO1xuICAgICAgICB9KTtcbiAgICAgICAgc3RhdGVzW2lkXSAmPSB+dGVtcG9yYXJ5TWFyaztcbiAgICAgICAgc3RhdGVzW2lkXSB8PSBwZXJtYW5lbnRNYXJrO1xuXG4gICAgICAgIHNvcnRlZC5wdXNoKGlkKTtcblxuICAgICAgICB2aXNpdFN0YWNrLnBvcCgpO1xuICAgIH07XG4gICAgXG4gICAgT2JqZWN0LmtleXMoc3RhdGVzKS5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgICBpZiAoIShzdGF0ZXNbaWRdICYgcGVybWFuZW50TWFyaykpIHtcbiAgICAgICAgICAgIHZpc2l0KGlkKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBzb3J0ZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQbHVnaW5TY3JpcHREZXBlbmRlbmNpZXMgKG1ldGE6IHtcbiAgICBkZXBlbmRlbmNpZXM/OiBzdHJpbmdbXTtcbn0pIHtcbiAgICByZXR1cm4gbWV0YS5kZXBlbmRlbmNpZXM/LmZpbHRlcigoZGVwZW5kZW5jeSkgPT4gZGVwZW5kZW5jeS5sZW5ndGggIT09IDApID8/IFtdO1xufVxuIl19