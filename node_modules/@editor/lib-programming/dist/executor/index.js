"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Executor = void 0;
const path_1 = __importDefault(require("path"));
const editor_systemjs_1 = require("../editor-systemjs");
const url_1 = require("url");
const loader_1 = require("@cocos/creator-programming-quick-pack/lib/loader");
const pack_mod_instantiation_1 = require("./pack-mod-instantiation");
// `'cc'` 的 URL
const engineIndexURL = `cce:/internal/x/cc`;
// 引擎功能单元模块的 URL 前缀
const engineFeatureUnitsPrefix = `cce:/internal/x/cc-fu/`;
// 引擎公开至编辑器的模块的 URL 前缀
const engineExportToEditorPrefix = `cce:/internal/x/engine-export-to-editor/`;
// 编辑器公开给项目的模块的 URL 前缀
const editorExportToProjectPrefix = `cce:/internal/x/editor-export-to-project/`;
// 项目路径相关 URL 前缀
const projectUrlPrefix = 'cce:/internal/x/project/';
const packResourceBaseURL = new url_1.URL('pack:///');
const defaultImportExceptionHandler = (err) => {
    console.warn(err);
};
class Executor {
    constructor(quickPackLoaderContext, packModuleEvaluator, importExceptionHandler) {
        this._cachedExceptions = new Map();
        this._classUuidMap = {};
        this._builtinMods = {};
        this._modules = Object.create(null);
        this._registeredClasses = [];
        this._plugins = [];
        this._fixedImportMap = { imports: {} };
        this._engineImportMapURL = '';
        this._instantiatedPackMods = [];
        this._cceModuleMap = {};
        this._editorSystem = editor_systemjs_1.globalEditorSystem;
        this._logger = {};
        const quickPackLoader = new loader_1.QuickPackLoader(quickPackLoaderContext);
        this._packLoader = quickPackLoader;
        this._packModInstantiation = new pack_mod_instantiation_1.PackModInstantiation(quickPackLoader, this._editorSystem, packModuleEvaluator);
        this._importExceptionHandler = importExceptionHandler !== null && importExceptionHandler !== void 0 ? importExceptionHandler : defaultImportExceptionHandler;
    }
    static async create(options) {
        if (Executor._inst) {
            return Executor._inst;
        }
        const executor = Executor._inst = new Executor(options.quickPackLoaderContext, options.packModuleEvaluator, options.importExceptionHandler);
        await executor._initialize(options);
        return executor;
    }
    async _initialize(options) {
        if (options.beforeUnregisterClass) {
            this._beforeUnregisterClass = options.beforeUnregisterClass;
        }
        this._addInstantiationHandlers(options.importEngineMod);
        this._cceModuleMap = options.cceModuleMap;
        this._fixedImportMap.imports['cc'] = engineIndexURL;
        this._fixedImportMap.imports['cc/env'] = `${engineExportToEditorPrefix}cc/editor/populate-internal-constants`;
        // TODO: deprecated cce.env is only live in 3.0-preview
        this._fixedImportMap.imports['cce.env'] = this._fixedImportMap.imports['cc/env'];
        const projectCustomMacroURL = new url_1.URL('./temp/programming/custom-macro.js', projectUrlPrefix);
        this._fixedImportMap.imports['cc/userland/macro'] = projectCustomMacroURL.href;
        for (const [moduleName, moduleConfig] of Object.entries(this._cceModuleMap)) {
            if (moduleName === 'mapLocation') {
                continue;
            }
            this._fixedImportMap.imports[moduleName] = `${editorExportToProjectPrefix}${moduleName}`;
        }
        const venderOnLoad = System.constructor.prototype.onload;
        const self = this;
        System.constructor.prototype.onload = function (...args) {
            self._onModuleLoaded(...args);
            if (typeof venderOnLoad === 'function') {
                venderOnLoad.apply(this, arguments);
            }
        };
        this._logger = options.logger || {};
    }
    _addInstantiationHandlers(importer) {
        // 处理项目里的自定义配置模块，比如 custom-macro 模块
        this._editorSystem.addInstantiationHandler((url) => {
            if (url.startsWith(projectUrlPrefix)) {
                let quickCompilerRequest = url.substr(projectUrlPrefix.length);
                quickCompilerRequest = path_1.default.join(Editor.Project.path, quickCompilerRequest);
                require(quickCompilerRequest);
                return this._editorSystem.getRegister();
            }
        });
        // 处理引擎模块的实例化
        this._editorSystem.addInstantiationHandler(async (url) => {
            let quickCompilerRequest = '';
            if (url.startsWith(engineFeatureUnitsPrefix)) {
                quickCompilerRequest = url;
            }
            else if (url.startsWith(engineExportToEditorPrefix)) {
                quickCompilerRequest = url.substr(engineExportToEditorPrefix.length);
            }
            if (quickCompilerRequest) {
                return [[], (_export) => {
                        return {
                            execute: async () => {
                                const exports = await importer(quickCompilerRequest);
                                _export(exports);
                            },
                        };
                    }];
            }
        });
        // 处理 Packer 里的模块的实例化
        const packResourceBaseURLString = packResourceBaseURL.href;
        this._editorSystem.addInstantiationHandler(async (url) => {
            if (url.startsWith(packResourceBaseURLString)) {
                const link = url.slice(packResourceBaseURLString.length);
                const register = await this._packModInstantiation.instantiate(link);
                this._instantiatedPackMods.push(url);
                return register;
            }
        });
        this._editorSystem.addInstantiationHandler(async (url) => {
            if (url.startsWith(editorExportToProjectPrefix)) {
                const moduleName = url.slice(editorExportToProjectPrefix.length);
                const moduleConfig = this._cceModuleMap[moduleName];
                const mapLocation = this._cceModuleMap.mapLocation;
                if (moduleConfig) {
                    const exportedObj = require(path_1.default.join(path_1.default.dirname(mapLocation), moduleConfig.main));
                    return [[], (_export) => {
                            return {
                                execute: async () => {
                                    _export(exportedObj);
                                },
                            };
                        }];
                }
            }
        });
    }
    addPolyfillFile(file) {
        require(file);
    }
    async prepare() {
        let unlockPromise;
        console.debug('[[Executor]] prepare before lock');
        try {
            // 多进程操作同一个资源。如果不给文件加锁，会导致文件读写冲突
            unlockPromise = await this._packModInstantiation.lock();
        }
        catch (err) {
            console.error(`[[Executor]] prepare lock failed: ${err}, stack: ${err.stack}`);
        }
        await this._reloadPackMods();
        try {
            if (unlockPromise) {
                await unlockPromise();
            }
        }
        catch (err) {
            console.error(`[[Executor]] prepare unlock failed: ${err}, stack: ${err.stack}`);
        }
        console.debug('[[Executor]] prepare after unlock');
    }
    async import(url) {
        return await this._editorSystem.import(url);
    }
    /**
     * 重新读取 Packer 的内容并重新执行所有项目脚本和插件脚本。
     */
    async reload() {
        const onClassRegistered = (classConstructor, metadata) => {
            var _a;
            var _b, _c;
            this._registeredClasses.push(classConstructor);
            console.debug(`[[Executor]] Register ${classConstructor.name}`);
            if (metadata) {
                ((_a = (_b = this._classUuidMap)[_c = metadata.uuid]) !== null && _a !== void 0 ? _a : (_b[_c] = [])).push(classConstructor);
            }
        };
        let unlockPromise;
        try {
            // 需要从这里开始上锁
            // 之前只在 _reloadPackMods 上锁，可能会导致后面 _importPrerequisiteModules 的逻辑使用到错误的 chunk
            console.debug('[[Executor]] reload before lock');
            try {
                // 多进程操作同一个资源。如果不给文件加锁，会导致文件读写冲突
                unlockPromise = await this._packModInstantiation.lock();
            }
            catch (err) {
                console.error(`[[Executor]] lock failed: ${err}, stack: ${err.stack}`);
            }
            EditorExtends.on('class-registered', onClassRegistered);
            await this._reloadPackMods();
            console.groupCollapsed(`Invalidate all modules`);
            await this._invalidateAllModules();
            console.groupEnd();
            this._invalidateAllPlugins();
            this._loadAllPlugins();
            console.groupCollapsed(`Imports all modules`);
            await this._importPrerequisiteModules();
            console.groupEnd();
        }
        catch (e) {
            console.error(`[[Executor]] failed to reload.`, e);
            throw e;
        }
        finally {
            EditorExtends.removeListener('class-registered', onClassRegistered);
            try {
                if (unlockPromise) {
                    await unlockPromise();
                }
            }
            catch (err) {
                console.error(`[[Executor]] unlock failed: ${err}, stack: ${err.stack}`);
            }
            console.debug('[[Executor]] after unlock');
        }
    }
    /**
     * 热更脚本插件
     * @param info 脚本插件更新信息
     */
    async hotReloadPluginScripts(info) {
        if (info && Object.keys(info.changes).length === 0 && info.removals.length === 0) {
            return;
        }
        this._invalidateAllPlugins();
        if (info) {
            for (let i = 0; i < this._plugins.length; i++) {
                const plugin = this._plugins[i];
                // 应用修改
                if (info.removals.includes(plugin.uuid)) {
                    this._plugins.splice(i, 1);
                    i--;
                }
                if (info.changes[plugin.uuid]) {
                    Object.assign(plugin, info.changes[plugin.uuid]);
                }
            }
        }
        await this._loadAllPlugins();
    }
    isModule(id) {
        return id in this._modules;
    }
    async clear() {
        this._invalidateAllPlugins();
        this._plugins = [];
        await this._invalidateAllModules();
    }
    setPluginScripts(plugins) {
        this._invalidateAllPlugins();
        this._plugins = plugins;
    }
    /**
     * 查找指定脚本模块中注册的所有 cc 类。
     * @param uuid 模块的 uuid。
     * @returns 指定脚本模块中注册的所有 cc 类；如果 [uuid] 并不对应一个模块或模块中未注册任何类则返回 `undefined`。
     */
    queryClassesInModule(uuid) {
        return this._classUuidMap[uuid];
    }
    async _reloadPackMods() {
        try {
            await this._packModInstantiation.reload();
            this._editorSystem.clearImportMap();
            const quickPackLoaderImportMap = await this._packModInstantiation.getImportMap();
            this._editorSystem.extendImportMap(quickPackLoaderImportMap, new url_1.URL(this._packLoader.importMapURL, packResourceBaseURL).href);
            this._editorSystem.extendImportMap(this._fixedImportMap, this._engineImportMapURL);
            const resolutionDetailMap = await this._packLoader.loadResolutionDetailMap();
            this._editorSystem.setResolutionDetailMap(resolutionDetailMap, new url_1.URL(this._packLoader.resolutionDetailMapURL, packResourceBaseURL).href);
        }
        catch (err) {
            console.error(`_reloadPackMods, reload failed: ${err}, stack: ${err.stack}`);
        }
    }
    async _invalidateAllModules() {
        const cc = await System.import('cc');
        for (const registeredClass of this._registeredClasses) {
            if (this._beforeUnregisterClass) {
                this._beforeUnregisterClass(registeredClass);
            }
            cc.js.unregisterClass(registeredClass);
            console.debug(`Unregister ${registeredClass.name}`);
        }
        this._registeredClasses = [];
        this._classUuidMap = {};
        cc.cclegacy._RF.reset();
        this._invalidateAllPackMods();
    }
    _invalidateAllPackMods() {
        for (const packModId of this._instantiatedPackMods) {
            console.debug(`Invalidating '${packModId}'`);
            const result = System.delete(packModId);
            if (result === false) {
                console.debug(`Note: failed to delete ${packModId}, maybe it's being executing?`);
            }
        }
        this._instantiatedPackMods.length = 0;
    }
    async _importPrerequisiteModules() {
        const cc = await System.import('cc');
        try {
            await System.import('cce:/internal/x/prerequisite-imports');
        }
        catch (err) {
            this._importExceptionHandler(err);
        }
        finally {
            this._cachedExceptions.clear();
            // 项目脚本可能在执行的时候会抛出异常，这导致 `cc._RF` 没有正确弹出。
            // 我们在最后清理一下。
            cc.cclegacy._RF.reset();
        }
    }
    async _loadAllPlugins() {
        const sortedMapped = this._plugins.map((pluginScript) => pluginScript.file);
        for (const file of sortedMapped) {
            try {
                require(file);
            }
            catch (error) {
                console.error(error);
            }
        }
    }
    _invalidateAllPlugins() {
        for (const [, pluginScriptInfo] of Object.entries(this._plugins)) {
            delete require.cache[pluginScriptInfo.file];
        }
    }
    _tryLog(cat, ...args) {
        // @ts-ignore
        return (cat in this._logger) ? this._logger[cat](...args) : this._defaultLog(...args);
    }
    _defaultLog(...args) {
        console.log(...args);
    }
    _onModuleLoaded(error, id) {
        const cachedExceptions = this._cachedExceptions;
        if (!error) {
            console.debug(`[[Executor]] Module "${id}" loaded.`);
        }
        else {
            if (!cachedExceptions.has(error)) {
                this._importExceptionHandler(error);
            }
            this._tryLog('loadException', id, error, cachedExceptions.has(error));
            cachedExceptions.set(error, id);
        }
    }
}
exports.Executor = Executor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhlY3V0b3IvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsZ0RBQXNCO0FBQ3RCLHdEQUF3RTtBQUN4RSw2QkFBMEI7QUFFMUIsNkVBQW1GO0FBQ25GLHFFQUFxRjtBQUlyRixlQUFlO0FBQ2YsTUFBTSxjQUFjLEdBQUcsb0JBQW9CLENBQUM7QUFDNUMsbUJBQW1CO0FBQ25CLE1BQU0sd0JBQXdCLEdBQUcsd0JBQXdCLENBQUM7QUFDMUQsc0JBQXNCO0FBQ3RCLE1BQU0sMEJBQTBCLEdBQUcsMENBQTBDLENBQUM7QUFDOUUsc0JBQXNCO0FBQ3RCLE1BQU0sMkJBQTJCLEdBQUcsMkNBQTJDLENBQUM7QUFDaEYsZ0JBQWdCO0FBQ2hCLE1BQU0sZ0JBQWdCLEdBQUcsMEJBQTBCLENBQUM7QUFFcEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLFNBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUloRCxNQUFNLDZCQUE2QixHQUEyQixDQUFDLEdBQVksRUFBRSxFQUFFO0lBQzNFLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdEIsQ0FBQyxDQUFDO0FBZ0JGLE1BQWEsUUFBUTtJQWVqQixZQUNJLHNCQUFxQyxFQUNyQyxtQkFBb0QsRUFDcEQsc0JBQTBEO1FBNlZ0RCxzQkFBaUIsR0FBcUIsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNoRCxrQkFBYSxHQUErQixFQUFFLENBQUM7UUFFL0MsaUJBQVksR0FBMkIsRUFBRSxDQUFDO1FBSzFDLGFBQVEsR0FBcUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRSx1QkFBa0IsR0FBZSxFQUFFLENBQUM7UUFFcEMsYUFBUSxHQUF1QixFQUFFLENBQUM7UUFFbEMsb0JBQWUsR0FBd0MsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDdkUsd0JBQW1CLEdBQUcs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QU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1FBQ2hELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDUixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLFdBQVcsQ0FBQyxDQUFDO1NBQ3hEO2FBQU07WUFDSCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUM5QixJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDdkM7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3RFLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDbkM7SUFDTCxDQUFDO0NBd0JKO0FBbFlELDRCQWtZQyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHBzIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRXhlY3V0b3JTeXN0ZW0sIGdsb2JhbEVkaXRvclN5c3RlbSB9IGZyb20gJy4uL2VkaXRvci1zeXN0ZW1qcyc7XG5pbXBvcnQgeyBVUkwgfSBmcm9tICd1cmwnO1xuaW1wb3J0IHsgTG9hZGVyQ29udGV4dCB9IGZyb20gJ0Bjb2Nvcy9jcmVhdG9yLXByb2dyYW1taW5nLXF1aWNrLXBhY2svbGliL3V0aWxzL2xvYWRlci1jb250ZXh0JztcbmltcG9ydCB7IFF1aWNrUGFja0xvYWRlciB9IGZyb20gJ0Bjb2Nvcy9jcmVhdG9yLXByb2dyYW1taW5nLXF1aWNrLXBhY2svbGliL2xvYWRlcic7XG5pbXBvcnQgeyBQYWNrTW9kSW5zdGFudGlhdGlvbiwgUGFja01vZHVsZUV2YWx1YXRvciB9IGZyb20gJy4vcGFjay1tb2QtaW5zdGFudGlhdGlvbic7XG5cbnR5cGUgSW1wb3J0RW5naW5lTW9kID0gKGlkOiBzdHJpbmcpID0+IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj47XG5cbi8vIGAnY2MnYCDnmoQgVVJMXG5jb25zdCBlbmdpbmVJbmRleFVSTCA9IGBjY2U6L2ludGVybmFsL3gvY2NgO1xuLy8g5byV5pOO5Yqf6IO95Y2V5YWD5qih5Z2X55qEIFVSTCDliY3nvIBcbmNvbnN0IGVuZ2luZUZlYXR1cmVVbml0c1ByZWZpeCA9IGBjY2U6L2ludGVybmFsL3gvY2MtZnUvYDtcbi8vIOW8leaTjuWFrOW8gOiHs+e8lui+keWZqOeahOaooeWdl+eahCBVUkwg5YmN57yAXG5jb25zdCBlbmdpbmVFeHBvcnRUb0VkaXRvclByZWZpeCA9IGBjY2U6L2ludGVybmFsL3gvZW5naW5lLWV4cG9ydC10by1lZGl0b3IvYDtcbi8vIOe8lui+keWZqOWFrOW8gOe7memhueebrueahOaooeWdl+eahCBVUkwg5YmN57yAXG5jb25zdCBlZGl0b3JFeHBvcnRUb1Byb2plY3RQcmVmaXggPSBgY2NlOi9pbnRlcm5hbC94L2VkaXRvci1leHBvcnQtdG8tcHJvamVjdC9gO1xuLy8g6aG555uu6Lev5b6E55u45YWzIFVSTCDliY3nvIBcbmNvbnN0IHByb2plY3RVcmxQcmVmaXggPSAnY2NlOi9pbnRlcm5hbC94L3Byb2plY3QvJztcblxuY29uc3QgcGFja1Jlc291cmNlQmFzZVVSTCA9IG5ldyBVUkwoJ3BhY2s6Ly8vJyk7XG5cbnR5cGUgSW1wb3J0RXhjZXB0aW9uSGFuZGxlciA9IChlcnI6IHVua25vd24pID0+IHZvaWQ7XG5cbmNvbnN0IGRlZmF1bHRJbXBvcnRFeGNlcHRpb25IYW5kbGVyOiBJbXBvcnRFeGNlcHRpb25IYW5kbGVyID0gKGVycjogdW5rbm93bikgPT4ge1xuICAgIGNvbnNvbGUud2FybihlcnIpO1xufTtcblxuLyoqXG4gKiDohJrmnKzmj5Lku7bmm7TmlrDkv6Hmga/vvIxjaGFuZ2VzIOS4reWMheWQq+a3u+WKoOS4juS/ruaUueeahOaPkuS7tu+8jHJlbW92YWxzIOS4reWMheWQq+WIoOmZpOeahOaPkuS7tlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElQbHVnaW5DaGFuZ2VkSW5mbyB7XG4gICAgLyoqXG4gICAgICog5omA5pyJ6KaB5L+u5pS555qE77yI5oiW5paw5aKe55qE77yJ5o+S5Lu26ISa5pys44CCXG4gICAgICovXG4gICAgY2hhbmdlczogUmVjb3JkPFBsdWdpblNjcmlwdElkLCBQbHVnaW5TY3JpcHRJbmZvPlxuICAgIC8qKlxuICAgICAqIOaJgOacieimgeenu+mZpOeahOaPkuS7tuiEmuacrOOAglxuICAgICAqL1xuICAgIHJlbW92YWxzOiBQbHVnaW5TY3JpcHRJZFtdO1xufVxuXG5leHBvcnQgY2xhc3MgRXhlY3V0b3Ige1xuICAgIHByaXZhdGUgc3RhdGljIF9pbnN0OiBFeGVjdXRvcjtcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGNyZWF0ZShvcHRpb25zOiBFeGVjdXRvci5PcHRpb25zKSB7XG4gICAgICAgIGlmIChFeGVjdXRvci5faW5zdCkge1xuICAgICAgICAgICAgcmV0dXJuIEV4ZWN1dG9yLl9pbnN0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGV4ZWN1dG9yID0gRXhlY3V0b3IuX2luc3QgPSBuZXcgRXhlY3V0b3IoXG4gICAgICAgICAgICBvcHRpb25zLnF1aWNrUGFja0xvYWRlckNvbnRleHQsXG4gICAgICAgICAgICBvcHRpb25zLnBhY2tNb2R1bGVFdmFsdWF0b3IsXG4gICAgICAgICAgICBvcHRpb25zLmltcG9ydEV4Y2VwdGlvbkhhbmRsZXIsXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IGV4ZWN1dG9yLl9pbml0aWFsaXplKG9wdGlvbnMpO1xuICAgICAgICByZXR1cm4gZXhlY3V0b3I7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcbiAgICAgICAgcXVpY2tQYWNrTG9hZGVyQ29udGV4dDogTG9hZGVyQ29udGV4dCxcbiAgICAgICAgcGFja01vZHVsZUV2YWx1YXRvcjogUGFja01vZHVsZUV2YWx1YXRvciB8IHVuZGVmaW5lZCxcbiAgICAgICAgaW1wb3J0RXhjZXB0aW9uSGFuZGxlcjogSW1wb3J0RXhjZXB0aW9uSGFuZGxlciB8IHVuZGVmaW5lZCxcbiAgICApIHtcbiAgICAgICAgdGhpcy5fZWRpdG9yU3lzdGVtID0gZ2xvYmFsRWRpdG9yU3lzdGVtO1xuICAgICAgICB0aGlzLl9sb2dnZXIgPSB7fTtcblxuICAgICAgICBjb25zdCBxdWlja1BhY2tMb2FkZXIgPSBuZXcgUXVpY2tQYWNrTG9hZGVyKHF1aWNrUGFja0xvYWRlckNvbnRleHQpO1xuICAgICAgICB0aGlzLl9wYWNrTG9hZGVyID0gcXVpY2tQYWNrTG9hZGVyO1xuICAgICAgICB0aGlzLl9wYWNrTW9kSW5zdGFudGlhdGlvbiA9IG5ldyBQYWNrTW9kSW5zdGFudGlhdGlvbihxdWlja1BhY2tMb2FkZXIsIHRoaXMuX2VkaXRvclN5c3RlbSwgcGFja01vZHVsZUV2YWx1YXRvcik7XG5cbiAgICAgICAgdGhpcy5faW1wb3J0RXhjZXB0aW9uSGFuZGxlciA9IGltcG9ydEV4Y2VwdGlvbkhhbmRsZXIgPz8gZGVmYXVsdEltcG9ydEV4Y2VwdGlvbkhhbmRsZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfaW5pdGlhbGl6ZShvcHRpb25zOiBFeGVjdXRvci5PcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmJlZm9yZVVucmVnaXN0ZXJDbGFzcykge1xuICAgICAgICAgICAgdGhpcy5fYmVmb3JlVW5yZWdpc3RlckNsYXNzID0gb3B0aW9ucy5iZWZvcmVVbnJlZ2lzdGVyQ2xhc3M7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9hZGRJbnN0YW50aWF0aW9uSGFuZGxlcnMob3B0aW9ucy5pbXBvcnRFbmdpbmVNb2QpO1xuXG4gICAgICAgIHRoaXMuX2NjZU1vZHVsZU1hcCA9IG9wdGlvbnMuY2NlTW9kdWxlTWFwO1xuICAgICAgICB0aGlzLl9maXhlZEltcG9ydE1hcC5pbXBvcnRzWydjYyddID0gZW5naW5lSW5kZXhVUkw7XG4gICAgICAgIHRoaXMuX2ZpeGVkSW1wb3J0TWFwLmltcG9ydHNbJ2NjL2VudiddID0gYCR7ZW5naW5lRXhwb3J0VG9FZGl0b3JQcmVmaXh9Y2MvZWRpdG9yL3BvcHVsYXRlLWludGVybmFsLWNvbnN0YW50c2A7XG4gICAgICAgIC8vIFRPRE86IGRlcHJlY2F0ZWQgY2NlLmVudiBpcyBvbmx5IGxpdmUgaW4gMy4wLXByZXZpZXdcbiAgICAgICAgdGhpcy5fZml4ZWRJbXBvcnRNYXAuaW1wb3J0c1snY2NlLmVudiddID0gdGhpcy5fZml4ZWRJbXBvcnRNYXAuaW1wb3J0c1snY2MvZW52J107XG4gICAgICAgIGNvbnN0IHByb2plY3RDdXN0b21NYWNyb1VSTCA9IG5ldyBVUkwoJy4vdGVtcC9wcm9ncmFtbWluZy9jdXN0b20tbWFjcm8uanMnLCBwcm9qZWN0VXJsUHJlZml4KTtcbiAgICAgICAgdGhpcy5fZml4ZWRJbXBvcnRNYXAuaW1wb3J0c1snY2MvdXNlcmxhbmQvbWFjcm8nXSA9IHByb2plY3RDdXN0b21NYWNyb1VSTC5ocmVmO1xuXG4gICAgICAgIGZvciAoY29uc3QgW21vZHVsZU5hbWUsIG1vZHVsZUNvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fY2NlTW9kdWxlTWFwKSkge1xuICAgICAgICAgICAgaWYgKG1vZHVsZU5hbWUgPT09ICdtYXBMb2NhdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2ZpeGVkSW1wb3J0TWFwLmltcG9ydHNbbW9kdWxlTmFtZV0gPSBgJHtlZGl0b3JFeHBvcnRUb1Byb2plY3RQcmVmaXh9JHttb2R1bGVOYW1lfWA7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2ZW5kZXJPbkxvYWQgPSBTeXN0ZW0uY29uc3RydWN0b3IucHJvdG90eXBlLm9ubG9hZDtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIFN5c3RlbS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUub25sb2FkID0gZnVuY3Rpb24gKC4uLmFyZ3M6IFBhcmFtZXRlcnM8RXhlY3V0b3JbJ19vbk1vZHVsZUxvYWRlZCddPikge1xuICAgICAgICAgICAgc2VsZi5fb25Nb2R1bGVMb2FkZWQoLi4uYXJncyk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZlbmRlck9uTG9hZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHZlbmRlck9uTG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IG9wdGlvbnMubG9nZ2VyIHx8IHt9O1xuICAgIH1cblxuICAgIHByaXZhdGUgX2FkZEluc3RhbnRpYXRpb25IYW5kbGVycyhpbXBvcnRlcjogSW1wb3J0RW5naW5lTW9kKSB7XG4gICAgICAgIC8vIOWkhOeQhumhueebrumHjOeahOiHquWumuS5iemFjee9ruaooeWdl++8jOavlOWmgiBjdXN0b20tbWFjcm8g5qih5Z2XXG4gICAgICAgIHRoaXMuX2VkaXRvclN5c3RlbS5hZGRJbnN0YW50aWF0aW9uSGFuZGxlcigodXJsKSA9PiB7XG4gICAgICAgICAgICBpZiAodXJsLnN0YXJ0c1dpdGgocHJvamVjdFVybFByZWZpeCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgcXVpY2tDb21waWxlclJlcXVlc3QgPSB1cmwuc3Vic3RyKHByb2plY3RVcmxQcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBxdWlja0NvbXBpbGVyUmVxdWVzdCA9IHBzLmpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgcXVpY2tDb21waWxlclJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIHJlcXVpcmUocXVpY2tDb21waWxlclJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZGl0b3JTeXN0ZW0uZ2V0UmVnaXN0ZXIoKSBhcyBNb2R1bGVSZWdpc3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIOWkhOeQhuW8leaTjuaooeWdl+eahOWunuS+i+WMllxuICAgICAgICB0aGlzLl9lZGl0b3JTeXN0ZW0uYWRkSW5zdGFudGlhdGlvbkhhbmRsZXIoYXN5bmMgKHVybCkgPT4ge1xuICAgICAgICAgICAgbGV0IHF1aWNrQ29tcGlsZXJSZXF1ZXN0ID0gJyc7XG4gICAgICAgICAgICBpZiAodXJsLnN0YXJ0c1dpdGgoZW5naW5lRmVhdHVyZVVuaXRzUHJlZml4KSkge1xuICAgICAgICAgICAgICAgIHF1aWNrQ29tcGlsZXJSZXF1ZXN0ID0gdXJsO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1cmwuc3RhcnRzV2l0aChlbmdpbmVFeHBvcnRUb0VkaXRvclByZWZpeCkpIHtcbiAgICAgICAgICAgICAgICBxdWlja0NvbXBpbGVyUmVxdWVzdCA9IHVybC5zdWJzdHIoZW5naW5lRXhwb3J0VG9FZGl0b3JQcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxdWlja0NvbXBpbGVyUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbW10sIChfZXhwb3J0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwb3J0cyA9IGF3YWl0IGltcG9ydGVyKHF1aWNrQ29tcGlsZXJSZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZXhwb3J0KGV4cG9ydHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g5aSE55CGIFBhY2tlciDph4znmoTmqKHlnZfnmoTlrp7kvovljJZcbiAgICAgICAgY29uc3QgcGFja1Jlc291cmNlQmFzZVVSTFN0cmluZyA9IHBhY2tSZXNvdXJjZUJhc2VVUkwuaHJlZjtcbiAgICAgICAgdGhpcy5fZWRpdG9yU3lzdGVtLmFkZEluc3RhbnRpYXRpb25IYW5kbGVyKGFzeW5jICh1cmwpID0+IHtcbiAgICAgICAgICAgIGlmICh1cmwuc3RhcnRzV2l0aChwYWNrUmVzb3VyY2VCYXNlVVJMU3RyaW5nKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSB1cmwuc2xpY2UocGFja1Jlc291cmNlQmFzZVVSTFN0cmluZy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2lzdGVyID0gYXdhaXQgdGhpcy5fcGFja01vZEluc3RhbnRpYXRpb24uaW5zdGFudGlhdGUobGluayk7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5zdGFudGlhdGVkUGFja01vZHMucHVzaCh1cmwpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fZWRpdG9yU3lzdGVtLmFkZEluc3RhbnRpYXRpb25IYW5kbGVyKGFzeW5jICh1cmwpID0+IHtcbiAgICAgICAgICAgIGlmICh1cmwuc3RhcnRzV2l0aChlZGl0b3JFeHBvcnRUb1Byb2plY3RQcmVmaXgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlTmFtZSA9IHVybC5zbGljZShlZGl0b3JFeHBvcnRUb1Byb2plY3RQcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVDb25maWcgPSB0aGlzLl9jY2VNb2R1bGVNYXBbbW9kdWxlTmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3QgbWFwTG9jYXRpb24gPSB0aGlzLl9jY2VNb2R1bGVNYXAubWFwTG9jYXRpb247XG4gICAgICAgICAgICAgICAgaWYgKG1vZHVsZUNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBvcnRlZE9iaiA9IHJlcXVpcmUocHMuam9pbihwcy5kaXJuYW1lKG1hcExvY2F0aW9uKSwgbW9kdWxlQ29uZmlnLm1haW4pKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtbXSwgKF9leHBvcnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZTogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZXhwb3J0KGV4cG9ydGVkT2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkUG9seWZpbGxGaWxlKGZpbGU6IHN0cmluZykge1xuICAgICAgICByZXF1aXJlKGZpbGUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBwcmVwYXJlKCkge1xuICAgICAgICBsZXQgdW5sb2NrUHJvbWlzZTogKCgpID0+IFByb21pc2U8dm9pZD4pIHwgdW5kZWZpbmVkO1xuICAgICAgICBjb25zb2xlLmRlYnVnKCdbW0V4ZWN1dG9yXV0gcHJlcGFyZSBiZWZvcmUgbG9jaycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8g5aSa6L+b56iL5pON5L2c5ZCM5LiA5Liq6LWE5rqQ44CC5aaC5p6c5LiN57uZ5paH5Lu25Yqg6ZSB77yM5Lya5a+86Ie05paH5Lu26K+75YaZ5Yay56qBXG4gICAgICAgICAgICB1bmxvY2tQcm9taXNlID0gYXdhaXQgdGhpcy5fcGFja01vZEluc3RhbnRpYXRpb24ubG9jaygpO1xuICAgICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW1tFeGVjdXRvcl1dIHByZXBhcmUgbG9jayBmYWlsZWQ6ICR7ZXJyfSwgc3RhY2s6ICR7ZXJyLnN0YWNrfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5fcmVsb2FkUGFja01vZHMoKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHVubG9ja1Byb21pc2UpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB1bmxvY2tQcm9taXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbW0V4ZWN1dG9yXV0gcHJlcGFyZSB1bmxvY2sgZmFpbGVkOiAke2Vycn0sIHN0YWNrOiAke2Vyci5zdGFja31gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmRlYnVnKCdbW0V4ZWN1dG9yXV0gcHJlcGFyZSBhZnRlciB1bmxvY2snKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgaW1wb3J0KHVybDogc3RyaW5nKTogUHJvbWlzZTx1bmtub3duPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9lZGl0b3JTeXN0ZW0uaW1wb3J0KHVybCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6YeN5paw6K+75Y+WIFBhY2tlciDnmoTlhoXlrrnlubbph43mlrDmiafooYzmiYDmnInpobnnm67ohJrmnKzlkozmj5Lku7bohJrmnKzjgIJcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgcmVsb2FkKCkge1xuICAgICAgICBjb25zdCBvbkNsYXNzUmVnaXN0ZXJlZDogRWRpdG9yRXh0ZW5kcy5MaXN0ZW5lcjwnY2xhc3MtcmVnaXN0ZXJlZCc+ID0gKGNsYXNzQ29uc3RydWN0b3IsIG1ldGFkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlcmVkQ2xhc3Nlcy5wdXNoKGNsYXNzQ29uc3RydWN0b3IpO1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgW1tFeGVjdXRvcl1dIFJlZ2lzdGVyICR7Y2xhc3NDb25zdHJ1Y3Rvci5uYW1lfWApO1xuICAgICAgICAgICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgKHRoaXMuX2NsYXNzVXVpZE1hcFttZXRhZGF0YS51dWlkXSA/Pz0gW10pLnB1c2goY2xhc3NDb25zdHJ1Y3Rvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IHVubG9ja1Byb21pc2U6ICgoKSA9PiBQcm9taXNlPHZvaWQ+KSB8IHVuZGVmaW5lZDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIOmcgOimgeS7jui/memHjOW8gOWni+S4iumUgVxuICAgICAgICAgICAgLy8g5LmL5YmN5Y+q5ZyoIF9yZWxvYWRQYWNrTW9kcyDkuIrplIHvvIzlj6/og73kvJrlr7zoh7TlkI7pnaIgX2ltcG9ydFByZXJlcXVpc2l0ZU1vZHVsZXMg55qE6YC76L6R5L2/55So5Yiw6ZSZ6K+v55qEIGNodW5rXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKCdbW0V4ZWN1dG9yXV0gcmVsb2FkIGJlZm9yZSBsb2NrJyk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vIOWkmui/m+eoi+aTjeS9nOWQjOS4gOS4qui1hOa6kOOAguWmguaenOS4jee7meaWh+S7tuWKoOmUge+8jOS8muWvvOiHtOaWh+S7tuivu+WGmeWGsueqgVxuICAgICAgICAgICAgICAgIHVubG9ja1Byb21pc2UgPSBhd2FpdCB0aGlzLl9wYWNrTW9kSW5zdGFudGlhdGlvbi5sb2NrKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtbRXhlY3V0b3JdXSBsb2NrIGZhaWxlZDogJHtlcnJ9LCBzdGFjazogJHtlcnIuc3RhY2t9YCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEVkaXRvckV4dGVuZHMub24oJ2NsYXNzLXJlZ2lzdGVyZWQnLCBvbkNsYXNzUmVnaXN0ZXJlZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3JlbG9hZFBhY2tNb2RzKCk7XG4gICAgXG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKGBJbnZhbGlkYXRlIGFsbCBtb2R1bGVzYCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9pbnZhbGlkYXRlQWxsTW9kdWxlcygpO1xuICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgIFxuICAgICAgICAgICAgdGhpcy5faW52YWxpZGF0ZUFsbFBsdWdpbnMoKTtcbiAgICBcbiAgICAgICAgICAgIHRoaXMuX2xvYWRBbGxQbHVnaW5zKCk7XG4gICAgXG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKGBJbXBvcnRzIGFsbCBtb2R1bGVzYCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9pbXBvcnRQcmVyZXF1aXNpdGVNb2R1bGVzKCk7XG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW1tFeGVjdXRvcl1dIGZhaWxlZCB0byByZWxvYWQuYCwgZSk7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgRWRpdG9yRXh0ZW5kcy5yZW1vdmVMaXN0ZW5lcignY2xhc3MtcmVnaXN0ZXJlZCcsIG9uQ2xhc3NSZWdpc3RlcmVkKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHVubG9ja1Byb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdW5sb2NrUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW1tFeGVjdXRvcl1dIHVubG9jayBmYWlsZWQ6ICR7ZXJyfSwgc3RhY2s6ICR7ZXJyLnN0YWNrfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnW1tFeGVjdXRvcl1dIGFmdGVyIHVubG9jaycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog54Ot5pu06ISa5pys5o+S5Lu2XG4gICAgICogQHBhcmFtIGluZm8g6ISa5pys5o+S5Lu25pu05paw5L+h5oGvXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGhvdFJlbG9hZFBsdWdpblNjcmlwdHMoaW5mbz86IElQbHVnaW5DaGFuZ2VkSW5mbykge1xuICAgICAgICBpZiAoaW5mbyAmJiBPYmplY3Qua2V5cyhpbmZvLmNoYW5nZXMpLmxlbmd0aCA9PT0gMCAmJiBpbmZvLnJlbW92YWxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faW52YWxpZGF0ZUFsbFBsdWdpbnMoKTtcblxuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9wbHVnaW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy5fcGx1Z2luc1tpXTtcbiAgICAgICAgICAgICAgICAvLyDlupTnlKjkv67mlLlcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5yZW1vdmFscy5pbmNsdWRlcyhwbHVnaW4udXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGx1Z2lucy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5mby5jaGFuZ2VzW3BsdWdpbi51dWlkXSkge1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHBsdWdpbiwgaW5mby5jaGFuZ2VzW3BsdWdpbi51dWlkXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5fbG9hZEFsbFBsdWdpbnMoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNNb2R1bGUoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gaWQgaW4gdGhpcy5fbW9kdWxlcztcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuX2ludmFsaWRhdGVBbGxQbHVnaW5zKCk7XG4gICAgICAgIHRoaXMuX3BsdWdpbnMgPSBbXTtcbiAgICAgICAgYXdhaXQgdGhpcy5faW52YWxpZGF0ZUFsbE1vZHVsZXMoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0UGx1Z2luU2NyaXB0cyAocGx1Z2luczogUGx1Z2luU2NyaXB0SW5mb1tdKSB7XG4gICAgICAgIHRoaXMuX2ludmFsaWRhdGVBbGxQbHVnaW5zKCk7XG4gICAgICAgIHRoaXMuX3BsdWdpbnMgPSBwbHVnaW5zO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOafpeaJvuaMh+WumuiEmuacrOaooeWdl+S4reazqOWGjOeahOaJgOaciSBjYyDnsbvjgIJcbiAgICAgKiBAcGFyYW0gdXVpZCDmqKHlnZfnmoQgdXVpZOOAglxuICAgICAqIEByZXR1cm5zIOaMh+WumuiEmuacrOaooeWdl+S4reazqOWGjOeahOaJgOaciSBjYyDnsbvvvJvlpoLmnpwgW3V1aWRdIOW5tuS4jeWvueW6lOS4gOS4quaooeWdl+aIluaooeWdl+S4reacquazqOWGjOS7u+S9leexu+WImei/lOWbniBgdW5kZWZpbmVkYOOAglxuICAgICAqL1xuICAgIHB1YmxpYyBxdWVyeUNsYXNzZXNJbk1vZHVsZSh1dWlkOiBzdHJpbmcpOiB1bmRlZmluZWQgfCBSZWFkb25seUFycmF5PFJlYWRvbmx5PEZ1bmN0aW9uPj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2xhc3NVdWlkTWFwW3V1aWRdO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX3JlbG9hZFBhY2tNb2RzKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fcGFja01vZEluc3RhbnRpYXRpb24ucmVsb2FkKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2VkaXRvclN5c3RlbS5jbGVhckltcG9ydE1hcCgpO1xuXG4gICAgICAgICAgICBjb25zdCBxdWlja1BhY2tMb2FkZXJJbXBvcnRNYXAgPSBhd2FpdCB0aGlzLl9wYWNrTW9kSW5zdGFudGlhdGlvbi5nZXRJbXBvcnRNYXAoKTtcbiAgICAgICAgICAgIHRoaXMuX2VkaXRvclN5c3RlbS5leHRlbmRJbXBvcnRNYXAocXVpY2tQYWNrTG9hZGVySW1wb3J0TWFwLCBuZXcgVVJMKHRoaXMuX3BhY2tMb2FkZXIuaW1wb3J0TWFwVVJMLCBwYWNrUmVzb3VyY2VCYXNlVVJMKS5ocmVmKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5fZWRpdG9yU3lzdGVtLmV4dGVuZEltcG9ydE1hcCh0aGlzLl9maXhlZEltcG9ydE1hcCwgdGhpcy5fZW5naW5lSW1wb3J0TWFwVVJMKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzb2x1dGlvbkRldGFpbE1hcCA9IGF3YWl0IHRoaXMuX3BhY2tMb2FkZXIubG9hZFJlc29sdXRpb25EZXRhaWxNYXAoKTtcbiAgICAgICAgICAgIHRoaXMuX2VkaXRvclN5c3RlbS5zZXRSZXNvbHV0aW9uRGV0YWlsTWFwKHJlc29sdXRpb25EZXRhaWxNYXAsIG5ldyBVUkwodGhpcy5fcGFja0xvYWRlci5yZXNvbHV0aW9uRGV0YWlsTWFwVVJMLCBwYWNrUmVzb3VyY2VCYXNlVVJMKS5ocmVmKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYF9yZWxvYWRQYWNrTW9kcywgcmVsb2FkIGZhaWxlZDogJHtlcnJ9LCBzdGFjazogJHtlcnIuc3RhY2t9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9pbnZhbGlkYXRlQWxsTW9kdWxlcygpIHtcbiAgICAgICAgY29uc3QgY2MgPSBhd2FpdCBTeXN0ZW0uaW1wb3J0KCdjYycpIGFzIEVuZ2luZUV4cG9ydHM7XG5cbiAgICAgICAgZm9yIChjb25zdCByZWdpc3RlcmVkQ2xhc3Mgb2YgdGhpcy5fcmVnaXN0ZXJlZENsYXNzZXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9iZWZvcmVVbnJlZ2lzdGVyQ2xhc3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9iZWZvcmVVbnJlZ2lzdGVyQ2xhc3MocmVnaXN0ZXJlZENsYXNzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNjLmpzLnVucmVnaXN0ZXJDbGFzcyhyZWdpc3RlcmVkQ2xhc3MpO1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgVW5yZWdpc3RlciAke3JlZ2lzdGVyZWRDbGFzcy5uYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyZWRDbGFzc2VzID0gW107XG5cbiAgICAgICAgdGhpcy5fY2xhc3NVdWlkTWFwID0ge307XG5cbiAgICAgICAgY2MuY2NsZWdhY3kuX1JGLnJlc2V0KCk7XG5cbiAgICAgICAgdGhpcy5faW52YWxpZGF0ZUFsbFBhY2tNb2RzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW52YWxpZGF0ZUFsbFBhY2tNb2RzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IHBhY2tNb2RJZCBvZiB0aGlzLl9pbnN0YW50aWF0ZWRQYWNrTW9kcykge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgSW52YWxpZGF0aW5nICcke3BhY2tNb2RJZH0nYCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBTeXN0ZW0uZGVsZXRlKHBhY2tNb2RJZCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoYE5vdGU6IGZhaWxlZCB0byBkZWxldGUgJHtwYWNrTW9kSWR9LCBtYXliZSBpdCdzIGJlaW5nIGV4ZWN1dGluZz9gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pbnN0YW50aWF0ZWRQYWNrTW9kcy5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2ltcG9ydFByZXJlcXVpc2l0ZU1vZHVsZXMoKSB7XG4gICAgICAgIGNvbnN0IGNjID0gYXdhaXQgU3lzdGVtLmltcG9ydCgnY2MnKSBhcyBFbmdpbmVFeHBvcnRzO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBTeXN0ZW0uaW1wb3J0KCdjY2U6L2ludGVybmFsL3gvcHJlcmVxdWlzaXRlLWltcG9ydHMnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyOiB1bmtub3duKSB7XG4gICAgICAgICAgICB0aGlzLl9pbXBvcnRFeGNlcHRpb25IYW5kbGVyKGVycik7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLl9jYWNoZWRFeGNlcHRpb25zLmNsZWFyKCk7XG4gICAgICAgICAgICAvLyDpobnnm67ohJrmnKzlj6/og73lnKjmiafooYznmoTml7blgJnkvJrmipvlh7rlvILluLjvvIzov5nlr7zoh7QgYGNjLl9SRmAg5rKh5pyJ5q2j56Gu5by55Ye644CCXG4gICAgICAgICAgICAvLyDmiJHku6zlnKjmnIDlkI7muIXnkIbkuIDkuIvjgIJcbiAgICAgICAgICAgIGNjLmNjbGVnYWN5Ll9SRi5yZXNldCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfbG9hZEFsbFBsdWdpbnMoKSB7XG4gICAgICAgIGNvbnN0IHNvcnRlZE1hcHBlZCA9IHRoaXMuX3BsdWdpbnMubWFwKChwbHVnaW5TY3JpcHQpID0+IHBsdWdpblNjcmlwdC5maWxlKTtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIHNvcnRlZE1hcHBlZCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlKGZpbGUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX2ludmFsaWRhdGVBbGxQbHVnaW5zKCkge1xuICAgICAgICBmb3IgKGNvbnN0IFssIHBsdWdpblNjcmlwdEluZm9dIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuX3BsdWdpbnMpKSB7XG4gICAgICAgICAgICBkZWxldGUgcmVxdWlyZS5jYWNoZVtwbHVnaW5TY3JpcHRJbmZvLmZpbGVdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdHJ5TG9nPENhdCBleHRlbmRzIGtleW9mIEV4ZWN1dG9yLkxvZ2dlcj4oY2F0OiBDYXQsIC4uLmFyZ3M6IFBhcmFtZXRlcnM8Tm9uTnVsbGFibGU8RXhlY3V0b3IuTG9nZ2VyW0NhdF0+Pikge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHJldHVybiAoY2F0IGluIHRoaXMuX2xvZ2dlcikgPyB0aGlzLl9sb2dnZXJbY2F0XSEoLi4uYXJncykgOiB0aGlzLl9kZWZhdWx0TG9nKC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2RlZmF1bHRMb2coLi4uYXJnczogYW55KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX29uTW9kdWxlTG9hZGVkKGVycm9yOiBFcnJvciwgaWQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBjYWNoZWRFeGNlcHRpb25zID0gdGhpcy5fY2FjaGVkRXhjZXB0aW9ucztcbiAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgW1tFeGVjdXRvcl1dIE1vZHVsZSBcIiR7aWR9XCIgbG9hZGVkLmApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFjYWNoZWRFeGNlcHRpb25zLmhhcyhlcnJvcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbXBvcnRFeGNlcHRpb25IYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3RyeUxvZygnbG9hZEV4Y2VwdGlvbicsIGlkLCBlcnJvciwgY2FjaGVkRXhjZXB0aW9ucy5oYXMoZXJyb3IpKTtcbiAgICAgICAgICAgIGNhY2hlZEV4Y2VwdGlvbnMuc2V0KGVycm9yLCBpZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRlY2xhcmUgX3BhY2tNb2RJbnN0YW50aWF0aW9uOiBQYWNrTW9kSW5zdGFudGlhdGlvbjtcblxuICAgIHByaXZhdGUgX2JlZm9yZVVucmVnaXN0ZXJDbGFzcz86IEV4ZWN1dG9yLkJlZm9yZVVucmVnaXN0ZXJDbGFzcztcbiAgICBwcml2YXRlIF9jYWNoZWRFeGNlcHRpb25zOiBNYXA8YW55LCBzdHJpbmc+ID0gbmV3IE1hcCgpO1xuICAgIHByaXZhdGUgX2NsYXNzVXVpZE1hcDogUmVjb3JkPHN0cmluZywgRnVuY3Rpb25bXT4gPSB7fTtcbiAgICBwcml2YXRlIF9sb2dnZXI6IFBhcnRpYWw8RXhlY3V0b3IuTG9nZ2VyPjtcbiAgICBwcml2YXRlIF9idWlsdGluTW9kczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuXG4gICAgcHJpdmF0ZSBfaW1wb3J0RXhjZXB0aW9uSGFuZGxlcjogSW1wb3J0RXhjZXB0aW9uSGFuZGxlcjtcblxuICAgIHByaXZhdGUgX2VkaXRvclN5c3RlbTogRXhlY3V0b3JTeXN0ZW07XG4gICAgcHJpdmF0ZSBfbW9kdWxlczogUmVjb3JkPHN0cmluZywgTW9kdWxlU2NyaXB0SW5mbz4gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHByaXZhdGUgX3JlZ2lzdGVyZWRDbGFzc2VzOiBGdW5jdGlvbltdID0gW107XG5cbiAgICBwcml2YXRlIF9wbHVnaW5zOiBQbHVnaW5TY3JpcHRJbmZvW10gPSBbXTtcblxuICAgIHByaXZhdGUgX2ZpeGVkSW1wb3J0TWFwOiB7IGltcG9ydHM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfSA9IHsgaW1wb3J0czoge30gfTtcbiAgICBwcml2YXRlIF9lbmdpbmVJbXBvcnRNYXBVUkwgPSAnJztcblxuICAgIHByaXZhdGUgX3BhY2tMb2FkZXI6IFF1aWNrUGFja0xvYWRlcjtcbiAgICBwcml2YXRlIF9pbnN0YW50aWF0ZWRQYWNrTW9kczogc3RyaW5nW10gPSBbXTtcbiAgICBwcml2YXRlIF9jY2VNb2R1bGVNYXA6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBFeGVjdXRvciB7XG4gICAgZXhwb3J0IHR5cGUgQmVmb3JlVW5yZWdpc3RlckNsYXNzID0gKGNsYXNzQ29uc3RydWN0b3I6IEZ1bmN0aW9uKSA9PiB2b2lkO1xuXG4gICAgZXhwb3J0IGludGVyZmFjZSBSZXBvcnRlck1hcCB7XG4gICAgICAgIFsncG9zc2libGUtY3ItdXNlJ106IHtcbiAgICAgICAgICAgIGltcG9ydGVkOiBzdHJpbmc7XG4gICAgICAgICAgICBtb2R1bGVSZXF1ZXN0OiBzdHJpbmc7XG4gICAgICAgICAgICBpbXBvcnRNZXRhOiBhbnk7XG4gICAgICAgICAgICBleHRyYXM6IGFueTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBleHBvcnQgdHlwZSBMb2dnZXIgPSBQYXJ0aWFsPHtcbiAgICAgICAgcG9zc2libGVDaXJjdWxhclJlZmVyZW5jZTogKFxuICAgICAgICAgICAgaW1wb3J0ZWQ6IHN0cmluZyxcbiAgICAgICAgICAgIG1vZHVsZVJlcXVlc3Q6IHN0cmluZyxcbiAgICAgICAgICAgIGltcG9ydE1ldGE6IGFueSxcbiAgICAgICAgICAgIGV4dHJhczogYW55XG4gICAgICAgICkgPT4gdm9pZDtcblxuICAgICAgICBsb2FkRXhjZXB0aW9uOiAoXG4gICAgICAgICAgICBtb2R1bGVVcmw6IHN0cmluZyxcbiAgICAgICAgICAgIGVycm9yPzogYW55LFxuICAgICAgICAgICAgaGFzQmVlblRocm93bj86IGJvb2xlYW4sXG4gICAgICAgICkgPT4gdm9pZDtcbiAgICB9PjtcblxuICAgIGV4cG9ydCBpbnRlcmZhY2UgT3B0aW9ucyB7XG4gICAgICAgIGltcG9ydEVuZ2luZU1vZDogSW1wb3J0RW5naW5lTW9kO1xuICAgICAgICBxdWlja1BhY2tMb2FkZXJDb250ZXh0OiBMb2FkZXJDb250ZXh0O1xuICAgICAgICBiZWZvcmVVbnJlZ2lzdGVyQ2xhc3M/OiBCZWZvcmVVbnJlZ2lzdGVyQ2xhc3M7XG4gICAgICAgIHBhY2tNb2R1bGVFdmFsdWF0b3I/OiBQYWNrTW9kdWxlRXZhbHVhdG9yO1xuICAgICAgICBsb2dnZXI/OiBMb2dnZXI7XG4gICAgICAgIGltcG9ydEV4Y2VwdGlvbkhhbmRsZXI/OiAoZXJyOiB1bmtub3duKSA9PiB2b2lkO1xuICAgICAgICBjY2VNb2R1bGVNYXA6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuXG4gICAgZXhwb3J0IGludGVyZmFjZSBFeGVjdXRlSW5mbyB7XG4gICAgICAgIHBvbHlmaWxsczogc3RyaW5nW107XG4gICAgICAgIG1vZHVsZXM6IHN0cmluZ1tdO1xuICAgICAgICBiYXJlU3BlY2lmaWVyUmVzb2x2ZU1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgICAgICAgaW5zdGFudGlhdGVNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gICAgfVxufVxuXG50eXBlIFBsdWdpblNjcmlwdElkID0gc3RyaW5nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBsdWdpblNjcmlwdEluZm8ge1xuICAgIC8qKlxuICAgICAqIOiEmuacrOaWh+S7tuOAglxuICAgICAqL1xuICAgIGZpbGU6IHN0cmluZztcblxuICAgIHV1aWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE1vZHVsZVNjcmlwdEluZm8ge1xuICAgIC8qKlxuICAgICAqIOaooeWdlyBVUkzjgIJcbiAgICAgKi9cbiAgICBtb2R1bGVVcmw6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIOS7o+eggeaWh+S7tuOAglxuICAgICAqL1xuICAgIGZpbGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEVuZ2luZUV4cG9ydHMge1xuICAgIGNjbGVnYWN5OiB7IF9SRjogeyByZXNldCgpOiB2b2lkOyB9IH07XG4gICAganM6IHsgdW5yZWdpc3RlckNsYXNzKGY6IEZ1bmN0aW9uKTogdm9pZDsgfTtcbn1cblxuZGVjbGFyZSBuYW1lc3BhY2UgRWRpdG9yRXh0ZW5kcyB7XG4gICAgaW50ZXJmYWNlIEV2ZW50TWFwIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxlZCB3aGVuIGEgY2MtY2xhc3MgaXMgcmVnaXN0ZXJlZC5cbiAgICAgICAgICogQHBhcmFtIGNsYXNzQ29uc3RydWN0b3IgUmVnaXN0ZXJpbmcgY2xhc3MuXG4gICAgICAgICAqL1xuICAgICAgICAnY2xhc3MtcmVnaXN0ZXJlZCcoY2xhc3NDb25zdHJ1Y3RvcjogRnVuY3Rpb24sIG1ldGFkYXRhPzogUmVhZG9ubHk8YW55Pik6IHZvaWQ7XG4gICAgfVxuXG4gICAgdHlwZSBFdmVudEFyZ3M8RXZlbnROYW1lIGV4dGVuZHMga2V5b2YgRXZlbnRNYXA+ID0gUGFyYW1ldGVyczxFdmVudE1hcFtFdmVudE5hbWVdPjtcblxuICAgIHR5cGUgTGlzdGVuZXI8RXZlbnROYW1lIGV4dGVuZHMga2V5b2YgRXZlbnRNYXA+ID0gKC4uLmFyZ3M6IEV2ZW50QXJnczxFdmVudE5hbWU+KSA9PiB2b2lkO1xuXG4gICAgZnVuY3Rpb24gZW1pdDxFdmVudE5hbWUgZXh0ZW5kcyBrZXlvZiBFdmVudE1hcD4obmFtZTogRXZlbnROYW1lLCAuLi5hcmdzOiBFdmVudEFyZ3M8RXZlbnROYW1lPik6IHZvaWQ7XG5cbiAgICBmdW5jdGlvbiBvbjxFdmVudE5hbWUgZXh0ZW5kcyBrZXlvZiBFdmVudE1hcD4obmFtZTogRXZlbnROYW1lLCBsaXN0ZW5lcjogTGlzdGVuZXI8RXZlbnROYW1lPik6IHZvaWQ7XG5cbiAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcjxFdmVudE5hbWUgZXh0ZW5kcyBrZXlvZiBFdmVudE1hcD4obmFtZTogRXZlbnROYW1lLCBsaXN0ZW5lcjogTGlzdGVuZXI8RXZlbnROYW1lPik6IHZvaWQ7XG59XG4iXX0=