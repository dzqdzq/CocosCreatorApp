"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function $({ template, types }) {
    const templateBuilderOptions = {
        preserveComments: true,
        // @ts-ignore
        syntacticPlaceholders: true,
    };
    const importTemplate = template.statement(`import { cclegacy as %%ccVar%% } from %%ccModule%%;`, templateBuilderOptions);
    const headerTemplate = template.statement(`%%ccVar%%._RF.push({}, %%compressedUUID%%, %%baseName%%, %%importMeta%%);`, templateBuilderOptions);
    const footerTemplate = template.statement(`%%ccVar%%._RF.pop();`, templateBuilderOptions);
    return {
        visitor: {
            Program: (path, state) => {
                const options = state.opts;
                const ccVar = path.scope.generateUid('_cclegacy');
                const imp = importTemplate({
                    ccVar: types.identifier(ccVar),
                    ccModule: types.stringLiteral('cc'),
                });
                const header = headerTemplate({
                    ccVar: types.identifier(ccVar),
                    baseName: types.stringLiteral(options.baseName),
                    compressedUUID: types.stringLiteral(options.compressedUUID),
                    importMeta: options.importMeta ?
                        types.metaProperty(types.identifier('import'), types.identifier('meta')) :
                        types.identifier('undefined'),
                });
                const footer = footerTemplate({
                    ccVar: types.identifier(ccVar),
                });
                path.node.body = [imp, header].concat(path.node.body, [footer]);
            },
        },
    };
}
exports.default = $;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2luLWFubm90YXRlLWNjY2xhc3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYmFiZWwvcGx1Z2luLWFubm90YXRlLWNjY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSxTQUFTLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQWdCO0lBSXhDLE1BQU0sc0JBQXNCLEdBQTJCO1FBQ25ELGdCQUFnQixFQUFFLElBQUk7UUFDdEIsYUFBYTtRQUNiLHFCQUFxQixFQUFFLElBQUk7S0FDOUIsQ0FBQztJQUVGLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQ3JDLHFEQUFxRCxFQUNyRCxzQkFBc0IsQ0FBQyxDQUFDO0lBRTVCLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQ3JDLDJFQUEyRSxFQUMzRSxzQkFBc0IsQ0FBQyxDQUFDO0lBRTVCLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQ3JDLHNCQUFzQixFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFFcEQsT0FBTztRQUNILE9BQU8sRUFBRTtZQUNMLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDckIsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztnQkFDM0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2xELE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQztvQkFDdkIsS0FBSyxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO29CQUM5QixRQUFRLEVBQUUsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7aUJBQ3RDLENBQUMsQ0FBQztnQkFDSCxNQUFNLE1BQU0sR0FBRyxjQUFjLENBQUM7b0JBQzFCLEtBQUssRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQztvQkFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztvQkFDL0MsY0FBYyxFQUFFLEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQztvQkFDM0QsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQzt3QkFDNUIsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUMxRSxLQUFLLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQztpQkFDcEMsQ0FBQyxDQUFDO2dCQUNILE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQztvQkFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO2lCQUNqQyxDQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNwRSxDQUFDO1NBQ0o7S0FDSixDQUFDO0FBQ04sQ0FBQztBQVVELGtCQUFlLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgdHlwZSAqIGFzIGJhYmVsIGZyb20gJ0BiYWJlbC9jb3JlJztcclxuaW1wb3J0IHR5cGUgeyBUZW1wbGF0ZUJ1aWxkZXJPcHRpb25zIH0gZnJvbSAnQGJhYmVsL3RlbXBsYXRlJztcclxuXHJcbmZ1bmN0aW9uICQoeyB0ZW1wbGF0ZSwgdHlwZXMgfTogdHlwZW9mIGJhYmVsKTogYmFiZWwuUGx1Z2luT2JqPHtcclxuICAgIGZpbGVuYW1lOiBzdHJpbmc7XHJcbiAgICBvcHRzOiAkLk9wdGlvbnM7XHJcbn0+IHtcclxuICAgIGNvbnN0IHRlbXBsYXRlQnVpbGRlck9wdGlvbnM6IFRlbXBsYXRlQnVpbGRlck9wdGlvbnMgPSB7XHJcbiAgICAgICAgcHJlc2VydmVDb21tZW50czogdHJ1ZSxcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgc3ludGFjdGljUGxhY2Vob2xkZXJzOiB0cnVlLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBpbXBvcnRUZW1wbGF0ZSA9IHRlbXBsYXRlLnN0YXRlbWVudChcclxuICAgICAgICBgaW1wb3J0IHsgY2NsZWdhY3kgYXMgJSVjY1ZhciUlIH0gZnJvbSAlJWNjTW9kdWxlJSU7YCxcclxuICAgICAgICB0ZW1wbGF0ZUJ1aWxkZXJPcHRpb25zKTtcclxuXHJcbiAgICBjb25zdCBoZWFkZXJUZW1wbGF0ZSA9IHRlbXBsYXRlLnN0YXRlbWVudChcclxuICAgICAgICBgJSVjY1ZhciUlLl9SRi5wdXNoKHt9LCAlJWNvbXByZXNzZWRVVUlEJSUsICUlYmFzZU5hbWUlJSwgJSVpbXBvcnRNZXRhJSUpO2AsXHJcbiAgICAgICAgdGVtcGxhdGVCdWlsZGVyT3B0aW9ucyk7XHJcblxyXG4gICAgY29uc3QgZm9vdGVyVGVtcGxhdGUgPSB0ZW1wbGF0ZS5zdGF0ZW1lbnQoXHJcbiAgICAgICAgYCUlY2NWYXIlJS5fUkYucG9wKCk7YCwgdGVtcGxhdGVCdWlsZGVyT3B0aW9ucyk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB2aXNpdG9yOiB7XHJcbiAgICAgICAgICAgIFByb2dyYW06IChwYXRoLCBzdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHN0YXRlLm9wdHM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjY1ZhciA9IHBhdGguc2NvcGUuZ2VuZXJhdGVVaWQoJ19jY2xlZ2FjeScpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW1wID0gaW1wb3J0VGVtcGxhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNjVmFyOiB0eXBlcy5pZGVudGlmaWVyKGNjVmFyKSxcclxuICAgICAgICAgICAgICAgICAgICBjY01vZHVsZTogdHlwZXMuc3RyaW5nTGl0ZXJhbCgnY2MnKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gaGVhZGVyVGVtcGxhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNjVmFyOiB0eXBlcy5pZGVudGlmaWVyKGNjVmFyKSxcclxuICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZTogdHlwZXMuc3RyaW5nTGl0ZXJhbChvcHRpb25zLmJhc2VOYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2VkVVVJRDogdHlwZXMuc3RyaW5nTGl0ZXJhbChvcHRpb25zLmNvbXByZXNzZWRVVUlEKSxcclxuICAgICAgICAgICAgICAgICAgICBpbXBvcnRNZXRhOiBvcHRpb25zLmltcG9ydE1ldGEgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlcy5tZXRhUHJvcGVydHkodHlwZXMuaWRlbnRpZmllcignaW1wb3J0JyksIHR5cGVzLmlkZW50aWZpZXIoJ21ldGEnKSkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlcy5pZGVudGlmaWVyKCd1bmRlZmluZWQnKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9vdGVyID0gZm9vdGVyVGVtcGxhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNjVmFyOiB0eXBlcy5pZGVudGlmaWVyKGNjVmFyKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcGF0aC5ub2RlLmJvZHkgPSBbaW1wLCBoZWFkZXJdLmNvbmNhdChwYXRoLm5vZGUuYm9keSwgW2Zvb3Rlcl0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICB9O1xyXG59XHJcblxyXG5uYW1lc3BhY2UgJCB7XHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIE9wdGlvbnMge1xyXG4gICAgICAgIGJhc2VOYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgY29tcHJlc3NlZFVVSUQ6IHN0cmluZztcclxuICAgICAgICBpbXBvcnRNZXRhPzogYm9vbGVhbjtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgJDtcclxuIl19