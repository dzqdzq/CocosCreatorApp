'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.Asset = exports.VirtualAsset = exports.AssetActionEnum = void 0;
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const meta_1 = require("./meta");
const utils_1 = require("./utils");
const manager_1 = require("./manager");
// 检查是否是扩展名的正则判断
const extnameRex = /^\./;
/**
 * 检查一个输入文件名是否是扩展名
 * @param extOrFile
 */
function isExtname(extOrFile) {
    return extOrFile === '' || extnameRex.test(extOrFile);
}
var AssetActionEnum;
(function (AssetActionEnum) {
    AssetActionEnum[AssetActionEnum["add"] = 0] = "add";
    AssetActionEnum[AssetActionEnum["change"] = 1] = "change";
    AssetActionEnum[AssetActionEnum["delete"] = 2] = "delete";
    AssetActionEnum[AssetActionEnum["none"] = 3] = "none";
})(AssetActionEnum || (exports.AssetActionEnum = AssetActionEnum = {}));
/**
 * 虚拟的 asset 实例
 * 没有对应的源文件都的都是虚拟 asset
 */
class VirtualAsset {
    get init() {
        return this._init;
    }
    set init(bool) {
        this._init = bool;
        const keys = Object.keys(this.subAssets);
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            this.subAssets[key].init = bool;
        }
        if (bool) {
            while (this._waitInitHandle.length > 0) {
                const handle = this._waitInitHandle.shift();
                handle && handle();
            }
        }
    }
    async waitInit() {
        if (this._init) {
            return;
        }
        if (this.parent) {
            await this.parent.waitInit();
        }
        else {
            await new Promise((resolve, reject) => {
                this._waitInitHandle.push(() => {
                    resolve(null);
                });
            });
        }
    }
    // 源文件路径 'db://asset/test.plist@c869a.png'
    get source() {
        if (!this._parent) {
            return '';
        }
        return this._parent ? this._parent.source + '@' + this._id : '';
    }
    // db 协议格式的 url 地址
    get url() {
        if (!this._parent) {
            return '';
        }
        return this._parent ? this._parent.url + '@' + this._id : '';
    }
    // library 路径，不带扩展名的文件路径 xxx/3c/3cabcs-dfsdaf
    get library() {
        let id = this._parent ? this._id : this.meta.uuid;
        let asset = this._parent;
        while (asset) {
            if (asset.parent) {
                id = `${asset._id}@${id}`;
            }
            else {
                id = `${asset.uuid}@${id}`;
            }
            asset = asset.parent;
        }
        return `${this._assetDB.options.library}${path_1.sep}${this.meta.uuid.substr(0, 2)}${path_1.sep}${id}`;
    }
    // 资源使用的临时路径，不带扩展名的文件路径 xxx/3c/3cabcs-dfsdaf，重新导入的时候会删除这个路径下的临时文件
    get temp() {
        let id = this._parent ? this._id : this.meta.uuid;
        let asset = this._parent;
        while (asset) {
            if (asset.parent) {
                id = `${asset._id}@${id}`;
            }
            else {
                id = `${asset.uuid}@${id}`;
            }
            asset = asset.parent;
        }
        return `${this._assetDB.options.temp}${path_1.sep}${this.meta.uuid.substr(0, 2)}${path_1.sep}${id}`;
    }
    // 唯一的 id
    get uuid() {
        return this.meta.uuid;
    }
    // 显示的名字
    get displayName() {
        return this.meta.displayName || '';
    }
    /**
     * 获取一个存储在资源上的数据
     * @param key
     * @returns
     */
    getData(key) {
        const data = this._assetDB.dataManager.get(this);
        return data[key];
    }
    /**
     * 设置一个存储在资源上的数据
     * @param key
     * @param value
     * @returns
     */
    setData(key, value) {
        this._assetDB.dataManager.set(this, key, value);
    }
    generate() {
    }
    // 当前进程内是否已经导入完成
    set imported(imported) {
        this.meta.imported = imported;
    }
    get imported() {
        if (this.init === false) {
            return false;
        }
        return this.meta.imported;
    }
    /**
     * 锁定资源
     */
    async lock() {
        if (!this._lock) {
            return this._lock = true;
        }
        return await new Promise((resolve, reject) => {
            this._waitLockHandler.push(() => {
                resolve(null);
            });
        });
    }
    /**
     * 解锁资源
     */
    unlock() {
        const handle = this._waitLockHandler.shift();
        // 如果有等待的任务，则执行下一个
        if (handle) {
            handle();
            return;
        }
        // 已经没有在等待的任务了，还原标记
        this._lock = false;
    }
    // 拿出父资源
    get parent() {
        return this._parent;
    }
    // meta 内附带的 userData 数据
    get userData() {
        return this.meta.userData;
    }
    constructor(meta, name, id, assetDB) {
        this.versionCode = 0;
        // ---- 资源初始化标记 开始 ---
        // 是否初始化过（用于区分导入过，但是没有扫描到的情况）
        this._init = false;
        /**
         * 等待导入完成
         */
        this._waitInitHandle = [];
        // ---- 资源初始化标记 结束 ---
        // 资源的动作，当资源准备导入的时候，会变成对应的操作类型，导入完成变为 none
        this.action = AssetActionEnum.none;
        // 导入任务 id
        this.task = -1;
        // 导入失败的话会将资源标记成无效资源
        this.invalid = false;
        // uuid 对应的回收站 data 数据，被删除的数据会在这里存储一段时间
        this.uuid2recycle = {};
        this._lock = false;
        this._waitLockHandler = [];
        // 如果是 sub asset，则这个值指向父级的 asset
        this._parent = null;
        // 数据交换空间
        this._swapSpace = null;
        this.meta = (0, meta_1.completionMeta)(meta);
        this.imported = meta.imported;
        this._name = meta.name = name;
        this._id = meta.id = id;
        this._assetDB = assetDB;
        // sub asset
        // 在 assetDB 内是查询不到的，只能通过父 asset 查询到 sub asset
        this.subAssets = Object.create(null);
        Object.keys(meta.subMetas).forEach((name) => {
            let subMeta = meta.subMetas[name];
            // 父资源尚未导入，子资源不为其生成 subAsset，并需要确认标记 imported = false
            if (!subMeta.name) {
                return;
            }
            let subAsset = new VirtualAsset(subMeta, subMeta.name, subMeta.id, assetDB);
            subAsset._parent = this;
            this.subAssets[name] = subAsset;
        });
    }
    /**
     * 复制外部的 userData 数据
     * @param json 模版对象
     * @param overwrite 如果 userData 内有数据，是否使用模版内的数据覆盖，默认 false
     */
    assignUserData(json, overwrite = false) {
        const data = this.meta.userData;
        if (overwrite) {
            Object.assign(data, json);
        }
        else {
            for (let key in json) {
                if (key in data) {
                    continue;
                }
                data[key] = json[key];
            }
        }
    }
    /**
     * 保存当前资源的 meta 信息
     */
    async save() {
        if (!this._parent) {
            return;
        }
        // 因为虚拟的 asset 没有 .meta 文件，所以调用父级的 saveMeta
        return await this._parent.save();
    }
    /**
     * 清空并还原 meta 数据
     * 并清除 subMeta 内的数据
     * @param handle 删除内部的 subAsset 的时候会执行回调
     */
    async reset() {
        this.imported = false;
        this.invalid = false;
        // 检查并删除临时缓存
        if ((0, fs_extra_1.existsSync)(this.temp)) {
            try {
                (0, fs_extra_1.removeSync)(this.temp);
            }
            catch (error) {
                this._assetDB.console.warn(`Failed to delete temporary cache: ${this.source}`);
                this._assetDB.console.warn(error);
            }
        }
        // 删除导入的文件
        for (let i = this.meta.files.length - 1; i >= 0; i--) {
            let extname = this.meta.files[i];
            try {
                await this.deleteFromLibrary(extname);
            }
            catch (error) {
                this._assetDB.console.warn(`Failed to delete temporary cache: ${this.source}`);
                this._assetDB.console.warn(error);
            }
        }
        this.meta.files = [];
        // 清空 sub asset 内的数据
        const keys = Object.keys(this.subAssets);
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            const subAsset = this.subAssets[key];
            // 这是一个异步操作，subAsset 有可能在操作过程中，被删除
            if (subAsset && subAsset.reset) {
                // 放入回收站, id
                this.uuid2recycle[key] = subAsset.meta;
                await subAsset.reset();
            }
            delete this.meta.subMetas[key];
            delete this.subAssets[key];
        }
        // 还原自身的数据，userData 不需要还原
        // this.meta.ver = '0.0.0';
        // this.meta.importer = '*'; // importer 不还原
        // 清空依赖关系
        this._assetDB.dependencyManager.remove('uuid', this.uuid);
        this._assetDB.dependencyManager.remove('path', this.source);
        this._assetDB.dependencyManager.remove('url', this.url);
        return true;
    }
    /**
     * 查询一个文件的绝对地址
     * @param extOrFile
     */
    getFilePath(extOrFile) {
        if (isExtname(extOrFile)) {
            return `${this.library}${extOrFile}`;
        }
        else {
            return `${this.library}${path_1.sep}${extOrFile}`;
        }
    }
    /**
     * 存储一个 uuid 为名字的 buffer
     * 传入一个扩展名或者相对路径，如果传入扩展名，则存储到 uuid.extname
     * 如果传入的是一个相对路径或者文件名，则放到 uuid 为名字的目录内
     * @param extOrPath 一个扩展名或者相对路径
     * @param buffer
     */
    async saveToLibrary(extOrFile, buffer) {
        if (!Buffer.isBuffer(buffer) && typeof buffer !== 'string' && !ArrayBuffer.isView(buffer)) {
            throw new Error('The "data" argument must be of type string or an instance of Buffer or ArrayBuffer');
        }
        // 如果是扩展名，直接存储到 uuid.extname
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            let index = this.meta.files.indexOf(extOrFile);
            if (index === -1) {
                this.meta.files.push(extOrFile);
                this.meta.files.sort();
            }
            await (0, fs_extra_1.outputFile)(file, buffer);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index === -1) {
            this.meta.files.push(relativeFile);
            this.meta.files.sort();
        }
        await (0, fs_extra_1.outputFile)(file, buffer);
    }
    /**
     * 复制一个文件到 library 内
     * @param extOrFile
     * @param target
     */
    async copyToLibrary(extOrFile, target) {
        // 如果是扩展名，直接存储到 uuid.extname
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            let index = this.meta.files.indexOf(extOrFile);
            if (index === -1) {
                this.meta.files.push(extOrFile);
                this.meta.files.sort();
            }
            if ((0, fs_extra_1.existsSync)(file)) {
                await (0, fs_extra_1.remove)(file);
            }
            await (0, fs_extra_1.copy)(target, file);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index === -1) {
            this.meta.files.push(relativeFile);
            this.meta.files.sort();
        }
        if ((0, fs_extra_1.existsSync)(file)) {
            await (0, fs_extra_1.remove)(file);
        }
        await (0, fs_extra_1.copy)(target, file);
    }
    /**
     * 删除一个以 uuid 为名字的导入文件
     * @param extOrFile
     */
    async deleteFromLibrary(extOrFile) {
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            if (!(0, fs_extra_1.existsSync)(file)) {
                return false;
            }
            let index = this.meta.files.indexOf(extOrFile);
            if (index !== -1) {
                this.meta.files.splice(index, 1);
            }
            await (0, fs_extra_1.remove)(file);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index !== -1) {
            this.meta.files.splice(index, 1);
        }
        await (0, fs_extra_1.remove)(file);
    }
    /**
     * 判断一个以 uuid 为名字的文件是否存在
     * @param extOrFile
     */
    existsInLibrary(extOrFile) {
        // 如果 meta 记录的文件内没有当前文件，则直接返回文件不存在
        if (this.meta.files.indexOf(extOrFile) === -1) {
            return false;
        }
        let file;
        if (isExtname(extOrFile)) {
            file = `${this.library}${extOrFile}`;
        }
        else {
            file = `${this.library}${path_1.sep}${extOrFile}`;
        }
        return (0, fs_extra_1.existsSync)(file);
    }
    /**
     * 判断是否是文件夹
     */
    isDirectory() {
        return false;
    }
    /**
     * 创建一个虚拟的 asset，这个 asset 没有实体
     * 一个虚拟的 asset 也允许存储都个文件
     * @param name
     * @param importer 使用什么解析
     */
    async createSubAsset(name, importer, options = { displayName: '' }) {
        if (!name) {
            throw 'Failed to create subAsset: It must have a name';
        }
        let subAsset;
        let id = options.id || (0, utils_1.nameToId)(name);
        let i = 1;
        while (this.subAssets[id] && this.subAssets[id].meta.name !== name) {
            id = (0, utils_1.nameToId)(name, i++);
            if (i >= 26) {
                throw new Error(`Cannot create a new subAsset: ${name}\n  Please try to change your asset name`);
            }
        }
        if (this.subAssets[name]) {
            subAsset = this.subAssets[name];
        }
        else {
            importer = importer || '*';
            // 判断是否从回收池拿 meta 数据
            const subMeta = this.meta.subMetas[id];
            let meta = this.uuid2recycle[id];
            if (!meta || meta.importer !== importer) {
                meta = (0, meta_1.completionMeta)({
                    importer: importer,
                    uuid: `${this.uuid}@${id}`,
                    displayName: options.displayName || '',
                    id,
                    name,
                    userData: subMeta ? subMeta.userData || {} : {},
                });
            }
            else {
                // 如果是可用数据，要确保 uuid 是从父资源来的
                // 复制过来的 meta 有可能 uuid 和 displayName 是错的
                meta.uuid = `${this.uuid}@${id}`;
                meta.displayName = options.displayName || '';
                // 融合 meta 内给定的 userData 数据
                subMeta && subMeta.userData && Object.assign(meta.userData, subMeta.userData);
            }
            // 删除回收池内的数据
            delete this.uuid2recycle[id];
            subAsset = new VirtualAsset(meta, name, id, this._assetDB);
            subAsset._parent = this;
            this.meta.subMetas[id] = subAsset.meta;
            this.subAssets[id] = subAsset;
        }
        return this.subAssets[id];
    }
    /**
     * 注册依赖的文件
     * 记录的是依赖的文件的源路径
     * 在每次 asset 任务之后都需要检查依赖 asset 的资源并更新
     * 依赖的文件更新的时候，需要更新自身
     * @param fileOrUuid 当前资源依赖的文件的绝对路径，不能传入相对路径
     *   db://assets/test.json
     *   /Users/xx/project/assets/test.json
     *   db://assets/test.plist@c30fb
     */
    depend(fileOrUuidOrUrl) {
        if (!(0, manager_1.recursiveCheckAssociatedAssets)(fileOrUuidOrUrl, this)) {
            this._assetDB.console.warn(`There are recursive dependencies: ${fileOrUuidOrUrl} ${this.uuid}`);
            return;
        }
        if ((0, path_1.isAbsolute)(fileOrUuidOrUrl)) {
            this._assetDB.dependencyManager.add('path', this.source, fileOrUuidOrUrl);
        }
        else if (fileOrUuidOrUrl.startsWith('db://')) {
            this._assetDB.dependencyManager.add('url', this.source, fileOrUuidOrUrl);
        }
        else {
            this._assetDB.dependencyManager.add('uuid', this.source, fileOrUuidOrUrl);
        }
    }
    /**
     * 获取交换空间对象
     * 这个空间主要是提供给父子资源间数据相互依赖使用的临时数据空间
     * 并不会保证数据存在，需要使用方自己去判断数据正确性，如无数据，需要自己生成
     */
    getSwapSpace() {
        this._swapSpace = this._swapSpace || {};
        return this._swapSpace;
    }
}
exports.VirtualAsset = VirtualAsset;
/**
 * 存储到 asset db 内的 asset 实例
 * 创建的时候会读取对应的 .meta 文件
 * 如果 meta 不存在则会创建，并分配一个 uuid
 */
class Asset extends VirtualAsset {
    get source() {
        return this._source;
    }
    get url() {
        return this._url;
    }
    constructor(source, meta, assetDB) {
        let ext = (0, path_1.extname)(source);
        let base = (0, path_1.basename)(source, ext);
        super(meta, meta.name, meta.id, assetDB);
        this._source = source;
        this.extname = ext.toLowerCase();
        this.basename = base;
        this._url = '';
        this.updateUrl();
    }
    updateUrl() {
        this._url = `db://${this._assetDB.options.name}/${(0, path_1.relative)(this._assetDB.options.target, this.source).replace(/\\/g, '/')}`;
    }
    /**
     * 保存当前资源的 meta 信息
     */
    save() {
        if (!(0, fs_extra_1.existsSync)(this.source) // 如果源文件被删除了，则不需要继续保存
        ) {
            return false;
        }
        const metaPath = this.source + '.meta';
        this._assetDB.metaManager.write(metaPath);
        const metaStats = (0, fs_extra_1.statSync)(metaPath);
        this._assetDB.infoManager.add(metaPath, metaStats.mtimeMs);
        return true;
    }
    /**
     * 判断是否是文件夹
     */
    isDirectory() {
        if (this._isDirectory !== undefined) {
            return this._isDirectory;
        }
        const stats = (0, fs_extra_1.statSync)(this.source);
        if (!stats) {
            return false;
        }
        return this._isDirectory = stats.isDirectory();
    }
}
exports.Asset = Asset;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9hc3NldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7OztBQUViLCtCQUFvRTtBQUNwRSx1Q0FBaUc7QUFHakcsaUNBQThDO0FBQzlDLG1DQUFtQztBQUNuQyx1Q0FBMkQ7QUFFM0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQztBQUV6Qjs7O0dBR0c7QUFDSCxTQUFTLFNBQVMsQ0FBQyxTQUFTO0lBQ3hCLE9BQU8sU0FBUyxLQUFLLEVBQUUsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxJQUFZLGVBS1g7QUFMRCxXQUFZLGVBQWU7SUFDdkIsbURBQUssQ0FBQTtJQUNMLHlEQUFRLENBQUE7SUFDUix5REFBUSxDQUFBO0lBQ1IscURBQU0sQ0FBQTtBQUNWLENBQUMsRUFMVyxlQUFlLCtCQUFmLGVBQWUsUUFLMUI7QUFFRDs7O0dBR0c7QUFDSCxNQUFhLFlBQVk7SUFNckIsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFDRCxJQUFJLElBQUksQ0FBQyxJQUFJO1FBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDekMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNuQztRQUNELElBQUksSUFB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LE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVc7UUFDUCxJQUFJLElBQUksQ0FBQyxZQUFZLEtBQUssU0FBUyxFQUFFO1lBQ2pDLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztTQUM1QjtRQUNELE1BQU0sS0FBSyxHQUFHLElBQUEsbUJBQVEsRUFBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNSLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0NBQ0o7QUFuRUQsc0JBbUVDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBleHRuYW1lLCBiYXNlbmFtZSwgcmVsYXRpdmUsIGlzQWJzb2x1dGUsIHNlcCB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgb3V0cHV0RmlsZSwgcmVtb3ZlLCBjb3B5LCBlbnN1cmVEaXIsIHN0YXRTeW5jLCByZW1vdmVTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IHsgQXNzZXREQiB9IGZyb20gJy4vYXNzZXQtZGInO1xuXG5pbXBvcnQgeyBNZXRhLCBjb21wbGV0aW9uTWV0YSB9IGZyb20gJy4vbWV0YSc7XG5pbXBvcnQgeyBuYW1lVG9JZCB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgcmVjdXJzaXZlQ2hlY2tBc3NvY2lhdGVkQXNzZXRzIH0gZnJvbSAnLi9tYW5hZ2VyJztcblxuLy8g5qOA5p+l5piv5ZCm5piv5omp5bGV5ZCN55qE5q2j5YiZ5Yik5patXG5jb25zdCBleHRuYW1lUmV4ID0gL15cXC4vO1xuXG4vKipcbiAqIOajgOafpeS4gOS4qui+k+WFpeaWh+S7tuWQjeaYr+WQpuaYr+aJqeWxleWQjVxuICogQHBhcmFtIGV4dE9yRmlsZVxuICovXG5mdW5jdGlvbiBpc0V4dG5hbWUoZXh0T3JGaWxlKSB7XG4gICAgcmV0dXJuIGV4dE9yRmlsZSA9PT0gJycgfHwgZXh0bmFtZVJleC50ZXN0KGV4dE9yRmlsZSk7XG59XG5cbmV4cG9ydCBlbnVtIEFzc2V0QWN0aW9uRW51bSB7XG4gICAgJ2FkZCcsXG4gICAgJ2NoYW5nZScsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ25vbmUnLFxufVxuXG4vKipcbiAqIOiZmuaLn+eahCBhc3NldCDlrp7kvotcbiAqIOayoeacieWvueW6lOeahOa6kOaWh+S7tumDveeahOmDveaYr+iZmuaLnyBhc3NldFxuICovXG5leHBvcnQgY2xhc3MgVmlydHVhbEFzc2V0IHtcbiAgICB2ZXJzaW9uQ29kZTogbnVtYmVyID0gMDtcbiAgICAvLyAtLS0tIOi1hOa6kOWIneWni+WMluagh+iusCDlvIDlp4sgLS0tXG4gICAgLy8g5piv5ZCm5Yid5aeL5YyW6L+H77yI55So5LqO5Yy65YiG5a+85YWl6L+H77yM5L2G5piv5rKh5pyJ5omr5o+P5Yiw55qE5oOF5Ya177yJXG4gICAgX2luaXQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGdldCBpbml0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5pdDtcbiAgICB9XG4gICAgc2V0IGluaXQoYm9vbCkge1xuICAgICAgICB0aGlzLl9pbml0ID0gYm9vbDtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuc3ViQXNzZXRzKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgICAgdGhpcy5zdWJBc3NldHNba2V5XS5pbml0ID0gYm9vbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYm9vbCkge1xuICAgICAgICAgICAgd2hpbGUgKHRoaXMuX3dhaXRJbml0SGFuZGxlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGUgPSB0aGlzLl93YWl0SW5pdEhhbmRsZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGhhbmRsZSAmJiBoYW5kbGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOetieW+heWvvOWFpeWujOaIkFxuICAgICAqL1xuICAgIF93YWl0SW5pdEhhbmRsZTogRnVuY3Rpb25bXSA9IFtdO1xuICAgIGFzeW5jIHdhaXRJbml0KCkge1xuICAgICAgICBpZiAodGhpcy5faW5pdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wYXJlbnQud2FpdEluaXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl93YWl0SW5pdEhhbmRsZS5wdXNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIC0tLS0g6LWE5rqQ5Yid5aeL5YyW5qCH6K6wIOe7k+adnyAtLS1cblxuICAgIC8vIOi1hOa6kOeahOWKqOS9nO+8jOW9k+i1hOa6kOWHhuWkh+WvvOWFpeeahOaXtuWAme+8jOS8muWPmOaIkOWvueW6lOeahOaTjeS9nOexu+Wei++8jOWvvOWFpeWujOaIkOWPmOS4uiBub25lXG4gICAgYWN0aW9uOiBBc3NldEFjdGlvbkVudW0gPSBBc3NldEFjdGlvbkVudW0ubm9uZTtcblxuICAgIC8vIOWvvOWFpeS7u+WKoSBpZFxuICAgIHRhc2s6IG51bWJlciA9IC0xO1xuXG4gICAgLy8g5a+85YWl5aSx6LSl55qE6K+d5Lya5bCG6LWE5rqQ5qCH6K6w5oiQ5peg5pWI6LWE5rqQXG4gICAgaW52YWxpZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLy8gdXVpZCDlr7nlupTnmoTlm57mlLbnq5kgZGF0YSDmlbDmja7vvIzooqvliKDpmaTnmoTmlbDmja7kvJrlnKjov5nph4zlrZjlgqjkuIDmrrXml7bpl7RcbiAgICB1dWlkMnJlY3ljbGU6IHsgW2luZGV4OiBzdHJpbmddOiBNZXRhIH0gPSB7fTtcblxuICAgIC8vIOa6kOaWh+S7tui3r+W+hCAnZGI6Ly9hc3NldC90ZXN0LnBsaXN0QGM4NjlhLnBuZydcbiAgICBnZXQgc291cmNlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3BhcmVudCkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQgPyB0aGlzLl9wYXJlbnQuc291cmNlICsgJ0AnICsgdGhpcy5faWQgOiAnJztcbiAgICB9XG5cbiAgICAvLyBkYiDljY/orq7moLzlvI/nmoQgdXJsIOWcsOWdgFxuICAgIGdldCB1cmwoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudCA/IHRoaXMuX3BhcmVudC51cmwgKyAnQCcgKyB0aGlzLl9pZCA6ICcnO1xuICAgIH1cblxuICAgIC8vIGxpYnJhcnkg6Lev5b6E77yM5LiN5bim5omp5bGV5ZCN55qE5paH5Lu26Lev5b6EIHh4eC8zYy8zY2FiY3MtZGZzZGFmXG4gICAgZ2V0IGxpYnJhcnkoKSB7XG4gICAgICAgIGxldCBpZCA9IHRoaXMuX3BhcmVudCA/IHRoaXMuX2lkIDogdGhpcy5tZXRhLnV1aWQ7XG4gICAgICAgIGxldCBhc3NldCA9IHRoaXMuX3BhcmVudDtcblxuICAgICAgICB3aGlsZSAoYXNzZXQpIHtcbiAgICAgICAgICAgIGlmIChhc3NldC5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBpZCA9IGAke2Fzc2V0Ll9pZH1AJHtpZH1gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZCA9IGAke2Fzc2V0LnV1aWR9QCR7aWR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0ID0gYXNzZXQucGFyZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuX2Fzc2V0REIub3B0aW9ucy5saWJyYXJ5fSR7c2VwfSR7dGhpcy5tZXRhLnV1aWQuc3Vic3RyKDAsIDIpfSR7c2VwfSR7aWR9YDtcbiAgICB9XG5cbiAgICAvLyDotYTmupDkvb/nlKjnmoTkuLTml7bot6/lvoTvvIzkuI3luKbmianlsZXlkI3nmoTmlofku7bot6/lvoQgeHh4LzNjLzNjYWJjcy1kZnNkYWbvvIzph43mlrDlr7zlhaXnmoTml7blgJnkvJrliKDpmaTov5nkuKrot6/lvoTkuIvnmoTkuLTml7bmlofku7ZcbiAgICBnZXQgdGVtcCgpIHtcbiAgICAgICAgbGV0IGlkID0gdGhpcy5fcGFyZW50ID8gdGhpcy5faWQgOiB0aGlzLm1ldGEudXVpZDtcbiAgICAgICAgbGV0IGFzc2V0ID0gdGhpcy5fcGFyZW50O1xuXG4gICAgICAgIHdoaWxlIChhc3NldCkge1xuICAgICAgICAgICAgaWYgKGFzc2V0LnBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlkID0gYCR7YXNzZXQuX2lkfUAke2lkfWA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlkID0gYCR7YXNzZXQudXVpZH1AJHtpZH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQgPSBhc3NldC5wYXJlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYCR7dGhpcy5fYXNzZXREQi5vcHRpb25zLnRlbXB9JHtzZXB9JHt0aGlzLm1ldGEudXVpZC5zdWJzdHIoMCwgMil9JHtzZXB9JHtpZH1gO1xuICAgIH1cblxuICAgIC8vIOWUr+S4gOeahCBpZFxuICAgIGdldCB1dWlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhLnV1aWQ7XG4gICAgfVxuXG4gICAgLy8g5pi+56S655qE5ZCN5a2XXG4gICAgZ2V0IGRpc3BsYXlOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhLmRpc3BsYXlOYW1lIHx8ICcnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPluS4gOS4quWtmOWCqOWcqOi1hOa6kOS4iueahOaVsOaNrlxuICAgICAqIEBwYXJhbSBrZXkgXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgZ2V0RGF0YShrZXk6IHN0cmluZykge1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fYXNzZXREQi5kYXRhTWFuYWdlci5nZXQodGhpcyk7XG4gICAgICAgIHJldHVybiBkYXRhW2tleV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6K6+572u5LiA5Liq5a2Y5YKo5Zyo6LWE5rqQ5LiK55qE5pWw5o2uXG4gICAgICogQHBhcmFtIGtleSBcbiAgICAgKiBAcGFyYW0gdmFsdWUgXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgc2V0RGF0YShrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICAgICAgICB0aGlzLl9hc3NldERCLmRhdGFNYW5hZ2VyLnNldCh0aGlzLCBrZXksIHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZW5lcmF0ZSgpIHtcblxuICAgIH1cblxuICAgIC8vIOi1hOa6kOWGheeahOmZhOWKoOS/oeaBr++8jOWklumDqOWPr+S7peebtOaOpeiOt+WPllxuICAgIG1ldGE6IE1ldGE7XG5cbiAgICAvLyDlrZDotYTmupDntKLlvJVcbiAgICBzdWJBc3NldHM6IHsgW25hbWU6IHN0cmluZ106IFZpcnR1YWxBc3NldCB9O1xuXG4gICAgLy8g5b2T5YmN6L+b56iL5YaF5piv5ZCm5bey57uP5a+85YWl5a6M5oiQXG4gICAgc2V0IGltcG9ydGVkKGltcG9ydGVkOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMubWV0YS5pbXBvcnRlZCA9IGltcG9ydGVkO1xuICAgIH1cbiAgICBnZXQgaW1wb3J0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmluaXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubWV0YS5pbXBvcnRlZDtcbiAgICB9XG5cbiAgICBfbG9jazogYm9vbGVhbiA9IGZhbHNlO1xuICAgIF93YWl0TG9ja0hhbmRsZXI6IEZ1bmN0aW9uW10gPSBbXTtcblxuICAgIC8qKlxuICAgICAqIOmUgeWumui1hOa6kFxuICAgICAqL1xuICAgIGFzeW5jIGxvY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5fbG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2sgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl93YWl0TG9ja0hhbmRsZXIucHVzaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDop6PplIHotYTmupBcbiAgICAgKi9cbiAgICB1bmxvY2soKSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9IHRoaXMuX3dhaXRMb2NrSGFuZGxlci5zaGlmdCgpO1xuICAgICAgICAvLyDlpoLmnpzmnInnrYnlvoXnmoTku7vliqHvvIzliJnmiafooYzkuIvkuIDkuKpcbiAgICAgICAgaWYgKGhhbmRsZSkge1xuICAgICAgICAgICAgaGFuZGxlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlt7Lnu4/msqHmnInlnKjnrYnlvoXnmoTku7vliqHkuobvvIzov5jljp/moIforrBcbiAgICAgICAgdGhpcy5fbG9jayA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIOW9k+WJjei1hOa6kOaMgui9veeahOaVsOaNruW6k1xuICAgIF9hc3NldERCOiBBc3NldERCO1xuXG4gICAgLy8g5aaC5p6c5pivIHN1YiBhc3NldO+8jOWImei/meS4quWAvOaMh+WQkeeItue6p+eahCBhc3NldFxuICAgIF9wYXJlbnQ6IFZpcnR1YWxBc3NldCB8IEFzc2V0IHwgbnVsbCA9IG51bGw7XG5cbiAgICAvLyDlvZPliY3otYTmupDnmoTlkI3lrZdcbiAgICBfbmFtZTogc3RyaW5nO1xuXG4gICAgLy8g5b2T5YmN6LWE5rqQ55qEIGlkXG4gICAgX2lkOiBzdHJpbmc7XG5cbiAgICAvLyDmlbDmja7kuqTmjaLnqbrpl7RcbiAgICBfc3dhcFNwYWNlOiBhbnkgPSBudWxsO1xuXG4gICAgLy8g5piv5ZCm5piv5paH5Lu25aS577yM6LWE5rqQ5Y+q5pyJ56ys5LiA5qyh5p+l6K+i6ZyA6KaB5LuOIHN0YXQg6I635Y+W77yM5LmL5ZCO6YO95bqU6K+l55So57yT5a2YXG4gICAgX2lzRGlyZWN0b3J5PzogYm9vbGVhbjtcblxuICAgIC8vIOaLv+WHuueItui1hOa6kFxuICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQ7XG4gICAgfVxuXG4gICAgLy8gbWV0YSDlhoXpmYTluKbnmoQgdXNlckRhdGEg5pWw5o2uXG4gICAgZ2V0IHVzZXJEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhLnVzZXJEYXRhO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKG1ldGE6IE1ldGEsIG5hbWU6IHN0cmluZywgaWQ6IHN0cmluZywgYXNzZXREQjogQXNzZXREQikge1xuICAgICAgICB0aGlzLm1ldGEgPSBjb21wbGV0aW9uTWV0YShtZXRhKTtcbiAgICAgICAgdGhpcy5pbXBvcnRlZCA9IG1ldGEuaW1wb3J0ZWQ7XG4gICAgICAgIHRoaXMuX25hbWUgPSBtZXRhLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLl9pZCA9IG1ldGEuaWQgPSBpZDtcblxuICAgICAgICB0aGlzLl9hc3NldERCID0gYXNzZXREQjtcblxuICAgICAgICAvLyBzdWIgYXNzZXRcbiAgICAgICAgLy8g5ZyoIGFzc2V0REIg5YaF5piv5p+l6K+i5LiN5Yiw55qE77yM5Y+q6IO96YCa6L+H54i2IGFzc2V0IOafpeivouWIsCBzdWIgYXNzZXRcbiAgICAgICAgdGhpcy5zdWJBc3NldHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICBPYmplY3Qua2V5cyhtZXRhLnN1Yk1ldGFzKS5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICAgICAgICBsZXQgc3ViTWV0YSA9IG1ldGEuc3ViTWV0YXNbbmFtZV07XG4gICAgICAgICAgICAvLyDniLbotYTmupDlsJrmnKrlr7zlhaXvvIzlrZDotYTmupDkuI3kuLrlhbbnlJ/miJAgc3ViQXNzZXTvvIzlubbpnIDopoHnoa7orqTmoIforrAgaW1wb3J0ZWQgPSBmYWxzZVxuICAgICAgICAgICAgaWYgKCFzdWJNZXRhLm5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc3ViQXNzZXQgPSBuZXcgVmlydHVhbEFzc2V0KHN1Yk1ldGEsIHN1Yk1ldGEubmFtZSwgc3ViTWV0YS5pZCwgYXNzZXREQik7XG4gICAgICAgICAgICBzdWJBc3NldC5fcGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuc3ViQXNzZXRzW25hbWVdID0gc3ViQXNzZXQ7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWkjeWItuWklumDqOeahCB1c2VyRGF0YSDmlbDmja5cbiAgICAgKiBAcGFyYW0ganNvbiDmqKHniYjlr7nosaFcbiAgICAgKiBAcGFyYW0gb3ZlcndyaXRlIOWmguaenCB1c2VyRGF0YSDlhoXmnInmlbDmja7vvIzmmK/lkKbkvb/nlKjmqKHniYjlhoXnmoTmlbDmja7opobnm5bvvIzpu5jorqQgZmFsc2VcbiAgICAgKi9cbiAgICBhc3NpZ25Vc2VyRGF0YShqc29uOiBPYmplY3QsIG92ZXJ3cml0ZTogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1ldGEudXNlckRhdGE7XG5cbiAgICAgICAgaWYgKG92ZXJ3cml0ZSkge1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBqc29uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBqc29uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSBqc29uW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDkv53lrZjlvZPliY3otYTmupDnmoQgbWV0YSDkv6Hmga9cbiAgICAgKi9cbiAgICBhc3luYyBzYXZlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3BhcmVudCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5Zug5Li66Jma5ouf55qEIGFzc2V0IOayoeaciSAubWV0YSDmlofku7bvvIzmiYDku6XosIPnlKjniLbnuqfnmoQgc2F2ZU1ldGFcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3BhcmVudC5zYXZlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5riF56m65bm26L+Y5Y6fIG1ldGEg5pWw5o2uXG4gICAgICog5bm25riF6ZmkIHN1Yk1ldGEg5YaF55qE5pWw5o2uXG4gICAgICogQHBhcmFtIGhhbmRsZSDliKDpmaTlhoXpg6jnmoQgc3ViQXNzZXQg55qE5pe25YCZ5Lya5omn6KGM5Zue6LCDXG4gICAgICovXG4gICAgYXN5bmMgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuaW1wb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnZhbGlkID0gZmFsc2U7XG4gICAgICAgIC8vIOajgOafpeW5tuWIoOmZpOS4tOaXtue8k+WtmFxuICAgICAgICBpZiAoZXhpc3RzU3luYyh0aGlzLnRlbXApKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlbW92ZVN5bmModGhpcy50ZW1wKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5jb25zb2xlLndhcm4oYEZhaWxlZCB0byBkZWxldGUgdGVtcG9yYXJ5IGNhY2hlOiAke3RoaXMuc291cmNlfWApO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0REIuY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWIoOmZpOWvvOWFpeeahOaWh+S7tlxuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5tZXRhLmZpbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBsZXQgZXh0bmFtZSA9IHRoaXMubWV0YS5maWxlc1tpXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVGcm9tTGlicmFyeShleHRuYW1lKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5jb25zb2xlLndhcm4oYEZhaWxlZCB0byBkZWxldGUgdGVtcG9yYXJ5IGNhY2hlOiAke3RoaXMuc291cmNlfWApO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0REIuY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1ldGEuZmlsZXMgPSBbXTtcblxuICAgICAgICAvLyDmuIXnqbogc3ViIGFzc2V0IOWGheeahOaVsOaNrlxuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zdWJBc3NldHMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICAgICAgICBjb25zdCBzdWJBc3NldCA9IHRoaXMuc3ViQXNzZXRzW2tleV07XG4gICAgICAgICAgICAvLyDov5nmmK/kuIDkuKrlvILmraXmk43kvZzvvIxzdWJBc3NldCDmnInlj6/og73lnKjmk43kvZzov4fnqIvkuK3vvIzooqvliKDpmaRcbiAgICAgICAgICAgIGlmIChzdWJBc3NldCAmJiBzdWJBc3NldC5yZXNldCkge1xuICAgICAgICAgICAgICAgIC8vIOaUvuWFpeWbnuaUtuermSwgaWRcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQycmVjeWNsZVtrZXldID0gc3ViQXNzZXQubWV0YTtcbiAgICAgICAgICAgICAgICBhd2FpdCBzdWJBc3NldC5yZXNldCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5tZXRhLnN1Yk1ldGFzW2tleV07XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5zdWJBc3NldHNba2V5XTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOi/mOWOn+iHqui6q+eahOaVsOaNru+8jHVzZXJEYXRhIOS4jemcgOimgei/mOWOn1xuICAgICAgICAvLyB0aGlzLm1ldGEudmVyID0gJzAuMC4wJztcbiAgICAgICAgLy8gdGhpcy5tZXRhLmltcG9ydGVyID0gJyonOyAvLyBpbXBvcnRlciDkuI3ov5jljp9cblxuICAgICAgICAvLyDmuIXnqbrkvp3otZblhbPns7tcbiAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5yZW1vdmUoJ3V1aWQnLCB0aGlzLnV1aWQpO1xuICAgICAgICB0aGlzLl9hc3NldERCLmRlcGVuZGVuY3lNYW5hZ2VyLnJlbW92ZSgncGF0aCcsIHRoaXMuc291cmNlKTtcbiAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5yZW1vdmUoJ3VybCcsIHRoaXMudXJsKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmn6Xor6LkuIDkuKrmlofku7bnmoTnu53lr7nlnLDlnYBcbiAgICAgKiBAcGFyYW0gZXh0T3JGaWxlIFxuICAgICAqL1xuICAgIGdldEZpbGVQYXRoKGV4dE9yRmlsZTogc3RyaW5nKSB7XG4gICAgICAgIGlmIChpc0V4dG5hbWUoZXh0T3JGaWxlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMubGlicmFyeX0ke2V4dE9yRmlsZX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMubGlicmFyeX0ke3NlcH0ke2V4dE9yRmlsZX1gO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5a2Y5YKo5LiA5LiqIHV1aWQg5Li65ZCN5a2X55qEIGJ1ZmZlclxuICAgICAqIOS8oOWFpeS4gOS4quaJqeWxleWQjeaIluiAheebuOWvuei3r+W+hO+8jOWmguaenOS8oOWFpeaJqeWxleWQje+8jOWImeWtmOWCqOWIsCB1dWlkLmV4dG5hbWVcbiAgICAgKiDlpoLmnpzkvKDlhaXnmoTmmK/kuIDkuKrnm7jlr7not6/lvoTmiJbogIXmlofku7blkI3vvIzliJnmlL7liLAgdXVpZCDkuLrlkI3lrZfnmoTnm67lvZXlhoVcbiAgICAgKiBAcGFyYW0gZXh0T3JQYXRoIOS4gOS4quaJqeWxleWQjeaIluiAheebuOWvuei3r+W+hFxuICAgICAqIEBwYXJhbSBidWZmZXIgXG4gICAgICovXG4gICAgYXN5bmMgc2F2ZVRvTGlicmFyeShleHRPckZpbGU6IHN0cmluZywgYnVmZmVyOiBCdWZmZXIgfCBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmZmVyKSAmJiB0eXBlb2YgYnVmZmVyICE9PSAnc3RyaW5nJyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGJ1ZmZlcikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIFwiZGF0YVwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBzdHJpbmcgb3IgYW4gaW5zdGFuY2Ugb2YgQnVmZmVyIG9yIEFycmF5QnVmZmVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5aaC5p6c5piv5omp5bGV5ZCN77yM55u05o6l5a2Y5YKo5YiwIHV1aWQuZXh0bmFtZVxuICAgICAgICBpZiAoaXNFeHRuYW1lKGV4dE9yRmlsZSkpIHtcbiAgICAgICAgICAgIGxldCBmaWxlID0gYCR7dGhpcy5saWJyYXJ5fSR7ZXh0T3JGaWxlfWA7XG4gICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihleHRPckZpbGUpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5wdXNoKGV4dE9yRmlsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNvcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IG91dHB1dEZpbGUoZmlsZSwgYnVmZmVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOS8oOWFpeeahOS4jeaYr+aJqeWxleWQje+8jOaBreWWnO+8jOaWsOW7uuS4gOS4qiB1dWlkIOaWh+S7tuWkueWtmOaUvuWQp1xuICAgICAgICBhd2FpdCBlbnN1cmVEaXIodGhpcy5saWJyYXJ5KTtcbiAgICAgICAgbGV0IGZpbGUgPSB0aGlzLmxpYnJhcnkgKyBzZXAgKyBleHRPckZpbGU7XG4gICAgICAgIGxldCByZWxhdGl2ZUZpbGUgPSByZWxhdGl2ZSh0aGlzLmxpYnJhcnksIGZpbGUpO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihyZWxhdGl2ZUZpbGUpO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMucHVzaChyZWxhdGl2ZUZpbGUpO1xuICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNvcnQoKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBvdXRwdXRGaWxlKGZpbGUsIGJ1ZmZlcik7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDlpI3liLbkuIDkuKrmlofku7bliLAgbGlicmFyeSDlhoVcbiAgICAgKiBAcGFyYW0gZXh0T3JGaWxlIFxuICAgICAqIEBwYXJhbSB0YXJnZXQgXG4gICAgICovXG4gICAgYXN5bmMgY29weVRvTGlicmFyeShleHRPckZpbGU6IHN0cmluZywgdGFyZ2V0OiBzdHJpbmcpIHtcbiAgICAgICAgLy8g5aaC5p6c5piv5omp5bGV5ZCN77yM55u05o6l5a2Y5YKo5YiwIHV1aWQuZXh0bmFtZVxuICAgICAgICBpZiAoaXNFeHRuYW1lKGV4dE9yRmlsZSkpIHtcbiAgICAgICAgICAgIGxldCBmaWxlID0gYCR7dGhpcy5saWJyYXJ5fSR7ZXh0T3JGaWxlfWA7XG4gICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihleHRPckZpbGUpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5wdXNoKGV4dE9yRmlsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNvcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChleGlzdHNTeW5jKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcmVtb3ZlKGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgY29weSh0YXJnZXQsIGZpbGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5aaC5p6c5Lyg5YWl55qE5LiN5piv5omp5bGV5ZCN77yM5oGt5Zac77yM5paw5bu65LiA5LiqIHV1aWQg5paH5Lu25aS55a2Y5pS+5ZCnXG4gICAgICAgIGF3YWl0IGVuc3VyZURpcih0aGlzLmxpYnJhcnkpO1xuICAgICAgICBsZXQgZmlsZSA9IHRoaXMubGlicmFyeSArIHNlcCArIGV4dE9yRmlsZTtcbiAgICAgICAgbGV0IHJlbGF0aXZlRmlsZSA9IHJlbGF0aXZlKHRoaXMubGlicmFyeSwgZmlsZSk7XG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMubWV0YS5maWxlcy5pbmRleE9mKHJlbGF0aXZlRmlsZSk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5wdXNoKHJlbGF0aXZlRmlsZSk7XG4gICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMuc29ydCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleGlzdHNTeW5jKGZpbGUpKSB7XG4gICAgICAgICAgICBhd2FpdCByZW1vdmUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY29weSh0YXJnZXQsIGZpbGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWIoOmZpOS4gOS4quS7pSB1dWlkIOS4uuWQjeWtl+eahOWvvOWFpeaWh+S7tlxuICAgICAqIEBwYXJhbSBleHRPckZpbGUgXG4gICAgICovXG4gICAgYXN5bmMgZGVsZXRlRnJvbUxpYnJhcnkoZXh0T3JGaWxlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKGlzRXh0bmFtZShleHRPckZpbGUpKSB7XG4gICAgICAgICAgICBsZXQgZmlsZSA9IGAke3RoaXMubGlicmFyeX0ke2V4dE9yRmlsZX1gO1xuICAgICAgICAgICAgaWYgKCFleGlzdHNTeW5jKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5tZXRhLmZpbGVzLmluZGV4T2YoZXh0T3JGaWxlKTtcbiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHJlbW92ZShmaWxlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOS8oOWFpeeahOS4jeaYr+aJqeWxleWQje+8jOaBreWWnO+8jOaWsOW7uuS4gOS4qiB1dWlkIOaWh+S7tuWkueWtmOaUvuWQp1xuICAgICAgICBhd2FpdCBlbnN1cmVEaXIodGhpcy5saWJyYXJ5KTtcbiAgICAgICAgbGV0IGZpbGUgPSB0aGlzLmxpYnJhcnkgKyBzZXAgKyBleHRPckZpbGU7XG4gICAgICAgIGxldCByZWxhdGl2ZUZpbGUgPSByZWxhdGl2ZSh0aGlzLmxpYnJhcnksIGZpbGUpO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihyZWxhdGl2ZUZpbGUpO1xuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCByZW1vdmUoZmlsZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yik5pat5LiA5Liq5LulIHV1aWQg5Li65ZCN5a2X55qE5paH5Lu25piv5ZCm5a2Y5ZyoXG4gICAgICogQHBhcmFtIGV4dE9yRmlsZSBcbiAgICAgKi9cbiAgICBleGlzdHNJbkxpYnJhcnkoZXh0T3JGaWxlOiBzdHJpbmcpIHtcbiAgICAgICAgLy8g5aaC5p6cIG1ldGEg6K6w5b2V55qE5paH5Lu25YaF5rKh5pyJ5b2T5YmN5paH5Lu277yM5YiZ55u05o6l6L+U5Zue5paH5Lu25LiN5a2Y5ZyoXG4gICAgICAgIGlmICh0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihleHRPckZpbGUpID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGZpbGU7XG4gICAgICAgIGlmIChpc0V4dG5hbWUoZXh0T3JGaWxlKSkge1xuICAgICAgICAgICAgZmlsZSA9IGAke3RoaXMubGlicmFyeX0ke2V4dE9yRmlsZX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlsZSA9IGAke3RoaXMubGlicmFyeX0ke3NlcH0ke2V4dE9yRmlsZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleGlzdHNTeW5jKGZpbGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWIpOaWreaYr+WQpuaYr+aWh+S7tuWkuVxuICAgICAqL1xuICAgIGlzRGlyZWN0b3J5KCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yib5bu65LiA5Liq6Jma5ouf55qEIGFzc2V077yM6L+Z5LiqIGFzc2V0IOayoeacieWunuS9k1xuICAgICAqIOS4gOS4quiZmuaLn+eahCBhc3NldCDkuZ/lhYHorrjlrZjlgqjpg73kuKrmlofku7ZcbiAgICAgKiBAcGFyYW0gbmFtZSBcbiAgICAgKiBAcGFyYW0gaW1wb3J0ZXIg5L2/55So5LuA5LmI6Kej5p6QXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlU3ViQXNzZXQobmFtZTogc3RyaW5nLCBpbXBvcnRlcjogc3RyaW5nLCBvcHRpb25zOiB7IGRpc3BsYXlOYW1lPzogc3RyaW5nOyBpZD86IHN0cmluZzsgfSA9IHsgZGlzcGxheU5hbWU6ICcnIH0pIHtcbiAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICB0aHJvdyAnRmFpbGVkIHRvIGNyZWF0ZSBzdWJBc3NldDogSXQgbXVzdCBoYXZlIGEgbmFtZSc7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHN1YkFzc2V0O1xuICAgICAgICBsZXQgaWQgPSBvcHRpb25zLmlkIHx8IG5hbWVUb0lkKG5hbWUpO1xuXG4gICAgICAgIGxldCBpID0gMTtcbiAgICAgICAgd2hpbGUgKHRoaXMuc3ViQXNzZXRzW2lkXSAmJiB0aGlzLnN1YkFzc2V0c1tpZF0ubWV0YS5uYW1lICE9PSBuYW1lKSB7XG4gICAgICAgICAgICBpZCA9IG5hbWVUb0lkKG5hbWUsIGkrKyk7XG4gICAgICAgICAgICBpZiAoaSA+PSAyNikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNyZWF0ZSBhIG5ldyBzdWJBc3NldDogJHtuYW1lfVxcbiAgUGxlYXNlIHRyeSB0byBjaGFuZ2UgeW91ciBhc3NldCBuYW1lYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zdWJBc3NldHNbbmFtZV0pIHtcbiAgICAgICAgICAgIHN1YkFzc2V0ID0gdGhpcy5zdWJBc3NldHNbbmFtZV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbXBvcnRlciA9IGltcG9ydGVyIHx8ICcqJztcblxuICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm5LuO5Zue5pS25rGg5ou/IG1ldGEg5pWw5o2uXG4gICAgICAgICAgICBjb25zdCBzdWJNZXRhID0gdGhpcy5tZXRhLnN1Yk1ldGFzW2lkXTtcbiAgICAgICAgICAgIGxldCBtZXRhOiBNZXRhID0gdGhpcy51dWlkMnJlY3ljbGVbaWRdO1xuICAgICAgICAgICAgaWYgKCFtZXRhIHx8IG1ldGEuaW1wb3J0ZXIgIT09IGltcG9ydGVyKSB7XG4gICAgICAgICAgICAgICAgbWV0YSA9IGNvbXBsZXRpb25NZXRhKHtcbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0ZXI6IGltcG9ydGVyLFxuICAgICAgICAgICAgICAgICAgICB1dWlkOiBgJHt0aGlzLnV1aWR9QCR7aWR9YCxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IG9wdGlvbnMuZGlzcGxheU5hbWUgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YTogc3ViTWV0YSA/IHN1Yk1ldGEudXNlckRhdGEgfHwge30gOiB7fSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5Y+v55So5pWw5o2u77yM6KaB56Gu5L+dIHV1aWQg5piv5LuO54i26LWE5rqQ5p2l55qEXG4gICAgICAgICAgICAgICAgLy8g5aSN5Yi26L+H5p2l55qEIG1ldGEg5pyJ5Y+v6IO9IHV1aWQg5ZKMIGRpc3BsYXlOYW1lIOaYr+mUmeeahFxuICAgICAgICAgICAgICAgIG1ldGEudXVpZCA9IGAke3RoaXMudXVpZH1AJHtpZH1gO1xuICAgICAgICAgICAgICAgIG1ldGEuZGlzcGxheU5hbWUgPSBvcHRpb25zLmRpc3BsYXlOYW1lIHx8ICcnO1xuICAgICAgICAgICAgICAgIC8vIOiejeWQiCBtZXRhIOWGhee7meWumueahCB1c2VyRGF0YSDmlbDmja5cbiAgICAgICAgICAgICAgICBzdWJNZXRhICYmIHN1Yk1ldGEudXNlckRhdGEgJiYgT2JqZWN0LmFzc2lnbihtZXRhLnVzZXJEYXRhLCBzdWJNZXRhLnVzZXJEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOWIoOmZpOWbnuaUtuaxoOWGheeahOaVsOaNrlxuICAgICAgICAgICAgZGVsZXRlIHRoaXMudXVpZDJyZWN5Y2xlW2lkXTtcblxuICAgICAgICAgICAgc3ViQXNzZXQgPSBuZXcgVmlydHVhbEFzc2V0KG1ldGEsIG5hbWUsIGlkLCB0aGlzLl9hc3NldERCKTtcbiAgICAgICAgICAgIHN1YkFzc2V0Ll9wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5tZXRhLnN1Yk1ldGFzW2lkXSA9IHN1YkFzc2V0Lm1ldGE7XG4gICAgICAgICAgICB0aGlzLnN1YkFzc2V0c1tpZF0gPSBzdWJBc3NldDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdWJBc3NldHNbaWRdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOazqOWGjOS+nei1lueahOaWh+S7tlxuICAgICAqIOiusOW9leeahOaYr+S+nei1lueahOaWh+S7tueahOa6kOi3r+W+hFxuICAgICAqIOWcqOavj+asoSBhc3NldCDku7vliqHkuYvlkI7pg73pnIDopoHmo4Dmn6Xkvp3otZYgYXNzZXQg55qE6LWE5rqQ5bm25pu05pawXG4gICAgICog5L6d6LWW55qE5paH5Lu25pu05paw55qE5pe25YCZ77yM6ZyA6KaB5pu05paw6Ieq6LqrXG4gICAgICogQHBhcmFtIGZpbGVPclV1aWQg5b2T5YmN6LWE5rqQ5L6d6LWW55qE5paH5Lu255qE57ud5a+56Lev5b6E77yM5LiN6IO95Lyg5YWl55u45a+56Lev5b6EXG4gICAgICogICBkYjovL2Fzc2V0cy90ZXN0Lmpzb25cbiAgICAgKiAgIC9Vc2Vycy94eC9wcm9qZWN0L2Fzc2V0cy90ZXN0Lmpzb25cbiAgICAgKiAgIGRiOi8vYXNzZXRzL3Rlc3QucGxpc3RAYzMwZmJcbiAgICAgKi9cbiAgICBkZXBlbmQoZmlsZU9yVXVpZE9yVXJsOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCFyZWN1cnNpdmVDaGVja0Fzc29jaWF0ZWRBc3NldHMoZmlsZU9yVXVpZE9yVXJsLCB0aGlzKSkge1xuICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5jb25zb2xlLndhcm4oYFRoZXJlIGFyZSByZWN1cnNpdmUgZGVwZW5kZW5jaWVzOiAke2ZpbGVPclV1aWRPclVybH0gJHt0aGlzLnV1aWR9YCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQWJzb2x1dGUoZmlsZU9yVXVpZE9yVXJsKSkge1xuICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5hZGQoJ3BhdGgnLCB0aGlzLnNvdXJjZSwgZmlsZU9yVXVpZE9yVXJsKTtcbiAgICAgICAgfSBlbHNlIGlmIChmaWxlT3JVdWlkT3JVcmwuc3RhcnRzV2l0aCgnZGI6Ly8nKSkge1xuICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5hZGQoJ3VybCcsIHRoaXMuc291cmNlLCBmaWxlT3JVdWlkT3JVcmwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5hZGQoJ3V1aWQnLCB0aGlzLnNvdXJjZSwgZmlsZU9yVXVpZE9yVXJsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPluS6pOaNouepuumXtOWvueixoVxuICAgICAqIOi/meS4quepuumXtOS4u+imgeaYr+aPkOS+m+e7meeItuWtkOi1hOa6kOmXtOaVsOaNruebuOS6kuS+nei1luS9v+eUqOeahOS4tOaXtuaVsOaNruepuumXtFxuICAgICAqIOW5tuS4jeS8muS/neivgeaVsOaNruWtmOWcqO+8jOmcgOimgeS9v+eUqOaWueiHquW3seWOu+WIpOaWreaVsOaNruato+ehruaAp++8jOWmguaXoOaVsOaNru+8jOmcgOimgeiHquW3seeUn+aIkFxuICAgICAqL1xuICAgIGdldFN3YXBTcGFjZTxUPigpOiBUIHtcbiAgICAgICAgdGhpcy5fc3dhcFNwYWNlID0gdGhpcy5fc3dhcFNwYWNlIHx8IHt9O1xuICAgICAgICByZXR1cm4gdGhpcy5fc3dhcFNwYWNlIGFzIFQ7XG4gICAgfVxufVxuXG4vKipcbiAqIOWtmOWCqOWIsCBhc3NldCBkYiDlhoXnmoQgYXNzZXQg5a6e5L6LXG4gKiDliJvlu7rnmoTml7blgJnkvJror7vlj5blr7nlupTnmoQgLm1ldGEg5paH5Lu2XG4gKiDlpoLmnpwgbWV0YSDkuI3lrZjlnKjliJnkvJrliJvlu7rvvIzlubbliIbphY3kuIDkuKogdXVpZFxuICovXG5leHBvcnQgY2xhc3MgQXNzZXQgZXh0ZW5kcyBWaXJ0dWFsQXNzZXQge1xuXG4gICAgLy8g5rqQ5paH5Lu26Lev5b6EICcvVXNlcnMvbmFtZS9hc3NldC90ZXN0LnBsaXN0J1xuICAgIF9zb3VyY2U6IHN0cmluZztcbiAgICBnZXQgc291cmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlO1xuICAgIH1cblxuICAgIC8vIGRiOi8vbmFtZS94eHgucG5nIOagvOW8j+eahCB1cmwg5Zyw5Z2AXG4gICAgX3VybDogc3RyaW5nO1xuICAgIGdldCB1cmwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl91cmw7XG4gICAgfVxuXG4gICAgLy8g5omp5bGV5ZCNICcuanNvbicg5peg6KeG5aSn5bCP5YaZ77yM6YO95Lya6L2s5o2i5oiQ5bCP5YaZ5a2Y5YKoXG4gICAgZXh0bmFtZTogc3RyaW5nO1xuXG4gICAgLy8g5Y676Zmk5omp5bGV5ZCN55qE5paH5Lu25ZCNICd1c2VyJ1xuICAgIGJhc2VuYW1lOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2U6IHN0cmluZywgbWV0YTogTWV0YSwgYXNzZXREQjogQXNzZXREQikge1xuICAgICAgICBsZXQgZXh0ID0gZXh0bmFtZShzb3VyY2UpO1xuICAgICAgICBsZXQgYmFzZSA9IGJhc2VuYW1lKHNvdXJjZSwgZXh0KTtcblxuICAgICAgICBzdXBlcihtZXRhLCBtZXRhLm5hbWUsIG1ldGEuaWQsIGFzc2V0REIpO1xuXG4gICAgICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy5leHRuYW1lID0gZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHRoaXMuYmFzZW5hbWUgPSBiYXNlO1xuXG4gICAgICAgIHRoaXMuX3VybCA9ICcnO1xuICAgICAgICB0aGlzLnVwZGF0ZVVybCgpO1xuICAgIH1cblxuICAgIHVwZGF0ZVVybCgpIHtcbiAgICAgICAgdGhpcy5fdXJsID0gYGRiOi8vJHt0aGlzLl9hc3NldERCLm9wdGlvbnMubmFtZX0vJHtyZWxhdGl2ZSh0aGlzLl9hc3NldERCLm9wdGlvbnMudGFyZ2V0LCB0aGlzLnNvdXJjZSkucmVwbGFjZSgvXFxcXC9nLCAnLycpfWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5L+d5a2Y5b2T5YmN6LWE5rqQ55qEIG1ldGEg5L+h5oGvXG4gICAgICovXG4gICAgc2F2ZSgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIWV4aXN0c1N5bmModGhpcy5zb3VyY2UpIC8vIOWmguaenOa6kOaWh+S7tuiiq+WIoOmZpOS6hu+8jOWImeS4jemcgOimgee7p+e7reS/neWtmFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXRhUGF0aCA9IHRoaXMuc291cmNlICsgJy5tZXRhJztcbiAgICAgICAgdGhpcy5fYXNzZXREQi5tZXRhTWFuYWdlci53cml0ZShtZXRhUGF0aCk7XG4gICAgICAgIGNvbnN0IG1ldGFTdGF0cyA9IHN0YXRTeW5jKG1ldGFQYXRoKTtcbiAgICAgICAgdGhpcy5fYXNzZXREQi5pbmZvTWFuYWdlci5hZGQobWV0YVBhdGgsIG1ldGFTdGF0cy5tdGltZU1zKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yik5pat5piv5ZCm5piv5paH5Lu25aS5XG4gICAgICovXG4gICAgaXNEaXJlY3RvcnkoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLl9pc0RpcmVjdG9yeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXNEaXJlY3Rvcnk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RhdHMgPSBzdGF0U3luYyh0aGlzLnNvdXJjZSk7XG4gICAgICAgIGlmICghc3RhdHMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5faXNEaXJlY3RvcnkgPSBzdGF0cy5pc0RpcmVjdG9yeSgpO1xuICAgIH1cbn1cbiJdfQ==