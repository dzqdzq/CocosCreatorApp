'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.Asset = exports.VirtualAsset = exports.AssetActionEnum = void 0;
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const meta_1 = require("./meta");
const utils_1 = require("./utils");
const manager_1 = require("./manager");
// 检查是否是扩展名的正则判断
const extnameRex = /^\./;
/**
 * 检查一个输入文件名是否是扩展名
 * @param extOrFile
 */
function isExtname(extOrFile) {
    return extOrFile === '' || extnameRex.test(extOrFile);
}
var AssetActionEnum;
(function (AssetActionEnum) {
    AssetActionEnum[AssetActionEnum["add"] = 0] = "add";
    AssetActionEnum[AssetActionEnum["change"] = 1] = "change";
    AssetActionEnum[AssetActionEnum["delete"] = 2] = "delete";
    AssetActionEnum[AssetActionEnum["none"] = 3] = "none";
})(AssetActionEnum = exports.AssetActionEnum || (exports.AssetActionEnum = {}));
/**
 * 虚拟的 asset 实例
 * 没有对应的源文件都的都是虚拟 asset
 */
class VirtualAsset {
    constructor(meta, name, id, assetDB) {
        // ---- 资源初始化标记 开始 ---
        // 是否初始化过（用于区分导入过，但是没有扫描到的情况）
        this._init = false;
        /**
         * 等待导入完成
         */
        this._waitInitHandle = [];
        // ---- 资源初始化标记 结束 ---
        // 资源的动作，当资源准备导入的时候，会变成对应的操作类型，导入完成变为 none
        this.action = AssetActionEnum.none;
        // 导入任务 id
        this.task = -1;
        // 导入失败的话会将资源标记成无效资源
        this.invalid = false;
        // uuid 对应的回收站 data 数据，被删除的数据会在这里存储一段时间
        this.uuid2recycle = {};
        this._lock = false;
        this._waitLockHandler = [];
        // 如果是 sub asset，则这个值指向父级的 asset
        this._parent = null;
        // 数据交换空间
        this._swapSpace = null;
        this.meta = (0, meta_1.completionMeta)(meta);
        this.imported = meta.imported;
        this._name = meta.name = name;
        this._id = meta.id = id;
        this._assetDB = assetDB;
        // sub asset
        // 在 assetDB 内是查询不到的，只能通过父 asset 查询到 sub asset
        this.subAssets = Object.create(null);
        Object.keys(meta.subMetas).forEach((name) => {
            let subMeta = meta.subMetas[name];
            // 父资源尚未导入，子资源不为其生成 subAsset，并需要确认标记 imported = false
            if (!subMeta.name) {
                return;
            }
            let subAsset = new VirtualAsset(subMeta, subMeta.name, subMeta.id, assetDB);
            subAsset._parent = this;
            this.subAssets[name] = subAsset;
        });
    }
    get init() {
        return this._init;
    }
    set init(bool) {
        this._init = bool;
        const keys = Object.keys(this.subAssets);
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            this.subAssets[key].init = bool;
        }
        if (bool) {
            while (this._waitInitHandle.length > 0) {
                const handle = this._waitInitHandle.shift();
                handle && handle();
            }
        }
    }
    async waitInit() {
        if (this._init) {
            return;
        }
        if (this.parent) {
            await this.parent.waitInit();
        }
        else {
            await new Promise((resolve, reject) => {
                this._waitInitHandle.push(() => {
                    resolve(null);
                });
            });
        }
    }
    // 源文件路径 'db://asset/test.plist@c869a.png'
    get source() {
        if (!this._parent) {
            return '';
        }
        return this._parent ? this._parent.source + '@' + this._id : '';
    }
    // db 协议格式的 url 地址
    get url() {
        if (!this._parent) {
            return '';
        }
        return this._parent ? this._parent.url + '@' + this._id : '';
    }
    // library 路径，不带扩展名的文件路径 xxx/3c/3cabcs-dfsdaf
    get library() {
        let id = this._parent ? this._id : this.meta.uuid;
        let asset = this._parent;
        while (asset) {
            if (asset.parent) {
                id = `${asset._id}@${id}`;
            }
            else {
                id = `${asset.uuid}@${id}`;
            }
            asset = asset.parent;
        }
        return `${this._assetDB.options.library}${path_1.sep}${this.meta.uuid.substr(0, 2)}${path_1.sep}${id}`;
    }
    // 资源使用的临时路径，不带扩展名的文件路径 xxx/3c/3cabcs-dfsdaf，重新导入的时候会删除这个路径下的临时文件
    get temp() {
        let id = this._parent ? this._id : this.meta.uuid;
        let asset = this._parent;
        while (asset) {
            if (asset.parent) {
                id = `${asset._id}@${id}`;
            }
            else {
                id = `${asset.uuid}@${id}`;
            }
            asset = asset.parent;
        }
        return `${this._assetDB.options.temp}${path_1.sep}${this.meta.uuid.substr(0, 2)}${path_1.sep}${id}`;
    }
    // 唯一的 id
    get uuid() {
        return this.meta.uuid;
    }
    // 显示的名字
    get displayName() {
        return this.meta.displayName || '';
    }
    /**
     * 获取一个存储在资源上的数据
     * @param key
     * @returns
     */
    getData(key) {
        const data = this._assetDB.dataManaer.get(this);
        return data[key];
    }
    /**
     * 设置一个存储在资源上的数据
     * @param key
     * @param value
     * @returns
     */
    setData(key, value) {
        this._assetDB.dataManaer.set(this, key, value);
    }
    generate() {
    }
    // 当前进程内是否已经导入完成
    set imported(imported) {
        this.meta.imported = imported;
    }
    get imported() {
        if (this.init === false) {
            return false;
        }
        return this.meta.imported;
    }
    /**
     * 锁定资源
     */
    async lock() {
        if (!this._lock) {
            return this._lock = true;
        }
        return await new Promise((resolve, reject) => {
            this._waitLockHandler.push(() => {
                resolve(null);
            });
        });
    }
    /**
     * 解锁资源
     */
    unlock() {
        const handle = this._waitLockHandler.shift();
        // 如果有等待的任务，则执行下一个
        if (handle) {
            handle();
            return;
        }
        // 已经没有在等待的任务了，还原标记
        this._lock = false;
    }
    // 拿出父资源
    get parent() {
        return this._parent;
    }
    // meta 内附带的 userData 数据
    get userData() {
        return this.meta.userData;
    }
    /**
     * 复制外部的 userData 数据
     * @param json 模版对象
     * @param overwrite 如果 userData 内有数据，是否使用模版内的数据覆盖，默认 false
     */
    assignUserData(json, overwrite = false) {
        const data = this.meta.userData;
        if (overwrite) {
            Object.assign(data, json);
        }
        else {
            for (let key in json) {
                if (key in data) {
                    continue;
                }
                data[key] = json[key];
            }
        }
    }
    /**
     * 保存当前资源的 meta 信息
     */
    async save() {
        if (!this._parent) {
            return;
        }
        // 因为虚拟的 asset 没有 .meta 文件，所以调用父级的 saveMeta
        return await this._parent.save();
    }
    /**
     * 清空并还原 meta 数据
     * 并清除 subMeta 内的数据
     * @param handle 删除内部的 subAsset 的时候会执行回调
     */
    async reset() {
        // 检查并删除临时缓存
        if ((0, fs_extra_1.existsSync)(this.temp)) {
            try {
                (0, fs_extra_1.removeSync)(this.temp);
            }
            catch (error) {
                console.warn(`Failed to delete temporary cache: ${this.source}`);
                console.warn(error);
            }
        }
        // 删除导入的文件
        for (let i = this.meta.files.length - 1; i >= 0; i--) {
            let extname = this.meta.files[i];
            try {
                await this.deleteFromLibrary(extname);
            }
            catch (error) {
                console.warn(`Failed to delete temporary cache: ${this.source}`);
                console.warn(error);
            }
        }
        this.meta.files = [];
        // 清空 sub asset 内的数据
        const keys = Object.keys(this.subAssets);
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            const subAsset = this.subAssets[key];
            // 这是一个异步操作，subAsset 有可能在操作过程中，被删除
            if (subAsset && subAsset.reset) {
                // 放入回收站, id
                this.uuid2recycle[key] = subAsset.meta;
                await subAsset.reset();
                subAsset.imported = false;
            }
            delete this.meta.subMetas[key];
            delete this.subAssets[key];
        }
        // 还原自身的数据，userData 不需要还原
        // this.meta.ver = '0.0.0';
        // this.meta.importer = '*'; // importer 不还原
        this.imported = false;
        // 清空依赖关系
        this._assetDB.dependencyManager.remove('uuid', this.uuid);
        this._assetDB.dependencyManager.remove('path', this.source);
        this._assetDB.dependencyManager.remove('url', this.url);
        return true;
    }
    /**
     * 查询一个文件的绝对地址
     * @param extOrFile
     */
    getFilePath(extOrFile) {
        if (isExtname(extOrFile)) {
            return `${this.library}${extOrFile}`;
        }
        else {
            return `${this.library}${path_1.sep}${extOrFile}`;
        }
    }
    /**
     * 存储一个 uuid 为名字的 buffer
     * 传入一个扩展名或者相对路径，如果传入扩展名，则存储到 uuid.extname
     * 如果传入的是一个相对路径或者文件名，则放到 uuid 为名字的目录内
     * @param extOrPath 一个扩展名或者相对路径
     * @param buffer
     */
    async saveToLibrary(extOrFile, buffer) {
        if (!Buffer.isBuffer(buffer) && typeof buffer !== 'string' && !ArrayBuffer.isView(buffer)) {
            throw new Error('The "data" argument must be of type string or an instance of Buffer or ArrayBuffer');
        }
        // 如果是扩展名，直接存储到 uuid.extname
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            let index = this.meta.files.indexOf(extOrFile);
            if (index === -1) {
                this.meta.files.push(extOrFile);
                this.meta.files.sort();
            }
            await (0, fs_extra_1.outputFile)(file, buffer);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index === -1) {
            this.meta.files.push(relativeFile);
            this.meta.files.sort();
        }
        await (0, fs_extra_1.outputFile)(file, buffer);
    }
    /**
     * 复制一个文件到 library 内
     * @param extOrFile
     * @param target
     */
    async copyToLibrary(extOrFile, target) {
        // 如果是扩展名，直接存储到 uuid.extname
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            let index = this.meta.files.indexOf(extOrFile);
            if (index === -1) {
                this.meta.files.push(extOrFile);
                this.meta.files.sort();
            }
            if ((0, fs_extra_1.existsSync)(file)) {
                await (0, fs_extra_1.remove)(file);
            }
            await (0, fs_extra_1.copy)(target, file);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index === -1) {
            this.meta.files.push(relativeFile);
            this.meta.files.sort();
        }
        if ((0, fs_extra_1.existsSync)(file)) {
            await (0, fs_extra_1.remove)(file);
        }
        await (0, fs_extra_1.copy)(target, file);
    }
    /**
     * 删除一个以 uuid 为名字的导入文件
     * @param extOrFile
     */
    async deleteFromLibrary(extOrFile) {
        if (isExtname(extOrFile)) {
            let file = `${this.library}${extOrFile}`;
            if (!(0, fs_extra_1.existsSync)(file)) {
                return false;
            }
            let index = this.meta.files.indexOf(extOrFile);
            if (index !== -1) {
                this.meta.files.splice(index, 1);
            }
            await (0, fs_extra_1.remove)(file);
            return;
        }
        // 如果传入的不是扩展名，恭喜，新建一个 uuid 文件夹存放吧
        await (0, fs_extra_1.ensureDir)(this.library);
        let file = this.library + path_1.sep + extOrFile;
        let relativeFile = (0, path_1.relative)(this.library, file);
        let index = this.meta.files.indexOf(relativeFile);
        if (index !== -1) {
            this.meta.files.splice(index, 1);
        }
        await (0, fs_extra_1.remove)(file);
    }
    /**
     * 判断一个以 uuid 为名字的文件是否存在
     * @param extOrFile
     */
    existsInLibrary(extOrFile) {
        // 如果 meta 记录的文件内没有当前文件，则直接返回文件不存在
        if (this.meta.files.indexOf(extOrFile) === -1) {
            return false;
        }
        let file;
        if (isExtname(extOrFile)) {
            file = `${this.library}${extOrFile}`;
        }
        else {
            file = `${this.library}${path_1.sep}${extOrFile}`;
        }
        return (0, fs_extra_1.existsSync)(file);
    }
    /**
     * 判断是否是文件夹
     */
    isDirectory() {
        return false;
    }
    /**
     * 创建一个虚拟的 asset，这个 asset 没有实体
     * 一个虚拟的 asset 也允许存储都个文件
     * @param name
     * @param importer 使用什么解析
     */
    async createSubAsset(name, importer, options = { displayName: '' }) {
        if (!name) {
            throw 'Failed to create subAsset: It must have a name';
        }
        let subAsset;
        let id = options.id || (0, utils_1.nameToId)(name);
        let i = 1;
        while (this.subAssets[id] && this.subAssets[id].meta.name !== name) {
            id = (0, utils_1.nameToId)(name, i++);
            if (i >= 26) {
                throw new Error(`Cannot create a new subAsset: ${name}\n  Please try to change your asset name`);
            }
        }
        if (this.subAssets[name]) {
            subAsset = this.subAssets[name];
        }
        else {
            importer = importer || '*';
            // 判断是否从回收池拿 meta 数据
            let meta = this.uuid2recycle[id];
            if (!meta || meta.importer !== importer) {
                const subMeta = this.meta.subMetas[id];
                meta = (0, meta_1.completionMeta)({
                    importer: importer,
                    uuid: `${this.uuid}@${id}`,
                    displayName: options.displayName || '',
                    id,
                    name,
                    userData: subMeta ? subMeta.userData || {} : {},
                });
            }
            else {
                // 如果是可用数据，要确保 uuid 是从父资源来的
                // 复制过来的 meta 有可能 uuid 和 displayName 是错的
                meta.uuid = `${this.uuid}@${id}`;
                meta.displayName = options.displayName || '';
            }
            // 删除回收池内的数据
            delete this.uuid2recycle[id];
            subAsset = new VirtualAsset(meta, name, id, this._assetDB);
            subAsset._parent = this;
            this.meta.subMetas[id] = subAsset.meta;
            this.subAssets[id] = subAsset;
        }
        return this.subAssets[id];
    }
    /**
     * 注册依赖的文件
     * 记录的是依赖的文件的源路径
     * 在每次 asset 任务之后都需要检查依赖 asset 的资源并更新
     * 依赖的文件更新的时候，需要更新自身
     * @param fileOrUuid 当前资源依赖的文件的绝对路径，不能传入相对路径
     *   db://assets/test.json
     *   /Users/xx/project/assets/test.json
     *   db://assets/test.plist@c30fb
     */
    depend(fileOrUuidOrUrl) {
        if (!(0, manager_1.recursiveCheckAssociatedAssets)(fileOrUuidOrUrl, this)) {
            console.warn(`There are recursive dependencies: ${fileOrUuidOrUrl} ${this.uuid}`);
            return;
        }
        if ((0, path_1.isAbsolute)(fileOrUuidOrUrl)) {
            this._assetDB.dependencyManager.add('path', this.source, fileOrUuidOrUrl);
        }
        else if (fileOrUuidOrUrl.startsWith('db://')) {
            this._assetDB.dependencyManager.add('url', this.source, fileOrUuidOrUrl);
        }
        else {
            this._assetDB.dependencyManager.add('uuid', this.source, fileOrUuidOrUrl);
        }
    }
    /**
     * 获取交换空间对象
     * 这个空间主要是提供给父子资源间数据相互依赖使用的临时数据空间
     * 并不会保证数据存在，需要使用方自己去判断数据正确性，如无数据，需要自己生成
     */
    getSwapSpace() {
        this._swapSpace = this._swapSpace || {};
        return this._swapSpace;
    }
}
exports.VirtualAsset = VirtualAsset;
/**
 * 存储到 asset db 内的 asset 实例
 * 创建的时候会读取对应的 .meta 文件
 * 如果 meta 不存在则会创建，并分配一个 uuid
 */
class Asset extends VirtualAsset {
    constructor(source, meta, assetDB) {
        let ext = (0, path_1.extname)(source);
        let base = (0, path_1.basename)(source, ext);
        super(meta, meta.name, meta.id, assetDB);
        this._source = source;
        this.extname = ext.toLowerCase();
        this.basename = base;
        this._url = '';
        this.updateUrl();
    }
    get source() {
        return this._source;
    }
    get url() {
        return this._url;
    }
    updateUrl() {
        this._url = `db://${this._assetDB.options.name}/${(0, path_1.relative)(this._assetDB.options.target, this.source).replace(/\\/g, '/')}`;
    }
    /**
     * 保存当前资源的 meta 信息
     */
    save() {
        if (!(0, fs_extra_1.existsSync)(this.source) // 如果源文件被删除了，则不需要继续保存
        ) {
            return false;
        }
        const metaPath = this.source + '.meta';
        this._assetDB.metaManager.write(metaPath);
        const metaStats = (0, fs_extra_1.statSync)(metaPath);
        this._assetDB.infoManager.add(metaPath, metaStats.mtimeMs);
        return true;
    }
    /**
     * 判断是否是文件夹
     */
    isDirectory() {
        if (this._isDirectory !== undefined) {
            return this._isDirectory;
        }
        const stats = (0, fs_extra_1.statSync)(this.source);
        if (!stats) {
            return false;
        }
        return this._isDirectory = stats.isDirectory();
    }
}
exports.Asset = Asset;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9hc3NldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7OztBQUViLCtCQUFvRTtBQUNwRSx1Q0FBaUc7QUFHakcsaUNBQThDO0FBQzlDLG1DQUFtQztBQUNuQyx1Q0FBMkQ7QUFFM0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQztBQUV6Qjs7O0dBR0c7QUFDSCxTQUFTLFNBQVMsQ0FBQyxTQUFTO0lBQ3hCLE9BQU8sU0FBUyxLQUFLLEVBQUUsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxJQUFZLGVBS1g7QUFMRCxXQUFZLGVBQWU7SUFDdkIsbURBQUssQ0FBQTtJQUNMLHlEQUFRLENBQUE7SUFDUix5REFBUSxDQUFBO0lBQ1IscURBQU0sQ0FBQTtBQUNWLENBQUMsRUFMVyxlQUFlLEdBQWYsdUJBQWUsS0FBZix1QkFBZSxRQUsxQjtBQUVEOzs7R0FHRztBQUNILE1BQWEsWUFBWTtJQXdOckIsWUFBWSxJQUFVLEVBQUUsSUFBWSxFQUFFLEVBQVUsRUFBRSxPQUFnQjtRQXZObEUsc0JBQXNCO1FBQ3RCLDZCQUE2QjtRQUM3QixVQUFLLEdBQVksS0FBSyxDQUFDO1FBb0J2Qjs7V0FFRztRQUNILG9CQUFlLEdBQWUsRUFBRSxDQUFDO1FBZWpDLHNCQUFzQjtRQUV0QiwwQ0FBMEM7UUFDMUMsV0FBTSxHQUFvQixlQUFlLENBQUMsSUFBSSxDQUFDO1FBRS9DLFVBQVU7UUFDVixTQUFJLEdBQVcsQ0FBQyxDQUFDLENBQUM7UUFFbEIsb0JBQW9CO1FBQ3BCLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFFekIsdUNBQXVDO1FBQ3ZDLGlCQUFZLEdBQThCLEVBQUUsQ0FBQztRQXVHN0MsVUFBSyxHQUFZLEtBQUssQ0FBQztRQUN2QixxQkFBZ0IsR0FBYyxFQUFFLENBQUM7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QUssQ0FBQztTQUNoQjtRQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbkQsQ0FBQztDQUNKO0FBbkVELHNCQW1FQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgZXh0bmFtZSwgYmFzZW5hbWUsIHJlbGF0aXZlLCBpc0Fic29sdXRlLCBzZXAgfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4aXN0c1N5bmMsIG91dHB1dEZpbGUsIHJlbW92ZSwgY29weSwgZW5zdXJlRGlyLCBzdGF0U3luYywgcmVtb3ZlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IEFzc2V0REIgfSBmcm9tICcuL2Fzc2V0LWRiJztcblxuaW1wb3J0IHsgTWV0YSwgY29tcGxldGlvbk1ldGEgfSBmcm9tICcuL21ldGEnO1xuaW1wb3J0IHsgbmFtZVRvSWQgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IHJlY3Vyc2l2ZUNoZWNrQXNzb2NpYXRlZEFzc2V0cyB9IGZyb20gJy4vbWFuYWdlcic7XG5cbi8vIOajgOafpeaYr+WQpuaYr+aJqeWxleWQjeeahOato+WImeWIpOaWrVxuY29uc3QgZXh0bmFtZVJleCA9IC9eXFwuLztcblxuLyoqXG4gKiDmo4Dmn6XkuIDkuKrovpPlhaXmlofku7blkI3mmK/lkKbmmK/mianlsZXlkI1cbiAqIEBwYXJhbSBleHRPckZpbGVcbiAqL1xuZnVuY3Rpb24gaXNFeHRuYW1lKGV4dE9yRmlsZSkge1xuICAgIHJldHVybiBleHRPckZpbGUgPT09ICcnIHx8IGV4dG5hbWVSZXgudGVzdChleHRPckZpbGUpO1xufVxuXG5leHBvcnQgZW51bSBBc3NldEFjdGlvbkVudW0ge1xuICAgICdhZGQnLFxuICAgICdjaGFuZ2UnLFxuICAgICdkZWxldGUnLFxuICAgICdub25lJyxcbn1cblxuLyoqXG4gKiDomZrmi5/nmoQgYXNzZXQg5a6e5L6LXG4gKiDmsqHmnInlr7nlupTnmoTmupDmlofku7bpg73nmoTpg73mmK/omZrmi58gYXNzZXRcbiAqL1xuZXhwb3J0IGNsYXNzIFZpcnR1YWxBc3NldCB7XG4gICAgLy8gLS0tLSDotYTmupDliJ3lp4vljJbmoIforrAg5byA5aeLIC0tLVxuICAgIC8vIOaYr+WQpuWIneWni+WMlui/h++8iOeUqOS6juWMuuWIhuWvvOWFpei/h++8jOS9huaYr+ayoeacieaJq+aPj+WIsOeahOaDheWGte+8iVxuICAgIF9pbml0OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBnZXQgaW5pdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXQ7XG4gICAgfVxuICAgIHNldCBpbml0KGJvb2wpIHtcbiAgICAgICAgdGhpcy5faW5pdCA9IGJvb2w7XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnN1YkFzc2V0cyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgICAgIHRoaXMuc3ViQXNzZXRzW2tleV0uaW5pdCA9IGJvb2w7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJvb2wpIHtcbiAgICAgICAgICAgIHdoaWxlKHRoaXMuX3dhaXRJbml0SGFuZGxlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGUgPSB0aGlzLl93YWl0SW5pdEhhbmRsZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGhhbmRsZSAmJiBoYW5kbGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOetieW+heWvvOWFpeWujOaIkFxuICAgICAqL1xuICAgIF93YWl0SW5pdEhhbmRsZTogRnVuY3Rpb25bXSA9IFtdO1xuICAgIGFzeW5jIHdhaXRJbml0KCkge1xuICAgICAgICBpZiAodGhpcy5faW5pdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wYXJlbnQud2FpdEluaXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl93YWl0SW5pdEhhbmRsZS5wdXNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIC0tLS0g6LWE5rqQ5Yid5aeL5YyW5qCH6K6wIOe7k+adnyAtLS1cblxuICAgIC8vIOi1hOa6kOeahOWKqOS9nO+8jOW9k+i1hOa6kOWHhuWkh+WvvOWFpeeahOaXtuWAme+8jOS8muWPmOaIkOWvueW6lOeahOaTjeS9nOexu+Wei++8jOWvvOWFpeWujOaIkOWPmOS4uiBub25lXG4gICAgYWN0aW9uOiBBc3NldEFjdGlvbkVudW0gPSBBc3NldEFjdGlvbkVudW0ubm9uZTtcblxuICAgIC8vIOWvvOWFpeS7u+WKoSBpZFxuICAgIHRhc2s6IG51bWJlciA9IC0xO1xuXG4gICAgLy8g5a+85YWl5aSx6LSl55qE6K+d5Lya5bCG6LWE5rqQ5qCH6K6w5oiQ5peg5pWI6LWE5rqQXG4gICAgaW52YWxpZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLy8gdXVpZCDlr7nlupTnmoTlm57mlLbnq5kgZGF0YSDmlbDmja7vvIzooqvliKDpmaTnmoTmlbDmja7kvJrlnKjov5nph4zlrZjlgqjkuIDmrrXml7bpl7RcbiAgICB1dWlkMnJlY3ljbGU6IHsgW2luZGV4OiBzdHJpbmddOiBNZXRhIH0gPSB7fTtcblxuICAgIC8vIOa6kOaWh+S7tui3r+W+hCAnZGI6Ly9hc3NldC90ZXN0LnBsaXN0QGM4NjlhLnBuZydcbiAgICBnZXQgc291cmNlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3BhcmVudCkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQgPyB0aGlzLl9wYXJlbnQuc291cmNlICsgJ0AnICsgdGhpcy5faWQgOiAnJztcbiAgICB9XG5cbiAgICAvLyBkYiDljY/orq7moLzlvI/nmoQgdXJsIOWcsOWdgFxuICAgIGdldCB1cmwoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudCA/IHRoaXMuX3BhcmVudC51cmwgKyAnQCcgKyB0aGlzLl9pZCA6ICcnO1xuICAgIH1cblxuICAgIC8vIGxpYnJhcnkg6Lev5b6E77yM5LiN5bim5omp5bGV5ZCN55qE5paH5Lu26Lev5b6EIHh4eC8zYy8zY2FiY3MtZGZzZGFmXG4gICAgZ2V0IGxpYnJhcnkoKSB7XG4gICAgICAgIGxldCBpZCA9IHRoaXMuX3BhcmVudCA/IHRoaXMuX2lkIDogdGhpcy5tZXRhLnV1aWQ7XG4gICAgICAgIGxldCBhc3NldCA9IHRoaXMuX3BhcmVudDtcblxuICAgICAgICB3aGlsZSAoYXNzZXQpIHtcbiAgICAgICAgICAgIGlmIChhc3NldC5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBpZCA9IGAke2Fzc2V0Ll9pZH1AJHtpZH1gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZCA9IGAke2Fzc2V0LnV1aWR9QCR7aWR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0ID0gYXNzZXQucGFyZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuX2Fzc2V0REIub3B0aW9ucy5saWJyYXJ5fSR7c2VwfSR7dGhpcy5tZXRhLnV1aWQuc3Vic3RyKDAsIDIpfSR7c2VwfSR7aWR9YDtcbiAgICB9XG5cbiAgICAvLyDotYTmupDkvb/nlKjnmoTkuLTml7bot6/lvoTvvIzkuI3luKbmianlsZXlkI3nmoTmlofku7bot6/lvoQgeHh4LzNjLzNjYWJjcy1kZnNkYWbvvIzph43mlrDlr7zlhaXnmoTml7blgJnkvJrliKDpmaTov5nkuKrot6/lvoTkuIvnmoTkuLTml7bmlofku7ZcbiAgICBnZXQgdGVtcCgpIHtcbiAgICAgICAgbGV0IGlkID0gdGhpcy5fcGFyZW50ID8gdGhpcy5faWQgOiB0aGlzLm1ldGEudXVpZDtcbiAgICAgICAgbGV0IGFzc2V0ID0gdGhpcy5fcGFyZW50O1xuXG4gICAgICAgIHdoaWxlIChhc3NldCkge1xuICAgICAgICAgICAgaWYgKGFzc2V0LnBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlkID0gYCR7YXNzZXQuX2lkfUAke2lkfWA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlkID0gYCR7YXNzZXQudXVpZH1AJHtpZH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQgPSBhc3NldC5wYXJlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYCR7dGhpcy5fYXNzZXREQi5vcHRpb25zLnRlbXB9JHtzZXB9JHt0aGlzLm1ldGEudXVpZC5zdWJzdHIoMCwgMil9JHtzZXB9JHtpZH1gO1xuICAgIH1cblxuICAgIC8vIOWUr+S4gOeahCBpZFxuICAgIGdldCB1dWlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhLnV1aWQ7XG4gICAgfVxuXG4gICAgLy8g5pi+56S655qE5ZCN5a2XXG4gICAgZ2V0IGRpc3BsYXlOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhLmRpc3BsYXlOYW1lIHx8ICcnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPluS4gOS4quWtmOWCqOWcqOi1hOa6kOS4iueahOaVsOaNrlxuICAgICAqIEBwYXJhbSBrZXkgXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgZ2V0RGF0YShrZXk6IHN0cmluZykge1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fYXNzZXREQi5kYXRhTWFuYWVyLmdldCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGRhdGFba2V5XTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDorr7nva7kuIDkuKrlrZjlgqjlnKjotYTmupDkuIrnmoTmlbDmja5cbiAgICAgKiBAcGFyYW0ga2V5IFxuICAgICAqIEBwYXJhbSB2YWx1ZSBcbiAgICAgKiBAcmV0dXJucyBcbiAgICAgKi9cbiAgICBzZXREYXRhKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgICAgIHRoaXMuX2Fzc2V0REIuZGF0YU1hbmFlci5zZXQodGhpcywga2V5LCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGUoKSB7XG4gICAgICAgIFxuICAgIH1cblxuICAgIC8vIOi1hOa6kOWGheeahOmZhOWKoOS/oeaBr++8jOWklumDqOWPr+S7peebtOaOpeiOt+WPllxuICAgIG1ldGE6IE1ldGE7XG5cbiAgICAvLyDlrZDotYTmupDntKLlvJVcbiAgICBzdWJBc3NldHM6IHsgW25hbWU6IHN0cmluZ106IFZpcnR1YWxBc3NldCB9O1xuXG4gICAgLy8g5b2T5YmN6L+b56iL5YaF5piv5ZCm5bey57uP5a+85YWl5a6M5oiQXG4gICAgc2V0IGltcG9ydGVkKGltcG9ydGVkOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMubWV0YS5pbXBvcnRlZCA9IGltcG9ydGVkO1xuICAgIH1cbiAgICBnZXQgaW1wb3J0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmluaXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubWV0YS5pbXBvcnRlZDtcbiAgICB9XG5cbiAgICBfbG9jazogYm9vbGVhbiA9IGZhbHNlO1xuICAgIF93YWl0TG9ja0hhbmRsZXI6IEZ1bmN0aW9uW10gPVtdO1xuXG4gICAgLyoqXG4gICAgICog6ZSB5a6a6LWE5rqQXG4gICAgICovXG4gICAgYXN5bmMgbG9jaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9sb2NrKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9jayA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3dhaXRMb2NrSGFuZGxlci5wdXNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOino+mUgei1hOa6kFxuICAgICAqL1xuICAgIHVubG9jaygpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlID0gdGhpcy5fd2FpdExvY2tIYW5kbGVyLnNoaWZ0KCk7XG4gICAgICAgIC8vIOWmguaenOacieetieW+heeahOS7u+WKoe+8jOWImeaJp+ihjOS4i+S4gOS4qlxuICAgICAgICBpZiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBoYW5kbGUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOW3sue7j+ayoeacieWcqOetieW+heeahOS7u+WKoeS6hu+8jOi/mOWOn+agh+iusFxuICAgICAgICB0aGlzLl9sb2NrID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8g5b2T5YmN6LWE5rqQ5oyC6L2955qE5pWw5o2u5bqTXG4gICAgX2Fzc2V0REI6IEFzc2V0REI7XG5cbiAgICAvLyDlpoLmnpzmmK8gc3ViIGFzc2V077yM5YiZ6L+Z5Liq5YC85oyH5ZCR54i257qn55qEIGFzc2V0XG4gICAgX3BhcmVudDogVmlydHVhbEFzc2V0IHwgQXNzZXQgfCBudWxsID0gbnVsbDtcblxuICAgIC8vIOW9k+WJjei1hOa6kOeahOWQjeWtl1xuICAgIF9uYW1lOiBzdHJpbmc7XG5cbiAgICAvLyDlvZPliY3otYTmupDnmoQgaWRcbiAgICBfaWQ6IHN0cmluZztcblxuICAgIC8vIOaVsOaNruS6pOaNouepuumXtFxuICAgIF9zd2FwU3BhY2U6IGFueSA9IG51bGw7XG5cbiAgICAvLyDmmK/lkKbmmK/mlofku7blpLnvvIzotYTmupDlj6rmnInnrKzkuIDmrKHmn6Xor6LpnIDopoHku44gc3RhdCDojrflj5bvvIzkuYvlkI7pg73lupTor6XnlKjnvJPlrZhcbiAgICBfaXNEaXJlY3Rvcnk/OiBib29sZWFuO1xuXG4gICAgLy8g5ou/5Ye654i26LWE5rqQXG4gICAgZ2V0IHBhcmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudDtcbiAgICB9XG5cbiAgICAvLyBtZXRhIOWGhemZhOW4pueahCB1c2VyRGF0YSDmlbDmja5cbiAgICBnZXQgdXNlckRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1ldGEudXNlckRhdGE7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IobWV0YTogTWV0YSwgbmFtZTogc3RyaW5nLCBpZDogc3RyaW5nLCBhc3NldERCOiBBc3NldERCKSB7XG4gICAgICAgIHRoaXMubWV0YSA9IGNvbXBsZXRpb25NZXRhKG1ldGEpO1xuICAgICAgICB0aGlzLmltcG9ydGVkID0gbWV0YS5pbXBvcnRlZDtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG1ldGEubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX2lkID0gbWV0YS5pZCA9IGlkO1xuXG4gICAgICAgIHRoaXMuX2Fzc2V0REIgPSBhc3NldERCO1xuXG4gICAgICAgIC8vIHN1YiBhc3NldFxuICAgICAgICAvLyDlnKggYXNzZXREQiDlhoXmmK/mn6Xor6LkuI3liLDnmoTvvIzlj6rog73pgJrov4fniLYgYXNzZXQg5p+l6K+i5YiwIHN1YiBhc3NldFxuICAgICAgICB0aGlzLnN1YkFzc2V0cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIE9iamVjdC5rZXlzKG1ldGEuc3ViTWV0YXMpLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCBzdWJNZXRhID0gbWV0YS5zdWJNZXRhc1tuYW1lXTtcbiAgICAgICAgICAgIC8vIOeItui1hOa6kOWwmuacquWvvOWFpe+8jOWtkOi1hOa6kOS4jeS4uuWFtueUn+aIkCBzdWJBc3NldO+8jOW5tumcgOimgeehruiupOagh+iusCBpbXBvcnRlZCA9IGZhbHNlXG4gICAgICAgICAgICBpZiAoIXN1Yk1ldGEubmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzdWJBc3NldCA9IG5ldyBWaXJ0dWFsQXNzZXQoc3ViTWV0YSwgc3ViTWV0YS5uYW1lLCBzdWJNZXRhLmlkLCBhc3NldERCKTtcbiAgICAgICAgICAgIHN1YkFzc2V0Ll9wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5zdWJBc3NldHNbbmFtZV0gPSBzdWJBc3NldDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5aSN5Yi25aSW6YOo55qEIHVzZXJEYXRhIOaVsOaNrlxuICAgICAqIEBwYXJhbSBqc29uIOaooeeJiOWvueixoVxuICAgICAqIEBwYXJhbSBvdmVyd3JpdGUg5aaC5p6cIHVzZXJEYXRhIOWGheacieaVsOaNru+8jOaYr+WQpuS9v+eUqOaooeeJiOWGheeahOaVsOaNruimhueblu+8jOm7mOiupCBmYWxzZVxuICAgICAqL1xuICAgIGFzc2lnblVzZXJEYXRhKGpzb246IE9iamVjdCwgb3ZlcndyaXRlOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMubWV0YS51c2VyRGF0YTtcbiAgICAgICAgXG4gICAgICAgIGlmIChvdmVyd3JpdGUpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwganNvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4ganNvbikge1xuICAgICAgICAgICAgICAgIGlmIChrZXkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGF0YVtrZXldID0ganNvbltrZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5L+d5a2Y5b2T5YmN6LWE5rqQ55qEIG1ldGEg5L+h5oGvXG4gICAgICovXG4gICAgYXN5bmMgc2F2ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9wYXJlbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWboOS4uuiZmuaLn+eahCBhc3NldCDmsqHmnIkgLm1ldGEg5paH5Lu277yM5omA5Lul6LCD55So54i257qn55qEIHNhdmVNZXRhXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9wYXJlbnQuc2F2ZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOa4heepuuW5tui/mOWOnyBtZXRhIOaVsOaNrlxuICAgICAqIOW5tua4hemZpCBzdWJNZXRhIOWGheeahOaVsOaNrlxuICAgICAqIEBwYXJhbSBoYW5kbGUg5Yig6Zmk5YaF6YOo55qEIHN1YkFzc2V0IOeahOaXtuWAmeS8muaJp+ihjOWbnuiwg1xuICAgICAqL1xuICAgIGFzeW5jIHJlc2V0KCkge1xuICAgICAgICAvLyDmo4Dmn6XlubbliKDpmaTkuLTml7bnvJPlrZhcbiAgICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy50ZW1wKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZW1vdmVTeW5jKHRoaXMudGVtcCk7XG4gICAgICAgICAgICB9IGNhdGNoKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gZGVsZXRlIHRlbXBvcmFyeSBjYWNoZTogJHt0aGlzLnNvdXJjZX1gKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g5Yig6Zmk5a+85YWl55qE5paH5Lu2XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLm1ldGEuZmlsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBleHRuYW1lID0gdGhpcy5tZXRhLmZpbGVzW2ldO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZUZyb21MaWJyYXJ5KGV4dG5hbWUpO1xuICAgICAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGRlbGV0ZSB0ZW1wb3JhcnkgY2FjaGU6ICR7dGhpcy5zb3VyY2V9YCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1ldGEuZmlsZXMgPSBbXTtcblxuICAgICAgICAvLyDmuIXnqbogc3ViIGFzc2V0IOWGheeahOaVsOaNrlxuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zdWJBc3NldHMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICAgICAgICBjb25zdCBzdWJBc3NldCA9IHRoaXMuc3ViQXNzZXRzW2tleV07XG4gICAgICAgICAgICAvLyDov5nmmK/kuIDkuKrlvILmraXmk43kvZzvvIxzdWJBc3NldCDmnInlj6/og73lnKjmk43kvZzov4fnqIvkuK3vvIzooqvliKDpmaRcbiAgICAgICAgICAgIGlmIChzdWJBc3NldCAmJiBzdWJBc3NldC5yZXNldCkge1xuICAgICAgICAgICAgICAgIC8vIOaUvuWFpeWbnuaUtuermSwgaWRcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQycmVjeWNsZVtrZXldID0gc3ViQXNzZXQubWV0YTtcbiAgICAgICAgICAgICAgICBhd2FpdCBzdWJBc3NldC5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHN1YkFzc2V0LmltcG9ydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm1ldGEuc3ViTWV0YXNba2V5XTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnN1YkFzc2V0c1trZXldO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g6L+Y5Y6f6Ieq6Lqr55qE5pWw5o2u77yMdXNlckRhdGEg5LiN6ZyA6KaB6L+Y5Y6fXG4gICAgICAgIC8vIHRoaXMubWV0YS52ZXIgPSAnMC4wLjAnO1xuICAgICAgICAvLyB0aGlzLm1ldGEuaW1wb3J0ZXIgPSAnKic7IC8vIGltcG9ydGVyIOS4jei/mOWOn1xuICAgICAgICB0aGlzLmltcG9ydGVkID0gZmFsc2U7XG5cbiAgICAgICAgLy8g5riF56m65L6d6LWW5YWz57O7XG4gICAgICAgIHRoaXMuX2Fzc2V0REIuZGVwZW5kZW5jeU1hbmFnZXIucmVtb3ZlKCd1dWlkJywgdGhpcy51dWlkKTtcbiAgICAgICAgdGhpcy5fYXNzZXREQi5kZXBlbmRlbmN5TWFuYWdlci5yZW1vdmUoJ3BhdGgnLCB0aGlzLnNvdXJjZSk7XG4gICAgICAgIHRoaXMuX2Fzc2V0REIuZGVwZW5kZW5jeU1hbmFnZXIucmVtb3ZlKCd1cmwnLCB0aGlzLnVybCk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5p+l6K+i5LiA5Liq5paH5Lu255qE57ud5a+55Zyw5Z2AXG4gICAgICogQHBhcmFtIGV4dE9yRmlsZSBcbiAgICAgKi9cbiAgICBnZXRGaWxlUGF0aChleHRPckZpbGU6IHN0cmluZykge1xuICAgICAgICBpZiAoaXNFeHRuYW1lKGV4dE9yRmlsZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLmxpYnJhcnl9JHtleHRPckZpbGV9YDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLmxpYnJhcnl9JHtzZXB9JHtleHRPckZpbGV9YDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWtmOWCqOS4gOS4qiB1dWlkIOS4uuWQjeWtl+eahCBidWZmZXJcbiAgICAgKiDkvKDlhaXkuIDkuKrmianlsZXlkI3miJbogIXnm7jlr7not6/lvoTvvIzlpoLmnpzkvKDlhaXmianlsZXlkI3vvIzliJnlrZjlgqjliLAgdXVpZC5leHRuYW1lXG4gICAgICog5aaC5p6c5Lyg5YWl55qE5piv5LiA5Liq55u45a+56Lev5b6E5oiW6ICF5paH5Lu25ZCN77yM5YiZ5pS+5YiwIHV1aWQg5Li65ZCN5a2X55qE55uu5b2V5YaFXG4gICAgICogQHBhcmFtIGV4dE9yUGF0aCDkuIDkuKrmianlsZXlkI3miJbogIXnm7jlr7not6/lvoRcbiAgICAgKiBAcGFyYW0gYnVmZmVyIFxuICAgICAqL1xuICAgIGFzeW5jIHNhdmVUb0xpYnJhcnkoZXh0T3JGaWxlOiBzdHJpbmcsIGJ1ZmZlcjogQnVmZmVyIHwgc3RyaW5nKSB7XG4gICAgICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGJ1ZmZlcikgJiYgdHlwZW9mIGJ1ZmZlciAhPT0gJ3N0cmluZycgJiYgIUFycmF5QnVmZmVyLmlzVmlldyhidWZmZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBcImRhdGFcIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nIG9yIGFuIGluc3RhbmNlIG9mIEJ1ZmZlciBvciBBcnJheUJ1ZmZlcicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIOWmguaenOaYr+aJqeWxleWQje+8jOebtOaOpeWtmOWCqOWIsCB1dWlkLmV4dG5hbWVcbiAgICAgICAgaWYgKGlzRXh0bmFtZShleHRPckZpbGUpKSB7XG4gICAgICAgICAgICBsZXQgZmlsZSA9IGAke3RoaXMubGlicmFyeX0ke2V4dE9yRmlsZX1gO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5tZXRhLmZpbGVzLmluZGV4T2YoZXh0T3JGaWxlKTtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMucHVzaChleHRPckZpbGUpO1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5zb3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCBvdXRwdXRGaWxlKGZpbGUsIGJ1ZmZlcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlpoLmnpzkvKDlhaXnmoTkuI3mmK/mianlsZXlkI3vvIzmga3llpzvvIzmlrDlu7rkuIDkuKogdXVpZCDmlofku7blpLnlrZjmlL7lkKdcbiAgICAgICAgYXdhaXQgZW5zdXJlRGlyKHRoaXMubGlicmFyeSk7XG4gICAgICAgIGxldCBmaWxlID0gdGhpcy5saWJyYXJ5ICsgc2VwICsgZXh0T3JGaWxlO1xuICAgICAgICBsZXQgcmVsYXRpdmVGaWxlID0gcmVsYXRpdmUodGhpcy5saWJyYXJ5LCBmaWxlKTtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5tZXRhLmZpbGVzLmluZGV4T2YocmVsYXRpdmVGaWxlKTtcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnB1c2gocmVsYXRpdmVGaWxlKTtcbiAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5zb3J0KCk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgb3V0cHV0RmlsZShmaWxlLCBidWZmZXIpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5aSN5Yi25LiA5Liq5paH5Lu25YiwIGxpYnJhcnkg5YaFXG4gICAgICogQHBhcmFtIGV4dE9yRmlsZSBcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IFxuICAgICAqL1xuICAgIGFzeW5jIGNvcHlUb0xpYnJhcnkoZXh0T3JGaWxlOiBzdHJpbmcsIHRhcmdldDogc3RyaW5nKSB7XG4gICAgICAgIC8vIOWmguaenOaYr+aJqeWxleWQje+8jOebtOaOpeWtmOWCqOWIsCB1dWlkLmV4dG5hbWVcbiAgICAgICAgaWYgKGlzRXh0bmFtZShleHRPckZpbGUpKSB7XG4gICAgICAgICAgICBsZXQgZmlsZSA9IGAke3RoaXMubGlicmFyeX0ke2V4dE9yRmlsZX1gO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5tZXRhLmZpbGVzLmluZGV4T2YoZXh0T3JGaWxlKTtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMucHVzaChleHRPckZpbGUpO1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YS5maWxlcy5zb3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhpc3RzU3luYyhmaWxlKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJlbW92ZShmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IGNvcHkodGFyZ2V0LCBmaWxlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOS8oOWFpeeahOS4jeaYr+aJqeWxleWQje+8jOaBreWWnO+8jOaWsOW7uuS4gOS4qiB1dWlkIOaWh+S7tuWkueWtmOaUvuWQp1xuICAgICAgICBhd2FpdCBlbnN1cmVEaXIodGhpcy5saWJyYXJ5KTtcbiAgICAgICAgbGV0IGZpbGUgPSB0aGlzLmxpYnJhcnkgKyBzZXAgKyBleHRPckZpbGU7XG4gICAgICAgIGxldCByZWxhdGl2ZUZpbGUgPSByZWxhdGl2ZSh0aGlzLmxpYnJhcnksIGZpbGUpO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLm1ldGEuZmlsZXMuaW5kZXhPZihyZWxhdGl2ZUZpbGUpO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLm1ldGEuZmlsZXMucHVzaChyZWxhdGl2ZUZpbGUpO1xuICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNvcnQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXhpc3RzU3luYyhmaWxlKSkge1xuICAgICAgICAgICAgYXdhaXQgcmVtb3ZlKGZpbGUpO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGNvcHkodGFyZ2V0LCBmaWxlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDliKDpmaTkuIDkuKrku6UgdXVpZCDkuLrlkI3lrZfnmoTlr7zlhaXmlofku7ZcbiAgICAgKiBAcGFyYW0gZXh0T3JGaWxlIFxuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZUZyb21MaWJyYXJ5KGV4dE9yRmlsZTogc3RyaW5nKSB7XG4gICAgICAgIGlmIChpc0V4dG5hbWUoZXh0T3JGaWxlKSkge1xuICAgICAgICAgICAgbGV0IGZpbGUgPSBgJHt0aGlzLmxpYnJhcnl9JHtleHRPckZpbGV9YDtcbiAgICAgICAgICAgIGlmICghZXhpc3RzU3luYyhmaWxlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMubWV0YS5maWxlcy5pbmRleE9mKGV4dE9yRmlsZSk7XG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCByZW1vdmUoZmlsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlpoLmnpzkvKDlhaXnmoTkuI3mmK/mianlsZXlkI3vvIzmga3llpzvvIzmlrDlu7rkuIDkuKogdXVpZCDmlofku7blpLnlrZjmlL7lkKdcbiAgICAgICAgYXdhaXQgZW5zdXJlRGlyKHRoaXMubGlicmFyeSk7XG4gICAgICAgIGxldCBmaWxlID0gdGhpcy5saWJyYXJ5ICsgc2VwICsgZXh0T3JGaWxlO1xuICAgICAgICBsZXQgcmVsYXRpdmVGaWxlID0gcmVsYXRpdmUodGhpcy5saWJyYXJ5LCBmaWxlKTtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5tZXRhLmZpbGVzLmluZGV4T2YocmVsYXRpdmVGaWxlKTtcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5tZXRhLmZpbGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgcmVtb3ZlKGZpbGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWIpOaWreS4gOS4quS7pSB1dWlkIOS4uuWQjeWtl+eahOaWh+S7tuaYr+WQpuWtmOWcqFxuICAgICAqIEBwYXJhbSBleHRPckZpbGUgXG4gICAgICovXG4gICAgZXhpc3RzSW5MaWJyYXJ5KGV4dE9yRmlsZTogc3RyaW5nKSB7XG4gICAgICAgIC8vIOWmguaenCBtZXRhIOiusOW9leeahOaWh+S7tuWGheayoeacieW9k+WJjeaWh+S7tu+8jOWImeebtOaOpei/lOWbnuaWh+S7tuS4jeWtmOWcqFxuICAgICAgICBpZiAodGhpcy5tZXRhLmZpbGVzLmluZGV4T2YoZXh0T3JGaWxlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmaWxlO1xuICAgICAgICBpZiAoaXNFeHRuYW1lKGV4dE9yRmlsZSkpIHtcbiAgICAgICAgICAgIGZpbGUgPSBgJHt0aGlzLmxpYnJhcnl9JHtleHRPckZpbGV9YDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbGUgPSBgJHt0aGlzLmxpYnJhcnl9JHtzZXB9JHtleHRPckZpbGV9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXhpc3RzU3luYyhmaWxlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDliKTmlq3mmK/lkKbmmK/mlofku7blpLlcbiAgICAgKi9cbiAgICBpc0RpcmVjdG9yeSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWIm+W7uuS4gOS4quiZmuaLn+eahCBhc3NldO+8jOi/meS4qiBhc3NldCDmsqHmnInlrp7kvZNcbiAgICAgKiDkuIDkuKromZrmi5/nmoQgYXNzZXQg5Lmf5YWB6K645a2Y5YKo6YO95Liq5paH5Lu2XG4gICAgICogQHBhcmFtIG5hbWUgXG4gICAgICogQHBhcmFtIGltcG9ydGVyIOS9v+eUqOS7gOS5iOino+aekFxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZVN1YkFzc2V0KG5hbWU6IHN0cmluZywgaW1wb3J0ZXI6IHN0cmluZywgb3B0aW9uczogeyBkaXNwbGF5TmFtZT86IHN0cmluZzsgaWQ/OiBzdHJpbmc7IH0gPSB7IGRpc3BsYXlOYW1lOiAnJyB9KSB7XG4gICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgJ0ZhaWxlZCB0byBjcmVhdGUgc3ViQXNzZXQ6IEl0IG11c3QgaGF2ZSBhIG5hbWUnO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdWJBc3NldDtcbiAgICAgICAgbGV0IGlkID0gb3B0aW9ucy5pZCB8fCBuYW1lVG9JZChuYW1lKTtcblxuICAgICAgICBsZXQgaSA9IDE7XG4gICAgICAgIHdoaWxlICh0aGlzLnN1YkFzc2V0c1tpZF0gJiYgdGhpcy5zdWJBc3NldHNbaWRdLm1ldGEubmFtZSAhPT0gbmFtZSkge1xuICAgICAgICAgICAgaWQgPSBuYW1lVG9JZChuYW1lLCBpKyspO1xuICAgICAgICAgICAgaWYgKGkgPj0gMjYpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjcmVhdGUgYSBuZXcgc3ViQXNzZXQ6ICR7bmFtZX1cXG4gIFBsZWFzZSB0cnkgdG8gY2hhbmdlIHlvdXIgYXNzZXQgbmFtZWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc3ViQXNzZXRzW25hbWVdKSB7XG4gICAgICAgICAgICBzdWJBc3NldCA9IHRoaXMuc3ViQXNzZXRzW25hbWVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW1wb3J0ZXIgPSBpbXBvcnRlciB8fCAnKic7XG5cbiAgICAgICAgICAgIC8vIOWIpOaWreaYr+WQpuS7juWbnuaUtuaxoOaLvyBtZXRhIOaVsOaNrlxuICAgICAgICAgICAgbGV0IG1ldGE6IE1ldGEgPSB0aGlzLnV1aWQycmVjeWNsZVtpZF07XG4gICAgICAgICAgICBpZiAoIW1ldGEgfHwgbWV0YS5pbXBvcnRlciAhPT0gaW1wb3J0ZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJNZXRhID0gdGhpcy5tZXRhLnN1Yk1ldGFzW2lkXTtcbiAgICAgICAgICAgICAgICBtZXRhID0gY29tcGxldGlvbk1ldGEoe1xuICAgICAgICAgICAgICAgICAgICBpbXBvcnRlcjogaW1wb3J0ZXIsXG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IGAke3RoaXMudXVpZH1AJHtpZH1gLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogb3B0aW9ucy5kaXNwbGF5TmFtZSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJEYXRhOiBzdWJNZXRhID8gc3ViTWV0YS51c2VyRGF0YSB8fCB7fSA6IHt9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzmmK/lj6/nlKjmlbDmja7vvIzopoHnoa7kv50gdXVpZCDmmK/ku47niLbotYTmupDmnaXnmoRcbiAgICAgICAgICAgICAgICAvLyDlpI3liLbov4fmnaXnmoQgbWV0YSDmnInlj6/og70gdXVpZCDlkowgZGlzcGxheU5hbWUg5piv6ZSZ55qEXG4gICAgICAgICAgICAgICAgbWV0YS51dWlkID0gYCR7dGhpcy51dWlkfUAke2lkfWA7XG4gICAgICAgICAgICAgICAgbWV0YS5kaXNwbGF5TmFtZSA9IG9wdGlvbnMuZGlzcGxheU5hbWUgfHwgJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDliKDpmaTlm57mlLbmsaDlhoXnmoTmlbDmja5cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnV1aWQycmVjeWNsZVtpZF07XG5cbiAgICAgICAgICAgIHN1YkFzc2V0ID0gbmV3IFZpcnR1YWxBc3NldChtZXRhLCBuYW1lLCBpZCwgdGhpcy5fYXNzZXREQik7XG4gICAgICAgICAgICBzdWJBc3NldC5fcGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMubWV0YS5zdWJNZXRhc1tpZF0gPSBzdWJBc3NldC5tZXRhO1xuICAgICAgICAgICAgdGhpcy5zdWJBc3NldHNbaWRdID0gc3ViQXNzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3ViQXNzZXRzW2lkXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDms6jlhozkvp3otZbnmoTmlofku7ZcbiAgICAgKiDorrDlvZXnmoTmmK/kvp3otZbnmoTmlofku7bnmoTmupDot6/lvoRcbiAgICAgKiDlnKjmr4/mrKEgYXNzZXQg5Lu75Yqh5LmL5ZCO6YO96ZyA6KaB5qOA5p+l5L6d6LWWIGFzc2V0IOeahOi1hOa6kOW5tuabtOaWsFxuICAgICAqIOS+nei1lueahOaWh+S7tuabtOaWsOeahOaXtuWAme+8jOmcgOimgeabtOaWsOiHqui6q1xuICAgICAqIEBwYXJhbSBmaWxlT3JVdWlkIOW9k+WJjei1hOa6kOS+nei1lueahOaWh+S7tueahOe7neWvuei3r+W+hO+8jOS4jeiDveS8oOWFpeebuOWvuei3r+W+hFxuICAgICAqICAgZGI6Ly9hc3NldHMvdGVzdC5qc29uXG4gICAgICogICAvVXNlcnMveHgvcHJvamVjdC9hc3NldHMvdGVzdC5qc29uXG4gICAgICogICBkYjovL2Fzc2V0cy90ZXN0LnBsaXN0QGMzMGZiXG4gICAgICovXG4gICAgZGVwZW5kKGZpbGVPclV1aWRPclVybDogc3RyaW5nKSB7XG4gICAgICAgIGlmICghcmVjdXJzaXZlQ2hlY2tBc3NvY2lhdGVkQXNzZXRzKGZpbGVPclV1aWRPclVybCwgdGhpcykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlcmUgYXJlIHJlY3Vyc2l2ZSBkZXBlbmRlbmNpZXM6ICR7ZmlsZU9yVXVpZE9yVXJsfSAke3RoaXMudXVpZH1gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNBYnNvbHV0ZShmaWxlT3JVdWlkT3JVcmwpKSB7XG4gICAgICAgICAgICB0aGlzLl9hc3NldERCLmRlcGVuZGVuY3lNYW5hZ2VyLmFkZCgncGF0aCcsIHRoaXMuc291cmNlLCBmaWxlT3JVdWlkT3JVcmwpO1xuICAgICAgICB9IGVsc2UgaWYgKGZpbGVPclV1aWRPclVybC5zdGFydHNXaXRoKCdkYjovLycpKSB7XG4gICAgICAgICAgICB0aGlzLl9hc3NldERCLmRlcGVuZGVuY3lNYW5hZ2VyLmFkZCgndXJsJywgdGhpcy5zb3VyY2UsIGZpbGVPclV1aWRPclVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9hc3NldERCLmRlcGVuZGVuY3lNYW5hZ2VyLmFkZCgndXVpZCcsIHRoaXMuc291cmNlLCBmaWxlT3JVdWlkT3JVcmwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6I635Y+W5Lqk5o2i56m66Ze05a+56LGhXG4gICAgICog6L+Z5Liq56m66Ze05Li76KaB5piv5o+Q5L6b57uZ54i25a2Q6LWE5rqQ6Ze05pWw5o2u55u45LqS5L6d6LWW5L2/55So55qE5Li05pe25pWw5o2u56m66Ze0XG4gICAgICog5bm25LiN5Lya5L+d6K+B5pWw5o2u5a2Y5Zyo77yM6ZyA6KaB5L2/55So5pa56Ieq5bex5Y675Yik5pat5pWw5o2u5q2j56Gu5oCn77yM5aaC5peg5pWw5o2u77yM6ZyA6KaB6Ieq5bex55Sf5oiQXG4gICAgICovXG4gICAgZ2V0U3dhcFNwYWNlPFQ+KCk6IFQge1xuICAgICAgICB0aGlzLl9zd2FwU3BhY2UgPSB0aGlzLl9zd2FwU3BhY2UgfHwge307XG4gICAgICAgIHJldHVybiB0aGlzLl9zd2FwU3BhY2UgYXMgVDtcbiAgICB9XG59XG5cbi8qKlxuICog5a2Y5YKo5YiwIGFzc2V0IGRiIOWGheeahCBhc3NldCDlrp7kvotcbiAqIOWIm+W7uueahOaXtuWAmeS8muivu+WPluWvueW6lOeahCAubWV0YSDmlofku7ZcbiAqIOWmguaenCBtZXRhIOS4jeWtmOWcqOWImeS8muWIm+W7uu+8jOW5tuWIhumFjeS4gOS4qiB1dWlkXG4gKi9cbmV4cG9ydCBjbGFzcyBBc3NldCBleHRlbmRzIFZpcnR1YWxBc3NldCB7XG5cbiAgICAvLyDmupDmlofku7bot6/lvoQgJy9Vc2Vycy9uYW1lL2Fzc2V0L3Rlc3QucGxpc3QnXG4gICAgX3NvdXJjZTogc3RyaW5nO1xuICAgIGdldCBzb3VyY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2U7XG4gICAgfVxuXG4gICAgLy8gZGI6Ly9uYW1lL3h4eC5wbmcg5qC85byP55qEIHVybCDlnLDlnYBcbiAgICBfdXJsOiBzdHJpbmc7XG4gICAgZ2V0IHVybCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VybDtcbiAgICB9XG5cbiAgICAvLyDmianlsZXlkI0gJy5qc29uJyDml6Dop4blpKflsI/lhpnvvIzpg73kvJrovazmjaLmiJDlsI/lhpnlrZjlgqhcbiAgICBleHRuYW1lOiBzdHJpbmc7XG5cbiAgICAvLyDljrvpmaTmianlsZXlkI3nmoTmlofku7blkI0gJ3VzZXInXG4gICAgYmFzZW5hbWU6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHNvdXJjZTogc3RyaW5nLCBtZXRhOiBNZXRhLCBhc3NldERCOiBBc3NldERCKSB7XG4gICAgICAgIGxldCBleHQgPSBleHRuYW1lKHNvdXJjZSk7XG4gICAgICAgIGxldCBiYXNlID0gYmFzZW5hbWUoc291cmNlLCBleHQpO1xuXG4gICAgICAgIHN1cGVyKG1ldGEsIG1ldGEubmFtZSwgbWV0YS5pZCwgYXNzZXREQik7XG5cbiAgICAgICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgICAgICB0aGlzLmV4dG5hbWUgPSBleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdGhpcy5iYXNlbmFtZSA9IGJhc2U7XG5cbiAgICAgICAgdGhpcy5fdXJsID0gJyc7XG4gICAgICAgIHRoaXMudXBkYXRlVXJsKCk7XG4gICAgfVxuXG4gICAgdXBkYXRlVXJsKCkge1xuICAgICAgICB0aGlzLl91cmwgPSBgZGI6Ly8ke3RoaXMuX2Fzc2V0REIub3B0aW9ucy5uYW1lfS8ke3JlbGF0aXZlKHRoaXMuX2Fzc2V0REIub3B0aW9ucy50YXJnZXQsIHRoaXMuc291cmNlKS5yZXBsYWNlKC9cXFxcL2csICcvJyl9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDkv53lrZjlvZPliY3otYTmupDnmoQgbWV0YSDkv6Hmga9cbiAgICAgKi9cbiAgICBzYXZlKCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICAhZXhpc3RzU3luYyh0aGlzLnNvdXJjZSkgLy8g5aaC5p6c5rqQ5paH5Lu26KKr5Yig6Zmk5LqG77yM5YiZ5LiN6ZyA6KaB57un57ut5L+d5a2YXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1ldGFQYXRoID0gdGhpcy5zb3VyY2UgKyAnLm1ldGEnO1xuICAgICAgICB0aGlzLl9hc3NldERCLm1ldGFNYW5hZ2VyLndyaXRlKG1ldGFQYXRoKTtcbiAgICAgICAgY29uc3QgbWV0YVN0YXRzID0gc3RhdFN5bmMobWV0YVBhdGgpO1xuICAgICAgICB0aGlzLl9hc3NldERCLmluZm9NYW5hZ2VyLmFkZChtZXRhUGF0aCwgbWV0YVN0YXRzLm10aW1lTXMpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDliKTmlq3mmK/lkKbmmK/mlofku7blpLlcbiAgICAgKi9cbiAgICBpc0RpcmVjdG9yeSgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzRGlyZWN0b3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0RpcmVjdG9yeTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGF0cyA9IHN0YXRTeW5jKHRoaXMuc291cmNlKTtcbiAgICAgICAgaWYgKCFzdGF0cykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RpcmVjdG9yeSA9IHN0YXRzLmlzRGlyZWN0b3J5KCk7XG4gICAgfVxufVxuIl19