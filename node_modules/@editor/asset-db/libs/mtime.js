"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MtimeManager=void 0;const fs_extra_1=require("fs-extra");class MtimeManager{constructor(){this.mtimeMap={},this._saveTimer=null}async setRecordJSON(e){if(this.file=e,fs_extra_1.existsSync(e))try{this.mtimeMap=fs_extra_1.readJSONSync(this.file)}catch(e){console.error(e),this.mtimeMap={}}else this.mtimeMap={}}destroy(){this.mtimeMap={}}save(){clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>{this.saveImmediate()},400)}saveImmediate(){clearTimeout(this._saveTimer),this.file&&fs_extra_1.outputJSONSync(this.file,this.mtimeMap,{spaces:2})}add(e,t){this.mtimeMap[e]!==t&&(this.mtimeMap[e]=t,this.save())}async remove(e){this.mtimeMap[e]&&(delete this.mtimeMap[e],this.save())}async get(e){return this.mtimeMap[e]||null}async compare(e,t){const s=this.mtimeMap[e];return!!s&&s===t}}exports.MtimeManager=MtimeManager;