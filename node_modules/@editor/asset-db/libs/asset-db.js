"use strict";
'use stirct';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssetDB = exports.version = exports.map = void 0;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const events_1 = require("events");
const node_uuid_1 = require("node-uuid");
const importer_1 = require("./importer");
const asset_1 = require("./asset");
const utils_1 = require("./utils");
const meta_1 = require("./meta");
const info_1 = require("./info");
const task_1 = require("./task");
const dependency_1 = require("./dependency");
const data_1 = require("./data");
const manager_1 = require("./manager");
const workflow_extra_1 = require("workflow-extra");
const fast_glob_1 = __importDefault(require("fast-glob"));
var manager_2 = require("./manager");
Object.defineProperty(exports, "map", { enumerable: true, get: function () { return manager_2.map; } });
function getAsset(uuid) {
    for (let name in manager_1.map) {
        const db = manager_1.map[name];
        const asset = db.uuid2asset.get(uuid);
        if (asset) {
            return asset;
        }
    }
    return undefined;
}
exports.version = '2.0.0';
class AssetDB extends events_1.EventEmitter {
    /**
     * 实例化过程
     * @param options
     */
    constructor(options) {
        super();
        // 标记
        this.flag = {
            // 是否正在启动
            starting: false,
            // 是否已经启动的标记
            started: false,
        };
        // path 对应 asset 的 map
        this.path2asset = new Map;
        // uuid 对应 asset 的 map
        this.uuid2asset = new Map;
        // importer 管理器
        this.importerManager = new importer_1.ImporterManager(this);
        this._lock = false;
        this._waitLockHandler = [];
        if (!options.target || !options.library) {
            console.error(`The database cannot be created because there is no target or library definition`);
        }
        else {
            options.target = (0, utils_1.absolutePath)(options.target);
            options.library = (0, utils_1.absolutePath)(options.library);
            if (!options.temp) {
                options.temp = (0, path_1.join)(options.library, '.temp');
            }
            options.temp = (0, utils_1.absolutePath)(options.temp);
        }
        // 设置输出等级
        if (!('level' in options) || options.level > 4 || options.level < 0) {
            options.level = 4;
        }
        if (!options.ignoreFiles || !Array.isArray(options.ignoreFiles)) {
            options.ignoreFiles = [];
        }
        this.options = options;
        // 启动数据库内置的各个管理器管理器
        this.taskManager = new workflow_extra_1.ParallelQueue(async (asset) => {
            const importer = await this.importerManager.find(asset);
            if (!importer ||
                // 删除的时候很可能文件不存在，所以 importer 有一定概率是 *，这时候和原有的导入器肯定不匹配，所以不需要处理删除
                (asset.action !== asset_1.AssetActionEnum.delete &&
                    (importer.name !== asset.meta.importer && asset.meta.importer !== '*') &&
                    asset.imported)) {
                if (!asset.init) {
                    if (this.options.level >= 1) {
                        console.error(`Unable to import data, no suitable importer was found. {asset[${asset instanceof asset_1.Asset ? asset.basename : ''}](${asset.uuid})}`);
                    }
                    asset.invalid = true;
                    asset.init = true;
                }
                return false;
            }
            switch (asset.action) {
                case asset_1.AssetActionEnum.add: {
                    this.dataManaer.empty(asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('added', asset);
                    break;
                }
                case asset_1.AssetActionEnum.change: {
                    this.dataManaer.empty(asset);
                    // await TASK_MAP.destroy.exec(this, asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('changed', asset);
                    break;
                }
                case asset_1.AssetActionEnum.delete: {
                    this.dataManaer.empty(asset);
                    await task_1.TASK_MAP.destroy.exec(this, asset);
                    if (asset instanceof asset_1.Asset) {
                        const metaFile = asset.source + '.meta';
                        this.metaManager.remove(metaFile);
                        this.infoManager.remove(asset.source);
                        this.infoManager.remove(metaFile);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('deleted', asset);
                    break;
                }
                case asset_1.AssetActionEnum.none: {
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, false)) {
                        await asset.save();
                    }
                    break;
                }
            }
            asset.init = true;
            if (asset.action !== asset_1.AssetActionEnum.none) {
                this.dataManaer.save();
            }
            asset.action = asset_1.AssetActionEnum.none;
            return true;
        }, 5);
        // 全局可用的系统相关的管理器
        this.metaManager = new meta_1.MetaManager();
        this.infoManager = new info_1.InfoManager();
        this.dependencyManager = new dependency_1.DependencyManager();
        this.dataManaer = new data_1.DataManager();
        // 注册默认的解析器
        this.importerManager.add(importer_1.DefaultImporter, ['*']);
    }
    get assetProgressInfo() {
        return {
            // @ts-ignore TODO taskManager 是否可以提供此字段
            current: this.taskManager._execID - this.taskManager._execThread,
            total: this.taskManager.total(),
            // @ts-ignore TODO taskManager 是否可以提供此字段
            wait: this.taskManager._waitQueue.size,
        };
    }
    /**
     * 锁定资源
     */
    async lock() {
        if (!this._lock) {
            return this._lock = true;
        }
        return await new Promise((resolve, reject) => {
            this._waitLockHandler.push(() => {
                resolve(null);
            });
        });
    }
    /**
     * 解锁资源
     */
    unlock() {
        const handle = this._waitLockHandler.shift();
        // 如果有等待的任务，则执行下一个
        if (handle) {
            handle();
            return;
        }
        // 已经没有在等待的任务了，还原标记
        this._lock = false;
    }
    /**
     * 启动资源数据库
     */
    async start(options = {}) {
        if (!this.options.target || !this.options.library || !this.options.temp) {
            if (this.options.level >= 1) {
                console.error(`Parameter error, unable to start.`);
            }
            return;
        }
        if (this.flag.started && this.options.level >= 2) {
            console.warn(`The ${this.options.name} database is already started.`);
            return;
        }
        this.flag.started = true;
        this.flag.starting = true;
        await this.metaManager.setBackupPath((0, path_1.join)(this.options.temp, 'meta'));
        await this.metaManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-meta.json`));
        await this.infoManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-info.json`));
        await this.dataManaer.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-data.json`));
        await this.dependencyManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-dependency.json`));
        // 要在资源刷新前加入缓存
        manager_1.map[this.options.name] = this;
        // 刷新资源数据库内的资源列表
        let num = await this.refresh(this.options.target, {
            ignoreSelf: true,
            hooks: options.hooks,
        });
        let infoDirty = false;
        // 删除已经不存在的资源
        // mtime 记录的都是之前存在的文件，所以循环 mtime 管理器里的数据进行校验
        for (let path in this.infoManager.map) {
            if (!this.path2asset.has(path)
                && this.infoManager.map[path].uuid
                && !this.infoManager.map[path].missing) {
                try {
                    const uuid = this.infoManager.map[path].uuid;
                    if (getAsset(uuid)) {
                        continue;
                    }
                    const dir = `${this.options.library}${path_1.sep}${uuid.substr(0, 2)}`;
                    if ((0, fs_extra_1.existsSync)(dir)) {
                        const list = await (0, fs_extra_1.readdir)(dir);
                        for (let name of list) {
                            if (name.startsWith(uuid)) {
                                await (0, fs_extra_1.remove)((0, path_1.join)(dir, name));
                            }
                        }
                    }
                    this.infoManager.map[path].missing = true;
                    infoDirty = true;
                }
                catch (error) {
                    console.warn(error);
                }
            }
        }
        infoDirty && this.infoManager.save();
        // await this.taskManager.waitQueue();
        // return num;
        return new Promise((resolve) => {
            const step = () => {
                setTimeout(() => {
                    if (!this.taskManager.busy()) {
                        this.flag.starting = false;
                        return resolve(num);
                    }
                    this.taskManager.waitQueue().then(() => {
                        step();
                    });
                }, 10);
            };
            step();
        });
    }
    /**
     * 停止资源数据库
     */
    async stop() {
        this.uuid2asset.clear();
        this.path2asset.clear();
        this.flag.started = false;
        this.metaManager.saveImmediate();
        this.infoManager.saveImmediate();
        this.dependencyManager.saveImmediate();
        this.dataManaer.saveImmediate();
        this.metaManager.destroy();
        this.infoManager.destroy();
        this.dependencyManager.destroy();
        if (manager_1.map[this.options.name] === this) {
            delete manager_1.map[this.options.name];
        }
    }
    /**
     * 传入 path，返回 asset-db 内对应的 uuid
     * 不存在则返回 null
     * @param path
     */
    pathToUuid(path) {
        let asset = this.path2asset.get(path);
        if (!asset) {
            return null;
        }
        return asset.uuid;
    }
    /**
     * 传入 uuid，返回对应的资源的 path
     * @param uuid
     */
    uuidToPath(uuid) {
        let asset = this.uuid2asset.get(uuid);
        if (!asset) {
            return null;
        }
        return asset.source;
    }
    /**
     * 查询资源实例
     * @param uuid
     */
    getAsset(uuid) {
        if (!uuid || typeof uuid !== 'string') {
            return null;
        }
        let search = uuid.split('@');
        let id = search.shift() || '';
        let asset = this.uuid2asset.get(id);
        if (!asset) {
            return null;
        }
        for (let i = 0; i < search.length; i++) {
            let idOrName = search[i];
            asset = asset.subAssets[idOrName];
            if (!asset) {
                return null;
            }
        }
        return asset || null;
    }
    /**
     * 重新导入
     * @param fileOrUUID
     */
    async reimport(fileOrUUID) {
        const asset = this.path2asset.get(fileOrUUID) || this.getAsset(fileOrUUID);
        if (!asset) {
            return true;
        }
        // 暂时使用开关控制
        if (this.options.flags && this.options.flags.reimportCheck && !asset._lock && asset.action !== asset_1.AssetActionEnum.none) {
            return true;
        }
        // 需要先锁定，因为如果开始导入，init 还是 false，但资源已经被锁定，所以等待资源锁定状态结束，再开始导入
        await this.lock();
        // 强制重新触发查找 importer 的动作
        if (asset instanceof asset_1.Asset) {
            this.metaManager.read(asset.source + '.meta');
            const oldImporter = asset.meta.importer;
            asset.meta.importer = '*';
            const importer = await this.importerManager.find(asset);
            if (!importer) {
                throw new Error(`Unable to import data, no suitable importer was found.\n  path: ${asset.source}\n  uuid: ${asset.uuid}`);
            }
            else if (oldImporter === importer.name) {
                asset.meta.importer = importer.name;
            }
        }
        try {
            if (!asset.init) {
                this.unlock();
                return false;
            }
            asset.init = false;
            asset.action = asset_1.AssetActionEnum.change;
            asset.task = this.taskManager.addTask(asset);
        }
        catch (error) {
            console.error(error);
        }
        this.unlock();
        await this.taskManager.waitQueue();
    }
    /**
     * 刷新资源
     * 传入某一个文件或者文件夹，进行数据库刷新操作
     * 会优先同步扫描所有资源，然后等待其他 refresh 队列
     * 默认 refresh 是有队列的，多个 refresh 同时执行需要进入队列等待
     * @param path
     * @returns {number} 刷新的资源个数
     */
    async refresh(path, options = {}) {
        // 如果不是绝对路径，不刷新
        if (!(0, utils_1.absolutePath)(path)) {
            return 0;
        }
        path = (0, path_1.normalize)(path);
        // 如果是数据库文件夹，默认就忽略自己
        if (path === this.options.target) {
            options.ignoreSelf = true;
        }
        // 向上递归查询，查询自己的父级文件夹是否存在
        // 如果父文件夹不在 db 里，则自动加入
        let parentDir = (0, path_1.dirname)(path);
        while ((0, utils_1.isSubPath)(parentDir, this.options.target) && !this.path2asset.has(parentDir)) {
            path = parentDir;
            parentDir = (0, path_1.dirname)(parentDir);
        }
        // 检查是不是配置的 root 路径的子目录，如果不是子路径，则返回刷新 0 个资源
        if (!(0, utils_1.isSubPath)(path, this.options.target) && path !== this.options.target) {
            return 0;
        }
        let files;
        try {
            const fileStat = (0, fs_extra_1.statSync)(path);
            if (fileStat.isFile()) {
                files = [path];
            }
            else {
                const globPath = process.platform === 'win32' ? path.replace(/\\/g, '/') : path;
                // ! 要写绝对路径，否则可能在某些 win 机器上无法忽略文件
                const search = options.globList || [
                    `**/*`,
                    `!**/*.meta`,
                ];
                if (this.options.ignoreGlob) {
                    search.push(this.options.ignoreGlob);
                }
                files = fast_glob_1.default.sync(search, {
                    onlyFiles: false,
                    // 如果将 path 传入 search 数组，卢经理带有 () 就无法正确识别了，所以需要使用 cwd
                    cwd: globPath,
                    // dot: true,
                });
                files.forEach((file, index) => {
                    files[index] = (0, path_1.join)(globPath, file);
                });
                // 当扫描的路径不是根目录的时候，把被扫描的路径也检查一次
                if (path !== this.options.target) {
                    files.splice(0, 0, path);
                }
            }
        }
        catch (error) {
            files = [];
        }
        // 文件分组，如果有多个组，会在上一个组导入完成后，才开始下一个组的导入流程
        if (options.hooks && options.hooks.afterScan) {
            try {
                await options.hooks.afterScan(files);
            }
            catch (error) {
                console.error(error);
            }
        }
        // 扫描文件到的文件记录
        const fileSet = new Set();
        const deleteSet = new Set();
        const addSet = new Set();
        try {
            const preAddFiles = [];
            const addFiles = [];
            const deleteFiles = [];
            if (this.preImporterHandler) {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        if (this.preImporterHandler(file)) {
                            preAddFiles.push(file);
                        }
                        else {
                            addFiles.push(file);
                        }
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            else {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        addFiles.push(file);
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            this.path2asset.forEach((asset, file) => {
                if (files.length === 0 || !fileSet.has(file)) {
                    if (file === path || (0, utils_1.isSubPath)(file, path)) {
                        deleteFiles.push(file);
                        deleteSet.add(file);
                    }
                }
            });
            this.taskManager.stop();
            // 判断添加的资源和移动、删除的资源
            this._checkAssetsStatSync(preAddFiles, deleteFiles, deleteSet);
            if (options.hooks && options.hooks.afterPreImport) {
                try {
                    await options.hooks.afterPreImport();
                }
                catch (error) {
                    console.error(error);
                }
            }
            this._checkAssetsStatSync(addFiles, deleteFiles, deleteSet);
            this.emit('refresh-uuid-ready', path);
            // 锁定任务栈
            await this.lock();
            // 没有改动的数据
            const tasks = [];
            for (let file of files) {
                if (!addSet.has(file) && !deleteSet.has(file)) {
                    const asset = this.path2asset.get(file);
                    if (asset) {
                        tasks.push(this._checkAssetStat(asset));
                    }
                }
            }
            await Promise.all(tasks);
        }
        catch (error) {
            console.error(error);
            this.unlock();
            return 0;
        }
        if (options.hooks && options.hooks.afterGenerateMete) {
            try {
                await options.hooks.afterGenerateMete();
            }
            catch (error) {
                console.error(error);
            }
        }
        this.taskManager.start();
        try {
            await this.taskManager.waitQueue();
        }
        catch (error) {
            console.error(error);
        }
        this.unlock();
        // 返回所有文件的个数
        const num = this.taskManager.total();
        this.taskManager.clear();
        if (options.hooks && options.hooks.afterRefresh) {
            try {
                await options.hooks.afterRefresh();
            }
            catch (error) {
                console.error(error);
            }
        }
        return num;
    }
    _replaceUUID(asset, oAsset) {
        if (oAsset !== asset) {
            const newUUID = (0, node_uuid_1.v4)();
            // 提示两个文件 uuid 冲突
            if (this.options.level >= 2) {
                let info = JSON.stringify([
                    asset.source,
                    oAsset.source,
                ], null, 2);
                console.warn(`The uuid is already pointing to another resource.\n${info}\nThe file uuid has been updated: ${asset.source}\n    ${asset.uuid} -> ${newUUID}`);
            }
            asset.meta.uuid = newUUID;
        }
    }
    /**
     * 检查资源状态
     * 识别是新增、修改还是删除了资源
     * @param addFiles
     * @param deleteFiles
     */
    _checkAssetsStatSync(addFiles, deleteFiles, deleteSet) {
        for (let file of deleteFiles) {
            // 毋庸置疑的删除文件
            const asset = this.path2asset.get(file);
            if (asset) {
                asset.action = asset_1.AssetActionEnum.delete;
                asset.task = this.taskManager.addTask(asset);
                this.uuid2asset.delete(asset.uuid);
                this.path2asset.delete(asset.source);
                const metaFile = asset.source + '.meta';
                this.metaManager.remove(metaFile);
                this.infoManager.remove(asset.source);
                this.infoManager.remove(metaFile);
            }
        }
        for (let file of addFiles) {
            // 获取 meta，没有的话直接生成
            const metaFile = file + '.meta';
            const metaInfo = this.metaManager.get(metaFile);
            const uuidCacheAsset = getAsset(metaInfo.json.uuid);
            // uuid 指向的文件被删除了，就是移动文件
            if (uuidCacheAsset) {
                if (deleteSet.has(uuidCacheAsset.source) ||
                    (uuidCacheAsset.source !== file &&
                        !(0, fs_extra_1.existsSync)(uuidCacheAsset.source))) {
                    const asset = uuidCacheAsset;
                    this.path2asset.delete(asset.source);
                    this.infoManager.remove(asset.source);
                    this.metaManager.remove(asset.source + '.meta');
                    this.infoManager.remove(asset.source + '.meta');
                    asset._source = file;
                    asset.extname = (0, path_1.extname)(file).toLowerCase();
                    asset.basename = (0, path_1.basename)(file, asset.extname);
                    asset.updateUrl();
                    asset.meta = metaInfo.json;
                    this.path2asset.set(asset.source, asset);
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
                // uuid 指向的文件没删除，识别为新建，但是 uuid 冲突了
                else {
                    const asset = new asset_1.Asset(file, metaInfo.json, this);
                    this._replaceUUID(asset, uuidCacheAsset);
                    asset.save();
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
            // 启动数据库，还原以前的资源
            else if (this.flag.starting) {
                const fileStat = (0, fs_extra_1.statSync)(file);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                    const metaStat = (0, fs_extra_1.statSync)(metaFile);
                    if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                        if (this.dataManaer.has(asset)) {
                            asset.action = asset_1.AssetActionEnum.none;
                            asset.task = this.taskManager.addTask(asset);
                        }
                        else {
                            asset.action = asset_1.AssetActionEnum.change;
                            asset.task = this.taskManager.addTask(asset);
                        }
                    }
                    else {
                        // meta 被修改，就识别为先删后新增
                        this.emit('delete', asset);
                        this.emit('deleted', asset);
                        asset.action = asset_1.AssetActionEnum.add;
                        const uuid = asset.uuid;
                        this.metaManager.read(metaFile);
                        if (asset.uuid !== uuid) {
                            this.uuid2asset.delete(uuid);
                            if (this.uuid2asset.has(asset.uuid)) {
                                this._replaceUUID(asset, getAsset(asset.uuid));
                            }
                            this.uuid2asset.set(asset.uuid, asset);
                        }
                        this.infoManager.add(metaFile, metaStat.mtimeMs);
                        asset.task = this.taskManager.addTask(asset);
                    }
                }
                else {
                    asset.action = asset_1.AssetActionEnum.add;
                    this.infoManager.add(file, fileStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                }
                this.uuid2asset.set(asset.uuid, asset);
                this.path2asset.set(asset.source, asset);
            }
            // 普通新增
            else {
                const oAsset = getAsset(metaInfo.json.uuid);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (oAsset) {
                    this._replaceUUID(asset, oAsset);
                    asset.save();
                }
                const metaStat = (0, fs_extra_1.statSync)(metaFile);
                // 如果 metaFile 的缓存不存在，则添加进缓存
                if (!this.infoManager.get(metaFile)
                    || (this.infoManager.get(file)
                        && this.infoManager.get(file).missing)) {
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                }
                // 如果 metaFile 的缓存不一致，则判断为被修改
                if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
                else {
                    // 这种情况下，meta 被修改，都识别为先删除后新增
                    this.emit('delete', asset);
                    this.emit('deleted', asset);
                    asset.action = asset_1.AssetActionEnum.add;
                    const uuid = asset.uuid;
                    this.metaManager.read(metaFile);
                    if (asset.uuid !== uuid) {
                        this.uuid2asset.delete(uuid);
                    }
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
        }
    }
    async _checkAssetStat(asset) {
        const file = asset.source;
        const metaFile = file + '.meta';
        const metaStat = await (0, fs_extra_1.stat)(metaFile);
        if (!await this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
            this.emit('delete', asset);
            this.emit('deleted', asset);
            asset.action = asset_1.AssetActionEnum.add;
            const uuid = asset.uuid;
            this.metaManager.read(metaFile);
            if (asset.uuid !== uuid) {
                this.uuid2asset.delete(uuid);
                if (this.uuid2asset.has(asset.uuid)) {
                    this._replaceUUID(asset, getAsset(asset.uuid));
                }
                this.uuid2asset.set(asset.uuid, asset);
            }
            this.infoManager.add(metaFile, metaStat.mtimeMs);
            asset.task = this.taskManager.addTask(asset);
        }
        else {
            const fileStat = await (0, fs_extra_1.stat)(file);
            if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                if (this.dataManaer.has(asset)) {
                    asset.action = asset_1.AssetActionEnum.none;
                    asset.task = this.taskManager.addTask(asset);
                }
                else {
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
            }
            else {
                // 更新 mtime 记录
                this.infoManager.add(file, fileStat.mtimeMs, asset.uuid);
                asset.action = asset_1.AssetActionEnum.change;
                asset.task = this.taskManager.addTask(asset);
            }
        }
    }
}
exports.AssetDB = AssetDB;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9hc3NldC1kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsWUFBWSxDQUFDOzs7Ozs7QUFFYix1Q0FBOEU7QUFDOUUsK0JBQXdFO0FBQ3hFLG1DQUFzQztBQUN0Qyx5Q0FBK0I7QUFFL0IseUNBQThEO0FBQzlELG1DQUErRDtBQUMvRCxtQ0FBa0U7QUFDbEUsaUNBQXFDO0FBQ3JDLGlDQUFxQztBQUNyQyxpQ0FBa0M7QUFDbEMsNkNBQWlEO0FBQ2pELGlDQUFxQztBQUNyQyx1Q0FBd0Q7QUFFeEQsbURBQStDO0FBQy9DLDBEQUEyQjtBQUUzQixxQ0FBZ0M7QUFBdkIsOEZBQUEsR0FBRyxPQUFBO0FBRVosU0FBUyxRQUFRLENBQUMsSUFBSTtJQUNsQixLQUFLLElBQUksSUFBSSxJQUFJLGFBQUcsRUFBRTtRQUNsQixNQUFNLEVBQUUsR0FBRyxhQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckIsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEMsSUFBSSxLQUFLLEVBQUU7WUFDUCxPQUFPLEtBQUssQ0FBQztTQUNoQjtLQUNKO0lBQ0QsT0FBTyxTQUFTLENBQUM7QUFDckIsQ0FBQztBQXFEWSxRQUFBLE9BQU8sR0FBRyxPQUFPLENBQUM7QUFFL0IsTUFBYSxPQUFRLFNBQVEscUJBQVk7SUFzRXJDOzs7T0FHRztJQUNILFlBQVksT0FBdUI7UUFDL0IsS0FBSyxFQUFFLENBQUM7UUF0RVosS0FBSztRQUNMLFNBQUksR0FBRztZQUNILFNBQVM7WUFDVCxRQUFRLEVBQUUsS0FBSztZQUNmLFlBQVk7WUFDWixPQUFPLEVBQUUsS0FBSztTQUNqQixDQUFDO1FBRUYsc0JBQXNCO1FBQ3RCLGVBQVUsR0FBdUIsSUFBSSxHQUFHLENBQUM7UUFFekMsc0JBQXNCO1FBQ3RCLGVBQVUsR0FB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RDthQUFNO1lBQ0gsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLGVBQUksRUFBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ2xELElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQzVCLEtBQUssQ0FBQyxNQUFNLEdBQUcsdUJBQWUsQ0FBQyxJQUFJLENBQUM7b0JBQ3BDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2hEO3FCQUFNO29CQUNILEtBQUssQ0FBQyxNQUFNLEdBQUcsdUJBQWUsQ0FBQyxNQUFNLENBQUM7b0JBQ3RDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2hEO2FBQ0o7aUJBQU07Z0JBQ0gsY0FBYztnQkFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pELEtBQUssQ0FBQyxNQUFNLEdBQUcsdUJBQWUsQ0FBQyxNQUFNLENBQUM7Z0JBQ3RDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDaEQ7U0FDSjtJQUNMLENBQUM7Q0FDSjtBQTd3QkQsMEJBNndCQyIsInNvdXJjZXNDb250ZW50IjpbIlxuJ3VzZSBzdGlyY3QnO1xuXG5pbXBvcnQgeyBTdGF0cywgc3RhdCwgc3RhdFN5bmMsIGV4aXN0c1N5bmMsIHJlYWRkaXIsIHJlbW92ZSB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IGpvaW4sIG5vcm1hbGl6ZSwgZGlybmFtZSwgc2VwLCBiYXNlbmFtZSwgZXh0bmFtZSB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IHY0IH0gZnJvbSAnbm9kZS11dWlkJztcblxuaW1wb3J0IHsgSW1wb3J0ZXJNYW5hZ2VyLCBEZWZhdWx0SW1wb3J0ZXIgfSBmcm9tICcuL2ltcG9ydGVyJztcbmltcG9ydCB7IEFzc2V0LCBWaXJ0dWFsQXNzZXQsIEFzc2V0QWN0aW9uRW51bSB9IGZyb20gJy4vYXNzZXQnO1xuaW1wb3J0IHsgYWJzb2x1dGVQYXRoLCBpc1N1YlBhdGgsIGNvbXBhcmVWZXJzaW9uIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBNZXRhTWFuYWdlciB9IGZyb20gJy4vbWV0YSc7XG5pbXBvcnQgeyBJbmZvTWFuYWdlciB9IGZyb20gJy4vaW5mbyc7XG5pbXBvcnQgeyBUQVNLX01BUCB9IGZyb20gJy4vdGFzayc7XG5pbXBvcnQgeyBEZXBlbmRlbmN5TWFuYWdlciB9IGZyb20gJy4vZGVwZW5kZW5jeSc7XG5pbXBvcnQgeyBEYXRhTWFuYWdlciB9IGZyb20gJy4vZGF0YSc7XG5pbXBvcnQgeyBpbXBvcnRBc3NvY2lhdGVkQXNzZXRzLCBtYXAgfSBmcm9tICcuL21hbmFnZXInO1xuXG5pbXBvcnQgeyBQYXJhbGxlbFF1ZXVlIH0gZnJvbSAnd29ya2Zsb3ctZXh0cmEnO1xuaW1wb3J0IGZnIGZyb20gJ2Zhc3QtZ2xvYic7XG5cbmV4cG9ydCB7IG1hcCB9IGZyb20gJy4vbWFuYWdlcic7XG5cbmZ1bmN0aW9uIGdldEFzc2V0KHV1aWQpIHtcbiAgICBmb3IgKGxldCBuYW1lIGluIG1hcCkge1xuICAgICAgICBjb25zdCBkYiA9IG1hcFtuYW1lXTtcbiAgICAgICAgY29uc3QgYXNzZXQgPSBkYi51dWlkMmFzc2V0LmdldCh1dWlkKTtcbiAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gYXNzZXQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBc3NldERCUmVmcmVzaE9wdGlvbnMge1xuICAgIC8vIOaYr+WQpuW/veeVpeiHquW3se+8jOm7mOiupCBmYWxzZVxuICAgIGlnbm9yZVNlbGY/OiBib29sZWFuO1xuICAgIGdsb2JMaXN0Pzogc3RyaW5nW107XG4gICAgLy8g5omr5o+P5oiQ5Yqf5ZCO562J5b6F5a6M5oiQ5LiA5Lqb5pON5L2cXG4gICAgaG9va3M/OiB7XG4gICAgICAgIC8vIOeUn+aIkCDotYTmupAgbWV0YSDkuYvlkI5cbiAgICAgICAgYWZ0ZXJHZW5lcmF0ZU1ldGU/KCk6IHZvaWQ7XG4gICAgICAgIC8vIOaJq+aPj+i1hOa6kOS5i+WQjlxuICAgICAgICBhZnRlclNjYW4/KGZpbGVzOiBzdHJpbmdbXSk6IHZvaWQ7XG4gICAgICAgIGFmdGVyUHJlSW1wb3J0PygpOiB2b2lkO1xuICAgICAgICBhZnRlclJlZnJlc2g/KCk6IHZvaWQ7XG4gICAgfTtcbn1cblxuLyoqXG4gKiDotYTmupDmlbDmja7lupPlkK/liqjlj4LmlbBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBc3NldERCT3B0aW9ucyB7XG4gICAgLy8g6LWE5rqQ5pWw5o2u5bqT55qE5ZCN5a2XXG4gICAgbmFtZTogc3RyaW5nO1xuICAgIC8vIOi1hOa6kOaVsOaNruW6k+WcqOehrOebmOS4iueahOe7neWvuei3r+W+hFxuICAgIHRhcmdldDogc3RyaW5nO1xuICAgIC8vIOi1hOa6kOaVsOaNruW6k+WvvOWFpeWQjueUn+aIkOeahOaWh+S7tui3r+W+hFxuICAgIGxpYnJhcnk6IHN0cmluZztcbiAgICAvLyDotYTmupDmlbDmja7lupPnmoTkuLTml7bnm67lvZVcbiAgICB0ZW1wOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiAwOiDlv73nlaXplJnor69cbiAgICAgKiAxOiDku4Xku4XmiZPljbDplJnor69cbiAgICAgKiAyOiDmiZPljbDplJnor6/jgIHorablkYpcbiAgICAgKiAzOiDmiZPljbDplJnor6/jgIHorablkYrjgIHml6Xlv5dcbiAgICAgKiA0OiDmiZPljbDplJnor6/jgIHorablkYrjgIHml6Xlv5fjgIHosIPor5Xkv6Hmga9cbiAgICAgKi9cbiAgICBsZXZlbDogbnVtYmVyO1xuXG4gICAgLy8g5b+955Wl55qE5paH5Lu25YiX6KGoXG4gICAgaWdub3JlRmlsZXM6IHN0cmluZ1tdLFxuXG4gICAgLy8g5b+955Wl5a+85YWl55qEIGdsb2Ig6KGo6L6+5byPXG4gICAgaWdub3JlR2xvYj86IHN0cmluZztcblxuICAgIC8vIOaYr+WQpuWPquivu++8jOm7mOiupOaYryBmYWxzZVxuICAgIHJlYWRvbmx5OiBib29sZWFuO1xuXG4gICAgZmxhZ3M/OiB7XG4gICAgICAgIHJlaW1wb3J0Q2hlY2s/OiBib29sZWFuO1xuICAgIH0sXG59XG5cbmV4cG9ydCBjb25zdCB2ZXJzaW9uID0gJzIuMC4wJztcblxuZXhwb3J0IGNsYXNzIEFzc2V0REIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuXG4gICAgLy8g5Lyg5YWl55qE6YWN572u5L+h5oGvXG4gICAgb3B0aW9uczogQXNzZXREQk9wdGlvbnM7XG5cbiAgICAvLyDmoIforrBcbiAgICBmbGFnID0ge1xuICAgICAgICAvLyDmmK/lkKbmraPlnKjlkK/liqhcbiAgICAgICAgc3RhcnRpbmc6IGZhbHNlLFxuICAgICAgICAvLyDmmK/lkKblt7Lnu4/lkK/liqjnmoTmoIforrBcbiAgICAgICAgc3RhcnRlZDogZmFsc2UsXG4gICAgfTtcblxuICAgIC8vIHBhdGgg5a+55bqUIGFzc2V0IOeahCBtYXBcbiAgICBwYXRoMmFzc2V0OiBNYXA8c3RyaW5nLCBBc3NldD4gPSBuZXcgTWFwO1xuXG4gICAgLy8gdXVpZCDlr7nlupQgYXNzZXQg55qEIG1hcFxuICAgIHV1aWQyYXNzZXQ6IE1hcDxzdHJpbmcsIEFzc2V0PiA9IG5ldyBNYXA7XG5cbiAgICAvLyBpbXBvcnRlciDnrqHnkIblmahcbiAgICBpbXBvcnRlck1hbmFnZXIgPSBuZXcgSW1wb3J0ZXJNYW5hZ2VyKHRoaXMpO1xuXG4gICAgbWV0YU1hbmFnZXI6IE1ldGFNYW5hZ2VyO1xuICAgIGluZm9NYW5hZ2VyOiBJbmZvTWFuYWdlcjtcbiAgICBkZXBlbmRlbmN5TWFuYWdlcjogRGVwZW5kZW5jeU1hbmFnZXI7XG4gICAgdGFza01hbmFnZXI6IFBhcmFsbGVsUXVldWU8VmlydHVhbEFzc2V0LCBib29sZWFuPjtcbiAgICBkYXRhTWFuYWVyOiBEYXRhTWFuYWdlcjtcblxuICAgIF9sb2NrOiBib29sZWFuID0gZmFsc2U7XG4gICAgX3dhaXRMb2NrSGFuZGxlcjogRnVuY3Rpb25bXSA9W107XG5cbiAgICBnZXQgYXNzZXRQcm9ncmVzc0luZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE8gdGFza01hbmFnZXIg5piv5ZCm5Y+v5Lul5o+Q5L6b5q2k5a2X5q61XG4gICAgICAgICAgICBjdXJyZW50OiB0aGlzLnRhc2tNYW5hZ2VyLl9leGVjSUQgLSB0aGlzLnRhc2tNYW5hZ2VyLl9leGVjVGhyZWFkLFxuICAgICAgICAgICAgdG90YWw6IHRoaXMudGFza01hbmFnZXIudG90YWwoKSxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgVE9ETyB0YXNrTWFuYWdlciDmmK/lkKblj6/ku6Xmj5DkvpvmraTlrZfmrrVcbiAgICAgICAgICAgIHdhaXQ6IHRoaXMudGFza01hbmFnZXIuX3dhaXRRdWV1ZS5zaXplLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6ZSB5a6a6LWE5rqQXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBsb2NrKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2xvY2spIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2NrID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fd2FpdExvY2tIYW5kbGVyLnB1c2goKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6Kej6ZSB6LWE5rqQXG4gICAgICovXG4gICAgcHJpdmF0ZSB1bmxvY2soKSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9IHRoaXMuX3dhaXRMb2NrSGFuZGxlci5zaGlmdCgpO1xuICAgICAgICAvLyDlpoLmnpzmnInnrYnlvoXnmoTku7vliqHvvIzliJnmiafooYzkuIvkuIDkuKpcbiAgICAgICAgaWYgKGhhbmRsZSkge1xuICAgICAgICAgICAgaGFuZGxlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlt7Lnu4/msqHmnInlnKjnrYnlvoXnmoTku7vliqHkuobvvIzov5jljp/moIforrBcbiAgICAgICAgdGhpcy5fbG9jayA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWunuS+i+WMlui/h+eoi1xuICAgICAqIEBwYXJhbSBvcHRpb25zIFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEFzc2V0REJPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIGlmICghb3B0aW9ucy50YXJnZXQgfHwgIW9wdGlvbnMubGlicmFyeSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgVGhlIGRhdGFiYXNlIGNhbm5vdCBiZSBjcmVhdGVkIGJlY2F1c2UgdGhlcmUgaXMgbm8gdGFyZ2V0IG9yIGxpYnJhcnkgZGVmaW5pdGlvbmApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3B0aW9ucy50YXJnZXQgPSBhYnNvbHV0ZVBhdGgob3B0aW9ucy50YXJnZXQpO1xuICAgICAgICAgICAgb3B0aW9ucy5saWJyYXJ5ID0gYWJzb2x1dGVQYXRoKG9wdGlvbnMubGlicmFyeSk7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMudGVtcCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGpvaW4ob3B0aW9ucy5saWJyYXJ5LCAnLnRlbXAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGFic29sdXRlUGF0aChvcHRpb25zLnRlbXApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g6K6+572u6L6T5Ye6562J57qnXG4gICAgICAgIGlmICghKCdsZXZlbCcgaW4gb3B0aW9ucykgfHwgb3B0aW9ucy5sZXZlbCA+IDQgfHwgb3B0aW9ucy5sZXZlbCA8IDApIHtcbiAgICAgICAgICAgIG9wdGlvbnMubGV2ZWwgPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmlnbm9yZUZpbGVzIHx8ICFBcnJheS5pc0FycmF5KG9wdGlvbnMuaWdub3JlRmlsZXMpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmlnbm9yZUZpbGVzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgICAgIC8vIOWQr+WKqOaVsOaNruW6k+WGhee9rueahOWQhOS4queuoeeQhuWZqOeuoeeQhuWZqFxuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyID0gbmV3IFBhcmFsbGVsUXVldWUoYXN5bmMgKGFzc2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbXBvcnRlciA9IGF3YWl0IHRoaXMuaW1wb3J0ZXJNYW5hZ2VyLmZpbmQoYXNzZXQpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICFpbXBvcnRlciB8fFxuICAgICAgICAgICAgICAgIC8vIOWIoOmZpOeahOaXtuWAmeW+iOWPr+iDveaWh+S7tuS4jeWtmOWcqO+8jOaJgOS7pSBpbXBvcnRlciDmnInkuIDlrprmpoLnjofmmK8gKu+8jOi/meaXtuWAmeWSjOWOn+acieeahOWvvOWFpeWZqOiCr+WumuS4jeWMuemFje+8jOaJgOS7peS4jemcgOimgeWkhOeQhuWIoOmZpFxuICAgICAgICAgICAgICAgICggICBhc3NldC5hY3Rpb24gIT09IEFzc2V0QWN0aW9uRW51bS5kZWxldGUgJiZcbiAgICAgICAgICAgICAgICAgICAgKGltcG9ydGVyLm5hbWUgIT09IGFzc2V0Lm1ldGEuaW1wb3J0ZXIgJiYgYXNzZXQubWV0YS5pbXBvcnRlciAhPT0gJyonKSAmJlxuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbXBvcnRlZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGlmICghYXNzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVuYWJsZSB0byBpbXBvcnQgZGF0YSwgbm8gc3VpdGFibGUgaW1wb3J0ZXIgd2FzIGZvdW5kLiB7YXNzZXRbJHthc3NldCBpbnN0YW5jZW9mIEFzc2V0ID8gYXNzZXQuYmFzZW5hbWUgOiAnJ31dKCR7YXNzZXQudXVpZH0pfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmludmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2goYXNzZXQuYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBBc3NldEFjdGlvbkVudW0uYWRkOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFlci5lbXB0eShhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUQVNLX01BUC5pbXBvcnQuZXhlYyh0aGlzLCBhc3NldCwgaW1wb3J0ZXIsIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQgaW5zdGFuY2VvZiBBc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzZXRTdGF0cyA9IHN0YXRTeW5jKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChhc3NldC5zb3VyY2UsIGFzc2V0U3RhdHMubXRpbWVNcywgYXNzZXQudXVpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0QXNzb2NpYXRlZEFzc2V0cyh0aGlzLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZW1pdCgnYWRkZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhTWFuYWVyLmVtcHR5KGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgVEFTS19NQVAuZGVzdHJveS5leGVjKHRoaXMsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRBU0tfTUFQLmltcG9ydC5leGVjKHRoaXMsIGFzc2V0LCBpbXBvcnRlciwgdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzc2V0LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldCBpbnN0YW5jZW9mIEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NldFN0YXRzID0gc3RhdFN5bmMoYXNzZXQuc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKGFzc2V0LnNvdXJjZSwgYXNzZXRTdGF0cy5tdGltZU1zLCBhc3NldC51dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbXBvcnRBc3NvY2lhdGVkQXNzZXRzKHRoaXMsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5lbWl0KCdjaGFuZ2VkJywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBBc3NldEFjdGlvbkVudW0uZGVsZXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFlci5lbXB0eShhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IFRBU0tfTUFQLmRlc3Ryb3kuZXhlYyh0aGlzLCBhc3NldCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gYXNzZXQuc291cmNlICsgJy5tZXRhJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVtb3ZlKG1ldGFGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0QXNzb2NpYXRlZEFzc2V0cyh0aGlzLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZW1pdCgnZGVsZXRlZCcsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgQXNzZXRBY3Rpb25FbnVtLm5vbmU6IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRBU0tfTUFQLmltcG9ydC5leGVjKHRoaXMsIGFzc2V0LCBpbXBvcnRlciwgZmFsc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuaW5pdCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoYXNzZXQuYWN0aW9uICE9PSBBc3NldEFjdGlvbkVudW0ubm9uZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFlci5zYXZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0ubm9uZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LCA1KTtcblxuICAgICAgICAvLyDlhajlsYDlj6/nlKjnmoTns7vnu5/nm7jlhbPnmoTnrqHnkIblmahcbiAgICAgICAgdGhpcy5tZXRhTWFuYWdlciA9IG5ldyBNZXRhTWFuYWdlcigpO1xuICAgICAgICB0aGlzLmluZm9NYW5hZ2VyID0gbmV3IEluZm9NYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeU1hbmFnZXIgPSBuZXcgRGVwZW5kZW5jeU1hbmFnZXIoKTtcbiAgICAgICAgdGhpcy5kYXRhTWFuYWVyID0gbmV3IERhdGFNYW5hZ2VyKCk7XG5cbiAgICAgICAgLy8g5rOo5YaM6buY6K6k55qE6Kej5p6Q5ZmoXG4gICAgICAgIHRoaXMuaW1wb3J0ZXJNYW5hZ2VyLmFkZChEZWZhdWx0SW1wb3J0ZXIsIFsnKiddKTtcbiAgICB9XG5cbiAgICBwcmVJbXBvcnRlckhhbmRsZXI/KGZpbGU6IHN0cmluZyk6IGJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiDlkK/liqjotYTmupDmlbDmja7lupNcbiAgICAgKi9cbiAgICBhc3luYyBzdGFydChvcHRpb25zOiBBc3NldERCUmVmcmVzaE9wdGlvbnMgPSB7fSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy50YXJnZXQgfHwgIXRoaXMub3B0aW9ucy5saWJyYXJ5IHx8ICF0aGlzLm9wdGlvbnMudGVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sZXZlbCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgUGFyYW1ldGVyIGVycm9yLCB1bmFibGUgdG8gc3RhcnQuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5mbGFnLnN0YXJ0ZWQgJiYgdGhpcy5vcHRpb25zLmxldmVsID49IDIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlICR7dGhpcy5vcHRpb25zLm5hbWV9IGRhdGFiYXNlIGlzIGFscmVhZHkgc3RhcnRlZC5gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmxhZy5zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5mbGFnLnN0YXJ0aW5nID0gdHJ1ZTtcblxuICAgICAgICBhd2FpdCB0aGlzLm1ldGFNYW5hZ2VyLnNldEJhY2t1cFBhdGgoam9pbih0aGlzLm9wdGlvbnMudGVtcCwgJ21ldGEnKSk7XG4gICAgICAgIGF3YWl0IHRoaXMubWV0YU1hbmFnZXIuc2V0UmVjb3JkSlNPTihqb2luKHRoaXMub3B0aW9ucy5saWJyYXJ5LCBgLiR7dGhpcy5vcHRpb25zLm5hbWV9LW1ldGEuanNvbmApKTtcbiAgICAgICAgYXdhaXQgdGhpcy5pbmZvTWFuYWdlci5zZXRSZWNvcmRKU09OKGpvaW4odGhpcy5vcHRpb25zLmxpYnJhcnksIGAuJHt0aGlzLm9wdGlvbnMubmFtZX0taW5mby5qc29uYCkpO1xuICAgICAgICBhd2FpdCB0aGlzLmRhdGFNYW5hZXIuc2V0UmVjb3JkSlNPTihqb2luKHRoaXMub3B0aW9ucy5saWJyYXJ5LCBgLiR7dGhpcy5vcHRpb25zLm5hbWV9LWRhdGEuanNvbmApKTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZXBlbmRlbmN5TWFuYWdlci5zZXRSZWNvcmRKU09OKGpvaW4odGhpcy5vcHRpb25zLmxpYnJhcnksIGAuJHt0aGlzLm9wdGlvbnMubmFtZX0tZGVwZW5kZW5jeS5qc29uYCkpO1xuXG4gICAgICAgIC8vIOimgeWcqOi1hOa6kOWIt+aWsOWJjeWKoOWFpee8k+WtmFxuICAgICAgICBtYXBbdGhpcy5vcHRpb25zLm5hbWVdID0gdGhpcztcblxuICAgICAgICAvLyDliLfmlrDotYTmupDmlbDmja7lupPlhoXnmoTotYTmupDliJfooahcbiAgICAgICAgbGV0IG51bSA9IGF3YWl0IHRoaXMucmVmcmVzaCh0aGlzLm9wdGlvbnMudGFyZ2V0LCB7XG4gICAgICAgICAgICBpZ25vcmVTZWxmOiB0cnVlLFxuICAgICAgICAgICAgaG9va3M6IG9wdGlvbnMuaG9va3MsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBpbmZvRGlydHkgPSBmYWxzZTtcbiAgICAgICAgLy8g5Yig6Zmk5bey57uP5LiN5a2Y5Zyo55qE6LWE5rqQXG4gICAgICAgIC8vIG10aW1lIOiusOW9leeahOmDveaYr+S5i+WJjeWtmOWcqOeahOaWh+S7tu+8jOaJgOS7peW+queOryBtdGltZSDnrqHnkIblmajph4znmoTmlbDmja7ov5vooYzmoKHpqoxcbiAgICAgICAgZm9yIChsZXQgcGF0aCBpbiB0aGlzLmluZm9NYW5hZ2VyLm1hcCkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICF0aGlzLnBhdGgyYXNzZXQuaGFzKHBhdGgpXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5pbmZvTWFuYWdlci5tYXBbcGF0aF0udXVpZFxuICAgICAgICAgICAgICAgICYmICF0aGlzLmluZm9NYW5hZ2VyLm1hcFtwYXRoXS5taXNzaW5nXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1dWlkID0gdGhpcy5pbmZvTWFuYWdlci5tYXBbcGF0aF0udXVpZCBhcyBzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnZXRBc3NldCh1dWlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gYCR7dGhpcy5vcHRpb25zLmxpYnJhcnl9JHtzZXB9JHt1dWlkLnN1YnN0cigwLCAyKX1gO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaXN0ID0gYXdhaXQgcmVhZGRpcihkaXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbmFtZSBvZiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aCh1dWlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZW1vdmUoam9pbihkaXIsIG5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5tYXBbcGF0aF0ubWlzc2luZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGluZm9EaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpbmZvRGlydHkgJiYgdGhpcy5pbmZvTWFuYWdlci5zYXZlKCk7XG4gICAgICAgIC8vIGF3YWl0IHRoaXMudGFza01hbmFnZXIud2FpdFF1ZXVlKCk7XG4gICAgICAgIC8vIHJldHVybiBudW07XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGVwID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudGFza01hbmFnZXIuYnVzeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYWcuc3RhcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKG51bSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrTWFuYWdlci53YWl0UXVldWUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHN0ZXAoKTtcbiAgICAgICAgfSk7XG4gICAgfSBcblxuICAgIC8qKlxuICAgICAqIOWBnOatoui1hOa6kOaVsOaNruW6k1xuICAgICAqL1xuICAgIGFzeW5jIHN0b3AoKSB7XG4gICAgICAgIHRoaXMudXVpZDJhc3NldC5jbGVhcigpO1xuICAgICAgICB0aGlzLnBhdGgyYXNzZXQuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5mbGFnLnN0YXJ0ZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnNhdmVJbW1lZGlhdGUoKTtcbiAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5zYXZlSW1tZWRpYXRlKCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeU1hbmFnZXIuc2F2ZUltbWVkaWF0ZSgpO1xuICAgICAgICB0aGlzLmRhdGFNYW5hZXIuc2F2ZUltbWVkaWF0ZSgpO1xuXG4gICAgICAgIHRoaXMubWV0YU1hbmFnZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5kZXBlbmRlbmN5TWFuYWdlci5kZXN0cm95KCk7XG5cbiAgICAgICAgaWYgKG1hcFt0aGlzLm9wdGlvbnMubmFtZV0gPT09IHRoaXMpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBtYXBbdGhpcy5vcHRpb25zLm5hbWVdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Lyg5YWlIHBhdGjvvIzov5Tlm54gYXNzZXQtZGIg5YaF5a+55bqU55qEIHV1aWRcbiAgICAgKiDkuI3lrZjlnKjliJnov5Tlm54gbnVsbFxuICAgICAqIEBwYXJhbSBwYXRoIFxuICAgICAqL1xuICAgIHBhdGhUb1V1aWQocGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBhc3NldCA9IHRoaXMucGF0aDJhc3NldC5nZXQocGF0aCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhc3NldC51dWlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOS8oOWFpSB1dWlk77yM6L+U5Zue5a+55bqU55qE6LWE5rqQ55qEIHBhdGhcbiAgICAgKiBAcGFyYW0gdXVpZCBcbiAgICAgKi9cbiAgICB1dWlkVG9QYXRoKHV1aWQ6IHN0cmluZykge1xuICAgICAgICBsZXQgYXNzZXQgPSB0aGlzLnV1aWQyYXNzZXQuZ2V0KHV1aWQpO1xuICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhc3NldC5zb3VyY2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5p+l6K+i6LWE5rqQ5a6e5L6LXG4gICAgICogQHBhcmFtIHV1aWRcbiAgICAgKi9cbiAgICBnZXRBc3NldCh1dWlkOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCF1dWlkIHx8IHR5cGVvZiB1dWlkICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNlYXJjaCA9IHV1aWQuc3BsaXQoJ0AnKTtcbiAgICAgICAgbGV0IGlkID0gc2VhcmNoLnNoaWZ0KCkgfHwgJyc7XG5cbiAgICAgICAgbGV0IGFzc2V0OiBWaXJ0dWFsQXNzZXQgfCBBc3NldCB8IHVuZGVmaW5lZCA9IHRoaXMudXVpZDJhc3NldC5nZXQoaWQpO1xuICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpPTA7IGk8c2VhcmNoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaWRPck5hbWUgPSBzZWFyY2hbaV07XG4gICAgICAgICAgICBhc3NldCA9IGFzc2V0LnN1YkFzc2V0c1tpZE9yTmFtZV07XG4gICAgICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFzc2V0IHx8IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6YeN5paw5a+85YWlXG4gICAgICogQHBhcmFtIGZpbGVPclVVSUQgXG4gICAgICovXG4gICAgYXN5bmMgcmVpbXBvcnQoZmlsZU9yVVVJRDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGFzc2V0OiBBc3NldCB8IFZpcnR1YWxBc3NldCB8IG51bGwgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KGZpbGVPclVVSUQpIHx8IHRoaXMuZ2V0QXNzZXQoZmlsZU9yVVVJRCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5pqC5pe25L2/55So5byA5YWz5o6n5Yi2XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmxhZ3MgJiYgdGhpcy5vcHRpb25zLmZsYWdzLnJlaW1wb3J0Q2hlY2sgJiYgIWFzc2V0Ll9sb2NrICYmIGFzc2V0LmFjdGlvbiAhPT0gQXNzZXRBY3Rpb25FbnVtLm5vbmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g6ZyA6KaB5YWI6ZSB5a6a77yM5Zug5Li65aaC5p6c5byA5aeL5a+85YWl77yMaW5pdCDov5jmmK8gZmFsc2XvvIzkvYbotYTmupDlt7Lnu4/ooqvplIHlrprvvIzmiYDku6XnrYnlvoXotYTmupDplIHlrprnirbmgIHnu5PmnZ/vvIzlho3lvIDlp4vlr7zlhaVcbiAgICAgICAgYXdhaXQgdGhpcy5sb2NrKCk7XG5cbiAgICAgICAgLy8g5by65Yi26YeN5paw6Kem5Y+R5p+l5om+IGltcG9ydGVyIOeahOWKqOS9nFxuICAgICAgICBpZiAoYXNzZXQgaW5zdGFuY2VvZiBBc3NldCkge1xuICAgICAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5yZWFkKGFzc2V0LnNvdXJjZSArICcubWV0YScpO1xuICAgICAgICAgICAgY29uc3Qgb2xkSW1wb3J0ZXIgPSBhc3NldC5tZXRhLmltcG9ydGVyO1xuICAgICAgICAgICAgYXNzZXQubWV0YS5pbXBvcnRlciA9ICcqJztcbiAgICAgICAgICAgIGNvbnN0IGltcG9ydGVyID0gYXdhaXQgdGhpcy5pbXBvcnRlck1hbmFnZXIuZmluZChhc3NldCk7XG4gICAgICAgICAgICBpZiAoIWltcG9ydGVyKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gaW1wb3J0IGRhdGEsIG5vIHN1aXRhYmxlIGltcG9ydGVyIHdhcyBmb3VuZC5cXG4gIHBhdGg6ICR7YXNzZXQuc291cmNlfVxcbiAgdXVpZDogJHthc3NldC51dWlkfWApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvbGRJbXBvcnRlciA9PT0gaW1wb3J0ZXIubmFtZSkge1xuICAgICAgICAgICAgICAgIGFzc2V0Lm1ldGEuaW1wb3J0ZXIgPSBpbXBvcnRlci5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghYXNzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5sb2NrKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuaW5pdCA9IGZhbHNlO1xuICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmNoYW5nZTtcbiAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICB9IGNhdGNoKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVubG9jaygpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMudGFza01hbmFnZXIud2FpdFF1ZXVlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yi35paw6LWE5rqQXG4gICAgICog5Lyg5YWl5p+Q5LiA5Liq5paH5Lu25oiW6ICF5paH5Lu25aS577yM6L+b6KGM5pWw5o2u5bqT5Yi35paw5pON5L2cXG4gICAgICog5Lya5LyY5YWI5ZCM5q2l5omr5o+P5omA5pyJ6LWE5rqQ77yM54S25ZCO562J5b6F5YW25LuWIHJlZnJlc2gg6Zif5YiXXG4gICAgICog6buY6K6kIHJlZnJlc2gg5piv5pyJ6Zif5YiX55qE77yM5aSa5LiqIHJlZnJlc2gg5ZCM5pe25omn6KGM6ZyA6KaB6L+b5YWl6Zif5YiX562J5b6FXG4gICAgICogQHBhcmFtIHBhdGggXG4gICAgICogQHJldHVybnMge251bWJlcn0g5Yi35paw55qE6LWE5rqQ5Liq5pWwXG4gICAgICovXG4gICAgYXN5bmMgcmVmcmVzaChwYXRoOiBzdHJpbmcsIG9wdGlvbnM6IEFzc2V0REJSZWZyZXNoT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgLy8g5aaC5p6c5LiN5piv57ud5a+56Lev5b6E77yM5LiN5Yi35pawXG4gICAgICAgIGlmICghYWJzb2x1dGVQYXRoKHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpO1xuXG4gICAgICAgIC8vIOWmguaenOaYr+aVsOaNruW6k+aWh+S7tuWkue+8jOm7mOiupOWwseW/veeVpeiHquW3sVxuICAgICAgICBpZiAocGF0aCA9PT0gdGhpcy5vcHRpb25zLnRhcmdldCkge1xuICAgICAgICAgICAgb3B0aW9ucy5pZ25vcmVTZWxmID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWQkeS4iumAkuW9kuafpeivou+8jOafpeivouiHquW3seeahOeItue6p+aWh+S7tuWkueaYr+WQpuWtmOWcqFxuICAgICAgICAvLyDlpoLmnpzniLbmlofku7blpLnkuI3lnKggZGIg6YeM77yM5YiZ6Ieq5Yqo5Yqg5YWlXG4gICAgICAgIGxldCBwYXJlbnREaXIgPSBkaXJuYW1lKHBhdGgpO1xuICAgICAgICB3aGlsZSAoaXNTdWJQYXRoKHBhcmVudERpciwgdGhpcy5vcHRpb25zLnRhcmdldCkgJiYgIXRoaXMucGF0aDJhc3NldC5oYXMocGFyZW50RGlyKSkge1xuICAgICAgICAgICAgcGF0aCA9IHBhcmVudERpcjtcbiAgICAgICAgICAgIHBhcmVudERpciA9IGRpcm5hbWUocGFyZW50RGlyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOajgOafpeaYr+S4jeaYr+mFjee9rueahCByb290IOi3r+W+hOeahOWtkOebruW9le+8jOWmguaenOS4jeaYr+WtkOi3r+W+hO+8jOWImei/lOWbnuWIt+aWsCAwIOS4qui1hOa6kFxuICAgICAgICBpZiAoIWlzU3ViUGF0aChwYXRoLCB0aGlzLm9wdGlvbnMudGFyZ2V0KSAmJiBwYXRoICE9PSB0aGlzLm9wdGlvbnMudGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmaWxlcztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVTdGF0ID0gc3RhdFN5bmMocGF0aCk7XG4gICAgICAgICAgICBpZiAoZmlsZVN0YXQuaXNGaWxlKCkpIHtcbiAgICAgICAgICAgICAgICBmaWxlcyA9IFtwYXRoXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2xvYlBhdGggPSBwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInID8gcGF0aC5yZXBsYWNlKC9cXFxcL2csICcvJykgOiBwYXRoO1xuICAgICAgICAgICAgICAgIC8vICEg6KaB5YaZ57ud5a+56Lev5b6E77yM5ZCm5YiZ5Y+v6IO95Zyo5p+Q5LqbIHdpbiDmnLrlmajkuIrml6Dms5Xlv73nlaXmlofku7ZcbiAgICAgICAgICAgICAgICBjb25zdCBzZWFyY2ggPSBvcHRpb25zLmdsb2JMaXN0IHx8IFtcbiAgICAgICAgICAgICAgICAgICAgYCoqLypgLFxuICAgICAgICAgICAgICAgICAgICBgISoqLyoubWV0YWAsXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUdsb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoLnB1c2godGhpcy5vcHRpb25zLmlnbm9yZUdsb2IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWxlcyA9IGZnLnN5bmMoc2VhcmNoLCB7XG4gICAgICAgICAgICAgICAgICAgIG9ubHlGaWxlczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOWwhiBwYXRoIOS8oOWFpSBzZWFyY2gg5pWw57uE77yM5Y2i57uP55CG5bim5pyJICgpIOWwseaXoOazleato+ehruivhuWIq+S6hu+8jOaJgOS7pemcgOimgeS9v+eUqCBjd2RcbiAgICAgICAgICAgICAgICAgICAgY3dkOiBnbG9iUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgLy8gZG90OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZmlsZXMuZm9yRWFjaCgoZmlsZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNbaW5kZXhdID0gam9pbihnbG9iUGF0aCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyDlvZPmiavmj4/nmoTot6/lvoTkuI3mmK/moLnnm67lvZXnmoTml7blgJnvvIzmiorooqvmiavmj4/nmoTot6/lvoTkuZ/mo4Dmn6XkuIDmrKFcbiAgICAgICAgICAgICAgICBpZiAocGF0aCAhPT0gdGhpcy5vcHRpb25zLnRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlcy5zcGxpY2UoMCwgMCwgcGF0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoKGVycm9yKSB7XG4gICAgICAgICAgICBmaWxlcyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5paH5Lu25YiG57uE77yM5aaC5p6c5pyJ5aSa5Liq57uE77yM5Lya5Zyo5LiK5LiA5Liq57uE5a+85YWl5a6M5oiQ5ZCO77yM5omN5byA5aeL5LiL5LiA5Liq57uE55qE5a+85YWl5rWB56iLXG4gICAgICAgIGlmIChvcHRpb25zLmhvb2tzICYmIG9wdGlvbnMuaG9va3MuYWZ0ZXJTY2FuKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJTY2FuKGZpbGVzKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOaJq+aPj+aWh+S7tuWIsOeahOaWh+S7tuiusOW9lVxuICAgICAgICBjb25zdCBmaWxlU2V0OiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcbiAgICAgICAgY29uc3QgZGVsZXRlU2V0OiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcbiAgICAgICAgY29uc3QgYWRkU2V0OiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcHJlQWRkRmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBjb25zdCBhZGRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGRlbGV0ZUZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJlSW1wb3J0ZXJIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGF0aDJhc3NldC5oYXMoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZUltcG9ydGVySGFuZGxlcihmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUFkZEZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRTZXQuYWRkKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpbGVTZXQuYWRkKGZpbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGF0aDJhc3NldC5oYXMoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRTZXQuYWRkKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpbGVTZXQuYWRkKGZpbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LmZvckVhY2goKGFzc2V0LCBmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMCB8fCAhZmlsZVNldC5oYXMoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgPT09IHBhdGggfHwgaXNTdWJQYXRoKGZpbGUsIHBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlU2V0LmFkZChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLnN0b3AoKTtcblxuICAgICAgICAgICAgLy8g5Yik5pat5re75Yqg55qE6LWE5rqQ5ZKM56e75Yqo44CB5Yig6Zmk55qE6LWE5rqQXG4gICAgICAgICAgICB0aGlzLl9jaGVja0Fzc2V0c1N0YXRTeW5jKHByZUFkZEZpbGVzLCBkZWxldGVGaWxlcywgZGVsZXRlU2V0KTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmhvb2tzICYmIG9wdGlvbnMuaG9va3MuYWZ0ZXJQcmVJbXBvcnQpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcHRpb25zLmhvb2tzLmFmdGVyUHJlSW1wb3J0KCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jaGVja0Fzc2V0c1N0YXRTeW5jKGFkZEZpbGVzLCBkZWxldGVGaWxlcywgZGVsZXRlU2V0KTtcblxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWZyZXNoLXV1aWQtcmVhZHknLCBwYXRoKTtcblxuICAgICAgICAgICAgLy8g6ZSB5a6a5Lu75Yqh5qCIXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmxvY2soKTtcblxuICAgICAgICAgICAgLy8g5rKh5pyJ5pS55Yqo55qE5pWw5o2uXG4gICAgICAgICAgICBjb25zdCB0YXNrczogUHJvbWlzZTxhbnk+W10gPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFkZFNldC5oYXMoZmlsZSkgJiYgIWRlbGV0ZVNldC5oYXMoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tzLnB1c2godGhpcy5fY2hlY2tBc3NldFN0YXQoYXNzZXQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHRhc2tzKTtcbiAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB0aGlzLnVubG9jaygpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5ob29rcyAmJiBvcHRpb25zLmhvb2tzLmFmdGVyR2VuZXJhdGVNZXRlKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJHZW5lcmF0ZU1ldGUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFza01hbmFnZXIuc3RhcnQoKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy50YXNrTWFuYWdlci53YWl0UXVldWUoKTtcbiAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnVubG9jaygpO1xuXG4gICAgICAgIC8vIOi/lOWbnuaJgOacieaWh+S7tueahOS4quaVsFxuICAgICAgICBjb25zdCBudW0gPSB0aGlzLnRhc2tNYW5hZ2VyLnRvdGFsKCk7XG4gICAgICAgIHRoaXMudGFza01hbmFnZXIuY2xlYXIoKTtcblxuICAgICAgICBpZiAob3B0aW9ucy5ob29rcyAmJiBvcHRpb25zLmhvb2tzLmFmdGVyUmVmcmVzaCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBvcHRpb25zLmhvb2tzLmFmdGVyUmVmcmVzaCgpO1xuICAgICAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZXBsYWNlVVVJRChhc3NldDogQXNzZXQsIG9Bc3NldDogQXNzZXQpIHtcbiAgICAgICAgaWYgKG9Bc3NldCAhPT0gYXNzZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1VVSUQgPSB2NCgpO1xuICAgICAgICAgICAgLy8g5o+Q56S65Lik5Liq5paH5Lu2IHV1aWQg5Yay56qBXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDIpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IEpTT04uc3RyaW5naWZ5KFtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuc291cmNlLFxuICAgICAgICAgICAgICAgICAgICBvQXNzZXQuc291cmNlLFxuICAgICAgICAgICAgICAgIF0sIG51bGwsIDIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlIHV1aWQgaXMgYWxyZWFkeSBwb2ludGluZyB0byBhbm90aGVyIHJlc291cmNlLlxcbiR7aW5mb31cXG5UaGUgZmlsZSB1dWlkIGhhcyBiZWVuIHVwZGF0ZWQ6ICR7YXNzZXQuc291cmNlfVxcbiAgICAke2Fzc2V0LnV1aWR9IC0+ICR7bmV3VVVJRH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0Lm1ldGEudXVpZCA9IG5ld1VVSUQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmo4Dmn6XotYTmupDnirbmgIFcbiAgICAgKiDor4bliKvmmK/mlrDlop7jgIHkv67mlLnov5jmmK/liKDpmaTkuobotYTmupBcbiAgICAgKiBAcGFyYW0gYWRkRmlsZXNcbiAgICAgKiBAcGFyYW0gZGVsZXRlRmlsZXNcbiAgICAgKi9cbiAgICBwcml2YXRlIF9jaGVja0Fzc2V0c1N0YXRTeW5jKGFkZEZpbGVzOiBzdHJpbmdbXSwgZGVsZXRlRmlsZXM6IHN0cmluZ1tdLCBkZWxldGVTZXQ6IFNldDxzdHJpbmc+KSB7XG4gICAgICAgIGZvciAobGV0IGZpbGUgb2YgZGVsZXRlRmlsZXMpIHtcbiAgICAgICAgICAgIC8vIOavi+W6uOe9rueWkeeahOWIoOmZpOaWh+S7tlxuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmRlbGV0ZTtcbiAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5kZWxldGUoYXNzZXQuc291cmNlKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gYXNzZXQuc291cmNlICsgJy5tZXRhJztcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5yZW1vdmUoYXNzZXQuc291cmNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBhZGRGaWxlcykge1xuICAgICAgICAgICAgLy8g6I635Y+WIG1ldGHvvIzmsqHmnInnmoTor53nm7TmjqXnlJ/miJBcbiAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gZmlsZSArICcubWV0YSc7XG4gICAgICAgICAgICBjb25zdCBtZXRhSW5mbyA9IHRoaXMubWV0YU1hbmFnZXIuZ2V0KG1ldGFGaWxlKTtcbiAgICAgICAgICAgIGNvbnN0IHV1aWRDYWNoZUFzc2V0ID0gZ2V0QXNzZXQobWV0YUluZm8uanNvbi51dWlkKTtcbiAgICAgICAgICAgIC8vIHV1aWQg5oyH5ZCR55qE5paH5Lu26KKr5Yig6Zmk5LqG77yM5bCx5piv56e75Yqo5paH5Lu2XG4gICAgICAgICAgICBpZiAodXVpZENhY2hlQXNzZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZVNldC5oYXModXVpZENhY2hlQXNzZXQuc291cmNlKSB8fFxuICAgICAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkQ2FjaGVBc3NldC5zb3VyY2UgIT09IGZpbGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFleGlzdHNTeW5jKHV1aWRDYWNoZUFzc2V0LnNvdXJjZSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IHV1aWRDYWNoZUFzc2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuZGVsZXRlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSArICcubWV0YScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShhc3NldC5zb3VyY2UgKyAnLm1ldGEnKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuX3NvdXJjZSA9IGZpbGU7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmV4dG5hbWUgPSBleHRuYW1lKGZpbGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmJhc2VuYW1lID0gYmFzZW5hbWUoZmlsZSwgYXNzZXQuZXh0bmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnVwZGF0ZVVybCgpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5tZXRhID0gbWV0YUluZm8uanNvbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmNoYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHV1aWQg5oyH5ZCR55qE5paH5Lu25rKh5Yig6Zmk77yM6K+G5Yir5Li65paw5bu677yM5L2G5pivIHV1aWQg5Yay56qB5LqGXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gbmV3IEFzc2V0KGZpbGUsIG1ldGFJbmZvLmpzb24sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXBsYWNlVVVJRChhc3NldCwgdXVpZENhY2hlQXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlkK/liqjmlbDmja7lupPvvIzov5jljp/ku6XliY3nmoTotYTmupBcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmxhZy5zdGFydGluZyl7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZVN0YXQgPSBzdGF0U3luYyhmaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IG5ldyBBc3NldChmaWxlLCBtZXRhSW5mby5qc29uLCB0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZm9NYW5hZ2VyLmNvbXBhcmUoZmlsZSwgZmlsZVN0YXQubXRpbWVNcykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWV0YVN0YXQgPSBzdGF0U3luYyhtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZm9NYW5hZ2VyLmNvbXBhcmUobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhTWFuYWVyLmhhcyhhc3NldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0ubm9uZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmNoYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ldGEg6KKr5L+u5pS577yM5bCx6K+G5Yir5Li65YWI5Yig5ZCO5paw5aKeXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZScsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZGVsZXRlZCcsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1dWlkID0gYXNzZXQudXVpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVhZChtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQudXVpZCAhPT0gdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5kZWxldGUodXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudXVpZDJhc3NldC5oYXMoYXNzZXQudXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVwbGFjZVVVSUQoYXNzZXQsIGdldEFzc2V0KGFzc2V0LnV1aWQpISlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LnNldChhc3NldC51dWlkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKGZpbGUsIGZpbGVTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LnNldChhc3NldC51dWlkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5pmu6YCa5paw5aKeXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvQXNzZXQgPSBnZXRBc3NldChtZXRhSW5mby5qc29uLnV1aWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gbmV3IEFzc2V0KGZpbGUsIG1ldGFJbmZvLmpzb24sIHRoaXMpO1xuICAgICAgICAgICAgICAgIGlmIChvQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVwbGFjZVVVSUQoYXNzZXQsIG9Bc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnNhdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgbWV0YVN0YXQgPSBzdGF0U3luYyhtZXRhRmlsZSk7XG5cbiAgICAgICAgICAgICAgICAvLyDlpoLmnpwgbWV0YUZpbGUg55qE57yT5a2Y5LiN5a2Y5Zyo77yM5YiZ5re75Yqg6L+b57yT5a2YXG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAhdGhpcy5pbmZvTWFuYWdlci5nZXQobWV0YUZpbGUpXG4gICAgICAgICAgICAgICAgICAgIHx8IChcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuZ2V0KGZpbGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiB0aGlzLmluZm9NYW5hZ2VyLmdldChmaWxlKS5taXNzaW5nXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWmguaenCBtZXRhRmlsZSDnmoTnvJPlrZjkuI3kuIDoh7TvvIzliJnliKTmlq3kuLrooqvkv67mlLlcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKSkge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LnNldChhc3NldC51dWlkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5zZXQoYXNzZXQuc291cmNlLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8g6L+Z56eN5oOF5Ya15LiL77yMbWV0YSDooqvkv67mlLnvvIzpg73or4bliKvkuLrlhYjliKDpmaTlkI7mlrDlop5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGUnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZGVsZXRlZCcsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmFkZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IGFzc2V0LnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVhZChtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldC51dWlkICE9PSB1dWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGFzeW5jIF9jaGVja0Fzc2V0U3RhdChhc3NldDogQXNzZXQpIHtcblxuICAgICAgICBjb25zdCBmaWxlID0gYXNzZXQuc291cmNlO1xuICAgICAgICBjb25zdCBtZXRhRmlsZSA9IGZpbGUgKyAnLm1ldGEnO1xuICAgICAgICBjb25zdCBtZXRhU3RhdCA9IGF3YWl0IHN0YXQobWV0YUZpbGUpO1xuXG4gICAgICAgIGlmICghYXdhaXQgdGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKSkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGUnLCBhc3NldCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgY29uc3QgdXVpZCA9IGFzc2V0LnV1aWQ7XG4gICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0LnV1aWQgIT09IHV1aWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKHV1aWQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnV1aWQyYXNzZXQuaGFzKGFzc2V0LnV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBnZXRBc3NldChhc3NldC51dWlkKSEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlU3RhdCA9IGF3YWl0IHN0YXQoZmlsZSk7XG4gICAgICAgICAgICBpZiAodGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKGZpbGUsIGZpbGVTdGF0Lm10aW1lTXMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YU1hbmFlci5oYXMoYXNzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5ub25lO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uY2hhbmdlO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIOabtOaWsCBtdGltZSDorrDlvZVcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChmaWxlLCBmaWxlU3RhdC5tdGltZU1zLCBhc3NldC51dWlkKTtcbiAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uY2hhbmdlO1xuICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19