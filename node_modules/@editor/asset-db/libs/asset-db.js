"use strict";
'use stirct';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssetDB = exports.version = exports.map = void 0;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const events_1 = require("events");
const node_uuid_1 = require("node-uuid");
const importer_1 = require("./importer");
const asset_1 = require("./asset");
const utils_1 = require("./utils");
const meta_1 = require("./meta");
const info_1 = require("./info");
const task_1 = require("./task");
const dependency_1 = require("./dependency");
const data_1 = require("./data");
const manager_1 = require("./manager");
const workflow_extra_1 = require("workflow-extra");
const fast_glob_1 = __importDefault(require("fast-glob"));
var manager_2 = require("./manager");
Object.defineProperty(exports, "map", { enumerable: true, get: function () { return manager_2.map; } });
function getAsset(uuid) {
    for (let name in manager_1.map) {
        const db = manager_1.map[name];
        const asset = db.uuid2asset.get(uuid);
        if (asset) {
            return asset;
        }
    }
    return undefined;
}
exports.version = '2.0.0';
class AssetDB extends events_1.EventEmitter {
    /**
     * 实例化过程
     * @param options
     */
    constructor(options) {
        super();
        // 标记
        this.flag = {
            // 是否正在启动
            starting: false,
            // 是否已经启动的标记
            started: false,
        };
        // path 对应 asset 的 map
        this.path2asset = new Map;
        // uuid 对应 asset 的 map
        this.uuid2asset = new Map;
        // importer 管理器
        this.importerManager = new importer_1.ImporterManager(this);
        this._lock = false;
        this._waitLockHandler = [];
        if (!options.target || !options.library) {
            console.error(`The database cannot be created because there is no target or library definition`);
        }
        else {
            options.target = (0, utils_1.absolutePath)(options.target);
            options.library = (0, utils_1.absolutePath)(options.library);
            if (!options.temp) {
                options.temp = (0, path_1.join)(options.library, '.temp');
            }
            options.temp = (0, utils_1.absolutePath)(options.temp);
        }
        // 设置输出等级
        if (!('level' in options) || options.level > 4 || options.level < 0) {
            options.level = 4;
        }
        if (!options.ignoreFiles || !Array.isArray(options.ignoreFiles)) {
            options.ignoreFiles = [];
        }
        this.options = options;
        // 启动数据库内置的各个管理器管理器
        this.taskManager = new workflow_extra_1.ParallelQueue(async (asset) => {
            const importer = await this.importerManager.find(asset);
            if (!importer ||
                // 删除的时候很可能文件不存在，所以 importer 有一定概率是 *，这时候和原有的导入器肯定不匹配，所以不需要处理删除
                (asset.action !== asset_1.AssetActionEnum.delete &&
                    (importer.name !== asset.meta.importer && asset.meta.importer !== '*') &&
                    asset.imported)) {
                if (!asset.init) {
                    if (this.options.level >= 1) {
                        console.error(`Unable to import data, no suitable importer was found. {asset[${asset instanceof asset_1.Asset ? asset.basename : ''}](${asset.uuid})}`);
                    }
                    asset.invalid = true;
                    asset.init = true;
                }
                return false;
            }
            switch (asset.action) {
                case asset_1.AssetActionEnum.add: {
                    this.dataManaer.empty(asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('added', asset);
                    break;
                }
                case asset_1.AssetActionEnum.change: {
                    this.dataManaer.empty(asset);
                    // await TASK_MAP.destroy.exec(this, asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('changed', asset);
                    break;
                }
                case asset_1.AssetActionEnum.delete: {
                    this.dataManaer.empty(asset);
                    await task_1.TASK_MAP.destroy.exec(this, asset);
                    if (asset instanceof asset_1.Asset) {
                        const metaFile = asset.source + '.meta';
                        this.metaManager.remove(metaFile);
                        this.infoManager.remove(asset.source);
                        this.infoManager.remove(metaFile);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('deleted', asset);
                    break;
                }
                case asset_1.AssetActionEnum.none: {
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, false)) {
                        await asset.save();
                    }
                    break;
                }
            }
            asset.init = true;
            if (asset.action !== asset_1.AssetActionEnum.none) {
                this.dataManaer.save();
            }
            asset.action = asset_1.AssetActionEnum.none;
            return true;
        }, 5);
        // 全局可用的系统相关的管理器
        this.metaManager = new meta_1.MetaManager();
        this.infoManager = new info_1.InfoManager();
        this.dependencyManager = new dependency_1.DependencyManager();
        this.dataManaer = new data_1.DataManager();
        // 注册默认的解析器
        this.importerManager.add(importer_1.DefaultImporter, ['*']);
    }
    get assetProgressInfo() {
        return {
            // @ts-ignore TODO taskManager 是否可以提供此字段
            current: this.taskManager._execID - this.taskManager._execThread,
            total: this.taskManager.total(),
            // @ts-ignore TODO taskManager 是否可以提供此字段
            wait: this.taskManager._waitQueue.size,
        };
    }
    /**
     * 锁定资源
     */
    async lock() {
        if (!this._lock) {
            return this._lock = true;
        }
        return await new Promise((resolve, reject) => {
            this._waitLockHandler.push(() => {
                resolve(null);
            });
        });
    }
    /**
     * 解锁资源
     */
    unlock() {
        const handle = this._waitLockHandler.shift();
        // 如果有等待的任务，则执行下一个
        if (handle) {
            handle();
            return;
        }
        // 已经没有在等待的任务了，还原标记
        this._lock = false;
    }
    /**
     * 启动资源数据库
     */
    async start(options = {}) {
        if (!this.options.target || !this.options.library || !this.options.temp) {
            if (this.options.level >= 1) {
                console.error(`Parameter error, unable to start.`);
            }
            return;
        }
        if (this.flag.started && this.options.level >= 2) {
            console.warn(`The ${this.options.name} database is already started.`);
            return;
        }
        this.flag.started = true;
        this.flag.starting = true;
        await this.metaManager.setBackupPath((0, path_1.join)(this.options.temp, 'meta'));
        await this.metaManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-meta.json`));
        await this.infoManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-info.json`));
        await this.dataManaer.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-data.json`));
        await this.dependencyManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-dependency.json`));
        // 要在资源刷新前加入缓存
        manager_1.map[this.options.name] = this;
        // 刷新资源数据库内的资源列表
        let num = await this.refresh(this.options.target, {
            ignoreSelf: true,
            hooks: options.hooks,
        });
        console.debug(`start asset-db with asset: ${num}`);
        let infoDirty = false;
        // 删除已经不存在的资源
        // mtime 记录的都是之前存在的文件，所以循环 mtime 管理器里的数据进行校验
        for (let path in this.infoManager.map) {
            if (!this.path2asset.has(path)
                && this.infoManager.map[path].uuid
                && !this.infoManager.map[path].missing) {
                try {
                    const uuid = this.infoManager.map[path].uuid;
                    if (getAsset(uuid)) {
                        continue;
                    }
                    const dir = `${this.options.library}${path_1.sep}${uuid.substr(0, 2)}`;
                    if ((0, fs_extra_1.existsSync)(dir)) {
                        const list = await (0, fs_extra_1.readdir)(dir);
                        for (let name of list) {
                            if (name.startsWith(uuid)) {
                                await (0, fs_extra_1.remove)((0, path_1.join)(dir, name));
                            }
                        }
                    }
                    this.infoManager.map[path].missing = true;
                    infoDirty = true;
                }
                catch (error) {
                    console.warn(error);
                }
            }
        }
        infoDirty && this.infoManager.save();
        // await this.taskManager.waitQueue();
        // return num;
        return new Promise((resolve) => {
            const step = () => {
                setTimeout(async () => {
                    if (!this.taskManager.busy()) {
                        this.flag.starting = false;
                        if (options.hooks && options.hooks.afterStart) {
                            try {
                                await options.hooks.afterStart();
                            }
                            catch (error) {
                                console.error(error);
                            }
                        }
                        return resolve(num);
                    }
                    this.taskManager.waitQueue().then(() => {
                        step();
                    });
                }, 10);
            };
            step();
        });
    }
    /**
     * 停止资源数据库
     */
    async stop() {
        this.uuid2asset.clear();
        this.path2asset.clear();
        this.flag.started = false;
        this.metaManager.saveImmediate();
        this.infoManager.saveImmediate();
        this.dependencyManager.saveImmediate();
        this.dataManaer.saveImmediate();
        this.metaManager.destroy();
        this.infoManager.destroy();
        this.dependencyManager.destroy();
        if (manager_1.map[this.options.name] === this) {
            delete manager_1.map[this.options.name];
        }
    }
    /**
     * 传入 path，返回 asset-db 内对应的 uuid
     * 不存在则返回 null
     * @param path
     */
    pathToUuid(path) {
        let asset = this.path2asset.get(path);
        if (!asset) {
            return null;
        }
        return asset.uuid;
    }
    /**
     * 传入 uuid，返回对应的资源的 path
     * @param uuid
     */
    uuidToPath(uuid) {
        let asset = this.uuid2asset.get(uuid);
        if (!asset) {
            return null;
        }
        return asset.source;
    }
    /**
     * 查询资源实例
     * @param uuid
     */
    getAsset(uuid) {
        if (!uuid || typeof uuid !== 'string') {
            return null;
        }
        let search = uuid.split('@');
        let id = search.shift() || '';
        let asset = this.uuid2asset.get(id);
        if (!asset) {
            return null;
        }
        for (let i = 0; i < search.length; i++) {
            let idOrName = search[i];
            asset = asset.subAssets[idOrName];
            if (!asset) {
                return null;
            }
        }
        return asset || null;
    }
    /**
     * 重新导入
     * @param fileOrUUID
     */
    async reimport(fileOrUUID) {
        const asset = this.path2asset.get(fileOrUUID) || this.getAsset(fileOrUUID);
        if (!asset) {
            return true;
        }
        // 暂时使用开关控制
        if (this.options.flags && this.options.flags.reimportCheck && !asset._lock && asset.action !== asset_1.AssetActionEnum.none) {
            return true;
        }
        // 需要先锁定，因为如果开始导入，init 还是 false，但资源已经被锁定，所以等待资源锁定状态结束，再开始导入
        await this.lock();
        // 强制重新触发查找 importer 的动作
        if (asset instanceof asset_1.Asset) {
            this.metaManager.read(asset.source + '.meta');
            const oldImporter = asset.meta.importer;
            asset.meta.importer = '*';
            const importer = await this.importerManager.find(asset);
            if (!importer) {
                throw new Error(`Unable to import data, no suitable importer was found.\n  path: ${asset.source}\n  uuid: ${asset.uuid}`);
            }
            else if (oldImporter === importer.name) {
                asset.meta.importer = importer.name;
            }
        }
        try {
            if (!asset.init) {
                this.unlock();
                return false;
            }
            asset.init = false;
            asset.action = asset_1.AssetActionEnum.change;
            asset.task = this.taskManager.addTask(asset);
        }
        catch (error) {
            console.error(error);
        }
        this.unlock();
        await this.taskManager.waitQueue();
    }
    /**
     * 刷新资源
     * 传入某一个文件或者文件夹，进行数据库刷新操作
     * 会优先同步扫描所有资源，然后等待其他 refresh 队列
     * 默认 refresh 是有队列的，多个 refresh 同时执行需要进入队列等待
     * @param path
     * @returns {number} 刷新的资源个数
     */
    async refresh(path, options = {}) {
        // 如果不是绝对路径，不刷新
        if (!(0, utils_1.absolutePath)(path)) {
            return 0;
        }
        path = (0, path_1.normalize)(path);
        // 如果是数据库文件夹，默认就忽略自己
        if (path === this.options.target) {
            options.ignoreSelf = true;
        }
        // 向上递归查询，查询自己的父级文件夹是否存在
        // 如果父文件夹不在 db 里，则自动加入
        let parentDir = (0, path_1.dirname)(path);
        while ((0, utils_1.isSubPath)(parentDir, this.options.target) && !this.path2asset.has(parentDir)) {
            path = parentDir;
            parentDir = (0, path_1.dirname)(parentDir);
        }
        // 检查是不是配置的 root 路径的子目录，如果不是子路径，则返回刷新 0 个资源
        if (!(0, utils_1.isSubPath)(path, this.options.target) && path !== this.options.target) {
            return 0;
        }
        let files;
        try {
            const fileStat = (0, fs_extra_1.statSync)(path);
            if (fileStat.isFile()) {
                files = [path];
            }
            else {
                const globPath = process.platform === 'win32' ? path.replace(/\\/g, '/') : path;
                // ! 要写绝对路径，否则可能在某些 win 机器上无法忽略文件
                const search = options.globList || [
                    `**/*`,
                    `!**/*.meta`,
                ];
                if (this.options.ignoreGlob) {
                    search.push(this.options.ignoreGlob);
                }
                files = fast_glob_1.default.sync(search, {
                    onlyFiles: false,
                    // 如果将 path 传入 search 数组，卢经理带有 () 就无法正确识别了，所以需要使用 cwd
                    cwd: globPath,
                    // dot: true,
                });
                files.forEach((file, index) => {
                    files[index] = (0, path_1.join)(globPath, file);
                });
                // 当扫描的路径不是根目录的时候，把被扫描的路径也检查一次
                if (path !== this.options.target) {
                    files.splice(0, 0, path);
                }
            }
        }
        catch (error) {
            files = [];
        }
        // 文件分组，如果有多个组，会在上一个组导入完成后，才开始下一个组的导入流程
        if (options.hooks && options.hooks.afterScan) {
            try {
                await options.hooks.afterScan(files);
            }
            catch (error) {
                console.error(error);
            }
        }
        // 扫描文件到的文件记录
        const fileSet = new Set();
        const deleteSet = new Set();
        const addSet = new Set();
        try {
            const preAddFiles = [];
            const addFiles = [];
            const deleteFiles = [];
            if (this.preImporterHandler) {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        if (this.preImporterHandler(file)) {
                            preAddFiles.push(file);
                        }
                        else {
                            addFiles.push(file);
                        }
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            else {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        addFiles.push(file);
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            this.path2asset.forEach((asset, file) => {
                if (files.length === 0 || !fileSet.has(file)) {
                    if (file === path || (0, utils_1.isSubPath)(file, path)) {
                        deleteFiles.push(file);
                        deleteSet.add(file);
                    }
                }
            });
            this.taskManager.stop();
            // 判断添加的资源和移动、删除的资源
            this._checkAssetsStatSync(preAddFiles, deleteFiles, deleteSet);
            if (options.hooks && options.hooks.afterPreImport) {
                try {
                    await options.hooks.afterPreImport();
                }
                catch (error) {
                    console.error(error);
                }
            }
            this._checkAssetsStatSync(addFiles, deleteFiles, deleteSet);
            this.emit('refresh-uuid-ready', path);
            // 锁定任务栈
            await this.lock();
            // 没有改动的数据
            const tasks = [];
            for (let file of files) {
                if (!addSet.has(file) && !deleteSet.has(file)) {
                    const asset = this.path2asset.get(file);
                    if (asset) {
                        tasks.push(this._checkAssetStat(asset));
                    }
                }
            }
            await Promise.all(tasks);
        }
        catch (error) {
            console.error(error);
            this.unlock();
            return 0;
        }
        if (options.hooks && options.hooks.afterGenerateMete) {
            try {
                await options.hooks.afterGenerateMete();
            }
            catch (error) {
                console.error(error);
            }
        }
        this.taskManager.start();
        try {
            await this.taskManager.waitQueue();
        }
        catch (error) {
            console.error(error);
        }
        this.unlock();
        // 返回所有文件的个数
        const num = this.taskManager.total();
        this.taskManager.clear();
        if (options.hooks && options.hooks.afterRefresh) {
            try {
                await options.hooks.afterRefresh();
            }
            catch (error) {
                console.error(error);
            }
        }
        return num;
    }
    _replaceUUID(asset, oAsset) {
        if (oAsset !== asset) {
            const newUUID = (0, node_uuid_1.v4)();
            // 提示两个文件 uuid 冲突
            if (this.options.level >= 2) {
                let info = JSON.stringify([
                    asset.source,
                    oAsset.source,
                ], null, 2);
                console.warn(`The uuid is already pointing to another resource.\n${info}\nThe file uuid has been updated: ${asset.source}\n    ${asset.uuid} -> ${newUUID}`);
            }
            asset.meta.uuid = newUUID;
        }
    }
    /**
     * 检查资源状态
     * 识别是新增、修改还是删除了资源
     * @param addFiles
     * @param deleteFiles
     */
    _checkAssetsStatSync(addFiles, deleteFiles, deleteSet) {
        for (let file of deleteFiles) {
            // 毋庸置疑的删除文件
            const asset = this.path2asset.get(file);
            if (asset) {
                asset.action = asset_1.AssetActionEnum.delete;
                asset.task = this.taskManager.addTask(asset);
                this.uuid2asset.delete(asset.uuid);
                this.path2asset.delete(asset.source);
                const metaFile = asset.source + '.meta';
                this.metaManager.remove(metaFile);
                this.infoManager.remove(asset.source);
                this.infoManager.remove(metaFile);
            }
        }
        for (let file of addFiles) {
            // 获取 meta，没有的话直接生成
            const metaFile = file + '.meta';
            const metaInfo = this.metaManager.get(metaFile);
            const uuidCacheAsset = getAsset(metaInfo.json.uuid);
            // uuid 指向的文件被删除了，就是移动文件
            if (uuidCacheAsset) {
                if (deleteSet.has(uuidCacheAsset.source) ||
                    (uuidCacheAsset.source !== file &&
                        !(0, fs_extra_1.existsSync)(uuidCacheAsset.source))) {
                    const asset = uuidCacheAsset;
                    this.path2asset.delete(asset.source);
                    this.infoManager.remove(asset.source);
                    this.metaManager.remove(asset.source + '.meta');
                    this.infoManager.remove(asset.source + '.meta');
                    asset._source = file;
                    asset.extname = (0, path_1.extname)(file).toLowerCase();
                    asset.basename = (0, path_1.basename)(file, asset.extname);
                    asset.updateUrl();
                    asset.meta = metaInfo.json;
                    this.path2asset.set(asset.source, asset);
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
                // uuid 指向的文件没删除，识别为新建，但是 uuid 冲突了
                else {
                    const asset = new asset_1.Asset(file, metaInfo.json, this);
                    this._replaceUUID(asset, uuidCacheAsset);
                    asset.save();
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
            // 启动数据库，还原以前的资源
            else if (this.flag.starting) {
                const fileStat = (0, fs_extra_1.statSync)(file);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                    const metaStat = (0, fs_extra_1.statSync)(metaFile);
                    if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                        if (this.dataManaer.has(asset)) {
                            asset.action = asset_1.AssetActionEnum.none;
                            asset.task = this.taskManager.addTask(asset);
                        }
                        else {
                            asset.action = asset_1.AssetActionEnum.change;
                            asset.task = this.taskManager.addTask(asset);
                        }
                    }
                    else {
                        // meta 被修改，就识别为先删后新增
                        this.emit('delete', asset);
                        this.emit('deleted', asset);
                        asset.action = asset_1.AssetActionEnum.add;
                        const uuid = asset.uuid;
                        this.metaManager.read(metaFile);
                        if (asset.uuid !== uuid) {
                            this.uuid2asset.delete(uuid);
                            if (this.uuid2asset.has(asset.uuid)) {
                                this._replaceUUID(asset, getAsset(asset.uuid));
                            }
                            this.uuid2asset.set(asset.uuid, asset);
                        }
                        this.infoManager.add(metaFile, metaStat.mtimeMs);
                        asset.task = this.taskManager.addTask(asset);
                    }
                }
                else {
                    asset.action = asset_1.AssetActionEnum.add;
                    this.infoManager.add(file, fileStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                }
                this.uuid2asset.set(asset.uuid, asset);
                this.path2asset.set(asset.source, asset);
            }
            // 普通新增
            else {
                const oAsset = getAsset(metaInfo.json.uuid);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (oAsset) {
                    this._replaceUUID(asset, oAsset);
                    asset.save();
                }
                const metaStat = (0, fs_extra_1.statSync)(metaFile);
                // 如果 metaFile 的缓存不存在，则添加进缓存
                if (!this.infoManager.get(metaFile)
                    || (this.infoManager.get(file)
                        && this.infoManager.get(file).missing)) {
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                }
                // 如果 metaFile 的缓存不一致，则判断为被修改
                if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
                else {
                    // 这种情况下，meta 被修改，都识别为先删除后新增
                    this.emit('delete', asset);
                    this.emit('deleted', asset);
                    asset.action = asset_1.AssetActionEnum.add;
                    const uuid = asset.uuid;
                    this.metaManager.read(metaFile);
                    if (asset.uuid !== uuid) {
                        this.uuid2asset.delete(uuid);
                    }
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
        }
    }
    async _checkAssetStat(asset) {
        const file = asset.source;
        const metaFile = file + '.meta';
        const metaStat = await (0, fs_extra_1.stat)(metaFile);
        if (!await this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
            this.emit('delete', asset);
            this.emit('deleted', asset);
            asset.action = asset_1.AssetActionEnum.add;
            const uuid = asset.uuid;
            this.metaManager.read(metaFile);
            if (asset.uuid !== uuid) {
                this.uuid2asset.delete(uuid);
                if (this.uuid2asset.has(asset.uuid)) {
                    this._replaceUUID(asset, getAsset(asset.uuid));
                }
                this.uuid2asset.set(asset.uuid, asset);
            }
            this.infoManager.add(metaFile, metaStat.mtimeMs);
            asset.task = this.taskManager.addTask(asset);
        }
        else {
            const fileStat = await (0, fs_extra_1.stat)(file);
            if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                if (this.dataManaer.has(asset)) {
                    asset.action = asset_1.AssetActionEnum.none;
                    asset.task = this.taskManager.addTask(asset);
                }
                else {
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
            }
            else {
                // 更新 mtime 记录
                this.infoManager.add(file, fileStat.mtimeMs, asset.uuid);
                asset.action = asset_1.AssetActionEnum.change;
                asset.task = this.taskManager.addTask(asset);
            }
        }
    }
}
exports.AssetDB = AssetDB;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9hc3NldC1kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsWUFBWSxDQUFDOzs7Ozs7QUFFYix1Q0FBOEU7QUFDOUUsK0JBQXdFO0FBQ3hFLG1DQUFzQztBQUN0Qyx5Q0FBK0I7QUFFL0IseUNBQThEO0FBQzlELG1DQUErRDtBQUMvRCxtQ0FBa0U7QUFDbEUsaUNBQXFDO0FBQ3JDLGlDQUFxQztBQUNyQyxpQ0FBa0M7QUFDbEMsNkNBQWlEO0FBQ2pELGlDQUFxQztBQUNyQyx1Q0FBd0Q7QUFFeEQsbURBQStDO0FBQy9DLDBEQUEyQjtBQUUzQixxQ0FBZ0M7QUFBdkIsOEZBQUEsR0FBRyxPQUFBO0FBRVosU0FBUyxRQUFRLENBQUMsSUFBSTtJQUNsQixLQUFLLElBQUksSUFBSSxJQUFJLGFBQUcsRUFBRTtRQUNsQixNQUFNLEVBQUUsR0FBRyxhQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckIsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEMsSUFBSSxLQUFLLEVBQUU7WUFDUCxPQUFPLEtBQUssQ0FBQztTQUNoQjtLQUNKO0lBQ0QsT0FBTyxTQUFTLENBQUM7QUFDckIsQ0FBQztBQXNFWSxRQUFBLE9BQU8sR0FBRyxPQUFPLENBQUM7QUFFL0IsTUFBYSxPQUFRLFNBQVEscUJBQVk7SUFzRXJDOzs7T0FHRztJQUNILFlBQVksT0FBdUI7UUFDL0IsS0FBSyxFQUFFLENBQUM7UUF0RVosS0FBSztRQUNMLFNBQUksR0FBRztZQUNILFNBQVM7WUFDVCxRQUFRLEVBQUUsS0FBSztZQUNmLFlBQVk7WUFDWixPQUFPLEVBQUUsS0FBSztTQUNqQixDQUFDO1FBRUYsc0JBQXNCO1FBQ3RCLGVBQVUsR0FBdUIsSUFBSSxHQUFHLENBQUM7UUFFekMsc0JBQXNCO1FBQ3RCLGVBQVUsR0FB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RyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNoRDtTQUNKO0lBQ0wsQ0FBQztDQUNKO0FBcHhCRCwwQkFveEJDIiwic291cmNlc0NvbnRlbnQiOlsiXG4ndXNlIHN0aXJjdCc7XG5cbmltcG9ydCB7IFN0YXRzLCBzdGF0LCBzdGF0U3luYywgZXhpc3RzU3luYywgcmVhZGRpciwgcmVtb3ZlIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IHsgam9pbiwgbm9ybWFsaXplLCBkaXJuYW1lLCBzZXAsIGJhc2VuYW1lLCBleHRuYW1lIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgdjQgfSBmcm9tICdub2RlLXV1aWQnO1xuXG5pbXBvcnQgeyBJbXBvcnRlck1hbmFnZXIsIERlZmF1bHRJbXBvcnRlciB9IGZyb20gJy4vaW1wb3J0ZXInO1xuaW1wb3J0IHsgQXNzZXQsIFZpcnR1YWxBc3NldCwgQXNzZXRBY3Rpb25FbnVtIH0gZnJvbSAnLi9hc3NldCc7XG5pbXBvcnQgeyBhYnNvbHV0ZVBhdGgsIGlzU3ViUGF0aCwgY29tcGFyZVZlcnNpb24gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IE1ldGFNYW5hZ2VyIH0gZnJvbSAnLi9tZXRhJztcbmltcG9ydCB7IEluZm9NYW5hZ2VyIH0gZnJvbSAnLi9pbmZvJztcbmltcG9ydCB7IFRBU0tfTUFQIH0gZnJvbSAnLi90YXNrJztcbmltcG9ydCB7IERlcGVuZGVuY3lNYW5hZ2VyIH0gZnJvbSAnLi9kZXBlbmRlbmN5JztcbmltcG9ydCB7IERhdGFNYW5hZ2VyIH0gZnJvbSAnLi9kYXRhJztcbmltcG9ydCB7IGltcG9ydEFzc29jaWF0ZWRBc3NldHMsIG1hcCB9IGZyb20gJy4vbWFuYWdlcic7XG5cbmltcG9ydCB7IFBhcmFsbGVsUXVldWUgfSBmcm9tICd3b3JrZmxvdy1leHRyYSc7XG5pbXBvcnQgZmcgZnJvbSAnZmFzdC1nbG9iJztcblxuZXhwb3J0IHsgbWFwIH0gZnJvbSAnLi9tYW5hZ2VyJztcblxuZnVuY3Rpb24gZ2V0QXNzZXQodXVpZCkge1xuICAgIGZvciAobGV0IG5hbWUgaW4gbWFwKSB7XG4gICAgICAgIGNvbnN0IGRiID0gbWFwW25hbWVdO1xuICAgICAgICBjb25zdCBhc3NldCA9IGRiLnV1aWQyYXNzZXQuZ2V0KHV1aWQpO1xuICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBhc3NldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2V0REJTdGFydE9wdGlvbnMge1xuICAgIC8vIOaYr+WQpuW/veeVpeiHquW3se+8jOm7mOiupCBmYWxzZVxuICAgIGlnbm9yZVNlbGY/OiBib29sZWFuO1xuICAgIGdsb2JMaXN0Pzogc3RyaW5nW107XG4gICAgLy8g5omr5o+P5oiQ5Yqf5ZCO562J5b6F5a6M5oiQ5LiA5Lqb5pON5L2cXG4gICAgaG9va3M/OiB7XG4gICAgICAgIC8vIOeUn+aIkCDotYTmupAgbWV0YSDkuYvlkI5cbiAgICAgICAgYWZ0ZXJHZW5lcmF0ZU1ldGU/KCk6IHZvaWQ7XG4gICAgICAgIC8vIOaJq+aPj+i1hOa6kOS5i+WQjlxuICAgICAgICBhZnRlclNjYW4/KGZpbGVzOiBzdHJpbmdbXSk6IHZvaWQ7XG4gICAgICAgIGFmdGVyUHJlSW1wb3J0PygpOiB2b2lkO1xuICAgICAgICAvLyDlnKjmlbDmja7lupPlkK/liqjkuYvlkI5cbiAgICAgICAgYWZ0ZXJTdGFydD8oKTogdm9pZDtcbiAgICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2V0REJSZWZyZXNoT3B0aW9ucyB7XG4gICAgLy8g5piv5ZCm5b+955Wl6Ieq5bex77yM6buY6K6kIGZhbHNlXG4gICAgaWdub3JlU2VsZj86IGJvb2xlYW47XG4gICAgZ2xvYkxpc3Q/OiBzdHJpbmdbXTtcbiAgICAvLyDmiavmj4/miJDlip/lkI7nrYnlvoXlrozmiJDkuIDkupvmk43kvZxcbiAgICBob29rcz86IHtcbiAgICAgICAgLy8g55Sf5oiQIOi1hOa6kCBtZXRhIOS5i+WQjlxuICAgICAgICBhZnRlckdlbmVyYXRlTWV0ZT8oKTogdm9pZDtcbiAgICAgICAgLy8g5omr5o+P6LWE5rqQ5LmL5ZCOXG4gICAgICAgIGFmdGVyU2Nhbj8oZmlsZXM6IHN0cmluZ1tdKTogdm9pZDtcbiAgICAgICAgYWZ0ZXJQcmVJbXBvcnQ/KCk6IHZvaWQ7XG4gICAgICAgIC8vIFRPRE8g55Sx5LqOIHJlZnJlc2gg6L+H56iL5Lit5Y+v6IO957un57ut5re75Yqg5paw55qEIHJlZnJlc2gg5Lu75Yqh77yM5Zug6ICM5q2k6ZKp5a2Q5LiN5YeG56GuXG4gICAgICAgIGFmdGVyUmVmcmVzaD8oKTogdm9pZDtcbiAgICB9O1xufVxuXG4vKipcbiAqIOi1hOa6kOaVsOaNruW6k+WQr+WKqOWPguaVsFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFzc2V0REJPcHRpb25zIHtcbiAgICAvLyDotYTmupDmlbDmja7lupPnmoTlkI3lrZdcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgLy8g6LWE5rqQ5pWw5o2u5bqT5Zyo56Gs55uY5LiK55qE57ud5a+56Lev5b6EXG4gICAgdGFyZ2V0OiBzdHJpbmc7XG4gICAgLy8g6LWE5rqQ5pWw5o2u5bqT5a+85YWl5ZCO55Sf5oiQ55qE5paH5Lu26Lev5b6EXG4gICAgbGlicmFyeTogc3RyaW5nO1xuICAgIC8vIOi1hOa6kOaVsOaNruW6k+eahOS4tOaXtuebruW9lVxuICAgIHRlbXA6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIDA6IOW/veeVpemUmeivr1xuICAgICAqIDE6IOS7heS7heaJk+WNsOmUmeivr1xuICAgICAqIDI6IOaJk+WNsOmUmeivr+OAgeitpuWRilxuICAgICAqIDM6IOaJk+WNsOmUmeivr+OAgeitpuWRiuOAgeaXpeW/l1xuICAgICAqIDQ6IOaJk+WNsOmUmeivr+OAgeitpuWRiuOAgeaXpeW/l+OAgeiwg+ivleS/oeaBr1xuICAgICAqL1xuICAgIGxldmVsOiBudW1iZXI7XG5cbiAgICAvLyDlv73nlaXnmoTmlofku7bliJfooahcbiAgICBpZ25vcmVGaWxlczogc3RyaW5nW10sXG5cbiAgICAvLyDlv73nlaXlr7zlhaXnmoQgZ2xvYiDooajovr7lvI9cbiAgICBpZ25vcmVHbG9iPzogc3RyaW5nO1xuXG4gICAgLy8g5piv5ZCm5Y+q6K+777yM6buY6K6k5pivIGZhbHNlXG4gICAgcmVhZG9ubHk6IGJvb2xlYW47XG5cbiAgICBmbGFncz86IHtcbiAgICAgICAgcmVpbXBvcnRDaGVjaz86IGJvb2xlYW47XG4gICAgfSxcbn1cblxuZXhwb3J0IGNvbnN0IHZlcnNpb24gPSAnMi4wLjAnO1xuXG5leHBvcnQgY2xhc3MgQXNzZXREQiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG5cbiAgICAvLyDkvKDlhaXnmoTphY3nva7kv6Hmga9cbiAgICBvcHRpb25zOiBBc3NldERCT3B0aW9ucztcblxuICAgIC8vIOagh+iusFxuICAgIGZsYWcgPSB7XG4gICAgICAgIC8vIOaYr+WQpuato+WcqOWQr+WKqFxuICAgICAgICBzdGFydGluZzogZmFsc2UsXG4gICAgICAgIC8vIOaYr+WQpuW3sue7j+WQr+WKqOeahOagh+iusFxuICAgICAgICBzdGFydGVkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gcGF0aCDlr7nlupQgYXNzZXQg55qEIG1hcFxuICAgIHBhdGgyYXNzZXQ6IE1hcDxzdHJpbmcsIEFzc2V0PiA9IG5ldyBNYXA7XG5cbiAgICAvLyB1dWlkIOWvueW6lCBhc3NldCDnmoQgbWFwXG4gICAgdXVpZDJhc3NldDogTWFwPHN0cmluZywgQXNzZXQ+ID0gbmV3IE1hcDtcblxuICAgIC8vIGltcG9ydGVyIOeuoeeQhuWZqFxuICAgIGltcG9ydGVyTWFuYWdlciA9IG5ldyBJbXBvcnRlck1hbmFnZXIodGhpcyk7XG5cbiAgICBtZXRhTWFuYWdlcjogTWV0YU1hbmFnZXI7XG4gICAgaW5mb01hbmFnZXI6IEluZm9NYW5hZ2VyO1xuICAgIGRlcGVuZGVuY3lNYW5hZ2VyOiBEZXBlbmRlbmN5TWFuYWdlcjtcbiAgICB0YXNrTWFuYWdlcjogUGFyYWxsZWxRdWV1ZTxWaXJ0dWFsQXNzZXQsIGJvb2xlYW4+O1xuICAgIGRhdGFNYW5hZXI6IERhdGFNYW5hZ2VyO1xuXG4gICAgX2xvY2s6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfd2FpdExvY2tIYW5kbGVyOiBGdW5jdGlvbltdID0gW107XG5cbiAgICBnZXQgYXNzZXRQcm9ncmVzc0luZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE8gdGFza01hbmFnZXIg5piv5ZCm5Y+v5Lul5o+Q5L6b5q2k5a2X5q61XG4gICAgICAgICAgICBjdXJyZW50OiB0aGlzLnRhc2tNYW5hZ2VyLl9leGVjSUQgLSB0aGlzLnRhc2tNYW5hZ2VyLl9leGVjVGhyZWFkLFxuICAgICAgICAgICAgdG90YWw6IHRoaXMudGFza01hbmFnZXIudG90YWwoKSxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgVE9ETyB0YXNrTWFuYWdlciDmmK/lkKblj6/ku6Xmj5DkvpvmraTlrZfmrrVcbiAgICAgICAgICAgIHdhaXQ6IHRoaXMudGFza01hbmFnZXIuX3dhaXRRdWV1ZS5zaXplLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6ZSB5a6a6LWE5rqQXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBsb2NrKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2xvY2spIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2NrID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fd2FpdExvY2tIYW5kbGVyLnB1c2goKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6Kej6ZSB6LWE5rqQXG4gICAgICovXG4gICAgcHJpdmF0ZSB1bmxvY2soKSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9IHRoaXMuX3dhaXRMb2NrSGFuZGxlci5zaGlmdCgpO1xuICAgICAgICAvLyDlpoLmnpzmnInnrYnlvoXnmoTku7vliqHvvIzliJnmiafooYzkuIvkuIDkuKpcbiAgICAgICAgaWYgKGhhbmRsZSkge1xuICAgICAgICAgICAgaGFuZGxlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlt7Lnu4/msqHmnInlnKjnrYnlvoXnmoTku7vliqHkuobvvIzov5jljp/moIforrBcbiAgICAgICAgdGhpcy5fbG9jayA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWunuS+i+WMlui/h+eoi1xuICAgICAqIEBwYXJhbSBvcHRpb25zIFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEFzc2V0REJPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIGlmICghb3B0aW9ucy50YXJnZXQgfHwgIW9wdGlvbnMubGlicmFyeSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgVGhlIGRhdGFiYXNlIGNhbm5vdCBiZSBjcmVhdGVkIGJlY2F1c2UgdGhlcmUgaXMgbm8gdGFyZ2V0IG9yIGxpYnJhcnkgZGVmaW5pdGlvbmApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3B0aW9ucy50YXJnZXQgPSBhYnNvbHV0ZVBhdGgob3B0aW9ucy50YXJnZXQpO1xuICAgICAgICAgICAgb3B0aW9ucy5saWJyYXJ5ID0gYWJzb2x1dGVQYXRoKG9wdGlvbnMubGlicmFyeSk7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMudGVtcCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGpvaW4ob3B0aW9ucy5saWJyYXJ5LCAnLnRlbXAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGFic29sdXRlUGF0aChvcHRpb25zLnRlbXApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g6K6+572u6L6T5Ye6562J57qnXG4gICAgICAgIGlmICghKCdsZXZlbCcgaW4gb3B0aW9ucykgfHwgb3B0aW9ucy5sZXZlbCA+IDQgfHwgb3B0aW9ucy5sZXZlbCA8IDApIHtcbiAgICAgICAgICAgIG9wdGlvbnMubGV2ZWwgPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmlnbm9yZUZpbGVzIHx8ICFBcnJheS5pc0FycmF5KG9wdGlvbnMuaWdub3JlRmlsZXMpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmlnbm9yZUZpbGVzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgICAgIC8vIOWQr+WKqOaVsOaNruW6k+WGhee9rueahOWQhOS4queuoeeQhuWZqOeuoeeQhuWZqFxuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyID0gbmV3IFBhcmFsbGVsUXVldWUoYXN5bmMgKGFzc2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbXBvcnRlciA9IGF3YWl0IHRoaXMuaW1wb3J0ZXJNYW5hZ2VyLmZpbmQoYXNzZXQpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICFpbXBvcnRlciB8fFxuICAgICAgICAgICAgICAgIC8vIOWIoOmZpOeahOaXtuWAmeW+iOWPr+iDveaWh+S7tuS4jeWtmOWcqO+8jOaJgOS7pSBpbXBvcnRlciDmnInkuIDlrprmpoLnjofmmK8gKu+8jOi/meaXtuWAmeWSjOWOn+acieeahOWvvOWFpeWZqOiCr+WumuS4jeWMuemFje+8jOaJgOS7peS4jemcgOimgeWkhOeQhuWIoOmZpFxuICAgICAgICAgICAgICAgIChhc3NldC5hY3Rpb24gIT09IEFzc2V0QWN0aW9uRW51bS5kZWxldGUgJiZcbiAgICAgICAgICAgICAgICAgICAgKGltcG9ydGVyLm5hbWUgIT09IGFzc2V0Lm1ldGEuaW1wb3J0ZXIgJiYgYXNzZXQubWV0YS5pbXBvcnRlciAhPT0gJyonKSAmJlxuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbXBvcnRlZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGlmICghYXNzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVuYWJsZSB0byBpbXBvcnQgZGF0YSwgbm8gc3VpdGFibGUgaW1wb3J0ZXIgd2FzIGZvdW5kLiB7YXNzZXRbJHthc3NldCBpbnN0YW5jZW9mIEFzc2V0ID8gYXNzZXQuYmFzZW5hbWUgOiAnJ31dKCR7YXNzZXQudXVpZH0pfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmludmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKGFzc2V0LmFjdGlvbikge1xuICAgICAgICAgICAgICAgIGNhc2UgQXNzZXRBY3Rpb25FbnVtLmFkZDoge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFNYW5hZXIuZW1wdHkoYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgVEFTS19NQVAuaW1wb3J0LmV4ZWModGhpcywgYXNzZXQsIGltcG9ydGVyLCB0cnVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXNzZXQuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0U3RhdHMgPSBzdGF0U3luYyhhc3NldC5zb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQoYXNzZXQuc291cmNlLCBhc3NldFN0YXRzLm10aW1lTXMsIGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydEFzc29jaWF0ZWRBc3NldHModGhpcywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmVtaXQoJ2FkZGVkJywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBBc3NldEFjdGlvbkVudW0uY2hhbmdlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFlci5lbXB0eShhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGF3YWl0IFRBU0tfTUFQLmRlc3Ryb3kuZXhlYyh0aGlzLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUQVNLX01BUC5pbXBvcnQuZXhlYyh0aGlzLCBhc3NldCwgaW1wb3J0ZXIsIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQgaW5zdGFuY2VvZiBBc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzZXRTdGF0cyA9IHN0YXRTeW5jKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChhc3NldC5zb3VyY2UsIGFzc2V0U3RhdHMubXRpbWVNcywgYXNzZXQudXVpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0QXNzb2NpYXRlZEFzc2V0cyh0aGlzLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZW1pdCgnY2hhbmdlZCcsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgQXNzZXRBY3Rpb25FbnVtLmRlbGV0ZToge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFNYW5hZXIuZW1wdHkoYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBUQVNLX01BUC5kZXN0cm95LmV4ZWModGhpcywgYXNzZXQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldCBpbnN0YW5jZW9mIEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXRhRmlsZSA9IGFzc2V0LnNvdXJjZSArICcubWV0YSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShhc3NldC5zb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5yZW1vdmUobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydEFzc29jaWF0ZWRBc3NldHModGhpcywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIEFzc2V0QWN0aW9uRW51bS5ub25lOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUQVNLX01BUC5pbXBvcnQuZXhlYyh0aGlzLCBhc3NldCwgaW1wb3J0ZXIsIGZhbHNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXNzZXQuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0LmluaXQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGFzc2V0LmFjdGlvbiAhPT0gQXNzZXRBY3Rpb25FbnVtLm5vbmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFNYW5hZXIuc2F2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLm5vbmU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSwgNSk7XG5cbiAgICAgICAgLy8g5YWo5bGA5Y+v55So55qE57O757uf55u45YWz55qE566h55CG5ZmoXG4gICAgICAgIHRoaXMubWV0YU1hbmFnZXIgPSBuZXcgTWV0YU1hbmFnZXIoKTtcbiAgICAgICAgdGhpcy5pbmZvTWFuYWdlciA9IG5ldyBJbmZvTWFuYWdlcigpO1xuICAgICAgICB0aGlzLmRlcGVuZGVuY3lNYW5hZ2VyID0gbmV3IERlcGVuZGVuY3lNYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuZGF0YU1hbmFlciA9IG5ldyBEYXRhTWFuYWdlcigpO1xuXG4gICAgICAgIC8vIOazqOWGjOm7mOiupOeahOino+aekOWZqFxuICAgICAgICB0aGlzLmltcG9ydGVyTWFuYWdlci5hZGQoRGVmYXVsdEltcG9ydGVyLCBbJyonXSk7XG4gICAgfVxuXG4gICAgcHJlSW1wb3J0ZXJIYW5kbGVyPyhmaWxlOiBzdHJpbmcpOiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICog5ZCv5Yqo6LWE5rqQ5pWw5o2u5bqTXG4gICAgICovXG4gICAgYXN5bmMgc3RhcnQob3B0aW9uczogQXNzZXREQlN0YXJ0T3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnRhcmdldCB8fCAhdGhpcy5vcHRpb25zLmxpYnJhcnkgfHwgIXRoaXMub3B0aW9ucy50ZW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBQYXJhbWV0ZXIgZXJyb3IsIHVuYWJsZSB0byBzdGFydC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmZsYWcuc3RhcnRlZCAmJiB0aGlzLm9wdGlvbnMubGV2ZWwgPj0gMikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGUgJHt0aGlzLm9wdGlvbnMubmFtZX0gZGF0YWJhc2UgaXMgYWxyZWFkeSBzdGFydGVkLmApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5mbGFnLnN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmZsYWcuc3RhcnRpbmcgPSB0cnVlO1xuXG4gICAgICAgIGF3YWl0IHRoaXMubWV0YU1hbmFnZXIuc2V0QmFja3VwUGF0aChqb2luKHRoaXMub3B0aW9ucy50ZW1wLCAnbWV0YScpKTtcbiAgICAgICAgYXdhaXQgdGhpcy5tZXRhTWFuYWdlci5zZXRSZWNvcmRKU09OKGpvaW4odGhpcy5vcHRpb25zLmxpYnJhcnksIGAuJHt0aGlzLm9wdGlvbnMubmFtZX0tbWV0YS5qc29uYCkpO1xuICAgICAgICBhd2FpdCB0aGlzLmluZm9NYW5hZ2VyLnNldFJlY29yZEpTT04oam9pbih0aGlzLm9wdGlvbnMubGlicmFyeSwgYC4ke3RoaXMub3B0aW9ucy5uYW1lfS1pbmZvLmpzb25gKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGF0YU1hbmFlci5zZXRSZWNvcmRKU09OKGpvaW4odGhpcy5vcHRpb25zLmxpYnJhcnksIGAuJHt0aGlzLm9wdGlvbnMubmFtZX0tZGF0YS5qc29uYCkpO1xuICAgICAgICBhd2FpdCB0aGlzLmRlcGVuZGVuY3lNYW5hZ2VyLnNldFJlY29yZEpTT04oam9pbih0aGlzLm9wdGlvbnMubGlicmFyeSwgYC4ke3RoaXMub3B0aW9ucy5uYW1lfS1kZXBlbmRlbmN5Lmpzb25gKSk7XG5cbiAgICAgICAgLy8g6KaB5Zyo6LWE5rqQ5Yi35paw5YmN5Yqg5YWl57yT5a2YXG4gICAgICAgIG1hcFt0aGlzLm9wdGlvbnMubmFtZV0gPSB0aGlzO1xuXG4gICAgICAgIC8vIOWIt+aWsOi1hOa6kOaVsOaNruW6k+WGheeahOi1hOa6kOWIl+ihqFxuICAgICAgICBsZXQgbnVtID0gYXdhaXQgdGhpcy5yZWZyZXNoKHRoaXMub3B0aW9ucy50YXJnZXQsIHtcbiAgICAgICAgICAgIGlnbm9yZVNlbGY6IHRydWUsXG4gICAgICAgICAgICBob29rczogb3B0aW9ucy5ob29rcyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5kZWJ1Zyhgc3RhcnQgYXNzZXQtZGIgd2l0aCBhc3NldDogJHtudW19YClcblxuICAgICAgICBsZXQgaW5mb0RpcnR5ID0gZmFsc2U7XG4gICAgICAgIC8vIOWIoOmZpOW3sue7j+S4jeWtmOWcqOeahOi1hOa6kFxuICAgICAgICAvLyBtdGltZSDorrDlvZXnmoTpg73mmK/kuYvliY3lrZjlnKjnmoTmlofku7bvvIzmiYDku6Xlvqrnjq8gbXRpbWUg566h55CG5Zmo6YeM55qE5pWw5o2u6L+b6KGM5qCh6aqMXG4gICAgICAgIGZvciAobGV0IHBhdGggaW4gdGhpcy5pbmZvTWFuYWdlci5tYXApIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAhdGhpcy5wYXRoMmFzc2V0LmhhcyhwYXRoKVxuICAgICAgICAgICAgICAgICYmIHRoaXMuaW5mb01hbmFnZXIubWFwW3BhdGhdLnV1aWRcbiAgICAgICAgICAgICAgICAmJiAhdGhpcy5pbmZvTWFuYWdlci5tYXBbcGF0aF0ubWlzc2luZ1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IHRoaXMuaW5mb01hbmFnZXIubWFwW3BhdGhdLnV1aWQgYXMgc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0QXNzZXQodXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IGAke3RoaXMub3B0aW9ucy5saWJyYXJ5fSR7c2VwfSR7dXVpZC5zdWJzdHIoMCwgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IHJlYWRkaXIoZGlyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG5hbWUgb2YgbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgodXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVtb3ZlKGpvaW4oZGlyLCBuYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIubWFwW3BhdGhdLm1pc3NpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpbmZvRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGluZm9EaXJ0eSAmJiB0aGlzLmluZm9NYW5hZ2VyLnNhdmUoKTtcbiAgICAgICAgLy8gYXdhaXQgdGhpcy50YXNrTWFuYWdlci53YWl0UXVldWUoKTtcbiAgICAgICAgLy8gcmV0dXJuIG51bTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy50YXNrTWFuYWdlci5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhZy5zdGFydGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaG9va3MgJiYgb3B0aW9ucy5ob29rcy5hZnRlclN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgb3B0aW9ucy5ob29rcy5hZnRlclN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUobnVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLndhaXRRdWV1ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc3RlcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDlgZzmraLotYTmupDmlbDmja7lupNcbiAgICAgKi9cbiAgICBhc3luYyBzdG9wKCkge1xuICAgICAgICB0aGlzLnV1aWQyYXNzZXQuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5wYXRoMmFzc2V0LmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZmxhZy5zdGFydGVkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5zYXZlSW1tZWRpYXRlKCk7XG4gICAgICAgIHRoaXMuaW5mb01hbmFnZXIuc2F2ZUltbWVkaWF0ZSgpO1xuICAgICAgICB0aGlzLmRlcGVuZGVuY3lNYW5hZ2VyLnNhdmVJbW1lZGlhdGUoKTtcbiAgICAgICAgdGhpcy5kYXRhTWFuYWVyLnNhdmVJbW1lZGlhdGUoKTtcblxuICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeU1hbmFnZXIuZGVzdHJveSgpO1xuXG4gICAgICAgIGlmIChtYXBbdGhpcy5vcHRpb25zLm5hbWVdID09PSB0aGlzKSB7XG4gICAgICAgICAgICBkZWxldGUgbWFwW3RoaXMub3B0aW9ucy5uYW1lXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOS8oOWFpSBwYXRo77yM6L+U5ZueIGFzc2V0LWRiIOWGheWvueW6lOeahCB1dWlkXG4gICAgICog5LiN5a2Y5Zyo5YiZ6L+U5ZueIG51bGxcbiAgICAgKiBAcGFyYW0gcGF0aCBcbiAgICAgKi9cbiAgICBwYXRoVG9VdWlkKHBhdGg6IHN0cmluZykge1xuICAgICAgICBsZXQgYXNzZXQgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KHBhdGgpO1xuICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXNzZXQudXVpZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDkvKDlhaUgdXVpZO+8jOi/lOWbnuWvueW6lOeahOi1hOa6kOeahCBwYXRoXG4gICAgICogQHBhcmFtIHV1aWQgXG4gICAgICovXG4gICAgdXVpZFRvUGF0aCh1dWlkOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGFzc2V0ID0gdGhpcy51dWlkMmFzc2V0LmdldCh1dWlkKTtcbiAgICAgICAgaWYgKCFhc3NldCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXNzZXQuc291cmNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOafpeivoui1hOa6kOWunuS+i1xuICAgICAqIEBwYXJhbSB1dWlkXG4gICAgICovXG4gICAgZ2V0QXNzZXQodXVpZDogc3RyaW5nKSB7XG4gICAgICAgIGlmICghdXVpZCB8fCB0eXBlb2YgdXVpZCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzZWFyY2ggPSB1dWlkLnNwbGl0KCdAJyk7XG4gICAgICAgIGxldCBpZCA9IHNlYXJjaC5zaGlmdCgpIHx8ICcnO1xuXG4gICAgICAgIGxldCBhc3NldDogVmlydHVhbEFzc2V0IHwgQXNzZXQgfCB1bmRlZmluZWQgPSB0aGlzLnV1aWQyYXNzZXQuZ2V0KGlkKTtcbiAgICAgICAgaWYgKCFhc3NldCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWFyY2gubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBpZE9yTmFtZSA9IHNlYXJjaFtpXTtcbiAgICAgICAgICAgIGFzc2V0ID0gYXNzZXQuc3ViQXNzZXRzW2lkT3JOYW1lXTtcbiAgICAgICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXNzZXQgfHwgbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDph43mlrDlr7zlhaVcbiAgICAgKiBAcGFyYW0gZmlsZU9yVVVJRCBcbiAgICAgKi9cbiAgICBhc3luYyByZWltcG9ydChmaWxlT3JVVUlEOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgYXNzZXQ6IEFzc2V0IHwgVmlydHVhbEFzc2V0IHwgbnVsbCA9IHRoaXMucGF0aDJhc3NldC5nZXQoZmlsZU9yVVVJRCkgfHwgdGhpcy5nZXRBc3NldChmaWxlT3JVVUlEKTtcbiAgICAgICAgaWYgKCFhc3NldCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmmoLml7bkvb/nlKjlvIDlhbPmjqfliLZcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5mbGFncyAmJiB0aGlzLm9wdGlvbnMuZmxhZ3MucmVpbXBvcnRDaGVjayAmJiAhYXNzZXQuX2xvY2sgJiYgYXNzZXQuYWN0aW9uICE9PSBBc3NldEFjdGlvbkVudW0ubm9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8g6ZyA6KaB5YWI6ZSB5a6a77yM5Zug5Li65aaC5p6c5byA5aeL5a+85YWl77yMaW5pdCDov5jmmK8gZmFsc2XvvIzkvYbotYTmupDlt7Lnu4/ooqvplIHlrprvvIzmiYDku6XnrYnlvoXotYTmupDplIHlrprnirbmgIHnu5PmnZ/vvIzlho3lvIDlp4vlr7zlhaVcbiAgICAgICAgYXdhaXQgdGhpcy5sb2NrKCk7XG5cbiAgICAgICAgLy8g5by65Yi26YeN5paw6Kem5Y+R5p+l5om+IGltcG9ydGVyIOeahOWKqOS9nFxuICAgICAgICBpZiAoYXNzZXQgaW5zdGFuY2VvZiBBc3NldCkge1xuICAgICAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5yZWFkKGFzc2V0LnNvdXJjZSArICcubWV0YScpO1xuICAgICAgICAgICAgY29uc3Qgb2xkSW1wb3J0ZXIgPSBhc3NldC5tZXRhLmltcG9ydGVyO1xuICAgICAgICAgICAgYXNzZXQubWV0YS5pbXBvcnRlciA9ICcqJztcbiAgICAgICAgICAgIGNvbnN0IGltcG9ydGVyID0gYXdhaXQgdGhpcy5pbXBvcnRlck1hbmFnZXIuZmluZChhc3NldCk7XG4gICAgICAgICAgICBpZiAoIWltcG9ydGVyKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gaW1wb3J0IGRhdGEsIG5vIHN1aXRhYmxlIGltcG9ydGVyIHdhcyBmb3VuZC5cXG4gIHBhdGg6ICR7YXNzZXQuc291cmNlfVxcbiAgdXVpZDogJHthc3NldC51dWlkfWApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvbGRJbXBvcnRlciA9PT0gaW1wb3J0ZXIubmFtZSkge1xuICAgICAgICAgICAgICAgIGFzc2V0Lm1ldGEuaW1wb3J0ZXIgPSBpbXBvcnRlci5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghYXNzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5sb2NrKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuaW5pdCA9IGZhbHNlO1xuICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmNoYW5nZTtcbiAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51bmxvY2soKTtcblxuICAgICAgICBhd2FpdCB0aGlzLnRhc2tNYW5hZ2VyLndhaXRRdWV1ZSgpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yi35paw6LWE5rqQXG4gICAgICog5Lyg5YWl5p+Q5LiA5Liq5paH5Lu25oiW6ICF5paH5Lu25aS577yM6L+b6KGM5pWw5o2u5bqT5Yi35paw5pON5L2cXG4gICAgICog5Lya5LyY5YWI5ZCM5q2l5omr5o+P5omA5pyJ6LWE5rqQ77yM54S25ZCO562J5b6F5YW25LuWIHJlZnJlc2gg6Zif5YiXXG4gICAgICog6buY6K6kIHJlZnJlc2gg5piv5pyJ6Zif5YiX55qE77yM5aSa5LiqIHJlZnJlc2gg5ZCM5pe25omn6KGM6ZyA6KaB6L+b5YWl6Zif5YiX562J5b6FXG4gICAgICogQHBhcmFtIHBhdGggXG4gICAgICogQHJldHVybnMge251bWJlcn0g5Yi35paw55qE6LWE5rqQ5Liq5pWwXG4gICAgICovXG4gICAgYXN5bmMgcmVmcmVzaChwYXRoOiBzdHJpbmcsIG9wdGlvbnM6IEFzc2V0REJSZWZyZXNoT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgLy8g5aaC5p6c5LiN5piv57ud5a+56Lev5b6E77yM5LiN5Yi35pawXG4gICAgICAgIGlmICghYWJzb2x1dGVQYXRoKHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpO1xuXG4gICAgICAgIC8vIOWmguaenOaYr+aVsOaNruW6k+aWh+S7tuWkue+8jOm7mOiupOWwseW/veeVpeiHquW3sVxuICAgICAgICBpZiAocGF0aCA9PT0gdGhpcy5vcHRpb25zLnRhcmdldCkge1xuICAgICAgICAgICAgb3B0aW9ucy5pZ25vcmVTZWxmID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWQkeS4iumAkuW9kuafpeivou+8jOafpeivouiHquW3seeahOeItue6p+aWh+S7tuWkueaYr+WQpuWtmOWcqFxuICAgICAgICAvLyDlpoLmnpzniLbmlofku7blpLnkuI3lnKggZGIg6YeM77yM5YiZ6Ieq5Yqo5Yqg5YWlXG4gICAgICAgIGxldCBwYXJlbnREaXIgPSBkaXJuYW1lKHBhdGgpO1xuICAgICAgICB3aGlsZSAoaXNTdWJQYXRoKHBhcmVudERpciwgdGhpcy5vcHRpb25zLnRhcmdldCkgJiYgIXRoaXMucGF0aDJhc3NldC5oYXMocGFyZW50RGlyKSkge1xuICAgICAgICAgICAgcGF0aCA9IHBhcmVudERpcjtcbiAgICAgICAgICAgIHBhcmVudERpciA9IGRpcm5hbWUocGFyZW50RGlyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOajgOafpeaYr+S4jeaYr+mFjee9rueahCByb290IOi3r+W+hOeahOWtkOebruW9le+8jOWmguaenOS4jeaYr+WtkOi3r+W+hO+8jOWImei/lOWbnuWIt+aWsCAwIOS4qui1hOa6kFxuICAgICAgICBpZiAoIWlzU3ViUGF0aChwYXRoLCB0aGlzLm9wdGlvbnMudGFyZ2V0KSAmJiBwYXRoICE9PSB0aGlzLm9wdGlvbnMudGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZmlsZXM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlU3RhdCA9IHN0YXRTeW5jKHBhdGgpO1xuICAgICAgICAgICAgaWYgKGZpbGVTdGF0LmlzRmlsZSgpKSB7XG4gICAgICAgICAgICAgICAgZmlsZXMgPSBbcGF0aF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JQYXRoID0gcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJyA/IHBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpIDogcGF0aDtcbiAgICAgICAgICAgICAgICAvLyAhIOimgeWGmee7neWvuei3r+W+hO+8jOWQpuWImeWPr+iDveWcqOafkOS6myB3aW4g5py65Zmo5LiK5peg5rOV5b+955Wl5paH5Lu2XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0gb3B0aW9ucy5nbG9iTGlzdCB8fCBbXG4gICAgICAgICAgICAgICAgICAgIGAqKi8qYCxcbiAgICAgICAgICAgICAgICAgICAgYCEqKi8qLm1ldGFgLFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVHbG9iKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaC5wdXNoKHRoaXMub3B0aW9ucy5pZ25vcmVHbG9iKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsZXMgPSBmZy5zeW5jKHNlYXJjaCwge1xuICAgICAgICAgICAgICAgICAgICBvbmx5RmlsZXM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzlsIYgcGF0aCDkvKDlhaUgc2VhcmNoIOaVsOe7hO+8jOWNoue7j+eQhuW4puaciSAoKSDlsLHml6Dms5XmraPnoa7or4bliKvkuobvvIzmiYDku6XpnIDopoHkvb/nlKggY3dkXG4gICAgICAgICAgICAgICAgICAgIGN3ZDogZ2xvYlBhdGgsXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzW2luZGV4XSA9IGpvaW4oZ2xvYlBhdGgsIGZpbGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8g5b2T5omr5o+P55qE6Lev5b6E5LiN5piv5qC555uu5b2V55qE5pe25YCZ77yM5oqK6KKr5omr5o+P55qE6Lev5b6E5Lmf5qOA5p+l5LiA5qyhXG4gICAgICAgICAgICAgICAgaWYgKHBhdGggIT09IHRoaXMub3B0aW9ucy50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZXMuc3BsaWNlKDAsIDAsIHBhdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGZpbGVzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgLy8g5paH5Lu25YiG57uE77yM5aaC5p6c5pyJ5aSa5Liq57uE77yM5Lya5Zyo5LiK5LiA5Liq57uE5a+85YWl5a6M5oiQ5ZCO77yM5omN5byA5aeL5LiL5LiA5Liq57uE55qE5a+85YWl5rWB56iLXG4gICAgICAgIGlmIChvcHRpb25zLmhvb2tzICYmIG9wdGlvbnMuaG9va3MuYWZ0ZXJTY2FuKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJTY2FuKGZpbGVzKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmiavmj4/mlofku7bliLDnmoTmlofku7borrDlvZVcbiAgICAgICAgY29uc3QgZmlsZVNldDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGRlbGV0ZVNldDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGFkZFNldDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHByZUFkZEZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgYWRkRmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBjb25zdCBkZWxldGVGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZUltcG9ydGVySGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhdGgyYXNzZXQuaGFzKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmVJbXBvcnRlckhhbmRsZXIoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVBZGRGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2V0LmFkZChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmaWxlU2V0LmFkZChmaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhdGgyYXNzZXQuaGFzKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2V0LmFkZChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmaWxlU2V0LmFkZChmaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5mb3JFYWNoKChhc3NldCwgZmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDAgfHwgIWZpbGVTZXQuaGFzKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlID09PSBwYXRoIHx8IGlzU3ViUGF0aChmaWxlLCBwYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlRmlsZXMucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVNldC5hZGQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy50YXNrTWFuYWdlci5zdG9wKCk7XG5cbiAgICAgICAgICAgIC8vIOWIpOaWrea3u+WKoOeahOi1hOa6kOWSjOenu+WKqOOAgeWIoOmZpOeahOi1hOa6kFxuICAgICAgICAgICAgdGhpcy5fY2hlY2tBc3NldHNTdGF0U3luYyhwcmVBZGRGaWxlcywgZGVsZXRlRmlsZXMsIGRlbGV0ZVNldCk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5ob29rcyAmJiBvcHRpb25zLmhvb2tzLmFmdGVyUHJlSW1wb3J0KSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgb3B0aW9ucy5ob29rcy5hZnRlclByZUltcG9ydCgpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2NoZWNrQXNzZXRzU3RhdFN5bmMoYWRkRmlsZXMsIGRlbGV0ZUZpbGVzLCBkZWxldGVTZXQpO1xuXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZnJlc2gtdXVpZC1yZWFkeScsIHBhdGgpO1xuXG4gICAgICAgICAgICAvLyDplIHlrprku7vliqHmoIhcbiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9jaygpO1xuXG4gICAgICAgICAgICAvLyDmsqHmnInmlLnliqjnmoTmlbDmja5cbiAgICAgICAgICAgIGNvbnN0IHRhc2tzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgICAgIGlmICghYWRkU2V0LmhhcyhmaWxlKSAmJiAhZGVsZXRlU2V0LmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMucGF0aDJhc3NldC5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFza3MucHVzaCh0aGlzLl9jaGVja0Fzc2V0U3RhdChhc3NldCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwodGFza3MpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB0aGlzLnVubG9jaygpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5ob29rcyAmJiBvcHRpb25zLmhvb2tzLmFmdGVyR2VuZXJhdGVNZXRlKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJHZW5lcmF0ZU1ldGUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLnN0YXJ0KCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudGFza01hbmFnZXIud2FpdFF1ZXVlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudW5sb2NrKCk7XG5cbiAgICAgICAgLy8g6L+U5Zue5omA5pyJ5paH5Lu255qE5Liq5pWwXG4gICAgICAgIGNvbnN0IG51bSA9IHRoaXMudGFza01hbmFnZXIudG90YWwoKTtcbiAgICAgICAgdGhpcy50YXNrTWFuYWdlci5jbGVhcigpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmhvb2tzICYmIG9wdGlvbnMuaG9va3MuYWZ0ZXJSZWZyZXNoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJSZWZyZXNoKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZXBsYWNlVVVJRChhc3NldDogQXNzZXQsIG9Bc3NldDogQXNzZXQpIHtcbiAgICAgICAgaWYgKG9Bc3NldCAhPT0gYXNzZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1VVSUQgPSB2NCgpO1xuICAgICAgICAgICAgLy8g5o+Q56S65Lik5Liq5paH5Lu2IHV1aWQg5Yay56qBXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDIpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IEpTT04uc3RyaW5naWZ5KFtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuc291cmNlLFxuICAgICAgICAgICAgICAgICAgICBvQXNzZXQuc291cmNlLFxuICAgICAgICAgICAgICAgIF0sIG51bGwsIDIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlIHV1aWQgaXMgYWxyZWFkeSBwb2ludGluZyB0byBhbm90aGVyIHJlc291cmNlLlxcbiR7aW5mb31cXG5UaGUgZmlsZSB1dWlkIGhhcyBiZWVuIHVwZGF0ZWQ6ICR7YXNzZXQuc291cmNlfVxcbiAgICAke2Fzc2V0LnV1aWR9IC0+ICR7bmV3VVVJRH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0Lm1ldGEudXVpZCA9IG5ld1VVSUQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmo4Dmn6XotYTmupDnirbmgIFcbiAgICAgKiDor4bliKvmmK/mlrDlop7jgIHkv67mlLnov5jmmK/liKDpmaTkuobotYTmupBcbiAgICAgKiBAcGFyYW0gYWRkRmlsZXNcbiAgICAgKiBAcGFyYW0gZGVsZXRlRmlsZXNcbiAgICAgKi9cbiAgICBwcml2YXRlIF9jaGVja0Fzc2V0c1N0YXRTeW5jKGFkZEZpbGVzOiBzdHJpbmdbXSwgZGVsZXRlRmlsZXM6IHN0cmluZ1tdLCBkZWxldGVTZXQ6IFNldDxzdHJpbmc+KSB7XG4gICAgICAgIGZvciAobGV0IGZpbGUgb2YgZGVsZXRlRmlsZXMpIHtcbiAgICAgICAgICAgIC8vIOavi+W6uOe9rueWkeeahOWIoOmZpOaWh+S7tlxuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmRlbGV0ZTtcbiAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5kZWxldGUoYXNzZXQuc291cmNlKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gYXNzZXQuc291cmNlICsgJy5tZXRhJztcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5yZW1vdmUoYXNzZXQuc291cmNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBhZGRGaWxlcykge1xuICAgICAgICAgICAgLy8g6I635Y+WIG1ldGHvvIzmsqHmnInnmoTor53nm7TmjqXnlJ/miJBcbiAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gZmlsZSArICcubWV0YSc7XG4gICAgICAgICAgICBjb25zdCBtZXRhSW5mbyA9IHRoaXMubWV0YU1hbmFnZXIuZ2V0KG1ldGFGaWxlKTtcbiAgICAgICAgICAgIGNvbnN0IHV1aWRDYWNoZUFzc2V0ID0gZ2V0QXNzZXQobWV0YUluZm8uanNvbi51dWlkKTtcbiAgICAgICAgICAgIC8vIHV1aWQg5oyH5ZCR55qE5paH5Lu26KKr5Yig6Zmk5LqG77yM5bCx5piv56e75Yqo5paH5Lu2XG4gICAgICAgICAgICBpZiAodXVpZENhY2hlQXNzZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZVNldC5oYXModXVpZENhY2hlQXNzZXQuc291cmNlKSB8fFxuICAgICAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkQ2FjaGVBc3NldC5zb3VyY2UgIT09IGZpbGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFleGlzdHNTeW5jKHV1aWRDYWNoZUFzc2V0LnNvdXJjZSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IHV1aWRDYWNoZUFzc2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuZGVsZXRlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSArICcubWV0YScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShhc3NldC5zb3VyY2UgKyAnLm1ldGEnKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuX3NvdXJjZSA9IGZpbGU7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmV4dG5hbWUgPSBleHRuYW1lKGZpbGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmJhc2VuYW1lID0gYmFzZW5hbWUoZmlsZSwgYXNzZXQuZXh0bmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnVwZGF0ZVVybCgpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5tZXRhID0gbWV0YUluZm8uanNvbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmNoYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHV1aWQg5oyH5ZCR55qE5paH5Lu25rKh5Yig6Zmk77yM6K+G5Yir5Li65paw5bu677yM5L2G5pivIHV1aWQg5Yay56qB5LqGXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gbmV3IEFzc2V0KGZpbGUsIG1ldGFJbmZvLmpzb24sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXBsYWNlVVVJRChhc3NldCwgdXVpZENhY2hlQXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlkK/liqjmlbDmja7lupPvvIzov5jljp/ku6XliY3nmoTotYTmupBcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmxhZy5zdGFydGluZykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVTdGF0ID0gc3RhdFN5bmMoZmlsZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYXNzZXQgPSBuZXcgQXNzZXQoZmlsZSwgbWV0YUluZm8uanNvbiwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKGZpbGUsIGZpbGVTdGF0Lm10aW1lTXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFTdGF0ID0gc3RhdFN5bmMobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YU1hbmFlci5oYXMoYXNzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLm5vbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtZXRhIOiiq+S/ruaUue+8jOWwseivhuWIq+S4uuWFiOWIoOWQjuaWsOWinlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGUnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IGFzc2V0LnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0LnV1aWQgIT09IHV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnV1aWQyYXNzZXQuaGFzKGFzc2V0LnV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBnZXRBc3NldChhc3NldC51dWlkKSEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChmaWxlLCBmaWxlU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5zZXQoYXNzZXQuc291cmNlLCBhc3NldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOaZrumAmuaWsOWinlxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb0Fzc2V0ID0gZ2V0QXNzZXQobWV0YUluZm8uanNvbi51dWlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IG5ldyBBc3NldChmaWxlLCBtZXRhSW5mby5qc29uLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAob0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBvQXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFTdGF0ID0gc3RhdFN5bmMobWV0YUZpbGUpO1xuXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6cIG1ldGFGaWxlIOeahOe8k+WtmOS4jeWtmOWcqO+8jOWImea3u+WKoOi/m+e8k+WtmFxuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaW5mb01hbmFnZXIuZ2V0KG1ldGFGaWxlKVxuICAgICAgICAgICAgICAgICAgICB8fCAoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmdldChmaWxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgdGhpcy5pbmZvTWFuYWdlci5nZXQoZmlsZSkubWlzc2luZ1xuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyDlpoLmnpwgbWV0YUZpbGUg55qE57yT5a2Y5LiN5LiA6Ie077yM5YiZ5Yik5pat5Li66KKr5L+u5pS5XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5mb01hbmFnZXIuY29tcGFyZShtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcykpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmFkZDtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOi/meenjeaDheWGteS4i++8jG1ldGEg6KKr5L+u5pS577yM6YO96K+G5Yir5Li65YWI5Yig6Zmk5ZCO5paw5aKeXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZGVsZXRlJywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHV1aWQgPSBhc3NldC51dWlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQudXVpZCAhPT0gdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LmRlbGV0ZSh1dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcyk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9jaGVja0Fzc2V0U3RhdChhc3NldDogQXNzZXQpIHtcblxuICAgICAgICBjb25zdCBmaWxlID0gYXNzZXQuc291cmNlO1xuICAgICAgICBjb25zdCBtZXRhRmlsZSA9IGZpbGUgKyAnLm1ldGEnO1xuICAgICAgICBjb25zdCBtZXRhU3RhdCA9IGF3YWl0IHN0YXQobWV0YUZpbGUpO1xuXG4gICAgICAgIGlmICghYXdhaXQgdGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKSkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGUnLCBhc3NldCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgY29uc3QgdXVpZCA9IGFzc2V0LnV1aWQ7XG4gICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0LnV1aWQgIT09IHV1aWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKHV1aWQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnV1aWQyYXNzZXQuaGFzKGFzc2V0LnV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBnZXRBc3NldChhc3NldC51dWlkKSEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlU3RhdCA9IGF3YWl0IHN0YXQoZmlsZSk7XG4gICAgICAgICAgICBpZiAodGhpcy5pbmZvTWFuYWdlci5jb21wYXJlKGZpbGUsIGZpbGVTdGF0Lm10aW1lTXMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YU1hbmFlci5oYXMoYXNzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5ub25lO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uY2hhbmdlO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIOabtOaWsCBtdGltZSDorrDlvZVcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChmaWxlLCBmaWxlU3RhdC5tdGltZU1zLCBhc3NldC51dWlkKTtcbiAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uY2hhbmdlO1xuICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19