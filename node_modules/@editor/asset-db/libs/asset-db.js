'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssetDB = exports.version = exports.map = void 0;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const events_1 = require("events");
const node_uuid_1 = require("node-uuid");
const importer_1 = require("./importer");
const asset_1 = require("./asset");
const utils_1 = require("./utils");
const meta_1 = require("./meta");
const info_1 = require("./info");
const task_1 = require("./task");
const dependency_1 = require("./dependency");
const data_1 = require("./data");
const manager_1 = require("./manager");
const workflow_extra_1 = require("workflow-extra");
const fast_glob_1 = __importDefault(require("fast-glob"));
const console_1 = require("./console");
const migrator_1 = require("./migrator");
var manager_2 = require("./manager");
Object.defineProperty(exports, "map", { enumerable: true, get: function () { return manager_2.map; } });
function getAsset(uuid) {
    for (let name in manager_1.map) {
        const db = manager_1.map[name];
        const asset = db.uuid2asset.get(uuid);
        if (asset) {
            return asset;
        }
    }
    return undefined;
}
let deprecatedFlag = false;
exports.version = '2.0.0';
const migrations = [{
        version: '1.0.0',
        migrate: async (json, db) => {
            return {
                version: '1.0.0',
                data: json,
            };
        },
    }, {
        version: '1.0.1',
        migrate: async (json, db) => {
            return {
                version: '1.0.1',
                data: {
                    paths: json.data.paths.map(path => (0, path_1.relative)(db.options.target, path)),
                }
            };
        },
    }];
class AssetDB extends events_1.EventEmitter {
    /**
     * @deprecated AssetDB.dataManaer is deprecated, Please use AssetDB.dataManager instead.
     */
    get dataManaer() {
        if (!deprecatedFlag) {
            console.debug('AssetDB.dataManaer is deprecated, Please use AssetDB.dataManager instead.');
            deprecatedFlag = true;
        }
        // 兼容旧版本用法
        return this.dataManager;
    }
    ;
    get assetProgressInfo() {
        return {
            // @ts-ignore TODO taskManager 是否可以提供此字段
            current: this.taskManager._execID - this.taskManager._execThread,
            total: this.taskManager.total(),
            // @ts-ignore TODO taskManager 是否可以提供此字段
            wait: this.taskManager._waitQueue.size,
        };
    }
    /**
     * 锁定资源
     */
    async lock() {
        if (!this._lock) {
            return this._lock = true;
        }
        return await new Promise((resolve, reject) => {
            this._waitLockHandler.push(() => {
                resolve(null);
            });
        });
    }
    /**
     * 解锁资源
     */
    unlock() {
        const handle = this._waitLockHandler.shift();
        // 如果有等待的任务，则执行下一个
        if (handle) {
            handle();
            return;
        }
        // 已经没有在等待的任务了，还原标记
        this._lock = false;
    }
    /**
     * 实例化过程
     * @param options
     */
    constructor(options) {
        super();
        // 标记
        this.flag = {
            // 是否正在启动
            starting: false,
            // 是否已经启动的标记
            started: false,
        };
        // path 对应 asset 的 map
        this.path2asset = new Map;
        // uuid 对应 asset 的 map
        this.uuid2asset = new Map;
        this._lock = false;
        this._waitLockHandler = [];
        if (!options.target || !options.library) {
            console.error(`The database(${options.name}) cannot be created because there is no target or library definition`);
        }
        else {
            options.target = (0, utils_1.absolutePath)(options.target);
            options.library = (0, utils_1.absolutePath)(options.library);
            if (!options.temp) {
                options.temp = (0, path_1.join)(options.library, '.temp');
            }
            options.temp = (0, utils_1.absolutePath)(options.temp);
        }
        // 设置输出等级
        if (!('level' in options) || options.level > 4 || options.level < 0) {
            options.level = 4;
        }
        if (!options.ignoreFiles || !Array.isArray(options.ignoreFiles)) {
            options.ignoreFiles = [];
        }
        this.options = options;
        // 启动数据库内置的各个管理器管理器
        this.taskManager = new workflow_extra_1.ParallelQueue(async (asset) => {
            const importer = await this.importerManager.find(asset);
            if (!importer ||
                // 删除的时候很可能文件不存在，所以 importer 有一定概率是 *，这时候和原有的导入器肯定不匹配，所以不需要处理删除
                (asset.action !== asset_1.AssetActionEnum.delete &&
                    (importer.name !== asset.meta.importer && asset.meta.importer !== '*') &&
                    asset.imported)) {
                if (!asset.init) {
                    if (this.options.level >= 1) {
                        this.console.error(`Unable to import data, no suitable importer was found. {asset[${asset instanceof asset_1.Asset ? asset.basename : ''}](${asset.uuid})}`);
                    }
                    asset.invalid = true;
                    asset.init = true;
                }
                return false;
            }
            switch (asset.action) {
                case asset_1.AssetActionEnum.add: {
                    this.dataManager.empty(asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('added', asset);
                    break;
                }
                case asset_1.AssetActionEnum.change: {
                    this.dataManager.empty(asset);
                    // await TASK_MAP.destroy.exec(this, asset);
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, true)) {
                        await asset.save();
                    }
                    if (asset instanceof asset_1.Asset) {
                        const assetStats = (0, fs_extra_1.statSync)(asset.source);
                        this.infoManager.add(asset.source, assetStats.mtimeMs, asset.uuid);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('changed', asset);
                    break;
                }
                case asset_1.AssetActionEnum.delete: {
                    this.dataManager.empty(asset);
                    await task_1.TASK_MAP.destroy.exec(this, asset);
                    if (asset instanceof asset_1.Asset) {
                        const metaFile = asset.source + '.meta';
                        this.metaManager.remove(metaFile);
                        this.infoManager.remove(asset.source);
                        this.infoManager.remove(metaFile);
                    }
                    (0, manager_1.importAssociatedAssets)(this, asset);
                    // this.emit('deleted', asset);
                    break;
                }
                case asset_1.AssetActionEnum.none: {
                    if (await task_1.TASK_MAP.import.exec(this, asset, importer, false)) {
                        await asset.save();
                    }
                    break;
                }
            }
            asset.init = true;
            if (asset.action !== asset_1.AssetActionEnum.none) {
                this.dataManager.save();
            }
            asset.action = asset_1.AssetActionEnum.none;
            return true;
        }, this.options.importConcurrency || 5);
        // 全局可用的系统相关的管理器
        this.console = new console_1.CustomConsole(options.level);
        this.metaManager = new meta_1.MetaManager(this.console);
        this.infoManager = new info_1.InfoManager(this.console, this.options.target);
        this.dependencyManager = new dependency_1.DependencyManager(this.console, this.options.target);
        this.dataManager = new data_1.DataManager(this.console);
        this.importerManager = new importer_1.ImporterManager(this.console);
        // 注册默认的解析器
        this.importerManager.add(importer_1.DefaultImporter, ['*']);
        this.cachePath = (0, path_1.join)(this.options.library, `.${options.name}`);
    }
    async prepareStart() {
        if (!this.options.target || !this.options.library || !this.options.temp) {
            if (this.options.level >= 1) {
                this.console.error(`Parameter error, unable to start asset-db(${this.options.name}) with option ${this.options}.`);
            }
            return;
        }
        if (this.flag.started && this.options.level >= 2) {
            this.console.warn(`The ${this.options.name} database is already started.`);
            return;
        }
        this.flag.started = true;
        this.flag.starting = true;
        await this.infoManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-info.json`));
        await this.dataManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-data.json`));
        await this.dependencyManager.setRecordJSON((0, path_1.join)(this.options.library, `.${this.options.name}-dependency.json`));
        // 要在资源刷新前加入缓存
        manager_1.map[this.options.name] = this;
    }
    /**
     * 启动资源数据库
     */
    async start(options = {}) {
        await this.prepareStart();
        // 刷新资源数据库内的资源列表
        let num = await this.refresh(this.options.target, {
            ignoreSelf: true,
            hooks: options.hooks,
        });
        this.console.debug(`start asset-db(${this.options.name}) with asset: ${num}`);
        return new Promise((resolve) => {
            const step = () => {
                setTimeout(async () => {
                    if (!this.taskManager.busy()) {
                        this.flag.starting = false;
                        if (options.hooks && options.hooks.afterStart) {
                            try {
                                await options.hooks.afterStart();
                            }
                            catch (error) {
                                this.console.error(error);
                            }
                        }
                        await this.save();
                        return resolve(num);
                    }
                    this.taskManager.waitQueue().then(() => {
                        step();
                    });
                }, 10);
            };
            step();
        });
    }
    /**
     * 直接从缓存中恢复数据库，可能会失败抛异常
     * @returns
     */
    async startWithCache() {
        await this.prepareStart();
        await this.restoreFromCache();
    }
    async updateInfoManager() {
        let infoDirty = false;
        // 删除已经不存在的资源
        // mtime 记录的都是之前存在的文件，所以循环 mtime 管理器里的数据进行校验
        await this.infoManager.forEach(async (path, info) => {
            if (!this.path2asset.has(path) && this.infoManager.get(path).uuid) {
                try {
                    const uuid = info.uuid;
                    if (getAsset(uuid)) {
                        return;
                    }
                    const dir = `${this.options.library}${path_1.sep}${uuid.substr(0, 2)}`;
                    if ((0, fs_extra_1.existsSync)(dir)) {
                        const list = await (0, fs_extra_1.readdir)(dir);
                        for (let name of list) {
                            if (name.startsWith(uuid)) {
                                await (0, fs_extra_1.remove)((0, path_1.join)(dir, name));
                            }
                        }
                    }
                    this.infoManager.remove(path);
                    infoDirty = true;
                }
                catch (error) {
                    this.console.warn(error);
                }
            }
        });
        infoDirty && this.infoManager.save();
    }
    _generateRecordInfo() {
        return {
            version: AssetDB.version,
            data: {
                paths: Array.from(this.path2asset.keys()).map((path) => (0, path_1.relative)(this.options.target, path)),
            },
        };
    }
    async save() {
        try {
            // 保存记录的缓存信息
            await (0, fs_extra_1.writeJSON)((0, path_1.join)(this.cachePath), this._generateRecordInfo(), { spaces: 4 });
        }
        catch (error) {
            this.console.error(error);
            this.console.error(`Save cache for asset db ${this.options.name} failed.`);
        }
    }
    async restoreFromCache() {
        // 此处兼容旧版本格式，临时处理，后续需要引入记录文件的版本管理机制
        const cacheJSON = await (0, fs_extra_1.readJSON)(this.cachePath);
        const version = cacheJSON.version ? cacheJSON.version : '0.0.0';
        const migrator = new migrator_1.Migrator(migrations, AssetDB.version, {
            onError: (error, stage, data, ...args) => {
                this.console.warn(`Migrate error in asset-db ${this.options.name}`);
                this.console.warn(error);
            }
        });
        const recordInfo = await migrator.run(cacheJSON, version, [this]);
        await Promise.all(recordInfo.data.paths.map(async (relativePath) => {
            const path = (0, path_1.join)(this.options.target, relativePath);
            try {
                const metaFile = (0, path_1.join)(path + '.meta');
                const metaInfo = this.metaManager.get(metaFile);
                const asset = new asset_1.Asset(path, metaInfo.json, this);
                this.uuid2asset.set(asset.uuid, asset);
                this.path2asset.set(asset.source, asset);
            }
            catch (error) {
                this.console.error(`Restore asset ${path} from cache failed.`);
                this.console.error(error);
            }
        }));
    }
    /**
     * 停止资源数据库
     */
    async stop() {
        this.uuid2asset.clear();
        this.path2asset.clear();
        this.flag.started = false;
        this.infoManager.saveImmediate();
        this.dependencyManager.saveImmediate();
        this.dataManager.saveImmediate();
        this.metaManager.destroy();
        this.infoManager.destroy();
        this.dependencyManager.destroy();
        if (manager_1.map[this.options.name] === this) {
            delete manager_1.map[this.options.name];
        }
    }
    /**
     * 传入 path，返回 asset-db 内对应的 uuid
     * 不存在则返回 null
     * @param path
     */
    pathToUuid(path) {
        let asset = this.path2asset.get(path);
        if (!asset) {
            return null;
        }
        return asset.uuid;
    }
    /**
     * 传入 uuid，返回对应的资源的 path
     * @param uuid
     */
    uuidToPath(uuid) {
        let asset = this.uuid2asset.get(uuid);
        if (!asset) {
            return null;
        }
        return asset.source;
    }
    /**
     * 查询资源实例
     * @param uuid
     */
    getAsset(uuid) {
        if (!uuid || typeof uuid !== 'string') {
            return null;
        }
        let search = uuid.split('@');
        let id = search.shift() || '';
        let asset = this.uuid2asset.get(id);
        if (!asset) {
            return null;
        }
        for (let i = 0; i < search.length; i++) {
            let idOrName = search[i];
            asset = asset.subAssets[idOrName];
            if (!asset) {
                return null;
            }
        }
        return asset || null;
    }
    /**
     * 重新导入某个指定资源
     * @param fileOrUUID
     */
    async reimport(fileOrUUID) {
        const asset = this.path2asset.get(fileOrUUID) || this.getAsset(fileOrUUID);
        if (!asset) {
            return true;
        }
        // 暂时使用开关控制
        if (this.options.flags && this.options.flags.reimportCheck && !asset._lock && asset.action !== asset_1.AssetActionEnum.none) {
            return true;
        }
        // 需要先锁定，因为如果开始导入，init 还是 false，但资源已经被锁定，所以等待资源锁定状态结束，再开始导入
        await this.lock();
        // 强制重新触发查找 importer 的动作
        if (asset instanceof asset_1.Asset) {
            this.metaManager.read(asset.source + '.meta');
            const oldImporter = asset.meta.importer;
            asset.meta.importer = '*';
            const importer = await this.importerManager.find(asset);
            if (!importer) {
                throw new Error(`Unable to import data, no suitable importer was found.\n  path: ${asset.source}\n  uuid: ${asset.uuid}`);
            }
            else if (oldImporter === importer.name) {
                asset.meta.importer = importer.name;
            }
        }
        try {
            if (!asset.init) {
                this.unlock();
                return false;
            }
            asset.init = false;
            asset.action = asset_1.AssetActionEnum.change;
            asset.task = this.taskManager.addTask(asset);
        }
        catch (error) {
            this.console.error(error);
        }
        this.unlock();
        await this.taskManager.waitQueue();
    }
    /**
     * 刷新资源
     * 传入某一个文件或者文件夹，进行数据库刷新操作
     * 会优先同步扫描所有资源，然后等待其他 refresh 队列
     * 默认 refresh 是有队列的，多个 refresh 同时执行需要进入队列等待
     * @param path
     * @returns {number} 刷新的资源个数
     */
    async refresh(path, options = {}) {
        // 如果不是绝对路径，不刷新
        if (!(0, utils_1.absolutePath)(path)) {
            return 0;
        }
        path = (0, path_1.normalize)(path);
        // 如果是数据库文件夹，默认就忽略自己
        if (path === this.options.target) {
            options.ignoreSelf = true;
        }
        // 向上递归查询，查询自己的父级文件夹是否存在
        // 如果父文件夹不在 db 里，则自动加入
        let parentDir = (0, path_1.dirname)(path);
        while ((0, utils_1.isSubPath)(parentDir, this.options.target) && !this.path2asset.has(parentDir)) {
            path = parentDir;
            parentDir = (0, path_1.dirname)(parentDir);
        }
        // 检查是不是配置的 root 路径的子目录，如果不是子路径，则返回刷新 0 个资源
        if (!(0, utils_1.isSubPath)(path, this.options.target) && path !== this.options.target) {
            return 0;
        }
        let files = [];
        // 刷新路径不存在时可能是已被删除的资源需要更新数据库信息，不报错
        if ((0, fs_extra_1.existsSync)(path)) {
            try {
                const fileStat = (0, fs_extra_1.statSync)(path);
                if (fileStat.isFile()) {
                    files = [path];
                }
                else {
                    const globPath = process.platform === 'win32' ? path.replace(/\\/g, '/') : path;
                    // ! 要写绝对路径，否则可能在某些 win 机器上无法忽略文件
                    const search = options.globList || [
                        `**/*`,
                        `!**/*.meta`,
                    ];
                    if (this.options.globList) {
                        search.push(...this.options.globList);
                    }
                    files = fast_glob_1.default.sync(search, {
                        onlyFiles: false,
                        // 如果将 path 传入 search 数组，卢经理带有 () 就无法正确识别了，所以需要使用 cwd
                        cwd: globPath,
                        // dot: true,
                    });
                    files.forEach((file, index) => {
                        files[index] = (0, path_1.join)(globPath, file);
                    });
                    // 当扫描的路径不是根目录的时候，把被扫描的路径也检查一次
                    if (path !== this.options.target) {
                        files.splice(0, 0, path);
                    }
                }
            }
            catch (error) {
                this.console.error(error);
                files = [];
            }
        }
        // 文件分组，如果有多个组，会在上一个组导入完成后，才开始下一个组的导入流程
        if (options.hooks && options.hooks.afterScan) {
            try {
                await options.hooks.afterScan(files);
            }
            catch (error) {
                this.console.error(error);
            }
        }
        // 扫描文件到的文件记录
        const fileSet = new Set();
        const deleteSet = new Set();
        const addSet = new Set();
        try {
            const preAddFiles = [];
            const addFiles = [];
            const deleteFiles = [];
            if (this.preImporterHandler) {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        if (this.preImporterHandler(file)) {
                            preAddFiles.push(file);
                        }
                        else {
                            addFiles.push(file);
                        }
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            else {
                for (let file of files) {
                    if (!this.path2asset.has(file)) {
                        addFiles.push(file);
                        addSet.add(file);
                    }
                    fileSet.add(file);
                }
            }
            this.path2asset.forEach((asset, file) => {
                if (files.length === 0 || !fileSet.has(file)) {
                    if (file === path || (0, utils_1.isSubPath)(file, path)) {
                        deleteFiles.push(file);
                        deleteSet.add(file);
                    }
                }
            });
            this.taskManager.stop();
            // 判断添加的资源和移动、删除的资源
            this._checkAssetsStatSync(preAddFiles, deleteFiles, deleteSet);
            if (options.hooks && options.hooks.afterPreImport) {
                try {
                    await options.hooks.afterPreImport();
                }
                catch (error) {
                    this.console.error(error);
                }
            }
            this._checkAssetsStatSync(addFiles, deleteFiles, deleteSet);
            this.emit('refresh-uuid-ready', path);
            // 锁定任务栈
            await this.lock();
            // 没有改动的数据
            const tasks = [];
            for (let file of files) {
                if (!addSet.has(file) && !deleteSet.has(file)) {
                    const asset = this.path2asset.get(file);
                    if (asset) {
                        tasks.push(this._checkAssetStat(asset));
                    }
                }
            }
            // 使用 Promise.all 会导致部分资源问题导致全部资源都无法刷新
            const result = await Promise.allSettled(tasks);
            result.forEach((res) => {
                // 失败的任务需要报错
                if (res.status === 'rejected') {
                    console.error(res.reason);
                }
            });
        }
        catch (error) {
            this.console.error(error);
            this.unlock();
            return 0;
        }
        if (options.hooks && options.hooks.afterGenerateMete) {
            try {
                await options.hooks.afterGenerateMete();
            }
            catch (error) {
                this.console.error(error);
            }
        }
        this.taskManager.start();
        try {
            await this.taskManager.waitQueue();
        }
        catch (error) {
            this.console.error(error);
        }
        this.unlock();
        // 返回所有文件的个数
        const num = this.taskManager.total();
        this.taskManager.clear();
        if (options.hooks && options.hooks.afterRefresh) {
            try {
                await options.hooks.afterRefresh();
            }
            catch (error) {
                this.console.error(error);
            }
        }
        await this.updateInfoManager();
        await this.save();
        return num;
    }
    _replaceUUID(asset, oAsset) {
        if (oAsset !== asset) {
            if (asset.source === oAsset.source) {
                console.trace(`_replaceUUID invalid in asset ${asset.source}`);
                return;
            }
            const newUUID = (0, node_uuid_1.v4)();
            // 提示两个文件 uuid 冲突
            if (this.options.level >= 2) {
                let info = JSON.stringify([
                    asset.source,
                    oAsset.source,
                ], null, 2);
                this.console.warn(`The uuid is already pointing to another asset .\n${info}\nThe file uuid has been updated: ${asset.source}\n    ${asset.uuid} -> ${newUUID}`);
            }
            asset.meta.uuid = newUUID;
        }
    }
    /**
     * 检查资源状态
     * 识别是新增、修改还是删除了资源
     * @param addFiles
     * @param deleteFiles
     */
    _checkAssetsStatSync(addFiles, deleteFiles, deleteSet) {
        for (let file of deleteFiles) {
            // 毋庸置疑的删除文件
            const asset = this.path2asset.get(file);
            if (asset) {
                asset.action = asset_1.AssetActionEnum.delete;
                asset.task = this.taskManager.addTask(asset);
                this.uuid2asset.delete(asset.uuid);
                this.path2asset.delete(asset.source);
                const metaFile = asset.source + '.meta';
                this.metaManager.remove(metaFile);
                this.infoManager.remove(asset.source);
                this.infoManager.remove(metaFile);
            }
        }
        for (let file of addFiles) {
            // 获取 meta，没有的话直接生成
            const metaFile = file + '.meta';
            const metaInfo = this.metaManager.get(metaFile);
            const uuidCacheAsset = getAsset(metaInfo.json.uuid);
            // uuid 指向的文件被删除了，就是移动文件
            if (uuidCacheAsset) {
                if (deleteSet.has(uuidCacheAsset.source) ||
                    (uuidCacheAsset.source !== file &&
                        !(0, fs_extra_1.existsSync)(uuidCacheAsset.source))) {
                    const asset = uuidCacheAsset;
                    this.path2asset.delete(asset.source);
                    this.infoManager.remove(asset.source);
                    this.metaManager.remove(asset.source + '.meta');
                    this.infoManager.remove(asset.source + '.meta');
                    asset._source = file;
                    asset.extname = (0, path_1.extname)(file).toLowerCase();
                    asset.basename = (0, path_1.basename)(file, asset.extname);
                    asset.updateUrl();
                    asset.meta = metaInfo.json;
                    this.path2asset.set(asset.source, asset);
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
                // uuid 指向的文件没删除，识别为新建，但是 uuid 冲突了
                else {
                    const asset = new asset_1.Asset(file, metaInfo.json, this);
                    this._replaceUUID(asset, uuidCacheAsset);
                    asset.save();
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
            // 启动数据库，还原以前的资源
            else if (this.flag.starting) {
                const fileStat = (0, fs_extra_1.statSync)(file);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                    const metaStat = (0, fs_extra_1.statSync)(metaFile);
                    if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                        if (this.dataManager.has(asset)) {
                            asset.action = asset_1.AssetActionEnum.none;
                            asset.task = this.taskManager.addTask(asset);
                        }
                        else {
                            asset.action = asset_1.AssetActionEnum.change;
                            asset.task = this.taskManager.addTask(asset);
                        }
                    }
                    else {
                        // meta 被修改，就识别为先删后新增
                        this.emit('delete', asset);
                        this.emit('deleted', asset);
                        asset.action = asset_1.AssetActionEnum.add;
                        const uuid = asset.uuid;
                        this.metaManager.read(metaFile);
                        if (asset.uuid !== uuid) {
                            this.uuid2asset.delete(uuid);
                            if (this.uuid2asset.has(asset.uuid)) {
                                this._replaceUUID(asset, getAsset(asset.uuid));
                            }
                            this.uuid2asset.set(asset.uuid, asset);
                        }
                        this.infoManager.add(metaFile, metaStat.mtimeMs);
                        asset.task = this.taskManager.addTask(asset);
                    }
                }
                else {
                    asset.action = asset_1.AssetActionEnum.add;
                    this.infoManager.add(file, fileStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                }
                this.uuid2asset.set(asset.uuid, asset);
                this.path2asset.set(asset.source, asset);
            }
            // 普通新增
            else {
                const oAsset = getAsset(metaInfo.json.uuid);
                const asset = new asset_1.Asset(file, metaInfo.json, this);
                if (oAsset) {
                    this._replaceUUID(asset, oAsset);
                    asset.save();
                }
                const metaStat = (0, fs_extra_1.statSync)(metaFile);
                // 如果 metaFile 的缓存不存在，则添加进缓存
                if (!this.infoManager.get(metaFile)) {
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                }
                // 如果 metaFile 的缓存不一致，则判断为被修改
                if (this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
                    asset.action = asset_1.AssetActionEnum.add;
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
                else {
                    // 这种情况下，meta 被修改，都识别为先删除后新增
                    this.emit('delete', asset);
                    this.emit('deleted', asset);
                    asset.action = asset_1.AssetActionEnum.add;
                    const uuid = asset.uuid;
                    this.metaManager.read(metaFile);
                    if (asset.uuid !== uuid) {
                        this.uuid2asset.delete(uuid);
                    }
                    this.infoManager.add(metaFile, metaStat.mtimeMs);
                    asset.task = this.taskManager.addTask(asset);
                    this.uuid2asset.set(asset.uuid, asset);
                    this.path2asset.set(asset.source, asset);
                }
            }
        }
    }
    async _checkAssetStat(asset) {
        const file = asset.source;
        const metaFile = file + '.meta';
        if (!(0, fs_extra_1.existsSync)(metaFile)) {
            console.error(`${metaFile} is not exist! will use cache meta.`);
            asset.save();
        }
        const metaStat = await (0, fs_extra_1.stat)(metaFile);
        if (!await this.infoManager.compare(metaFile, metaStat.mtimeMs)) {
            this.emit('delete', asset);
            this.emit('deleted', asset);
            asset.action = asset_1.AssetActionEnum.add;
            const uuid = asset.uuid;
            this.metaManager.read(metaFile);
            if (asset.uuid !== uuid) {
                this.uuid2asset.delete(uuid);
                if (this.uuid2asset.has(asset.uuid)) {
                    this._replaceUUID(asset, getAsset(asset.uuid));
                }
                this.uuid2asset.set(asset.uuid, asset);
            }
            this.infoManager.add(metaFile, metaStat.mtimeMs);
            asset.task = this.taskManager.addTask(asset);
        }
        else {
            const fileStat = await (0, fs_extra_1.stat)(file);
            if (this.infoManager.compare(file, fileStat.mtimeMs)) {
                if (this.dataManager.has(asset)) {
                    asset.action = asset_1.AssetActionEnum.none;
                    asset.task = this.taskManager.addTask(asset);
                }
                else {
                    asset.action = asset_1.AssetActionEnum.change;
                    asset.task = this.taskManager.addTask(asset);
                }
            }
            else {
                // 更新 mtime 记录
                this.infoManager.add(file, fileStat.mtimeMs, asset.uuid);
                asset.action = asset_1.AssetActionEnum.change;
                asset.task = this.taskManager.addTask(asset);
            }
        }
    }
}
exports.AssetDB = AssetDB;
AssetDB.version = '1.0.1';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9hc3NldC1kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxZQUFZLENBQUM7Ozs7OztBQUViLHVDQUFtRztBQUNuRywrQkFBa0Y7QUFDbEYsbUNBQXNDO0FBQ3RDLHlDQUErQjtBQUUvQix5Q0FBOEQ7QUFDOUQsbUNBQStEO0FBQy9ELG1DQUFrRTtBQUNsRSxpQ0FBcUM7QUFDckMsaUNBQWlEO0FBQ2pELGlDQUFrQztBQUNsQyw2Q0FBaUQ7QUFDakQsaUNBQXFDO0FBQ3JDLHVDQUF3RDtBQUV4RCxtREFBK0M7QUFDL0MsMERBQTJCO0FBQzNCLHVDQUFvRDtBQUNwRCx5Q0FBK0M7QUFFL0MscUNBQWdDO0FBQXZCLDhGQUFBLEdBQUcsT0FBQTtBQUVaLFNBQVMsUUFBUSxDQUFDLElBQUk7SUFDbEIsS0FBSyxJQUFJLElBQUksSUFBSSxhQUFHLEVBQUU7UUFDbEIsTUFBTSxFQUFFLEdBQUcsYUFBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLElBQUksS0FBSyxFQUFFO1lBQ1AsT0FBTyxLQUFLLENBQUM7U0FDaEI7S0FDSjtJQUNELE9BQU8sU0FBUyxDQUFDO0FBQ3JCLENBQUM7QUFpRkQsSUFBSSxjQUFjLEdBQUcsS0FBSyxDQUFDO0FBRWQsUUFBQSxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBRS9CLE1BQU0sVUFBVSxHQUFtQixDQUFDO1FBQ2hDLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQ3hCLE9BQU87Z0JBQ0gsT0FBTyxFQUFFLE9BQU87Z0JBQ2hCLElBQUksRUFBRSxJQUFJO2FBQ2IsQ0FBQTtRQUNMLENBQUM7S0FDSixFQUFFO1FBQ0MsT0FB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QUN6RCxLQUFLLENBQUMsTUFBTSxHQUFHLHVCQUFlLENBQUMsTUFBTSxDQUFDO2dCQUN0QyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2hEO1NBQ0o7SUFDTCxDQUFDOztBQXoyQkwsMEJBMDJCQztBQXgyQm1CLGVBQU8sR0FBRyxPQUFPLEFBQVYsQ0FBVyIsInNvdXJjZXNDb250ZW50IjpbIlxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBTdGF0cywgc3RhdCwgc3RhdFN5bmMsIGV4aXN0c1N5bmMsIHJlYWRkaXIsIHJlbW92ZSwgd3JpdGVKU09OLCByZWFkSlNPTiB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IGpvaW4sIG5vcm1hbGl6ZSwgZGlybmFtZSwgc2VwLCBiYXNlbmFtZSwgZXh0bmFtZSwgcmVsYXRpdmUgfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyB2NCB9IGZyb20gJ25vZGUtdXVpZCc7XG5cbmltcG9ydCB7IEltcG9ydGVyTWFuYWdlciwgRGVmYXVsdEltcG9ydGVyIH0gZnJvbSAnLi9pbXBvcnRlcic7XG5pbXBvcnQgeyBBc3NldCwgVmlydHVhbEFzc2V0LCBBc3NldEFjdGlvbkVudW0gfSBmcm9tICcuL2Fzc2V0JztcbmltcG9ydCB7IGFic29sdXRlUGF0aCwgaXNTdWJQYXRoLCBjb21wYXJlVmVyc2lvbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgTWV0YU1hbmFnZXIgfSBmcm9tICcuL21ldGEnO1xuaW1wb3J0IHsgSW5mb01hbmFnZXIsIFNpbXBsZUluZm8gfSBmcm9tICcuL2luZm8nO1xuaW1wb3J0IHsgVEFTS19NQVAgfSBmcm9tICcuL3Rhc2snO1xuaW1wb3J0IHsgRGVwZW5kZW5jeU1hbmFnZXIgfSBmcm9tICcuL2RlcGVuZGVuY3knO1xuaW1wb3J0IHsgRGF0YU1hbmFnZXIgfSBmcm9tICcuL2RhdGEnO1xuaW1wb3J0IHsgaW1wb3J0QXNzb2NpYXRlZEFzc2V0cywgbWFwIH0gZnJvbSAnLi9tYW5hZ2VyJztcblxuaW1wb3J0IHsgUGFyYWxsZWxRdWV1ZSB9IGZyb20gJ3dvcmtmbG93LWV4dHJhJztcbmltcG9ydCBmZyBmcm9tICdmYXN0LWdsb2InO1xuaW1wb3J0IHsgQ3VzdG9tQ29uc29sZSwgTG9nTGV2ZWwgfSBmcm9tICcuL2NvbnNvbGUnO1xuaW1wb3J0IHsgTWlncmF0ZSwgTWlncmF0b3IgfSBmcm9tICcuL21pZ3JhdG9yJztcblxuZXhwb3J0IHsgbWFwIH0gZnJvbSAnLi9tYW5hZ2VyJztcblxuZnVuY3Rpb24gZ2V0QXNzZXQodXVpZCkge1xuICAgIGZvciAobGV0IG5hbWUgaW4gbWFwKSB7XG4gICAgICAgIGNvbnN0IGRiID0gbWFwW25hbWVdO1xuICAgICAgICBjb25zdCBhc3NldCA9IGRiLnV1aWQyYXNzZXQuZ2V0KHV1aWQpO1xuICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBhc3NldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2V0REJTdGFydE9wdGlvbnMge1xuICAgIC8vIOaYr+WQpuW/veeVpeiHquW3se+8jOm7mOiupCBmYWxzZVxuICAgIGlnbm9yZVNlbGY/OiBib29sZWFuO1xuICAgIGdsb2JMaXN0Pzogc3RyaW5nW107XG4gICAgLy8g5omr5o+P5oiQ5Yqf5ZCO562J5b6F5a6M5oiQ5LiA5Lqb5pON5L2cXG4gICAgaG9va3M/OiB7XG4gICAgICAgIC8vIOeUn+aIkCDotYTmupAgbWV0YSDkuYvlkI5cbiAgICAgICAgYWZ0ZXJHZW5lcmF0ZU1ldGU/KCk6IHZvaWQ7XG4gICAgICAgIC8vIOaJq+aPj+i1hOa6kOS5i+WQjlxuICAgICAgICBhZnRlclNjYW4/KGZpbGVzOiBzdHJpbmdbXSk6IHZvaWQ7XG4gICAgICAgIGFmdGVyUHJlSW1wb3J0PygpOiB2b2lkO1xuICAgICAgICAvLyDlnKjmlbDmja7lupPlkK/liqjkuYvlkI5cbiAgICAgICAgYWZ0ZXJTdGFydD8oKTogdm9pZDtcbiAgICB9O1xufVxuXG5pbnRlcmZhY2UgQXNzZXREQlJlY29yZEpTT04ge1xuICAgIHZlcnNpb246IHN0cmluZztcbiAgICBkYXRhOiB7XG4gICAgICAgIHBhdGhzOiBzdHJpbmdbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXNzZXREQlJlZnJlc2hPcHRpb25zIHtcbiAgICAvLyDmmK/lkKblv73nlaXoh6rlt7HvvIzpu5jorqQgZmFsc2VcbiAgICBpZ25vcmVTZWxmPzogYm9vbGVhbjtcbiAgICBnbG9iTGlzdD86IHN0cmluZ1tdO1xuICAgIHVzZUNhY2hlPzogYm9vbGVhbjtcbiAgICAvLyDmiavmj4/miJDlip/lkI7nrYnlvoXlrozmiJDkuIDkupvmk43kvZxcbiAgICBob29rcz86IHtcbiAgICAgICAgLy8g55Sf5oiQIOi1hOa6kCBtZXRhIOS5i+WQjlxuICAgICAgICBhZnRlckdlbmVyYXRlTWV0ZT8oKTogdm9pZDtcbiAgICAgICAgLy8g5omr5o+P6LWE5rqQ5LmL5ZCOXG4gICAgICAgIGFmdGVyU2Nhbj8oZmlsZXM6IHN0cmluZ1tdKTogdm9pZDtcbiAgICAgICAgYWZ0ZXJQcmVJbXBvcnQ/KCk6IHZvaWQ7XG4gICAgICAgIC8vIFRPRE8g55Sx5LqOIHJlZnJlc2gg6L+H56iL5Lit5Y+v6IO957un57ut5re75Yqg5paw55qEIHJlZnJlc2gg5Lu75Yqh77yM5Zug6ICM5q2k6ZKp5a2Q5LiN5YeG56GuXG4gICAgICAgIGFmdGVyUmVmcmVzaD8oKTogdm9pZDtcbiAgICB9O1xufVxuXG4vKipcbiAqIOi1hOa6kOaVsOaNruW6k+WQr+WKqOWPguaVsFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFzc2V0REJPcHRpb25zIHtcbiAgICAvLyDotYTmupDmlbDmja7lupPnmoTlkI3lrZdcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgLy8g6LWE5rqQ5pWw5o2u5bqT5Zyo56Gs55uY5LiK55qE57ud5a+56Lev5b6EXG4gICAgdGFyZ2V0OiBzdHJpbmc7XG4gICAgLy8g6LWE5rqQ5pWw5o2u5bqT5a+85YWl5ZCO55Sf5oiQ55qE5paH5Lu26Lev5b6EXG4gICAgbGlicmFyeTogc3RyaW5nO1xuICAgIC8vIOi1hOa6kOaVsOaNruW6k+eahOS4tOaXtuebruW9lVxuICAgIHRlbXA6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIDA6IOW/veeVpemUmeivr1xuICAgICAqIDE6IOS7heS7heaJk+WNsOmUmeivr1xuICAgICAqIDI6IOaJk+WNsOmUmeivr+OAgeitpuWRilxuICAgICAqIDM6IOaJk+WNsOmUmeivr+OAgeitpuWRiuOAgeaXpeW/l1xuICAgICAqIDQ6IOaJk+WNsOmUmeivr+OAgeitpuWRiuOAgeaXpeW/l+OAgeiwg+ivleS/oeaBr1xuICAgICAqL1xuICAgIGxldmVsOiBMb2dMZXZlbDtcblxuICAgIC8vIOW/veeVpeeahOaWh+S7tuWIl+ihqFxuICAgIGlnbm9yZUZpbGVzOiBzdHJpbmdbXSxcblxuICAgIC8vIOi1hOa6kOWMuemFjeiMg+WbtOeahCBnbG9iIOihqOi+vuW8j1xuICAgIGdsb2JMaXN0Pzogc3RyaW5nW107XG5cbiAgICAvLyDmmK/lkKblj6ror7vvvIzpu5jorqTmmK8gZmFsc2VcbiAgICByZWFkb25seTogYm9vbGVhbjtcblxuICAgIGZsYWdzPzoge1xuICAgICAgICByZWltcG9ydENoZWNrPzogYm9vbGVhbjtcbiAgICB9LFxuXG4gICAgLy8g5a+85YWl5bm25Y+R5pWw77yM6buY6K6k5Li6IDVcbiAgICBpbXBvcnRDb25jdXJyZW5jeT86IG51bWJlcjtcbn1cblxubGV0IGRlcHJlY2F0ZWRGbGFnID0gZmFsc2U7XG5cbmV4cG9ydCBjb25zdCB2ZXJzaW9uID0gJzIuMC4wJztcblxuY29uc3QgbWlncmF0aW9uczogTWlncmF0ZTxhbnk+W10gPSBbe1xuICAgIHZlcnNpb246ICcxLjAuMCcsXG4gICAgbWlncmF0ZTogYXN5bmMgKGpzb24sIGRiKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgICAgICAgZGF0YToganNvbixcbiAgICAgICAgfVxuICAgIH0sXG59LCB7XG4gICAgdmVyc2lvbjogJzEuMC4xJyxcbiAgICBtaWdyYXRlOiBhc3luYyAoanNvbiwgZGIpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZlcnNpb246ICcxLjAuMScsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgcGF0aHM6IGpzb24uZGF0YS5wYXRocy5tYXAocGF0aCA9PiByZWxhdGl2ZShkYi5vcHRpb25zLnRhcmdldCwgcGF0aCkpLFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbn1dO1xuXG5leHBvcnQgY2xhc3MgQXNzZXREQiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG5cbiAgICBzdGF0aWMgcmVhZG9ubHkgdmVyc2lvbiA9ICcxLjAuMSc7XG5cbiAgICAvLyDkvKDlhaXnmoTphY3nva7kv6Hmga9cbiAgICBvcHRpb25zOiBBc3NldERCT3B0aW9ucztcblxuICAgIC8vIOagh+iusFxuICAgIGZsYWcgPSB7XG4gICAgICAgIC8vIOaYr+WQpuato+WcqOWQr+WKqFxuICAgICAgICBzdGFydGluZzogZmFsc2UsXG4gICAgICAgIC8vIOaYr+WQpuW3sue7j+WQr+WKqOeahOagh+iusFxuICAgICAgICBzdGFydGVkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gcGF0aCDlr7nlupQgYXNzZXQg55qEIG1hcFxuICAgIHBhdGgyYXNzZXQ6IE1hcDxzdHJpbmcsIEFzc2V0PiA9IG5ldyBNYXA7XG5cbiAgICAvLyB1dWlkIOWvueW6lCBhc3NldCDnmoQgbWFwXG4gICAgdXVpZDJhc3NldDogTWFwPHN0cmluZywgQXNzZXQ+ID0gbmV3IE1hcDtcblxuICAgIC8vIGltcG9ydGVyIOeuoeeQhuWZqFxuICAgIGltcG9ydGVyTWFuYWdlcjtcbiAgICBtZXRhTWFuYWdlcjogTWV0YU1hbmFnZXI7XG4gICAgY29uc29sZTogQ3VzdG9tQ29uc29sZTtcbiAgICBpbmZvTWFuYWdlcjogSW5mb01hbmFnZXI7XG4gICAgZGVwZW5kZW5jeU1hbmFnZXI6IERlcGVuZGVuY3lNYW5hZ2VyO1xuICAgIHRhc2tNYW5hZ2VyOiBQYXJhbGxlbFF1ZXVlPFZpcnR1YWxBc3NldCwgYm9vbGVhbj47XG4gICAgZGF0YU1hbmFnZXI6IERhdGFNYW5hZ2VyO1xuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIEFzc2V0REIuZGF0YU1hbmFlciBpcyBkZXByZWNhdGVkLCBQbGVhc2UgdXNlIEFzc2V0REIuZGF0YU1hbmFnZXIgaW5zdGVhZC5cbiAgICAgKi9cbiAgICBnZXQgZGF0YU1hbmFlcigpIHtcbiAgICAgICAgaWYgKCFkZXByZWNhdGVkRmxhZykge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnQXNzZXREQi5kYXRhTWFuYWVyIGlzIGRlcHJlY2F0ZWQsIFBsZWFzZSB1c2UgQXNzZXREQi5kYXRhTWFuYWdlciBpbnN0ZWFkLicpO1xuICAgICAgICAgICAgZGVwcmVjYXRlZEZsYWcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIOWFvOWuueaXp+eJiOacrOeUqOazlVxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhTWFuYWdlcjtcbiAgICB9O1xuICAgIF9sb2NrOiBib29sZWFuID0gZmFsc2U7XG4gICAgX3dhaXRMb2NrSGFuZGxlcjogRnVuY3Rpb25bXSA9IFtdO1xuICAgIGNhY2hlUGF0aDogc3RyaW5nO1xuXG4gICAgZ2V0IGFzc2V0UHJvZ3Jlc3NJbmZvKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSBUT0RPIHRhc2tNYW5hZ2VyIOaYr+WQpuWPr+S7peaPkOS+m+atpOWtl+autVxuICAgICAgICAgICAgY3VycmVudDogdGhpcy50YXNrTWFuYWdlci5fZXhlY0lEIC0gdGhpcy50YXNrTWFuYWdlci5fZXhlY1RocmVhZCxcbiAgICAgICAgICAgIHRvdGFsOiB0aGlzLnRhc2tNYW5hZ2VyLnRvdGFsKCksXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE8gdGFza01hbmFnZXIg5piv5ZCm5Y+v5Lul5o+Q5L6b5q2k5a2X5q61XG4gICAgICAgICAgICB3YWl0OiB0aGlzLnRhc2tNYW5hZ2VyLl93YWl0UXVldWUuc2l6ZSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOmUgeWumui1hOa6kFxuICAgICAqL1xuICAgIHByaXZhdGUgYXN5bmMgbG9jaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9sb2NrKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9jayA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3dhaXRMb2NrSGFuZGxlci5wdXNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOino+mUgei1hOa6kFxuICAgICAqL1xuICAgIHByaXZhdGUgdW5sb2NrKCkge1xuICAgICAgICBjb25zdCBoYW5kbGUgPSB0aGlzLl93YWl0TG9ja0hhbmRsZXIuc2hpZnQoKTtcbiAgICAgICAgLy8g5aaC5p6c5pyJ562J5b6F55qE5Lu75Yqh77yM5YiZ5omn6KGM5LiL5LiA5LiqXG4gICAgICAgIGlmIChoYW5kbGUpIHtcbiAgICAgICAgICAgIGhhbmRsZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5bey57uP5rKh5pyJ5Zyo562J5b6F55qE5Lu75Yqh5LqG77yM6L+Y5Y6f5qCH6K6wXG4gICAgICAgIHRoaXMuX2xvY2sgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDlrp7kvovljJbov4fnqItcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBBc3NldERCT3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBpZiAoIW9wdGlvbnMudGFyZ2V0IHx8ICFvcHRpb25zLmxpYnJhcnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFRoZSBkYXRhYmFzZSgke29wdGlvbnMubmFtZX0pIGNhbm5vdCBiZSBjcmVhdGVkIGJlY2F1c2UgdGhlcmUgaXMgbm8gdGFyZ2V0IG9yIGxpYnJhcnkgZGVmaW5pdGlvbmApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3B0aW9ucy50YXJnZXQgPSBhYnNvbHV0ZVBhdGgob3B0aW9ucy50YXJnZXQpO1xuICAgICAgICAgICAgb3B0aW9ucy5saWJyYXJ5ID0gYWJzb2x1dGVQYXRoKG9wdGlvbnMubGlicmFyeSk7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMudGVtcCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGpvaW4ob3B0aW9ucy5saWJyYXJ5LCAnLnRlbXAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMudGVtcCA9IGFic29sdXRlUGF0aChvcHRpb25zLnRlbXApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g6K6+572u6L6T5Ye6562J57qnXG4gICAgICAgIGlmICghKCdsZXZlbCcgaW4gb3B0aW9ucykgfHwgb3B0aW9ucy5sZXZlbCA+IDQgfHwgb3B0aW9ucy5sZXZlbCA8IDApIHtcbiAgICAgICAgICAgIG9wdGlvbnMubGV2ZWwgPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmlnbm9yZUZpbGVzIHx8ICFBcnJheS5pc0FycmF5KG9wdGlvbnMuaWdub3JlRmlsZXMpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmlnbm9yZUZpbGVzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgICAgIC8vIOWQr+WKqOaVsOaNruW6k+WGhee9rueahOWQhOS4queuoeeQhuWZqOeuoeeQhuWZqFxuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyID0gbmV3IFBhcmFsbGVsUXVldWUoYXN5bmMgKGFzc2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbXBvcnRlciA9IGF3YWl0IHRoaXMuaW1wb3J0ZXJNYW5hZ2VyLmZpbmQoYXNzZXQpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICFpbXBvcnRlciB8fFxuICAgICAgICAgICAgICAgIC8vIOWIoOmZpOeahOaXtuWAmeW+iOWPr+iDveaWh+S7tuS4jeWtmOWcqO+8jOaJgOS7pSBpbXBvcnRlciDmnInkuIDlrprmpoLnjofmmK8gKu+8jOi/meaXtuWAmeWSjOWOn+acieeahOWvvOWFpeWZqOiCr+WumuS4jeWMuemFje+8jOaJgOS7peS4jemcgOimgeWkhOeQhuWIoOmZpFxuICAgICAgICAgICAgICAgIChhc3NldC5hY3Rpb24gIT09IEFzc2V0QWN0aW9uRW51bS5kZWxldGUgJiZcbiAgICAgICAgICAgICAgICAgICAgKGltcG9ydGVyLm5hbWUgIT09IGFzc2V0Lm1ldGEuaW1wb3J0ZXIgJiYgYXNzZXQubWV0YS5pbXBvcnRlciAhPT0gJyonKSAmJlxuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbXBvcnRlZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGlmICghYXNzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxldmVsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihgVW5hYmxlIHRvIGltcG9ydCBkYXRhLCBubyBzdWl0YWJsZSBpbXBvcnRlciB3YXMgZm91bmQuIHthc3NldFske2Fzc2V0IGluc3RhbmNlb2YgQXNzZXQgPyBhc3NldC5iYXNlbmFtZSA6ICcnfV0oJHthc3NldC51dWlkfSl9YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuaW52YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmluaXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXNzZXQuYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBBc3NldEFjdGlvbkVudW0uYWRkOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFnZXIuZW1wdHkoYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgVEFTS19NQVAuaW1wb3J0LmV4ZWModGhpcywgYXNzZXQsIGltcG9ydGVyLCB0cnVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXNzZXQuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0U3RhdHMgPSBzdGF0U3luYyhhc3NldC5zb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQoYXNzZXQuc291cmNlLCBhc3NldFN0YXRzLm10aW1lTXMsIGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydEFzc29jaWF0ZWRBc3NldHModGhpcywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmVtaXQoJ2FkZGVkJywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBBc3NldEFjdGlvbkVudW0uY2hhbmdlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFnZXIuZW1wdHkoYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCBUQVNLX01BUC5kZXN0cm95LmV4ZWModGhpcywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgVEFTS19NQVAuaW1wb3J0LmV4ZWModGhpcywgYXNzZXQsIGltcG9ydGVyLCB0cnVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXNzZXQuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0U3RhdHMgPSBzdGF0U3luYyhhc3NldC5zb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQoYXNzZXQuc291cmNlLCBhc3NldFN0YXRzLm10aW1lTXMsIGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydEFzc29jaWF0ZWRBc3NldHModGhpcywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmVtaXQoJ2NoYW5nZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIEFzc2V0QWN0aW9uRW51bS5kZWxldGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhTWFuYWdlci5lbXB0eShhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IFRBU0tfTUFQLmRlc3Ryb3kuZXhlYyh0aGlzLCBhc3NldCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFGaWxlID0gYXNzZXQuc291cmNlICsgJy5tZXRhJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVtb3ZlKG1ldGFGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0QXNzb2NpYXRlZEFzc2V0cyh0aGlzLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZW1pdCgnZGVsZXRlZCcsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgQXNzZXRBY3Rpb25FbnVtLm5vbmU6IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRBU0tfTUFQLmltcG9ydC5leGVjKHRoaXMsIGFzc2V0LCBpbXBvcnRlciwgZmFsc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuaW5pdCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoYXNzZXQuYWN0aW9uICE9PSBBc3NldEFjdGlvbkVudW0ubm9uZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YU1hbmFnZXIuc2F2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLm5vbmU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSwgdGhpcy5vcHRpb25zLmltcG9ydENvbmN1cnJlbmN5IHx8IDUpO1xuXG4gICAgICAgIC8vIOWFqOWxgOWPr+eUqOeahOezu+e7n+ebuOWFs+eahOeuoeeQhuWZqFxuICAgICAgICB0aGlzLmNvbnNvbGUgPSBuZXcgQ3VzdG9tQ29uc29sZShvcHRpb25zLmxldmVsKTtcbiAgICAgICAgdGhpcy5tZXRhTWFuYWdlciA9IG5ldyBNZXRhTWFuYWdlcih0aGlzLmNvbnNvbGUpO1xuICAgICAgICB0aGlzLmluZm9NYW5hZ2VyID0gbmV3IEluZm9NYW5hZ2VyKHRoaXMuY29uc29sZSwgdGhpcy5vcHRpb25zLnRhcmdldCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeU1hbmFnZXIgPSBuZXcgRGVwZW5kZW5jeU1hbmFnZXIodGhpcy5jb25zb2xlLCB0aGlzLm9wdGlvbnMudGFyZ2V0KTtcbiAgICAgICAgdGhpcy5kYXRhTWFuYWdlciA9IG5ldyBEYXRhTWFuYWdlcih0aGlzLmNvbnNvbGUpO1xuICAgICAgICB0aGlzLmltcG9ydGVyTWFuYWdlciA9IG5ldyBJbXBvcnRlck1hbmFnZXIodGhpcy5jb25zb2xlKTtcblxuICAgICAgICAvLyDms6jlhozpu5jorqTnmoTop6PmnpDlmahcbiAgICAgICAgdGhpcy5pbXBvcnRlck1hbmFnZXIuYWRkKERlZmF1bHRJbXBvcnRlciwgWycqJ10pO1xuXG4gICAgICAgIHRoaXMuY2FjaGVQYXRoID0gam9pbih0aGlzLm9wdGlvbnMubGlicmFyeSwgYC4ke29wdGlvbnMubmFtZX1gKTtcbiAgICB9XG5cbiAgICBwcmVJbXBvcnRlckhhbmRsZXI/KGZpbGU6IHN0cmluZyk6IGJvb2xlYW47XG5cbiAgICBwcml2YXRlIGFzeW5jIHByZXBhcmVTdGFydCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudGFyZ2V0IHx8ICF0aGlzLm9wdGlvbnMubGlicmFyeSB8fCAhdGhpcy5vcHRpb25zLnRlbXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGV2ZWwgPj0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihgUGFyYW1ldGVyIGVycm9yLCB1bmFibGUgdG8gc3RhcnQgYXNzZXQtZGIoJHt0aGlzLm9wdGlvbnMubmFtZX0pIHdpdGggb3B0aW9uICR7dGhpcy5vcHRpb25zfS5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmZsYWcuc3RhcnRlZCAmJiB0aGlzLm9wdGlvbnMubGV2ZWwgPj0gMikge1xuICAgICAgICAgICAgdGhpcy5jb25zb2xlLndhcm4oYFRoZSAke3RoaXMub3B0aW9ucy5uYW1lfSBkYXRhYmFzZSBpcyBhbHJlYWR5IHN0YXJ0ZWQuYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZsYWcuc3RhcnRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZmxhZy5zdGFydGluZyA9IHRydWU7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5pbmZvTWFuYWdlci5zZXRSZWNvcmRKU09OKGpvaW4odGhpcy5vcHRpb25zLmxpYnJhcnksIGAuJHt0aGlzLm9wdGlvbnMubmFtZX0taW5mby5qc29uYCkpO1xuICAgICAgICBhd2FpdCB0aGlzLmRhdGFNYW5hZ2VyLnNldFJlY29yZEpTT04oam9pbih0aGlzLm9wdGlvbnMubGlicmFyeSwgYC4ke3RoaXMub3B0aW9ucy5uYW1lfS1kYXRhLmpzb25gKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVwZW5kZW5jeU1hbmFnZXIuc2V0UmVjb3JkSlNPTihqb2luKHRoaXMub3B0aW9ucy5saWJyYXJ5LCBgLiR7dGhpcy5vcHRpb25zLm5hbWV9LWRlcGVuZGVuY3kuanNvbmApKTtcblxuICAgICAgICAvLyDopoHlnKjotYTmupDliLfmlrDliY3liqDlhaXnvJPlrZhcbiAgICAgICAgbWFwW3RoaXMub3B0aW9ucy5uYW1lXSA9IHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5ZCv5Yqo6LWE5rqQ5pWw5o2u5bqTXG4gICAgICovXG4gICAgYXN5bmMgc3RhcnQob3B0aW9uczogQXNzZXREQlN0YXJ0T3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGF3YWl0IHRoaXMucHJlcGFyZVN0YXJ0KCk7XG5cbiAgICAgICAgLy8g5Yi35paw6LWE5rqQ5pWw5o2u5bqT5YaF55qE6LWE5rqQ5YiX6KGoXG4gICAgICAgIGxldCBudW0gPSBhd2FpdCB0aGlzLnJlZnJlc2godGhpcy5vcHRpb25zLnRhcmdldCwge1xuICAgICAgICAgICAgaWdub3JlU2VsZjogdHJ1ZSxcbiAgICAgICAgICAgIGhvb2tzOiBvcHRpb25zLmhvb2tzLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNvbnNvbGUuZGVidWcoYHN0YXJ0IGFzc2V0LWRiKCR7dGhpcy5vcHRpb25zLm5hbWV9KSB3aXRoIGFzc2V0OiAke251bX1gKVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RlcCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnRhc2tNYW5hZ2VyLmJ1c3koKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFnLnN0YXJ0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ob29rcyAmJiBvcHRpb25zLmhvb2tzLmFmdGVyU3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcHRpb25zLmhvb2tzLmFmdGVyU3RhcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUobnVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLndhaXRRdWV1ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc3RlcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDnm7TmjqXku47nvJPlrZjkuK3mgaLlpI3mlbDmja7lupPvvIzlj6/og73kvJrlpLHotKXmipvlvILluLhcbiAgICAgKiBAcmV0dXJucyBcbiAgICAgKi9cbiAgICBhc3luYyBzdGFydFdpdGhDYWNoZSgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wcmVwYXJlU3RhcnQoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5yZXN0b3JlRnJvbUNhY2hlKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgdXBkYXRlSW5mb01hbmFnZXIoKSB7XG4gICAgICAgIGxldCBpbmZvRGlydHkgPSBmYWxzZTtcbiAgICAgICAgLy8g5Yig6Zmk5bey57uP5LiN5a2Y5Zyo55qE6LWE5rqQXG4gICAgICAgIC8vIG10aW1lIOiusOW9leeahOmDveaYr+S5i+WJjeWtmOWcqOeahOaWh+S7tu+8jOaJgOS7peW+queOryBtdGltZSDnrqHnkIblmajph4znmoTmlbDmja7ov5vooYzmoKHpqoxcbiAgICAgICAgYXdhaXQgdGhpcy5pbmZvTWFuYWdlci5mb3JFYWNoKGFzeW5jIChwYXRoOiBzdHJpbmcsIGluZm86IFNpbXBsZUluZm8pID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5wYXRoMmFzc2V0LmhhcyhwYXRoKSAmJiB0aGlzLmluZm9NYW5hZ2VyLmdldChwYXRoKS51dWlkKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IGluZm8udXVpZCBhcyBzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnZXRBc3NldCh1dWlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IGAke3RoaXMub3B0aW9ucy5saWJyYXJ5fSR7c2VwfSR7dXVpZC5zdWJzdHIoMCwgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IHJlYWRkaXIoZGlyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG5hbWUgb2YgbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgodXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVtb3ZlKGpvaW4oZGlyLCBuYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKHBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBpbmZvRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgaW5mb0RpcnR5ICYmIHRoaXMuaW5mb01hbmFnZXIuc2F2ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2dlbmVyYXRlUmVjb3JkSW5mbygpOiBBc3NldERCUmVjb3JkSlNPTiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2ZXJzaW9uOiBBc3NldERCLnZlcnNpb24sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgcGF0aHM6IEFycmF5LmZyb20odGhpcy5wYXRoMmFzc2V0LmtleXMoKSkubWFwKChwYXRoKSA9PiByZWxhdGl2ZSh0aGlzLm9wdGlvbnMudGFyZ2V0LCBwYXRoKSksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIOS/neWtmOiusOW9leeahOe8k+WtmOS/oeaBr1xuICAgICAgICAgICAgYXdhaXQgd3JpdGVKU09OKGpvaW4odGhpcy5jYWNoZVBhdGgpLCB0aGlzLl9nZW5lcmF0ZVJlY29yZEluZm8oKSwgeyBzcGFjZXM6IDQgfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoYFNhdmUgY2FjaGUgZm9yIGFzc2V0IGRiICR7dGhpcy5vcHRpb25zLm5hbWV9IGZhaWxlZC5gKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyByZXN0b3JlRnJvbUNhY2hlKCkge1xuICAgICAgICAvLyDmraTlpITlhbzlrrnml6fniYjmnKzmoLzlvI/vvIzkuLTml7blpITnkIbvvIzlkI7nu63pnIDopoHlvJXlhaXorrDlvZXmlofku7bnmoTniYjmnKznrqHnkIbmnLrliLZcbiAgICAgICAgY29uc3QgY2FjaGVKU09OID0gYXdhaXQgcmVhZEpTT04odGhpcy5jYWNoZVBhdGgpO1xuICAgICAgICBjb25zdCB2ZXJzaW9uID0gY2FjaGVKU09OLnZlcnNpb24gPyBjYWNoZUpTT04udmVyc2lvbiA6ICcwLjAuMCc7XG4gICAgICAgIGNvbnN0IG1pZ3JhdG9yID0gbmV3IE1pZ3JhdG9yPEFzc2V0REJSZWNvcmRKU09OPihtaWdyYXRpb25zLCBBc3NldERCLnZlcnNpb24sIHtcbiAgICAgICAgICAgIG9uRXJyb3I6IChlcnJvciwgc3RhZ2UsIGRhdGEsIC4uLmFyZ3MpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUud2FybihgTWlncmF0ZSBlcnJvciBpbiBhc3NldC1kYiAke3RoaXMub3B0aW9ucy5uYW1lfWApO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlY29yZEluZm8gPSBhd2FpdCBtaWdyYXRvci5ydW4oY2FjaGVKU09OLCB2ZXJzaW9uLCBbdGhpc10pO1xuXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHJlY29yZEluZm8uZGF0YS5wYXRocy5tYXAoYXN5bmMgKHJlbGF0aXZlUGF0aCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGpvaW4odGhpcy5vcHRpb25zLnRhcmdldCwgcmVsYXRpdmVQYXRoKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWV0YUZpbGUgPSBqb2luKHBhdGggKyAnLm1ldGEnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXRhSW5mbyA9IHRoaXMubWV0YU1hbmFnZXIuZ2V0KG1ldGFGaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IG5ldyBBc3NldChwYXRoLCBtZXRhSW5mby5qc29uLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoYFJlc3RvcmUgYXNzZXQgJHtwYXRofSBmcm9tIGNhY2hlIGZhaWxlZC5gKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5YGc5q2i6LWE5rqQ5pWw5o2u5bqTXG4gICAgICovXG4gICAgYXN5bmMgc3RvcCgpIHtcbiAgICAgICAgdGhpcy51dWlkMmFzc2V0LmNsZWFyKCk7XG4gICAgICAgIHRoaXMucGF0aDJhc3NldC5jbGVhcigpO1xuICAgICAgICB0aGlzLmZsYWcuc3RhcnRlZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuaW5mb01hbmFnZXIuc2F2ZUltbWVkaWF0ZSgpO1xuICAgICAgICB0aGlzLmRlcGVuZGVuY3lNYW5hZ2VyLnNhdmVJbW1lZGlhdGUoKTtcbiAgICAgICAgdGhpcy5kYXRhTWFuYWdlci5zYXZlSW1tZWRpYXRlKCk7XG5cbiAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuaW5mb01hbmFnZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmRlcGVuZGVuY3lNYW5hZ2VyLmRlc3Ryb3koKTtcblxuICAgICAgICBpZiAobWFwW3RoaXMub3B0aW9ucy5uYW1lXSA9PT0gdGhpcykge1xuICAgICAgICAgICAgZGVsZXRlIG1hcFt0aGlzLm9wdGlvbnMubmFtZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDkvKDlhaUgcGF0aO+8jOi/lOWbniBhc3NldC1kYiDlhoXlr7nlupTnmoQgdXVpZFxuICAgICAqIOS4jeWtmOWcqOWImei/lOWbniBudWxsXG4gICAgICogQHBhcmFtIHBhdGggXG4gICAgICovXG4gICAgcGF0aFRvVXVpZChwYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGFzc2V0ID0gdGhpcy5wYXRoMmFzc2V0LmdldChwYXRoKTtcbiAgICAgICAgaWYgKCFhc3NldCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFzc2V0LnV1aWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Lyg5YWlIHV1aWTvvIzov5Tlm57lr7nlupTnmoTotYTmupDnmoQgcGF0aFxuICAgICAqIEBwYXJhbSB1dWlkIFxuICAgICAqL1xuICAgIHV1aWRUb1BhdGgodXVpZDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBhc3NldCA9IHRoaXMudXVpZDJhc3NldC5nZXQodXVpZCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFzc2V0LnNvdXJjZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmn6Xor6LotYTmupDlrp7kvotcbiAgICAgKiBAcGFyYW0gdXVpZFxuICAgICAqL1xuICAgIGdldEFzc2V0KHV1aWQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXV1aWQgfHwgdHlwZW9mIHV1aWQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2VhcmNoID0gdXVpZC5zcGxpdCgnQCcpO1xuICAgICAgICBsZXQgaWQgPSBzZWFyY2guc2hpZnQoKSB8fCAnJztcblxuICAgICAgICBsZXQgYXNzZXQ6IFZpcnR1YWxBc3NldCB8IEFzc2V0IHwgdW5kZWZpbmVkID0gdGhpcy51dWlkMmFzc2V0LmdldChpZCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VhcmNoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaWRPck5hbWUgPSBzZWFyY2hbaV07XG4gICAgICAgICAgICBhc3NldCA9IGFzc2V0LnN1YkFzc2V0c1tpZE9yTmFtZV07XG4gICAgICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFzc2V0IHx8IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6YeN5paw5a+85YWl5p+Q5Liq5oyH5a6a6LWE5rqQXG4gICAgICogQHBhcmFtIGZpbGVPclVVSUQgXG4gICAgICovXG4gICAgYXN5bmMgcmVpbXBvcnQoZmlsZU9yVVVJRDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGFzc2V0OiBBc3NldCB8IFZpcnR1YWxBc3NldCB8IG51bGwgPSB0aGlzLnBhdGgyYXNzZXQuZ2V0KGZpbGVPclVVSUQpIHx8IHRoaXMuZ2V0QXNzZXQoZmlsZU9yVVVJRCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5pqC5pe25L2/55So5byA5YWz5o6n5Yi2XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmxhZ3MgJiYgdGhpcy5vcHRpb25zLmZsYWdzLnJlaW1wb3J0Q2hlY2sgJiYgIWFzc2V0Ll9sb2NrICYmIGFzc2V0LmFjdGlvbiAhPT0gQXNzZXRBY3Rpb25FbnVtLm5vbmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIOmcgOimgeWFiOmUgeWumu+8jOWboOS4uuWmguaenOW8gOWni+WvvOWFpe+8jGluaXQg6L+Y5pivIGZhbHNl77yM5L2G6LWE5rqQ5bey57uP6KKr6ZSB5a6a77yM5omA5Lul562J5b6F6LWE5rqQ6ZSB5a6a54q25oCB57uT5p2f77yM5YaN5byA5aeL5a+85YWlXG4gICAgICAgIGF3YWl0IHRoaXMubG9jaygpO1xuXG4gICAgICAgIC8vIOW8uuWItumHjeaWsOinpuWPkeafpeaJviBpbXBvcnRlciDnmoTliqjkvZxcbiAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVhZChhc3NldC5zb3VyY2UgKyAnLm1ldGEnKTtcbiAgICAgICAgICAgIGNvbnN0IG9sZEltcG9ydGVyID0gYXNzZXQubWV0YS5pbXBvcnRlcjtcbiAgICAgICAgICAgIGFzc2V0Lm1ldGEuaW1wb3J0ZXIgPSAnKic7XG4gICAgICAgICAgICBjb25zdCBpbXBvcnRlciA9IGF3YWl0IHRoaXMuaW1wb3J0ZXJNYW5hZ2VyLmZpbmQoYXNzZXQpO1xuICAgICAgICAgICAgaWYgKCFpbXBvcnRlcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGltcG9ydCBkYXRhLCBubyBzdWl0YWJsZSBpbXBvcnRlciB3YXMgZm91bmQuXFxuICBwYXRoOiAke2Fzc2V0LnNvdXJjZX1cXG4gIHV1aWQ6ICR7YXNzZXQudXVpZH1gKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2xkSW1wb3J0ZXIgPT09IGltcG9ydGVyLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBhc3NldC5tZXRhLmltcG9ydGVyID0gaW1wb3J0ZXIubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIWFzc2V0LmluaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVubG9jaygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzc2V0LmluaXQgPSBmYWxzZTtcbiAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U7XG4gICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51bmxvY2soKTtcblxuICAgICAgICBhd2FpdCB0aGlzLnRhc2tNYW5hZ2VyLndhaXRRdWV1ZSgpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yi35paw6LWE5rqQXG4gICAgICog5Lyg5YWl5p+Q5LiA5Liq5paH5Lu25oiW6ICF5paH5Lu25aS577yM6L+b6KGM5pWw5o2u5bqT5Yi35paw5pON5L2cXG4gICAgICog5Lya5LyY5YWI5ZCM5q2l5omr5o+P5omA5pyJ6LWE5rqQ77yM54S25ZCO562J5b6F5YW25LuWIHJlZnJlc2gg6Zif5YiXXG4gICAgICog6buY6K6kIHJlZnJlc2gg5piv5pyJ6Zif5YiX55qE77yM5aSa5LiqIHJlZnJlc2gg5ZCM5pe25omn6KGM6ZyA6KaB6L+b5YWl6Zif5YiX562J5b6FXG4gICAgICogQHBhcmFtIHBhdGggXG4gICAgICogQHJldHVybnMge251bWJlcn0g5Yi35paw55qE6LWE5rqQ5Liq5pWwXG4gICAgICovXG4gICAgYXN5bmMgcmVmcmVzaChwYXRoOiBzdHJpbmcsIG9wdGlvbnM6IEFzc2V0REJSZWZyZXNoT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgLy8g5aaC5p6c5LiN5piv57ud5a+56Lev5b6E77yM5LiN5Yi35pawXG4gICAgICAgIGlmICghYWJzb2x1dGVQYXRoKHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpO1xuXG4gICAgICAgIC8vIOWmguaenOaYr+aVsOaNruW6k+aWh+S7tuWkue+8jOm7mOiupOWwseW/veeVpeiHquW3sVxuICAgICAgICBpZiAocGF0aCA9PT0gdGhpcy5vcHRpb25zLnRhcmdldCkge1xuICAgICAgICAgICAgb3B0aW9ucy5pZ25vcmVTZWxmID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWQkeS4iumAkuW9kuafpeivou+8jOafpeivouiHquW3seeahOeItue6p+aWh+S7tuWkueaYr+WQpuWtmOWcqFxuICAgICAgICAvLyDlpoLmnpzniLbmlofku7blpLnkuI3lnKggZGIg6YeM77yM5YiZ6Ieq5Yqo5Yqg5YWlXG4gICAgICAgIGxldCBwYXJlbnREaXIgPSBkaXJuYW1lKHBhdGgpO1xuICAgICAgICB3aGlsZSAoaXNTdWJQYXRoKHBhcmVudERpciwgdGhpcy5vcHRpb25zLnRhcmdldCkgJiYgIXRoaXMucGF0aDJhc3NldC5oYXMocGFyZW50RGlyKSkge1xuICAgICAgICAgICAgcGF0aCA9IHBhcmVudERpcjtcbiAgICAgICAgICAgIHBhcmVudERpciA9IGRpcm5hbWUocGFyZW50RGlyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOajgOafpeaYr+S4jeaYr+mFjee9rueahCByb290IOi3r+W+hOeahOWtkOebruW9le+8jOWmguaenOS4jeaYr+WtkOi3r+W+hO+8jOWImei/lOWbnuWIt+aWsCAwIOS4qui1hOa6kFxuICAgICAgICBpZiAoIWlzU3ViUGF0aChwYXRoLCB0aGlzLm9wdGlvbnMudGFyZ2V0KSAmJiBwYXRoICE9PSB0aGlzLm9wdGlvbnMudGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIC8vIOWIt+aWsOi3r+W+hOS4jeWtmOWcqOaXtuWPr+iDveaYr+W3suiiq+WIoOmZpOeahOi1hOa6kOmcgOimgeabtOaWsOaVsOaNruW6k+S/oeaBr++8jOS4jeaKpemUmVxuICAgICAgICBpZiAoZXhpc3RzU3luYyhwYXRoKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlU3RhdCA9IHN0YXRTeW5jKHBhdGgpO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlU3RhdC5pc0ZpbGUoKSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlcyA9IFtwYXRoXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBnbG9iUGF0aCA9IHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicgPyBwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKSA6IHBhdGg7XG4gICAgICAgICAgICAgICAgICAgIC8vICEg6KaB5YaZ57ud5a+56Lev5b6E77yM5ZCm5YiZ5Y+v6IO95Zyo5p+Q5LqbIHdpbiDmnLrlmajkuIrml6Dms5Xlv73nlaXmlofku7ZcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0gb3B0aW9ucy5nbG9iTGlzdCB8fCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBgKiovKmAsXG4gICAgICAgICAgICAgICAgICAgICAgICBgISoqLyoubWV0YWAsXG4gICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZ2xvYkxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaC5wdXNoKC4uLnRoaXMub3B0aW9ucy5nbG9iTGlzdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmlsZXMgPSBmZy5zeW5jKHNlYXJjaCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25seUZpbGVzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOWwhiBwYXRoIOS8oOWFpSBzZWFyY2gg5pWw57uE77yM5Y2i57uP55CG5bim5pyJICgpIOWwseaXoOazleato+ehruivhuWIq+S6hu+8jOaJgOS7pemcgOimgeS9v+eUqCBjd2RcbiAgICAgICAgICAgICAgICAgICAgICAgIGN3ZDogZ2xvYlBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkb3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1tpbmRleF0gPSBqb2luKGdsb2JQYXRoLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8g5b2T5omr5o+P55qE6Lev5b6E5LiN5piv5qC555uu5b2V55qE5pe25YCZ77yM5oqK6KKr5omr5o+P55qE6Lev5b6E5Lmf5qOA5p+l5LiA5qyhXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXRoICE9PSB0aGlzLm9wdGlvbnMudGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlcy5zcGxpY2UoMCwgMCwgcGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgZmlsZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyDmlofku7bliIbnu4TvvIzlpoLmnpzmnInlpJrkuKrnu4TvvIzkvJrlnKjkuIrkuIDkuKrnu4Tlr7zlhaXlrozmiJDlkI7vvIzmiY3lvIDlp4vkuIvkuIDkuKrnu4TnmoTlr7zlhaXmtYHnqItcbiAgICAgICAgaWYgKG9wdGlvbnMuaG9va3MgJiYgb3B0aW9ucy5ob29rcy5hZnRlclNjYW4pIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgb3B0aW9ucy5ob29rcy5hZnRlclNjYW4oZmlsZXMpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g5omr5o+P5paH5Lu25Yiw55qE5paH5Lu26K6w5b2VXG4gICAgICAgIGNvbnN0IGZpbGVTZXQ6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICAgICAgICBjb25zdCBkZWxldGVTZXQ6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICAgICAgICBjb25zdCBhZGRTZXQ6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcmVBZGRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGFkZEZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgZGVsZXRlRmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBpZiAodGhpcy5wcmVJbXBvcnRlckhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXRoMmFzc2V0LmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJlSW1wb3J0ZXJIYW5kbGVyKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlQWRkRmlsZXMucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRmlsZXMucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFNldC5hZGQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmlsZVNldC5hZGQoZmlsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXRoMmFzc2V0LmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRmlsZXMucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFNldC5hZGQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmlsZVNldC5hZGQoZmlsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuZm9yRWFjaCgoYXNzZXQsIGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09PSAwIHx8ICFmaWxlU2V0LmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZSA9PT0gcGF0aCB8fCBpc1N1YlBhdGgoZmlsZSwgcGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVTZXQuYWRkKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudGFza01hbmFnZXIuc3RvcCgpO1xuXG4gICAgICAgICAgICAvLyDliKTmlq3mt7vliqDnmoTotYTmupDlkoznp7vliqjjgIHliKDpmaTnmoTotYTmupBcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrQXNzZXRzU3RhdFN5bmMocHJlQWRkRmlsZXMsIGRlbGV0ZUZpbGVzLCBkZWxldGVTZXQpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuaG9va3MgJiYgb3B0aW9ucy5ob29rcy5hZnRlclByZUltcG9ydCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG9wdGlvbnMuaG9va3MuYWZ0ZXJQcmVJbXBvcnQoKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2NoZWNrQXNzZXRzU3RhdFN5bmMoYWRkRmlsZXMsIGRlbGV0ZUZpbGVzLCBkZWxldGVTZXQpO1xuXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZnJlc2gtdXVpZC1yZWFkeScsIHBhdGgpO1xuXG4gICAgICAgICAgICAvLyDplIHlrprku7vliqHmoIhcbiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9jaygpO1xuXG4gICAgICAgICAgICAvLyDmsqHmnInmlLnliqjnmoTmlbDmja5cbiAgICAgICAgICAgIGNvbnN0IHRhc2tzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgICAgIGlmICghYWRkU2V0LmhhcyhmaWxlKSAmJiAhZGVsZXRlU2V0LmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMucGF0aDJhc3NldC5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFza3MucHVzaCh0aGlzLl9jaGVja0Fzc2V0U3RhdChhc3NldCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5L2/55SoIFByb21pc2UuYWxsIOS8muWvvOiHtOmDqOWIhui1hOa6kOmXrumimOWvvOiHtOWFqOmDqOi1hOa6kOmDveaXoOazleWIt+aWsFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHRhc2tzKTtcbiAgICAgICAgICAgIHJlc3VsdC5mb3JFYWNoKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAvLyDlpLHotKXnmoTku7vliqHpnIDopoHmiqXplJlcbiAgICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gJ3JlamVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlcy5yZWFzb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy51bmxvY2soKTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaG9va3MgJiYgb3B0aW9ucy5ob29rcy5hZnRlckdlbmVyYXRlTWV0ZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBvcHRpb25zLmhvb2tzLmFmdGVyR2VuZXJhdGVNZXRlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLnN0YXJ0KCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudGFza01hbmFnZXIud2FpdFF1ZXVlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51bmxvY2soKTtcblxuICAgICAgICAvLyDov5Tlm57miYDmnInmlofku7bnmoTkuKrmlbBcbiAgICAgICAgY29uc3QgbnVtID0gdGhpcy50YXNrTWFuYWdlci50b3RhbCgpO1xuICAgICAgICB0aGlzLnRhc2tNYW5hZ2VyLmNsZWFyKCk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaG9va3MgJiYgb3B0aW9ucy5ob29rcy5hZnRlclJlZnJlc2gpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgb3B0aW9ucy5ob29rcy5hZnRlclJlZnJlc2goKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW5mb01hbmFnZXIoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlKCk7XG4gICAgICAgIHJldHVybiBudW07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcmVwbGFjZVVVSUQoYXNzZXQ6IEFzc2V0LCBvQXNzZXQ6IEFzc2V0KSB7XG4gICAgICAgIGlmIChvQXNzZXQgIT09IGFzc2V0KSB7XG4gICAgICAgICAgICBpZiAoYXNzZXQuc291cmNlID09PSBvQXNzZXQuc291cmNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50cmFjZShgX3JlcGxhY2VVVUlEIGludmFsaWQgaW4gYXNzZXQgJHthc3NldC5zb3VyY2V9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV3VVVJRCA9IHY0KCk7XG4gICAgICAgICAgICAvLyDmj5DnpLrkuKTkuKrmlofku7YgdXVpZCDlhrLnqoFcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGV2ZWwgPj0gMikge1xuICAgICAgICAgICAgICAgIGxldCBpbmZvID0gSlNPTi5zdHJpbmdpZnkoW1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5zb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgIG9Bc3NldC5zb3VyY2UsXG4gICAgICAgICAgICAgICAgXSwgbnVsbCwgMik7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLndhcm4oYFRoZSB1dWlkIGlzIGFscmVhZHkgcG9pbnRpbmcgdG8gYW5vdGhlciBhc3NldCAuXFxuJHtpbmZvfVxcblRoZSBmaWxlIHV1aWQgaGFzIGJlZW4gdXBkYXRlZDogJHthc3NldC5zb3VyY2V9XFxuICAgICR7YXNzZXQudXVpZH0gLT4gJHtuZXdVVUlEfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQubWV0YS51dWlkID0gbmV3VVVJRDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOajgOafpei1hOa6kOeKtuaAgVxuICAgICAqIOivhuWIq+aYr+aWsOWinuOAgeS/ruaUuei/mOaYr+WIoOmZpOS6hui1hOa6kFxuICAgICAqIEBwYXJhbSBhZGRGaWxlc1xuICAgICAqIEBwYXJhbSBkZWxldGVGaWxlc1xuICAgICAqL1xuICAgIHByaXZhdGUgX2NoZWNrQXNzZXRzU3RhdFN5bmMoYWRkRmlsZXM6IHN0cmluZ1tdLCBkZWxldGVGaWxlczogc3RyaW5nW10sIGRlbGV0ZVNldDogU2V0PHN0cmluZz4pIHtcbiAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBkZWxldGVGaWxlcykge1xuICAgICAgICAgICAgLy8g5q+L5bq4572u55aR55qE5Yig6Zmk5paH5Lu2XG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMucGF0aDJhc3NldC5nZXQoZmlsZSk7XG4gICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uZGVsZXRlO1xuICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5kZWxldGUoYXNzZXQudXVpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LmRlbGV0ZShhc3NldC5zb3VyY2UpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgbWV0YUZpbGUgPSBhc3NldC5zb3VyY2UgKyAnLm1ldGEnO1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YU1hbmFnZXIucmVtb3ZlKG1ldGFGaWxlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLnJlbW92ZShhc3NldC5zb3VyY2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKG1ldGFGaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGFkZEZpbGVzKSB7XG4gICAgICAgICAgICAvLyDojrflj5YgbWV0Ye+8jOayoeacieeahOivneebtOaOpeeUn+aIkFxuICAgICAgICAgICAgY29uc3QgbWV0YUZpbGUgPSBmaWxlICsgJy5tZXRhJztcbiAgICAgICAgICAgIGNvbnN0IG1ldGFJbmZvID0gdGhpcy5tZXRhTWFuYWdlci5nZXQobWV0YUZpbGUpO1xuICAgICAgICAgICAgY29uc3QgdXVpZENhY2hlQXNzZXQgPSBnZXRBc3NldChtZXRhSW5mby5qc29uLnV1aWQpO1xuICAgICAgICAgICAgLy8gdXVpZCDmjIflkJHnmoTmlofku7booqvliKDpmaTkuobvvIzlsLHmmK/np7vliqjmlofku7ZcbiAgICAgICAgICAgIGlmICh1dWlkQ2FjaGVBc3NldCkge1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlU2V0Lmhhcyh1dWlkQ2FjaGVBc3NldC5zb3VyY2UpIHx8XG4gICAgICAgICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWRDYWNoZUFzc2V0LnNvdXJjZSAhPT0gZmlsZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgIWV4aXN0c1N5bmModXVpZENhY2hlQXNzZXQuc291cmNlKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gdXVpZENhY2hlQXNzZXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5kZWxldGUoYXNzZXQuc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5yZW1vdmUoYXNzZXQuc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5yZW1vdmUoYXNzZXQuc291cmNlICsgJy5tZXRhJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIucmVtb3ZlKGFzc2V0LnNvdXJjZSArICcubWV0YScpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5fc291cmNlID0gZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuZXh0bmFtZSA9IGV4dG5hbWUoZmlsZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYmFzZW5hbWUgPSBiYXNlbmFtZShmaWxlLCBhc3NldC5leHRuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudXBkYXRlVXJsKCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0Lm1ldGEgPSBtZXRhSW5mby5qc29uO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uY2hhbmdlO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC50YXNrID0gdGhpcy50YXNrTWFuYWdlci5hZGRUYXNrKGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gdXVpZCDmjIflkJHnmoTmlofku7bmsqHliKDpmaTvvIzor4bliKvkuLrmlrDlu7rvvIzkvYbmmK8gdXVpZCDlhrLnqoHkuoZcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzZXQgPSBuZXcgQXNzZXQoZmlsZSwgbWV0YUluZm8uanNvbiwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCB1dWlkQ2FjaGVBc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmFkZDtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOWQr+WKqOaVsOaNruW6k++8jOi/mOWOn+S7peWJjeeahOi1hOa6kFxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5mbGFnLnN0YXJ0aW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZVN0YXQgPSBzdGF0U3luYyhmaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IG5ldyBBc3NldChmaWxlLCBtZXRhSW5mby5qc29uLCB0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZm9NYW5hZ2VyLmNvbXBhcmUoZmlsZSwgZmlsZVN0YXQubXRpbWVNcykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWV0YVN0YXQgPSBzdGF0U3luYyhtZXRhRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZm9NYW5hZ2VyLmNvbXBhcmUobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhTWFuYWdlci5oYXMoYXNzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLm5vbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtZXRhIOiiq+S/ruaUue+8jOWwseivhuWIq+S4uuWFiOWIoOWQjuaWsOWinlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGUnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXVpZCA9IGFzc2V0LnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0LnV1aWQgIT09IHV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuZGVsZXRlKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnV1aWQyYXNzZXQuaGFzKGFzc2V0LnV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBnZXRBc3NldChhc3NldC51dWlkKSEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvTWFuYWdlci5hZGQobWV0YUZpbGUsIG1ldGFTdGF0Lm10aW1lTXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5hY3Rpb24gPSBBc3NldEFjdGlvbkVudW0uYWRkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChmaWxlLCBmaWxlU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aDJhc3NldC5zZXQoYXNzZXQuc291cmNlLCBhc3NldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOaZrumAmuaWsOWinlxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb0Fzc2V0ID0gZ2V0QXNzZXQobWV0YUluZm8uanNvbi51dWlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NldCA9IG5ldyBBc3NldChmaWxlLCBtZXRhSW5mby5qc29uLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAob0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcGxhY2VVVUlEKGFzc2V0LCBvQXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFTdGF0ID0gc3RhdFN5bmMobWV0YUZpbGUpO1xuXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6cIG1ldGFGaWxlIOeahOe8k+WtmOS4jeWtmOWcqO+8jOWImea3u+WKoOi/m+e8k+WtmFxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbmZvTWFuYWdlci5nZXQobWV0YUZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyDlpoLmnpwgbWV0YUZpbGUg55qE57yT5a2Y5LiN5LiA6Ie077yM5YiZ5Yik5pat5Li66KKr5L+u5pS5XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5mb01hbmFnZXIuY29tcGFyZShtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcykpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmFkZDtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXVpZDJhc3NldC5zZXQoYXNzZXQudXVpZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGgyYXNzZXQuc2V0KGFzc2V0LnNvdXJjZSwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOi/meenjeaDheWGteS4i++8jG1ldGEg6KKr5L+u5pS577yM6YO96K+G5Yir5Li65YWI5Yig6Zmk5ZCO5paw5aKeXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZGVsZXRlJywgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RlbGV0ZWQnLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5hZGQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHV1aWQgPSBhc3NldC51dWlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFNYW5hZ2VyLnJlYWQobWV0YUZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQudXVpZCAhPT0gdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LmRlbGV0ZSh1dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9NYW5hZ2VyLmFkZChtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcyk7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoMmFzc2V0LnNldChhc3NldC5zb3VyY2UsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9jaGVja0Fzc2V0U3RhdChhc3NldDogQXNzZXQpIHtcblxuICAgICAgICBjb25zdCBmaWxlID0gYXNzZXQuc291cmNlO1xuICAgICAgICBjb25zdCBtZXRhRmlsZSA9IGZpbGUgKyAnLm1ldGEnO1xuICAgICAgICBpZiAoIWV4aXN0c1N5bmMobWV0YUZpbGUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGAke21ldGFGaWxlfSBpcyBub3QgZXhpc3QhIHdpbGwgdXNlIGNhY2hlIG1ldGEuYCk7XG4gICAgICAgICAgICBhc3NldC5zYXZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWV0YVN0YXQgPSBhd2FpdCBzdGF0KG1ldGFGaWxlKTtcblxuICAgICAgICBpZiAoIWF3YWl0IHRoaXMuaW5mb01hbmFnZXIuY29tcGFyZShtZXRhRmlsZSwgbWV0YVN0YXQubXRpbWVNcykpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZGVsZXRlJywgYXNzZXQpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkZWxldGVkJywgYXNzZXQpO1xuICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLmFkZDtcbiAgICAgICAgICAgIGNvbnN0IHV1aWQgPSBhc3NldC51dWlkO1xuICAgICAgICAgICAgdGhpcy5tZXRhTWFuYWdlci5yZWFkKG1ldGFGaWxlKTtcbiAgICAgICAgICAgIGlmIChhc3NldC51dWlkICE9PSB1dWlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51dWlkMmFzc2V0LmRlbGV0ZSh1dWlkKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy51dWlkMmFzc2V0Lmhhcyhhc3NldC51dWlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXBsYWNlVVVJRChhc3NldCwgZ2V0QXNzZXQoYXNzZXQudXVpZCkhKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnV1aWQyYXNzZXQuc2V0KGFzc2V0LnV1aWQsIGFzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKG1ldGFGaWxlLCBtZXRhU3RhdC5tdGltZU1zKTtcbiAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZmlsZVN0YXQgPSBhd2FpdCBzdGF0KGZpbGUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5mb01hbmFnZXIuY29tcGFyZShmaWxlLCBmaWxlU3RhdC5tdGltZU1zKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGFNYW5hZ2VyLmhhcyhhc3NldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuYWN0aW9uID0gQXNzZXRBY3Rpb25FbnVtLm5vbmU7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnRhc2sgPSB0aGlzLnRhc2tNYW5hZ2VyLmFkZFRhc2soYXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g5pu05pawIG10aW1lIOiusOW9lVxuICAgICAgICAgICAgICAgIHRoaXMuaW5mb01hbmFnZXIuYWRkKGZpbGUsIGZpbGVTdGF0Lm10aW1lTXMsIGFzc2V0LnV1aWQpO1xuICAgICAgICAgICAgICAgIGFzc2V0LmFjdGlvbiA9IEFzc2V0QWN0aW9uRW51bS5jaGFuZ2U7XG4gICAgICAgICAgICAgICAgYXNzZXQudGFzayA9IHRoaXMudGFza01hbmFnZXIuYWRkVGFzayhhc3NldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=