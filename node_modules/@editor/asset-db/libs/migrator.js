"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Migrator=void 0;const utils_1=require("./utils");class Migrator{constructor(r,o,t){this.migrations=r,this.lastedVersion=o,this.hook=t,(null===t||void 0===t?void 0:t.onError)&&(this.onError=t.onError)}async run(r,o,t){if(o===this.lastedVersion)return r;if(this.hook&&this.hook.pre)try{await this.hook.pre(r)}catch(o){this.onError(o,"preMigrate",r,...t||[])}let i=r;for(const r of this.migrations){if(!((0,utils_1.compareVersion)(o,r.version)>0))try{console.debug(`Migration: -> ${r.version}`),i=await r.migrate(i,...t||[])}catch(r){this.onError(r,"migrate",i,...t||[])}}if(this.hook&&this.hook.post)try{await this.hook.post(r)}catch(o){this.onError(o,"postMigrate",r,...t||[])}return i}onError(r,o,t,...i){console.error(`Migrate error in ${o}`),console.error(r)}}exports.Migrator=Migrator;