'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.DefaultImporter = exports.Importer = exports.ImporterManager = void 0;
const path_1 = require("path");
const asset_1 = require("./asset");
/**
 * 导入器管理器
 */
class ImporterManager {
    constructor(customConsole) {
        // extname 与 importer 的 map
        this.extname2importer = {};
        // name 与 importer 的 map
        this.name2importer = {};
        this.console = customConsole || console;
    }
    /**
     * 新增一个导入器
     * @param importer
     * @param extnames
     */
    add(importer, extnames) {
        const instance = new importer();
        if (!(instance instanceof Importer)) {
            this.console.warn(`Cannot register the importer [${importer.name}].`);
            return;
        }
        // 如果已经存在同名的导入器则跳过
        if (instance.name !== '*' &&
            this.name2importer[instance.name] &&
            this.name2importer[instance.name] !== instance) {
            this.console.warn(`The importer[${importer.name}] is registered.`);
            return;
        }
        // 将注册的扩展名放到导入器的扩展名列表里
        extnames && extnames.forEach((extname) => {
            extname = extname.toLowerCase();
            let array = this.extname2importer[extname] = this.extname2importer[extname] || [];
            if (array.indexOf(instance) === -1) {
                this.extname2importer[extname].push(instance);
                instance.extnames.push(extname);
            }
        });
        // 加入 name map
        this.name2importer[instance.name] = instance;
    }
    /**
     * 删除一个导入器
     * @param importer
     */
    remove(importer) {
        const instance = this.name2importer[importer.name];
        instance.extnames.forEach((extname) => {
            // 检查 extname map，并删除数据
            let array = this.extname2importer[extname];
            if (!array) {
                return true;
            }
            let index = array.indexOf(instance);
            if (index === -1) {
                return true;
            }
            array.splice(index, 1);
        });
        delete this.name2importer[importer.name];
        return true;
    }
    /**
     * 清空所有的 importer
     */
    clear() {
        this.name2importer = {};
        this.extname2importer = {};
    }
    /**
     * 查找可以导入某个扩展名的所有导入器
     */
    async find(asset) {
        // 如果 importer 不是通用导入器，则尝试使用标记的导入器
        if (asset.meta.importer && asset.meta.importer !== '*') {
            const importer = this.name2importer[asset.meta.importer];
            if (asset instanceof asset_1.Asset) {
                if (importer
                    && importer.extnames.indexOf(asset.extname) !== -1
                    && await importer.validate(asset)) {
                    return importer;
                }
            }
            else {
                if (importer
                    && await importer.validate(asset)) {
                    return importer;
                }
            }
        }
        // 如果不能使用记录的导入器，则尝试查找其他导入器
        if (asset instanceof asset_1.Asset) {
            const importerArray = this.extname2importer[asset.extname] || [];
            for (let i = importerArray.length - 1; i >= 0; i--) {
                try {
                    const validate = await importerArray[i].validate(asset);
                    if (validate) {
                        return importerArray[i];
                    }
                }
                catch (error) {
                    this.console.error(`Importer validate failed: ${asset.uuid}`);
                    this.console.error(error);
                }
            }
        }
        // 如果还是没有找到匹配的导入器，则尝试使用通用导入器
        const importerArray = this.extname2importer['*'];
        for (let i = importerArray.length - 1; i >= 0; i--) {
            try {
                const validate = await importerArray[i].validate(asset);
                if (validate) {
                    return importerArray[i];
                }
            }
            catch (error) {
                this.console.error(`Importer validate failed: ${asset.uuid}`);
                this.console.error(error);
            }
        }
        // 如果连通用导入器都无能为力，那就返回 null
        return null;
    }
}
exports.ImporterManager = ImporterManager;
/**
 * 导入器
 * 需要负责检查文件是否使用该导入器导入资源
 * 资源导入的流程：
 *   1. 将 asset 当作 raw asset ，直接改名复制到 library 文件夹
 *   2. importer 作者自定义的
 */
class Importer {
    constructor() {
        // #region --- 兼容旧版本与新版本用法，旧版本使用 get 新版本需要允许在构造器内初始化这些信息
        this._name = '*';
        this._version = '0.0.1';
        this._versionCode = 0;
        this._migrationHook = {
            pre() { },
            post() { },
        };
        this._migrations = [];
        // 存储当前的 import 注册了多少个扩展名
        // 主要用于检索在 asset db 内的索引
        this.extnames = [];
        // 附加到 importer 上的标记
        this.flag = {};
    }
    // #endregion --- 
    // 版本号，导入前会判断，导入后会更新版本号到 meta 内
    // 如果不一致，则会删除导入的数据，强制重新执行导入
    get version() {
        return this._version;
    }
    // 版本号数值，如果与缓存不一致会重新导入
    get versionCode() {
        return this._versionCode;
    }
    // 版本迁移队列
    get migrations() {
        return this._migrations;
    }
    // 数据迁移钩子函数
    get migrationHook() {
        return this._migrationHook;
    }
    // importer 的名字
    get name() {
        return this._name;
    }
    /**
     * 检查文件是否适用于这个 importer
     * @param asset
     */
    async validate(asset) {
        return !asset.isDirectory();
    }
    /**
     * 是否强制刷新
     * @param asset
     */
    async force(asset) {
        return false;
    }
    /**
     * 开始执行文件的导入操作
     *   1. 将文件复制到 library 内
     *
     * 返回是否导入成功的标记
     * 如果返回 false，则 imported 标记不会变成 true
     * 后续的一系列操作都不会执行
     *
     * @param asset
     */
    async import(asset) {
        // 如果是虚拟资源，直接返回 false
        if (!(asset instanceof asset_1.Asset)) {
            return true;
        }
        // 扩展名，如 .json
        let ext = (0, path_1.extname)(asset.source).toLowerCase(); // 注意，这里会把所有后缀统一改成小写
        // 复制 raw asset
        await asset.copyToLibrary(ext, asset.source);
        return true;
    }
}
exports.Importer = Importer;
class DefaultImporter extends Importer {
    /**
     * 检查文件是否适用于这个 importer
     * @param asset
     */
    async validate(asset) {
        return true;
    }
    /**
     * 开始执行文件的导入操作
     *   1. 将文件复制到 library 内
     *
     * 返回是否导入成功的标记
     * 如果返回 false，则 imported 标记不会变成 true
     * 后续的一系列操作都不会执行
     *
     * @param asset
     */
    async import(asset) {
        // 如果是虚拟资源，直接返回 false
        if (!(asset instanceof asset_1.Asset)) {
            return true;
        }
        // 扩展名，如 .json
        let ext = (0, path_1.extname)(asset.source);
        // 导入对象是文件夹，则直接跳过
        if (await asset.isDirectory()) {
            return true;
        }
        // 复制 raw asset
        await asset.copyToLibrary(ext, asset.source);
        return true;
    }
}
exports.DefaultImporter = DefaultImporter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1wb3J0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbGlicy9pbXBvcnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7OztBQUViLCtCQUErQjtBQUMvQixtQ0FBOEM7QUFzQjlDOztHQUVHO0FBQ0gsTUFBYSxlQUFlO0lBU3hCLFlBQVksYUFBNEI7UUFQeEMsMkJBQTJCO1FBQzNCLHFCQUFnQixHQUFvQyxFQUFFLENBQUM7UUFFdkQsd0JBQXdCO1FBQ3hCLGtCQUFhLEdBQWtDLEVBQUUsQ0FBQztRQUk5QyxJQUFJLENBQUMsT0FBTyxHQUFHLGFBQWEsSUFBSSxPQUFPLENBQUM7SUFDNUMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxHQUFHLENBQUMsUUFBeUIsRUFBRSxRQUFrQjtRQUU3QyxNQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBRWhDLElBQUksQ0FBQyxDQUFDLFFBQVEsWUFBWSxRQUFRLENBQUMsRUFBRTtZQUNqQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsUUFBUSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7WUFDdEUsT0FBTztTQUNWO1FBRUQsa0JBQWtCO1FBQ2xCLElBQ0ksUUFBUSxDQUFDLElBQUksS0FBSyxHQUFHO1lBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNqQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxRQUFRLEVBQ2hEO1lBQ0UsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLFFBQVEsQ0FBQyxJQUFJLGtCQUFrQixDQUFDLENBQUM7WUFDbkUsT0FBTztTQUNWO1FBRUQsc0JBQXNCO1FBQ3RCLFFBQVEsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDckMsT0FBTyxHQUFHLE9BQU8s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QyxLQUFLLFlBQVksYUFBSyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELGNBQWM7UUFDZCxJQUFJLEdBQUcsR0FBRyxJQUFBLGNBQU8sRUFBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxvQkFBb0I7UUFFbkUsZUFBZTtRQUNmLE1BQU0sS0FBSyxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FJSjtBQXhGRCw0QkF3RkM7QUFFRCxNQUFhLGVBQWdCLFNBQVEsUUFBUTtJQUV6Qzs7O09BR0c7SUFDSCxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQTJCO1FBQ3RDLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQTJCO1FBQ3BDLHFCQUFxQjtRQUNyQixJQUFJLENBQUMsQ0FBQyxLQUFLLFlBQVksYUFBSyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELGNBQWM7UUFDZCxJQUFJLEdBQUcsR0FBRyxJQUFBLGNBQU8sRUFBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFaEMsaUJBQWlCO1FBQ2pCLElBQUksTUFBTSxLQUFLLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELGVBQWU7UUFDZixNQUFNLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM3QyxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0NBQ0o7QUF0Q0QsMENBc0NDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBleHRuYW1lIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBWaXJ0dWFsQXNzZXQsIEFzc2V0IH0gZnJvbSAnLi9hc3NldCc7XG5cbmltcG9ydCB7IEN1c3RvbUNvbnNvbGUgfSBmcm9tICcuL2NvbnNvbGUnO1xuXG4vKipcbiAqIOi/geenu+mYn+WIl1xuICovXG5leHBvcnQgaW50ZXJmYWNlIE1pZ3JhdGUge1xuICAgIHZlcnNpb246IHN0cmluZztcbiAgICBtaWdyYXRlPzogRnVuY3Rpb247XG59XG5cbi8qKlxuICog5a+85YWl5Zmo5a+85YWl5rWB56iL55qE6ZKp5a2Q5Ye95pWwXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTWlncmF0ZUhvb2sge1xuICAgIC8vIOi/geenu+S5i+WJjVxuICAgIHByZShhc3NldDogQXNzZXQgfCBWaXJ0dWFsQXNzZXQpO1xuICAgIC8vIOi/geenu+S5i+WQjlxuICAgIHBvc3QoYXNzZXQ6IEFzc2V0IHwgVmlydHVhbEFzc2V0LCBudW06IG51bWJlcik7XG59XG5cbi8qKlxuICog5a+85YWl5Zmo566h55CG5ZmoXG4gKi9cbmV4cG9ydCBjbGFzcyBJbXBvcnRlck1hbmFnZXIge1xuXG4gICAgLy8gZXh0bmFtZSDkuI4gaW1wb3J0ZXIg55qEIG1hcFxuICAgIGV4dG5hbWUyaW1wb3J0ZXI6IHsgW2luZGV4OiBzdHJpbmddOiBbSW1wb3J0ZXJdIH0gPSB7fTtcblxuICAgIC8vIG5hbWUg5LiOIGltcG9ydGVyIOeahCBtYXBcbiAgICBuYW1lMmltcG9ydGVyOiB7IFtpbmRleDogc3RyaW5nXTogSW1wb3J0ZXIgfSA9IHt9O1xuXG4gICAgcHJpdmF0ZSBjb25zb2xlOiBDdXN0b21Db25zb2xlO1xuICAgIGNvbnN0cnVjdG9yKGN1c3RvbUNvbnNvbGU6IEN1c3RvbUNvbnNvbGUpIHtcbiAgICAgICAgdGhpcy5jb25zb2xlID0gY3VzdG9tQ29uc29sZSB8fCBjb25zb2xlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOaWsOWinuS4gOS4quWvvOWFpeWZqFxuICAgICAqIEBwYXJhbSBpbXBvcnRlciBcbiAgICAgKiBAcGFyYW0gZXh0bmFtZXMgXG4gICAgICovXG4gICAgYWRkKGltcG9ydGVyOiB0eXBlb2YgSW1wb3J0ZXIsIGV4dG5hbWVzOiBzdHJpbmdbXSkge1xuXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IGltcG9ydGVyKCk7XG5cbiAgICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBJbXBvcnRlcikpIHtcbiAgICAgICAgICAgIHRoaXMuY29uc29sZS53YXJuKGBDYW5ub3QgcmVnaXN0ZXIgdGhlIGltcG9ydGVyIFske2ltcG9ydGVyLm5hbWV9XS5gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOW3sue7j+WtmOWcqOWQjOWQjeeahOWvvOWFpeWZqOWImei3s+i/h1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBpbnN0YW5jZS5uYW1lICE9PSAnKicgJiZcbiAgICAgICAgICAgIHRoaXMubmFtZTJpbXBvcnRlcltpbnN0YW5jZS5uYW1lXSAmJlxuICAgICAgICAgICAgdGhpcy5uYW1lMmltcG9ydGVyW2luc3RhbmNlLm5hbWVdICE9PSBpbnN0YW5jZVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMuY29uc29sZS53YXJuKGBUaGUgaW1wb3J0ZXJbJHtpbXBvcnRlci5uYW1lfV0gaXMgcmVnaXN0ZXJlZC5gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWwhuazqOWGjOeahOaJqeWxleWQjeaUvuWIsOWvvOWFpeWZqOeahOaJqeWxleWQjeWIl+ihqOmHjFxuICAgICAgICBleHRuYW1lcyAmJiBleHRuYW1lcy5mb3JFYWNoKChleHRuYW1lKSA9PiB7XG4gICAgICAgICAgICBleHRuYW1lID0gZXh0bmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgbGV0IGFycmF5ID0gdGhpcy5leHRuYW1lMmltcG9ydGVyW2V4dG5hbWVdID0gdGhpcy5leHRuYW1lMmltcG9ydGVyW2V4dG5hbWVdIHx8IFtdO1xuICAgICAgICAgICAgaWYgKGFycmF5LmluZGV4T2YoaW5zdGFuY2UpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXh0bmFtZTJpbXBvcnRlcltleHRuYW1lXS5wdXNoKGluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5leHRuYW1lcy5wdXNoKGV4dG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyDliqDlhaUgbmFtZSBtYXBcbiAgICAgICAgdGhpcy5uYW1lMmltcG9ydGVyW2luc3RhbmNlLm5hbWVdID0gaW5zdGFuY2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yig6Zmk5LiA5Liq5a+85YWl5ZmoXG4gICAgICogQHBhcmFtIGltcG9ydGVyIFxuICAgICAqL1xuICAgIHJlbW92ZShpbXBvcnRlcjogdHlwZW9mIEltcG9ydGVyKSB7XG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5uYW1lMmltcG9ydGVyW2ltcG9ydGVyLm5hbWVdO1xuXG4gICAgICAgIGluc3RhbmNlLmV4dG5hbWVzLmZvckVhY2goKGV4dG5hbWUpID0+IHtcbiAgICAgICAgICAgIC8vIOajgOafpSBleHRuYW1lIG1hcO+8jOW5tuWIoOmZpOaVsOaNrlxuICAgICAgICAgICAgbGV0IGFycmF5ID0gdGhpcy5leHRuYW1lMmltcG9ydGVyW2V4dG5hbWVdO1xuICAgICAgICAgICAgaWYgKCFhcnJheSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGluZGV4ID0gYXJyYXkuaW5kZXhPZihpbnN0YW5jZSk7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcnJheS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZWxldGUgdGhpcy5uYW1lMmltcG9ydGVyW2ltcG9ydGVyLm5hbWVdO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOa4heepuuaJgOacieeahCBpbXBvcnRlclxuICAgICAqL1xuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLm5hbWUyaW1wb3J0ZXIgPSB7fTtcbiAgICAgICAgdGhpcy5leHRuYW1lMmltcG9ydGVyID0ge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5p+l5om+5Y+v5Lul5a+85YWl5p+Q5Liq5omp5bGV5ZCN55qE5omA5pyJ5a+85YWl5ZmoXG4gICAgICovXG4gICAgYXN5bmMgZmluZChhc3NldDogVmlydHVhbEFzc2V0IHwgQXNzZXQpIHtcbiAgICAgICAgLy8g5aaC5p6cIGltcG9ydGVyIOS4jeaYr+mAmueUqOWvvOWFpeWZqO+8jOWImeWwneivleS9v+eUqOagh+iusOeahOWvvOWFpeWZqFxuICAgICAgICBpZiAoYXNzZXQubWV0YS5pbXBvcnRlciAmJiBhc3NldC5tZXRhLmltcG9ydGVyICE9PSAnKicpIHtcbiAgICAgICAgICAgIGNvbnN0IGltcG9ydGVyID0gdGhpcy5uYW1lMmltcG9ydGVyW2Fzc2V0Lm1ldGEuaW1wb3J0ZXJdO1xuICAgICAgICAgICAgaWYgKGFzc2V0IGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGltcG9ydGVyXG4gICAgICAgICAgICAgICAgICAgICYmIGltcG9ydGVyLmV4dG5hbWVzLmluZGV4T2YoYXNzZXQuZXh0bmFtZSkgIT09IC0xXG4gICAgICAgICAgICAgICAgICAgICYmIGF3YWl0IGltcG9ydGVyLnZhbGlkYXRlKGFzc2V0KVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW1wb3J0ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGltcG9ydGVyXG4gICAgICAgICAgICAgICAgICAgICYmIGF3YWl0IGltcG9ydGVyLnZhbGlkYXRlKGFzc2V0KVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW1wb3J0ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g5aaC5p6c5LiN6IO95L2/55So6K6w5b2V55qE5a+85YWl5Zmo77yM5YiZ5bCd6K+V5p+l5om+5YW25LuW5a+85YWl5ZmoXG4gICAgICAgIGlmIChhc3NldCBpbnN0YW5jZW9mIEFzc2V0KSB7XG4gICAgICAgICAgICBjb25zdCBpbXBvcnRlckFycmF5ID0gdGhpcy5leHRuYW1lMmltcG9ydGVyW2Fzc2V0LmV4dG5hbWVdIHx8IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGltcG9ydGVyQXJyYXkubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZSA9IGF3YWl0IGltcG9ydGVyQXJyYXlbaV0udmFsaWRhdGUoYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbXBvcnRlckFycmF5W2ldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKGBJbXBvcnRlciB2YWxpZGF0ZSBmYWlsZWQ6ICR7YXNzZXQudXVpZH1gKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlpoLmnpzov5jmmK/msqHmnInmib7liLDljLnphY3nmoTlr7zlhaXlmajvvIzliJnlsJ3or5Xkvb/nlKjpgJrnlKjlr7zlhaXlmahcbiAgICAgICAgY29uc3QgaW1wb3J0ZXJBcnJheSA9IHRoaXMuZXh0bmFtZTJpbXBvcnRlclsnKiddO1xuICAgICAgICBmb3IgKGxldCBpID0gaW1wb3J0ZXJBcnJheS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZSA9IGF3YWl0IGltcG9ydGVyQXJyYXlbaV0udmFsaWRhdGUoYXNzZXQpO1xuICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW1wb3J0ZXJBcnJheVtpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcihgSW1wb3J0ZXIgdmFsaWRhdGUgZmFpbGVkOiAke2Fzc2V0LnV1aWR9YCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOi/numAmueUqOWvvOWFpeWZqOmDveaXoOiDveS4uuWKm++8jOmCo+Wwsei/lOWbniBudWxsXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuLyoqXG4gKiDlr7zlhaXlmahcbiAqIOmcgOimgei0n+i0o+ajgOafpeaWh+S7tuaYr+WQpuS9v+eUqOivpeWvvOWFpeWZqOWvvOWFpei1hOa6kFxuICog6LWE5rqQ5a+85YWl55qE5rWB56iL77yaXG4gKiAgIDEuIOWwhiBhc3NldCDlvZPkvZwgcmF3IGFzc2V0IO+8jOebtOaOpeaUueWQjeWkjeWItuWIsCBsaWJyYXJ5IOaWh+S7tuWkuVxuICogICAyLiBpbXBvcnRlciDkvZzogIXoh6rlrprkuYnnmoRcbiAqL1xuZXhwb3J0IGNsYXNzIEltcG9ydGVyIHtcblxuICAgIC8vICNyZWdpb24gLS0tIOWFvOWuueaXp+eJiOacrOS4juaWsOeJiOacrOeUqOazle+8jOaXp+eJiOacrOS9v+eUqCBnZXQg5paw54mI5pys6ZyA6KaB5YWB6K645Zyo5p6E6YCg5Zmo5YaF5Yid5aeL5YyW6L+Z5Lqb5L+h5oGvXG4gICAgX25hbWUgPSAnKic7XG4gICAgX3ZlcnNpb24gPSAnMC4wLjEnO1xuICAgIF92ZXJzaW9uQ29kZSA9IDA7XG4gICAgX21pZ3JhdGlvbkhvb2s6IE1pZ3JhdGVIb29rID0ge1xuICAgICAgICBwcmUoKSB7IH0sXG4gICAgICAgIHBvc3QoKSB7IH0sXG4gICAgfTtcbiAgICBfbWlncmF0aW9uczogTWlncmF0ZVtdID0gW107XG4gICAgLy8gI2VuZHJlZ2lvbiAtLS0gXG5cbiAgICAvLyDniYjmnKzlj7fvvIzlr7zlhaXliY3kvJrliKTmlq3vvIzlr7zlhaXlkI7kvJrmm7TmlrDniYjmnKzlj7fliLAgbWV0YSDlhoVcbiAgICAvLyDlpoLmnpzkuI3kuIDoh7TvvIzliJnkvJrliKDpmaTlr7zlhaXnmoTmlbDmja7vvIzlvLrliLbph43mlrDmiafooYzlr7zlhaVcbiAgICBnZXQgdmVyc2lvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247XG4gICAgfVxuXG4gICAgLy8g54mI5pys5Y+35pWw5YC877yM5aaC5p6c5LiO57yT5a2Y5LiN5LiA6Ie05Lya6YeN5paw5a+85YWlXG4gICAgZ2V0IHZlcnNpb25Db2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbkNvZGU7XG4gICAgfVxuXG4gICAgLy8g5a2Y5YKo5b2T5YmN55qEIGltcG9ydCDms6jlhozkuoblpJrlsJHkuKrmianlsZXlkI1cbiAgICAvLyDkuLvopoHnlKjkuo7mo4DntKLlnKggYXNzZXQgZGIg5YaF55qE57Si5byVXG4gICAgZXh0bmFtZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyDpmYTliqDliLAgaW1wb3J0ZXIg5LiK55qE5qCH6K6wXG4gICAgZmxhZzogeyBbbmFtZTogc3RyaW5nXTogYm9vbGVhbiB9ID0ge307XG5cbiAgICAvLyDniYjmnKzov4Hnp7vpmJ/liJdcbiAgICBnZXQgbWlncmF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21pZ3JhdGlvbnM7XG4gICAgfVxuXG4gICAgLy8g5pWw5o2u6L+B56e76ZKp5a2Q5Ye95pWwXG4gICAgZ2V0IG1pZ3JhdGlvbkhvb2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9taWdyYXRpb25Ib29rO1xuICAgIH1cblxuICAgIC8vIGltcG9ydGVyIOeahOWQjeWtl1xuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmo4Dmn6Xmlofku7bmmK/lkKbpgILnlKjkuo7ov5nkuKogaW1wb3J0ZXJcbiAgICAgKiBAcGFyYW0gYXNzZXRcbiAgICAgKi9cbiAgICBhc3luYyB2YWxpZGF0ZShhc3NldDogVmlydHVhbEFzc2V0IHwgQXNzZXQpIHtcbiAgICAgICAgcmV0dXJuICFhc3NldC5pc0RpcmVjdG9yeSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOaYr+WQpuW8uuWItuWIt+aWsFxuICAgICAqIEBwYXJhbSBhc3NldFxuICAgICAqL1xuICAgIGFzeW5jIGZvcmNlKGFzc2V0OiBWaXJ0dWFsQXNzZXQgfCBBc3NldCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5byA5aeL5omn6KGM5paH5Lu255qE5a+85YWl5pON5L2cXG4gICAgICogICAxLiDlsIbmlofku7blpI3liLbliLAgbGlicmFyeSDlhoVcbiAgICAgKiBcbiAgICAgKiDov5Tlm57mmK/lkKblr7zlhaXmiJDlip/nmoTmoIforrBcbiAgICAgKiDlpoLmnpzov5Tlm54gZmFsc2XvvIzliJkgaW1wb3J0ZWQg5qCH6K6w5LiN5Lya5Y+Y5oiQIHRydWVcbiAgICAgKiDlkI7nu63nmoTkuIDns7vliJfmk43kvZzpg73kuI3kvJrmiafooYxcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gYXNzZXRcbiAgICAgKi9cbiAgICBhc3luYyBpbXBvcnQoYXNzZXQ6IFZpcnR1YWxBc3NldCB8IEFzc2V0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIC8vIOWmguaenOaYr+iZmuaLn+i1hOa6kO+8jOebtOaOpei/lOWbniBmYWxzZVxuICAgICAgICBpZiAoIShhc3NldCBpbnN0YW5jZW9mIEFzc2V0KSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmianlsZXlkI3vvIzlpoIgLmpzb25cbiAgICAgICAgbGV0IGV4dCA9IGV4dG5hbWUoYXNzZXQuc291cmNlKS50b0xvd2VyQ2FzZSgpOyAvLyDms6jmhI/vvIzov5nph4zkvJrmiormiYDmnInlkI7nvIDnu5/kuIDmlLnmiJDlsI/lhplcblxuICAgICAgICAvLyDlpI3liLYgcmF3IGFzc2V0XG4gICAgICAgIGF3YWl0IGFzc2V0LmNvcHlUb0xpYnJhcnkoZXh0LCBhc3NldC5zb3VyY2UpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhZnRlclN1YkFzc2V0c0ltcG9ydD8oYXNzZXQ6IFZpcnR1YWxBc3NldCB8IEFzc2V0KTogUHJvbWlzZTx2b2lkPjtcbiAgICBjaGVja0F3YWtlPyhhc3NldDogVmlydHVhbEFzc2V0IHwgQXNzZXQpOiBQcm9taXNlPGJvb2xlYW4+O1xufVxuXG5leHBvcnQgY2xhc3MgRGVmYXVsdEltcG9ydGVyIGV4dGVuZHMgSW1wb3J0ZXIge1xuXG4gICAgLyoqXG4gICAgICog5qOA5p+l5paH5Lu25piv5ZCm6YCC55So5LqO6L+Z5LiqIGltcG9ydGVyXG4gICAgICogQHBhcmFtIGFzc2V0XG4gICAgICovXG4gICAgYXN5bmMgdmFsaWRhdGUoYXNzZXQ6IFZpcnR1YWxBc3NldCB8IEFzc2V0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOW8gOWni+aJp+ihjOaWh+S7tueahOWvvOWFpeaTjeS9nFxuICAgICAqICAgMS4g5bCG5paH5Lu25aSN5Yi25YiwIGxpYnJhcnkg5YaFXG4gICAgICogXG4gICAgICog6L+U5Zue5piv5ZCm5a+85YWl5oiQ5Yqf55qE5qCH6K6wXG4gICAgICog5aaC5p6c6L+U5ZueIGZhbHNl77yM5YiZIGltcG9ydGVkIOagh+iusOS4jeS8muWPmOaIkCB0cnVlXG4gICAgICog5ZCO57ut55qE5LiA57O75YiX5pON5L2c6YO95LiN5Lya5omn6KGMXG4gICAgICogXG4gICAgICogQHBhcmFtIGFzc2V0XG4gICAgICovXG4gICAgYXN5bmMgaW1wb3J0KGFzc2V0OiBWaXJ0dWFsQXNzZXQgfCBBc3NldCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICAvLyDlpoLmnpzmmK/omZrmi5/otYTmupDvvIznm7TmjqXov5Tlm54gZmFsc2VcbiAgICAgICAgaWYgKCEoYXNzZXQgaW5zdGFuY2VvZiBBc3NldCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5omp5bGV5ZCN77yM5aaCIC5qc29uXG4gICAgICAgIGxldCBleHQgPSBleHRuYW1lKGFzc2V0LnNvdXJjZSk7XG5cbiAgICAgICAgLy8g5a+85YWl5a+56LGh5piv5paH5Lu25aS577yM5YiZ55u05o6l6Lez6L+HXG4gICAgICAgIGlmIChhd2FpdCBhc3NldC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWkjeWItiByYXcgYXNzZXRcbiAgICAgICAgYXdhaXQgYXNzZXQuY29weVRvTGlicmFyeShleHQsIGFzc2V0LnNvdXJjZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cbiJdfQ==