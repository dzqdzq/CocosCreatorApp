"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InfoManager=void 0;const fs_extra_1=require("fs-extra");class InfoManager{constructor(){this.map={},this._saveTimer=null}async setRecordJSON(e){if(this.file=e,(0,fs_extra_1.existsSync)(e))try{this.map=(0,fs_extra_1.readJSONSync)(this.file)}catch(e){console.error(e),this.map={}}else this.map={}}destroy(){this.map={}}save(){clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>{this.saveImmediate()},400)}saveImmediate(){clearTimeout(this._saveTimer),this.file&&(0,fs_extra_1.outputJSONSync)(this.file,this.map,{spaces:2})}add(e,s,t){this.map[e]&&this.map[e].uuid===t&&this.map[e].time===s||(this.map[e]=t?{time:s,uuid:t,missing:!1}:{time:s},this.save())}remove(e){this.map[e]&&(delete this.map[e],this.save())}get(e){return this.map[e]||null}compare(e,s){const t=this.map[e];return!!t&&t.time===s}}exports.InfoManager=InfoManager;