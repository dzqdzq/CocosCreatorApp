{"version":3,"file":"gpu-context.js","sources":["../../../src/main/integrations/gpu-context.ts"],"sourcesContent":["import { defineIntegration, Event } from '@sentry/core';\nimport { app } from 'electron';\n\ninterface Options {\n  /**\n   * How much GPU information to request from Electron `app.getGPUInfo` API.\n   * `complete` can take much longer to resolve so the default is `basic`.\n   * - 'basic': Usually only the `vendor_id` and `id` but some platforms supply more.\n   * - 'complete': More detailed information including full names and driver_version.\n   */\n  infoLevel: 'basic' | 'complete';\n}\n\ninterface GpuContext extends Record<string, unknown> {\n  name: string;\n  active?: boolean;\n  vendor_id?: string;\n  vendor_name?: string;\n  id?: string;\n  driver_version?: string;\n}\n\ninterface GpuDevice {\n  active: boolean;\n  deviceId: number;\n  deviceString?: string;\n  driverVendor?: string;\n  driverVersion?: string;\n  vendorId: number;\n  vendorString?: string;\n}\n\ninterface GpuInfoResult {\n  gpuDevice: GpuDevice[];\n}\n\nfunction gpuDeviceToGpuContext(device: GpuDevice): GpuContext {\n  return {\n    name: device.deviceString || 'GPU',\n    active: device.active,\n    id: `0x${device.deviceId.toString(16).padStart(4, '0')}`,\n    vendor_id: `0x${device.vendorId.toString(16).padStart(4, '0')}`,\n    vendor_name: device.vendorString,\n    driver_version: device.driverVersion,\n  };\n}\n\n/**\n * Adds GPU context to events\n */\nexport const gpuContextIntegration = defineIntegration((options: Options = { infoLevel: 'basic' }) => {\n  let gpuContexts: GpuContext[] | undefined;\n\n  return {\n    name: 'GpuContext',\n    processEvent: async (event): Promise<Event> => {\n      if (gpuContexts === undefined) {\n        const result = (await app.getGPUInfo(options.infoLevel)) as GpuInfoResult;\n        gpuContexts = result.gpuDevice.map(gpuDeviceToGpuContext);\n      }\n\n      if (gpuContexts.length === 1) {\n        event.contexts = { ...event.contexts, gpu: gpuContexts[0] };\n      } else if (gpuContexts.length > 1) {\n        event.contexts = { ...event.contexts };\n        for (let i = 0; i < gpuContexts.length; i++) {\n          const gpuContext = gpuContexts[i] as GpuContext;\n          gpuContext.type = 'gpu';\n          event.contexts[`gpu_${i + 1}`] = gpuContext;\n        }\n      }\n\n      return event;\n    },\n  };\n});\n"],"names":[],"mappings":";;;AAoCA,SAAS,qBAAqB,CAAC,MAAiB,EAAA;IAC9C,OAAO;AACL,QAAA,IAAI,EAAE,MAAM,CAAC,YAAY,IAAI,KAAK;QAClC,MAAM,EAAE,MAAM,CAAC,MAAM;AACrB,QAAA,EAAE,EAAE,CAAK,EAAA,EAAA,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAE,CAAA;AACxD,QAAA,SAAS,EAAE,CAAK,EAAA,EAAA,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAE,CAAA;QAC/D,WAAW,EAAE,MAAM,CAAC,YAAY;QAChC,cAAc,EAAE,MAAM,CAAC,aAAa;KACrC;AACH;AAEA;;AAEG;AACI,MAAM,qBAAqB,GAAG,iBAAiB,CAAC,CAAC,OAAmB,GAAA,EAAE,SAAS,EAAE,OAAO,EAAE,KAAI;AACnG,IAAA,IAAI,WAAqC;IAEzC,OAAO;AACL,QAAA,IAAI,EAAE,YAAY;AAClB,QAAA,YAAY,EAAE,OAAO,KAAK,KAAoB;YAC5C,IAAI,WAAW,KAAK,SAAS,EAAE;AAC7B,gBAAA,MAAM,MAAM,IAAI,MAAM,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAkB;gBACzE,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,qBAAqB,CAAC;AAC1D;AAED,YAAA,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE;AAC5B,gBAAA,KAAK,CAAC,QAAQ,GAAG,EAAE,GAAG,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,WAAW,CAAC,CAAC,CAAC,EAAE;AAC5D;AAAM,iBAAA,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;gBACjC,KAAK,CAAC,QAAQ,GAAG,EAAE,GAAG,KAAK,CAAC,QAAQ,EAAE;AACtC,gBAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC3C,oBAAA,MAAM,UAAU,GAAG,WAAW,CAAC,CAAC,CAAe;AAC/C,oBAAA,UAAU,CAAC,IAAI,GAAG,KAAK;oBACvB,KAAK,CAAC,QAAQ,CAAC,CAAO,IAAA,EAAA,CAAC,GAAG,CAAC,CAAE,CAAA,CAAC,GAAG,UAAU;AAC5C;AACF;AAED,YAAA,OAAO,KAAK;SACb;KACF;AACH,CAAC;;;;"}