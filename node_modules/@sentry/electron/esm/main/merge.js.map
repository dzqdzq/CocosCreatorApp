{"version":3,"file":"merge.js","sources":["../../src/main/merge.ts"],"sourcesContent":["import { Event } from '@sentry/core';\nimport deepMerge from 'deepmerge';\n\n/** Removes private properties from event before merging */\nfunction removePrivateProperties(event: Event): void {\n  // These contain recursive structures and are not meant to be serialized\n  delete event.sdkProcessingMetadata?.capturedSpanScope;\n  delete event.sdkProcessingMetadata?.capturedSpanIsolationScope;\n\n  for (const span of event.spans || []) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    delete (span as any).spanRecorder;\n  }\n}\n\n/** Merges Events with defaults */\nexport function mergeEvents(defaults: Event, event: Event): Event {\n  removePrivateProperties(event);\n\n  const newEvent: Event = deepMerge(defaults, event);\n\n  // We need to copy spans across manually\n  //\n  // Spans contain a custom toJSON function for serialization and without\n  // this they are serialised with camelCase properties rather than the\n  // snake_case required by the Sentry API.\n  if (event.spans || defaults.spans) {\n    newEvent.spans = event.spans || defaults.spans;\n  }\n\n  // We don't want packages array in sdk to get merged with duplicates\n  return {\n    ...newEvent,\n    sdk: {\n      ...defaults.sdk,\n      ...event.sdk,\n    },\n  };\n}\n"],"names":[],"mappings":";;AAGA;AACA,SAAS,uBAAuB,CAAC,KAAY,EAAA;;AAE3C,IAAA,OAAO,KAAK,CAAC,qBAAqB,EAAE,iBAAiB;AACrD,IAAA,OAAO,KAAK,CAAC,qBAAqB,EAAE,0BAA0B;IAE9D,KAAK,MAAM,IAAI,IAAI,KAAK,CAAC,KAAK,IAAI,EAAE,EAAE;;QAEpC,OAAQ,IAAY,CAAC,YAAY;AAClC;AACH;AAEA;AACgB,SAAA,WAAW,CAAC,QAAe,EAAE,KAAY,EAAA;IACvD,uBAAuB,CAAC,KAAK,CAAC;IAE9B,MAAM,QAAQ,GAAU,SAAS,CAAC,QAAQ,EAAE,KAAK,CAAC;;;;;;AAOlD,IAAA,IAAI,KAAK,CAAC,KAAK,IAAI,QAAQ,CAAC,KAAK,EAAE;QACjC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,QAAQ,CAAC,KAAK;AAC/C;;IAGD,OAAO;AACL,QAAA,GAAG,QAAQ;AACX,QAAA,GAAG,EAAE;YACH,GAAG,QAAQ,CAAC,GAAG;YACf,GAAG,KAAK,CAAC,GAAG;AACb,SAAA;KACF;AACH;;;;"}