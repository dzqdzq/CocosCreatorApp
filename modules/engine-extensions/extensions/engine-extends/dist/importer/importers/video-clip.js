"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoImporter=void 0;const asset_db_1=require("@editor/asset-db"),cc_1=require("cc"),utils_1=require("../utils");class VideoImporter extends asset_db_1.Importer{get version(){return"1.0.0"}get name(){return"video-clip"}get assetType(){return cc_1.js.getClassName(cc_1.VideoClip)}async import(e){await e.copyToLibrary(e.extname,e.source);const t=document.createElement("video");try{await this.loadVideo(e,t)}catch(t){console.error(`Loading video ${e.source} failed, the video you are using may be in a corrupted format or not supported by the current browser version of the editor, in the latter case you can ignore this error.`),console.debug(t)}const r=this.createVideo(e,t.duration),o=EditorExtends.serialize(r);await e.saveToLibrary(".json",o);const s=(0,utils_1.getDependUUIDList)(o);return e.setData("depends",s),!0}loadVideo(e,t){return new Promise((r,o)=>{t.addEventListener("loadedmetadata",async()=>{r()}),t.addEventListener("error",e=>{o(e)});try{const r=e.source.split(/\\|\//).map(e=>encodeURIComponent(e)).join("/").replace("%3A",":");t.src=r}catch(e){o(e)}})}createVideo(e,t){const r=new cc_1.VideoClip;return t&&(r._duration=t),r.name=e.basename,r._setRawAsset(e.extname),r}}exports.VideoImporter=VideoImporter;