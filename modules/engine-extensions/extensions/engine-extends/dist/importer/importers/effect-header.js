"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectHeaderImporter=void 0;const asset_db_1=require("@editor/asset-db"),fs_extra_1=require("fs-extra"),path_1=require("path"),effect_compiler_1=require("../../../static/effect-compiler"),effect_1=require("./effect"),builtinChunkDir=path_1.join(Manager.AssetInfo.engine,"./editor/assets/chunks"),builtinChunks=(()=>{const e=[];return function t(r){fs_extra_1.readdirSync(r).forEach(n=>{const i=path_1.join(r,n);/\.chunk$/.test(n)?e.push(i):fs_extra_1.statSync(i).isDirectory()&&t(i)})}(builtinChunkDir),e})();for(let e=0;e<builtinChunks.length;++e){const t=path_1.basename(builtinChunks[e],".chunk"),r=fs_extra_1.readFileSync(builtinChunks[e],{encoding:"utf8"});effect_compiler_1.addChunk(t,r)}class EffectHeaderImporter extends asset_db_1.Importer{get version(){return"1.0.6"}get name(){return"effect-header"}get assetType(){return""}get migrations(){return migrations}async import(e){try{const t=this.assetDB.options.target,r=path_1.relative(path_1.join(t,"chunks"),path_1.dirname(e.source)).replace(/\\/g,"/"),n=r+(r.length?"/":"")+path_1.basename(e.source,path_1.extname(e.source)),i=fs_extra_1.readFileSync(e.source,{encoding:"utf-8"});return effect_compiler_1.addChunk(n,i),!0}catch(e){return console.error(e),!1}}}exports.EffectHeaderImporter=EffectHeaderImporter;const migrations=[{version:"1.0.1",migrate:effect_1.migrateDefines},{version:"1.0.2",migrate:effect_1.migrateEnableDirShadow},{version:"1.0.3",migrate:effect_1.migrateIncludeDecodeBase},{version:"1.0.4",migrate:effect_1.migrateMacroUseLightMap},{version:"1.0.5",migrate:effect_1.migrateChunkFolders},{version:"1.0.6",migrate:effect_1.migrateCSMInclude}];