"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.transformPluginScript=void 0;const babel=__importStar(require("@babel/core"));async function transformPluginScript(e,t){const n=!(e.length>5e5),r=await babel.transformAsync(e,{compact:n,plugins:[[wrapPluginScript(t)]]});return r?{code:r.code}:{code:e}}exports.transformPluginScript=transformPluginScript;const wrapPluginScript=e=>{const t=babel.template.statements("(function(root) {\n    %%HIDE_COMMONJS%%;\n    %%HIDE_AMD%%;\n    %%SIMULATE_GLOBALS%%;\n    (function() {\n        %%ORIGINAL_CODE%%\n    }).call(root);\n})(\n    // The environment-specific global.\n    (function() {\n        if (typeof globalThis !== 'undefined') return globalThis;\n        if (typeof self !== 'undefined') return self;\n        if (typeof window !== 'undefined') return window;\n        if (typeof global !== 'undefined') return global;\n        if (typeof this !== 'undefined') return this;\n        return {};\n    }).call(this),\n);\n",{preserveComments:!0,syntacticPlaceholders:!0});return{visitor:{Program:(n,r)=>{let i,a,l;e.hideCommonJs&&(i=babel.types.variableDeclaration("var",["exports","module","require"].map(e=>babel.types.variableDeclarator(babel.types.identifier(e),babel.types.identifier("undefined"))))),e.hideAmd&&(a=babel.types.variableDeclaration("var",["define"].map(e=>babel.types.variableDeclarator(babel.types.identifier(e),babel.types.identifier("undefined"))))),e.simulateGlobals&&0!==e.simulateGlobals.length&&(l=babel.types.variableDeclaration("var",e.simulateGlobals.map(e=>babel.types.variableDeclarator(babel.types.identifier(e),babel.types.identifier("root"))))),n.node.body=t({ORIGINAL_CODE:n.node.body,SIMULATE_GLOBALS:l,HIDE_COMMONJS:i,HIDE_AMD:a})}}}};