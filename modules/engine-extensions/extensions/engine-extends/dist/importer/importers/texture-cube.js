"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureCubeImporter=exports.makeDefaultTextureCubeAssetUserData=void 0;const asset_db_1=require("@editor/asset-db"),cc=__importStar(require("cc")),load_asset_sync_1=require("./gltf/load-asset-sync"),texture_base_1=require("./texture-base"),utils_1=require("../utils");function makeDefaultTextureCubeAssetUserData(){const e=(0,texture_base_1.makeDefaultTextureBaseAssetUserData)();return e.isRGBE=!1,e}exports.makeDefaultTextureCubeAssetUserData=makeDefaultTextureCubeAssetUserData;class TextureCubeImporter extends asset_db_1.Importer{get version(){return"1.0.4"}get name(){return"texture-cube"}get assetType(){return"cc.TextureCube"}get migrations(){return[{version:"1.0.3",migrate:texture_base_1.migrateAnisotropy}]}async import(e){0===Object.getOwnPropertyNames(e.userData).length&&(e.assignUserData(makeDefaultTextureCubeAssetUserData(),!0),e.userData.isRGBE=!1);const t=e.userData,r=["front","back","left","right","top","bottom"],s={};for(const a of r){let r=t[a];if(!r){const e=`db://internal/default_cubemap/${a}.jpg`,t=(0,asset_db_1.queryUUID)(e);if(!t)throw new Error(`[[internal-error]] Default face url ${e} doesn't exists.`);r=t}const u=(0,load_asset_sync_1.loadAssetSync)(r,cc.ImageAsset);if(!u)throw new Error(`Failed to load ${a} face of ${e.uuid}.`);s[a]=u}const a=new cc.TextureCube;(0,texture_base_1.applyTextureBaseAssetUserData)(t,a),e.parent instanceof asset_db_1.Asset&&(a.name=e.parent.basename||""),a.isRGBE=t.isRGBE,a._mipmaps=[s];const u=EditorExtends.serialize(a);await e.saveToLibrary(".json",u);const n=(0,utils_1.getDependUUIDList)(u);return e.setData("depends",n),!0}}exports.TextureCubeImporter=TextureCubeImporter;