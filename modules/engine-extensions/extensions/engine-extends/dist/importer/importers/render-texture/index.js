"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTextureImporter=void 0;const asset_db_1=require("@editor/asset-db"),fs_extra_1=require("fs-extra"),migrates_1=require("../scene/migrates"),texture_base_1=require("../texture-base"),cc_1=require("cc"),utils_1=require("../../utils");function fillUserdata(e,t,r){t in e.userData||(e.userData[t]=r)}var Fliter;Fliter||(Fliter={});class RenderTextureImporter extends asset_db_1.Importer{get version(){return"1.2.2"}get name(){return"render-texture"}get assetType(){return"cc.RenderTexture"}get migrations(){return migrations}get migrationHook(){return migrates_1.migrationHook}async import(e){const t=await fs_extra_1.readJSON(e.source),r=cc.deserialize(t);r.name=e.basename||"",fillUserdata(e,"width",r.width),fillUserdata(e,"height",r.height),fillUserdata(e,"anisotropy",r._anisotropy),fillUserdata(e,"minfilter",texture_base_1.getFilterString(r._minFilter)),fillUserdata(e,"magfilter",texture_base_1.getFilterString(r._magFilter)),fillUserdata(e,"mipfilter",texture_base_1.getFilterString(r._mipFilter)),fillUserdata(e,"wrapModeS",texture_base_1.getWrapModeString(r._wrapS)),fillUserdata(e,"wrapModeT",texture_base_1.getWrapModeString(r._wrapT)),r.resize(e.userData.width,e.userData.height),texture_base_1.applyTextureBaseAssetUserData(e.userData,r);const a=EditorExtends.serialize(r);await e.saveToLibrary(".json",a);const i=utils_1.getDependUUIDList(a);e.setData("depends",i);const s=await e.createSubAsset("spriteFrame","rt-sprite-frame",{displayName:e.basename});return e.userData.redirect=s.uuid,s.userData.imageUuidOrDatabaseUri=e.uuid,s.userData.width=e.userData.width,s.userData.height=e.userData.height,!0}}exports.RenderTextureImporter=RenderTextureImporter;const migrations=[{version:"1.1.0",migrate:migrateAssetContent},{version:"1.2.0",migrate:migrateRenderTextureData}];async function migrateAssetContent(e){const t=e.getSwapSpace().json||await fs_extra_1.readJSON(e.source);if(t.content){const{name:e,width:r,height:a}=t.content,i=new cc_1.RenderTexture;e&&(i._name=e),r&&(i._width=r),a&&(i._height=a),delete t.content,Object.assign(t,JSON.parse(EditorExtends.serialize(i)))}}async function migrateRenderTextureData(e){const t=e.getSwapSpace().json||await fs_extra_1.readJSON(e.source),{_name:r,_width:a,_height:i}=t;t.content={base:"2,2,0,0,0,0",w:a,h:i,n:r},delete t._name,delete t._width,delete t._height}