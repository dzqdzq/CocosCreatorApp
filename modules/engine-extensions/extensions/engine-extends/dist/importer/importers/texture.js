"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureImporter=exports.makeDefaultTexture2DAssetUserDataFromImageUuid=exports.makeDefaultTexture2DAssetUserDataFromImagePath=exports.makeDefaultTexture2DAssetUserData=void 0;const asset_db_1=require("@editor/asset-db"),texture_base_1=require("./texture-base"),cc_1=require("cc"),utils_1=require("../utils");function makeDefaultTexture2DAssetUserData(){return(0,texture_base_1.makeDefaultTextureBaseAssetUserData)()}function makeDefaultTexture2DAssetUserDataFromImagePath(e){return Object.assign((0,texture_base_1.makeDefaultTextureBaseAssetUserData)(),{isUuid:!1,imageUuidOrDatabaseUri:e})}function makeDefaultTexture2DAssetUserDataFromImageUuid(e,t){const a=(0,texture_base_1.makeDefaultTextureBaseAssetUserData)();return t&&[".exr",".hdr",".znt"].includes(t)&&(a.mipfilter="none",a.minfilter="nearest",a.magfilter="nearest"),Object.assign(a,{isUuid:!0,imageUuidOrDatabaseUri:e})}exports.makeDefaultTexture2DAssetUserData=makeDefaultTexture2DAssetUserData,exports.makeDefaultTexture2DAssetUserDataFromImagePath=makeDefaultTexture2DAssetUserDataFromImagePath,exports.makeDefaultTexture2DAssetUserDataFromImageUuid=makeDefaultTexture2DAssetUserDataFromImageUuid;class TextureImporter extends asset_db_1.Importer{get version(){return"1.0.22"}get name(){return"texture"}get assetType(){return"cc.Texture2D"}get migrations(){return[{version:"1.0.21",migrate:texture_base_1.migrateAnisotropy}]}async import(e){const t=e.userData,a=new cc.Texture2D;e.parent instanceof asset_db_1.Asset&&(a.name=e.parent.basename||"",!t.mipfilter&&[".hdr",".exr"].includes(e.parent.extname)&&(t.mipfilter="none",t.minfilter="nearest",t.magfilter="nearest")),e.assignUserData(makeDefaultTexture2DAssetUserData()),(0,texture_base_1.applyTextureBaseAssetUserData)(t,a);const r=this._getImageAsset(e);r&&(a._mipmaps=[r]);const s=EditorExtends.serialize(a);await e.saveToLibrary(".json",s);const u=(0,utils_1.getDependUUIDList)(s);return e.setData("depends",u),!0}_getImageAsset(e){const t=e.userData,a=t.imageUuidOrDatabaseUri;if(!a)return null;{let r=null;if(t.isUuid?r=a:(r=(0,asset_db_1.queryUUID)(a))||(console.warn(`Cannot find image ${(0,asset_db_1.queryPath)(a)||""}.`),e.depend(a)),null!==r){return EditorExtends.serialize.asAsset(r,cc_1.ImageAsset)}}return null}}exports.TextureImporter=TextureImporter;