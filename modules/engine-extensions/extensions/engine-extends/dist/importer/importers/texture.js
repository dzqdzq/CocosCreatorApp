"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureImporter=exports.makeDefaultTexture2DAssetUserDataFromImageUuid=exports.makeDefaultTexture2DAssetUserDataFromImagePath=exports.makeDefaultTexture2DAssetUserData=void 0;const asset_db_1=require("@editor/asset-db"),texture_base_1=require("./texture-base"),cc_1=require("cc"),utils_1=require("../utils");function makeDefaultTexture2DAssetUserData(){return texture_base_1.makeDefaultTextureBaseAssetUserData()}function makeDefaultTexture2DAssetUserDataFromImagePath(e){return Object.assign(texture_base_1.makeDefaultTextureBaseAssetUserData(),{isUuid:!1,imageUuidOrDatabaseUri:e})}function makeDefaultTexture2DAssetUserDataFromImageUuid(e,t){const a=texture_base_1.makeDefaultTextureBaseAssetUserData();return t&&[".exr",".hdr",".znt"].includes(t)&&(a.mipfilter="none",a.minfilter="nearest",a.magfilter="nearest"),Object.assign(a,{isUuid:!0,imageUuidOrDatabaseUri:e})}exports.makeDefaultTexture2DAssetUserData=makeDefaultTexture2DAssetUserData,exports.makeDefaultTexture2DAssetUserDataFromImagePath=makeDefaultTexture2DAssetUserDataFromImagePath,exports.makeDefaultTexture2DAssetUserDataFromImageUuid=makeDefaultTexture2DAssetUserDataFromImageUuid;class TextureImporter extends asset_db_1.Importer{get version(){return"1.0.22"}get name(){return"texture"}get assetType(){return"cc.Texture2D"}get migrations(){return[{version:"1.0.21",migrate:texture_base_1.migrateAnisotropy}]}get assetExtends(){return["cc.TextureBase"]}async import(e){e.assignUserData(makeDefaultTexture2DAssetUserData());const t=e.userData,a=new cc.Texture2D;texture_base_1.applyTextureBaseAssetUserData(t,a),e.parent instanceof asset_db_1.Asset&&(a.name=e.parent.basename||"");const s=this._getImageAsset(e);s&&(a._mipmaps=[s]);const r=EditorExtends.serialize(a);await e.saveToLibrary(".json",r);const u=utils_1.getDependUUIDList(r);return e.setData("depends",u),!0}_getImageAsset(e){const t=e.userData,a=t.imageUuidOrDatabaseUri;if(!a)return null;{let s=null;if(t.isUuid?s=a:(s=asset_db_1.queryUUID(a))||(console.warn(`Cannot find image ${asset_db_1.queryPath(a)||""}.`),e.depend(a)),null!==s){return EditorExtends.serialize.asAsset(s,cc_1.ImageAsset)}}return null}}exports.TextureImporter=TextureImporter;