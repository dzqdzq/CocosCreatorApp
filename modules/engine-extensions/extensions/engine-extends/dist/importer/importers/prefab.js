"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrefabImporter=void 0;const asset_db_1=require("@editor/asset-db"),index_1=require("./scene/index"),migrates_1=require("./scene/migrates"),fs_extra_1=require("fs-extra"),utils_1=require("../utils");class PrefabImporter extends asset_db_1.Importer{get version(){return index_1.version}get name(){return"prefab"}get assetType(){return"cc.Prefab"}get migrations(){return migrates_1.migrations}get migrationHook(){return{async pre(e){e.getSwapSpace().json=await fs_extra_1.readJSON(e.source)},async post(e,t){const r=e.getSwapSpace();if(t>0){const t=JSON.stringify(r.json,null,2);await fs_extra_1.writeFile(e.source,t)}delete r.json}}}async import(e){const t=await fs_extra_1.readJSON(e.source),r=e.basename||"";let s=t[0]._name!==r||t[1]._name!==r||t[0].persistent!==!!e.userData.persistent;s&&(t[0]._name=r||"",t[1]._name=r||"",t[0].persistent=!!e.userData.persistent);try{s=s||utils_1.removeNull(t,e.uuid)}catch(e){console.debug(e)}if(s)try{const r=JSON.stringify(t,void 0,2);await fs_extra_1.writeFile(e.source,r)}catch(e){}const a=JSON.stringify(t,void 0,2);await e.saveToLibrary(".json",a);const i=utils_1.getDependList(a);return e.setData("depends",i.uuids),e.setData("dependScripts",i.dependScriptUuids),e.userData.syncNodeName=r,!0}}exports.PrefabImporter=PrefabImporter;