"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrefabImporter=void 0;const asset_db_1=require("@editor/asset-db"),index_1=require("./scene/index"),migrates_1=require("./scene/migrates"),fs_extra_1=require("fs-extra"),utils_1=require("../utils");class PrefabImporter extends asset_db_1.Importer{get version(){return index_1.version}get name(){return"prefab"}get assetType(){return"cc.Prefab"}get migrations(){return migrates_1.migrations}get migrationHook(){return{async pre(e){e.getSwapSpace().json=await fs_extra_1.readJSON(e.source)},async post(e,s){const t=e.getSwapSpace();if(s>0){const s=JSON.stringify(t.json,null,2);await fs_extra_1.writeFile(e.source,s)}delete t.json}}}async import(e){const s=await fs_extra_1.readJSON(e.source),t=e.basename||"",r=s[0].asyncLoadAssets!==!!e.userData.asyncLoadAssets||s[0]._name!==t||s[1]._name!==t||s[0].persistent!==!!e.userData.persistent;r&&(s[0]._name=t||"",s[0].asyncLoadAssets=!!e.userData.asyncLoadAssets,s[1]._name=t||"",s[0].persistent=!!e.userData.persistent);const a=JSON.stringify(s,void 0,2);if(r)try{await fs_extra_1.writeFile(e.source,a)}catch(e){}await e.saveToLibrary(".json",a);const n=utils_1.getDependUUIDList(a);return e.setData("depends",n),e.userData.syncNodeName=t,!0}}exports.PrefabImporter=PrefabImporter;