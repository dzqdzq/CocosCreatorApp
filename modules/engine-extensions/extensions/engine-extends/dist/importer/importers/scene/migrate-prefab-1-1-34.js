"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migratePrefabInstanceRootsByJson=exports.migratePrefabInstanceRoots=void 0;const fs_extra_1=require("fs-extra"),utils_1=require("./utils");async function migratePrefabInstanceRoots(e){migratePrefabInstanceRootsByJson(e.getSwapSpace().json||await fs_extra_1.readJSON(e.source))}function migratePrefabInstanceRootsByJson(e){const t=e[1];if(!t)return void console.warn("can't find root node");if(!t._prefab){const n={__type__:"cc.PrefabInfo",fileId:t._id},s=e.push(n)-1;t._prefab={__id__:s}}const n=t._prefab?e[t._prefab.__id__]:null;if(t&&n&&t._children){const s=[];t._children.forEach(t=>{utils_1.walkNode(e,t,(t,n)=>{if(!t||!t._prefab)return;e[t._prefab.__id__].instance&&s.push(n)}),s.length>0?n.nestedPrefabInstanceRoots=s:n.nestedPrefabInstanceRoots=void 0})}}exports.migratePrefabInstanceRoots=migratePrefabInstanceRoots,exports.migratePrefabInstanceRootsByJson=migratePrefabInstanceRootsByJson;