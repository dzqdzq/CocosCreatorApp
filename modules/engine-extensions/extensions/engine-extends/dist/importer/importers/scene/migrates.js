"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var o=Object.getOwnPropertyDescriptor(t,a);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,o)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateFXAA=exports.migratePrefabParentNull=exports.migrateBloomThreshold=exports.migrateBakeSettings=exports.migrateLabelOutlineAndShadow=exports.migrateMaskImageStencilSizeMode=exports.migrateMaskImageStencil=exports.migrateCSMData=exports.migratePunctualLightLuminance=exports.migrateShadowsData=exports.migrateLightBakeable=exports.migrateSkyLightingTypeData=exports.migrateFogData=exports.migrateHDRData=exports.migrateShadowAutoAdapt=exports.migratePrivateNode=exports.migrateShadowDepthBias=exports.migrateShadowInfo=exports.migratePrefabCompPrefabInfo=exports.migrateUILayout=exports._renameMap=exports.migrateShadow=exports.migrateScrollAndPageViewComponenetModule=exports.migrateParticleComponentModule=exports.migrateParticleModule=exports.migrateSkybox=exports.migrateUIPriority=exports.migrateWidgetComponent=exports.migrateSavePrefabInfoAgain=exports.migrateSavePrefabInfo=exports.migrateDefaultLayer=exports.migrateNameToId=exports.migrateAnimationName=exports.migrateImageUuid=exports.migrations=exports.migrationHook=void 0;const asset_db_1=require("@editor/asset-db"),utils_1=require("@editor/asset-db/libs/utils"),cc=__importStar(require("cc")),fs_extra_1=require("fs-extra"),path_1=require("path"),reader_manager_1=require("../gltf/reader-manager"),utils_2=require("./utils"),components_1=require("../migrates/components"),prefab_1=require("../migrates/prefab"),migration_utils_1=require("../utils/migration-utils"),migrate_curve_range_3_3_0_1=require("../migrates/migrate-curve-range-3-3-0"),migrate_geometry_curve_3_3_0_1=require("../migrates/migrate-geometry-curve-3-3-0"),migrate_prefab_1_1_34_1=require("./migrate-prefab-1-1-34"),equirect_cubemap_faces_1=require("../utils/equirect-cubemap-faces"),{clamp:clamp}=Editor.Utils.Math;async function migrateImageUuid(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);(0,utils_2.walk)(t,e=>{if(!("__uuid__"in e))return;const t=e.__uuid__;if(!/@/.test(t))return;const a=t.split("@");let i;const o=(0,asset_db_1.queryAsset)(a[0]);if(o&&(i=o),i&&"image"===i.meta.importer)switch(i.meta.userData.type){case"raw":break;case"texture":a[1]="texture";break;case"normal map":a[1]="normalMap";break;case"texture cube":a[1]="textureCube";break;case"sprite-frame":a[1]="spriteFrame"}e.__uuid__=a.join("@")})}exports.migrationHook={async pre(e){e.getSwapSpace().json=await(0,fs_extra_1.readJSON)(e.source)},async post(e,t){const a=e.getSwapSpace();if(t>0){const t=JSON.stringify(a.json,null,2);await(0,fs_extra_1.writeFile)(e.source,t)}delete a.json}},exports.migrations=[{version:"1.0.4",migrate:migrateImageUuid},{version:"1.0.5",migrate:migrateSkinningRoot},{version:"1.0.6",migrate:migrateAnimationName},{version:"1.0.13",migrate:migrateVisibility},{version:"1.0.14",migrate:migrateClearFlags},{version:"1.0.15",migrate:async e=>{await migrateNameToId(e,!0)}},{version:"1.0.16",migrate:migrateDefaultLayer},{version:"1.0.18",migrate:migrateCameraVisibility},{version:"1.0.20",migrate:migrateNameToId},{version:"1.0.21",migrate:migrateWidgetComponent},{version:"1.0.22",migrate:migrateUIPriority},{version:"1.0.23",migrate:migrateSkybox},{version:"1.0.24",migrate:migrateSkinningMaterial},{version:"1.0.25",migrate:migrateBackSkinningMaterial},{version:"1.0.26",migrate:migrateSkinningMaterialForMeshSplit},{version:"1.0.27",migrate:migrateCapsuleColliderHeight},{version:"1.0.28",migrate:migrateParticleModule},{version:"1.0.29",migrate:migrateParticleComponentModule},{version:"1.0.31",migrate:async e=>{}},{version:"1.0.32",migrate:migrateShadow},{version:"1.1.0",migrate:migrateComponentNames},{version:"1.1.20",migrate:migrateClickEventsNames},{version:"1.1.21",migrate:migrateCanvasAddWidget},{version:"1.1.22",migrate:migrateRigidBody},{version:"1.1.23",migrate:migrateUICustomMaterial},{version:"1.1.24",migrate:migrateVisibilityTypeError},{version:"1.1.25",migrate:migrateUILayout},{version:"1.1.26",migrate:migrateCanvasCamera},{version:"1.1.27",migrate:async e=>{const t=e.getSwapSpace(),a=t.json||await(0,fs_extra_1.readJSON)(e.source);await migratePrefabCompPrefabInfo(e),await(0,prefab_1.beforeMigratePrefab)(e),await(0,prefab_1.migratePrefab)(e),a&&(t.json=JSON.parse(JSON.stringify(a)))}},{version:"1.1.29",migrate:async e=>{await migrateShadowInfo(e)}},{version:"1.1.30",migrate:migrateGeometryCurveCurveRange330},{version:"1.1.31",migrate:async e=>{await migrateShadowDepthBias(e)}},{version:"1.1.32",migrate:async e=>{await migratePrivateNode(e)}},{version:"1.1.33",migrate:async e=>{await migrateShadowAutoAdapt(e)}},{version:"1.1.34",migrate:async e=>{await(0,migrate_prefab_1_1_34_1.migratePrefabInstanceRoots)(e)}},{version:"1.1.35",migrate:async e=>{await migrateHDRData(e),await migrateFogData(e)}},{version:"1.1.36",migrate:async e=>{await migrateSkyLightingTypeData(e)}},{version:"1.1.37",migrate:async e=>{await migrateShadowsData(e)}},{version:"1.1.38",migrate:async e=>{await migratePunctualLightLuminance(e)}},{version:"1.1.39",migrate:async e=>{await migrateCSMData(e)}},{version:"1.1.40",migrate:async e=>{await migrateMaskImageStencil(e)}},{version:"1.1.41",migrate:async e=>{await migrateLightBakeable(e)}},{version:"1.1.42",migrate:async e=>{await migrateBakeSettings(e)}},{version:"1.1.43",migrate:async e=>{}},{version:"1.1.46",migrate:async e=>{await migratePrefabParentNull(e)}},{version:"1.1.47",migrate:async e=>{await migrateFXAA(e)}},{version:"1.1.48",migrate:async e=>{await migrateMaskImageStencilSizeMode(e)}},{version:"1.1.50",migrate:async e=>{await migrateLabelOutlineAndShadow(e),await migrateBloomThreshold(e)}}],exports.migrateImageUuid=migrateImageUuid;const animationRE=/AnimationComponent/i,skinningRE=/SkinningModelComponent/i;async function migrateSkinningRoot(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t){if(!skinningRE.test(e.__type__))continue;const a=e._skinningRoot&&e._skinningRoot.__id__;if((0,utils_2.getComponent)(t,a,animationRE))continue;let i=e.node.__id__;for(;i===e.node.__id__||!(0,utils_2.getComponent)(t,i,animationRE);){const e=t[i]._parent;i=e&&e.__id__||null}null!==i&&(e._skinningRoot={__id__:i})}(0,fs_extra_1.writeJSONSync)(e.source,t,{spaces:2})}async function migrateAnimationName(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);await(0,utils_2.walkAsync)(t,async t=>{if(!("__uuid__"in t))return;const a=t.__uuid__;if(!/@/.test(a))return;const i=a.split("@");let o;const n=(0,asset_db_1.queryAsset)(i[0]);n&&(o=n),o&&(e._assetDB.taskManager.pause(e.task),await o.waitInit(),e._assetDB.taskManager.resume(e.task),Object.keys(o.subAssets).some(e=>{const t=e.replace(/[ <>:'#\/\\|?*\x00-\x1F]/g,"-");if(i[1]===t)return i[1]=e,!0})),t.__uuid__=i.join("@")}),(0,fs_extra_1.writeJSONSync)(e.source,t,{spaces:2})}exports.migrateAnimationName=migrateAnimationName;const MissingClass=EditorExtends.MissingReporter.classInstance;function classFinder(e,t,a,i){const o=MissingClass.classFinder(e,t,a,i);return o||cc.MissingScript}async function migrateNormalizeScene(e){if(".scene"!==e.extname)return;const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source),a=cc.deserialize.Details.pool.get();MissingClass.hasMissingClass=!1;const i=cc.deserialize(t,a,{createAssetRefs:!0,ignoreEditorOnly:!1,classFinder:classFinder});if(i instanceof cc.SceneAsset){const e=i.scene;null!==e&&(e._lpos&&(e._lpos.x=e._lpos.y=e._lpos.z=0),e._lscale&&(e._lscale.x=e._lscale.y=e._lscale.z=1),e._lrot&&(e._lrot.x=e._lrot.y=e._lrot.z=0,e._lrot.w=1),e._euler&&(e._euler.x=e._euler.y=e._euler.z=0),e._components&&(e._components=[]))}(0,fs_extra_1.writeFileSync)(e.source,EditorExtends.serialize(i)),MissingClass.reset()}classFinder.onDereferenced=MissingClass.classFinder.onDereferenced;const cameraRE=/CameraComponent/i;async function migrateVisibility(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if(cameraRE.test(e.__type__)&&(e._visibility=1619001344),void 0!==e._visFlags&&(e._visFlags&=~(1<<30)),e.node){const a=t[e.node.__id__]._layer;2&a&&(t[e.node.__id__]._layer&=-3,t[e.node.__id__]._layer|=1<<20),4&a&&(t[e.node.__id__]._layer&=-5,t[e.node.__id__]._layer|=1<<21),8&a&&(t[e.node.__id__]._layer&=-9,t[e.node.__id__]._layer|=1<<22),16&a&&(t[e.node.__id__]._layer&=-17,t[e.node.__id__]._layer|=1<<23),t[e.node.__id__]._layer|=1<<30}}async function migrateClearFlags(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source),a=/SkyboxInfo/i,i=t.find(e=>a.test(e.__type__));if(i&&i._enabled)for(const e of t)cameraRE.test(e.__type__)&&(e._clearFlags=cc.Camera.ClearFlag.SKYBOX)}async function migrateNameToId(e,t){const a=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);(0,utils_2.walk)(a,e=>{const a=e.__uuid__;if(!/@/.test(a))return;const i=a.split("@");if(i.length<=1)return;for(let e=1;e<i.length;e++)i[e]=(0,utils_1.nameToId)(i[e]);const o=i.join("@");(!0===t||(0,asset_db_1.queryAsset)(o))&&(e.__uuid__=o)})}async function migrateDefaultLayer(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if(e.node){1073741825===t[e.node.__id__]._layer&&(t[e.node.__id__]._layer=1073741824)}}async function migrateSavePrefabInfo(e){if(".prefab"!==e.extname)return;const t=e.getSwapSpace(),a=t.json||await(0,fs_extra_1.readJSON)(e.source);let i=!1,o=!1;for(const e of a)e.__type__.startsWith("cc.Scene")&&(i=!0),e.__type__.startsWith("cc.PrefabInfo")&&(o=!0);if(!i&&o)return;const n=cc.deserialize.Details.pool.get();MissingClass.hasMissingClass=!1;const r=cc.deserialize(a,n,{createAssetRefs:!0,ignoreEditorOnly:!1,classFinder:classFinder});r.data.parent=null,function e(t,a){const i=t.parent&&t.parent._prefab;const o=new cc.Prefab._utils.PrefabInfo;o.asset=a||(null===i||void 0===i?void 0:i.asset);o.root=i&&i.root||t;o.fileId=t._prefab?t._prefab.fileId:t.uuid;t._prefab=o;Array.isArray(t.children)&&t.children.forEach(t=>{t.parent&&t.parent._prefab&&e(t,null)})}(r.data,r),t.json=JSON.parse(EditorExtends.serialize(r)),MissingClass.reset()}function migrateSavePrefabInfoAgain(e){migrateSavePrefabInfo(e)}async function migrateCameraVisibility(e){(e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source)).forEach(e=>{"cc.CameraComponent"===e.__type__?1619001344===e._visibility?e._visibility=1822425087:1610612736===e._visibility&&(e._visibility=1822425087):"cc.Node"!==e.__type__&&"cc.Scene"!==e.__type__||1===e._layer&&(e._layer=1073741824)})}async function migrateWidgetComponent(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.WidgetComponent"===e.__type__&&(e._isAbsLeft||0===e._left||(e._left/=100),e._isAbsRight||0===e._right||(e._right/=100),e._isAbsTop||0===e._top||(e._top/=100),e._isAbsBottom||0===e._bottom||(e._bottom/=100),e._isAbsHorizontalCenter||0===e._horizontalCenter||(e._horizontalCenter/=100),e._isAbsVerticalCenter||0===e._verticalCenter||(e._verticalCenter/=100))}async function migrateUIPriority(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if(void 0!==e._priority){if("cc.UITransformComponent"===e.__type__||"cc.CanvasComponent"===e.__type__)continue;const a=t[e.node.__id__];for(let i=0;i<a._components.length;i++){const o=t[a._components[i].__id__];"cc.UITransformComponent"===o.__type__&&(o._priority=e._priority,delete e._priority)}}}async function migrateSkybox(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.SceneGlobals"===e.__type__&&e.skybox&&(e._skybox=e.skybox,delete e.skybox)}exports.migrateNameToId=migrateNameToId,exports.migrateDefaultLayer=migrateDefaultLayer,exports.migrateSavePrefabInfo=migrateSavePrefabInfo,exports.migrateSavePrefabInfoAgain=migrateSavePrefabInfoAgain,exports.migrateWidgetComponent=migrateWidgetComponent,exports.migrateUIPriority=migrateUIPriority,exports.migrateSkybox=migrateSkybox;const skinningMaterials=new Set;async function migrateSkinningMaterial(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const a of t)if(a._materials&&"cc.SkinningModelComponent"===a.__type__)for(const t of a._materials){const a=t&&t.__uuid__,i=a&&(0,asset_db_1.queryAsset)(a);if(i&&!skinningMaterials.has(a))if(e._assetDB.taskManager.pause(e.task),await i.waitInit(),e._assetDB.taskManager.resume(e.task),(0,fs_extra_1.existsSync)(i.source)){skinningMaterials.add(a);const e=await(0,fs_extra_1.readJSON)(i.source),t=e._defines.length||1;for(let a=0;a<t;a++){let t=e._defines[a];t||(t=e._defines[0]={}),t.USE_SKINNING||(t.USE_SKINNING=!0)}(0,fs_extra_1.writeJSONSync)(i.source,e,{spaces:2})}else if("@"===a[a.length-6]){const e=i._name;if(e.indexOf("-skinning")>=0)continue;const o=(0,utils_1.nameToId)(e.slice(0,e.indexOf("."))+"-skinning.material");i.parent&&i.parent.subAssets[o]&&(t.__uuid__=a.slice(0,-6)+"@"+o)}}for(const e of t)if(e._materials&&"cc.SkinningModelComponent"!==e.__type__)for(const a of e._materials){if(!a)continue;const i=a.__uuid__;if(skinningMaterials.has(i)){const a=t[e.node.__id__].name;console.warn(`skinning material '${i}' used on non-skinning model component on node '${a}'`)}}}async function migrateBackSkinningMaterial(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const a of t)if(a._materials&&"cc.SkinningModelComponent"===a.__type__)for(const t of a._materials){const a=t&&t.__uuid__;if("@"===a[a.length-6]){const i=a.slice(0,a.length-6),o=(0,asset_db_1.queryAsset)(i);if(!o)continue;e._assetDB.taskManager.pause(e.task),await o.waitInit(),e._assetDB.taskManager.resume(e.task);const n=a.slice(a.length-5);for(const e in o.subAssets){const a=o.subAssets[e],i=a&&a._name||"";if((0,utils_1.nameToId)(i.slice(0,i.indexOf("."))+"-skinning.material")===n){t.__uuid__=a.uuid;break}}}}}async function migrateSkinningMaterialForMeshSplit(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const a of t)if("cc.SkinningModelComponent"===a.__type__){const t=a._materials;if(!a._mesh)continue;const i=a._mesh.__uuid__,o=i.split("@")[0],n=(0,asset_db_1.queryAsset)(o);if(!n)continue;e._assetDB.taskManager.pause(e.task),await n.waitInit(),e._assetDB.taskManager.resume(e.task);const r=(0,asset_db_1.queryAsset)(i);if(!r)continue;const _=r.library+".json";if((0,fs_extra_1.existsSync)(_)){const e=(0,fs_extra_1.readJsonSync)(_)._struct,a=e.primitives.length,i=t.length;if(i<a){const o=await reader_manager_1.glTfReaderManager.getOrCreate(r.parent);let n=o.processedMeshes.find(t=>{var a;return null===(a=e.jointMaps)||void 0===a?void 0:a.every((e,a)=>e.every((e,i)=>t.jointMaps&&t.jointMaps[a][i]===e))});n||(n=o.processedMeshes.find(t=>e.vertexBundles.every((e,a)=>{var i;return e.view.count===(null===(i=t.geometries[a])||void 0===i?void 0:i.vertexCount)})));const _=n&&n.materialIndices||Array(a).fill(0).map((e,t)=>Math.min(t,i-1)),s=t.slice();for(let e=0;e<a;e++)t[e]=s[_[e]]}}}}const ParticleModule=["cc.ColorOvertimeModule","cc.SizeOvertimeModule","cc.RotationOvertimeModule","cc.ForceOvertimeModule","cc.LimitVelocityOvertimeModule","cc.VelocityOvertimeModule","cc.ShapeModule"];async function migrateParticleModule(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)-1!==ParticleModule.indexOf(e.__type__)&&void 0!==e.enable&&(e._enable=e.enable)}exports.migrateParticleModule=migrateParticleModule;const ParticleModuleName=["colorOverLifetimeModule","sizeOvertimeModule","rotationOvertimeModule","forceOvertimeModule","limitVelocityOvertimeModule","velocityOvertimeModule","shapeModule","trailModule","textureAnimationModule"];async function migrateParticleComponentModule(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.ParticleSystemComponent"===e.__type__&&ParticleModuleName.forEach(t=>{e["_"+t]=e[t],delete e[t]})}async function migrateScrollAndPageViewComponenetModule(e,t){const a=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of a)if(e.__type__===t&&e._content){const t=a[e._content.__id__];if(!t._components)continue;let i=null;for(let e=0;e<t._components.length;++e){const o=t._components[e].__id__;if("cc.UITransformComponent"===a[o].__type__){i=o;break}}e._content.__id__=i}}async function migrateCapsuleColliderHeight(e){(e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source)).forEach(e=>{if("cc.CapsuleColliderComponent"===e.__type__){let t=e._height-2*e._radius;t<0&&(t=0),e._cylinderHeight=t,delete e._height}})}async function migrateShadow(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.SceneGlobals"===e.__type__?e.planarShadows&&(e.shadows=e.planarShadows,delete e.planarShadows):"cc.PlanarShadowInfo"===e.__type__&&(e.__type__="cc.ShadowsInfo")}async function migrateComponentNames(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(let e=0;e<t.length;e++){const a=t[e];let i=a.__type__,o=exports._renameMap[i];o&&(a.__type__=o,i=i.substring(3),o=o.substring(3),a._name=a._name.replace(i,o))}}async function migrateClickEventsNames(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(let e=0;e<t.length;e++){const a=t[e];if("cc.ClickEvent"!==a.__type__)continue;const i=a._componentId,o=exports._renameMap[i];o&&(a._componentId=o)}}exports.migrateParticleComponentModule=migrateParticleComponentModule,exports.migrateScrollAndPageViewComponenetModule=migrateScrollAndPageViewComponenetModule,exports.migrateShadow=migrateShadow,exports._renameMap={"cc.ModelComponent":"cc.MeshRenderer","cc.SkinningModelComponent":"cc.SkinnedMeshRenderer","cc.BatchedSkinningModelComponent":"cc.SkinnedMeshBatchRenderer","cc.CameraComponent":"cc.Camera","cc.AudioSourceComponent":"cc.AudioSource","cc.DirectionalLightComponent":"cc.DirectionalLight","cc.SphereLightComponent":"cc.SphereLight","cc.SpotLightComponent":"cc.SpotLight","cc.LightComponent":"cc.Light","cc.AnimationComponent":"cc.Animation","cc.SkeletalAnimationComponent":"cc.SkeletalAnimation","cc.ParticleSystemComponent":"cc.ParticleSystem","cc.BillboardComponent":"cc.Billboard","cc.LineComponent":"cc.Line","cc.RigidBodyComponent":"cc.RigidBody","cc.BoxColliderComponent":"cc.BoxCollider","cc.SphereColliderComponent":"cc.SphereCollider","cc.CapsuleColliderComponent":"cc.CapsuleCollider","cc.CylinderColliderComponent":"cc.CylinderCollider","cc.ConeColliderComponent":"cc.ConeCollider","cc.PlaneColliderComponent":"cc.PlaneCollider","cc.SimplexColliderComponent":"cc.SimplexCollider","cc.TerrainColliderComponent":"cc.TerrainCollider","cc.MeshColliderComponent":"cc.MeshCollider","cc.HingeConstraintComponent":"cc.HingeConstraint","cc.PointToPointConstraintComponent":"cc.PointToPointConstraint","cc.UITransformComponent":"cc.UITransform","cc.UIModelComponent":"cc.UIMeshRenderer","cc.CanvasComponent":"cc.Canvas","cc.SpriteComponent":"cc.Sprite","cc.LabelComponent":"cc.Label","cc.GraphicsComponent":"cc.Graphics","cc.WidgetComponent":"cc.Widget","cc.ButtonComponent":"cc.Button","cc.MaskComponent":"cc.Mask","cc.ScrollViewComponent":"cc.ScrollView","cc.ScrollBarComponent":"cc.ScrollBar","cc.PageViewComponent":"cc.PageView","cc.PageViewIndicatorComponent":"cc.PageViewIndicator","cc.SliderComponent":"cc.Slider","cc.ToggleContainerComponent":"cc.ToggleContainer","cc.ToggleComponent":"cc.Toggle","cc.RichTextComponent":"cc.RichText","cc.LayoutComponent":"cc.Layout","cc.UIStaticBatchComponent":"cc.UIStaticBatch","cc.UIOpacityComponent":"cc.UIOpacity","cc.LabelOutlineComponent":"cc.LabelOutline","cc.ProgressBarComponent":"cc.ProgressBar","cc.EditBoxComponent":"cc.EditBox","cc.BlockInputEventsComponent":"cc.BlockInputEvents","cc.UICoordinateTrackerComponent":"cc.UICoordinateTracker","cc.SafeAreaComponent":"cc.SafeArea","cc.ViewGroupComponent":"cc.ViewGroup","cc.RenderComponent":"cc.UIRenderable"};const widgetRE=/^cc.Widget$/i;async function migrateCanvasAddWidget(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);try{for(const e of t)if("cc.Canvas"===e.__type__&&!(0,utils_2.getComponent)(t,e.node.__id__,widgetRE)){const a=JSON.parse(JSON.stringify(components_1.Widget));a.node.__id__=e.node.__id__,a._alignFlags=45,t.push(a);const i=t[e.node.__id__];i&&i._components.push({__id__:t.length-1})}}catch(e){console.error(e)}}const _maskMap=new Map;let _times=0;async function migrateCanvasCamera(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);let a=await Editor.Profile.getProject("project","layer");if(a||(a=[]),0===_times){_times++;const e=(0,path_1.join)(__dirname,"../../../../static/migrate-scene-canvas.ts"),t=(0,path_1.join)(Editor.Project.path,"./assets/migrate-canvas.ts");await(0,fs_extra_1.copyFile)(e,t),Manager.AssetWorker.assets.refresh(t);for(const e of a)_maskMap.set(e.value,e.name)}try{for(const e of t)if("cc.Camera"===e.__type__)for(let t=20;t>0;t--){const a=1<<t;!_maskMap.has(a)&&e._visibility&a&&(e._visibility^=a)}let i=0,o="",n=0;for(const r of t)if("cc.Canvas"===r.__type__){const _=20-++i>=_maskMap.size;_||console.warn(`layer is not enough! Please check the scene! [${e.url}]`);const s=t[r.node.__id__];for(let e=20-i;e>=0;e--){if(_maskMap.has(1<<e)&&_)continue;n=1<<e,o=`canvas_${e}`,s._layer=n,a.find(e=>e.value===n)||(a.push({name:o,value:n}),a.sort((e,t)=>e.value-t.value),await Editor.Profile.setProject("project","layer",a));break}if(r.node){preChildSet(t,r.node,n);const e=t.length,a=JSON.parse(getNodeStr());a[0]._name=`UICamera_${t[r.node.__id__]._name}`,a[0]._parent=r.node,a[0]._layer=n,a[0]._id=Editor.Utils.UUID.generate(),t[r.node.__id__]._children.push({__id__:e});const i=t[0]&&"cc.Prefab"===t[0].__type__;i&&(a[0]._prefab={},a[0]._prefab.__id__=e+1),a[0]._components[0].__id__=i?e+2:e+1;let o=null;if(i){(o=JSON.parse(getPrefabInfoStr())[0]).root.__id__=e,o.asset.__id__=0,o.fileId=Editor.Utils.UUID.generate()}const _=JSON.parse(getCameraStr());_[0].node.__id__=e,_[0]._priority=getViewPriority(r,r._priority),_[0]._targetTexture=r._targetTexture,_[0]._clearFlags=void 0!==r._clearFlag?r._clearFlag:6,_[0]._color=void 0!==r._color?JSON.parse(JSON.stringify(r._color)):{__type__:"cc.Color",r:0,g:0,b:0,a:255},_[0]._visibility=1<<23,_[0]._visibility|=1<<25,_[0]._visibility|=n,_[0]._projection=0,_[0]._far=2e3,_[0]._rect={__type__:"cc.Rect",x:0,y:0,width:1,height:1},i&&(_[0].__prefab={},_[0].__prefab.__id__=e+3),_[0]._id=Editor.Utils.UUID.generate();let c=null;if(i){(c=JSON.parse(getCompPrefabInfoStr())[0]).fileId=Editor.Utils.UUID.generate()}if(r._cameraComponent={},r._cameraComponent.__id__=i?e+2:e+1,r._alignCanvasWithScreen=!0,t.push(a[0]),i&&t.push(o),t.push(_[0]),i&&t.push(c),!i&&s&&s._prefab){const e=JSON.parse(getSinglePrefabInfoStr()),i=t[s._prefab.__id__];i&&(e.root.__id__=i.root.__id__,e.asset={__uuid__:i.asset.__uuid__},e.fileId=Editor.Utils.UUID.generate()),t.push(e);const o=t.length-1;a[0]._prefab={__id__:o}}}}}catch(e){console.error(e)}}function preChildSet(e,t,a){for(const i of e[t.__id__]._children)e[i.__id__]._layer=a,preChildSet(e,i,a)}function getViewPriority(e,t){const a=e._renderMode;return 0===a||void 0===a?t|1<<30:t}function getNodeStr(){return'[{"__type__": "cc.Node","_name": "Camera","_objFlags": 0,"_parent": {  "__id__": 1},"_children": [],"_active": true,"_components": [  {    "__id__": 10  }],"_prefab": null,"_lpos": {  "__type__": "cc.Vec3",  "x": 0,  "y": 0,  "z": 0},"_lrot": {  "__type__": "cc.Quat",  "x": 0,  "y": 0,  "z": 0,  "w": 1},"_lscale": {  "__type__": "cc.Vec3",  "x": 1,  "y": 1,  "z": 1},"_layer": 1073741824,"_euler": {  "__type__": "cc.Vec3",  "x": 0,  "y": 0,  "z": 0},"_id": "c9DMICJLFO5IeO07EPon7U"}]'}function getCameraStr(){return'[{"__type__": "cc.Camera","_name": "","_objFlags": 0,"node": {  "__id__": 0},"_enabled": true,"__prefab": null,"_projection": 1,"_priority": 0,"_fov": 45,"_fovAxis": 0,"_orthoHeight": 10,"_near": 1,"_far": 1000,"_color": {  "__type__": "cc.Color",  "r": 51,  "g": 51,  "b": 51,  "a": 255},"_depth": 1,"_stencil": 0,"_clearFlags": 7,"_rect": {  "__type__": "cc.Rect",  "x": 0,  "y": 0,  "width": 1,  "height": 1},"_aperture": 19,"_shutter": 7,"_iso": 0,"_screenScale": 1,"_visibility": 1822425087,"_targetTexture": null,"_id": "7dWQTpwS5LrIHnc1zAPUtf"}]'}function getPrefabInfoStr(){return'[{"__type__": "cc.PrefabInfo","root": {"__id__": 1 },"asset": {"__id__": 0 },"fileId": "deuJTKRANDsKzJ5LeyO/KM"}]'}function getSinglePrefabInfoStr(){return'{"__type__": "cc.PrefabInfo","root": {"__id__": 1 },"asset": {"__uuid__": 0 },"fileId": ""}'}function getCompPrefabInfoStr(){return'[{"__type__": "cc.CompPrefabInfo","fileId": "3cUBXFJqdHqabkl+K4SlQ6"}]'}async function migrateRigidBody(e){(e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source)).forEach(e=>{"cc.RigidBody"===e.__type__&&(0==e._mass?e._type=2:e._isKinematic&&(e._type=4),e._fixedRotation&&(e._angularFactor.x=0,e._angularFactor.y=0,e._angularFactor.z=0))})}async function migrateUICustomMaterial(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(let e=0;e<t.length;e++){const a=t[e];"cc.Sprite"!==a.__type__&&"cc.Label"!==a.__type__&&"cc.Graphics"!==a.__type__&&"cc.Mask"!==a.__type__&&"cc.UIStaticBatch"!==a.__type__||(a._materials&&a._materials.length&&(a._customMaterial=a._materials[0]),delete a._materials)}}async function migrateVisibilityTypeError(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(let e=0;e<t.length;e++){const a=t[e];"cc.Camera"===a.__type__&&(a._visibility=a._visibility-0)}}async function migrateUILayout(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.Layout"===e.__type__&&(void 0!==e._N$layoutType&&(e._layoutType=e._N$layoutType,delete e._N$layoutType),void 0!==e._N$padding&&(e._paddingLeft=e._paddingRight=e._paddingTop=e._paddingBottom=e._N$padding,delete e._N$padding))}async function migratePrefabCompPrefabInfo(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source),a=t[0]&&"cc.Prefab"===t[0].__type__;for(const i of t)"cc.CompPrefabInfo "===i.__type__?i.__type__="cc.CompPrefabInfo":a&&"cc.PrefabInfo"===i.__type__&&1===i.root.__id__&&(null!==i.asset&&i.asset.__uuid__!==e.uuid||(i.asset={__id__:0}))}async function migrateGeometryCurveCurveRange330(e){const t=e.getSwapSpace(),a=new migration_utils_1.Archive(t.json);await(0,migrate_geometry_curve_3_3_0_1.migrateGeometryCurve330)(a),await(0,migrate_curve_range_3_3_0_1.migrateCurveRange330)(a);const i=a.get();t.json=i}async function migrateShadowInfo(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);let a=4096,i=8;for(const e of t)if("cc.ShadowsInfo"===e.__type__&&(e._shadowColor&&(e._saturation=e._shadowColor.a/255),e._size)){const t=e._size,o=cc.math.absMax(t.x,t.y);for(let e=8;e<12;e++){const t=cc.math.bits.abs((1<<e)-o);t<a&&(a=t,i=e)}e._size={__type__:"cc.Vec2",x:1<<i,y:1<<i}}}async function migrateShadowDepthBias(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.ShadowsInfo"===e.__type__&&e._bias&&(e._bias=clamp(1e4*e._bias,.01,1))}async function migratePrivateNode(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source),a=cc.CCObject.Flags.DontSave|cc.CCObject.Flags.HideInHierarchy;for(const e of t)"cc.PrivateNode"===e.__type__&&(e.__type__="cc.Node",e._objFlags|=a)}async function migrateShadowAutoAdapt(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.ShadowsInfo"===e.__type__){"_packing"in e&&delete e._packing,"_linear"in e&&delete e._linear,"_selfShadow"in e&&delete e._selfShadow,"_aspect"in e&&delete e._aspect;const t="_autoAdapt"in e;"_shadowDistance"in e?(e._firstSetCSM=!1,t&&delete e._autoAdapt):t&&(!0===e._autoAdapt?(e._fixedArea=!1,e._firstSetCSM=!0):e._fixedArea=!0,delete e._autoAdapt)}}async function migrateHDRData(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t){if("cc.SkyboxInfo"===e.__type__){const t="_envmapLDR"in e,a="_diffuseMapLDR"in e,i="_diffuseMapHDR"in e,o="_applyDiffuseMap"in e,n="_isRGBE"in e;"_useHDR"in e||(e._useHDR=!0),t||(e._envmapLDR=e._envmap,e._envmapHDR=e._envmap),a||(e._diffuseMapLDR=null),i||(e._diffuseMapHDR=null),n&&delete e._isRGBE,o||(e._applyDiffuseMap=!1)}if("cc.AmbientInfo"===e.__type__){const t=new cc.Color(e._skyColor),a=new cc.Color(e._groundAlbedo),i="_groundAlbedoLDR"in e,o="_skyIllumLDR"in e,n="_skyIllumHDR"in e;"_skyColorLDR"in e||(e._skyColor={__type__:"cc.Vec4",x:0,y:0,z:0,w:0},e._skyColor.x=t.x,e._skyColor.y=t.y,e._skyColor.z=t.z,e._skyColor.w=.520833125,e._skyColorLDR=e._skyColor,e._skyColorHDR=e._skyColor),i||(e._groundAlbedo={__type__:"cc.Vec4",x:0,y:0,z:0,w:0},e._groundAlbedo.x=a.x,e._groundAlbedo.y=a.y,e._groundAlbedo.z=a.z,e._groundAlbedo.w=a.w,e._groundAlbedoLDR=e._groundAlbedo,e._groundAlbedoHDR=e._groundAlbedo),o||(e._skyIllumLDR=e._skyIllum*(1/38400)*1.5),n||(e._skyIllumHDR=e._skyIllum)}if("cc.DirectionalLight"===e.__type__){const t="_illuminanceHDR"in e;"_illuminanceLDR"in e||(e._illuminanceLDR=e._illuminance*(1/38400)),t||(e._illuminanceHDR=e._illuminance)}if("cc.SpotLight"===e.__type__||"cc.SphereLight"===e.__type__){const t="_luminanceHDR"in e;if(!("_luminanceLDR"in e)){const t=1e4;e._luminanceLDR=e._luminance*(1/38400)*t}t||(e._luminanceHDR=e._luminance)}}}async function migrateFogData(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.FogInfo"===e.__type__){const t="_accurate"in e;"_fogColor"in e&&(e._fogColor.r=Math.floor(255*Math.sqrt(e._fogColor.r/255)),e._fogColor.g=Math.floor(255*Math.sqrt(e._fogColor.g/255)),e._fogColor.b=Math.floor(255*Math.sqrt(e._fogColor.b/255))),t||(e._accurate=!1)}}async function migrateSkyLightingTypeData(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.SkyboxInfo"===e.__type__){let t=!1,a=!1;const i="_applyDiffuseMap"in e;"_useIBL"in e&&(t=e._useIBL,delete e._useIBL),i&&(a=e._applyDiffuseMap,delete e._applyDiffuseMap),t?(e._envLightingType=1,a&&(e._envLightingType=2)):e._envLightingType=0}}async function migrateLightBakeable(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.StaticLightSettings"===e.__type__){e._bakeable&&delete e._bakeable}}async function migrateShadowsData(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);let a={};for(const e of t)if("cc.ShadowsInfo"===e.__type__){a={enabled:void 0!==e._enabled&&e._enabled,pcf:void 0===e._pcf?0:e._pcf,bias:void 0===e._bias?0:e._bias,normalBias:void 0===e._normalBias?0:e._normalBias,saturation:void 0===e._saturation?1:e._saturation,shadowDistance:void 0===e._shadowDistance?100:e._shadowDistance,invisibleOcclusionRange:void 0===e._invisibleOcclusionRange?200:e._invisibleOcclusionRange,fixedArea:void 0!==e._fixedArea&&e._fixedArea,near:void 0===e._near?.1:e._near,far:void 0===e._far?10:e._far,orthoSize:void 0===e._orthoSize?5:e._orthoSize},"_firstSetCSM"in e&&delete e._firstSetCSM,"_fixedArea"in e&&delete e._fixedArea,"_pcf"in e&&delete e._pcf,"_bias"in e&&delete e._bias,"_normalBias"in e&&delete e._normalBias,"_near"in e&&delete e._near,"_far"in e&&delete e._far,"_shadowDistance"in e&&delete e._shadowDistance,"_invisibleOcclusionRange"in e&&delete e._invisibleOcclusionRange,"_orthoSize"in e&&delete e._orthoSize,"_saturation"in e&&delete e._saturation,"_aspect"in e&&delete e._aspect;break}for(const e of t)"cc.DirectionalLight"===e.__type__&&(e._shadowEnabled=a.enabled,e._shadowPcf=a.pcf,e._shadowBias=a.bias,e._shadowNormalBias=a.normalBias,e._shadowSaturation=a.saturation,e._shadowDistance=a.shadowDistance,e._shadowInvisibleOcclusionRange=a.invisibleOcclusionRange,e._shadowFixedArea=a.fixedArea,e._shadowNear=a.near,e._shadowFar=a.far,e._shadowOrthoSize=a.orthoSize),"cc.SpotLight"===e.__type__&&(e._shadowEnabled=a.enabled,e._shadowPcf=a.pcf,e._shadowBias=a.bias,e._shadowNormalBias=a.normalBias)}async function migratePunctualLightLuminance(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.SpotLight"===e.__type__||"cc.SphereLight"===e.__type__){const t="_luminanceLDR"in e,a="_luminanceHDR"in e;"_luminance"in e&&(e._luminance*=3.14159),t&&(e._luminanceLDR*=3.14159),a&&(e._luminanceHDR*=3.14159)}}async function migrateCSMData(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.DirectionalLight"===e.__type__){"_shadowFixedArea"in e?e._shadowFixedArea?(e._csmLevel=void 0===e._csmLevel?4:e._csmLevel,e._csmLayerLambda=void 0===e._csmLayerLambda?.75:e._csmLayerLambda,e._csmOptimizationMode=void 0===e._csmOptimizationMode?2:e._csmOptimizationMode):(e._csmLevel=void 0===e._csmLevel?1:e._csmLevel,e._csmLayerLambda=void 0===e._csmLayerLambda?.75:e._csmLayerLambda,e._csmOptimizationMode=void 0===e._csmOptimizationMode?2:e._csmOptimizationMode):(e._shadowFixedArea=!1,e._csmLevel=void 0===e._csmLevel?4:e._csmLevel,e._csmLayerLambda=void 0===e._csmLayerLambda?.75:e._csmLayerLambda,e._csmOptimizationMode=void 0===e._csmOptimizationMode?2:e._csmOptimizationMode);break}}exports.migrateUILayout=migrateUILayout,exports.migratePrefabCompPrefabInfo=migratePrefabCompPrefabInfo,exports.migrateShadowInfo=migrateShadowInfo,exports.migrateShadowDepthBias=migrateShadowDepthBias,exports.migratePrivateNode=migratePrivateNode,exports.migrateShadowAutoAdapt=migrateShadowAutoAdapt,exports.migrateHDRData=migrateHDRData,exports.migrateFogData=migrateFogData,exports.migrateSkyLightingTypeData=migrateSkyLightingTypeData,exports.migrateLightBakeable=migrateLightBakeable,exports.migrateShadowsData=migrateShadowsData,exports.migratePunctualLightLuminance=migratePunctualLightLuminance,exports.migrateCSMData=migrateCSMData;const spriteJson='{\n    "__type__": "cc.Sprite",\n    "_name": "",\n    "_objFlags": 0,\n    "node": null,\n    "_enabled": true,\n    "__prefab": null,\n    "_customMaterial": null,\n    "_srcBlendFactor": 2,\n    "_dstBlendFactor": 4,\n    "_color": {\n      "__type__": "cc.Color",\n      "r": 255,\n      "g": 255,\n      "b": 255,\n      "a": 255\n    },\n    "_spriteFrame": null,\n    "_type": 0,\n    "_fillType": 0,\n    "_sizeMode": 1,\n    "_fillCenter": {\n      "__type__": "cc.Vec2",\n      "x": 0,\n      "y": 0\n    },\n    "_fillStart": 0,\n    "_fillRange": 0,\n    "_isTrimmedMode": true,\n    "_useGrayscale": false,\n    "_atlas": null,\n    "_id": "a5Zd2oPN1CmbHXHJsmc75Z"\n}';async function migrateMaskImageStencil(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.Mask"===e.__type__){const a=e;if(3===e._type&&null!==a._spriteFrame){const e=t[a.node.__id__],i=JSON.parse(spriteJson);i.node=a.node,i._spriteFrame=a._spriteFrame,i._enabled=a._enabled;const o=t.length;if(t.push(i),e._components.push({__id__:o}),i._spriteFrame=a._spriteFrame,i._id=Editor.Utils.UUID.generate(),e._prefab){const e=JSON.parse(getCompPrefabInfoStr())[0];e.fileId=Editor.Utils.UUID.generate(),i._prefab={__id__:t.length},t.push(e)}}delete a._spriteFrame}}async function migrateMaskImageStencilSizeMode(e){var t,a;const i=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of i)if("cc.Mask"===e.__type__){const o=e;for(const e of i)"cc.Sprite"===e.__type__&&(null===(t=e.node)||void 0===t?void 0:t.__id__)===(null===(a=o.node)||void 0===a?void 0:a.__id__)&&(e._sizeMode=0,e._color={__type__:"cc.Color",r:255,g:255,b:255,a:255})}}async function migrateLabelOutlineAndShadow(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.Label"===e.__type__){const a=e;for(const e of t)"cc.LabelOutline"===e.__type__&&e.node.__id__===a.node.__id__&&(a._enableOutline=e._enabled,a._outlineWidth=e._width,a._outlineColor=void 0!==e._color?JSON.parse(JSON.stringify(e._color)):{__type__:"cc.Color",r:0,g:0,b:0,a:255},delete e._width,delete e._color),"cc.LabelShadow"===e.__type__&&e.node.__id__===a.node.__id__&&(a._enableShadow=e._enabled,a._shadowBlur=e._blur,a._shadowOffset=void 0!==e._offset?JSON.parse(JSON.stringify(e._offset)):{__type__:"cc.Vec2",x:2,y:2},a._shadowColor=void 0!==e._color?JSON.parse(JSON.stringify(e._color)):{__type__:"cc.Color",r:0,g:0,b:0,a:255},delete e._blur,delete e._offset,delete e._color)}}async function migrateBakeSettings(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.MeshRenderer"===e.__type__&&e.lightmapSettings&&(e.bakeSettings=e.lightmapSettings,e.lightmapSettings=null),"cc.ModelLightmapSettings"===e.__type__&&(e.__type__="cc.ModelBakeSettings")}async function migrateBloomThreshold(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)if("cc.Bloom"===e.__type__&&"_threshold"in e&&e._threshold){const t=e._threshold;e._threshold=(0,equirect_cubemap_faces_1.linearToSRGB)(t);break}}async function migratePrefabParentNull(e){var t;if(".prefab"!==e.extname)return!0;const a=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);const i=null===(t=a[0])||void 0===t?void 0:t.data;if(!i.__id__)return!1;const o=a[i.__id__];return!!o&&(function e(t,i){if(t._children)for(let o=t._children.length-1;o>=0;o--){const n=t._children[o],r=a[n.__id__];r&&(null===r._parent?(r._parent={__id__:i},t._children.splice(o,1)):e(r,n.__id__))}}(o,i.__id__),!0)}async function migrateFXAA(e){const t=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);for(const e of t)"cc.Fxaa"===e.__type__&&(e.__type__="cc.FXAA")}exports.migrateMaskImageStencil=migrateMaskImageStencil,exports.migrateMaskImageStencilSizeMode=migrateMaskImageStencilSizeMode,exports.migrateLabelOutlineAndShadow=migrateLabelOutlineAndShadow,exports.migrateBakeSettings=migrateBakeSettings,exports.migrateBloomThreshold=migrateBloomThreshold,exports.migratePrefabParentNull=migratePrefabParentNull,exports.migrateFXAA=migrateFXAA;