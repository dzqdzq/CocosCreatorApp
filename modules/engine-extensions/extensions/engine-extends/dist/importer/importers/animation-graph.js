"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateMotionStateSpeed=exports.AnimationGraphImporter=void 0;const asset_db_1=require("@editor/asset-db"),cc_1=require("cc"),new_gen_anim_1=require("cc/editor/new-gen-anim"),_3_5_0_1=require("./migrates/animation-graph/3.5.0"),migrates_1=require("./scene/migrates"),migration_utils_1=require("./utils/migration-utils"),fs_extra_1=require("fs-extra"),utils_1=require("../utils"),_3_8_0_1=require("./migrates/animation-graph/3.8.0");class AnimationGraphImporter extends asset_db_1.Importer{get version(){return"1.2.0"}get name(){return"animation-graph"}get assetType(){return cc_1.js.getClassName(new_gen_anim_1.AnimationGraph)}get assetExtends(){return[cc_1.js.getClassName(cc_1.js.getSuper(new_gen_anim_1.AnimationGraph))]}async import(e){const t=await fs_extra_1.readFile(e.source,"utf8");await e.saveToLibrary(".json",t);const i=utils_1.getDependUUIDList(t);return e.setData("depends",i),!0}get migrationHook(){return migrates_1.migrationHook}get migrations(){return[{version:"1.0.1",migrate:async e=>{const t=e.getSwapSpace(),i=new migration_utils_1.Archive(t.json);migrateMotionStateSpeed(i);const r=i.get();t.json=r}},{version:"1.1.0",migrate:async e=>{const t=e.getSwapSpace(),i=new migration_utils_1.Archive(t.json);_3_5_0_1.migrateVariables(i);const r=i.get();t.json=r}},{version:"1.2.0",migrate:async e=>{const t=e.getSwapSpace(),i=new migration_utils_1.Archive(t.json);_3_8_0_1.migrateAnimationGraph_3_8_0(i);const r=i.get();t.json=r}}]}}function migrateMotionStateSpeed(e){e.visitTypedObject("cc.animation.Motion",e=>{const t=e.speed.value;"number"==typeof t&&(e.speed=t)})}exports.AnimationGraphImporter=AnimationGraphImporter,exports.migrateMotionStateSpeed=migrateMotionStateSpeed;