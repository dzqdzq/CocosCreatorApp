"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateGlTf=void 0;const fs_1=__importDefault(require("fs")),gltf_validator_1=require("gltf-validator");async function validateGlTf(e,s){const t={uri:e,ignoredIssues:[],severityOverrides:{NON_RELATIVE_URI:2,UNDECLARED_EXTENSION:1,ACCESSOR_TOTAL_OFFSET_ALIGNMENT:2}},i=e.endsWith(".glb"),o=await(i?gltf_validator_1.validateBytes(fs_1.default.readFileSync(e),t):gltf_validator_1.validateString(fs_1.default.readFileSync(e).toString())),r=o.issues.messages.filter(e=>!("VALUE_NOT_IN_RANGE"!==e.code||!/\/accessors\/\d+\/count/.test(e.pointer)||"Value 0 is out of range."!==e.message)||!("ROTATION_NON_UNIT"!==e.code||!/\/nodes\/\d+\/rotation/.test(e.pointer)));for(const e of r){switch(e.severity){case 0:--o.issues.numErrors;break;case 1:--o.issues.numInfos}console.debug(`glTf-validator issue(from ${s}) ${JSON.stringify(e)} is ignored.`),o.issues.messages.splice(o.issues.messages.indexOf(e),1)}const a=e=>JSON.stringify(o.issues.messages.filter(s=>s.severity===e),void 0,2);0!==o.issues.numErrors?console.debug(`File ${s} contains errors, `+"this may cause problem unexpectly, please fix them: \n"+`${a(0)}\n`):0!==o.issues.numWarnings?console.debug(`File ${s} contains warnings, `+"the result may be not what you want, please fix them if possible: \n"+`${a(1)}\n`):0===o.issues.numHints&&0===o.issues.numInfos||console.debug(`Logs from ${s}:`+"\n"+`${a(2)}\n`)}exports.validateGlTf=validateGlTf;