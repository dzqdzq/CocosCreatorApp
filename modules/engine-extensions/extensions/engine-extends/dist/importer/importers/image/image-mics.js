"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertHDR=exports.convertPSD=exports.convertTGA=void 0;const path_1=require("path"),child_process_1=require("child_process"),pngjs_1=require("pngjs"),tga_js_1=__importDefault(require("tga-js")),fs_extra_1=require("fs-extra"),psd_js_1=__importDefault(require("psd.js"));async function convertTGA(t){const e=new tga_js_1.default;e.load(t);const r=e.getImageData(),o=new pngjs_1.PNG({width:r.width,height:r.height});return o.data=Buffer.from(r.data),await savePNGObject(o)}async function convertPSD(t){const e=new psd_js_1.default(t);return e.parse(),savePNGObject(e.image.toPng())}async function savePNGObject(t){return new Promise((e,r)=>{const o=[];t.on("data",t=>{o.push(t)}),t.on("end",()=>{e({extName:".png",data:Buffer.concat(o)})}),t.on("error",t=>{r(t)}),t.pack()})}function convertHDR(t,e,r){const o=path_1.join(r,e);let n;return fs_extra_1.ensureDirSync(r),n="darwin"===process.platform?child_process_1.spawn(path_1.join(Editor.App.path,"../tools/cmft/cmftRelease64"),["--bypassoutputtype","--output0params","png,rgbm,latlong","--input",t,"--output0",o]):child_process_1.spawn(path_1.join(Editor.App.path,"../tools/cmft/cmftRelease64.exe"),["--bypassoutputtype","--output0params","png,rgbm,latlong","--input",t,"--output0",o]),new Promise((t,e)=>{n.on("close",()=>{t({extName:".png",source:o+".png"})})})}exports.convertTGA=convertTGA,exports.convertPSD=convertPSD,exports.convertHDR=convertHDR;