"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeNull=exports.getTrimRect=exports.getPixiel=exports.clamp=exports.linkToAssetTarget=exports.i18nTranslate=exports.getDeserializeResult=exports.deserialize=exports.getDependList=exports.getDependUUIDList=void 0;const electron_i18n_1=__importDefault(require("@base/electron-i18n"));function getDependUUIDList(e,t){if("string"==typeof e){let i=e.match(/[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}(@[a-z0-9]+){0,}/g);return i&&(i=JSON.parse(JSON.stringify(Array.from(new Set(i)).filter(e=>e!==t)))),i||[]}return getDeserializeResult(e).uuids}function getDependList(e){if("string"==typeof e){const t=getDependUUIDList(e),i=e.match(/"__type__":\s*"([0-9a-zA-Z+/]{22,23})"/g),r=i&&i.toString().match(/[0-9a-zA-Z+/]{22,23}/g)||[];return{uuids:t,dependScriptUuids:Array.from(new Set(r.map(e=>Editor.Utils.UUID.decompressUUID(e))))}}const t=getDeserializeResult(e);return{uuids:t.uuids,dependScriptUuids:t.dependScriptUuids}}function deserialize(e){return getDeserializeResult(e).instance}function getDeserializeResult(e){const t=new cc.deserialize.Details;t.reset();const i=EditorExtends.MissingReporter.classInstance;i.reset(),i.hasMissingClass=!1;const r=new Set;const s=cc.deserialize(e,t,{classFinder:function(e){return Editor.Utils.UUID.isUUID(e)&&r.add(Editor.Utils.UUID.decompressUUID(e)),i.classFinder(e)}});return t.assignAssetsBy(function(e,t){return EditorExtends.serialize.asAsset(e)}),{instance:s,uuids:t.uuidList,dependScriptUuids:Array.from(r),classFinder:i.classFinder}}function i18nTranslate(e,...t){let i=electron_i18n_1.default.translation(e);if("object"==typeof t[0]){const e=t[0],r=i.match(/{(\w+)}/g);if(r)for(const t of r){const r=t.substr(1,t.length-2);i=i.replace(t,e[r])}}return i}function linkToAssetTarget(e){return`{asset(${e})}`}function clamp(e,t,i){return e<t?t:e>i?i:e}function getPixiel(e,t,i,r){const s=4*t+i*r*4;return{r:e[s],g:e[s+1],b:e[s+2],a:e[s+3]}}function getTrimRect(e,t,i,r){const s=r;let n,o,l=t,a=i,c=0,d=0;for(o=0;o<i;o++)for(n=0;n<t;n++)if(getPixiel(e,n,o,t).a>=s){a=o,o=i;break}for(o=i-1;o>=a;o--)for(n=0;n<t;n++)if(getPixiel(e,n,o,t).a>=s){d=o-a+1,o=0;break}for(n=0;n<t;n++)for(o=a;o<a+d;o++)if(getPixiel(e,n,o,t).a>=s){l=n,n=t;break}for(n=t-1;n>=l;n--)for(o=a;o<a+d;o++)if(getPixiel(e,n,o,t).a>=s){c=n-l+1,n=0;break}return[l,a,c,d]}function removeNull(e,t){let i=!1;for(const r of e){if(r._children&&r._children.length)for(let e=0;e<r._children.length;e++){const s=r._children[e];s||(r._children.splice(e,1),i=!0,console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.node"),value:String(s)})),e--)}if(r._components)for(let e=0;e<r._components.length;e++){const s=r._components[e];s||(r._components.splice(e,1),console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.component"),value:String(s)})),i=!0,e--)}}return i}exports.getDependUUIDList=getDependUUIDList,exports.getDependList=getDependList,exports.deserialize=deserialize,exports.getDeserializeResult=getDeserializeResult,exports.i18nTranslate=i18nTranslate,exports.linkToAssetTarget=linkToAssetTarget,exports.clamp=clamp,exports.getPixiel=getPixiel,exports.getTrimRect=getTrimRect,exports.removeNull=removeNull;