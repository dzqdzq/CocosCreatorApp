"use strict";function clamp(e,n,t){return Math.min(t,Math.max(n,e))}function srgbToLinear(e){return Math.pow(e,2.2)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.InterpolationType=void 0,exports.srgbToLinear=srgbToLinear,exports.linearToSRGB=linearToSRGB,exports.nearestPowerOfTwo=nearestPowerOfTwo,exports.equirectToCubemapFaces=equirectToCubemapFaces;const i255=1/255;function betweenZeroAndOne(e){return i255*e}function linearToSRGB(e){return Math.pow(e,.454545)}const ilog2=1/Math.log(2);function nearestPowerOfTwo(e){return 1<<Math.round(Math.log(e)*ilog2)}var InterpolationType;!function(e){e.BILINEAR="bilinear",e.NEAREST="nearest"}(InterpolationType||(exports.InterpolationType=InterpolationType={}));const DEFAULT_OPTIONS={flipTheta:!1,interpolation:InterpolationType.BILINEAR,isRGBE:!1},rgbe_base=1.1;function floatToRGBE(e,n,t,r,a){var o=Math.max(Math.max(e,n),t),o=Math.ceil(Math.log(o)/Math.log(rgbe_base)),o=Math.min(Math.max(o+128,0),255),i=Math.pow(rgbe_base,o-128);r[a+0]=e/i*255|0,r[a+1]=n/i*255|0,r[a+2]=t/i*255|0,r[a+3]=o}function transformSingleFace(e,n,t,r){var o=r.flipTheta?-1:1,i=0|t.width,b=0|e.width,h=0|e.height,s=e.data,w=r.interpolation===InterpolationType.NEAREST,d=r.isRGBE,l=t.data,g=0|t.width,c=0|t.height,C=0|n,N=2/g,U=2/c;for(let a=0;a<c;++a)for(let r=0;r<g;++r){var T=N*r,p=U*a,A=r+a*i<<2;let e=0,n=0,t=0;switch(C){case 0:e=1,n=1-T,t=1-p;break;case 1:e=-1,n=T-1,t=1-p;break;case 2:e=T-1,n=p-1,t=1;break;case 3:e=T-1,n=1-p,t=-1;break;case 4:e=T-1,n=1,t=1-p;break;case 5:e=1-T,n=-1,t=1-p}var f,u,O,M,Z,m,I,L,x,y,E,R,B,S,P,v=o*Math.atan2(n,e),G=Math.sqrt(e*e+n*n),G=Math.atan2(t,G),v=b/4*2*(v+Math.PI)/Math.PI,G=b/4*2*(Math.PI/2-G)/Math.PI,_=0|Math.floor(v),F=0|Math.floor(G);w?(f=_%b+b*clamp(F,0,h-1)<<2,l[A]=0|s[f],l[1+A]=0|s[1+f],l[2+A]=0|s[2+f],l[3+A]=0|s[3+f]):(f=1+_,P=1+F,v=v-_,G=G-F,S=_%b+b*clamp(F,0,h-1)<<2,F=f%b+b*clamp(F,0,h-1)<<2,_=_%b+b*clamp(P,0,h-1)<<2,P=f%b+b*clamp(P,0,h-1)<<2,u=(1-v)*(1-G),O=v*(1-G),M=(1-v)*G,v=v*G,d?(G=Math.pow(rgbe_base,(0|s[3+S])-128),E=Math.pow(rgbe_base,(0|s[3+F])-128),R=Math.pow(rgbe_base,(0|s[3+_])-128),B=Math.pow(rgbe_base,(0|s[3+P])-128),Z=betweenZeroAndOne(0|s[S])*G,L=betweenZeroAndOne(0|s[1+S])*G,G=betweenZeroAndOne(0|s[2+S])*G,m=betweenZeroAndOne(0|s[F])*E,x=betweenZeroAndOne(0|s[1+F])*E,E=betweenZeroAndOne(0|s[2+F])*E,I=betweenZeroAndOne(0|s[_])*R,y=betweenZeroAndOne(0|s[1+_])*R,R=betweenZeroAndOne(0|s[2+_])*R,floatToRGBE(Z*u+m*O+I*M+betweenZeroAndOne(0|s[P])*B*v,L*u+x*O+y*M+betweenZeroAndOne(0|s[1+P])*B*v,G*u+E*O+R*M+betweenZeroAndOne(0|s[2+P])*B*v,l,A)):(Z=betweenZeroAndOne(0|s[3+S]),m=betweenZeroAndOne(0|s[3+F]),I=betweenZeroAndOne(0|s[3+_]),L=betweenZeroAndOne(0|s[3+P]),x=srgbToLinear(betweenZeroAndOne(0|s[S]))*Z,y=srgbToLinear(betweenZeroAndOne(0|s[1+S]))*Z,G=srgbToLinear(betweenZeroAndOne(0|s[2+S]))*Z,E=srgbToLinear(betweenZeroAndOne(0|s[F]))*m,R=srgbToLinear(betweenZeroAndOne(0|s[1+F]))*m,B=srgbToLinear(betweenZeroAndOne(0|s[2+F]))*m,S=srgbToLinear(betweenZeroAndOne(0|s[_]))*I,F=srgbToLinear(betweenZeroAndOne(0|s[1+_]))*I,_=srgbToLinear(betweenZeroAndOne(0|s[2+_]))*I,S=x*u+E*O+S*M+srgbToLinear(betweenZeroAndOne(0|s[P]))*L*v,F=y*u+R*O+F*M+srgbToLinear(betweenZeroAndOne(0|s[1+P]))*L*v,G=G*u+B*O+_*M+srgbToLinear(betweenZeroAndOne(0|s[2+P]))*L*v,P=1/(_=Z*u+m*O+I*M+L*v),l[3+A]=255*_|0,l[A]=255*linearToSRGB(S*P)|0,l[1+A]=255*linearToSRGB(F*P)|0,l[2+A]=255*linearToSRGB(G*P)|0))}return t}function transformToCubeFaces(n,t,r){if(6!==t.length)throw new Error("facePixArray length must be 6!");for(let e=0;e<6;++e)transformSingleFace(n,e,t[e],r);return t}function imageGetPixels(e){if(e instanceof ImageData)return e;let n=e,t;return"CANVAS"!==n.tagName?((n=document.createElement("canvas")).width=e.width,n.height=e.height,(t=n.getContext("2d")).drawImage(e,0,0,n.width,n.height,0,0,n.width,n.height)):t=n.getContext("2d"),t.getImageData(0,0,n.width,n.height)}async function equirectToCubemapFaces(e,n,t){var r=await e.metadata(),a=await e.raw().toBuffer();let o=null;if(3===r.channels){var i=(r.width||0)*(r.height||0);o=new Uint8Array(4*i);for(let e=0;e<i;++e)o[4*e+0]=a[3*e+0],o[4*e+1]=a[3*e+1],o[4*e+2]=a[3*e+2],o[4*e+3]=255}var e={width:r.width||0,height:r.height||0,data:o?new Uint8Array(o.buffer):new Uint8Array(a.buffer)},b=[];for(let e=0;e<6;++e)b.push({width:n,height:n,data:new Uint8Array(n*n*4)});return transformToCubeFaces(e,b,t=t||DEFAULT_OPTIONS),b}