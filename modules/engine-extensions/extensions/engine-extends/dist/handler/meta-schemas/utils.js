"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDependUUIDList=getDependUUIDList,exports.getDependList=getDependList,exports.deserialize=deserialize,exports.getDeserializeResult=getDeserializeResult,exports.i18nTranslate=i18nTranslate,exports.linkToAssetTarget=linkToAssetTarget,exports.clamp=clamp,exports.getPixiel=getPixiel,exports.getTrimRect=getTrimRect,exports.removeNull=removeNull;const electron_i18n_1=__importDefault(require("@base/electron-i18n"));function getDependUUIDList(t,i){if("string"!=typeof t)return getDeserializeResult(t).uuids;{let e=t.match(/[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}(@[a-z0-9]+){0,}/g);return(e=e&&JSON.parse(JSON.stringify(Array.from(new Set(e)).filter(e=>e!==i))))||[]}}function getDependList(e){var t,i;return"string"==typeof e?(i=getDependUUIDList(e),t=(t=e.match(/"__type__":\s*"([0-9a-zA-Z+/]{22,23})"/g))&&t.toString().match(/[0-9a-zA-Z+/]{22,23}/g)||[],{uuids:i,dependScriptUuids:Array.from(new Set(t.map(e=>Editor.Utils.UUID.decompressUUID(e))))}):{uuids:(i=getDeserializeResult(e)).uuids,dependScriptUuids:i.dependScriptUuids}}function deserialize(e){return getDeserializeResult(e).instance}function getDeserializeResult(e){var t=new cc.deserialize.Details;t.reset();const i=EditorExtends.MissingReporter.classInstance,r=(i.reset(),i.hasMissingClass=!1,new Set);e=cc.deserialize(e,t,{classFinder:function(e){return Editor.Utils.UUID.isUUID(e)&&r.add(Editor.Utils.UUID.decompressUUID(e)),i.classFinder(e)}});return t.assignAssetsBy(function(e,t){return EditorExtends.serialize.asAsset(e)}),{instance:e,uuids:t.uuidList,dependScriptUuids:Array.from(r),classFinder:i.classFinder}}function i18nTranslate(e,...t){let i=electron_i18n_1.default.translation(e);if("object"==typeof t[0]){var r=t[0],e=i.match(/{(\w+)}/g);if(e)for(const s of e){var n=s.substr(1,s.length-2);i=i.replace(s,r[n])}}return i}function linkToAssetTarget(e){return`{asset(${e})}`}function clamp(e,t,i){return e<t?t:i<e?i:e}function getPixiel(e,t,i,r){t=4*t+i*r*4;return{r:e[t],g:e[1+t],b:e[2+t],a:e[3+t]}}function getTrimRect(e,t,i,r){var n=r;let s=t,o=i,a=0,l=0,d,u;for(u=0;u<i;u++)for(d=0;d<t;d++)if(getPixiel(e,d,u,t).a>=n){o=u,u=i;break}for(u=i-1;u>=o;u--)for(d=0;d<t;d++)if(getPixiel(e,d,u,t).a>=n){l=u-o+1,u=0;break}for(d=0;d<t;d++)for(u=o;u<o+l;u++)if(getPixiel(e,d,u,t).a>=n){s=d,d=t;break}for(d=t-1;d>=s;d--)for(u=o;u<o+l;u++)if(getPixiel(e,d,u,t).a>=n){a=d-s+1,d=0;break}return[s,o,a,l]}function removeNull(e,t){let i=!1;for(const s of e){if(s._children&&s._children.length)for(let e=0;e<s._children.length;e++){var r=s._children[e];r||(s._children.splice(e,1),i=!0,console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.node"),value:String(r)})),e--)}if(s._components)for(let e=0;e<s._components.length;e++){var n=s._components[e];n||(s._components.splice(e,1),console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.component"),value:String(n)})),i=!0,e--)}}return i}