"use strict";const{join:join}=require("path"),{readFileSync:readFileSync,existsSync:existsSync,writeFileSync:writeFileSync,readdirSync:readdirSync,statSync:statSync}=require("fs"),configFile=join(__dirname,"../config.json");existsSync(configFile)||(console.error("没有找到 config.json，无法正常构建"),process.exit(-1));try{const e=readFileSync(configFile),n=JSON.parse(e);let i="";i+=`/// <reference path="${join(n.enginePath,"./bin/.declarations/cc.d.ts")}"/>\n`,i+=`/// <reference path="${join(n.enginePath,"/bin/.declarations/cc.editor.d.ts")}"/>\n`,writeFileSync(join(__dirname,"../@types/cc.d.ts"),i)}catch(e){console.error("config.json 格式错误"),console.error(e),process.exit(-1)}process.argv.some(e=>e.startsWith("--only-dts"))&&process.exit(0);const builder=require("@editor/build");function scan(e){readdirSync(e).forEach(n=>{const i=join(e,n);statSync(i).isDirectory()&&builder.addWorkspace(i)})}scan(join(__dirname,"../extensions")),builder.config({entry:".editor.js",config:join(__dirname,".build-cache.json")}),async function(){const e=await builder.executeTask(["tsc","lessc","file","compress"]),n=[];for(const i in e){const o=e[i];for(const e of o)"error"===e.state&&n.push(e)}n.length&&(console.log(["================================================================================","没有正确完成构建任务，请查看日志，并根据建议尝试修复"].join("\n")),n.forEach(e=>{console.log(e)}),console.log(["================================================================================"].join("\n")),process.exit(-1))}();