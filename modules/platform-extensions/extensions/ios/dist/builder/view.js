"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=void 0;const utils_1=require("./utils"),fs_1=require("fs"),path_1=require("path"),lodash=require("lodash");let panel;const defaultOptions={packageName:"",orientation:{portrait:!1,upsideDown:!1,landscapeRight:!0,landscapeLeft:!0},renderBackEnd:{metal:!0,gles3:!0,gles2:!1},osTarget:{iphoneos:!1,simulator:!0},developerTeam:"",targetVersion:"",skipUpdateXcodeProject:!1},methods={t:(e,t)=>Editor.I18n.t(`ios.${e}`,t),changeRenderBackEndType(e){const t=this,a=e.target.value;t.pkgOptions.renderBackEnd="metal"===a?{metal:!0,gles3:!1}:{metal:!1,gles3:!0},t.emitChange("renderBackEndType",t.pkgOptions.renderBackEnd)},async onChange(e){const t=e.target.value,a=e.target.getAttribute("path");lodash.set(this.pkgOptions,a,t);const o=await utils_1.verificationFunc(a,this.pkgOptions[a],panel.options);this.pkgErrorMap[a]=o.error,this.emitChange(a,t,this.pkgErrorMap[a])},emitChange(e,t,a){panel.dispatch("update",`packages.${panel.pkgName}.${e}`,t,a)},init(){const e=this;e.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{targetVersion:"12.0"};for(const t of Object.keys(defaultOptions)){const a=utils_1.verificationFunc(t,e.pkgOptions[t],panel.options);e.pkgErrorMap[t]=a.error}panel.dispatch("update",`packages.${panel.pkgName}`,e.pkgOptions,e.pkgErrorMap)},async updateTeamInfo(){const e=await Editor.Message.request("ios","query-team-info");this.updateTeamList(e)},updateTeamList(e){const t=this;e&&e.length&&(t.developerTeamList=e.map(e=>({value:e.outputValue,label:e.fullValue})),t.pkgOptions.developerTeam||(t.pkgOptions.developerTeam=t.developerTeamList[0].value,t.emitChange("developerTeam",t.pkgOptions.developerTeam)))}};async function mounted(){const e=this;if(e.dev=Editor.App.dev,e.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{},"check"===e.type){const t=await Editor.Profile.getConfig("ios","teamsInfo");return e.updateTeamList(t),void(e.pkgErrorMap={})}e.init();const t=await Editor.Profile.getConfig("ios","teamsInfo");e.updateTeamList(t)}function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)&&"packages.native.JobSystem"!==t||(panel.options=e,panel.vm.init())}function ready(e,t,a,o){panel=this;const p=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.vm=new p({el:panel.$.root,data:()=>({pkgOptions:defaultOptions,pkgErrorMap:defaultOptions,dev:!1,type:t,developerTeamList:[]}),mounted:mounted,methods:methods})}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/view.html"),"utf8"),exports.$={root:".ios"},exports.update=update,exports.ready=ready;