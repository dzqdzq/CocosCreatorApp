"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const utils_1=require("./utils"),fs_1=require("fs"),path_1=require("path"),lodash=require("lodash");let panel;const defaultOptions={packageName:"",orientation:{portrait:!1,upsideDown:!1,landscapeRight:!0,landscapeLeft:!0},renderBackEnd:{metal:!0,gles3:!0,gles2:!1},osTarget:{iphoneos:!1,simulator:!0},developerTeam:"",targetVersion:"",skipUpdateXcodeProject:!1};exports.style="\n.developer-team-select,\n.developer-team-input {\n    margin-bottom: 5px;\n}\n";const methods={t:(e,t)=>Editor.I18n.t(`ios.${e}`,t),changeRenderBackEndType(e){const t=this,a=e.target.value;t.pkgOptions.renderBackEnd="metal"===a?{metal:!0,gles3:!1}:{metal:!1,gles3:!0},t.emitChange("renderBackEndType",t.pkgOptions.renderBackEnd)},async onChange(e){const t=e.target.value,a=e.target.getAttribute("path");if(!a)return;lodash.set(this.pkgOptions,a,t);const p=await utils_1.verificationFunc(a,this.pkgOptions[a],panel.options);this.pkgErrorMap[a]=p.error,this.emitChange(a,t,this.pkgErrorMap[a])},emitChange(e,t,a){panel.dispatch("update",`packages.${panel.pkgName}.${e}`,t,a)},init(){const e=this;e.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{targetVersion:"12.0"};for(const t of Object.keys(defaultOptions)){const a=utils_1.verificationFunc(t,e.pkgOptions[t],panel.options);e.pkgErrorMap[t]=a.error}panel.dispatch("update",`packages.${panel.pkgName}`,e.pkgOptions,e.pkgErrorMap)},developerTeamSelectChanged(e){const t=e.target.value;this.developerTeamSelect=t,this.pkgOptions.developerTeam="custom"===t?"":t,this.emitChange("developerTeam",this.pkgOptions.developerTeam)},async updateTeamInfo(){const e=this,t=await Editor.Message.request("ios","query-team-info");if(t&&t.length){if(e.developerTeamList=t.map(e=>({value:`${e.outputValue}_${e.hash}`,label:e.fullValue,error:e.errorState?`Error: ${e.errorState}`:""})),e.pkgOptions.developerTeam)e.developerTeamSelect=-1===e.developerTeamList.findIndex(t=>t.value===e.pkgOptions.developerTeam)?"custom":e.pkgOptions.developerTeam;else if("new"===e.type){const t=e.developerTeamList.find(e=>!e.error);e.developerTeamSelect=e.pkgOptions.developerTeam=t?t.value:"",e.emitChange("developerTeam",e.pkgOptions.developerTeam)}}else e.developerTeamSelect=e.pkgOptions.developerTeam?"custom":""}};async function mounted(){const e=this;e.dev=Editor.App.dev,e.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{},e.pkgErrorMap={},"check"!==e.type&&e.init(),e.updateTeamInfo()}function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)&&"packages.native.JobSystem"!==t||(panel.options=e,panel.vm.init())}function ready(e,t,a,p){panel=this;const o=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.vm=new o({el:panel.$.root,data:()=>({pkgOptions:defaultOptions,pkgErrorMap:defaultOptions,dev:!1,type:t,developerTeamList:[],developerTeamSelect:""}),mounted:mounted,methods:methods})}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/view.html"),"utf8"),exports.$={root:".ios"},exports.update=update,exports.ready=ready;