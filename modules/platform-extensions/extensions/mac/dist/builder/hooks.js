"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterBundleInit=exports.onAfterInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra");async function onAfterInit(e,a,t){const s=e.packages.mac.renderBackEnd={gles2:!1,gles3:!1,metal:!0},o=e.packages.mac,n=a.compileOptions;n.cMakeConfig.TARGET_OSX_VERSION=`set(TARGET_OSX_VERSION ${o.targetVersion||"10.14"})`,n.cMakeConfig.CUSTOM_COPY_RESOURCE_HOOK=o.skipUpdateXcodeProject,n.cMakeConfig.MACOSX_BUNDLE_GUI_IDENTIFIER=`set(MACOSX_BUNDLE_GUI_IDENTIFIER ${o.packageName})`,n.platformParams.skipUpdateXcodeProject=o.skipUpdateXcodeProject,n.executableName=executableNameOrDefault(n.projectName,e.packages.mac.executableName),n.cMakeConfig.CC_EXECUTABLE_NAME=`set(CC_EXECUTABLE_NAME "${n.executableName}")`,n.platformParams.bundleId=o.packageName,Object.keys(s).forEach(e=>{n.cMakeConfig[`CC_USE_${e.toUpperCase()}`]=s[e]}),n.cMakeConfig.USE_SERVER_MODE=`set(USE_SERVER_MODE ${e.packages.native.serverMode?"ON":"OFF"})`;let c=Number(e.packages.native.netMode);c=e.packages.native.netMode=isNaN(c)||c>2||c<0?0:c,n.cMakeConfig.NET_MODE=`set(NET_MODE ${c})`,await fs_extra_1.outputJSON(a.paths.compileConfig,n),a.staticsInfo.B100005=e.packages.mac.packageName}function onAfterBundleInit(e){var a,t,s;const o=e.packages.mac.renderBackEnd;e.assetSerializeOptions["cc.EffectAsset"].glsl1=null===(a=o.gles2)||void 0===a||a,e.assetSerializeOptions["cc.EffectAsset"].glsl3=null===(t=o.gles3)||void 0===t||t,e.assetSerializeOptions["cc.EffectAsset"].glsl4=null===(s=o.metal)||void 0===s||s;let n=Number(e.packages.native.netMode);n=e.packages.native.netMode=isNaN(n)||n>2||n<0?0:n,e.buildScriptParam.flags.SERVER_MODE=!!e.packages.native.serverMode,e.buildScriptParam.flags.NET_MODE=e.packages.native.netMode,e.buildScriptParam.platform="MAC"}function executableNameOrDefault(e,a){return a||(/^[0-9a-zA-Z_-]+$/.test(e)?`${e}-desktop`:(console.warn(`The provided project name "${e}" is not suitable for use as an executable name. 'CocosGame' is applied instead.`),"CocosGame"))}exports.throwError=!0,exports.onAfterInit=onAfterInit,exports.onAfterBundleInit=onAfterBundleInit;