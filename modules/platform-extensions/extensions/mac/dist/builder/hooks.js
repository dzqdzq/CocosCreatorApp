"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra");async function onAfterInit(e,a,t){var s,o,r;const c=e.packages.mac.renderBackEnd={gles2:!1,gles3:!1,metal:!0};e.assetSerializeOptions["cc.EffectAsset"].glsl1=null===(s=c.gles2)||void 0===s||s,e.assetSerializeOptions["cc.EffectAsset"].glsl3=null===(o=c.gles3)||void 0===o||o,e.assetSerializeOptions["cc.EffectAsset"].glsl4=null===(r=c.metal)||void 0===r||r;const i=e.packages.mac,n=a.compileOptions;n.cMakeConfig.TARGET_OSX_VERSION=`set(TARGET_OSX_VERSION ${i.targetVersion||"10.14"})`,n.cMakeConfig.CUSTOM_COPY_RESOURCE_HOOK=i.skipUpdateXcodeProject,n.cMakeConfig.MACOSX_BUNDLE_GUI_IDENTIFIER=`set(MACOSX_BUNDLE_GUI_IDENTIFIER ${i.packageName})`,n.platformParams.skipUpdateXcodeProject=i.skipUpdateXcodeProject,n.platformParams.bundleId=i.packageName,Object.keys(c).forEach(e=>{n.cMakeConfig[`CC_USE_${e.toUpperCase()}`]=c[e]}),n.cMakeConfig.USE_SERVER_MODE=`set(USE_SERVER_MODE ${e.packages.native.serverMode?"ON":"OFF"})`;const E=Number(e.packages.native.netMode);e.buildScriptParam.flags.SERVER_MODE=!!e.packages.native.serverMode,e.buildScriptParam.flags.NET_MODE=isNaN(E)||E>2||E<0?0:E,n.cMakeConfig.NET_MODE=`set(NET_MODE ${e.buildScriptParam.flags.NET_MODE})`,await fs_extra_1.outputJSON(a.paths.compileConfig,n);const p={packageName:e.packages.mac.packageName};t.__addStaticsInfo(p)}exports.throwError=!0,exports.onAfterInit=onAfterInit;