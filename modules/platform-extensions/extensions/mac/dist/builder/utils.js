"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.modifyPackageName=exports.checkPackageNameValidity=exports.changePackageName=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra");async function changePackageName(e,a){const t=(0,path_1.join)(e,".cocos-project.json");if(!(0,fs_extra_1.existsSync)(t))return void console.error(`Can't find project json [${t}]`);const c=await(0,fs_extra_1.readJSON)(t);if(!checkPackageNameValidity(a=a||c.packageName))return void console.error("The package name is illegal(MAC). It can only contain these characters: [0-9], [a-z], [A-Z], [_].");let r=c.packageName;c.mac&&c.mac.packageName&&(r=c.mac.packageName);const o=r!==a;if(!o)return;const i=(0,path_1.join)(e,"cocos-project-template.json");if(!(0,fs_extra_1.existsSync)(i))return void console.error(`Can't find template json [${i}]`);const n=(await(0,fs_extra_1.readJSON)(i)).do_add_native_support;let s;if(o){s=n.project_replace_mac_bundleid.files;for(const t of s){const c=(0,path_1.join)(e,t);if(!(0,fs_extra_1.existsSync)(c)){console.error(`Can't not find file [${t}], replace package name failed`);continue}let o=await(0,fs_extra_1.readFile)(c,"utf8");o=o.replace(new RegExp(r,"gm"),a),await(0,fs_extra_1.writeFile)(c,o)}}c.mac||(c.mac={}),c.mac.packageName=a,await(0,fs_extra_1.writeFile)(t,JSON.stringify(c,null,2))}function checkPackageNameValidity(e){return/^[a-zA-Z]+([a-zA-Z0-9-.])+$/.test(e)}function modifyPackageName(e){return e}exports.changePackageName=changePackageName,exports.checkPackageNameValidity=checkPackageNameValidity,exports.modifyPackageName=modifyPackageName;