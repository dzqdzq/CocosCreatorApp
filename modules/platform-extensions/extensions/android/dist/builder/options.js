"use strict";function checkPackageNameValidity(e){return/^[a-zA-Z]\w*(\.[a-zA-Z]\w*)+$/.test(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkIsEmpty=exports.getVerifyMap=exports.checkAndroidAPILevels=exports.verificationFunc=exports.translate=exports.defaultOptions=exports.checkPackageNameValidity=void 0,exports.checkPackageNameValidity=checkPackageNameValidity;const MaxAspectRatioOptRegex=/^\s*(\d+(\.\d+)?)\s*(\(\s*(\d+)\s*:\s*(\d+)\s*\)\s*)?$/,MaxAspectRatioFractionRegex=/^\s*(\d+)\s*:\s*(\d+)\s*$/;function translate(e){return Editor.I18n.t(`android.${e}`)}async function verificationFunc(e,t,r){const a={error:"",newValue:t,level:"error"};switch(e){case"packageName":if(checkIsEmpty(t)){a.newValue=exports.defaultOptions.packageName,a.error=translate("tips.not_empty");break}checkPackageNameValidity(t)||(a.newValue=exports.defaultOptions.packageName,a.error=translate("tips.package_name_error"));break;case"appABIs":if(!t||!t.length)return a.error=translate("tips.at_least_one"),a;break;case"renderBackEnd":if(!t)return a.error=translate("tips.not_empty"),a;if(Object.keys(t).every(e=>!t[e]))return a.error=translate("tips.at_least_one"),a;break;case"apiLevel":return await checkAndroidAPILevels(t,r);case"maxAspectRatio":if(!r.packages.android.resizeableActivity){if(!t||0===t.trim().length)return a.error=translate("tips.mar_empty"),a;const e=1.33,r=t.match(MaxAspectRatioOptRegex),s=(t,r)=>{const s=Number.parseInt(t),n=Number.parseInt(r);if(0===s||0===n||s/n<e)return a.error=translate("tips.mar_bad_value"),a};if(r)return r[3]?(a.newValue=`${r[4]}:${r[5]}`,s(r[4],r[5])):(a.newValue=r[1],Number.parseFloat(a.newValue)<e&&(a.error=translate("tips.mar_bad_value"))),a;const n=t.match(MaxAspectRatioFractionRegex);return n?(a.newValue=`${n[1]}:${n[2]}`,s(n[1],n[2]),a):(a.error=translate("tips.mar_format"),a)}break;case"orientation":if(!t)return a.error=translate("tips.not_empty"),a;if(Object.keys(t).every(e=>!t[e]))return a.error=translate("tips.at_least_one"),a;break;case"keystorePath":if(r.packages.android.useDebugKeystore)break;checkIsEmpty(t)&&(a.error=translate("KEYSTORE.error.keystore_path_empty"));break;case"keystorePassword":case"keystoreAlias":case"keystoreAliasPassword":if(r.packages.android.useDebugKeystore)break;checkIsEmpty(t)&&(a.error=translate("tips.not_empty"));break;case"remoteUrl":if(!r.packages.android.androidInstant||checkIsEmpty(t))return a;t.startsWith("http")||(a.error="remoteUrl  should start with http")}return a}async function checkAndroidAPILevels(e,t){const r={newValue:e,error:"",level:"error"};if(checkIsEmpty(e)&&(r.error="API Level"+translate("tips.not_empty")),isNaN(e))return r.error="API Level"+translate("tips.not_empty"),r;const a=e;return t.packages.android.androidInstant&&a<23?(r.error=Editor.I18n.t("android.tips.when_enable_instant")+Editor.I18n.t("android.tips.apilevel_limit",{version:"23"}),r.newValue=23,r):"tbb"===t.packages.native.JobSystem&&a<21?(r.error=Editor.I18n.t("android.tips.when_enable_tbb")+Editor.I18n.t("android.tips.apilevel_limit",{version:"21"}),r.newValue=21,r):"5d45ba66-829a-46d3-948e-2ed3fa7ee421"===await Editor.Profile.getProject("project","general.renderPipeline")&&a<21?(r.error=Editor.I18n.t("android.tips.when_enable_deferred")+Editor.I18n.t("android.tips.apilevel_limit",{version:"21"}),r.newValue=21,r):a<19?(r.error=Editor.I18n.t("android.tips.apilevel_limit",{version:"19"}),r.newValue=19,r):r}function getVerifyMap(){const e={};return["packageName","apiLevel","keystorePath","keystorePassword","keystoreAlias","keystoreAliasPassword"].forEach(t=>{e[t]=((e,r)=>verificationFunc(t,e,r))}),e}function checkIsEmpty(e){return null===e||void 0===e||""===e}exports.defaultOptions={packageName:"",resizeableActivity:!0,maxAspectRatio:"2.4",orientation:{portrait:!1,upsideDown:!1,landscapeRight:!0,landscapeLeft:!0},apiLevel:26,appABIs:["arm64-v8a"],useDebugKeystore:!0,keystorePath:"",keystorePassword:"",keystoreAlias:"",keystoreAliasPassword:"",appBundle:!1,androidInstant:!1,inputSDK:!1,remoteUrl:"",sdkPath:"",ndkPath:"",javaHome:"",javaPath:"",renderBackEnd:{vulkan:!1,gles3:!0,gles2:!0},swappy:!1},exports.translate=translate,exports.verificationFunc=verificationFunc,exports.checkAndroidAPILevels=checkAndroidAPILevels,exports.getVerifyMap=getVerifyMap,exports.checkIsEmpty=checkIsEmpty;