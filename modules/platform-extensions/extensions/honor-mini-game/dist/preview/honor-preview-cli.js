"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.previewManager=void 0;const path_1=require("path"),fs_1=require("fs"),share_1=require("../share"),express=require("express"),app=express();class PreviewManager{constructor(){this.isOpen=!1}async run(e,r){var s,i,t;this.isOpen?console.warn("honor multiple preview services are enabled, turn off others!"):(0,fs_1.existsSync)(e)?(s=(0,path_1.dirname)(e),app.use(express.static(s)),i=await Editor.Message.request("preview","get-preview-ip"),t=await Editor.Network.getFreePort(7456),app.listen(t,i,async()=>{console.log(`honor server listening at http://${i}:`+t);var e=await Editor.Profile.getConfig(share_1.PLATFORM_NAME,"builder"),e=`http://${i}:`+t+`/${null==e?void 0:e.common.name}.rpk`;this.isOpen=!0,r(null,e)}).on("error",e=>{console.error("honor server failed to start:",e),this.isOpen=!1,r(e)})):console.error(`honor rpk (${e}) does not exist, please build before preview!`)}kill(){this.isOpen=!1}}exports.previewManager=new PreviewManager;