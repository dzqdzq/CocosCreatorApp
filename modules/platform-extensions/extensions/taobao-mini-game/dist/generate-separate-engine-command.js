"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateSeparateEngine=generateSeparateEngine,exports.changePluginJSON=changePluginJSON;const fs_extra_1=require("fs-extra"),path_1=require("path");async function generateSeparateEngine(e){var e=e?(0,path_1.join)(e,"app"):(0,path_1.join)(__dirname,"../../../../"),a=(0,path_1.join)(e,"../resources/3d/engine"),n=require((0,path_1.join)(e,"builtin/builder/dist/worker/builder/asset-handler/script/separate-engine"))["buildCocos"],n=await n({engine:a,platform:require("../package.json").name,platformType:"TAOBAO_MINIGAME",pluginFeatures:"default",pluginName:"cocos",nativeCodeBundleMode:"asmjs",signatureProvider:require("./../static/cocos/signature.json").pluginId});let t=require((0,path_1.join)(e,"package.json")).version;t=t.replaceAll(".","");a=new Date,e=require((0,path_1.join)(__dirname,"../package.json"));e.contributions.profile.editor["plugin-version"].default=`${a.getFullYear()}.${(a.getMonth()+1).toString()}${a.getDate().toString().padStart(2,"0")}.`+t,(0,fs_extra_1.outputJsonSync)(__dirname+"../package.json",e),await changePluginJSON(n,n.plugin);let i=0;return function a(n){var e=(0,fs_extra_1.statSync)(n);e.isDirectory()?(0,fs_extra_1.readdirSync)(n).forEach(e=>{a((0,path_1.join)(n,e))}):i+=e.size}(n.plugin),console.log("淘宝引擎插件包体大小："+(i/1024/1024).toFixed(2)+" M"),n}async function changePluginJSON(e,a){await(0,fs_extra_1.copy)((0,path_1.join)(__dirname,"../static/cocos/plugin.json"),(0,path_1.join)(a,"plugin.json"));var n=require("../static/cocos/signature.json");n.signature=require(e.signatureJSON).signature,await(0,fs_extra_1.outputJSON)((0,path_1.join)(a,"signature.json"),n)}