"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),options_1=require("./options"),lodash=require("lodash");let panel;exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../static/builder/view.html"),"utf8");const methods={t:(t,e)=>Editor.I18n.t(`openharony.${t}`,e),async onSetSDK(){Editor.Message.send("preferences","open-settings","program")},getDefaultPackageName:()=>options_1.defaultOptions.packageName,async onChange(t){const e=t.target.value,p=t.target.getAttribute("path");await this.onUpdateOptions(p,e)},async onUpdateOptions(t,e){if(!t)return;"apiLevel"===t&&(e=Number(e)),lodash.set(this.pkgOptions,t,e);const p=await(0,options_1.verificationFunc)(t,e,panel.options);this.pkgErrorMap[t]=p.error,this.emitChange()},async onChangeABI(t,e){const p=this,a=t.target.value;Array.isArray(p.pkgOptions.appABIs)||(p.pkgOptions.appABIs=[]),a?p.pkgOptions.appABIs.push(e):p.pkgOptions.appABIs.splice(p.pkgOptions.appABIs.indexOf(e),1),await p.onUpdateOptions("appABIs",p.pkgOptions.appABIs)},emitChange(){panel.dispatch("update",`packages.${this.pkgName}`,this.pkgOptions,this.pkgErrorMap)},async init(){const t=this;t.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{};for(const e of Object.keys(options_1.defaultOptions)){const p=await(0,options_1.verificationFunc)(e,t.pkgOptions[e],panel.options);t.pkgErrorMap[e]=p.error}this.emitChange()}};async function update(t,e){panel=this,e&&!e.startsWith(`packages.${panel.pkgName}`)||(panel.options=t,panel.vm.init())}function ready(t,e,p,a){panel=this;const o=BuildPanel.Vue;panel.options=t,panel.pkgName=p,panel.errorMap=a,panel.vm=new o({el:panel.$.root,data:()=>({pkgName:p,type:e,pkgOptions:options_1.defaultOptions,pkgErrorMap:options_1.defaultOptions,apiLevels:[],appABIList:["armeabi-v7a","arm64-v8a"]}),async mounted(){const t=this;if("check"===t.type)return t.pkgOptions=lodash.get(panel.options,`packages.${panel.pkgName}`)||{},void(t.pkgErrorMap={});t.init()},methods:methods})}function getAPILevels(){if(!process.env.OHOS_SDK_HOME)return console.warn(Editor.I18n.t("openharmony.tips.sdk_home_empty")),[];const t=(0,path_1.join)(process.env.OHOS_SDK_HOME,"ets"),e=[];try{return(0,fs_extra_1.readdirSync)(t).forEach(p=>{const a=(0,fs_extra_1.readJSONSync)((0,path_1.join)(t,p,"oh-uni-package.json"));e.push(a.apiVersion)}),e}catch(t){console.warn(t)}return e}exports.$={root:".openharmony"},exports.update=update,exports.ready=ready;