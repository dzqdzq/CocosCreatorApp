"use strict";const join=require("path")["join"],exec=require("child_process")["exec"],fsExt=require("fs-extra");function forceCopyFileSync(e,t){e=fsExt.readFileSync(e,"utf8");fsExt.outputFileSync(t,e,{encoding:"utf8"})}function readJsonSync(e){e=fsExt.readFileSync(e,"utf8");return JSON.parse(e)}function runCommand(n,o){return new Promise((e,i)=>{console.log(`Running command: '${n}' in '${o}'
`);const t=exec(n,{cwd:o},(e,t,n)=>{e?i(e):(t&&console.log(t),n&&console.error(n))});t.on("close",()=>{e(t.exitCode)}),t.stderr.on("data",e=>{console.error(e)})})}exports.tsc=function(){return["./"]},exports.generate=async function(){var e=readJsonSync(join(__dirname,"static","local-commit.json")).commit;const t=join(__dirname,"runtime-web-adapter-private"),n=join(__dirname,"static","adapter");try{console.time("Fetch RAL"),await fsExt.removeSync(n),await fsExt.removeSync(t);try{0!==await runCommand("git clone git@github.com:cocos/runtime-web-adapter-private.git",__dirname)&&(await fsExt.removeSync(t),await runCommand("git clone https://github.com/cocos/runtime-web-adapter-private",__dirname))}catch(e){await fsExt.removeSync(t),await runCommand("git clone https://github.com/cocos/runtime-web-adapter-private",__dirname)}await runCommand("git reset --hard "+e,t),await runCommand("npm install",t),await runCommand("gulp lib-web",t),await runCommand("gulp lib-migu",t),["web-adapter.js","web-adapter.min.js"].forEach(e=>{forceCopyFileSync(join(t,"dist/common",e),join(n,e))}),["ral.js","ral.min.js"].forEach(e=>{forceCopyFileSync(join(t,"dist/platforms","migu-mini-game",e),join(n,"migu-mini-game",e))}),await fsExt.removeSync(t),console.timeEnd("Fetch RAL")}catch(e){throw new Error(e)}},exports.lessc=function(){return[{source:"./static/style/migu-preview.less",dist:"./dist/migu-preview.css"}]},exports.unpacked=function(){return["./static"]};