"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.configs=exports.load=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),electron_1=require("electron"),xcode_proj_injection_1=require("../xcode-proj-injection"),utils_1=require("./utils"),astcTypes=["astc_4x4","astc_5x5","astc_6x6","astc_8x8","astc_10x5","astc_10x10","astc_12x12"];async function load(){await Editor.Profile.getConfig("utils","features.ios-app-clip")||(exports.configs["ios-app-clip"]={})}exports.load=load,exports.configs={"ios-app-clip":{platformName:"iOS App Clip",options:{mainPackagePath:{label:"i18n:ios-app-clip.options.ios_app_path",verifyRules:["required","ios-app-path"],description:"i18n:ios-app-clip.options.ios_app_path_hint",render:{ui:"ui-file",attributes:{type:"directory",placeholder:"i18n:ios-app-clip.options.ios_app_path_hint"}}},embedXcodeprojTarget:{label:"i18n:ios-app-clip.options.embed_xcodeproj_target",description:"i18n:ios-app-clip.options.embed_xcodeproj_target_hint",verifyRules:["xcodeproj-path"],render:{ui:"ui-file",attributes:{type:"file",placeholder:"i18n:ios-app-clip.options.embed_xcodeproj_target_hint"}}},remoteServerAddress:{label:"i18n:ios-app-clip.options.remote_server_address",description:"i18n:ios-app-clip.options.remote_server_address_tips",render:{ui:"ui-input",attributes:{placeholder:"i18n:ios-app-clip.options.remote_server_address_tips"}},verifyRules:["http"]},orientation:{label:"Orientation",type:"object",default:{portrait:!0},attributes:{class:"wrap"},itemConfigs:{portrait:{label:"Portrait",default:!0,render:{ui:"ui-checkbox"}},landscapeLeft:{label:"Landscape Left",default:!1,render:{ui:"ui-checkbox"}},landscapeRight:{label:"Landscape Right",default:!1,render:{ui:"ui-checkbox"}}}},polyfills:{label:"Polyfills",type:"object",attributes:{class:"wrap"},itemConfigs:{asyncFunctions:{label:"i18n:native.options.async_functions",description:"i18n:native.options.async_functions_tips",default:!0,render:{ui:"ui-checkbox"}}}}},hooks:"./hooks",textureCompressConfig:{platformType:"ios",support:{rgb:["pvrtc_4bits_rgb","pvrtc_2bits_rgb",...astcTypes],rgba:["pvrtc_4bits_rgb_a","pvrtc_4bits_rgba","pvrtc_2bits_rgb_a","pvrtc_2bits_rgba",...astcTypes]}},assetBundleConfig:{supportedCompressionTypes:["none","merge_dep","merge_all_json"]},commonOptions:{buildPath:!1},verifyRuleMap:{"ios-app-path":{func:(e,i)=>!(!e||!fs_extra_1.existsSync(e)),message:"i18n:ios-app-clip.tips.ios_app_path_error"},"xcodeproj-path":{func:(e,i)=>{const t=i.packages["ios-app-clip"].mainPackagePath;if(!e)return!0;if(!e.endsWith(".xcodeproj"))return!1;const o=path_1.join(Editor.App.path,"../resources/3d/engine/native"),p=path_1.join(o,"templates/js-template-link/frameworks/runtime-src/proj.ios_mac"),r=utils_1.findXcodeProjects(p);if(1!==r.length)throw new Error(`${r.length} Xcode projects found in ${p}, 1 expected`);try{new xcode_proj_injection_1.XcodeProjModifer({appName:"_AppClip",doBackup:!0,refXcodeProject:path_1.join(p,r[0]),inputXcodeProj:e,cocosRoot:o,projectResDir:t})}catch(e){if(e.message.indexOf("already loaded")<0)return console.error(`${e.message}`),!1}return!0},message:"i18n:ios-app-clip.tips.xcodeproj_path_error"}},realInFileExplorer:e=>{if(!e.packages["ios-app-clip"].mainPackagePath)return void console.error("mainPackagePath");const i=path_1.join(e.packages["ios-app-clip"].mainPackagePath,"ios-app-clip");fs_extra_1.existsSync(i)?electron_1.shell.openExternal(i):console.error(`${i} is not exist!`)}}};