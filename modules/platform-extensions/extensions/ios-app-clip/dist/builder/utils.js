"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findXcodeProjects=exports.getBrowserslistQuery=exports.createBundle=exports.outputJSBAdapter=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),babelify=require("babelify"),browserify=require("browserify");async function outputJSBAdapter(e,t){const{targets:r}=t||{},s=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/builtin/index.js"),n=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/engine/index.js");await createBundle(s,path_1.join(e,"jsb-adapter","jsb-builtin.js"),{targets:r}),await createBundle(n,path_1.join(e,"jsb-adapter","jsb-engine.js"),{targets:r})}async function createBundle(e,t,r){let s,n;Array.isArray(r)?s=r:r&&(s=r.excludes,n=r.targets);let o=browserify(e);return s&&s.forEach(function(e){o.exclude(e)}),await fs_extra_1.ensureDir(path_1.dirname(t)),new Promise((e,r)=>{o.transform(babelify,{presets:[[require("@babel/preset-env"),{targets:n}]]}).bundle((s,n)=>{if(s)return console.error(s),void r(s);fs_extra_1.writeFileSync(t,n,"utf8"),e()})})}async function getBrowserslistQuery(e){const t=path_1.join(e,".browserslistrc");let r;try{r=await fs_extra_1.readFile(t,"utf8")}catch(e){return}const s=function(e){const t=[];for(const r of e.split("\n")){let e=r.indexOf("#");const s=(e<0?r:r.substr(0,e)).trim();0!==s.length&&t.push(s)}return t}(r);if(0!==s.length)return s.join(" or ")}function findXcodeProjects(e){return fs_extra_1.readdirSync(e).filter(e=>e.endsWith(".xcodeproj"))}exports.outputJSBAdapter=outputJSBAdapter,exports.createBundle=createBundle,exports.getBrowserslistQuery=getBrowserslistQuery,exports.findXcodeProjects=findXcodeProjects;