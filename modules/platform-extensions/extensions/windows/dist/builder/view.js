"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.update=exports.ready=exports.$=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("./utils"),lodash=require("lodash");let panel;const defaultOptions={renderBackEnd:{vulkan:!1,gles3:!0,gles2:!1}};function ready(e,t,a,n){panel=this;const s=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.errorMap=n,panel.vm=new s({el:panel.$.root,data:()=>({pkgOptions:defaultOptions,pkgErrorMap:{},vsData:[]}),mounted(){this.init()},methods:{t:(e,t)=>Editor.I18n.t(`windows.${e}`,t),async init(){const e=this;e.pkgOptions=lodash.get(panel.options,"packages.windows")||{};const t=await Editor.Profile.getConfig("windows","vsData");if(t)e.vsData=t;else{e.vsData=[];const t=await utils_1.queryVisualStudioVersion();e.vsData=t||[];const a=t.length>0?t[0].value:"";lodash.set(panel.options,"packages.windows.vsData",a),await Editor.Profile.setConfig("windows","vsData",e.vsData)}const a=await verificationFunc("renderBackEnd",e.pkgOptions.renderBackEnd);e.$set(e.pkgErrorMap,"renderBackEnd",a.error),e.emitChange()},async onGLES23Change(e){const t=this,a=e.target.value;t.pkgOptions.renderBackEnd=a?Object.assign(t.pkgOptions.renderBackEnd,{gles3:!0}):Object.assign(t.pkgOptions.renderBackEnd,{gles2:!1,gles3:!1});const n=await verificationFunc("renderBackEnd",t.pkgOptions.renderBackEnd);t.$set(t.pkgErrorMap,"renderBackEnd",n.error),panel.dispatch("update",`packages.${panel.pkgName}.renderBackEnd`,t.pkgOptions.renderBackEnd,n.error)},async onChange(e){const t=this,a=e.target.value,n=e.target.getAttribute("path");if(lodash.set(t.pkgOptions,n,a),n&&n.startsWith("renderBackEnd.")){const e=await verificationFunc("renderBackEnd",t.pkgOptions.renderBackEnd);t.$set(t.pkgErrorMap,"renderBackEnd",e.error)}t.emitChange()},async onVsData(e){const t=await utils_1.queryVisualStudioVersion();this.vsData=t||[];const a=t.length>0?t[0].value:"";lodash.set(panel.options,"packages.windows.vsData",a),await Editor.Profile.setConfig("windows","vsData",this.vsData)},emitChange(){panel.dispatch("update",`packages.${panel.pkgName}`,this.pkgOptions,this.pkgErrorMap)}}})}function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)||(panel.options=e,panel.vm.init())}async function verificationFunc(e,t){const a={error:"",newValue:t,level:!0};switch(e){case"renderBackEnd":Object.keys(t).every(e=>!t[e])&&(a.error=Editor.I18n.t("windows.tips.at_least_one"))}return a}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/view.html"),"utf8"),exports.$={root:".windows"},exports.ready=ready,exports.update=update;