"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[r.length]=t);return r})(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),a=0;a<r.length;a++)"default"!==r[a]&&__createBinding(t,e,r[a]);return __setModuleDefault(t,e),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.queryVisualStudioVersion=queryVisualStudioVersion,exports.executableNameOrDefault=executableNameOrDefault;const path_1=require("path"),fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),os=__importStar(require("os"));async function queryCmake(){var e=await Editor.Message.request("program","query-program-info","cmake"),e=e?e.path:"";return e||(0,path_1.join)(Editor.App.path,"../tools/cmake/bin/cmake.exe")}async function queryVisualStudioVersion(){const i=await queryCmake();var o,e=os.tmpdir(),t=[["-G",'"Visual Studio 17 2022"'],"2022",["-G",'"Visual Studio 16 2019"'],"2019",["-G",'"Visual Studio 15 2017"',"-A","x64"],"2017",["-G",'"Visual Studio 14 2015"',"-A","x64"],"2015"],e=await(0,fs_extra_1.mkdtemp)((0,path_1.join)(e,"cmake-vs")),r=(console.log("Create temp dir "+e),(0,path_1.join)(e,"CMakeLists.txt")),a=(0,path_1.join)(e,"hello.cpp"),n=(await(0,fs_extra_1.writeFile)(r,`
	cmake_minimum_required(VERSION 3.8)
	project(hello CXX)
	add_executable(hello hello.cpp)
	`),await(0,fs_extra_1.writeFile)(a,`
	#include <iostream>
	int main(int argc, char **argv) {
	std::cout << "hello cocos" << std::endl;
	return 0;
	}
	`),[]),u=(o=e,async(t,a)=>new Promise((r,e)=>{return(0,child_process_1.spawn)(i,t.concat("-B build_"+a),{cwd:o,shell:!0}).on("close",(e,t)=>{r(0==e)}),!1}));for(let e=0;e<t.length;e+=2){var s=t[e],c=t[e+1];await u(s.concat("-S."),c)&&n.push({name:"Visual Studio "+c,value:c})}return n}function executableNameOrDefault(e,t){return t||(/^[0-9a-zA-Z_-]+$/.test(e)?e:"CocosGame")}