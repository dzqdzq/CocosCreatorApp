"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,o)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.queryVisualStudioVersion=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),os=__importStar(require("os"));async function queryCmake(){const e=await Editor.Message.request("program","query-program-info","cmake"),t=e?e.path:"";return t||(0,path_1.join)(Editor.App.path,"../tools/cmake/bin/cmake.exe")}async function queryVisualStudioVersion(){const e=await queryCmake(),t=os.tmpdir(),i=[["-G",'"Visual Studio 17 2022"'],"2022",["-G",'"Visual Studio 16 2019"'],"2019",["-G",'"Visual Studio 15 2017"',"-A","x64"],"2017",["-G",'"Visual Studio 14 2015"',"-A","x64"],"2015"],r=await(0,fs_extra_1.mkdtemp)((0,path_1.join)(t,"cmake-vs"));console.log(`Create temp dir ${r}`);const o=(0,path_1.join)(r,"CMakeLists.txt"),a=(0,path_1.join)(r,"hello.cpp");await(0,fs_extra_1.writeFile)(o,"\n\tcmake_minimum_required(VERSION 3.8)\n\tproject(hello CXX)\n\tadd_executable(hello hello.cpp)\n\t"),await(0,fs_extra_1.writeFile)(a,'\n\t#include <iostream>\n\tint main(int argc, char **argv) {\n\tstd::cout << "hello cocos" << std::endl;\n\treturn 0;\n\t}\n\t');const n=[],s=(t=>async(i,r)=>new Promise((o,a)=>((0,child_process_1.spawn)(e,i.concat(`-B build_${r}`),{cwd:t,shell:!0}).on("close",(e,t)=>{o(0==e)}),!1)))(r);for(let e=0;e<i.length;e+=2){const t=i[e],r=i[e+1];await s(t.concat("-S."),r)&&n.push({name:`Visual Studio ${r}`,value:r})}return n}exports.queryVisualStudioVersion=queryVisualStudioVersion;