"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onPreviewSettings=exports.onAfterBundleInit=exports.onAfterInit=void 0;const fs_extra_1=require("fs-extra");async function onAfterInit(e,t,a){const s=e.packages.windows.renderBackEnd;t.staticsInfo.B100005=e.name,Editor.Metrics.trackEvent({category:"Project",action:"Rendering Backend",label:"Vulkan",value:e.packages.windows.renderBackEnd.vulkan?100:0});const n=t.compileOptions;n.platformParams.targetPlatform="x64",n.platformParams.vsVersion=e.packages.windows.vsData||"",n.cMakeConfig.USE_SERVER_MODE=`set(USE_SERVER_MODE ${e.packages.native.serverMode?"ON":"OFF"})`;const o=Number(e.packages.native.netMode);n.cMakeConfig.NET_MODE=`set(NET_MODE ${isNaN(o)||o>2||o<0?0:o})`,e.buildScriptParam.flags.NET_MODE=isNaN(o)||o>2||o<0?0:o,n.cMakeConfig.NET_MODE=`set(NET_MODE ${isNaN(o)||o>2||o<0?0:o})`,n.executableName=executableNameOrDefault(n.projectName,e.packages.windows.executableName),n.cMakeConfig.CC_EXECUTABLE_NAME=`set(CC_EXECUTABLE_NAME "${n.executableName}")`,s&&Object.keys(s).forEach(e=>{n.cMakeConfig[`CC_USE_${e.toUpperCase()}`]=s[e]}),await(0,fs_extra_1.outputJSON)(t.paths.compileConfig,n,{spaces:2})}async function onAfterBundleInit(e){var t,a,s;const n=e.packages.windows.renderBackEnd;e.assetSerializeOptions["cc.EffectAsset"].glsl1=null===(t=n.gles2)||void 0===t||t,e.assetSerializeOptions["cc.EffectAsset"].glsl3=null===(a=n.gles3)||void 0===a||a,e.assetSerializeOptions["cc.EffectAsset"].glsl4=null===(s=n.vulkan)||void 0===s||s;const o=Number(e.packages.native.netMode);e.buildScriptParam.flags.NET_MODE=isNaN(o)||o>2||o<0?0:o,e.buildScriptParam.flags.SERVER_MODE=!!e.packages.windows.serverMode,e.buildScriptParam.platform="WINDOWS"}async function onPreviewSettings(e){const t=e.plugins.jsList;if(!t.length)return;const a=[];for(const e of t){const t=await Editor.Message.request("asset-db","query-asset-meta","db://"+e);t&&(t.userData.loadPluginInNative&&a.push(e))}e.plugins.jsList=a}function executableNameOrDefault(e,t){return t||(/^[0-9a-zA-Z_-]+$/.test(e)?e:(console.warn(`The provided project name "${e}" is not suitable for use as an executable name. 'CocosGame' is applied instead.`),"CocosGame"))}exports.onAfterInit=onAfterInit,exports.onAfterBundleInit=onAfterBundleInit,exports.onPreviewSettings=onPreviewSettings;