"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=void 0;const path_1=require("path"),fs_1=require("fs"),options_1=require("./options"),lodash=require("lodash");let panel;exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/builder/view.html"),"utf8");const methods={t:(t,e)=>Editor.I18n.t(`ohos.${t}`,e),async onSetSDK(){Editor.Message.send("preferences","open-settings","program")},getDefaultPackageName:()=>options_1.defaultOptions.packageName,async onChange(t){const e=t.target.value,a=t.target.getAttribute("path");await this.onUpdateOptions(a,e)},async onUpdateOptions(t,e){if(!t)return;"apiLevel"===t&&(e=Number(e)),lodash.set(this.pkgOptions,t,e);const a=await(0,options_1.verificationFunc)(t,e,panel.options);this.pkgErrorMap[t]=a.error,this.emitChange()},emitChange(){panel.dispatch("update",`packages.${this.pkgName}`,this.pkgOptions,this.pkgErrorMap)},async init(){const t=this;t.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{};for(const e of Object.keys(options_1.defaultOptions)){const a=await(0,options_1.verificationFunc)(e,t.pkgOptions[e],panel.options);t.pkgErrorMap[e]=a.error}t.emitChange()}};async function update(t,e){panel=this,e&&!e.startsWith(`packages.${panel.pkgName}`)||(panel.options=t,panel.vm.init())}function ready(t,e,a,o){panel=this;const p=BuildPanel.Vue;panel.options=t,panel.pkgName=a,panel.errorMap=o,panel.vm=new p({el:panel.$.root,data:()=>({pkgName:a,type:e,pkgOptions:options_1.defaultOptions,pkgErrorMap:options_1.defaultOptions,apiLevels:[],appABIList:["armeabi-v7a","arm64-v8a","x86"]}),async mounted(){const t=this;if("check"===t.type)return t.pkgOptions=lodash.get(panel.options,`packages.${panel.pkgName}`)||{},void(t.pkgErrorMap={});t.init()},methods:methods})}async function getOHOSAPILevels(){const t=await Editor.Message.request("program","query-program-info","ohosSDK");return t&&t.path&&(0,fs_1.existsSync)(t.path)?["4","5"]:[]}exports.$={root:".ohos"},exports.update=update,exports.ready=ready;