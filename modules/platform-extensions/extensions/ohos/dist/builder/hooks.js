"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.throwError=void 0,exports.onAfterInit=onAfterInit,exports.onAfterBundleInit=onAfterBundleInit;const path_1=__importDefault(require("path")),os_1=__importDefault(require("os")),fs_extra_1=require("fs-extra");function localWhich(t){var e=[t];const r="win32"===os_1.default.platform();r&&e.push(t+".exe");t=r?process.env.PATH?.split(";"):process.env.PATH?.split(":");if(t&&0!==t.length)for(const a of t)if(0<e.filter(t=>{if(!(0,fs_extra_1.existsSync)(path_1.default.join(a,t)))return!1;if(r)return!0;try{return(0,fs_extra_1.accessSync)(path_1.default.join(a,t),fs_extra_1.constants.X_OK),!0}catch(t){return!1}}).length)return a;return null}async function generateOptions(t){var t=t.packages.ohos,e=(t.orientation=t.orientation||{},await Editor.Message.request("program","query-program-info","ohosSDK")),r=await Editor.Message.request("program","query-program-info","ohosNDK");if(t.sdkPath=e?e.path:"",t.ndkPath=r?r.path:"",t.sdkPath&&t.ndkPath)return{packageName:t.packageName||"",orientation:{landscapeRight:t.orientation.landscapeRight??!0,landscapeLeft:t.orientation.landscapeLeft??!0,portrait:t.orientation.portrait??!1,upsideDown:t.orientation.upsideDown??!1},apiLevel:t.apiLevel||26,sdkPath:t.sdkPath||"",ndkPath:t.ndkPath||"",renderBackEnd:{gles3:t.renderBackEnd?.gles3??!0}};throw new Error(Editor.I18n.t("ohos.tips.ohos_sdk_error"))}async function onAfterInit(e,t,r){var a=await generateOptions(e);const o=(e.packages.ohos=a).renderBackEnd;o&&Object.keys(o).forEach(t=>{e.cocosParams.cMakeConfig["CC_USE_"+t.toUpperCase()]=o[t]}),Object.assign(e.cocosParams.platformParams,a),t.staticsInfo.B100005=a.packageName,t.staticsInfo.B100011=a.orientation}function onAfterBundleInit(t){t.packages.ohos.renderBackEnd;t.assetSerializeOptions["cc.EffectAsset"].glsl1=!1,t.assetSerializeOptions["cc.EffectAsset"].glsl3=!0,t.assetSerializeOptions["cc.EffectAsset"].glsl4=!1}exports.throwError=!0;