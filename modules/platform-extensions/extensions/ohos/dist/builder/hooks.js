"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterInit=exports.throwError=void 0;const path_1=__importDefault(require("path")),os_1=__importDefault(require("os")),fs_extra_1=require("fs-extra");function localWhich(t){var e,o;const r=[t],n="win32"===os_1.default.platform();n&&r.push(t+".exe");const a=n?null===(e=process.env.PATH)||void 0===e?void 0:e.split(";"):null===(o=process.env.PATH)||void 0===o?void 0:o.split(":");if(!a||0===a.length)return null;for(const t of a)if(r.filter(e=>{if(!fs_extra_1.existsSync(path_1.default.join(t,e)))return!1;if(n)return!0;try{return fs_extra_1.accessSync(path_1.default.join(t,e),fs_extra_1.constants.X_OK),!0}catch(t){return!1}}).length>0)return t;return null}async function generateOptions(t){var e,o,r,n,a,i;const s=t.packages.ohos;s.orientation=s.orientation||{};const l=await Editor.Message.request("program","query-program-info","ohosSDK"),p=await Editor.Message.request("program","query-program-info","ohosNDK");if(s.sdkPath=l?l.path:"",s.ndkPath=p?p.path:"",!s.sdkPath||!s.ndkPath)throw new Error(Editor.I18n.t("ohos.tips.ohos_sdk_error"));return{packageName:s.packageName||"",orientation:{landscapeRight:null===(e=s.orientation.landscapeRight)||void 0===e||e,landscapeLeft:null===(o=s.orientation.landscapeLeft)||void 0===o||o,portrait:null!==(r=s.orientation.portrait)&&void 0!==r&&r,upsideDown:null!==(n=s.orientation.upsideDown)&&void 0!==n&&n},apiLevel:s.apiLevel||26,sdkPath:s.sdkPath||"",ndkPath:s.ndkPath||"",renderBackEnd:{gles3:null===(i=null===(a=s.renderBackEnd)||void 0===a?void 0:a.gles3)||void 0===i||i}}}async function onAfterInit(t,e,o){var r;const n=await generateOptions(t);t.packages.ohos=n;const a=n.renderBackEnd;a&&Object.keys(a).forEach(t=>{e.compileOptions.cMakeConfig[`CC_USE_${t.toUpperCase()}`]=a[t]}),t.assetSerializeOptions["cc.EffectAsset"].glsl3=null===(r=a.gles3)||void 0===r||r,Object.assign(e.compileOptions.platformParams,n),await fs_extra_1.outputJSON(e.paths.compileConfig,e.compileOptions);const i={packageName:n.packageName,orientation:n.orientation};o.__addStaticsInfo(i)}exports.throwError=!0,exports.onAfterInit=onAfterInit;