"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterBundleInit=exports.onAfterInit=exports.throwError=void 0;const path_1=__importDefault(require("path")),os_1=__importDefault(require("os")),fs_extra_1=require("fs-extra");function localWhich(t){var e=[t];const r="win32"===os_1.default.platform();r&&e.push(t+".exe");t=r?null==(t=process.env.PATH)?void 0:t.split(";"):null==(t=process.env.PATH)?void 0:t.split(":");if(t&&0!==t.length)for(const a of t)if(0<e.filter(t=>{if(!(0,fs_extra_1.existsSync)(path_1.default.join(a,t)))return!1;if(r)return!0;try{return(0,fs_extra_1.accessSync)(path_1.default.join(a,t),fs_extra_1.constants.X_OK),!0}catch(t){return!1}}).length)return a;return null}async function generateOptions(t){var t=t.packages.ohos,e=(t.orientation=t.orientation||{},await Editor.Message.request("program","query-program-info","ohosSDK")),r=await Editor.Message.request("program","query-program-info","ohosNDK");if(t.sdkPath=e?e.path:"",t.ndkPath=r?r.path:"",t.sdkPath&&t.ndkPath)return{packageName:t.packageName||"",orientation:{landscapeRight:null==(e=t.orientation.landscapeRight)||e,landscapeLeft:null==(r=t.orientation.landscapeLeft)||r,portrait:null!=(e=t.orientation.portrait)&&e,upsideDown:null!=(r=t.orientation.upsideDown)&&r},apiLevel:t.apiLevel||26,sdkPath:t.sdkPath||"",ndkPath:t.ndkPath||"",renderBackEnd:{gles3:null==(r=null==(e=t.renderBackEnd)?void 0:e.gles3)||r}};throw new Error(Editor.I18n.t("ohos.tips.ohos_sdk_error"))}async function onAfterInit(e,t,r){var a=await generateOptions(e);const n=(e.packages.ohos=a).renderBackEnd;n&&Object.keys(n).forEach(t=>{e.cocosParams.cMakeConfig["CC_USE_"+t.toUpperCase()]=n[t]}),Object.assign(e.cocosParams.platformParams,a),t.staticsInfo.B100005=a.packageName,t.staticsInfo.B100011=a.orientation}function onAfterBundleInit(t){t.packages.ohos.renderBackEnd;t.assetSerializeOptions["cc.EffectAsset"].glsl1=!1,t.assetSerializeOptions["cc.EffectAsset"].glsl3=!0,t.assetSerializeOptions["cc.EffectAsset"].glsl4=!1,t.buildScriptParam.platform="OHOS"}exports.throwError=!0,exports.onAfterInit=onAfterInit,exports.onAfterBundleInit=onAfterBundleInit;