"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),build_1=require("./build"),verification_1=require("./utils/verification"),lodash=require("lodash"),methods={onNewCertificate(){Editor.Panel.open("certificate")},t(e,t=""){const a=`xiaomi-quick-game.${t}${e}`;return Editor.I18n.t(a)},async onChange(e){const t=this,a=e.target.value,i=e.target.getAttribute("path");lodash.set(t.pkgOptions,i,a),["useDebugKey","certificatePemPath","privatePemPath"].includes(i)&&t.updatePemPathCheckRes(),panel.dispatch("update",`packages.${t.pkgName}.${i}`,a,t.verifyRes[i])},updatePemPathCheckRes(){const e=verification_1.verificationFunc("privatePemPath",this.pkgOptions.privatePemPath,panel.options),t=verification_1.verificationFunc("certificatePemPath",this.pkgOptions.certificatePemPath,panel.options);this.verifyRes.privatePemPath=this.pkgOptions.useDebugKey?null:e.error,this.verifyRes.certificatePemPath=this.pkgOptions.useDebugKey?null:t.error,panel.dispatch("update",`packages.${this.pkgName}.certificatePemPath`,this.pkgOptions.certificatePemPath,this.verifyRes.certificatePemPath),panel.dispatch("update",`packages.${this.pkgName}.privatePemPath`,this.pkgOptions.privatePemPath,this.verifyRes.privatePemPath)},updateCertificationPenPath(e){if(!e)return;this.pkgOptions.certificatePemPath=path_1.join(e,"certificate.pem"),this.pkgOptions.privatePemPath=path_1.join(e,"private.pem"),this.updatePemPathCheckRes()},init(){this.pkgOptions=JSON.parse(JSON.stringify(lodash.get(panel.options,`packages.${panel.options.platform}`)||{})),this.verifyRes=JSON.parse(JSON.stringify(lodash.get(panel.errorMap,`packages.${panel.options.platform}`)||{})),this.updatePemPathCheckRes(this.pkgOptions.useDebugKey)},updateKey(e){const t=this;if(!e)return void t.init(e);const a=e.replace(`packages.${panel.pkgName}.`,"");a in build_1.optionsInPanel||(lodash.set(t.pkgOptions,a,lodash.get(panel.options,e)),lodash.set(t.verifyRes,a,lodash.get(panel.errorMap,e)),t.updatePemPathCheckRes(t.pkgOptions.useDebugKey))}};let panel;function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)||(panel.options=e,panel.vm.updateKey(t))}function ready(e,t,a,i){panel=this;const s=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.errorMap=i,panel.vm=new s({el:panel.$.root,data:()=>({pkgName:a,optionsConfig:build_1.optionsInPanel,pkgOptions:{},verifyRes:{}}),mounted(){this.init()},methods:methods}),Editor.Message.__protected__.addBroadcastListener("certificate:generate-certificate-success",panel.vm&&panel.vm.updateCertificationPenPath)}function close(){Editor.Message.__protected__.removeBroadcastListener("certificate:generate-certificate-success",panel.vm&&panel.vm.updateCertificationPenPath)}exports.style="\n.new-certificate { margin-left: 4px; }\n",exports.template=fs_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8"),exports.$={root:".xiaomi-quick-game"},exports.update=update,exports.ready=ready,exports.close=close;