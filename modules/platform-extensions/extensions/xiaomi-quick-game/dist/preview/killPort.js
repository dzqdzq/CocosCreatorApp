"use strict";var childProcess=require("child_process"),spawn=childProcess.spawn,exec=childProcess.exec,execSync=childProcess.execSync,spawnSync=childProcess.spawnSync;function killAll(e,n,r){var i={};try{Object.keys(e).forEach(function(c){e[c].forEach(function(c){i[c]||(killPid(c,n),i[c]=1)}),i[c]||(killPid(c,n),i[c]=1)})}catch(c){if(r)return r(c);throw c}if(r)return r()}function killPid(c,e){try{process.kill(parseInt(c,10),e)}catch(c){if("ESRCH"!==c.code)throw c}}function Uint8ArrayToString(c){for(var e="",n=0;n<c.length;n++)e+=String.fromCharCode(c[n]);return e}function killInMac(c){var e;Uint8ArrayToString(spawnSync("lsof",["-i",":"+c]).stdout).split(/[\n|\r]/).forEach(c=>{-1===c.indexOf("LISTEN")||e||(c=c.split(/\s+/),/\d+/.test(c[1])&&(e=c[1]))}),e?execSync("kill -9 "+e):console.log(`port:${c} close!`)}function buildProcessTree(e,n,r,i,o){var c=i(e),t="";c.stdout.on("data",c=>{c=c.toString("ascii"),t+=c});c.on("close",c=>{delete r[e],0!=c?0==Object.keys(r).length&&o():t.match(/\d+/g).forEach(function(c){c=parseInt(c,10),n[e].push(c),n[c]=[],r[c]=1,buildProcessTree(c,n,r,i,o)})})}module.exports=function(c,e,n,r){var i={},o={};switch(i[c]=[],o[c]=1,"function"==typeof n&&void 0===r&&(r=n,n=void 0),process.platform){case"win32":execSync("taskkill /pid "+c+" /T /F");break;case"darwin":killInMac(e);break;default:buildProcessTree(c,i,o,function(c){return spawn("ps",["-o","pid","--no-headers","--ppid",c])},function(){killAll(i,n,r)})}};