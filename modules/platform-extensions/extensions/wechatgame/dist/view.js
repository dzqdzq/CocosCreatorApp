"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.data=exports.template=exports.style=exports.buttonConfig=void 0;const child_process_1=require("child_process"),fs_extra_1=require("fs-extra"),path_1=require("path"),iconv=require("iconv-lite"),PKG_NAME="wechatgame";let panel;exports.buttonConfig={configs:{run:{label:"i18n:wechatgame.run.label",async click(e,t){t.buildPath=Editor.UI.File.resolveToRaw(t.buildPath);const o=path_1.join(t.buildPath,t.outputName),n=o.match(/([`~!#$%^&*+=<>?"{}|,;'·~！#￥%……&*（）+={}|《》？：“”【】、；‘'，。、])/im);n&&console.warn(Editor.I18n.t("wechatgame.tips.build_path_contains_symbol",{symbol:n[1]}));let s=await Editor.Profile.getConfig("program","wechat_devtools");if(!s||!fs_extra_1.existsSync(s)){return console.warn(`${Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty",{wechatgamePath:s})}`),1===(await Editor.Dialog.warn(Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty"),{buttons:["Cancel","Set Wechat DevTools"]})).response&&Editor.Message.send("preferences","open-settings","program"),!1}fs_extra_1.statSync(s).isDirectory()||"win32"!==process.platform||(s=path_1.dirname(s));const a={stdio:"pipe"};let i;if("darwin"===process.platform?(i=path_1.join(s,"Contents/Resources/app.nw/bin/cli"),fs_extra_1.existsSync(i)||(i=path_1.join(s,"Contents/MacOS/cli"))):(i=path_1.join(s,"cli.bat"),a.shell=!0),!fs_extra_1.existsSync(i))return await Editor.Dialog.error(Editor.I18n.t("builder.wechat_game.client_path_error")),!1;const r=["-o",o,"-f","cocos"];console.log(`Run command : ${r.join(" ")}`);const p=child_process_1.spawn(i,r);return p&&p.stdout&&p.stdout.on("data",function(e){console.log(`${iconv.decode(e,"utf8").toString()}`)}),p&&p.stderr&&p.stderr.on("data",function(e){console.error(`${iconv.decode(e,"utf8").toString()}`)}),!0}}}},exports.style="\n.warning-tip {\n    color: var(--color-warn-fill);\n    font-size： 11px;\n    line-height: 16px;\n    margin-bottom: 2px;\n}\n\n.jump {\n    cursor: pointer;\n    text-decoration: underline;\n}\n\n.jump:hover {\n    color: var(--color-focus-fill-weakest)\n}\n",exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8");const component={data:()=>({pkgOptions:{},includeModules:[]}),computed:{physics3D(){return!!this.includeModules.filter(e=>e.startsWith("physics-")&&!e.startsWith("physics-2d")).length}},methods:{t:e=>Editor.I18n.t("wechatgame.options."+e),async init(){this.pkgOptions=panel.options.packages.wechatgame,await this.updateEngineModules()},onConfirm(e,t){const o=e.target.value;this.pkgOptions[t]=o,panel.dispatch("update",`packages.wechatgame.${t}`,o,null)},openProjectSettings(){Editor.Message.send("project","open-settings","engine","modules")},async updateEngineModules(){this.includeModules=await Editor.Profile.getProject("engine","modules.includeModules")}},mounted(){this.init(),Editor.Message.addBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)},beforeDestroy(){Editor.Message.removeBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)}};async function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)||(panel.options=e,panel.vm.init())}function ready(e){panel=this;const t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".wechatgame"},exports.update=update,exports.ready=ready;