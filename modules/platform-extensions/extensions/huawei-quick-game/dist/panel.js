"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const path_1=require("path"),fs_1=require("fs"),build_1=require("./build"),verification_1=require("./utils/verification"),lodash=require("lodash");let panel;const fixPath=require("fix-path");fixPath(),exports.style="\n.new-certificate { margin-left: 4px; }\n.print-finger { margin-top: 4px; }\n",exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../static/view.html"),"utf8");const methods={onNewCertificate(){Editor.Panel.open("certificate")},t(e,t=""){const i=`huawei-quick-game.${t}${e}`;return Editor.I18n.t(i)},async onChange(e){const t=this,i=e.target.value,r=e.target.getAttribute("path");lodash.set(t.pkgOptions,r,i),["useDebugKey","certificatePemPath","privatePemPath"].includes(r)&&t.updatePemPathCheckRes(),["separateEngine","minPlatformVersion"].includes(r)&&t.updateMinPlatformVersion(),panel.dispatch("update",`packages.${t.pkgName}.${r}`,i,t.verifyRes[r])},updatePemPathCheckRes(){const e=this.pkgOptions.useDebugKey,t=(0,verification_1.verificationFunc)("privatePemPath",this.pkgOptions.privatePemPath,panel.options),i=(0,verification_1.verificationFunc)("certificatePemPath",this.pkgOptions.certificatePemPath,panel.options);this.verifyRes.privatePemPath=e?null:t.error,this.verifyRes.certificatePemPath=e?null:i.error,panel.dispatch("update",`packages.${this.pkgName}.certificatePemPath`,this.pkgOptions.certificatePemPath,this.verifyRes.certificatePemPath),panel.dispatch("update",`packages.${this.pkgName}.privatePemPath`,this.pkgOptions.privatePemPath,this.verifyRes.privatePemPath)},updateMinPlatformVersion(){const e=this,t=(0,verification_1.verificationFunc)("minPlatformVersion",`${e.pkgOptions.minPlatformVersion}`,panel.options);t.error?(e.verifyRes.minPlatformVersion=t.error,panel.dispatch("update",`packages.${e.pkgName}.minPlatformVersion`,e.pkgOptions.minPlatformVersion,e.verifyRes.minPlatformVersion)):(e.verifyRes.minPlatformVersion=null,panel.dispatch("update",`packages.${e.pkgName}.minPlatformVersion`,e.pkgOptions.minPlatformVersion,null))},init(){this.pkgOptions=lodash.get(panel.options,`packages.${panel.options.platform}`)||{},this.verifyRes=lodash.get(panel.errorMap,`packages.${panel.options.platform}`)||{},this.updatePemPathCheckRes(),this.updateMinPlatformVersion()},async onPrintFinger(){"win32"!==process.platform&&-1===process.env.PATH.indexOf("/usr/local/bin/")&&(process.env.PATH+=":/usr/local/bin/"),"win32"===process.platform||(0,fs_1.existsSync)((0,path_1.join)("/usr/local/bin/","node"))?await this.isInstallNodeJs()&&this.printFinger():console.log(new Error(Editor.I18n.t("huawei-quick-game.tips.install_nodejs_before_view_certificate")))},printFinger(){const e=require("child_process").exec,t=(0,path_1.join)(Editor.App.path,"../tools/huawei-rpk-tools");e(`node ${(0,path_1.join)(t,"print-cert-fp.js")} ${this.pkgOptions.certificatePemPath}`,{cwd:t},(e,t)=>{if(!e)return t?void console.log(Editor.I18n.t("huawei-quick-game.tips.certificate_fingerprint"),t):void console.error(new Error(Editor.I18n.t("huawei-quick-game.tips.select_certificate_path_after_view_certificate")));"win32"===process.platform?console.log(new Error(Editor.I18n.t("huawei-quick-game.tips.certificate_fingerprint_window_error")+e)):console.log(new Error(Editor.I18n.t("huawei-quick-game.tips.certificate_fingerprint_mac_error")+e))})},isInstallNodeJs(){const e=require("child_process").exec;return new Promise((t,i)=>{e("node -v",{env:process.env},e=>{if(e){if("win32"===process.platform)return console.error(new Error(Editor.I18n.t("huawei-quick-game.tips.not_install_nodejs_windows_error"))),void i(!1);console.error(new Error(Editor.I18n.t("huawei-quick-game.tips.not_install_nodejs_mac_error"))),i(!1)}else t(!0)})})}};async function update(e,t){panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`)||(panel.options=e,panel.vm.init())}function ready(e,t,i,r){panel=this;const a=BuildPanel.Vue;panel.options=e,panel.pkgName=i,panel.errorMap=r,panel.vm=new a({el:panel.$.root,data:()=>({pkgName:i,optionsConfig:build_1.optionsInPanel,pkgOptions:{},verifyRes:{}}),mounted(){this.init()},methods:methods})}exports.$={root:".huawei-quick-game"},exports.update=update,exports.ready=ready;