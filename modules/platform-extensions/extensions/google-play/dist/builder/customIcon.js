"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ICON_DPI_LIST=void 0,exports.getDisplayCustomIcon=getDisplayCustomIcon,exports.saveCustomIcon=saveCustomIcon,exports.getCustomIconInfo=getCustomIconInfo,exports.removeCustomIcon=removeCustomIcon;const sharp_1=__importDefault(require("sharp")),fs_extra_1=require("fs-extra"),path_1=require("path"),SETTING_ROOT=(0,path_1.join)(Editor.Project.path,"settings/icons");function getCustomIconInfoImpl(t,e){let a="";switch(t){case"default":a=(0,path_1.join)(__dirname,"../../static/icons");break;case"custom":a=(0,path_1.join)(SETTING_ROOT,e)}let i="";var o=Object.keys(exports.ICON_DPI_LIST).map(t=>{var e=t,o="ic_launcher.png",s=(0,path_1.join)(a,e,o);return"mipmap-xxxhdpi"===t&&(i=s+"?timestamp="+Date.now()),{dirName:e,fileName:o,dpi:exports.ICON_DPI_LIST[t],path:s}});return{type:t,display:i,list:o}}function hasCustomIcon(t){return(0,fs_extra_1.existsSync)(t.list[0].path)}function getDisplayCustomIcon(t,e){t=getCustomIconInfoImpl(t,e);return(hasCustomIcon(t)?t:getCustomIconInfoImpl("default",e)).display}async function saveCustomIcon(t,e,o){e=getCustomIconInfoImpl(e,o);for(const s of e.list)await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(s.path)),await(0,sharp_1.default)(t).resize(s.dpi,s.dpi,{fit:"inside"}).withMetadata({density:s.dpi}).toFile(s.path);return e.display}function getCustomIconInfo(t,e){t=getCustomIconInfoImpl(t,e);return hasCustomIcon(t)?t:getCustomIconInfoImpl("default",e)}async function removeCustomIcon(t,e){if("default"!==t)try{await(0,fs_extra_1.remove)((0,path_1.join)(SETTING_ROOT,e))}catch(t){}}exports.ICON_DPI_LIST={"mipmap-mdpi":48,"mipmap-hdpi":72,"mipmap-xhdpi":96,"mipmap-xxhdpi":144,"mipmap-xxxhdpi":192};