"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterBuild=exports.onBeforeBundleInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),PACKAGE_NAME="adsense-h5g-plugin";exports.throwError=!0;const scriptUuids=["b8d97018-1648-4f7f-b2c7-941dcbde2a17","b502a825-f7c2-4ee4-b75e-605528f25515","fd80a9b5-5b61-4c02-af13-e6508e6644ff","e7ecae40-ddb1-4ac1-8abf-0382e9d40f02","3c6b2349-eaf5-4afc-893a-894cd8511526","e0c4e2c7-5823-4fba-8095-6ad5a9830da6"];async function onBeforeBundleInit(e,o,t){if(!e.preview){if(["web-mobile","web-desktop"].includes(e.platform)){return await Editor.Profile.getProject(PACKAGE_NAME,"enableAdsense")?void 0:void removeScriptFromCache(t)}removeScriptFromCache(t)}}function removeScriptFromCache(e){scriptUuids.forEach(o=>e.removeAsset(o)),console.debug("[adsense-h5g-plugin] remove script success")}exports.onBeforeBundleInit=onBeforeBundleInit;const onAfterBuild=async function(e,o){if(["web-mobile","web-desktop"].includes(e.platform)){if(!await Editor.Profile.getProject(PACKAGE_NAME,"enableAdsense"))return;const t=e.packages[PACKAGE_NAME];if(!t)return;const r=(0,path_1.join)(o.paths.dir,"index.html"),a=t.enableTestAd?'data-adbreak-test="on"':"";let n="",s="";"other"===t.AFPHostPropertyCode&&t.otherAFPHostPropertyCode?(n=t.otherAFPHostPropertyCode,s=t.otherAFPDomain):(n=t.AFPHostPropertyCode,s=t.AFPHostDomain);let d=await(0,fs_extra_1.readFile)(r,"utf8");d=d.replace("</head>",function(e){return`\n  <meta name="google-adsense-platform-domain" content="${s}">\n  <meta name="google-adsense-platform-account" content="${n}">\n  <script async\n    data-ad-client="${t.adsensePropertyCode}"\n    ${a}\n    data-ad-host="${n}"\n    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">\n  <\/script>\n  <script>\n    window.adsbygoogle = window.adsbygoogle || [];\n    var adBreak = adConfig = function(o) {adsbygoogle.push(o);}\n  <\/script>\n</head>\n            `}),await(0,fs_extra_1.writeFile)(r,d)}};exports.onAfterBuild=onAfterBuild;