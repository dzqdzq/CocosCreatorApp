"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.data=exports.template=void 0;const axios_1=__importDefault(require("axios")),fs_1=require("fs"),lodash_1=__importDefault(require("lodash")),path_1=require("path"),PKG_NAME="adsense-h5g-plugin";let panel;exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../static/panel.html"),"utf8");const component={data:()=>({renderList:[],pkgOptions:{otherAFPHostPropertyCode:"",otherAFPDomain:"",AFPHostPropertyCode:"",AFPHostDomain:""},pkgErrorMap:{otherAFPHostPropertyCode:null,otherAFPDomain:null}}),methods:{t(e){const t=e.replace("i18n:","");return Editor.I18n.t(t)||t},updateOptions(){const e=this;e.pkgOptions=lodash_1.default.get(panel.options,`packages.${PKG_NAME}`)||{otherAFPHostPropertyCode:"",otherAFPDomain:"",AFPHostPropertyCode:"",AFPHostDomain:""},"other"===e.pkgOptions.AFPHostPropertyCode?(e.onOtherAFPHostPropertyCodeChange(e.pkgOptions.otherAFPHostPropertyCode),e.onOtherAFPDomainChange(e.pkgOptions.otherAFPDomain)):e.onAFPHostPropertyCodeChange(e.renderList[0].value)},async init(){const e=this;if(!e.renderList.length){try{const t={"cache-control":"no-cache"},o=(await axios_1.default.get("https://adsense.cocos.com/agent.json",{headers:t})).data.map(e=>({label:e.name,value:e.code,domain:e.domain}));e.renderList=o}catch(e){console.warn("query AFPHostPropertyCodeList failed!"),console.warn(e)}e.renderList.push({value:"other",label:"i18n:adsense-h5g-plugin.options.otherAFPHostPropertyCode"})}e.updateOptions()},onDataChange(e){const t=e.target.getAttribute("path");if(!t)return;const o=e.target.value,n=this;switch(t){case"otherAFPHostPropertyCode":return n.onOtherAFPHostPropertyCodeChange(o);case"otherAFPDomain":return n.onOtherAFPDomainChange(o);case"AFPHostPropertyCode":return n.onAFPHostPropertyCodeChange(o)}},onAFPHostPropertyCodeChange(e){const t=this;if(t.afterChange("AFPHostPropertyCode",e,null),"other"===e)t.onOtherAFPHostPropertyCodeChange(t.pkgOptions.otherAFPHostPropertyCode),t.onOtherAFPDomainChange(t.pkgOptions.otherAFPDomain);else{const o=t.renderList.find(t=>t.value===e);o&&t.afterChange("AFPHostDomain",o.domain,null),t.afterChange("otherAFPHostPropertyCode","",null),t.afterChange("otherAFPDomain","",null)}},onOtherAFPHostPropertyCodeChange(e){const t=new RegExp("^ca-host-pub-\\d+$");let o=null;""===e||t.test(e)||(o="i18n:adsense-h5g-plugin.adsensePropertyCodeRule_msg");this.afterChange("otherAFPHostPropertyCode",e,o)},onOtherAFPDomainChange(e){this.afterChange("otherAFPDomain",e,null)},afterChange(e,t,o){this.pkgOptions[e]===t&&this.pkgErrorMap[e]===o||(this.$set(this.pkgOptions,e,t),this.$set(this.pkgErrorMap,e,o),panel.dispatch("update",`packages.${PKG_NAME}.${e}`,t,o))}},async mounted(){await this.init(),this.pkgOptions.enableAdsense=await Editor.Profile.getProject(panel.pkgName,"enableAdsense"),panel.dispatch("update",`packages.${PKG_NAME}.enableAdsense`,this.pkgOptions.enableAdsense,null)}};function update(e,t){if(panel=this,t&&!t.startsWith(`packages.${panel.pkgName}`))return;const o=lodash_1.default.get(e,t);t===`packages.${panel.pkgName}.enableAdsense`&&Editor.Profile.setProject(panel.pkgName,"enableAdsense",o),o!==lodash_1.default.get(panel.options,t)&&(lodash_1.default.set(panel.options,t,o),panel.vm.init())}function ready(e,t,o){panel=this;const n=require("vue/dist/vue.js");panel.options=e,panel.pkgName=o,panel.vm=new n(Object.assign({el:panel.$.root},component))}exports.data={vm:null},exports.$={root:".adsense-h5g-plugin"},exports.update=update,exports.ready=ready;