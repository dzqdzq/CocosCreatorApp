"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");exports.throwError=!0;let nativePackToolManager=null;async function onAfterInit(e,t,a){const i=e.packages.linux.renderBackEnd={gles2:!1,gles3:!1,metal:!0},o=t.compileOptions;Object.keys(i).forEach(e=>{o.cMakeConfig[`CC_USE_${e.toUpperCase()}`]=i[e]}),o.cMakeConfig.USE_SERVER_MODE=`set(USE_SERVER_MODE ${e.packages.native.serverMode?"ON":"OFF"})`;const r=Number(e.packages.native.netMode);e.buildScriptParam.flags.SERVER_MODE=!!e.packages.native.serverMode,e.buildScriptParam.flags.NET_MODE=isNaN(r)||r>2||r<0?0:r,o.cMakeConfig.NET_MODE=`set(NET_MODE ${e.buildScriptParam.flags.NET_MODE})`,await fs_extra_1.outputJSON(t.paths.compileConfig,o),await getNativePackToolMg(o.enginePath)}async function getNativePackToolMg(e=""){if(e=e||(await Editor.Message.request("engine","query-engine-info")).typescript.path,!nativePackToolManager){const t=require(path_1.join(e,"scripts/native-pack-tool/dist/index")).NativePackTool,a=require(path_1.join(e,"scripts/native-pack-tool/dist/index")).nativePackToolMg;class i extends t{async create(){return await this.copyCommonTemplate(),await this.copyPlatformTemplate(),await this.generateCMakeConfig(),await this.excuteCocosTemplateTask(),this.generateCMakeConfig(),await this.encrypteScripts(),!0}}const o=new i;a.register("linux",o),nativePackToolManager=a}return nativePackToolManager}exports.onAfterInit=onAfterInit;