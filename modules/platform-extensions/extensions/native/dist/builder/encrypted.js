"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.encryptJs=exports.setEncryptConfig=void 0;const path=__importStar(require("path")),fse=__importStar(require("fs-extra")),zlib_1=require("zlib"),xxtea=require("xxtea-node");async function setEncryptConfig(e){e.bundles.forEach(e=>{e.config.encrypted=!0})}async function encryptJs(e,t){const r=path.join(e.paths.dir,"..","script-backup");fse.ensureDirSync(r),fse.emptyDirSync(r),e.bundles.forEach(n=>{const i=n.scriptDest;let s=fse.readFileSync(i,"utf8");t.compressZip?(s=zlib_1.gzipSync(s),s=xxtea.encrypt(s,xxtea.toBytes(t.xxteaKey))):s=xxtea.encrypt(xxtea.toBytes(s),xxtea.toBytes(t.xxteaKey)),n.scriptDest=path.join(path.dirname(i),path.basename(i,path.extname(i))+".jsc"),fse.writeFileSync(n.scriptDest,s),fse.copySync(i,path.join(r,path.relative(e.paths.dir,i))),fse.removeSync(i)})}exports.setEncryptConfig=setEncryptConfig,exports.encryptJs=encryptJs;