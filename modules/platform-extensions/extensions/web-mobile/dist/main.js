"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=exports.methods=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),server_1=require("./server"),electron_1=require("electron"),lodash=require("lodash");async function load(){const e=await Editor.Profile.getConfig("builder","BuildTaskManager.taskMap")||{};Object.values(e).forEach(e=>{if(1!==e.progress)return;const t=lodash.get(e,"options.platform"),r=lodash.get(e,"options.buildPath");if("web-mobile"!==t||"string"!=typeof r)return;const o=path_1.join(Editor.UI.File.resolveToRaw(r),e.options.outputName);server_1.setRootPath(o)})}async function getPreviewUrl(e){const t=await Editor.Message.request("server","query-port");return`http://${await Editor.Message.request("preview","get-preview-ip")}:${t}/web-mobile/${e}/index.html`}exports.methods={async"create-build-template"(){const e=(await Editor.Message.request("engine","query-engine-info")).typescript.path,t=path_1.join(e,"templates/web-mobile/index.ejs"),r=path_1.join(Editor.Project.path,"build-templates","web-mobile",path_1.basename(t));if(fs_extra_1.existsSync(r)){if(1===(await Editor.Dialog.warn("Do you want to overwrite the source file?",{buttons:["Yes","Cancel"],default:0,cancel:1})).response)return!1}fs_extra_1.copySync(t,r),console.log(`web-mobile ${Editor.I18n.t("web-mobile.tips.creat_template_success")}({link(${r})})`)},async preview(e){server_1.setRootPath(e);const t=await getPreviewUrl(path_1.basename(e));return electron_1.shell.openExternal(t),t},async"set-preview-path"(e){server_1.setRootPath(e);const t=await getPreviewUrl(path_1.basename(e));return fs_extra_1.existsSync(e),t}},exports.load=load;