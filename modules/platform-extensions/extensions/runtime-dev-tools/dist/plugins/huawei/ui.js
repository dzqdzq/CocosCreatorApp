"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.computed=exports.data=exports.created=exports.name=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),huawei=require("./lib/huawei"),phone_1=require("../../utils/phone"),log_1=require("../../utils/log"),info_1=require("../../utils/info");async function created(){this.register_handler(),await huawei.checkRuntimeVersion(),this.rpkPath=await huawei.getRpkPath()}function data(){return{rpkPath:"",params:"",huaweiPlugin:huawei}}exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/plugins/huawei/ui.html"),"utf-8"),exports.name="huawei-runtime",exports.created=created,exports.data=data,exports.computed={runDisabled(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free},cancelDisabled(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free}},exports.methods={t:e=>Editor.I18n.t(e),paramsChange(e){this.params=e.target.value},rpkSelected(e){this.rpkPath=e.target.value},register_handler(){phone_1.phone.on("add_device",async e=>{huawei.needToCreatLogcat(e)&&(await huawei.checkRuntime(),huawei.openLogcat(e))}),phone_1.phone.on("remove_device",e=>{})},async installApk(){await huawei.installRuntime()},async onChooseRpkPath(e){e.stopPropagation();const t=this,a=await Editor.Dialog.select({path:(0,path_1.join)(Editor.Project.path,"/build"),type:"file",filters:[{name:`${t.t("runtime-dev-tools.huawei")} runtime rpk`,extensions:["rpk"]}]});a.filePaths&&a.filePaths[0]&&(t.rpkPath=a.filePaths[0])},getLaunchParams(){const e=this,t=["--ei","debugmode","1"];if(e.uri&&(t.push("--es"),t.push("uri"),t.push(encodeURIComponent(e.uri))),e.params){let a="";try{a=JSON.parse(e.params),t.push("--es"),t.push("params"),t.push(encodeURIComponent(e.params))}catch(t){log_1.log.warn(e.t("runtime-dev-tools.error_params"))}}return t.join(" ")},async launch(){const e=this;if(!(0,fs_extra_1.existsSync)(e.rpkPath))return log_1.log.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath),void info_1.info.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath);await huawei.stopRuntime(),await huawei.pushRpkToPhone(e.rpkPath),await huawei.startRuntimeWithRpk((0,path_1.basename)(e.rpkPath),e.getLaunchParams())},async stop(){await huawei.stopRuntime()}};