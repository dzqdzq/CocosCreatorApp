const gulp=require("gulp"),sourcemaps=require("gulp-sourcemaps"),babelify=require("babelify"),browserify=require("browserify"),source=require("vinyl-source-stream"),uglify=require("gulp-uglify"),buffer=require("vinyl-buffer");gulp.task("web.js",()=>browserify("./web/window.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("web-adapter.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/common"))),gulp.task("web.min.js",()=>browserify("./web/window.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("web-adapter.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/common"))),gulp.task("lib-web-huawei.zip",()=>{const s=require("fs");var i=require("path"),p=["./dist/platforms/huawei-quick-game/ral.js","./dist/platforms/huawei-quick-game/ral.min.js","./dist/common/web-adapter.js","./dist/common/web-adapter.min.js"];let r=require("git-commit-info")(),o=[];for(let e=0;e<p.length;++e){var l=p[e],t=s.readFileSync(l),l=i.basename(l),l=i.join("./dist",l);s.existsSync(l)&&s.unlinkSync(l),s.writeFileSync(l,`// ${r.hash}
`+t),o.push(l)}return gulp.src(o).pipe(require("gulp-zip")(`lib-web-huawei-${r.shortHash}.zip`)).pipe(gulp.dest("./dist/")).on("end",function(){s.copyFileSync(`./dist/lib-web-huawei-${r.shortHash}.zip`,"./dist/lib-web-huawei-latest-version.zip",s.constants.COPYFILE_FICLONE);for(let e=0;e<o.length;++e)s.unlinkSync(o[e])})}),gulp.task("cocos-runtime.js",()=>browserify("./ral/cocos-runtime/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/cocos-runtime/"))),gulp.task("cocos-runtime.min.js",()=>browserify("./ral/cocos-runtime/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/cocos-runtime/"))),gulp.task("cocos-runtime-laya.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./laya/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-laya.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-laya.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./laya/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-laya.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("oppo-mini-game.js",()=>browserify("./ral/oppo-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/oppo-mini-game/"))),gulp.task("oppo-mini-game.min.js",()=>browserify("./ral/oppo-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/oppo-mini-game/"))),gulp.task("huawei-quick-game.js",()=>browserify("./ral/huawei-quick-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/huawei-quick-game/"))),gulp.task("huawei-quick-game.min.js",()=>browserify("./ral/huawei-quick-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/huawei-quick-game/"))),gulp.task("cocos-runtime-pixiJS.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./pixiJS/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-pixiJS.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-pixiJS.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./pixiJS/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-pixiJS.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("vivo-mini-game.js",()=>browserify("./ral/vivo-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/vivo-mini-game/"))),gulp.task("vivo-mini-game.min.js",()=>browserify("./ral/vivo-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/vivo-mini-game/"))),gulp.task("migu-mini-game.js",()=>browserify("./ral/migu-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/migu-mini-game/"))),gulp.task("migu-mini-game.min.js",()=>browserify("./ral/migu-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/migu-mini-game/"))),gulp.task("honor-mini-game.js",()=>browserify("./ral/honor-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/platforms/honor-mini-game/"))),gulp.task("honor-mini-game.min.js",()=>browserify("./ral/honor-mini-game/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("ral.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/platforms/honor-mini-game/"))),gulp.task("cocos-runtime-phaser.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./phaser/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-phaser.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-phaser.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./phaser/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-phaser.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-construct3.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./construct3/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-construct3.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-construct3.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./construct3/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-construct3.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-creator-v2.js",()=>browserify("./cocos-creator-v2/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-creator-v2.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-creator-v2.min.js",()=>browserify("./cocos-creator-v2/index.js").transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-creator-v2.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-egret.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./egret/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-egret.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-egret.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./egret/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-egret.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-threejs.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./threejs/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-threejs.js")).pipe(buffer()).pipe(sourcemaps.init()).pipe(sourcemaps.write()).pipe(gulp.dest("./dist/"))),gulp.task("cocos-runtime-threejs.min.js",()=>browserify({entries:["./ral/cocos-runtime/index.js","./web/window.js","./threejs/index.js"]}).transform(babelify,{presets:["@babel/preset-env"],plugins:["@babel/plugin-proposal-class-properties"],comments:!1}).bundle().pipe(source("cocos-runtime-threejs.min.js")).pipe(buffer()).pipe(uglify()).pipe(gulp.dest("./dist/"))),gulp.task("lib-web",gulp.series(["web.js","web.min.js"])),gulp.task("lib-web-huawei",gulp.series(["huawei-quick-game.js","huawei-quick-game.min.js","web.js","web.min.js","lib-web-huawei.zip"])),gulp.task("lib-cocos-runtime",gulp.series(["cocos-runtime.js","cocos-runtime.min.js"])),gulp.task("lib-oppo",gulp.series(["oppo-mini-game.js","oppo-mini-game.min.js"])),gulp.task("lib-huawei",gulp.series(["huawei-quick-game.js","huawei-quick-game.min.js"])),gulp.task("lib-vivo",gulp.series(["vivo-mini-game.js","vivo-mini-game.min.js"])),gulp.task("lib-migu",gulp.series(["migu-mini-game.js","migu-mini-game.min.js"])),gulp.task("lib-honor",gulp.series(["honor-mini-game.js","honor-mini-game.min.js"])),gulp.task("lib-ral",gulp.series(["lib-cocos-runtime","lib-oppo","lib-huawei","lib-vivo","lib-migu","lib-honor"])),gulp.task("default",gulp.series(["lib-web","lib-ral"])),gulp.task("lib-cocos-creator-v2",gulp.series(["cocos-creator-v2.js","cocos-creator-v2.min.js"])),gulp.task("cocos-runtime-laya",gulp.series(["cocos-runtime-laya.js","cocos-runtime-laya.min.js"])),gulp.task("cocos-runtime-pixiJS",gulp.series(["cocos-runtime-pixiJS.js","cocos-runtime-pixiJS.min.js"])),gulp.task("cocos-runtime-phaser",gulp.series(["cocos-runtime-phaser.js","cocos-runtime-phaser.min.js"])),gulp.task("cocos-runtime-construct3",gulp.series(["cocos-runtime-construct3.js","cocos-runtime-construct3.min.js"])),gulp.task("cocos-runtime-egret",gulp.series(["cocos-runtime-egret.js","cocos-runtime-egret.min.js"])),gulp.task("cocos-runtime-threejs",gulp.series(["cocos-runtime-threejs.js","cocos-runtime-threejs.min.js"]));