import HTMLElement from"./HTMLElement";import Event from"./Event";if("vivo_platform_support"===ral.getFeatureProperty("HTMLImageElement","spec")||"honor_platform_support"===ral.getFeatureProperty("HTMLImageElement","spec")){let t=window.HTMLImageElement;module.exports=t}else{window.ral=window.ral||{};let r=ral.createImage,e,s,h;if(void 0===ral.getFeatureProperty("ral.createImage","spec")){e=r();let t=Object.getOwnPropertyDescriptor(e.__proto__,"src");s=t.set,h=t.get}class f extends HTMLElement{constructor(t,e,i){if(!i)throw new TypeError("Illegal constructor, use 'new Image(w, h); instead!'");if(super("IMG"),this.complete=!1,this.crossOrigin=null,this.naturalWidth=0,this.naturalHeight=0,this.width=t||0,this.height=e||0,void 0===ral.getFeatureProperty("ral.createImage","spec")){let e=r();return Object.keys(this).forEach(function(t){e[t]=this[t]}.bind(this)),e._onload=function(){this.complete=!0,this.naturalWidth=this.width,this.naturalHeight=this.height,this.dispatchEvent(new Event("load"))}.bind(e),e._onerror=function(){this.dispatchEvent(new Event("error"))}.bind(e),Object.defineProperty(e,"src",{configurable:!0,enumerable:!0,get:function(){return h.call(this)},set:function(t){return this.complete=!1,s.call(this,t)}}),e}}getBoundingClientRect(){return new DOMRect(0,0,this.width,this.height)}set src(t){""===(this._src=t)?(this.width=0,this.height=0,this._data=null,this._imageMeta=null,this.complete=!0,this._glFormat=this._glInternalFormat=6408,this.crossOrigin=null):ral.loadImageData(t,t=>{t=t?(this._imageMeta=t,this.width=this.naturalWidth=t.width,this.height=this.naturalHeight=t.height,this._data=t.data,this._glFormat=t.glFormat,this._glInternalFormat=t.glInternalFormat,this._glType=t.glType,this._numberOfMipmaps=t.numberOfMipmaps,this._compressed=t.compressed,this._bpp=t.bpp,this._premultiplyAlpha=t.premultiplyAlpha,this._alignment=1,0!=this._numberOfMipmaps&&1!=this._numberOfMipmaps||this._compressed||((t=this.width*this._bpp/8)%8==0?this._alignment=8:t%4==0?this._alignment=4:t%2==0&&(this._alignment=2)),this.complete=!0,new Event("load")):new Event("error"),this.dispatchEvent(t)})}get src(){return this._src}get clientWidth(){return this.width}get clientHeight(){return this.height}}module.exports=f}