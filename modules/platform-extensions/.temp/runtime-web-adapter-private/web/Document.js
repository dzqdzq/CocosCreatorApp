import Audio from"./Audio";import FontFaceSet from"./FontFaceSet";import Node from"./Node";import NodeList from"./NodeList";import HTMLAnchorElement from"./HTMLAnchorElement";import HTMLElement from"./HTMLElement";import HTMLHtmlElement from"./HTMLHtmlElement";import HTMLBodyElement from"./HTMLBodyElement";import HTMLHeadElement from"./HTMLHeadElement";import HTMLCanvasElement from"./HTMLCanvasElement";import HTMLVideoElement from"./HTMLVideoElement";import HTMLScriptElement from"./HTMLScriptElement";import HTMLStyleElement from"./HTMLStyleElement";import HTMLInputElement from"./HTMLInputElement";import _weakMap from"./util/WeakMap";let _html=new HTMLHtmlElement;export default class Document extends Node{head=new HTMLHeadElement(_html);body=new HTMLBodyElement(_html);fonts=new FontFaceSet;cookie="";documentElement=_html;readyState="complete";visibilityState="visible";hidden=!1;style={};location=window.location;ontouchstart=null;ontouchmove=null;ontouchend=null;get characterSet(){return"UTF-8"}get scripts(){return _weakMap.get(this).scripts.slice(0)}constructor(){super(),_html.appendChild(this.head),_html.appendChild(this.body),_weakMap.get(this).scripts=[]}createElement(e){return"string"!=typeof e?null:"CANVAS"===(e=e.toUpperCase())?new HTMLCanvasElement:"IMG"===e?new Image:"VIDEO"===e?new HTMLVideoElement:"SCRIPT"===e?new HTMLScriptElement:"INPUT"===e?new HTMLInputElement:"AUDIO"===e?new Audio:"STYLE"===e?new HTMLStyleElement:"A"===e?new HTMLAnchorElement:new HTMLElement(e)}createElementNS(e,t,n){return this.createElement(t)}createEvent(e){return window[e]?new window[e]:null}createTextNode(){console.warn("document.createTextNode() is not support!")}dispatchEvent(){return!!_html.dispatchEvent(...arguments)&&super.dispatchEvent(...arguments)}appendChild(e){return"SCRIPT"===e.nodeName&&_weakMap.get(this).scripts.push(e),super.appendChild(e)}removeChild(n){if("SCRIPT"===n.nodeName){var r=_weakMap.get(this).scripts;for(let e=0,t=r.length;e<t;++e)if(n===r[e]){r.slice(e,1);break}}return super.removeChild(n)}getElementById(e){if(!arguments.length)throw"Uncaught TypeError: Failed to execute 'getElementById' on 'Document': 1 argument required, but only 0 present.";var t=this.documentElement;let n=[].concat(t.childNodes),r;if("canvas"===e||"glcanvas"===e)for(;r=n.pop();){if("canvas"===r.id||"glcanvas"===r.id)return r;n=n.concat(r.childNodes)}else for(;r=n.pop();){if(r.id===e)return r;n=n.concat(r.childNodes)}return null}getElementsByClassName(e){if(arguments.length)return"string"!=typeof e&&e instanceof String?new NodeList:this.documentElement.getElementsByClassName(e);throw"Uncaught TypeError: Failed to execute 'getElementsByClassName' on 'Document': 1 argument required, but only 0 present."}getElementsByTagName(e){if(!arguments.length)throw"Uncaught TypeError: Failed to execute 'getElementsByTagName' on 'Document': 1 argument required, but only 0 present.";e=e.toUpperCase();var t=this.documentElement;let n=new NodeList;switch(e){case"HEAD":n.push(document.head);break;case"BODY":n.push(document.body);break;default:n=n.concat(t.getElementsByTagName(e))}return n}getElementsByName(e){if(!arguments.length)throw"Uncaught TypeError: Failed to execute 'getElementsByName' on 'Document': 1 argument required, but only 0 present.";let t=[].concat(this.childNodes);for(var n,r=new NodeList;n=t.pop();)n.name===e&&r.push(n),t=t.concat(n.childNodes);return r}querySelector(t){if(!arguments.length)throw"Uncaught TypeError: Failed to execute 'querySelectorAll' on 'Document': 1 argument required, but only 0 present.";let n=new NodeList;switch(t){case null:case void 0:case NaN:case!0:case!1:case"":return null}if("string"!=typeof t&&t instanceof String)throw"Uncaught DOMException: Failed to execute 'querySelectorAll' on 'Document': '"+t+"' is not a valid selector.";if(t.match(/^[A-Za-z]+$/))return 0<(e=this.getElementsByTagName(t)).length?e.item(0):null;if(t.match(/^\.[A-Za-z$_][A-Za-z$_0-9\- ]*$/)){var e=t.split(" "),r=e.shift(),o=(n=this.getElementsByClassName(r.substr(1)),e.length);if(o){t=e.join(" "),o=n.length;for(let e=0;e<o;e++){var l=n[e].querySelector(t);if(l)return l}}return n[0]}return t.match(/^#[A-Za-z$_][A-Za-z$_0-9\-]*$/)&&(r=this.getElementById(t.substr(1)))&&n.push(r),"*"===t?0<(e=this.getElementsByTagName(t)).length?e.item(0):null:n[0]}querySelectorAll(e){if(!arguments.length)throw"Uncaught TypeError: Failed to execute 'querySelectorAll' on 'Document': 1 argument required, but only 0 present.";var t,n=new NodeList;switch(e){case null:case void 0:case NaN:case!0:case!1:case"":return n}if("string"!=typeof e&&e instanceof String)throw"Uncaught DOMException: Failed to execute 'querySelectorAll' on 'Document': '"+e+"' is not a valid selector.";return e.match(/^[A-Za-z]+$/)?this.getElementsByTagName(e):e.match(/^\.[A-Za-z$_][A-Za-z$_0-9\-]*$/)?this.getElementsByClassName(e.substr(1)):(e.match(/^#[A-Za-z$_][A-Za-z$_0-9\-]*$/)&&(t=this.getElementById(e.substr(1)))&&n.push(t),"*"===e?this.getElementsByTagName(e):n)}}