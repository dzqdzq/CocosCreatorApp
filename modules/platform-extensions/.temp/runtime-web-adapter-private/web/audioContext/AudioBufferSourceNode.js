import AudioNode from"./AudioNode";import AudioParam from"./AudioParam";import _weakMap from"../util/WeakMap";const _destroy=function(){var t=_weakMap.get(this.sourceNode).innerAudioContext;if(null!==t){t.destroy();var o=_weakMap.get(this.audioContext).audioBufferSourceNodeArray,a=o.length;for(let e=0;e<a;++e)if(_weakMap.get(o[e]).innerAudioContext==t){o.splice(e,1);break}_weakMap.get(this.sourceNode).innerAudioContext=null}};class AudioBufferSourceNode extends AudioNode{constructor(e,t){super(e),this.buffer=null,this.detune=new AudioParam({value:0}),this._loop=!1,this.loopStart=0,this.loopEnd=0,this._playbackRate=new AudioParam({value:1});var o=ral.createInnerAudioContext();(_weakMap.get(this).innerAudioContext=o).onEnded(_destroy.bind({sourceNode:this,audioContext:e})),o.onStop(_destroy.bind({sourceNode:this,audioContext:e}))}start(e,t,o){var a;this.buffer&&null!==(a=_weakMap.get(this).innerAudioContext)&&(a.src=this.buffer.url,a.startTime=!t||"number"!=typeof t||t<=0?0:t,!e||"number"!=typeof e||e<=0?a.play():setTimeout(function(){var e=_weakMap.get(this).innerAudioContext;null!==e&&e.play()}.bind(this),1e3*e))}stop(e){var t=_weakMap.get(this).innerAudioContext;null!==t&&(!e||"number"!=typeof e||e<=0?t.stop():setTimeout(function(){var e=_weakMap.get(this).innerAudioContext;null!==e&&e.stop()}.bind(this),1e3*e))}onended(){}set playbackRate(e){console.warn("playbackRate nonsupport"),this._playbackRate=e}get playbackRate(){return this._playbackRate}set loop(e){var t=_weakMap.get(this).innerAudioContext;null!==t&&(this._loop=e,t.loop=e)}get loop(){return this._loop}}export default AudioBufferSourceNode;