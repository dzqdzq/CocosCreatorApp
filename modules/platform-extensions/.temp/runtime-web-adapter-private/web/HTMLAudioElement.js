import HTMLMediaElement from"./HTMLMediaElement";import Event from"./Event";import _weakMap from"./util/WeakMap";export default class HTMLAudioElement extends HTMLMediaElement{constructor(e){super(e,"AUDIO");let t=ral.createInnerAudioContext();t.onCanplay(function(){_weakMap.get(this).duration=t.duration,this.dispatchEvent(new Event("canplay")),this.dispatchEvent(new Event("canplaythrough")),this.dispatchEvent(new Event("durationchange")),this.dispatchEvent(new Event("loadedmetadata")),this.dispatchEvent(new Event("loadeddata"))}.bind(this)),t.onPlay(function(){this.dispatchEvent(new Event("play")),this.dispatchEvent(new Event("playing"))}.bind(this)),t.onPause(function(){this.dispatchEvent(new Event("pause"))}.bind(this)),t.onEnded(function(){this.dispatchEvent(new Event("ended"))}.bind(this)),t.onError(function(){_weakMap.get(this).duration=NaN,this.dispatchEvent(new Event("error")),this.dispatchEvent(new Event("emptied"))}.bind(this)),t.onWaiting(function(){this.dispatchEvent(new Event("waiting"))}.bind(this)),t.onSeeked(function(){this.dispatchEvent(new Event("seeked"))}.bind(this)),t.onSeeking(function(){this.dispatchEvent(new Event("seeking"))}.bind(this)),t.onTimeUpdate(function(){this.dispatchEvent(new Event("timeupdate"))}.bind(this)),t.src=e,_weakMap.get(this).innerAudioContext=t,_weakMap.get(this).duration=NaN}get currentTime(){return _weakMap.get(this).innerAudioContext.currentTime}set currentTime(e){_weakMap.get(this).innerAudioContext.seek(e)}get loop(){return super.loop}set loop(e){super.loop=e,_weakMap.get(this).innerAudioContext.loop=e}get volume(){return super.volume}set volume(e){super.volume=e,_weakMap.get(this).innerAudioContext.volume=e,this.dispatchEvent(new Event("volumechange"))}canPlayType(e=""){return"string"==typeof e&&(-1<e.indexOf("audio/mpeg")||e.indexOf("audio/mp4"))?"probably":""}get src(){return super.src}set src(e){super.src=e,this.dispatchEvent(new Event("loadstart")),_weakMap.get(this).innerAudioContext.src=e}load(){this.dispatchEvent(new Event("loadstart")),_weakMap.get(this).innerAudioContext.src=super.src}pause(){_weakMap.get(this).innerAudioContext.pause()}play(){_weakMap.get(this).innerAudioContext.play(),this.dispatchEvent(new Event("progress"))}}