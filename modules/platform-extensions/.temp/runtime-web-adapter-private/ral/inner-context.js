const _CANPLAY_CALLBACK="canplayCallbacks",_ENDED_CALLBACK="endedCallbacks",_ERROR_CALLBACK="errorCallbacks",_PAUSE_CALLBACK="pauseCallbacks",_PLAY_CALLBACK="playCallbacks",_SEEKED_CALLBACK="seekedCallbacks",_SEEKING_CALLBACK="seekingCallbacks",_STOP_CALLBACK="stopCallbacks",_TIME_UPDATE_CALLBACK="timeUpdateCallbacks",_WAITING_CALLBACK="waitingCallbacks",_ERROR_CODE={ERROR_SYSTEM:10001,ERROR_NET:10002,ERROR_FILE:10003,ERROR_FORMAT:10004,ERROR_UNKNOWN:-1},_STATE={ERROR:-1,INITIALIZING:0,PLAYING:1,PAUSED:2};let _audioEngine=void 0;const _weakMap=new WeakMap,_offCallback=function(t,e,a){t=_weakMap.get(t);if("function"!=typeof a||!t)return-1;var i=t[e]||[];for(let t=0,e=i.length;t<e;++t)if(a===i[t])return i.splice(t,1),a.length+1;return 0},_onCallback=function(t,e,a){t=_weakMap.get(t);if("function"!=typeof a||!t)return-1;let i=t[e];if(i){for(let t=0,e=i.length;t<e;++t)if(a===i[t])return 0;i.push(a)}else i=t[e]=[a];return i.length},_dispatchCallback=function(a,t,i=[]){var e=_weakMap.get(a);if(e){var o=e[t]||[];for(let t=0,e=o.length;t<e;++t)o[t].apply(a,i)}};function InnerAudioContext(){this.startTime=0,this.autoplay=!1,_weakMap.set(this,{src:"",volume:1,loop:!1,seekPosition:-1}),Object.defineProperty(this,"loop",{set(t){t=!!t;var e,a=_weakMap.get(this);a&&("number"==typeof(e=a.audioID)&&0<=e&&_audioEngine.setLoop(e,t),a.loop=t)},get(){var t=_weakMap.get(this);return!!t&&t.loop}}),Object.defineProperty(this,"volume",{set(t){"number"==typeof t?t<0?t=0:1<t&&(t=1):t=1;var e,a=_weakMap.get(this);a&&("number"==typeof(e=a.audioID)&&0<=e&&_audioEngine.setVolume(e,t),a.volume=t)},get(){var t=_weakMap.get(this);return t?t.volume:1}}),Object.defineProperty(this,"src",{set(e){var a=_weakMap.get(this);if(a){var i=a.src;if("string"==typeof(a.src=e)){var o=a.audioID;"number"==typeof o&&0<=o&&_audioEngine.getState(o)===_STATE.PAUSED&&i!==e&&(_audioEngine.stop(o),a.audioID=-1);let t=this;_audioEngine.preload(e,function(){setTimeout(function(){t.src===e&&(_dispatchCallback(t,_CANPLAY_CALLBACK),t.autoplay)&&t.play()})})}}},get(){var t=_weakMap.get(this);return t?t.src:""}}),Object.defineProperty(this,"duration",{get(){var t=_weakMap.get(this);if(t){t=t.audioID;if("number"==typeof t&&0<=t)return _audioEngine.getDuration(t)}return NaN},set(){}}),Object.defineProperty(this,"currentTime",{get(){var t=_weakMap.get(this);if(t){t=t.audioID;if("number"==typeof t&&0<=t)return _audioEngine.getCurrentTime(t)}return 0},set(){}}),Object.defineProperty(this,"paused",{get(){var t=_weakMap.get(this);if(t){t=t.audioID;if("number"==typeof t&&0<=t)return _audioEngine.getState(t)===_STATE.PAUSED}return!0},set(){}}),Object.defineProperty(this,"buffered",{get(){var t=_weakMap.get(this);if(t){t=t.audioID;if("number"==typeof t&&0<=t)return _audioEngine.getBuffered(t)}return 0},set(){}})}let _prototype=InnerAudioContext.prototype;_prototype.destroy=function(){var t,e=_weakMap.get(this);e&&("number"==typeof(t=e.audioID)&&0<=t&&(_audioEngine.stop(t),e.audioID=-1,_dispatchCallback(this,_STOP_CALLBACK)),e[_CANPLAY_CALLBACK]=[],e[_ENDED_CALLBACK]=[],e[_ERROR_CALLBACK]=[],e[_PAUSE_CALLBACK]=[],e[_PLAY_CALLBACK]=[],e[_SEEKED_CALLBACK]=[],e[_SEEKING_CALLBACK]=[],e[_STOP_CALLBACK]=[],e[_TIME_UPDATE_CALLBACK]=[],e[_WAITING_CALLBACK]=[],clearInterval(e.intervalID))},_prototype.play=function(){let a=_weakMap.get(this);if(a){let e=a.src;var i=a.audioID;if("string"!=typeof e||""===e)_dispatchCallback(this,_ERROR_CALLBACK,[{errMsg:"invalid src",errCode:_ERROR_CODE.ERROR_FILE}]);else{if("number"==typeof i&&0<=i){if(_audioEngine.getState(i)===_STATE.PAUSED)return _audioEngine.resume(i),void _dispatchCallback(this,_PLAY_CALLBACK);_audioEngine.stop(i),a.audioID=-1}if(-1===(i=_audioEngine.play(e,this.loop,this.volume)))_dispatchCallback(this,_ERROR_CALLBACK,[{errMsg:"unknown",errCode:_ERROR_CODE.ERROR_UNKNOWN}]);else{a.audioID=i,0<=a.seekPosition?(_audioEngine.setCurrentTime(i,a.seekPosition),a.seekPosition=-1):"number"==typeof this.startTime&&0<this.startTime&&_audioEngine.setCurrentTime(i,this.startTime),_dispatchCallback(this,_WAITING_CALLBACK);let t=this;_audioEngine.setCanPlayCallback(i,function(){e===t.src&&(_dispatchCallback(t,_CANPLAY_CALLBACK),_dispatchCallback(t,_PLAY_CALLBACK))}),_audioEngine.setWaitingCallback(i,function(){e===t.src&&_dispatchCallback(t,_WAITING_CALLBACK)}),_audioEngine.setErrorCallback(i,function(){e===t.src&&(a.audioID=-1,_dispatchCallback(t,_ERROR_CALLBACK))}),_audioEngine.setFinishCallback(i,function(){e===t.src&&(a.audioID=-1,_dispatchCallback(t,_ENDED_CALLBACK))})}}}},_prototype.pause=function(){var t=_weakMap.get(this);t&&"number"==typeof(t=t.audioID)&&0<=t&&(_audioEngine.pause(t),_dispatchCallback(this,_PAUSE_CALLBACK))},_prototype.seek=function(t){var e,a=_weakMap.get(this);a&&"number"==typeof t&&0<=t&&("number"==typeof(e=a.audioID)&&0<=e?(_audioEngine.setCurrentTime(e,t),_dispatchCallback(this,_SEEKING_CALLBACK),_dispatchCallback(this,_SEEKED_CALLBACK)):a.seekPosition=t)},_prototype.stop=function(){var t,e=_weakMap.get(this);e&&"number"==typeof(t=e.audioID)&&0<=t&&(_audioEngine.stop(t),e.audioID=-1,_dispatchCallback(this,_STOP_CALLBACK))},_prototype.offCanplay=function(t){_offCallback(this,_CANPLAY_CALLBACK,t)},_prototype.offEnded=function(t){_offCallback(this,_ENDED_CALLBACK,t)},_prototype.offError=function(t){_offCallback(this,_ERROR_CALLBACK,t)},_prototype.offPause=function(t){_offCallback(this,_PAUSE_CALLBACK,t)},_prototype.offPlay=function(t){_offCallback(this,_PLAY_CALLBACK,t)},_prototype.offSeeked=function(t){_offCallback(this,_SEEKED_CALLBACK,t)},_prototype.offSeeking=function(t){_offCallback(this,_SEEKING_CALLBACK,t)},_prototype.offStop=function(t){_offCallback(this,_STOP_CALLBACK,t)},_prototype.offTimeUpdate=function(t){1===_offCallback(this,_TIME_UPDATE_CALLBACK,t)&&clearInterval(_weakMap.get(this).intervalID)},_prototype.offWaiting=function(t){_offCallback(this,_WAITING_CALLBACK,t)},_prototype.onCanplay=function(t){_onCallback(this,_CANPLAY_CALLBACK,t)},_prototype.onEnded=function(t){_onCallback(this,_ENDED_CALLBACK,t)},_prototype.onError=function(t){_onCallback(this,_ERROR_CALLBACK,t)},_prototype.onPause=function(t){_onCallback(this,_PAUSE_CALLBACK,t)},_prototype.onPlay=function(t){_onCallback(this,_PLAY_CALLBACK,t)},_prototype.onSeeked=function(t){_onCallback(this,_SEEKED_CALLBACK,t)},_prototype.onSeeking=function(t){_onCallback(this,"seekingCallbacks",t)},_prototype.onStop=function(t){_onCallback(this,_STOP_CALLBACK,t)},_prototype.onTimeUpdate=function(t){if(1===_onCallback(this,_TIME_UPDATE_CALLBACK,t)){t=_weakMap.get(this);let e=this,a=setInterval(function(){var t=_weakMap.get(e);t?"number"==typeof(t=t.audioID)&&0<=t&&_audioEngine.getState(t)===_STATE.PLAYING&&_dispatchCallback(e,_TIME_UPDATE_CALLBACK):clearInterval(a)},500);t.intervalID=a}},_prototype.onWaiting=function(t){_onCallback(this,_WAITING_CALLBACK,t)};export default function(e){return void 0===_audioEngine&&(_audioEngine=Object.assign({},e),Object.keys(e).forEach(function(t){"function"==typeof e[t]&&(e[t]=function(){return console.warn("AudioEngine."+t+" is deprecated"),_audioEngine[t].apply(e,arguments)})})),new InnerAudioContext}