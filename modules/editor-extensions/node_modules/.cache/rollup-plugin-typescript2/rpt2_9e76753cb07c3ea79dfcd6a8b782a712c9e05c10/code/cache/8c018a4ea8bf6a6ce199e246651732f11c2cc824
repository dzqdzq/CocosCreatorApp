{"code":"import fs from 'fs';\nimport { basename, join } from 'path';\nlet filesList = [];\n/**\n * 这种格式的时间转为正常的日期\n * Thu May 12 2016 08:00:00 GMT+0800 (中国标准时间)\n */\nfunction convertTime(target) {\n    const d = new Date(target);\n    return (d.getFullYear() +\n        '-' +\n        (d.getMonth() + 1).toString().padStart(2, '0') +\n        '-' +\n        d.getDate().toString().padStart(2, '0') +\n        ' ' +\n        d.getHours().toString().padStart(2, '0') +\n        ':' +\n        d.getMinutes().toString().padStart(2, '0') +\n        ':' +\n        d.getSeconds().toString().padStart(2, '0'));\n}\nexport default async function readImageList(path, isSub = false) {\n    isSub || (filesList = []);\n    const files = fs.readdirSync(path);\n    await Promise.all(files.map(async (itm) => {\n        const res = join(path, itm);\n        const stat = fs.statSync(res);\n        if (stat.isDirectory()) {\n            // 递归读取文件\n            readImageList(res, true);\n        }\n        else {\n            if (itm.endsWith('.png')) {\n                const url = await Editor.Message.request('asset-db', 'query-url', res);\n                let uuid = null;\n                if (url) {\n                    uuid = await Editor.Message.request('asset-db', 'query-uuid', url);\n                }\n                // 定义一个对象存放图片的路径和名字\n                const obj = {\n                    path: res,\n                    filename: itm,\n                    size: formatBytes(stat.size),\n                    birthtime: convertTime(stat.birthtime),\n                    uuid,\n                    mtime: convertTime(stat.mtime),\n                };\n                filesList.push(obj);\n            }\n        }\n    }));\n    return filesList;\n}\nexport async function getImageInfo(imageUUID) {\n    const path = await Editor.Message.request('asset-db', 'query-path', imageUUID);\n    if (!path) {\n        return null;\n    }\n    try {\n        const stat = fs.statSync(path);\n        const obj = {\n            path,\n            filename: basename(path),\n            size: formatBytes(stat.size),\n            birthtime: convertTime(stat.birthtime),\n            uuid: imageUUID,\n            mtime: convertTime(stat.mtime),\n        };\n        return obj;\n    }\n    catch (error) {\n        console.debug(error);\n        return null;\n    }\n}\nexport function formatBytes(bytes, decimals = 2) {\n    if (bytes === 0) {\n        return '0 Bytes';\n    }\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n","references":["/Users/mac/Documents/editor_3d/v3.8.7/app/node_modules/path/path.js"]}
