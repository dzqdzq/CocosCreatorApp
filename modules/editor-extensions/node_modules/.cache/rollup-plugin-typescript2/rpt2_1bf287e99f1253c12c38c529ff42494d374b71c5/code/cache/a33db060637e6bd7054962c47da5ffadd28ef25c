{"code":"'use strict';\nconst Chroma = require('chroma-js');\nlet isStart = false;\nlet isFinish = false;\nlet isEnd = false;\nlet currProgress = 0;\nlet bakerSum = 20;\nlet progress = 0;\nlet logInfos = [];\nlet currPath;\nfunction initVal() {\n    currProgress = 0;\n    bakerSum = 20;\n    progress = 0;\n}\nfunction changeProgress(prog = null, halfPart = true) {\n    if (!prog) {\n        currProgress += 10;\n        if (currProgress >= bakerSum - 10) {\n            bakerSum += 10;\n        }\n        prog = (currProgress / bakerSum) * 100;\n        if (halfPart) {\n            prog /= 2;\n        }\n    }\n    progress = prog;\n}\nexport const methods = {\n    /**\n     * 打开偏好设置面板\n     */\n    async open() {\n        const bake_feature = await Editor.Profile.getConfig('lightmap', 'laboratory.bake_feature');\n        if (bake_feature) {\n            isStart = false;\n            logInfos = [];\n            Editor.Panel.open('lightmap.panel');\n        }\n        else {\n            Editor.Dialog.warn(Editor.I18n.t('lightmap.openWarn'));\n        }\n    },\n    async start() {\n        console.debug('Light map panel output info: start.');\n        isStart = true;\n        isFinish = false;\n        isEnd = false;\n        logInfos = [];\n        logInfos.push('Baking started');\n    },\n    cancel() {\n        isEnd = true;\n        initVal();\n    },\n    log(data) {\n        console.debug('Light map panel output info: log.', data);\n        logInfos.push(data);\n        if (isFinish) {\n            changeProgress(null, false);\n        }\n    },\n    progress(data) {\n        console.debug('Light map panel output info: progress.', data);\n        logInfos.push(data);\n        if (!isFinish) {\n            changeProgress();\n        }\n    },\n    // 烘焙库的任务结束,此时还未输出图片\n    finished() {\n        console.debug('Light map panel output info: finished.');\n        isFinish = true;\n        isEnd = false;\n        logInfos.push('The baking is ready to complete and begin generating images.');\n        changeProgress(50);\n    },\n    // 烘焙全部结束,此时已输出图片\n    async end() {\n        console.debug('light map panel output info: end.');\n        isEnd = true;\n        logInfos.push('End of the baking.');\n        logInfos.push(Editor.I18n.t('lightmap.end'));\n        initVal();\n    },\n    async clear() {\n        console.debug('Light map panel output info: clear.');\n        logInfos = [];\n        isStart = false;\n        isFinish = false;\n        isEnd = false;\n        initVal();\n        currPath = '';\n    },\n    async unstaging() {\n        return {\n            progress,\n            logInfos,\n            currPath,\n            isStart,\n            isFinish,\n            isEnd,\n        };\n    },\n    async savePicPath(path) {\n        currPath = Editor.Utils.Path.normalize(path);\n    },\n    async getConfig() {\n        let lightMapData = await Editor.Profile.getConfig('lightmap', 'lightmap');\n        if (!lightMapData) {\n            lightMapData = {\n                msaa: 4,\n                path: '',\n                size: 1024,\n                highp: false,\n                giScale: 1,\n                giSamples: 25,\n                giPathLength: 4,\n                aoLevel: 0,\n                aoStrength: 0.5,\n                aoRadius: 1.0,\n                aoColor: [136, 136, 136, 255],\n                tab: 0,\n                r: true,\n                g: true,\n                b: true,\n                a: false,\n                filter: true,\n            };\n        }\n        // 兼容 v3.7 以下版本用户数据 aoColor 可能是字符串\n        if (typeof lightMapData.aoColor === 'string') {\n            lightMapData.aoColor = Chroma(lightMapData.aoColor).rgb();\n        }\n        return lightMapData;\n    },\n    bakeLightProbe(lightMapData) {\n        Editor.Message.send('scene', 'execute-scene-script', {\n            name: 'lightmap',\n            method: 'bakeLightProbe',\n            args: [lightMapData, Editor.App.path],\n        });\n    },\n    cancelLightProbe() {\n        Editor.Message.send('scene', 'execute-scene-script', {\n            name: 'lightmap',\n            method: 'cancelLightProbe',\n            args: [],\n        });\n    },\n};\nexport async function load() { }\nexport function unload() { }\n","references":["/Users/mac/Documents/editor_3d/v3.8.8/app/node_modules/chroma-js/chroma.js"]}
