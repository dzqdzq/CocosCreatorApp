'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
module.paths.push((0, path_1.join)(Editor.App.path, 'node_modules'));
const cc_1 = require("cc");
const fs_1 = require("fs");
const { HideInHierarchy, DontSave } = cc_1.CCObject.Flags;
const NAME = 'Reference-Image';
exports.methods = {
    // 通过图片创建参考图
    async getTargets() {
        let canvas = (0, cc_1.find)(`Editor Scene Background/${NAME}-Canvas`);
        if (!canvas) {
            canvas = new cc_1.Node(`${NAME}-Canvas`);
            canvas.addComponent(cc_1.Canvas);
            canvas.parent = (0, cc_1.find)('Editor Scene Background');
            canvas.hideFlags |= DontSave | HideInHierarchy;
        }
        let node = canvas.getChildByName(NAME);
        if (!node) {
            node = new cc_1.Node(NAME);
            node.parent = canvas;
            node.hideFlags |= DontSave | HideInHierarchy;
        }
        node.active = await Editor.Profile.getConfig('reference-image', 'show');
        let sprite = node.getComponent(cc_1.Sprite);
        if (!sprite) {
            sprite = node.addComponent(cc_1.Sprite);
            const color = sprite.color.clone();
            color.a = await Editor.Profile.getConfig('reference-image', 'opacity') ?? 50;
            sprite.color = color;
        }
        cce.Engine.repaintInEditMode();
        return {
            node,
            sprite,
        };
    },
    /**
     * 同步数据
     * @param data
     */
    async syncData(data) {
        try {
            const { node, sprite } = await this.getTargets();
            const position = node.position;
            data.sx;
            position.x = data.x;
            position.y = data.y;
            position.z = 0;
            node.position = position;
            const scale = node.scale;
            scale.x = data.sx;
            scale.y = data.sy;
            scale.z = 1;
            node.scale = scale;
            const color = sprite.color.clone();
            color.a = data.opacity;
            sprite.color = color;
            cce.Engine.repaintInEditMode();
        }
        catch (e) {
            console.log('sync data invalid. ', e);
        }
    },
    // 切换参考图
    async switchImages(path) {
        const { sprite } = await this.getTargets();
        let data = (0, fs_1.readFileSync)(path);
        data = new Buffer(data).toString('base64');
        // @ts-ignore
        const image = new ccwindow.Image();
        image.src = 'data:png;base64,' + data;
        image.onload = () => {
            sprite.spriteFrame = cc_1.SpriteFrame.createWithImage(image);
            cce.Engine.repaintInEditMode();
        };
    },
    // 清空
    async resetImage() {
        const { sprite } = await this.getTargets();
        sprite.spriteFrame = null;
        cce.Engine.repaintInEditMode();
    },
    // 设置参考图是否显示
    async setImageVisible(value) {
        const { node } = await this.getTargets();
        node.active = value;
        if (value) {
            Editor.Panel.open('reference-image');
        }
        cce.Engine.repaintInEditMode();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtd2Fsa2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL2NvbnRyaWJ1dGlvbnMvc2NlbmUtd2Fsa2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFFYiwrQkFBNEI7QUFLNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBQSxXQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQztBQUV6RCwyQkFBdUU7QUFDdkUsMkJBQWtDO0FBR2xDLE1BQU0sRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLEdBQUcsYUFBUSxDQUFDLEtBQUssQ0FBQztBQUVyRCxNQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQztBQUUvQixPQUFPLENBQUMsT0FBTyxHQUFHO0lBQ2QsWUFBWTtJQUNaLEtBQUssQ0FBQyxVQUFVO1FBQ1osSUFBSSxNQUFNLEdBQUcsSUFBQSxTQUFJLEVBQUMsMkJBQTJCLElBQUksU0FBUyxDQUFDLENBQUM7UUFDNUQsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNULE1BQU0sR0FBRyxJQUFJLFNBQUksQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFNLENBQUMsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxHQUFHLElBQUEsU0FBSSxFQUFDLHlCQUF5QixDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLFNBQVMsSUFBSSxRQUFRLEdBQUcsZUFBZSxDQUFDO1NBQ2xEO1FBQ0QsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsSUFBSSxHQUFHLElBQUksU0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JC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QUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hELEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUM7SUFDTixDQUFDO0lBRUQsS0FBSztJQUNMLEtBQUssQ0FBQyxVQUFVO1FBQ1osTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQzFCLEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQsWUFBWTtJQUNaLEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBYztRQUNoQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsSUFBSSxLQUFLLEVBQUU7WUFDUCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQ25DLENBQUM7Q0FDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5cbmRlY2xhcmUgY29uc3QgY2NlOiBhbnk7XG5kZWNsYXJlIGNvbnN0IEVkaXRvcjogYW55O1xuXG5tb2R1bGUucGF0aHMucHVzaChqb2luKEVkaXRvci5BcHAucGF0aCwgJ25vZGVfbW9kdWxlcycpKTtcblxuaW1wb3J0IHsgTm9kZSwgQ2FudmFzLCBTcHJpdGUsIGZpbmQsIFNwcml0ZUZyYW1lLCBDQ09iamVjdCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IElJbWFnZURhdGEgfSBmcm9tICcuLi9kYXRhJztcblxuY29uc3QgeyBIaWRlSW5IaWVyYXJjaHksIERvbnRTYXZlIH0gPSBDQ09iamVjdC5GbGFncztcblxuY29uc3QgTkFNRSA9ICdSZWZlcmVuY2UtSW1hZ2UnO1xuXG5leHBvcnRzLm1ldGhvZHMgPSB7XG4gICAgLy8g6YCa6L+H5Zu+54mH5Yib5bu65Y+C6ICD5Zu+XG4gICAgYXN5bmMgZ2V0VGFyZ2V0cygpOiBQcm9taXNlPHsgbm9kZTogTm9kZSwgc3ByaXRlOiBTcHJpdGUgfT4ge1xuICAgICAgICBsZXQgY2FudmFzID0gZmluZChgRWRpdG9yIFNjZW5lIEJhY2tncm91bmQvJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgaWYgKCFjYW52YXMpIHtcbiAgICAgICAgICAgIGNhbnZhcyA9IG5ldyBOb2RlKGAke05BTUV9LUNhbnZhc2ApO1xuICAgICAgICAgICAgY2FudmFzLmFkZENvbXBvbmVudChDYW52YXMpO1xuICAgICAgICAgICAgY2FudmFzLnBhcmVudCA9IGZpbmQoJ0VkaXRvciBTY2VuZSBCYWNrZ3JvdW5kJyk7XG4gICAgICAgICAgICBjYW52YXMuaGlkZUZsYWdzIHw9IERvbnRTYXZlIHwgSGlkZUluSGllcmFyY2h5O1xuICAgICAgICB9XG4gICAgICAgIGxldCBub2RlID0gY2FudmFzLmdldENoaWxkQnlOYW1lKE5BTUUpO1xuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSBuZXcgTm9kZShOQU1FKTtcbiAgICAgICAgICAgIG5vZGUucGFyZW50ID0gY2FudmFzO1xuICAgICAgICAgICAgbm9kZS5oaWRlRmxhZ3MgfD0gRG9udFNhdmUgfCBIaWRlSW5IaWVyYXJjaHk7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5hY3RpdmUgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdzaG93Jyk7XG5cbiAgICAgICAgbGV0IHNwcml0ZSA9IG5vZGUuZ2V0Q29tcG9uZW50KFNwcml0ZSk7XG4gICAgICAgIGlmICghc3ByaXRlKSB7XG4gICAgICAgICAgICBzcHJpdGUgPSBub2RlLmFkZENvbXBvbmVudChTcHJpdGUpO1xuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBzcHJpdGUuY29sb3IuY2xvbmUoKTtcbiAgICAgICAgICAgIGNvbG9yLmEgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdvcGFjaXR5JykgPz8gNTA7XG4gICAgICAgICAgICBzcHJpdGUuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgc3ByaXRlLFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDlkIzmraXmlbDmja5cbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqL1xuICAgIGFzeW5jIHN5bmNEYXRhKGRhdGE6IElJbWFnZURhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbm9kZSwgc3ByaXRlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbm9kZS5wb3NpdGlvbjtcbiAgICAgICAgICAgIGRhdGEuc3g7XG4gICAgICAgICAgICBwb3NpdGlvbi54ID0gZGF0YS54O1xuICAgICAgICAgICAgcG9zaXRpb24ueSA9IGRhdGEueTtcbiAgICAgICAgICAgIHBvc2l0aW9uLnogPSAwO1xuICAgICAgICAgICAgbm9kZS5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBub2RlLnNjYWxlO1xuICAgICAgICAgICAgc2NhbGUueCA9IGRhdGEuc3g7XG4gICAgICAgICAgICBzY2FsZS55ID0gZGF0YS5zeTtcbiAgICAgICAgICAgIHNjYWxlLnogPSAxO1xuICAgICAgICAgICAgbm9kZS5zY2FsZSA9IHNjYWxlO1xuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBzcHJpdGUuY29sb3IuY2xvbmUoKTtcbiAgICAgICAgICAgIGNvbG9yLmEgPSBkYXRhLm9wYWNpdHk7XG4gICAgICAgICAgICBzcHJpdGUuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N5bmMgZGF0YSBpbnZhbGlkLiAnLCBlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyDliIfmjaLlj4LogIPlm75cbiAgICBhc3luYyBzd2l0Y2hJbWFnZXMocGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHsgc3ByaXRlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgbGV0IGRhdGE6IHN0cmluZyB8IEJ1ZmZlciA9IHJlYWRGaWxlU3luYyhwYXRoKTtcbiAgICAgICAgZGF0YSA9IG5ldyBCdWZmZXIoZGF0YSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IGltYWdlID0gbmV3IGNjd2luZG93LkltYWdlKCk7XG4gICAgICAgIGltYWdlLnNyYyA9ICdkYXRhOnBuZztiYXNlNjQsJyArIGRhdGE7XG4gICAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNwcml0ZS5zcHJpdGVGcmFtZSA9IFNwcml0ZUZyYW1lLmNyZWF0ZVdpdGhJbWFnZShpbWFnZSk7XG4gICAgICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8vIOa4heepulxuICAgIGFzeW5jIHJlc2V0SW1hZ2UoKSB7XG4gICAgICAgIGNvbnN0IHsgc3ByaXRlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgc3ByaXRlLnNwcml0ZUZyYW1lID0gbnVsbDtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH0sXG5cbiAgICAvLyDorr7nva7lj4LogIPlm77mmK/lkKbmmL7npLpcbiAgICBhc3luYyBzZXRJbWFnZVZpc2libGUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBub2RlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgbm9kZS5hY3RpdmUgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBFZGl0b3IuUGFuZWwub3BlbigncmVmZXJlbmNlLWltYWdlJyk7XG4gICAgICAgIH1cbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH0sXG59O1xuIl19