"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),cc_1=(module.paths.push((0,path_1.join)(Editor.App.path,"node_modules")),require("cc")),fs_1=require("fs"),{HideInHierarchy,DontSave}=cc_1.CCObject.Flags,NAME="Reference-Image";exports.methods={async getTargets(){var e,a;let t=(0,cc_1.find)(`Editor Scene Background/${NAME}-Canvas`),c=(t||((t=new cc_1.Node(NAME+"-Canvas")).addComponent(cc_1.Canvas),t.parent=(0,cc_1.find)("Editor Scene Background"),t.hideFlags|=DontSave|HideInHierarchy,t.layer=cc_1.Layers.Enum.EDITOR|cc.Layers.Enum.IGNORE_RAYCAST|cc_1.Layers.Enum.UI_2D),t.getChildByName(NAME)),n=(c||((c=new cc_1.Node(NAME)).parent=t,c.hideFlags|=DontSave|HideInHierarchy,t.layer=cc_1.Layers.Enum.EDITOR|cc.Layers.Enum.IGNORE_RAYCAST|cc_1.Layers.Enum.UI_2D),c.active=await Editor.Profile.getConfig("reference-image","show"),c.getComponent(cc_1.Sprite));return n||((a=(n=c.addComponent(cc_1.Sprite)).color.clone()).a=null!=(e=await Editor.Profile.getConfig("reference-image","opacity"))?e:50,n.color=a),cce.Engine.repaintInEditMode(),{node:c,sprite:n}},async syncData(e){try{var{node:a,sprite:t}=await this.getTargets(),c=a.position.clone(),n=(e.sx,c.x=e.x,c.y=e.y,c.z=0,a.position=c,a.scale.clone()),r=(n.x=e.sx,n.y=e.sy,n.z=1,a.scale=n,t.color.clone());r.a=e.opacity,t.color=r,cce.Engine.repaintInEditMode()}catch(e){console.log("sync data invalid. ",e)}},async switchImages(a){let e=null;try{e=(0,fs_1.readFileSync)(a)}catch(e){console.error("switch image invalid. the path: "+a,e)}if(e){const t=(await this.getTargets())["sprite"],c=(e=Buffer.from(e).toString("base64"),new ccwindow.Image);c.src="data:png;base64,"+e,c.onload=()=>{t.spriteFrame=cc_1.SpriteFrame.createWithImage(c),cce.Engine.repaintInEditMode()}}},async resetImage(){var e=(await this.getTargets())["sprite"];e.spriteFrame=null,cce.Engine.repaintInEditMode()},async setImageVisible(e){var a=(await this.getTargets())["node"];a.active=e,cce.Engine.repaintInEditMode()}};