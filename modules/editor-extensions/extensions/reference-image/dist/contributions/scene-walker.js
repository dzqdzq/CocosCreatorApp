"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),cc_1=(module.paths.push((0,path_1.join)(Editor.App.path,"node_modules")),require("cc")),fs_1=require("fs"),{HideInHierarchy,DontSave}=cc_1.CCObject.Flags,NAME="Reference-Image";exports.methods={async getTargets(){var e,t;let a=(0,cc_1.find)(`Editor Scene Background/${NAME}-Canvas`),n=(a||((a=new cc_1.Node(NAME+"-Canvas")).addComponent(cc_1.Canvas),a.parent=(0,cc_1.find)("Editor Scene Background"),a.hideFlags|=DontSave|HideInHierarchy),a.getChildByName(NAME)),i=(n||((n=new cc_1.Node(NAME)).parent=a,n.hideFlags|=DontSave|HideInHierarchy),n.active=await Editor.Profile.getConfig("reference-image","show"),n.getComponent(cc_1.Sprite));return i||((t=(i=n.addComponent(cc_1.Sprite)).color.clone()).a=null!=(e=await Editor.Profile.getConfig("reference-image","opacity"))?e:50,i.color=t),cce.Engine.repaintInEditMode(),{node:n,sprite:i}},async syncData(e){try{var{node:t,sprite:a}=await this.getTargets(),n=t.position.clone(),i=(e.sx,n.x=e.x,n.y=e.y,n.z=0,t.position=n,t.scale.clone()),c=(i.x=e.sx,i.y=e.sy,i.z=1,t.scale=i,a.color.clone());c.a=e.opacity,a.color=c,cce.Engine.repaintInEditMode()}catch(e){console.log("sync data invalid. ",e)}},async switchImages(e){const t=(await this.getTargets())["sprite"];e=(0,fs_1.readFileSync)(e),e=new Buffer(e).toString("base64");const a=new ccwindow.Image;a.src="data:png;base64,"+e,a.onload=()=>{t.spriteFrame=cc_1.SpriteFrame.createWithImage(a),cce.Engine.repaintInEditMode()}},async resetImage(){var e=(await this.getTargets())["sprite"];e.spriteFrame=null,cce.Engine.repaintInEditMode()},async setImageVisible(e){var t=(await this.getTargets())["node"];t.active=e,cce.Engine.repaintInEditMode()}};