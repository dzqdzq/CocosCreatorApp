'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
module.paths.push(path_1.join(Editor.App.path, 'node_modules'));
const cc_1 = require("cc");
const fs_1 = require("fs");
const { HideInHierarchy, DontSave } = cc_1.CCObject.Flags;
const NAME = 'Reference-Image';
exports.methods = {
    // 通过图片创建参考图
    async getTargets() {
        let canvas = cc_1.find(`Editor Scene Background/${NAME}-Canvas`);
        if (!canvas) {
            canvas = new cc_1.Node(`${NAME}-Canvas`);
            canvas.addComponent(cc_1.Canvas);
            canvas.parent = cc_1.find('Editor Scene Background');
            canvas.hideFlags |= DontSave | HideInHierarchy;
        }
        let node = canvas.getChildByName(NAME);
        if (!node) {
            node = new cc_1.Node(NAME);
            node.parent = canvas;
            node.hideFlags |= DontSave | HideInHierarchy;
        }
        node.active = await Editor.Profile.getConfig('reference-image', 'show');
        let sprite = node.getComponent(cc_1.Sprite);
        if (!sprite) {
            sprite = node.addComponent(cc_1.Sprite);
            const color = sprite.color.clone();
            color.a = await Editor.Profile.getConfig('reference-image', 'opacity') ?? 50;
            sprite.color = color;
        }
        cce.Engine.repaintInEditMode();
        return {
            node,
            sprite,
        };
    },
    /**
     * 同步数据
     * @param data
     */
    async syncData(data) {
        try {
            const { node, sprite } = await this.getTargets();
            const position = node.position;
            data.sx;
            position.x = data.x;
            position.y = data.y;
            position.z = 0;
            node.position = position;
            const scale = node.scale;
            scale.x = data.sx;
            scale.y = data.sy;
            scale.z = 1;
            node.scale = scale;
            const color = sprite.color.clone();
            color.a = data.opacity;
            sprite.color = color;
            cce.Engine.repaintInEditMode();
        }
        catch (e) {
            console.log('sync data invalid. ', e);
        }
    },
    // 切换参考图
    async switchImages(path) {
        const { sprite } = await this.getTargets();
        let data = fs_1.readFileSync(path);
        data = new Buffer(data).toString('base64');
        // @ts-ignore
        const image = new ccwindow.Image();
        image.src = 'data:png;base64,' + data;
        image.onload = () => {
            sprite.spriteFrame = cc_1.SpriteFrame.createWithImage(image);
            cce.Engine.repaintInEditMode();
        };
    },
    // 清空
    async resetImage() {
        const { sprite } = await this.getTargets();
        sprite.spriteFrame = null;
        cce.Engine.repaintInEditMode();
    },
    // 设置参考图是否显示
    async setImageVisible(value) {
        const { node } = await this.getTargets();
        node.active = value;
        if (value) {
            Editor.Panel.open('reference-image');
        }
        cce.Engine.repaintInEditMode();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtd2Fsa2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL2NvbnRyaWJ1dGlvbnMvc2NlbmUtd2Fsa2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFFYiwrQkFBNEI7QUFLNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7QUFFekQsMkJBQXVFO0FBQ3ZFLDJCQUFrQztBQUdsQyxNQUFNLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxHQUFHLGFBQVEsQ0FBQyxLQUFLLENBQUM7QUFFckQsTUFBTSxJQUFJLEdBQUcsaUJBQWlCLENBQUM7QUFFL0IsT0FBTyxDQUFDLE9BQU8sR0FBRztJQUNkLFlBQVk7SUFDWixLQUFLLENBQUMsVUFBVTtRQUNaLElBQUksTUFBTSxHQUFHLFNBQUksQ0FBQywyQkFBMkIsSUFBSSxTQUFTLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1QsTUFBTSxHQUFHLElBQUksU0FBSSxDQUFDLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsWUFBWSxDQUFDLFdBQU0sQ0FBQyxDQUFDO1lBQzVCLE1BQU0sQ0FBQyxNQUFNLEdBQUcsU0FBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLFNBQVMsSUFBSSxRQUFRLEdBQUcsZUFBZSxDQUFDO1NBQ2xEO1FBQ0QsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsSUFBSSxHQUFHLElBQUksU0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxTQUFT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QUN4RCxHQUFHLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDO0lBQ04sQ0FBQztJQUVELEtBQUs7SUFDTCxLQUFLLENBQUMsVUFBVTtRQUNaLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUMzQyxNQUFNLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUMxQixHQUFHLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVELFlBQVk7SUFDWixLQUFLLENBQUMsZUFBZSxDQUFDLEtBQWM7UUFDaEMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksS0FBSyxFQUFFO1lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztTQUN4QztRQUNELEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0NBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuXG5kZWNsYXJlIGNvbnN0IGNjZTogYW55O1xuZGVjbGFyZSBjb25zdCBFZGl0b3I6IGFueTtcblxubW9kdWxlLnBhdGhzLnB1c2goam9pbihFZGl0b3IuQXBwLnBhdGgsICdub2RlX21vZHVsZXMnKSk7XG5cbmltcG9ydCB7IE5vZGUsIENhbnZhcywgU3ByaXRlLCBmaW5kLCBTcHJpdGVGcmFtZSwgQ0NPYmplY3QgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBJSW1hZ2VEYXRhIH0gZnJvbSAnLi4vZGF0YSc7XG5cbmNvbnN0IHsgSGlkZUluSGllcmFyY2h5LCBEb250U2F2ZSB9ID0gQ0NPYmplY3QuRmxhZ3M7XG5cbmNvbnN0IE5BTUUgPSAnUmVmZXJlbmNlLUltYWdlJztcblxuZXhwb3J0cy5tZXRob2RzID0ge1xuICAgIC8vIOmAmui/h+WbvueJh+WIm+W7uuWPguiAg+WbvlxuICAgIGFzeW5jIGdldFRhcmdldHMoKTogUHJvbWlzZTx7IG5vZGU6IE5vZGUsIHNwcml0ZTogU3ByaXRlIH0+IHtcbiAgICAgICAgbGV0IGNhbnZhcyA9IGZpbmQoYEVkaXRvciBTY2VuZSBCYWNrZ3JvdW5kLyR7TkFNRX0tQ2FudmFzYCk7XG4gICAgICAgIGlmICghY2FudmFzKSB7XG4gICAgICAgICAgICBjYW52YXMgPSBuZXcgTm9kZShgJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgICAgIGNhbnZhcy5hZGRDb21wb25lbnQoQ2FudmFzKTtcbiAgICAgICAgICAgIGNhbnZhcy5wYXJlbnQgPSBmaW5kKCdFZGl0b3IgU2NlbmUgQmFja2dyb3VuZCcpO1xuICAgICAgICAgICAgY2FudmFzLmhpZGVGbGFncyB8PSBEb250U2F2ZSB8IEhpZGVJbkhpZXJhcmNoeTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbm9kZSA9IGNhbnZhcy5nZXRDaGlsZEJ5TmFtZShOQU1FKTtcbiAgICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgICAgICBub2RlID0gbmV3IE5vZGUoTkFNRSk7XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IGNhbnZhcztcbiAgICAgICAgICAgIG5vZGUuaGlkZUZsYWdzIHw9IERvbnRTYXZlIHwgSGlkZUluSGllcmFyY2h5O1xuICAgICAgICB9XG4gICAgICAgIG5vZGUuYWN0aXZlID0gYXdhaXQgRWRpdG9yLlByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnc2hvdycpO1xuXG4gICAgICAgIGxldCBzcHJpdGUgPSBub2RlLmdldENvbXBvbmVudChTcHJpdGUpO1xuICAgICAgICBpZiAoIXNwcml0ZSkge1xuICAgICAgICAgICAgc3ByaXRlID0gbm9kZS5hZGRDb21wb25lbnQoU3ByaXRlKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3ByaXRlLmNvbG9yLmNsb25lKCk7XG4gICAgICAgICAgICBjb2xvci5hID0gYXdhaXQgRWRpdG9yLlByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnb3BhY2l0eScpID8/IDUwO1xuICAgICAgICAgICAgc3ByaXRlLmNvbG9yID0gY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIHNwcml0ZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5ZCM5q2l5pWw5o2uXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKi9cbiAgICBhc3luYyBzeW5jRGF0YShkYXRhOiBJSW1hZ2VEYXRhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IG5vZGUsIHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5vZGUucG9zaXRpb247XG4gICAgICAgICAgICBkYXRhLnN4O1xuICAgICAgICAgICAgcG9zaXRpb24ueCA9IGRhdGEueDtcbiAgICAgICAgICAgIHBvc2l0aW9uLnkgPSBkYXRhLnk7XG4gICAgICAgICAgICBwb3NpdGlvbi56ID0gMDtcbiAgICAgICAgICAgIG5vZGUucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gbm9kZS5zY2FsZTtcbiAgICAgICAgICAgIHNjYWxlLnggPSBkYXRhLnN4O1xuICAgICAgICAgICAgc2NhbGUueSA9IGRhdGEuc3k7XG4gICAgICAgICAgICBzY2FsZS56ID0gMTtcbiAgICAgICAgICAgIG5vZGUuc2NhbGUgPSBzY2FsZTtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3ByaXRlLmNvbG9yLmNsb25lKCk7XG4gICAgICAgICAgICBjb2xvci5hID0gZGF0YS5vcGFjaXR5O1xuICAgICAgICAgICAgc3ByaXRlLmNvbG9yID0gY29sb3I7XG4gICAgICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzeW5jIGRhdGEgaW52YWxpZC4gJywgZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8g5YiH5o2i5Y+C6ICD5Zu+XG4gICAgYXN5bmMgc3dpdGNoSW1hZ2VzKHBhdGg6IHN0cmluZykge1xuICAgICAgICBjb25zdCB7IHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIGxldCBkYXRhOiBzdHJpbmcgfCBCdWZmZXIgPSByZWFkRmlsZVN5bmMocGF0aCk7XG4gICAgICAgIGRhdGEgPSBuZXcgQnVmZmVyKGRhdGEpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBjY3dpbmRvdy5JbWFnZSgpO1xuICAgICAgICBpbWFnZS5zcmMgPSAnZGF0YTpwbmc7YmFzZTY0LCcgKyBkYXRhO1xuICAgICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzcHJpdGUuc3ByaXRlRnJhbWUgPSBTcHJpdGVGcmFtZS5jcmVhdGVXaXRoSW1hZ2UoaW1hZ2UpO1xuICAgICAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICAvLyDmuIXnqbpcbiAgICBhc3luYyByZXNldEltYWdlKCkge1xuICAgICAgICBjb25zdCB7IHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIHNwcml0ZS5zcHJpdGVGcmFtZSA9IG51bGw7XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9LFxuXG4gICAgLy8g6K6+572u5Y+C6ICD5Zu+5piv5ZCm5pi+56S6XG4gICAgYXN5bmMgc2V0SW1hZ2VWaXNpYmxlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IHsgbm9kZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIG5vZGUuYWN0aXZlID0gdmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgRWRpdG9yLlBhbmVsLm9wZW4oJ3JlZmVyZW5jZS1pbWFnZScpO1xuICAgICAgICB9XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9LFxufTtcbiJdfQ==