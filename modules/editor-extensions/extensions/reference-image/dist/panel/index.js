/* eslint-disable camelcase */
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.close = exports.ready = exports.methods = exports.$ = exports.template = exports.style = void 0;
const remote = require('@electron/remote');
const path_1 = require("path");
const fs_1 = require("fs");
const { I18n, Message, Dialog, Profile } = Editor;
exports.style = fs_1.readFileSync(path_1.join(__dirname, '../../dist/index.css'), 'utf8');
exports.template = fs_1.readFileSync(path_1.join(__dirname, '../../statics/index.html'), 'utf8');
let ui_editor;
let ui_images;
let ui_x;
let ui_y;
let ui_opacity;
let btn_add;
let btn_del;
exports.$ = {
    ui_editor: '.config',
    ui_images: '.images',
    btnAdd: '.add-image',
    btnDel: '.del-image',
    x: '.x',
    y: '.y',
    opacity: '.opacity',
};
let show = true;
const defaultConfig = {
    images: [],
    sceneUUID: {},
    scene: '',
};
let referenceImageConfig = defaultConfig;
const shortcutsMoveDistance = 2; // 快捷键移动距离
let onMoveXFunc;
let onMoveYFunc;
let onAddImageFunc;
let onDelImageFunc;
let onSetOpacityFunc;
let onSwitchImagesFunc;
exports.methods = {
    async 'scene:ready'(id) {
        referenceImageConfig.scene = id; // 设置场景id
        await this.updateImages();
        Message.broadcast('reference-image:show', show);
    },
    getCurrent() {
        const { scene, sceneUUID, images } = referenceImageConfig;
        let result;
        if (scene && sceneUUID[scene]) {
            result = images.find(v => v.path === sceneUUID[scene].path);
        }
        else if (images.length) {
            result = images[0];
        }
        return result ?? { path: '', x: 0, y: 0, opacity: 50 };
    },
    renderUI() {
        const { x, y, opacity } = this.getCurrent();
        // @ts-ignore
        ui_x.value = x;
        // @ts-ignore
        ui_y.value = y;
        // @ts-ignore
        ui_opacity.value = opacity;
    },
    async updateImages() {
        // @ts-ignore
        const panel = this;
        // clear
        while (ui_images.firstChild) {
            ui_images.removeChild(ui_images.firstChild);
        }
        for (let i = 0; i < referenceImageConfig.images.length; ++i) {
            if (i === 0) {
                const empty = document.createElement('option');
                empty.setAttribute('value', '');
                empty.text = '[空]';
                ui_images.appendChild(empty);
            }
            const option = document.createElement('option');
            option.setAttribute('value', referenceImageConfig.images[i].path);
            ui_images.appendChild(option);
            const path = referenceImageConfig.images[i].path;
            option.text = path_1.basename(path, path_1.extname(path));
        }
        btn_del.removeAttribute('disabled');
        ui_editor.removeAttribute('disabled');
        ui_images.removeAttribute('placeholder');
        ui_images.setAttribute('value', '');
        if (referenceImageConfig.images.length === 0) {
            ui_images.setAttribute('placeholder', I18n.t('reference-image.none'));
            btn_del.setAttribute('disabled', '');
            ui_editor.setAttribute('disabled', '');
            await this.resetImage();
        }
        else {
            const { path } = panel.getCurrent();
            ui_images.setAttribute('value', path);
            await this.sendSwitchImages();
        }
    },
    async onAddImage() {
        const result = await Dialog.select({
            title: I18n.t('reference-image.dialog.add-image-title'),
            path: await Profile.getConfig('reference-image', 'root-path') || '',
            filters: [{ name: 'image', extensions: ['png', 'jpg'] }],
        });
        if (!result || !result.filePaths[0]) {
            return;
        }
        // 该顺序不可改动，用于处理使用最新的一张图
        const nextIndex = referenceImageConfig.images.length;
        for (const path of result.filePaths) {
            if (referenceImageConfig.images.every(v => v.path !== path)) {
                referenceImageConfig.images.push({ path, x: 0, y: 0, opacity: 50 });
            }
        }
        let imagePath = '';
        const { scene, sceneUUID } = referenceImageConfig;
        if (referenceImageConfig.images.length === 1) {
            // 只有一张图片的时候，默认赋值
            imagePath = referenceImageConfig.images[0].path;
        }
        else if (nextIndex < referenceImageConfig.images.length) {
            // 表现用最新的一张图的下标
            imagePath = referenceImageConfig.images[nextIndex].path;
        }
        sceneUUID[scene] = {
            path: imagePath || '',
        };
        await this.updateImages();
        // 设置弹窗打开的目录位置
        const path = path_1.dirname(result.filePaths[0]);
        await Profile.setConfig('reference-image', 'root-path', path);
    },
    // 删除一张图片
    async onDelImage() {
        const { path } = this.getCurrent();
        const result = await Dialog.info(I18n.t('reference-image.dialog.del_image_message', {
            path: path,
        }), {
            buttons: [
                I18n.t('reference-image.dialog.yes'),
                I18n.t('reference-image.dialog.cancel'),
            ],
            default: 0,
            cancel: 1,
        });
        if (result.response === 0) {
            const i = referenceImageConfig.images.findIndex(v => v.path === path);
            if (i > -1) {
                referenceImageConfig.images.splice(i, 1);
                // 删除图片的时候，把应用到该图片的场景清空一下
                Object.entries(referenceImageConfig.sceneUUID).forEach(([key, val]) => {
                    if (val.path === path) {
                        referenceImageConfig.sceneUUID[key].path = '';
                    }
                });
                // 使用上一张图片
                let nextIndex = i + 1;
                const total = referenceImageConfig.images.length;
                nextIndex = nextIndex > total ? total - 1 : nextIndex;
                const { scene, sceneUUID } = referenceImageConfig;
                sceneUUID[scene] = {
                    path: referenceImageConfig.images[nextIndex]?.path || '',
                };
                await this.updateImages();
            }
        }
    },
    async resetImage() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'resetImage',
        });
    },
    async sendSwitchImages() {
        const { path, x, y, opacity } = this.getCurrent();
        if (path) {
            await Message.request('scene', 'execute-scene-script', {
                name: 'reference-image',
                method: 'switchImages',
                args: [path],
            });
            await this.sendMoveX(x);
            await this.sendMoveY(y);
            await this.sendOpacity(opacity);
        }
        else {
            this.resetImage();
        }
        this.renderUI();
    },
    // 切换图片
    async onSwitchImages(event) {
        const { sceneUUID, scene } = referenceImageConfig;
        if (sceneUUID[scene]) {
            // @ts-ignore
            sceneUUID[scene].path = event.target.value;
        }
        else {
            // @ts-ignore
            sceneUUID[scene] = { path: event.target.value };
        }
        await this.sendSwitchImages();
    },
    // 通知修改 opacity
    async sendOpacity(opacity) {
        // scene-walker.ts 需要用到此配置
        await Editor.Profile.setConfig('reference-image', 'opacity', opacity);
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'setOpacity',
            args: [opacity],
        });
    },
    // 通知修改 x
    async sendMoveX(x) {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveX',
            args: [x],
        });
    },
    // 通知修改 y
    async sendMoveY(y) {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveY',
            args: [y],
        });
    },
    async onSetOpacity(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.opacity = event.target.value;
        await this.sendOpacity(current.opacity);
    },
    async onMoveX(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.x = event.target.value;
        await this.sendMoveX(current.x);
    },
    async onMoveY(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.y = event.target.value;
        await this.sendMoveY(current.y);
    },
    async shortcutsMoveRight() {
        const current = this.getCurrent();
        current.x += shortcutsMoveDistance;
        this.sendMoveX(current.x);
        this.renderUI();
    },
    async shortcutsMoveLeft() {
        const current = this.getCurrent();
        current.x -= shortcutsMoveDistance;
        this.sendMoveX(current.x);
        this.renderUI();
    },
    async shortcutsMoveUp() {
        const current = this.getCurrent();
        current.y += shortcutsMoveDistance;
        this.sendMoveY(current.y);
        this.renderUI();
    },
    async shortcutsMoveDown() {
        const current = this.getCurrent();
        current.y -= shortcutsMoveDistance;
        this.sendMoveY(current.y);
        this.renderUI();
    },
    registerEventListeners() {
        onMoveXFunc = this.onMoveX.bind(this);
        onMoveYFunc = this.onMoveY.bind(this);
        onSetOpacityFunc = this.onSetOpacity.bind(this);
        onSwitchImagesFunc = this.onSwitchImages.bind(this);
        onAddImageFunc = this.onAddImage.bind(this);
        onDelImageFunc = this.onDelImage.bind(this);
        ui_x.addEventListener('confirm', onMoveXFunc);
        ui_y.addEventListener('confirm', onMoveYFunc);
        ui_opacity.addEventListener('confirm', onSetOpacityFunc);
        ui_images.addEventListener('confirm', onSwitchImagesFunc);
        btn_add.addEventListener('click', onAddImageFunc);
        btn_del.addEventListener('click', onDelImageFunc);
    },
    unregisterEventListeners() {
        ui_x.removeEventListener('confirm', onMoveXFunc);
        ui_y.removeEventListener('confirm', onMoveYFunc);
        ui_opacity.removeEventListener('confirm', onSetOpacityFunc);
        ui_images.removeEventListener('confirm', onSwitchImagesFunc);
        btn_add.removeEventListener('click', onAddImageFunc);
        btn_del.removeEventListener('click', onDelImageFunc);
    },
};
const ready = async function () {
    // 设置 Title
    const win = remote.getCurrentWindow();
    win.setTitle(I18n.t('reference-image.name'));
    // @ts-ignore
    const panel = this;
    ui_x = panel.$.x;
    ui_y = panel.$.y;
    ui_editor = panel.$.ui_editor;
    ui_images = panel.$.ui_images;
    ui_opacity = panel.$.opacity;
    btn_add = panel.$.btnAdd;
    btn_del = panel.$.btnDel;
    panel.registerEventListeners();
    referenceImageConfig = await Profile.getConfig('reference-image', 'config') || defaultConfig;
    const scene = await Message.request('scene', 'query-current-scene');
    referenceImageConfig.scene = scene;
    panel.renderUI();
    await panel.updateImages();
    show = await Profile.getConfig('reference-image', 'show');
    Message.broadcast('reference-image:show', show);
};
exports.ready = ready;
const close = async function () {
    // @ts-ignore
    this.unregisterEventListeners();
    await Profile.setConfig('reference-image', 'config', referenceImageConfig);
};
exports.close = close;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvcGFuZWwvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOEJBQThCO0FBQzlCLFlBQVksQ0FBQzs7O0FBSWIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFFM0MsK0JBQXdEO0FBQ3hELDJCQUFrQztBQUVsQyxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsTUFBTSxDQUFDO0FBRXJDLFFBQUEsS0FBSyxHQUFHLGlCQUFZLENBQUMsV0FBSSxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3RFLFFBQUEsUUFBUSxHQUFHLGlCQUFZLENBQUMsV0FBSSxDQUFDLFNBQVMsRUFBRSwwQkFBMEIsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBRTFGLElBQUksU0FBc0IsQ0FBQztBQUMzQixJQUFJLFNBQXNCLENBQUM7QUFDM0IsSUFBSSxJQUFpQixDQUFDO0FBQ3RCLElBQUksSUFBaUIsQ0FBQztBQUN0QixJQUFJLFVBQXVCLENBQUM7QUFDNUIsSUFBSSxPQUFvQixDQUFDO0FBQ3pCLElBQUksT0FBb0IsQ0FBQztBQUNaLFFBQUEsQ0FBQyxHQUFHO0lBQ2IsU0FBUyxFQUFFLFNBQVM7SUFDcEIsU0FBUyxFQUFFLFNBQVM7SUFDcEIsTUFBTSxFQUFFLFlBQVk7SUFDcEIsTUFBTSxFQUFFLFlBQVk7SUFFcEIsQ0FBQyxFQUFFLElBQUk7SUFDUCxDQUFDLEVBQUUsSUFBSTtJQUNQLE9BQU8sRUFBRSxVQUFVO0NBQ3RCLENBQUM7QUFFRixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7QUFtQmhCLE1BQU0sYUFBYSxHQUFHO0lBQ2xCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsU0FBUyxFQUFFLEVBQUU7SUFDYixLQUFLLEVBQUUsRUFBRTtDQUNa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QUMsSUFBSSxhQUFhLENBQUM7SUFDN0YsTUFBTSxLQUFLLEdBQVcsTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO0lBQzVFLG9CQUFvQixDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFFbkMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBRWpCLE1BQU0sS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBRTNCLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUQsT0FBTyxDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUM7QUE1QlcsUUFBQSxLQUFLLFNBNEJoQjtBQUVLLE1BQU0sS0FBSyxHQUFHLEtBQUs7SUFDdEIsYUFBYTtJQUNiLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sT0FBTyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQUMvRSxDQUFDLENBQUM7QUFKVyxRQUFBLEtBQUssU0FJaEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UgKi9cbid1c2Ugc3RyaWN0JztcblxuZGVjbGFyZSBjb25zdCBFZGl0b3I6IGFueTtcblxuY29uc3QgcmVtb3RlID0gcmVxdWlyZSgnQGVsZWN0cm9uL3JlbW90ZScpO1xuXG5pbXBvcnQgeyBkaXJuYW1lLCBiYXNlbmFtZSwgZXh0bmFtZSwgam9pbiB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuXG5jb25zdCB7IEkxOG4sIE1lc3NhZ2UsIERpYWxvZywgUHJvZmlsZSB9ID0gRWRpdG9yO1xuXG5leHBvcnQgY29uc3Qgc3R5bGUgPSByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICcuLi8uLi9kaXN0L2luZGV4LmNzcycpLCAndXRmOCcpO1xuZXhwb3J0IGNvbnN0IHRlbXBsYXRlID0gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc3RhdGljcy9pbmRleC5odG1sJyksICd1dGY4Jyk7XG5cbmxldCB1aV9lZGl0b3I6IEhUTUxFbGVtZW50O1xubGV0IHVpX2ltYWdlczogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeDogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeTogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfb3BhY2l0eTogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2FkZDogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2RlbDogSFRNTEVsZW1lbnQ7XG5leHBvcnQgY29uc3QgJCA9IHtcbiAgICB1aV9lZGl0b3I6ICcuY29uZmlnJyxcbiAgICB1aV9pbWFnZXM6ICcuaW1hZ2VzJyxcbiAgICBidG5BZGQ6ICcuYWRkLWltYWdlJyxcbiAgICBidG5EZWw6ICcuZGVsLWltYWdlJyxcblxuICAgIHg6ICcueCcsXG4gICAgeTogJy55JyxcbiAgICBvcGFjaXR5OiAnLm9wYWNpdHknLFxufTtcblxubGV0IHNob3cgPSB0cnVlO1xuXG5pbnRlcmZhY2UgSUltYWdlRGF0YSB7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgb3BhY2l0eTogbnVtYmVyXG59XG5pbnRlcmZhY2UgSVNjZW5lRGF0YSB7XG4gICAgW3Byb3A6IHN0cmluZ106IHtcbiAgICAgICAgcGF0aDogc3RyaW5nXG4gICAgfVxufVxuaW50ZXJmYWNlIElSZWZlcmVuY2Uge1xuICAgIGltYWdlczogSUltYWdlRGF0YVtdO1xuICAgIHNjZW5lVVVJRDogSVNjZW5lRGF0YTtcbiAgICBzY2VuZTogc3RyaW5nO1xufVxuXG5jb25zdCBkZWZhdWx0Q29uZmlnID0ge1xuICAgIGltYWdlczogW10sXG4gICAgc2NlbmVVVUlEOiB7fSxcbiAgICBzY2VuZTogJycsXG59O1xubGV0IHJlZmVyZW5jZUltYWdlQ29uZmlnOiBJUmVmZXJlbmNlID0gZGVmYXVsdENvbmZpZztcblxuY29uc3Qgc2hvcnRjdXRzTW92ZURpc3RhbmNlID0gMjsgLy8g5b+r5o236ZSu56e75Yqo6Led56a7XG5cbmxldCBvbk1vdmVYRnVuYzogYW55O1xubGV0IG9uTW92ZVlGdW5jOiBhbnk7XG5sZXQgb25BZGRJbWFnZUZ1bmM6IGFueTtcbmxldCBvbkRlbEltYWdlRnVuYzogYW55O1xubGV0IG9uU2V0T3BhY2l0eUZ1bmM6IGFueTtcbmxldCBvblN3aXRjaEltYWdlc0Z1bmM6IGFueTtcblxuZXhwb3J0IGNvbnN0IG1ldGhvZHMgPSB7XG5cbiAgICBhc3luYyAnc2NlbmU6cmVhZHknKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmVmZXJlbmNlSW1hZ2VDb25maWcuc2NlbmUgPSBpZDsgLy8g6K6+572u5Zy65pmvaWRcblxuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltYWdlcygpO1xuICAgICAgICBNZXNzYWdlLmJyb2FkY2FzdCgncmVmZXJlbmNlLWltYWdlOnNob3cnLCBzaG93KTtcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudCgpIHtcbiAgICAgICAgY29uc3QgeyBzY2VuZSwgc2NlbmVVVUlELCBpbWFnZXMgfSA9IHJlZmVyZW5jZUltYWdlQ29uZmlnO1xuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICBpZiAoc2NlbmUgJiYgc2NlbmVVVUlEW3NjZW5lXSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaW1hZ2VzLmZpbmQodiA9PiB2LnBhdGggPT09IHNjZW5lVVVJRFtzY2VuZV0ucGF0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaW1hZ2VzWzBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQgPz8geyBwYXRoOiAnJywgeDogMCwgeTogMCwgb3BhY2l0eTogNTAgfTtcbiAgICB9LFxuXG4gICAgcmVuZGVyVUkoKSB7XG4gICAgICAgIGNvbnN0IHsgeCwgeSwgb3BhY2l0eSB9ID0gdGhpcy5nZXRDdXJyZW50KCk7XG5cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV94LnZhbHVlID0geDtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV95LnZhbHVlID0geTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV9vcGFjaXR5LnZhbHVlID0gb3BhY2l0eTtcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlSW1hZ2VzKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcztcbiAgICAgICAgLy8gY2xlYXJcbiAgICAgICAgd2hpbGUgKHVpX2ltYWdlcy5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICB1aV9pbWFnZXMucmVtb3ZlQ2hpbGQodWlfaW1hZ2VzLmZpcnN0Q2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVtcHR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICAgICAgZW1wdHkuc2V0QXR0cmlidXRlKCd2YWx1ZScsICcnKTtcbiAgICAgICAgICAgICAgICBlbXB0eS50ZXh0ID0gJ1vnqbpdJztcbiAgICAgICAgICAgICAgICB1aV9pbWFnZXMuYXBwZW5kQ2hpbGQoZW1wdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCd2YWx1ZScsIHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlc1tpXS5wYXRoKTtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5hcHBlbmRDaGlsZChvcHRpb24pO1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlc1tpXS5wYXRoO1xuICAgICAgICAgICAgb3B0aW9uLnRleHQgPSBiYXNlbmFtZShwYXRoLCBleHRuYW1lKHBhdGgpKTtcbiAgICAgICAgfVxuICAgICAgICBidG5fZGVsLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfZWRpdG9yLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfaW1hZ2VzLnJlbW92ZUF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKTtcbiAgICAgICAgdWlfaW1hZ2VzLnNldEF0dHJpYnV0ZSgndmFsdWUnLCAnJyk7XG5cbiAgICAgICAgaWYgKHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgSTE4bi50KCdyZWZlcmVuY2UtaW1hZ2Uubm9uZScpKTtcbiAgICAgICAgICAgIGJ0bl9kZWwuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgICAgICAgIHVpX2VkaXRvci5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZXNldEltYWdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB7IHBhdGggfSA9IHBhbmVsLmdldEN1cnJlbnQoKTtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgcGF0aCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRTd2l0Y2hJbWFnZXMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyBvbkFkZEltYWdlKCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBEaWFsb2cuc2VsZWN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cuYWRkLWltYWdlLXRpdGxlJyksXG4gICAgICAgICAgICBwYXRoOiBhd2FpdCBQcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Jvb3QtcGF0aCcpIHx8ICcnLFxuICAgICAgICAgICAgZmlsdGVyczogW3sgbmFtZTogJ2ltYWdlJywgZXh0ZW5zaW9uczogWydwbmcnLCAnanBnJ10gfV0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LmZpbGVQYXRoc1swXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIOivpemhuuW6j+S4jeWPr+aUueWKqO+8jOeUqOS6juWkhOeQhuS9v+eUqOacgOaWsOeahOS4gOW8oOWbvlxuICAgICAgICBjb25zdCBuZXh0SW5kZXggPSByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGNvbnN0IHBhdGggb2YgcmVzdWx0LmZpbGVQYXRocykge1xuICAgICAgICAgICAgaWYgKHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5ldmVyeSh2ID0+IHYucGF0aCAhPT0gcGF0aCkpIHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXMucHVzaCh7IHBhdGgsIHg6IDAsIHk6IDAsIG9wYWNpdHk6IDUwIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGltYWdlUGF0aCA9ICcnO1xuICAgICAgICBjb25zdCB7IHNjZW5lLCBzY2VuZVVVSUQgfSA9IHJlZmVyZW5jZUltYWdlQ29uZmlnO1xuICAgICAgICBpZiAocmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgLy8g5Y+q5pyJ5LiA5byg5Zu+54mH55qE5pe25YCZ77yM6buY6K6k6LWL5YC8XG4gICAgICAgICAgICBpbWFnZVBhdGggPSByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXNbMF0hLnBhdGg7XG4gICAgICAgIH0gZWxzZSBpZiAobmV4dEluZGV4IDwgcmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8g6KGo546w55So5pyA5paw55qE5LiA5byg5Zu+55qE5LiL5qCHXG4gICAgICAgICAgICBpbWFnZVBhdGggPSByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXNbbmV4dEluZGV4XSEucGF0aDtcbiAgICAgICAgfVxuICAgICAgICBzY2VuZVVVSURbc2NlbmVdID0ge1xuICAgICAgICAgICAgcGF0aDogaW1hZ2VQYXRoIHx8ICcnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1hZ2VzKCk7XG5cbiAgICAgICAgLy8g6K6+572u5by556qX5omT5byA55qE55uu5b2V5L2N572uXG4gICAgICAgIGNvbnN0IHBhdGggPSBkaXJuYW1lKHJlc3VsdC5maWxlUGF0aHNbMF0pO1xuICAgICAgICBhd2FpdCBQcm9maWxlLnNldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Jvb3QtcGF0aCcsIHBhdGgpO1xuICAgIH0sXG5cbiAgICAvLyDliKDpmaTkuIDlvKDlm77niYdcbiAgICBhc3luYyBvbkRlbEltYWdlKCkge1xuICAgICAgICBjb25zdCB7IHBhdGggfSA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBEaWFsb2cuaW5mbyhJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cuZGVsX2ltYWdlX21lc3NhZ2UnLCB7XG4gICAgICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICB9KSwge1xuICAgICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAgICAgIEkxOG4udCgncmVmZXJlbmNlLWltYWdlLmRpYWxvZy55ZXMnKSxcbiAgICAgICAgICAgICAgICBJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cuY2FuY2VsJyksXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgICAgIGNhbmNlbDogMSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChyZXN1bHQucmVzcG9uc2UgPT09IDApIHtcblxuICAgICAgICAgICAgY29uc3QgaSA9IHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5maW5kSW5kZXgodiA9PiB2LnBhdGggPT09IHBhdGgpO1xuICAgICAgICAgICAgaWYgKGkgPiAtMSkge1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5zcGxpY2UoaSwgMSk7XG5cbiAgICAgICAgICAgICAgICAvLyDliKDpmaTlm77niYfnmoTml7blgJnvvIzmiorlupTnlKjliLDor6Xlm77niYfnmoTlnLrmma/muIXnqbrkuIDkuItcbiAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhyZWZlcmVuY2VJbWFnZUNvbmZpZy5zY2VuZVVVSUQpLmZvckVhY2goKFtrZXksIHZhbF0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbC5wYXRoID09PSBwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VJbWFnZUNvbmZpZy5zY2VuZVVVSURba2V5XS5wYXRoID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIOS9v+eUqOS4iuS4gOW8oOWbvueJh1xuICAgICAgICAgICAgICAgIGxldCBuZXh0SW5kZXggPSBpICsgMTtcbiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gbmV4dEluZGV4ID4gdG90YWwgPyB0b3RhbCAtIDEgOiBuZXh0SW5kZXg7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBzY2VuZSwgc2NlbmVVVUlEIH0gPSByZWZlcmVuY2VJbWFnZUNvbmZpZztcbiAgICAgICAgICAgICAgICBzY2VuZVVVSURbc2NlbmVdID0ge1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXNbbmV4dEluZGV4XT8ucGF0aCB8fCAnJyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1hZ2VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgcmVzZXRJbWFnZSgpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAncmVzZXRJbWFnZScsXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhc3luYyBzZW5kU3dpdGNoSW1hZ2VzKCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIHgsIHksIG9wYWNpdHkgfSA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncmVmZXJlbmNlLWltYWdlJyxcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdzd2l0Y2hJbWFnZXMnLFxuICAgICAgICAgICAgICAgIGFyZ3M6IFtwYXRoXSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kTW92ZVgoeCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWSh5KTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZE9wYWNpdHkob3BhY2l0eSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG5cbiAgICB9LFxuXG4gICAgLy8g5YiH5o2i5Zu+54mHXG4gICAgYXN5bmMgb25Td2l0Y2hJbWFnZXMoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgc2NlbmVVVUlELCBzY2VuZSB9ID0gcmVmZXJlbmNlSW1hZ2VDb25maWc7XG5cbiAgICAgICAgaWYgKHNjZW5lVVVJRFtzY2VuZV0pIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNjZW5lVVVJRFtzY2VuZV0ucGF0aCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNjZW5lVVVJRFtzY2VuZV0gPSB7IHBhdGg6IGV2ZW50LnRhcmdldC52YWx1ZSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kU3dpdGNoSW1hZ2VzKCk7XG4gICAgfSxcblxuICAgIC8vIOmAmuefpeS/ruaUuSBvcGFjaXR5XG4gICAgYXN5bmMgc2VuZE9wYWNpdHkob3BhY2l0eTogbnVtYmVyKSB7XG4gICAgICAgIC8vIHNjZW5lLXdhbGtlci50cyDpnIDopoHnlKjliLDmraTphY3nva5cbiAgICAgICAgYXdhaXQgRWRpdG9yLlByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnb3BhY2l0eScsIG9wYWNpdHkpO1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdzZXRPcGFjaXR5JyxcbiAgICAgICAgICAgIGFyZ3M6IFtvcGFjaXR5XSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIOmAmuefpeS/ruaUuSB4XG4gICAgYXN5bmMgc2VuZE1vdmVYKHg6IG51bWJlcikge1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdtb3ZlWCcsXG4gICAgICAgICAgICBhcmdzOiBbeF0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyDpgJrnn6Xkv67mlLkgeVxuICAgIGFzeW5jIHNlbmRNb3ZlWSh5OiBudW1iZXIpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAnbW92ZVknLFxuICAgICAgICAgICAgYXJnczogW3ldLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYXN5bmMgb25TZXRPcGFjaXR5KGV2ZW50OiBFdmVudCkge1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5nZXRDdXJyZW50KCk7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY3VycmVudC5vcGFjaXR5ID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRPcGFjaXR5KGN1cnJlbnQub3BhY2l0eSk7XG4gICAgfSxcblxuICAgIGFzeW5jIG9uTW92ZVgoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjdXJyZW50LnggPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE1vdmVYKGN1cnJlbnQueCk7XG4gICAgfSxcblxuICAgIGFzeW5jIG9uTW92ZVkoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjdXJyZW50LnkgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE1vdmVZKGN1cnJlbnQueSk7XG4gICAgfSxcblxuICAgIGFzeW5jIHNob3J0Y3V0c01vdmVSaWdodCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjdXJyZW50LnggKz0gc2hvcnRjdXRzTW92ZURpc3RhbmNlO1xuICAgICAgICB0aGlzLnNlbmRNb3ZlWChjdXJyZW50LngpO1xuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG4gICAgfSxcbiAgICBhc3luYyBzaG9ydGN1dHNNb3ZlTGVmdCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjdXJyZW50LnggLT0gc2hvcnRjdXRzTW92ZURpc3RhbmNlO1xuICAgICAgICB0aGlzLnNlbmRNb3ZlWChjdXJyZW50LngpO1xuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG4gICAgfSxcbiAgICBhc3luYyBzaG9ydGN1dHNNb3ZlVXAoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY3VycmVudC55ICs9IHNob3J0Y3V0c01vdmVEaXN0YW5jZTtcbiAgICAgICAgdGhpcy5zZW5kTW92ZVkoY3VycmVudC55KTtcbiAgICAgICAgdGhpcy5yZW5kZXJVSSgpO1xuICAgIH0sXG4gICAgYXN5bmMgc2hvcnRjdXRzTW92ZURvd24oKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY3VycmVudC55IC09IHNob3J0Y3V0c01vdmVEaXN0YW5jZTtcbiAgICAgICAgdGhpcy5zZW5kTW92ZVkoY3VycmVudC55KTtcbiAgICAgICAgdGhpcy5yZW5kZXJVSSgpO1xuICAgIH0sXG5cbiAgICByZWdpc3RlckV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICBvbk1vdmVYRnVuYyA9IHRoaXMub25Nb3ZlWC5iaW5kKHRoaXMpO1xuICAgICAgICBvbk1vdmVZRnVuYyA9IHRoaXMub25Nb3ZlWS5iaW5kKHRoaXMpO1xuICAgICAgICBvblNldE9wYWNpdHlGdW5jID0gdGhpcy5vblNldE9wYWNpdHkuYmluZCh0aGlzKTtcbiAgICAgICAgb25Td2l0Y2hJbWFnZXNGdW5jID0gdGhpcy5vblN3aXRjaEltYWdlcy5iaW5kKHRoaXMpO1xuICAgICAgICBvbkFkZEltYWdlRnVuYyA9IHRoaXMub25BZGRJbWFnZS5iaW5kKHRoaXMpO1xuICAgICAgICBvbkRlbEltYWdlRnVuYyA9IHRoaXMub25EZWxJbWFnZS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHVpX3guYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVhGdW5jKTtcbiAgICAgICAgdWlfeS5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Nb3ZlWUZ1bmMpO1xuICAgICAgICB1aV9vcGFjaXR5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblNldE9wYWNpdHlGdW5jKTtcbiAgICAgICAgdWlfaW1hZ2VzLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblN3aXRjaEltYWdlc0Z1bmMpO1xuICAgICAgICBidG5fYWRkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25BZGRJbWFnZUZ1bmMpO1xuICAgICAgICBidG5fZGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25EZWxJbWFnZUZ1bmMpO1xuICAgIH0sXG5cbiAgICB1bnJlZ2lzdGVyRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHVpX3gucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVhGdW5jKTtcbiAgICAgICAgdWlfeS5yZW1vdmVFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Nb3ZlWUZ1bmMpO1xuICAgICAgICB1aV9vcGFjaXR5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblNldE9wYWNpdHlGdW5jKTtcbiAgICAgICAgdWlfaW1hZ2VzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblN3aXRjaEltYWdlc0Z1bmMpO1xuICAgICAgICBidG5fYWRkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25BZGRJbWFnZUZ1bmMpO1xuICAgICAgICBidG5fZGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25EZWxJbWFnZUZ1bmMpO1xuICAgIH0sXG59O1xuXG5leHBvcnQgY29uc3QgcmVhZHkgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAvLyDorr7nva4gVGl0bGVcbiAgICBjb25zdCB3aW4gPSByZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpO1xuICAgIHdpbi5zZXRUaXRsZShJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5uYW1lJykpO1xuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IHBhbmVsID0gdGhpcztcblxuICAgIHVpX3ggPSBwYW5lbC4kLng7XG4gICAgdWlfeSA9IHBhbmVsLiQueTtcbiAgICB1aV9lZGl0b3IgPSBwYW5lbC4kLnVpX2VkaXRvcjtcbiAgICB1aV9pbWFnZXMgPSBwYW5lbC4kLnVpX2ltYWdlcztcbiAgICB1aV9vcGFjaXR5ID0gcGFuZWwuJC5vcGFjaXR5O1xuICAgIGJ0bl9hZGQgPSBwYW5lbC4kLmJ0bkFkZDtcbiAgICBidG5fZGVsID0gcGFuZWwuJC5idG5EZWw7XG5cbiAgICBwYW5lbC5yZWdpc3RlckV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICByZWZlcmVuY2VJbWFnZUNvbmZpZyA9IGF3YWl0IFByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnY29uZmlnJykgfHwgZGVmYXVsdENvbmZpZztcbiAgICBjb25zdCBzY2VuZTogc3RyaW5nID0gYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdxdWVyeS1jdXJyZW50LXNjZW5lJyk7XG4gICAgcmVmZXJlbmNlSW1hZ2VDb25maWcuc2NlbmUgPSBzY2VuZTtcblxuICAgIHBhbmVsLnJlbmRlclVJKCk7XG5cbiAgICBhd2FpdCBwYW5lbC51cGRhdGVJbWFnZXMoKTtcblxuICAgIHNob3cgPSBhd2FpdCBQcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Nob3cnKTtcbiAgICBNZXNzYWdlLmJyb2FkY2FzdCgncmVmZXJlbmNlLWltYWdlOnNob3cnLCBzaG93KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbG9zZSA9IGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB0aGlzLnVucmVnaXN0ZXJFdmVudExpc3RlbmVycygpO1xuICAgIGF3YWl0IFByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnY29uZmlnJywgcmVmZXJlbmNlSW1hZ2VDb25maWcpO1xufTtcbiJdfQ==