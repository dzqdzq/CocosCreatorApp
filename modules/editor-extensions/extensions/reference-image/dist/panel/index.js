/* eslint-disable camelcase */
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.close = exports.ready = exports.methods = exports.$ = exports.template = exports.style = void 0;
const remote = require('@electron/remote');
const path_1 = require("path");
const fs_1 = require("fs");
const { I18n, Message, Dialog, Profile } = Editor;
exports.style = fs_1.readFileSync(path_1.join(__dirname, '../../dist/index.css'), 'utf8');
exports.template = fs_1.readFileSync(path_1.join(__dirname, '../../statics/index.html'), 'utf8');
let ui_editor;
let ui_images;
let ui_x;
let ui_y;
let ui_opacity;
let btn_add;
let btn_del;
exports.$ = {
    ui_editor: '.config',
    ui_images: '.images',
    btnAdd: '.add-image',
    btnDel: '.del-image',
    x: '.x',
    y: '.y',
    opacity: '.opacity',
};
let show = true;
const defaultConfig = {
    images: [],
    sceneUUID: {},
    scene: '',
};
let referenceImageConfig = defaultConfig;
const shortcutsMoveDistance = 2; // 快捷键移动距离
let onMoveXFunc;
let onMoveYFunc;
let onAddImageFunc;
let onDelImageFunc;
let onSetOpacityFunc;
let onSwitchImagesFunc;
exports.methods = {
    async 'scene:ready'(id) {
        referenceImageConfig.scene = id; // 设置场景id
        await this.updateImages();
        Message.broadcast('reference-image:show', show);
    },
    getCurrent() {
        const { scene, sceneUUID, images } = referenceImageConfig;
        let result;
        if (scene && sceneUUID[scene]) {
            result = images.find(v => v.path === sceneUUID[scene].path);
        }
        else if (images.length) {
            result = images[0];
        }
        return result ?? { path: '', x: 0, y: 0, opacity: 50 };
    },
    renderUI() {
        const { x, y, opacity } = this.getCurrent();
        // @ts-ignore
        ui_x.value = x;
        // @ts-ignore
        ui_y.value = y;
        // @ts-ignore
        ui_opacity.value = opacity;
    },
    async updateImages() {
        // @ts-ignore
        const panel = this;
        // clear
        while (ui_images.firstChild) {
            ui_images.removeChild(ui_images.firstChild);
        }
        for (let i = 0; i < referenceImageConfig.images.length; ++i) {
            if (i === 0) {
                const empty = document.createElement('option');
                empty.setAttribute('value', '');
                empty.text = '[空]';
                ui_images.appendChild(empty);
            }
            const option = document.createElement('option');
            option.setAttribute('value', referenceImageConfig.images[i].path);
            ui_images.appendChild(option);
            const path = referenceImageConfig.images[i].path;
            option.text = path_1.basename(path, path_1.extname(path));
        }
        btn_del.removeAttribute('disabled');
        ui_editor.removeAttribute('disabled');
        ui_images.removeAttribute('placeholder');
        ui_images.setAttribute('value', '');
        if (referenceImageConfig.images.length === 0) {
            ui_images.setAttribute('placeholder', I18n.t('reference-image.none'));
            btn_del.setAttribute('disabled', '');
            ui_editor.setAttribute('disabled', '');
            await this.resetImage();
        }
        else {
            const { path } = panel.getCurrent();
            ui_images.setAttribute('value', path);
            await this.sendSwitchImages();
        }
    },
    async onAddImage() {
        const result = await Dialog.select({
            title: I18n.t('reference-image.dialog.add-image-title'),
            path: await Profile.getConfig('reference-image', 'root-path') || '',
            filters: [{ name: 'image', extensions: ['png', 'jpg'] }],
        });
        if (!result || !result.filePaths[0]) {
            return;
        }
        for (const path of result.filePaths) {
            if (referenceImageConfig.images.every(v => v.path !== path)) {
                referenceImageConfig.images.push({ path, x: 0, y: 0, opacity: 50 });
            }
        }
        // 只有一张图片的时候，默认赋值
        if (referenceImageConfig.images.length === 1) {
            const { scene, sceneUUID } = referenceImageConfig;
            sceneUUID[scene] = { path: referenceImageConfig.images[0].path };
        }
        await this.updateImages();
        // 设置弹窗打开的目录位置
        const path = path_1.dirname(result.filePaths[0]);
        await Profile.setConfig('reference-image', 'root-path', path);
    },
    // 删除一张图片
    async onDelImage() {
        const { path } = this.getCurrent();
        const result = await Dialog.info(I18n.t('reference-image.dialog.del_image_message', {
            path: path,
        }), {
            buttons: [
                I18n.t('reference-image.dialog.yes'),
                I18n.t('reference-image.dialog.cancel'),
            ],
            default: 0,
            cancel: 1,
        });
        if (result.response === 0) {
            const i = referenceImageConfig.images.findIndex(v => v.path = path);
            if (i > -1) {
                referenceImageConfig.images.splice(i, 1);
                // 删除图片的时候，把应用到该图片的场景清空一下
                Object.entries(referenceImageConfig.sceneUUID).forEach(([key, val]) => {
                    if (val.path === path) {
                        referenceImageConfig.sceneUUID[key].path = '';
                    }
                });
                await this.updateImages();
            }
        }
    },
    async resetImage() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'resetImage',
        });
    },
    async sendSwitchImages() {
        const { path, x, y, opacity } = this.getCurrent();
        if (path) {
            await Message.request('scene', 'execute-scene-script', {
                name: 'reference-image',
                method: 'switchImages',
                args: [path],
            });
            await this.sendMoveX(x);
            await this.sendMoveY(y);
            await this.sendOpacity(opacity);
        }
        else {
            this.resetImage();
        }
        this.renderUI();
    },
    // 切换图片
    async onSwitchImages(event) {
        const { sceneUUID, scene } = referenceImageConfig;
        if (sceneUUID[scene]) {
            // @ts-ignore
            sceneUUID[scene].path = event.target.value;
        }
        else {
            // @ts-ignore
            sceneUUID[scene] = { path: event.target.value };
        }
        await this.sendSwitchImages();
    },
    // 通知修改 opacity
    async sendOpacity(opacity) {
        // scene-walker.ts 需要用到此配置
        await Editor.Profile.setConfig('reference-image', 'opacity', opacity);
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'setOpacity',
            args: [opacity],
        });
    },
    // 通知修改 x
    async sendMoveX(x) {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveX',
            args: [x],
        });
    },
    // 通知修改 y
    async sendMoveY(y) {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveY',
            args: [y],
        });
    },
    async onSetOpacity(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.opacity = event.target.value;
        await this.sendOpacity(current.opacity);
    },
    async onMoveX(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.x = event.target.value;
        await this.sendMoveX(current.x);
    },
    async onMoveY(event) {
        const current = this.getCurrent();
        // @ts-ignore
        current.y = event.target.value;
        await this.sendMoveY(current.y);
    },
    async shortcutsMoveRight() {
        const current = this.getCurrent();
        current.x += shortcutsMoveDistance;
        this.sendMoveX(current.x);
        this.renderUI();
    },
    async shortcutsMoveLeft() {
        const current = this.getCurrent();
        current.x -= shortcutsMoveDistance;
        this.sendMoveX(current.x);
        this.renderUI();
    },
    async shortcutsMoveUp() {
        const current = this.getCurrent();
        current.y += shortcutsMoveDistance;
        this.sendMoveY(current.y);
        this.renderUI();
    },
    async shortcutsMoveDown() {
        const current = this.getCurrent();
        current.y -= shortcutsMoveDistance;
        this.sendMoveY(current.y);
        this.renderUI();
    },
    registerEventListeners() {
        onMoveXFunc = this.onMoveX.bind(this);
        onMoveYFunc = this.onMoveY.bind(this);
        onSetOpacityFunc = this.onSetOpacity.bind(this);
        onSwitchImagesFunc = this.onSwitchImages.bind(this);
        onAddImageFunc = this.onAddImage.bind(this);
        onDelImageFunc = this.onDelImage.bind(this);
        ui_x.addEventListener('confirm', onMoveXFunc);
        ui_y.addEventListener('confirm', onMoveYFunc);
        ui_opacity.addEventListener('confirm', onSetOpacityFunc);
        ui_images.addEventListener('confirm', onSwitchImagesFunc);
        btn_add.addEventListener('click', onAddImageFunc);
        btn_del.addEventListener('click', onDelImageFunc);
    },
    unregisterEventListeners() {
        ui_x.removeEventListener('confirm', onMoveXFunc);
        ui_y.removeEventListener('confirm', onMoveYFunc);
        ui_opacity.removeEventListener('confirm', onSetOpacityFunc);
        ui_images.removeEventListener('confirm', onSwitchImagesFunc);
        btn_add.removeEventListener('click', onAddImageFunc);
        btn_del.removeEventListener('click', onDelImageFunc);
    },
};
const ready = async function () {
    // 设置 Title
    const win = remote.getCurrentWindow();
    win.setTitle(I18n.t('reference-image.name'));
    // @ts-ignore
    const panel = this;
    ui_x = panel.$.x;
    ui_y = panel.$.y;
    ui_editor = panel.$.ui_editor;
    ui_images = panel.$.ui_images;
    ui_opacity = panel.$.opacity;
    btn_add = panel.$.btnAdd;
    btn_del = panel.$.btnDel;
    panel.registerEventListeners();
    referenceImageConfig = await Profile.getConfig('reference-image', 'config') || defaultConfig;
    const scene = await Message.request('scene', 'query-current-scene');
    referenceImageConfig.scene = scene;
    panel.renderUI();
    await panel.updateImages();
    show = await Profile.getConfig('reference-image', 'show');
    Message.broadcast('reference-image:show', show);
};
exports.ready = ready;
const close = async function () {
    // @ts-ignore
    this.unregisterEventListeners();
    await Profile.setConfig('reference-image', 'config', referenceImageConfig);
};
exports.close = close;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvcGFuZWwvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOEJBQThCO0FBQzlCLFlBQVksQ0FBQzs7O0FBSWIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFFM0MsK0JBQXdEO0FBQ3hELDJCQUFrQztBQUVsQyxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsTUFBTSxDQUFDO0FBRXJDLFFBQUEsS0FBSyxHQUFHLGlCQUFZLENBQUMsV0FBSSxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3RFLFFBQUEsUUFBUSxHQUFHLGlCQUFZLENBQUMsV0FBSSxDQUFDLFNBQVMsRUFBRSwwQkFBMEIsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBRTFGLElBQUksU0FBc0IsQ0FBQztBQUMzQixJQUFJLFNBQXNCLENBQUM7QUFDM0IsSUFBSSxJQUFpQixDQUFDO0FBQ3RCLElBQUksSUFBaUIsQ0FBQztBQUN0QixJQUFJLFVBQXVCLENBQUM7QUFDNUIsSUFBSSxPQUFvQixDQUFDO0FBQ3pCLElBQUksT0FBb0IsQ0FBQztBQUNaLFFBQUEsQ0FBQyxHQUFHO0lBQ2IsU0FBUyxFQUFFLFNBQVM7SUFDcEIsU0FBUyxFQUFFLFNBQVM7SUFDcEIsTUFBTSxFQUFFLFlBQVk7SUFDcEIsTUFBTSxFQUFFLFlBQVk7SUFFcEIsQ0FBQyxFQUFFLElBQUk7SUFDUCxDQUFDLEVBQUUsSUFBSTtJQUNQLE9BQU8sRUFBRSxVQUFVO0NBQ3RCLENBQUM7QUFFRixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7QUFtQmhCLE1BQU0sYUFBYSxHQUFHO0lBQ2xCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsU0FBUyxFQUFFLEVBQUU7SUFDYixLQUFLLEVBQUUsRUFBRTtDQUNaLENBQUM7QUFDRixJQUFJLG9CQUFvQixHQUFlLGFBQWEsQ0FBQztBQUVyRCxNQUFNLHFCQUFxQixHQUFHLENBQUMsQ0FBQyxDQUFDLFVBQVU7QUFFM0MsSUFBSSxXQUFnQixDQUFDO0FBQ3JCLElBQUksV0FBZ0IsQ0FBQztBQUNyQixJQUFJLGNBQW1CLENBQUM7QUFDeEIsSUFBSSxjQUFtQixDQUFDO0FBQ3hCLElBQUksZ0JBQXFCLENBQUM7QUFDMUIsSUFBSSxrQkFBdUIsQ0FBQztBQUVmLFFBQUEsT0FBTyxHQUFHO0lBRW5CLEtBQUssQ0FBQyxhQUFhLENBQUMsRUFBVTtRQUMxQixvQkFBb0IsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsU0FBUztRQUUxQyxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUMxQixPQUFPLENBQUMsU0FBUyxDQUFDLHNCQUFzQixFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxVQUFVO1FBQ04sTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEdBQUcsb0JBQW9CLENBQUM7UUFDMUQsSUFBSSxNQUFNLENBQUM7UUFDWCxJQUFJLEtBQUssSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0IsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMvRDthQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUN0QixNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RCO1FBQ0QsT0FBTyxNQUFNLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDM0QsQ0FBQztJQUVELFFBQVE7UUFDSixNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFFNUMsYUFBYTtRQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsYUFBYTtRQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsYUFBYTtRQUNiLFVBQVUsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDO0lBQy9CLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNkLGFBQWE7UUFDYixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbkIsUUFBUTtRQUNSLE9BQU8sU0FBUyxDQUFDLFVBQVUsRUFBRTtZQUN6QixTQUFTLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUMvQztRQUNELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3pELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDVCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUMvQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDaEMsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7Z0JBQ25CLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDaEM7WUFDRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsRSxTQUFTLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlCLE1BQU0sSUFBSSxHQUFHLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDakQsTUFBTSxDQUFDLElBQUksR0FBRyxlQUFRLENBQUMsSUFBSSxFQUFFLGNBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQy9DO1FBQ0QsT0FBTyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNwQyxTQUFTLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3RDLFNBQVMsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDekMsU0FBUyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFcEMsSUFBSSxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUMxQyxTQUFTLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQztZQUN0RSxPQUFPLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNyQyxTQUFTLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUN2QyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUMzQjthQUNJO1lBQ0QsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNwQyxTQUFTLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN0QyxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQ2pDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVO1FBQ1osTUFBTSxNQUFNLEdBQUcsTUFBTSxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQy9CLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLHdDQUF3QyxDQUFDO1lBQ3ZELElBQUksRUFBRSxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsV0FBVyxDQUFDLElBQUksRUFBRTtZQUNuRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUM7U0FDM0QsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDakMsT0FBTztTQUNWO1FBQ0QsS0FBSyxNQUFNLElBQUksSUFBSSxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ2pDLElBQUksb0JBQW9CLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLEVBQUU7Z0JBQ3pELG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQ3ZFO1NBQ0o7UUFFRCxpQkFBaUI7UUFDakIsSUFBSSxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUMxQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxHQUFHLG9CQUFvQixDQUFDO1lBQ2xELFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDckU7UUFDRCxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUUxQixjQUFjO1FBQ2QsTUFBTSxJQUFJLEdBQUcsY0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQyxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFFRCxTQUFTO0lBQ1QsS0FBSyxDQUFDLFVBQVU7UUFDWixNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ25DLE1BQU0sTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLDBDQUEwQyxFQUFFO1lBQ2hGLElBQUksRUFBRSxJQUFJO1NBQ2IsQ0FBQyxFQUFFO1lBQ0EsT0FBTyxFQUFFO2dCQUNMLElBQUksQ0FBQyxDQUFDLENBQUMsNEJBQTRCLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxDQUFDLENBQUMsK0JBQStCLENBQUM7YUFDMUM7WUFDRCxPQUFPLEVBQUUsQ0FBQztZQUNWLE1BQU0sRUFBRSxDQUFDO1NBQ1osQ0FBQyxDQUFDO1FBQ0gsSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLENBQUMsRUFBRTtZQUV2QixNQUFNLENBQUMsR0FBRyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQztZQUNwRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDUixvQkFBb0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFekMseUJBQXlCO2dCQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUU7b0JBQ2xFLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLEVBQUU7d0JBQ25CLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO3FCQUNqRDtnQkFDTCxDQUFDLENBQUMsQ0FBQztnQkFDSCxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUM3QjtTQUNKO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVO1FBQ1osTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRTtZQUNuRCxJQUFJLEVBQUUsaUJBQWlCO1lBQ3ZCLE1BQU0sRUFBRSxZQUFZO1NBQ3ZCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxLQUFLLENBQUMsZ0JBQWdCO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEQsSUFBSSxJQUFJLEVBQUU7WUFDTixNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLHNCQUFzQixFQUFFO2dCQUNuRCxJQUFJLEVBQUUsaUJBQWlCO2dCQUN2QixNQUFNLEVBQUUsY0FBYztnQkFDdEIsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO2FBQ2YsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QixNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDbkM7YUFBTTtZQUNILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNyQjtRQUNELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUVwQixDQUFDO0lBRUQsT0FBTztJQUNQLEtBQUssQ0FBQyxjQUFjLENBQUMsS0FBWTtRQUM3QixNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLG9CQUFvQixDQUFDO1FBRWxELElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2xCLGFBQWE7WUFDYixTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQzlDO2FBQU07WUFDSCxhQUFhO1lBQ2IsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDbkQ7UUFFRCxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxlQUFlO0lBQ2YsS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFlO1FBQzdCLDBCQUEwQjtRQUMxQixNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN0RSxNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLHNCQUFzQixFQUFFO1lBQ25ELElBQUksRUFBRSxpQkFBaUI7WUFDdkIsTUFBTSxFQUFFLFlBQVk7WUFDcEIsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDO1NBQ2xCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxTQUFTO0lBQ1QsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFTO1FBQ3JCLE1BQU0sT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUU7WUFDbkQsSUFBSSxFQUFFLGlCQUFpQjtZQUN2QixNQUFNLEVBQUUsT0FBTztZQUNmLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNaLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxTQUFTO0lBQ1QsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFTO1FBQ3JCLE1BQU0sT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUU7WUFDbkQsSUFBSSxFQUFFLGlCQUFpQjtZQUN2QixNQUFNLEVBQUUsT0FBTztZQUNmLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNaLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQVk7UUFDM0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xDLGFBQWE7UUFDYixPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ3JDLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBWTtRQUN0QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEMsYUFBYTtRQUNiLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDL0IsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFZO1FBQ3RCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQyxhQUFhO1FBQ2IsT0FBTyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUMvQixNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxLQUFLLENBQUMsa0JBQWtCO1FBQ3BCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQyxPQUFPLENBQUMsQ0FBQyxJQUFJLHFCQUFxQixDQUFDO1FBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBQ0QsS0FBSyxDQUFDLGlCQUFpQjtRQUNuQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEMsT0FBTyxDQUFDLENBQUMsSUFBSSxxQkFBcUIsQ0FBQztRQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUNELEtBQUssQ0FBQyxlQUFlO1FBQ2pCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQyxPQUFPLENBQUMsQ0FBQyxJQUFJLHFCQUFxQixDQUFDO1FBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBQ0QsS0FBSyxDQUFDLGlCQUFpQjtRQUNuQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEMsT0FBTyxDQUFDLENBQUMsSUFBSSxxQkFBcUIsQ0FBQztRQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVELHNCQUFzQjtRQUNsQixXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEMsV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hELGtCQUFrQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BELGNBQWMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QyxjQUFjLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzlDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUN6RCxTQUFTLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDMUQsT0FBTyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQztRQUNsRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCx3QkFBd0I7UUFDcEIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ2pELFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUM1RCxTQUFTLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDN0QsT0FBTyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQztRQUNyRCxPQUFPLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7Q0FDSixDQUFDO0FBRUssTUFBTSxLQUFLLEdBQUcsS0FBSztJQUN0QixXQUFXO0lBQ1gsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDdEMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQztJQUU3QyxhQUFhO0lBQ2IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBRW5CLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqQixJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakIsU0FBUyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQzlCLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUM5QixVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDN0IsT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ3pCLE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUV6QixLQUFLLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztJQUUvQixvQkFBb0IsR0FBRyxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLElBQUksYUFBYSxDQUFDO0lBQzdGLE1BQU0sS0FBSyxHQUFXLE1BQU0sT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUscUJBQXFCLENBQUMsQ0FBQztJQUM1RSxvQkFBb0IsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBRW5DLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUVqQixNQUFNLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUUzQixJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFELE9BQU8sQ0FBQyxTQUFTLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDO0FBNUJXLFFBQUEsS0FBSyxTQTRCaEI7QUFFSyxNQUFNLEtBQUssR0FBRyxLQUFLO0lBQ3RCLGFBQWE7SUFDYixJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUNoQyxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLG9CQUFvQixDQUFDLENBQUM7QUFDL0UsQ0FBQyxDQUFDO0FBSlcsUUFBQSxLQUFLLFNBSWhCIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgY2FtZWxjYXNlICovXG4ndXNlIHN0cmljdCc7XG5cbmRlY2xhcmUgY29uc3QgRWRpdG9yOiBhbnk7XG5cbmNvbnN0IHJlbW90ZSA9IHJlcXVpcmUoJ0BlbGVjdHJvbi9yZW1vdGUnKTtcblxuaW1wb3J0IHsgZGlybmFtZSwgYmFzZW5hbWUsIGV4dG5hbWUsIGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gXCJmc1wiO1xuXG5jb25zdCB7IEkxOG4sIE1lc3NhZ2UsIERpYWxvZywgUHJvZmlsZSB9ID0gRWRpdG9yO1xuXG5leHBvcnQgY29uc3Qgc3R5bGUgPSByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICcuLi8uLi9kaXN0L2luZGV4LmNzcycpLCAndXRmOCcpO1xuZXhwb3J0IGNvbnN0IHRlbXBsYXRlID0gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc3RhdGljcy9pbmRleC5odG1sJyksICd1dGY4Jyk7XG5cbmxldCB1aV9lZGl0b3I6IEhUTUxFbGVtZW50O1xubGV0IHVpX2ltYWdlczogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeDogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeTogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfb3BhY2l0eTogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2FkZDogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2RlbDogSFRNTEVsZW1lbnQ7XG5leHBvcnQgY29uc3QgJCA9IHtcbiAgICB1aV9lZGl0b3I6ICcuY29uZmlnJyxcbiAgICB1aV9pbWFnZXM6ICcuaW1hZ2VzJyxcbiAgICBidG5BZGQ6ICcuYWRkLWltYWdlJyxcbiAgICBidG5EZWw6ICcuZGVsLWltYWdlJyxcblxuICAgIHg6ICcueCcsXG4gICAgeTogJy55JyxcbiAgICBvcGFjaXR5OiAnLm9wYWNpdHknLFxufTtcblxubGV0IHNob3cgPSB0cnVlO1xuXG5pbnRlcmZhY2UgSUltYWdlRGF0YSB7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgb3BhY2l0eTogbnVtYmVyXG59XG5pbnRlcmZhY2UgSVNjZW5lRGF0YSB7XG4gICAgW3Byb3A6IHN0cmluZ106IHtcbiAgICAgICAgcGF0aDogc3RyaW5nXG4gICAgfVxufVxuaW50ZXJmYWNlIElSZWZlcmVuY2Uge1xuICAgIGltYWdlczogSUltYWdlRGF0YVtdO1xuICAgIHNjZW5lVVVJRDogSVNjZW5lRGF0YTtcbiAgICBzY2VuZTogc3RyaW5nO1xufVxuXG5jb25zdCBkZWZhdWx0Q29uZmlnID0ge1xuICAgIGltYWdlczogW10sXG4gICAgc2NlbmVVVUlEOiB7fSxcbiAgICBzY2VuZTogJycsXG59O1xubGV0IHJlZmVyZW5jZUltYWdlQ29uZmlnOiBJUmVmZXJlbmNlID0gZGVmYXVsdENvbmZpZztcblxuY29uc3Qgc2hvcnRjdXRzTW92ZURpc3RhbmNlID0gMjsgLy8g5b+r5o236ZSu56e75Yqo6Led56a7XG5cbmxldCBvbk1vdmVYRnVuYzogYW55O1xubGV0IG9uTW92ZVlGdW5jOiBhbnk7XG5sZXQgb25BZGRJbWFnZUZ1bmM6IGFueTtcbmxldCBvbkRlbEltYWdlRnVuYzogYW55O1xubGV0IG9uU2V0T3BhY2l0eUZ1bmM6IGFueTtcbmxldCBvblN3aXRjaEltYWdlc0Z1bmM6IGFueTtcblxuZXhwb3J0IGNvbnN0IG1ldGhvZHMgPSB7XG5cbiAgICBhc3luYyAnc2NlbmU6cmVhZHknKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmVmZXJlbmNlSW1hZ2VDb25maWcuc2NlbmUgPSBpZDsgLy8g6K6+572u5Zy65pmvaWRcblxuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltYWdlcygpO1xuICAgICAgICBNZXNzYWdlLmJyb2FkY2FzdCgncmVmZXJlbmNlLWltYWdlOnNob3cnLCBzaG93KTtcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudCgpIHtcbiAgICAgICAgY29uc3QgeyBzY2VuZSwgc2NlbmVVVUlELCBpbWFnZXMgfSA9IHJlZmVyZW5jZUltYWdlQ29uZmlnO1xuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICBpZiAoc2NlbmUgJiYgc2NlbmVVVUlEW3NjZW5lXSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaW1hZ2VzLmZpbmQodiA9PiB2LnBhdGggPT09IHNjZW5lVVVJRFtzY2VuZV0ucGF0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaW1hZ2VzWzBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQgPz8geyBwYXRoOiAnJywgeDogMCwgeTogMCwgb3BhY2l0eTogNTAgfTtcbiAgICB9LFxuXG4gICAgcmVuZGVyVUkoKSB7XG4gICAgICAgIGNvbnN0IHsgeCwgeSwgb3BhY2l0eSB9ID0gdGhpcy5nZXRDdXJyZW50KCk7XG5cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV94LnZhbHVlID0geDtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV95LnZhbHVlID0geTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB1aV9vcGFjaXR5LnZhbHVlID0gb3BhY2l0eTtcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlSW1hZ2VzKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcztcbiAgICAgICAgLy8gY2xlYXJcbiAgICAgICAgd2hpbGUgKHVpX2ltYWdlcy5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICB1aV9pbWFnZXMucmVtb3ZlQ2hpbGQodWlfaW1hZ2VzLmZpcnN0Q2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVtcHR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICAgICAgZW1wdHkuc2V0QXR0cmlidXRlKCd2YWx1ZScsICcnKTtcbiAgICAgICAgICAgICAgICBlbXB0eS50ZXh0ID0gJ1vnqbpdJztcbiAgICAgICAgICAgICAgICB1aV9pbWFnZXMuYXBwZW5kQ2hpbGQoZW1wdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCd2YWx1ZScsIHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlc1tpXS5wYXRoKTtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5hcHBlbmRDaGlsZChvcHRpb24pO1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlc1tpXS5wYXRoO1xuICAgICAgICAgICAgb3B0aW9uLnRleHQgPSBiYXNlbmFtZShwYXRoLCBleHRuYW1lKHBhdGgpKTtcbiAgICAgICAgfVxuICAgICAgICBidG5fZGVsLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfZWRpdG9yLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfaW1hZ2VzLnJlbW92ZUF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKTtcbiAgICAgICAgdWlfaW1hZ2VzLnNldEF0dHJpYnV0ZSgndmFsdWUnLCAnJyk7XG5cbiAgICAgICAgaWYgKHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgSTE4bi50KCdyZWZlcmVuY2UtaW1hZ2Uubm9uZScpKTtcbiAgICAgICAgICAgIGJ0bl9kZWwuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgICAgICAgIHVpX2VkaXRvci5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZXNldEltYWdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB7IHBhdGggfSA9IHBhbmVsLmdldEN1cnJlbnQoKTtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgcGF0aCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRTd2l0Y2hJbWFnZXMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyBvbkFkZEltYWdlKCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBEaWFsb2cuc2VsZWN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cuYWRkLWltYWdlLXRpdGxlJyksXG4gICAgICAgICAgICBwYXRoOiBhd2FpdCBQcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Jvb3QtcGF0aCcpIHx8ICcnLFxuICAgICAgICAgICAgZmlsdGVyczogW3sgbmFtZTogJ2ltYWdlJywgZXh0ZW5zaW9uczogWydwbmcnLCAnanBnJ10gfV0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LmZpbGVQYXRoc1swXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgcGF0aCBvZiByZXN1bHQuZmlsZVBhdGhzKSB7XG4gICAgICAgICAgICBpZiAocmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLmV2ZXJ5KHYgPT4gdi5wYXRoICE9PSBwYXRoKSkge1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5wdXNoKHsgcGF0aCwgeDogMCwgeTogMCwgb3BhY2l0eTogNTAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlj6rmnInkuIDlvKDlm77niYfnmoTml7blgJnvvIzpu5jorqTotYvlgLxcbiAgICAgICAgaWYgKHJlZmVyZW5jZUltYWdlQ29uZmlnLmltYWdlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2NlbmUsIHNjZW5lVVVJRCB9ID0gcmVmZXJlbmNlSW1hZ2VDb25maWc7XG4gICAgICAgICAgICBzY2VuZVVVSURbc2NlbmVdID0geyBwYXRoOiByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXNbMF0hLnBhdGggfTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltYWdlcygpO1xuXG4gICAgICAgIC8vIOiuvue9ruW8ueeql+aJk+W8gOeahOebruW9leS9jee9rlxuICAgICAgICBjb25zdCBwYXRoID0gZGlybmFtZShyZXN1bHQuZmlsZVBhdGhzWzBdKTtcbiAgICAgICAgYXdhaXQgUHJvZmlsZS5zZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdyb290LXBhdGgnLCBwYXRoKTtcbiAgICB9LFxuXG4gICAgLy8g5Yig6Zmk5LiA5byg5Zu+54mHXG4gICAgYXN5bmMgb25EZWxJbWFnZSgpIHtcbiAgICAgICAgY29uc3QgeyBwYXRoIH0gPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRGlhbG9nLmluZm8oSTE4bi50KCdyZWZlcmVuY2UtaW1hZ2UuZGlhbG9nLmRlbF9pbWFnZV9tZXNzYWdlJywge1xuICAgICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgfSksIHtcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAgICBJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cueWVzJyksXG4gICAgICAgICAgICAgICAgSTE4bi50KCdyZWZlcmVuY2UtaW1hZ2UuZGlhbG9nLmNhbmNlbCcpLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgICAgICBjYW5jZWw6IDEsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocmVzdWx0LnJlc3BvbnNlID09PSAwKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGkgPSByZWZlcmVuY2VJbWFnZUNvbmZpZy5pbWFnZXMuZmluZEluZGV4KHYgPT4gdi5wYXRoID0gcGF0aCk7XG4gICAgICAgICAgICBpZiAoaSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlSW1hZ2VDb25maWcuaW1hZ2VzLnNwbGljZShpLCAxKTtcblxuICAgICAgICAgICAgICAgIC8vIOWIoOmZpOWbvueJh+eahOaXtuWAme+8jOaKiuW6lOeUqOWIsOivpeWbvueJh+eahOWcuuaZr+a4heepuuS4gOS4i1xuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlZmVyZW5jZUltYWdlQ29uZmlnLnNjZW5lVVVJRCkuZm9yRWFjaCgoW2tleSwgdmFsXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsLnBhdGggPT09IHBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUltYWdlQ29uZmlnLnNjZW5lVVVJRFtrZXldLnBhdGggPSAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1hZ2VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgcmVzZXRJbWFnZSgpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAncmVzZXRJbWFnZScsXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhc3luYyBzZW5kU3dpdGNoSW1hZ2VzKCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIHgsIHksIG9wYWNpdHkgfSA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncmVmZXJlbmNlLWltYWdlJyxcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdzd2l0Y2hJbWFnZXMnLFxuICAgICAgICAgICAgICAgIGFyZ3M6IFtwYXRoXSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kTW92ZVgoeCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWSh5KTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZE9wYWNpdHkob3BhY2l0eSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG5cbiAgICB9LFxuXG4gICAgLy8g5YiH5o2i5Zu+54mHXG4gICAgYXN5bmMgb25Td2l0Y2hJbWFnZXMoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgc2NlbmVVVUlELCBzY2VuZSB9ID0gcmVmZXJlbmNlSW1hZ2VDb25maWc7XG5cbiAgICAgICAgaWYgKHNjZW5lVVVJRFtzY2VuZV0pIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNjZW5lVVVJRFtzY2VuZV0ucGF0aCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNjZW5lVVVJRFtzY2VuZV0gPSB7IHBhdGg6IGV2ZW50LnRhcmdldC52YWx1ZSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kU3dpdGNoSW1hZ2VzKCk7XG4gICAgfSxcblxuICAgIC8vIOmAmuefpeS/ruaUuSBvcGFjaXR5XG4gICAgYXN5bmMgc2VuZE9wYWNpdHkob3BhY2l0eTogbnVtYmVyKSB7XG4gICAgICAgIC8vIHNjZW5lLXdhbGtlci50cyDpnIDopoHnlKjliLDmraTphY3nva5cbiAgICAgICAgYXdhaXQgRWRpdG9yLlByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnb3BhY2l0eScsIG9wYWNpdHkpO1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdzZXRPcGFjaXR5JyxcbiAgICAgICAgICAgIGFyZ3M6IFtvcGFjaXR5XSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIOmAmuefpeS/ruaUuSB4XG4gICAgYXN5bmMgc2VuZE1vdmVYKHg6IG51bWJlcikge1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdtb3ZlWCcsXG4gICAgICAgICAgICBhcmdzOiBbeF0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyDpgJrnn6Xkv67mlLkgeVxuICAgIGFzeW5jIHNlbmRNb3ZlWSh5OiBudW1iZXIpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAnbW92ZVknLFxuICAgICAgICAgICAgYXJnczogW3ldLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYXN5bmMgb25TZXRPcGFjaXR5KGV2ZW50OiBFdmVudCkge1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5nZXRDdXJyZW50KCk7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY3VycmVudC5vcGFjaXR5ID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRPcGFjaXR5KGN1cnJlbnQub3BhY2l0eSk7XG4gICAgfSxcblxuICAgIGFzeW5jIG9uTW92ZVgoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjdXJyZW50LnggPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE1vdmVYKGN1cnJlbnQueCk7XG4gICAgfSxcblxuICAgIGFzeW5jIG9uTW92ZVkoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjdXJyZW50LnkgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE1vdmVZKGN1cnJlbnQueSk7XG4gICAgfSxcblxuICAgIGFzeW5jIHNob3J0Y3V0c01vdmVSaWdodCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjdXJyZW50LnggKz0gc2hvcnRjdXRzTW92ZURpc3RhbmNlO1xuICAgICAgICB0aGlzLnNlbmRNb3ZlWChjdXJyZW50LngpO1xuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG4gICAgfSxcbiAgICBhc3luYyBzaG9ydGN1dHNNb3ZlTGVmdCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjdXJyZW50LnggLT0gc2hvcnRjdXRzTW92ZURpc3RhbmNlO1xuICAgICAgICB0aGlzLnNlbmRNb3ZlWChjdXJyZW50LngpO1xuICAgICAgICB0aGlzLnJlbmRlclVJKCk7XG4gICAgfSxcbiAgICBhc3luYyBzaG9ydGN1dHNNb3ZlVXAoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY3VycmVudC55ICs9IHNob3J0Y3V0c01vdmVEaXN0YW5jZTtcbiAgICAgICAgdGhpcy5zZW5kTW92ZVkoY3VycmVudC55KTtcbiAgICAgICAgdGhpcy5yZW5kZXJVSSgpO1xuICAgIH0sXG4gICAgYXN5bmMgc2hvcnRjdXRzTW92ZURvd24oKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY3VycmVudC55IC09IHNob3J0Y3V0c01vdmVEaXN0YW5jZTtcbiAgICAgICAgdGhpcy5zZW5kTW92ZVkoY3VycmVudC55KTtcbiAgICAgICAgdGhpcy5yZW5kZXJVSSgpO1xuICAgIH0sXG5cbiAgICByZWdpc3RlckV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICBvbk1vdmVYRnVuYyA9IHRoaXMub25Nb3ZlWC5iaW5kKHRoaXMpO1xuICAgICAgICBvbk1vdmVZRnVuYyA9IHRoaXMub25Nb3ZlWS5iaW5kKHRoaXMpO1xuICAgICAgICBvblNldE9wYWNpdHlGdW5jID0gdGhpcy5vblNldE9wYWNpdHkuYmluZCh0aGlzKTtcbiAgICAgICAgb25Td2l0Y2hJbWFnZXNGdW5jID0gdGhpcy5vblN3aXRjaEltYWdlcy5iaW5kKHRoaXMpO1xuICAgICAgICBvbkFkZEltYWdlRnVuYyA9IHRoaXMub25BZGRJbWFnZS5iaW5kKHRoaXMpO1xuICAgICAgICBvbkRlbEltYWdlRnVuYyA9IHRoaXMub25EZWxJbWFnZS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHVpX3guYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVhGdW5jKTtcbiAgICAgICAgdWlfeS5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Nb3ZlWUZ1bmMpO1xuICAgICAgICB1aV9vcGFjaXR5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblNldE9wYWNpdHlGdW5jKTtcbiAgICAgICAgdWlfaW1hZ2VzLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblN3aXRjaEltYWdlc0Z1bmMpO1xuICAgICAgICBidG5fYWRkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25BZGRJbWFnZUZ1bmMpO1xuICAgICAgICBidG5fZGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25EZWxJbWFnZUZ1bmMpO1xuICAgIH0sXG5cbiAgICB1bnJlZ2lzdGVyRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHVpX3gucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVhGdW5jKTtcbiAgICAgICAgdWlfeS5yZW1vdmVFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Nb3ZlWUZ1bmMpO1xuICAgICAgICB1aV9vcGFjaXR5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblNldE9wYWNpdHlGdW5jKTtcbiAgICAgICAgdWlfaW1hZ2VzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvblN3aXRjaEltYWdlc0Z1bmMpO1xuICAgICAgICBidG5fYWRkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25BZGRJbWFnZUZ1bmMpO1xuICAgICAgICBidG5fZGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25EZWxJbWFnZUZ1bmMpO1xuICAgIH0sXG59O1xuXG5leHBvcnQgY29uc3QgcmVhZHkgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAvLyDorr7nva4gVGl0bGVcbiAgICBjb25zdCB3aW4gPSByZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpO1xuICAgIHdpbi5zZXRUaXRsZShJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5uYW1lJykpO1xuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IHBhbmVsID0gdGhpcztcblxuICAgIHVpX3ggPSBwYW5lbC4kLng7XG4gICAgdWlfeSA9IHBhbmVsLiQueTtcbiAgICB1aV9lZGl0b3IgPSBwYW5lbC4kLnVpX2VkaXRvcjtcbiAgICB1aV9pbWFnZXMgPSBwYW5lbC4kLnVpX2ltYWdlcztcbiAgICB1aV9vcGFjaXR5ID0gcGFuZWwuJC5vcGFjaXR5O1xuICAgIGJ0bl9hZGQgPSBwYW5lbC4kLmJ0bkFkZDtcbiAgICBidG5fZGVsID0gcGFuZWwuJC5idG5EZWw7XG5cbiAgICBwYW5lbC5yZWdpc3RlckV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICByZWZlcmVuY2VJbWFnZUNvbmZpZyA9IGF3YWl0IFByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnY29uZmlnJykgfHwgZGVmYXVsdENvbmZpZztcbiAgICBjb25zdCBzY2VuZTogc3RyaW5nID0gYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdxdWVyeS1jdXJyZW50LXNjZW5lJyk7XG4gICAgcmVmZXJlbmNlSW1hZ2VDb25maWcuc2NlbmUgPSBzY2VuZTtcblxuICAgIHBhbmVsLnJlbmRlclVJKCk7XG5cbiAgICBhd2FpdCBwYW5lbC51cGRhdGVJbWFnZXMoKTtcblxuICAgIHNob3cgPSBhd2FpdCBQcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Nob3cnKTtcbiAgICBNZXNzYWdlLmJyb2FkY2FzdCgncmVmZXJlbmNlLWltYWdlOnNob3cnLCBzaG93KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbG9zZSA9IGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB0aGlzLnVucmVnaXN0ZXJFdmVudExpc3RlbmVycygpO1xuICAgIGF3YWl0IFByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnY29uZmlnJywgcmVmZXJlbmNlSW1hZ2VDb25maWcpO1xufTtcbiJdfQ==