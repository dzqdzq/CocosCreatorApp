"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const scene_message_1 = require("../shared/scene-message");
const panelDataMap = new WeakMap();
module.exports = Editor.Panel.define({
    ready() {
        const button = this.$.bake;
        this.$.bake.addEventListener('confirm', () => {
            const dump = panelDataMap.get(this).dump;
            const uuids = dump.value.uuid.values ?? [dump.value.uuid.value];
            scene_message_1.operation('start-bake', uuids);
            Editor.Metrics._trackEventWithTimer({
                category: 'bakingSystem',
                id: 'A100014',
                value: 1,
            });
        });
        const onUpdateInfo = (result) => {
            const dump = panelDataMap.get(this).dump;
            const uuids = dump.value.uuid.values ?? [dump.value.uuid.value];
            if (uuids.some(item => result.currentInfo?.uuid === item || result.remaining.some(info => info.uuid === item))) {
                button.setAttribute('disabled', 'disabled');
            }
            else {
                button.removeAttribute('disabled');
            }
        };
        panelDataMap.set(this, {
            onUpdateInfo,
        });
        scene_message_1.addBroadcastListener('reflection-probe:update-bake-info', onUpdateInfo);
    },
    update(dump) {
        if (dump) {
            const data = panelDataMap.get(this);
            data.dump = dump;
            const button = this.$.bake;
            const cubeTypes = (dump.value.probeType.values ?? [dump.value.probeType.value]);
            const cubeEnumIndex = dump.value.probeType.enumList.findIndex((item) => item.name === 'CUBE');
            button.hidden = cubeTypes.some((item) => item !== cubeEnumIndex);
            scene_message_1.query('query-bake-info').then(info => {
                if (info) {
                    data?.onUpdateInfo(info);
                }
            });
        }
    },
    $: {
        bake: '.bake',
    },
    style: /* css */ `
        .reflection-probe-footer {
            display: flex;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        ui-button[hidden] {
            display: none;
        }

        .bake {
            flex: 1;
        }
    `,
    template: /* html */ `
        <div class="reflection-probe-footer">
            <ui-button class="bake blue">Bake</ui-button>
        </div>
    `,
    close() {
        const data = panelDataMap.get(this);
        scene_message_1.removeBroadcastListener('reflection-probe:update-bake-info', data.onUpdateInfo);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVmbGVjdGlvbi1wcm9iZS1mb290ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvaW5zcGVjdG9yL3JlZmxlY3Rpb24tcHJvYmUtZm9vdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsMkRBQTBHO0FBRTFHLE1BQU0sWUFBWSxHQUFHLElBQUksT0FBTyxFQUF5RSxDQUFDO0FBQzFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDakMsS0FBSztRQUNELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSyxDQUFDO1FBQzVCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7WUFDMUMsTUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQyxJQUFJLENBQUM7WUFDMUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEUseUJBQVMsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztnQkFDaEMsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLEVBQUUsRUFBRSxTQUFTO2dCQUNiLEtBQUssRUFBRSxDQUFDO2FBQ1gsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLFlBQVksR0FBRyxDQUFDLE1BQXVCLEVBQUUsRUFBRTtZQUM3QyxNQUFNLElBQUksR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBRSxDQUFDLElBQUksQ0FBQztZQUMxQyxNQUFNLEtBQUssR0FBMEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFdkYsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxJQUFJLEtBQUssSUFBSSxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUM1RyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQzthQUMvQztpQkFBTTtnQkFDSCxNQUFNLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ3RDO1FBQ0wsQ0FBQyxDQUFDO1FBQ0YsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUU7WUFDbkIsWUFBWTtTQUNmLENBQUMsQ0FBQztRQUNILG9DQUFvQixDQUFDLG1DQUFtQyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSTtRQUNQLElBQUksSUFBSSxFQUFFO1lBQ04sTUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxJQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNsQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUssQ0FBQztZQUM1QixNQUFNLFNBQVMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDaEYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQztZQUNuRyxNQUFNLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsQ0FBQztZQUN0RSxxQkFBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNqQyxJQUFJLElBQUksRUFBRTtvQkFDTixJQUFJLEVBQUUsWUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUM3QjtZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDO0lBQ0QsQ0FBQyxFQUFFO1FBQ0MsSUFBSSxFQUFFLE9BQU87S0FDaEI7SUFDRCxLQUFLLEVBQUUsU0FBUyxDQUFBOzs7Ozs7Ozs7Ozs7OztLQWNmO0lBQ0QsUUFBUSxFQUFFLFVBQVUsQ0FBQTs7OztLQUluQjtJQUNELEtBQUs7UUFDRCxNQUFNLElBQUksR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLHVDQUF1QixDQUFDLG1DQUFtQyxFQUFFLElBQUssQ0FBQyxZQUFhLENBQUMsQ0FBQztJQUN0RixDQUFDO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUXVlcnlCYWtlUmVzdWx0LCBSZWZsZWN0aW9uUHJvYmVCYWtlSW5mbyB9IGZyb20gJy4uLy4uL0B0eXBlcy9wcm90ZWN0ZWQnO1xuaW1wb3J0IHsgYWRkQnJvYWRjYXN0TGlzdGVuZXIsIG9wZXJhdGlvbiwgcXVlcnksIHJlbW92ZUJyb2FkY2FzdExpc3RlbmVyIH0gZnJvbSAnLi4vc2hhcmVkL3NjZW5lLW1lc3NhZ2UnO1xuXG5jb25zdCBwYW5lbERhdGFNYXAgPSBuZXcgV2Vha01hcDxhbnksIHsgZHVtcD86IGFueSwgb25VcGRhdGVJbmZvPzogKHJlc3VsdDogUXVlcnlCYWtlUmVzdWx0KSA9PiB2b2lkIH0+KCk7XG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRvci5QYW5lbC5kZWZpbmUoe1xuICAgIHJlYWR5KCkge1xuICAgICAgICBjb25zdCBidXR0b24gPSB0aGlzLiQuYmFrZSE7XG4gICAgICAgIHRoaXMuJC5iYWtlIS5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHVtcCA9IHBhbmVsRGF0YU1hcC5nZXQodGhpcykhLmR1bXA7XG4gICAgICAgICAgICBjb25zdCB1dWlkcyA9IGR1bXAudmFsdWUudXVpZC52YWx1ZXMgPz8gW2R1bXAudmFsdWUudXVpZC52YWx1ZV07XG4gICAgICAgICAgICBvcGVyYXRpb24oJ3N0YXJ0LWJha2UnLCB1dWlkcyk7XG4gICAgICAgICAgICBFZGl0b3IuTWV0cmljcy5fdHJhY2tFdmVudFdpdGhUaW1lcih7XG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdiYWtpbmdTeXN0ZW0nLFxuICAgICAgICAgICAgICAgIGlkOiAnQTEwMDAxNCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IDEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG9uVXBkYXRlSW5mbyA9IChyZXN1bHQ6IFF1ZXJ5QmFrZVJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHVtcCA9IHBhbmVsRGF0YU1hcC5nZXQodGhpcykhLmR1bXA7XG4gICAgICAgICAgICBjb25zdCB1dWlkczogUmVhZG9ubHlBcnJheTxzdHJpbmc+ID0gZHVtcC52YWx1ZS51dWlkLnZhbHVlcyA/PyBbZHVtcC52YWx1ZS51dWlkLnZhbHVlXTtcblxuICAgICAgICAgICAgaWYgKHV1aWRzLnNvbWUoaXRlbSA9PiByZXN1bHQuY3VycmVudEluZm8/LnV1aWQgPT09IGl0ZW0gfHwgcmVzdWx0LnJlbWFpbmluZy5zb21lKGluZm8gPT4gaW5mby51dWlkID09PSBpdGVtKSkpIHtcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwYW5lbERhdGFNYXAuc2V0KHRoaXMsIHtcbiAgICAgICAgICAgIG9uVXBkYXRlSW5mbyxcbiAgICAgICAgfSk7XG4gICAgICAgIGFkZEJyb2FkY2FzdExpc3RlbmVyKCdyZWZsZWN0aW9uLXByb2JlOnVwZGF0ZS1iYWtlLWluZm8nLCBvblVwZGF0ZUluZm8pO1xuICAgIH0sXG4gICAgdXBkYXRlKGR1bXApIHtcbiAgICAgICAgaWYgKGR1bXApIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBwYW5lbERhdGFNYXAuZ2V0KHRoaXMpO1xuICAgICAgICAgICAgZGF0YSEuZHVtcCA9IGR1bXA7XG4gICAgICAgICAgICBjb25zdCBidXR0b24gPSB0aGlzLiQuYmFrZSE7XG4gICAgICAgICAgICBjb25zdCBjdWJlVHlwZXMgPSAoZHVtcC52YWx1ZS5wcm9iZVR5cGUudmFsdWVzID8/IFtkdW1wLnZhbHVlLnByb2JlVHlwZS52YWx1ZV0pO1xuICAgICAgICAgICAgY29uc3QgY3ViZUVudW1JbmRleCA9IGR1bXAudmFsdWUucHJvYmVUeXBlLmVudW1MaXN0LmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtLm5hbWUgPT09ICdDVUJFJyk7XG4gICAgICAgICAgICBidXR0b24uaGlkZGVuID0gY3ViZVR5cGVzLnNvbWUoKGl0ZW06IGFueSkgPT4gaXRlbSAhPT0gY3ViZUVudW1JbmRleCk7XG4gICAgICAgICAgICBxdWVyeSgncXVlcnktYmFrZS1pbmZvJykudGhlbihpbmZvID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhPy5vblVwZGF0ZUluZm8hKGluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAkOiB7XG4gICAgICAgIGJha2U6ICcuYmFrZScsXG4gICAgfSxcbiAgICBzdHlsZTogLyogY3NzICovYFxuICAgICAgICAucmVmbGVjdGlvbi1wcm9iZS1mb290ZXIge1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDZweDtcbiAgICAgICAgfVxuXG4gICAgICAgIHVpLWJ1dHRvbltoaWRkZW5dIHtcbiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAuYmFrZSB7XG4gICAgICAgICAgICBmbGV4OiAxO1xuICAgICAgICB9XG4gICAgYCxcbiAgICB0ZW1wbGF0ZTogLyogaHRtbCAqL2BcbiAgICAgICAgPGRpdiBjbGFzcz1cInJlZmxlY3Rpb24tcHJvYmUtZm9vdGVyXCI+XG4gICAgICAgICAgICA8dWktYnV0dG9uIGNsYXNzPVwiYmFrZSBibHVlXCI+QmFrZTwvdWktYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICBgLFxuICAgIGNsb3NlKCkge1xuICAgICAgICBjb25zdCBkYXRhID0gcGFuZWxEYXRhTWFwLmdldCh0aGlzKTtcbiAgICAgICAgcmVtb3ZlQnJvYWRjYXN0TGlzdGVuZXIoJ3JlZmxlY3Rpb24tcHJvYmU6dXBkYXRlLWJha2UtaW5mbycsIGRhdGEhLm9uVXBkYXRlSW5mbyEpO1xuICAgIH0sXG59KTsiXX0=