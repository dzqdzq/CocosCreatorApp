"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const scene_message_1 = require("../shared/scene-message");
const panelDataMap = new WeakMap();
module.exports = Editor.Panel.define({
    ready() {
        const button = this.$.bake;
        this.$.bake.addEventListener('confirm', () => {
            const dump = panelDataMap.get(this).dump;
            const uuids = dump.value.uuid.values ?? [dump.value.uuid.value];
            (0, scene_message_1.operation)('start-bake', uuids);
            Editor.Metrics._trackEventWithTimer({
                category: 'bakingSystem',
                id: 'A100014',
                value: 1,
            });
        });
        const onUpdateInfo = (result) => {
            const dump = panelDataMap.get(this).dump;
            const uuids = dump.value.uuid.values ?? [dump.value.uuid.value];
            if (uuids.some(item => result.currentInfo?.uuid === item || result.remaining.some(info => info.uuid === item)) || dump.value.enabled.value === false) {
                button.setAttribute('disabled', 'disabled');
            }
            else {
                button.removeAttribute('disabled');
            }
        };
        panelDataMap.set(this, {
            onUpdateInfo,
        });
        (0, scene_message_1.addBroadcastListener)('reflection-probe:update-bake-info', onUpdateInfo);
    },
    update(dump) {
        if (dump) {
            const data = panelDataMap.get(this);
            data.dump = dump;
            const button = this.$.bake;
            const cubeTypes = (dump.value.probeType.values ?? [dump.value.probeType.value]);
            const cubeEnumIndex = dump.value.probeType.enumList.findIndex((item) => item.name === 'CUBE');
            button.hidden = cubeTypes.some((item) => item !== cubeEnumIndex);
            (0, scene_message_1.query)('query-bake-info').then(info => {
                if (info) {
                    data?.onUpdateInfo(info);
                }
            });
        }
    },
    $: {
        bake: '.bake',
    },
    style: /* css */ `
        .reflection-probe-footer {
            display: flex;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        ui-button[hidden] {
            display: none;
        }

        .bake {
            flex: 1;
        }
    `,
    template: /* html */ `
        <div class="reflection-probe-footer">
            <ui-button class="bake blue">Bake</ui-button>
        </div>
    `,
    close() {
        const data = panelDataMap.get(this);
        (0, scene_message_1.removeBroadcastListener)('reflection-probe:update-bake-info', data.onUpdateInfo);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVmbGVjdGlvbi1wcm9iZS1mb290ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvaW5zcGVjdG9yL3JlZmxlY3Rpb24tcHJvYmUtZm9vdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsMkRBQTBHO0FBRTFHLE1BQU0sWUFBWSxHQUFHLElBQUksT0FBTyxFQUF5RSxDQUFDO0FBQzFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDakMsS0FBSztRQUNELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSyxDQUFDO1FBQzVCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7WUFDMUMsTUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQyxJQUFJLENBQUM7WUFDMUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEUsSUFBQSx5QkFBUyxFQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDO2dCQUNoQyxRQUFRLEVBQUUsY0FBYztnQkFDeEIsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsS0FBSyxFQUFFLENBQUM7YUFDWCxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sWUFBWSxHQUFHLENBQUMsTUFBdUIsRUFBRSxFQUFFO1lBQzdDLE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFFLENBQUMsSUFBSSxDQUFDO1lBQzFDLE1BQU0sS0FBSyxHQUEwQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUV2RixJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLElBQUksS0FBSyxJQUFJLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtnQkFDbEosTUFBTSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7YUFDL0M7aUJBQU07Z0JBQ0gsTUFBTSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUN0QztRQUNMLENBQUMsQ0FBQztRQUNGLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFO1lBQ25CLFlBQVk7U0FDZixDQUFDLENBQUM7UUFDSCxJQUFBLG9DQUFvQixFQUFDLG1DQUFtQyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSTtRQUNQLElBQUksSUFBSSxFQUFFO1lBQ04sTUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxJQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNsQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUssQ0FBQztZQUM1QixNQUFNLFNBQVMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDaEYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQztZQUNuRyxNQUFNLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsQ0FBQztZQUN0RSxJQUFBLHFCQUFLLEVBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2pDLElBQUksSUFBSSxFQUFFO29CQUNOLElBQUksRUFBRSxZQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQzdCO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFDRCxDQUFDLEVBQUU7UUFDQyxJQUFJLEVBQUUsT0FBTztLQUNoQjtJQUNELEtBQUssRUFBRSxTQUFTLENBQUE7Ozs7Ozs7Ozs7Ozs7O0tBY2Y7SUFDRCxRQUFRLEVBQUUsVUFBVSxDQUFBOzs7O0tBSW5CO0lBQ0QsS0FBSztRQUNELE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsSUFBQSx1Q0FBdUIsRUFBQyxtQ0FBbUMsRUFBRSxJQUFLLENBQUMsWUFBYSxDQUFDLENBQUM7SUFDdEYsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFF1ZXJ5QmFrZVJlc3VsdCwgUmVmbGVjdGlvblByb2JlQmFrZUluZm8gfSBmcm9tICcuLi8uLi9AdHlwZXMvcHJvdGVjdGVkJztcbmltcG9ydCB7IGFkZEJyb2FkY2FzdExpc3RlbmVyLCBvcGVyYXRpb24sIHF1ZXJ5LCByZW1vdmVCcm9hZGNhc3RMaXN0ZW5lciB9IGZyb20gJy4uL3NoYXJlZC9zY2VuZS1tZXNzYWdlJztcblxuY29uc3QgcGFuZWxEYXRhTWFwID0gbmV3IFdlYWtNYXA8YW55LCB7IGR1bXA/OiBhbnksIG9uVXBkYXRlSW5mbz86IChyZXN1bHQ6IFF1ZXJ5QmFrZVJlc3VsdCkgPT4gdm9pZCB9PigpO1xubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3IuUGFuZWwuZGVmaW5lKHtcbiAgICByZWFkeSgpIHtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy4kLmJha2UhO1xuICAgICAgICB0aGlzLiQuYmFrZSEuYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGR1bXAgPSBwYW5lbERhdGFNYXAuZ2V0KHRoaXMpIS5kdW1wO1xuICAgICAgICAgICAgY29uc3QgdXVpZHMgPSBkdW1wLnZhbHVlLnV1aWQudmFsdWVzID8/IFtkdW1wLnZhbHVlLnV1aWQudmFsdWVdO1xuICAgICAgICAgICAgb3BlcmF0aW9uKCdzdGFydC1iYWtlJywgdXVpZHMpO1xuICAgICAgICAgICAgRWRpdG9yLk1ldHJpY3MuX3RyYWNrRXZlbnRXaXRoVGltZXIoe1xuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAnYmFraW5nU3lzdGVtJyxcbiAgICAgICAgICAgICAgICBpZDogJ0ExMDAwMTQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAxLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBvblVwZGF0ZUluZm8gPSAocmVzdWx0OiBRdWVyeUJha2VSZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGR1bXAgPSBwYW5lbERhdGFNYXAuZ2V0KHRoaXMpIS5kdW1wO1xuICAgICAgICAgICAgY29uc3QgdXVpZHM6IFJlYWRvbmx5QXJyYXk8c3RyaW5nPiA9IGR1bXAudmFsdWUudXVpZC52YWx1ZXMgPz8gW2R1bXAudmFsdWUudXVpZC52YWx1ZV07XG5cbiAgICAgICAgICAgIGlmICh1dWlkcy5zb21lKGl0ZW0gPT4gcmVzdWx0LmN1cnJlbnRJbmZvPy51dWlkID09PSBpdGVtIHx8IHJlc3VsdC5yZW1haW5pbmcuc29tZShpbmZvID0+IGluZm8udXVpZCA9PT0gaXRlbSkpIHx8IGR1bXAudmFsdWUuZW5hYmxlZC52YWx1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwYW5lbERhdGFNYXAuc2V0KHRoaXMsIHtcbiAgICAgICAgICAgIG9uVXBkYXRlSW5mbyxcbiAgICAgICAgfSk7XG4gICAgICAgIGFkZEJyb2FkY2FzdExpc3RlbmVyKCdyZWZsZWN0aW9uLXByb2JlOnVwZGF0ZS1iYWtlLWluZm8nLCBvblVwZGF0ZUluZm8pO1xuICAgIH0sXG4gICAgdXBkYXRlKGR1bXApIHtcbiAgICAgICAgaWYgKGR1bXApIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBwYW5lbERhdGFNYXAuZ2V0KHRoaXMpO1xuICAgICAgICAgICAgZGF0YSEuZHVtcCA9IGR1bXA7XG4gICAgICAgICAgICBjb25zdCBidXR0b24gPSB0aGlzLiQuYmFrZSE7XG4gICAgICAgICAgICBjb25zdCBjdWJlVHlwZXMgPSAoZHVtcC52YWx1ZS5wcm9iZVR5cGUudmFsdWVzID8/IFtkdW1wLnZhbHVlLnByb2JlVHlwZS52YWx1ZV0pO1xuICAgICAgICAgICAgY29uc3QgY3ViZUVudW1JbmRleCA9IGR1bXAudmFsdWUucHJvYmVUeXBlLmVudW1MaXN0LmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtLm5hbWUgPT09ICdDVUJFJyk7XG4gICAgICAgICAgICBidXR0b24uaGlkZGVuID0gY3ViZVR5cGVzLnNvbWUoKGl0ZW06IGFueSkgPT4gaXRlbSAhPT0gY3ViZUVudW1JbmRleCk7XG4gICAgICAgICAgICBxdWVyeSgncXVlcnktYmFrZS1pbmZvJykudGhlbihpbmZvID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhPy5vblVwZGF0ZUluZm8hKGluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAkOiB7XG4gICAgICAgIGJha2U6ICcuYmFrZScsXG4gICAgfSxcbiAgICBzdHlsZTogLyogY3NzICovYFxuICAgICAgICAucmVmbGVjdGlvbi1wcm9iZS1mb290ZXIge1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDZweDtcbiAgICAgICAgfVxuXG4gICAgICAgIHVpLWJ1dHRvbltoaWRkZW5dIHtcbiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAuYmFrZSB7XG4gICAgICAgICAgICBmbGV4OiAxO1xuICAgICAgICB9XG4gICAgYCxcbiAgICB0ZW1wbGF0ZTogLyogaHRtbCAqL2BcbiAgICAgICAgPGRpdiBjbGFzcz1cInJlZmxlY3Rpb24tcHJvYmUtZm9vdGVyXCI+XG4gICAgICAgICAgICA8dWktYnV0dG9uIGNsYXNzPVwiYmFrZSBibHVlXCI+QmFrZTwvdWktYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICBgLFxuICAgIGNsb3NlKCkge1xuICAgICAgICBjb25zdCBkYXRhID0gcGFuZWxEYXRhTWFwLmdldCh0aGlzKTtcbiAgICAgICAgcmVtb3ZlQnJvYWRjYXN0TGlzdGVuZXIoJ3JlZmxlY3Rpb24tcHJvYmU6dXBkYXRlLWJha2UtaW5mbycsIGRhdGEhLm9uVXBkYXRlSW5mbyEpO1xuICAgIH0sXG59KTsiXX0=