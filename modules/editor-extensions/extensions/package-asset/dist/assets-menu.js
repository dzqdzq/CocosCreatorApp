"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assetMenu=exports.dbMenu=void 0;const path_1=require("path"),utlis_1=require("./common/utlis"),{I18n:I18n}=Editor;async function DialogOpenImportZip(){const e=await Editor.Dialog.select({title:Editor.I18n.t("package-asset.import.title"),path:await Editor.Profile.getConfig("package-asset","import-path")||Editor.Project.path,filters:[{name:"Package",extensions:["zip"]}]});if(e.canceled)return;const t=e.filePaths&&e.filePaths[0];return(0,utlis_1.isPath)(t)?(await Editor.Profile.setConfig("package-asset","import-path",(0,path_1.dirname)(t)),t):void 0}function getImportMenu(e){return{label:"i18n:package-asset.menu.import",enabled:!e||!e.readonly,async click(){if(await Editor.Panel.has("package-asset.import"))return void Editor.Panel.focus("package-asset.import");const e=await DialogOpenImportZip();e&&Editor.Panel.open("package-asset.import",e)}}}function getExportMenu(e){return{label:"i18n:package-asset.menu.export",enabled:!e||!e.readonly,async click(){await Editor.Panel.has("package-asset.export")?Editor.Panel.focus("package-asset.export"):Editor.Panel.open("package-asset.export",e)}}}function getImportNewAssetMenu(e,t){const a=(e?e.url:"db://assets").replace("db://",""),s=!e||!e.readonly&&e.isDirectory;return{label:`i18n:package-asset.menu.${"directory"===t?"importNewFolders":"importNewFiles"}`,enabled:s,async click(){try{const e=await Editor.Dialog.select({title:Editor.I18n.t("package-asset.importNewAsset.title"),path:await Editor.Profile.getConfig("package-asset","import-new-asset-path")||Editor.Project.path,type:t,multi:!0});if(e.canceled)return;let s;for(let t=0;t<e.filePaths.length;t++){const i=e.filePaths[t],r=await Editor.Message.request("asset-db","import-asset",i,"db://"+(0,path_1.join)(a,(0,path_1.basename)(i)));0===t&&(s=r,await Editor.Profile.setConfig("package-asset","import-new-asset-path",(0,path_1.dirname)(i)))}s&&Editor.Message.send("assets","twinkle",s.uuid)}catch(e){console.error(e)}}}}function dbMenu(e){return[getImportNewAssetMenu(e,"file"),getImportNewAssetMenu(e,"directory"),getImportMenu(e)]}function assetMenu(e){return[getImportNewAssetMenu(e,"file"),getImportNewAssetMenu(e,"directory"),getImportMenu(e),getExportMenu(e)]}exports.dbMenu=dbMenu,exports.assetMenu=assetMenu;