"use strict";var A=require("fs-extra"),F=require("path"),e=require("../share/scripts/global.js"),k=require("../../dist/virtual-modules/Wrapper"),m=require("../../dist/virtual-modules/EventBus"),_=require("../share/scripts/TranslateItemType.js");const W={components:{mInput:_.mInput,mIcon:_.mIcon},setup(){const i=e.computed(()=>u.value?.value.node?.values?.length>1),a=e.ref("");async function N(){a.value=await Editor.Message.request("scene","query-current-scene")}const o=e.computed(()=>({sceneUuid:a.value,nodeUuid:u.value?.value.node.value.uuid,reference:a.value})),c=e.ref(""),f=e.ref([]),v=e.ref([]);function p(t){return t?t.match(/^[0-9a-zA-Z_@/+-|.]{1,}$/g)?v.value.some(l=>l.key===t)?Editor.I18n.t(e.MainName+".label_inspector.exist_media_tooltip"):"":Editor.I18n.t(e.MainName+".label_inspector.error_tooltip"):Editor.I18n.t(e.MainName+".label_inspector.cannot_empty")}const n=e.ref(!1),h=e.computed(()=>p(r.value)),w=e.ref(null);let y=null;async function V(){const t=await k.wrapper.getTranslateData();f.value=t.filter(l=>l.type!==_.TranslateItemType.Media),v.value=t.filter(l=>l.type===_.TranslateItemType.Media)}async function U(){n.value=!0,c.value="",await V(),requestAnimationFrame(()=>{w.value?.focus()})}const u=e.ref(null),x=e.computed(()=>Object.values(f.value).filter(t=>c.value===""||t.key.includes(c.value)||t.value.includes(c.value))),d=e.ref(null);function E(){const t=new Event("change-dump",{bubbles:!0,cancelable:!0});d.value?.dispatchEvent(t)}function M(t){B(t.key)}const r=e.ref("");async function T(){await N();const t=u.value?.value.key.value;t&&await k.wrapper.removeAssociation(t,o.value),await k.wrapper.addAssociation(r.value,o.value),u.value.value.key.value=r.value,E()}async function B(t){let l="";if(t===void 0)for(;p(l);)l=Editor.Utils.UUID.generate();t??=l,r.value=t}function I(){B()}async function g(t){if(u.value=t,r.value=t.value.key.value,await V(),d.value){d.value.dump=t;for(const[l,b]of Object.entries(t.value)){let s=d.value.querySelector(`ui-prop[key=${l}]`);if(s&&(s.hidden=!b.visible),b.visible){if(l==="key")continue;s||(s=document.createElement("ui-prop"),s.setAttribute("key",l),s.setAttribute("type","dump"),d.value.appendChild(s)),s.render(b)}}}}function C(t){console.error(t)}e.onMounted(()=>{m.eventBus.on("onCustomError",C),m.eventBus.on("onDumpUpdated",g)}),e.onUnmounted(()=>{m.eventBus.off("onCustomError",C),m.eventBus.off("onDumpUpdated",g)});function q(){y&&clearTimeout(y)}function K(){y=setTimeout(()=>{n.value=!1},200)}function S(t){r.value=t,B(t)}return{isButtonDisabled:e.computed(()=>r.value===u.value?.value.key.value||h.value!==""),MainName:e.MainName,isShow:n,errorTooltip:h,refNewKey:r,isMulti:i,onFocus:q,onUpdateKey:S,input:w,refDump:u,uiProps:d,list:f,onCommit:M,search:c,onClick:U,onBlur:K,filterList:x,onChangeKeyClick:I,confirmResetKey:T}}},j={class:"search",tabindex:"0"},L={class:"parent"},P=["onClick"],z={class:"container",style:{height:"22px"}},R=e.createBaseVNode("ui-label",{class:"weakerWhite",value:"value:",style:{"line-height":"16px"}},null,-1),O=["value"],Z=["value"],G={class:"container"},H=["value"],J=["value"],Q=["tooltip"],X=e.createBaseVNode("ui-label",{slot:"label",value:"Key"},null,-1),Y={slot:"content"},$={class:"container"},ee=["disabled"],te=["value"],oe=e.createBaseVNode("ui-label",{slot:"label",value:"Key"},null,-1),ne=e.createBaseVNode("ui-input",{slot:"content",disabled:"true"},null,-1),ae=[oe,ne];function le(i,a,N,o,c,f){const v=e.resolveComponent("m-input"),p=e.resolveComponent("m-icon");return e.openBlock(),e.createElementBlock("div",{class:"i18nComponent",onBlur:a[4]||(a[4]=(...n)=>o.onBlur&&o.onBlur(...n))},[e.withDirectives(e.createBaseVNode("div",j,[e.createVNode(v,{ref:"input",modelValue:o.search,"onUpdate:modelValue":a[0]||(a[0]=n=>o.search=n),onFocus:o.onFocus,onBlur:o.onBlur},null,8,["modelValue","onFocus","onBlur"]),e.createBaseVNode("div",L,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.filterList,n=>(e.openBlock(),e.createElementBlock("ui-prop",{key:n.key,class:"item",tabindex:"0",onClick:h=>o.onCommit(n)},[e.createBaseVNode("div",z,[R,e.withDirectives(e.createBaseVNode("ui-label",{value:n.value,style:{"line-height":"22px","font-size":"14px"}},null,8,O),[[e.vShow,n.value]]),e.withDirectives(e.createBaseVNode("ui-label",{class:"bitWeakWhite",i18n:"",value:o.MainName+".label_inspector.no_origin",style:{"line-height":"22px","font-size":"14px"}},null,8,Z),[[e.vShow,!n.value]])]),e.createBaseVNode("div",G,[e.createBaseVNode("ui-label",{class:"weakerWhite",style:{"line-height":"16px"},i18n:"",value:o.MainName+".label_inspector.key:"},null,8,H),e.createBaseVNode("ui-label",{class:"weakWhite",style:{"line-height":"16px"},value:n.key},null,8,J)])],8,P))),128))])],512),[[e.vShow,o.isShow]]),e.createBaseVNode("div",{ref:"uiProps",onFocus:a[1]||(a[1]=(...n)=>o.onBlur&&o.onBlur(...n))},null,544),e.withDirectives(e.createBaseVNode("ui-prop",{id:"keyProp",tooltip:o.errorTooltip,onFocus:a[3]||(a[3]=(...n)=>o.onBlur&&o.onBlur(...n))},[X,e.createBaseVNode("div",Y,[e.createVNode(v,{"model-value":o.refNewKey,error:!!o.errorTooltip,"onUpdate:modelValue":o.onUpdateKey},{default:e.withCtx(()=>[e.createBaseVNode("div",$,[e.createVNode(p,{value:"select",onClick:o.onClick},null,8,["onClick"]),e.createVNode(p,{value:"reset",onClick:o.onChangeKeyClick},null,8,["onClick"])])]),_:1},8,["model-value","error","onUpdate:modelValue"]),e.createBaseVNode("ui-button",{disabled:o.isButtonDisabled,onConfirm:a[2]||(a[2]=(...n)=>o.confirmResetKey&&o.confirmResetKey(...n))},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:o.MainName+".label_inspector.save"},null,8,te)],40,ee)])],40,Q),[[e.vShow,!o.isMulti]]),e.withDirectives(e.createBaseVNode("ui-prop",null,ae,512),[[e.vShow,o.isMulti]])],32)}var ie=e._export_sfc(W,[["render",le]]);const D=new WeakMap;module.exports=Editor.Panel.define({template:`
      <div id="app"></div>
    `,$:{app:"#app"},ready(){const i=e.createApp(ie,{}),a=this.$.app;i.mount(a),D.set(this,i)},style:A.readFileSync(F.join(__dirname,"./index.css"),{encoding:"utf8"})+e.commonCss,update(i){console.debug("update dump",i),m.eventBus.emit("onDumpUpdated",i)},close(){const i=D.get(this);i&&i.unmount()}});
