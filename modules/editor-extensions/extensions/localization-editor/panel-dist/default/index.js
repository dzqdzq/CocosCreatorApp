"use strict";var re=require("fs-extra"),I=require("path"),e=require("../share/scripts/global.js"),R=require("../../dist/virtual-modules/EventBus"),v=require("../../dist/virtual-modules/Wrapper"),Se=require("electron"),Ee=require("@electron/remote"),De=require("fs"),L=require("../share/scripts/languageMap.js"),j=require("../share/scripts/TranslateItemType.js");function we(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var ge=we(Se),Ne=we(Ee);const Le={props:{transparent:{type:Boolean,required:!1,default:!0},hasBorder:{type:Boolean,required:!1,default:!1},color:{type:String,required:!1,default:"white"},disabled:{type:Boolean,required:!1,default:!1}}},Me=["transparent","border","color","disabled"];function Fe(r,n,f,a,g,V){return e.openBlock(),e.createElementBlock("ui-button",{class:"button",transparent:f.transparent,border:f.hasBorder,color:f.color,disabled:f.disabled},[e.renderSlot(r.$slots,"default",{},void 0,!0)],8,Me)}var be=e._export_sfc(Le,[["render",Fe],["__scopeId","data-v-cd05574c"]]);const Ke={components:{"m-input":j.mInput},props:{modelValue:String,checkFileExist:Boolean,checkEmpty:Boolean,placeholder:String},emits:["blur","update:modelValue"],setup:(r,{emit:n})=>{const f=e.ref(!r.checkFileExist||re.existsSync(I.join(e.ProjectAssetPath,r.modelValue??"")));function a(V){n("update:modelValue",V)}function g(V){r.checkFileExist&&(f.value=re.existsSync(I.join(e.ProjectAssetPath,r.modelValue??"")))}return{isFileExist:f,onModelUpdate:a,onBlur:g}},computed:{showIcon(){return this.checkEmpty&&this.modelValue===""||this.checkFileExist&&!this.isFileExist},tooltip(){return this.modelValue===""&&this.checkEmpty?"i18n:"+e.MainName+".cannot_empty":"i18n:"+e.MainName+".file_no_exist"}}},Ae={class:"mFile"},Ge=["tooltip"],We=e.createTextVNode(" ! "),Oe={class:"label"};function je(r,n,f,a,g,V){const m=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",Ae,[e.withDirectives(e.createBaseVNode("ui-prop",{style:{width:"0px"},tooltip:V.tooltip},[e.renderSlot(r.$slots,"icon",{},()=>[We],!0)],8,Ge),[[e.vShow,V.showIcon]]),e.createBaseVNode("div",Oe,[e.renderSlot(r.$slots,"label",{},void 0,!0)]),e.createVNode(m,{"no-vertical-padding":"",class:"mInput",placeholder:f.placeholder,"model-value":f.modelValue,onBlur:r.onBlur,"onUpdate:modelValue":r.onModelUpdate},{default:e.withCtx(()=>[e.renderSlot(r.$slots,"inputIcon",{},void 0,!0)]),_:3},8,["placeholder","model-value","onBlur","onUpdate:modelValue"])])}var Ue=e._export_sfc(Ke,[["render",je],["__scopeId","data-v-dbbf7928"]]);const ze={props:{value:Number,color:{type:String,default:"blue"}}},qe={class:"mProcess"},He=["color"];function Xe(r,n,f,a,g,V){return e.openBlock(),e.createElementBlock("div",qe,[e.createBaseVNode("div",{class:"content",style:e.normalizeStyle({width:f.value*100+"%"}),color:f.color},null,12,He)])}var Re=e._export_sfc(ze,[["render",Xe],["__scopeId","data-v-5eada48a"]]);const Je={components:{"m-icon":j.mIcon},props:{modelValue:Boolean},setup(r,{emit:n}){function f(){n("update:modelValue",!r.modelValue)}return{clickIcon:f}}},Qe={class:"mSection"},Ye={class:"content"};function Ze(r,n,f,a,g,V){const m=e.resolveComponent("m-icon");return e.openBlock(),e.createElementBlock("div",Qe,[e.createBaseVNode("div",{class:"header",onClick:n[0]||(n[0]=(...C)=>a.clickIcon&&a.clickIcon(...C))},[e.createVNode(m,{style:{"margin-right":"2px"},class:"icon",background:!1,value:"arrow-triangle","upside-down":f.modelValue},null,8,["upside-down"]),e.renderSlot(r.$slots,"header",{},void 0,!0)]),e.withDirectives(e.createBaseVNode("div",Ye,[e.renderSlot(r.$slots,"content",{},void 0,!0)],512),[[e.vShow,f.modelValue]])])}var $e=e._export_sfc(Je,[["render",Ze],["__scopeId","data-v-460b1851"]]);class A{constructor(n){this.value=n,this.__key=`${Date.now().toString()}-${Math.random()}`}}function Ve(r,n=[]){const f=Object.keys(L.languageMap),a=["zh","en","fr","ru","ja","ko","es","ar"],g=a.map(s=>L.getLanguageDisplayName(s)),V=f.map(s=>({label:L.getLanguageDisplayName(s),sublabel:s===a[a.length-1]?Editor.I18n.t(e.MainName+".common_languages"):void 0,submenu:L.languageMap[s].map(N=>{const d=L.getLanguageDisplayName(N);return{label:d,click:()=>{r(N,d??N)},enabled:!n.includes(N)}}).filter(Boolean)})).filter(Boolean),m=V.filter(s=>g.includes(s.label)).sort((s,b)=>g.indexOf(s.label)-g.indexOf(b.label)),C=V.filter(s=>!f.find(b=>s.label===b)&&!m.includes(s)).sort((s,b)=>(s.label??"").localeCompare(b.label??"")),c=V.filter(s=>f.find(b=>s.label===b)&&!m.includes(s)).sort();Editor.Menu.popup({menu:[...m,{type:"separator"},...C,...c]})}var z=(r=>(r[r.PO=0]="PO",r[r.CSV=1]="CSV",r[r.XLSX=2]="XLSX",r))(z||{});function ye(r){let n;const f=I.extname(r);if(f===".po")n=z.PO;else if(f===".csv")n=z.CSV;else if(f===".xlsx")n=z.XLSX;else throw new Error(`[${e.MainName}]: cannot get TranslateFileType of ${r}`);return n}function ea(r){if(r===z.PO)return".po";if(r===z.CSV)return".csv";if(r===z.XLSX)return".xlsx";throw new Error(`[${e.MainName}]: cannot get ExtName of ${r}`)}class Be{constructor(n,f,a,g){this.expanded=n,this.dirs=f,this.exts=a,this.excludes=g}}const aa={components:{"m-input":j.mInput,"m-file":Ue,"m-process":Re,"m-icon":j.mIcon,"m-button":be,"m-section":$e},emits:["translate"],async setup(r,{emit:n}){e.onMounted(()=>{R.eventBus.on("scanProgress",g),R.eventBus.on("updateAllLanguageConfig",V)}),e.onUnmounted(()=>{R.eventBus.off("scanProgress",g),R.eventBus.off("updateAllLanguageConfig",V)});const f=e.computed(()=>L.getLanguageDisplayName(w.value?.bcp47Tag,"none")??""),a=e.ref(-1);function g(o,u){T.value=u&&o/u,a.value=o}async function V(){F.value=(await v.wrapper.getAllLanguageConfigs()).map(o=>new A(o)),w.value=await v.wrapper.getLocalLanguageConfig()}const m=e.ref(await v.wrapper.getTranslateProviders()),C=e.ref(!1),c=e.ref(!1),s=e.ref(await v.wrapper.getCurrentTranslateProvider());function b(o){s.value&&(c.value=!0,s.value.appKey=o)}function N(o){s.value&&(c.value=!0,s.value.appSecret=o)}async function d(o){const u=o.target.value;u==="None"?(await v.wrapper.clearTranslateProvider(),s.value=void 0,E.value=!1):s.value=await v.wrapper.getTranslateProvider(u)??{appKey:"",appSecret:"",name:u,qps:0,url:""},c.value=!0}const y=e.ref(await v.wrapper.getProviderLanguages(s.value?.name));async function p(o,u){const S=o.target.value,D=Object.entries(y.value).find(([M,U])=>U===S)?.[0];if(D){const M=F.value[u].value;M.providerTag=D,await v.wrapper.setLanguageConfig(M)}}const E=e.ref(!!s.value),P=e.computed(()=>!s.value?.appKey||!s.value?.appSecret||!c.value);async function J(){s.value&&(C.value=!0,await v.wrapper.setCurrentTranslateProvider(s.value),C.value=!1,c.value=!1,E.value=!0,y.value=await v.wrapper.getProviderLanguages(s.value?.name),V())}const Z=await v.wrapper.getScanOptions();Z.length===0&&Z.push({dirs:[""],excludes:[],extNames:[]});const x=e.ref(Z.map(o=>new A(new Be(!0,{expanded:!0,items:o.dirs.map(u=>new A(u))},{expanded:!0,items:o.extNames.map(u=>new A(u))},{expanded:!0,items:o.excludes.map(u=>new A(u))}))));function W(o){x.value.splice(o,1)}function ie(){x.value.push(new A(new Be(!0,{expanded:!0,items:[new A("")]},{expanded:!0,items:[]},{expanded:!0,items:[]})))}async function te(o,u){const S=I.join(Editor.Project.path,"assets"),D=await Editor.Dialog.select({multi:!1,type:"directory",path:S});if(!D.canceled){const M=I.relative(e.ProjectAssetPath,D.filePaths[0]);return x.value[o].value.dirs.items.find(U=>U.value===M)||(x.value[o].value.dirs.items[u].value=M),D}}async function se(o,u){const S=I.join(Editor.Project.path,"assets"),D=await Editor.Dialog.select({multi:!1,type:"directory",path:S});if(!D.canceled){const M=I.relative(e.ProjectAssetPath,D.filePaths[0]);return x.value[o].value.excludes.items.find(U=>U.value===M)||(x.value[o].value.excludes.items[u].value=M),D}}function le(o,u){x.value[o].value[u].items.push(new A("")),x.value[o].value[u].expanded=!0}function ce(o,u,S){x.value[o].value[S].items.splice(u,1)}const T=e.ref(-1),q=e.ref(!1),Q=e.computed(()=>x.value.some(o=>o.value.dirs.items.some(u=>!Editor.Utils.Path.contains(e.ProjectAssetPath,I.join(e.ProjectAssetPath,u.value))||!De.existsSync(I.join(e.ProjectAssetPath,u.value))))),O=e.computed(()=>Q.value||q.value||!x.value.length||!w.value);async function de(){return q.value=!0,a.value=0,T.value=0,await v.wrapper.scan(x.value.map(o=>({dirs:o.value.dirs.items.map(u=>u.value),extNames:o.value.exts.items.map(u=>u.value),excludes:o.value.excludes.items.map(u=>u.value)}))),T.value=-1,q.value=!1,V()}const H=e.ref([]);async function ee(){const o=await Editor.Dialog.select({extensions:"po"});if(!o.canceled){const u=o.filePaths.filter(S=>!H.value.find(D=>D.value===S));H.value.push(...u.map(S=>new A(S)))}}function ue(o){H.value.splice(o,1)}const F=e.ref((await v.wrapper.getAllLanguageConfigs()).map(o=>new A(o)));console.debug("All language data",F);const w=e.ref(await v.wrapper.getLocalLanguageConfig());console.debug("Data for the current language",w);function pe(o){n("translate",F.value[o].value.bcp47Tag)}async function ne(o){const u=F.value[o].value.bcp47Tag;await v.wrapper.previewBy(u),await Editor.Panel.focus("scene")}async function ve(o){await v.wrapper.removeLanguage(F.value[o].value.bcp47Tag)!==!1&&await V()}async function me(o){let u,S;const D=F.value[o].value.bcp47Tag,M=await i(),U=I.extname(M),Pe=I.join(I.dirname(M),`${D}${U||".po"}`),he=await Editor.Dialog.save({filters:[{name:Editor.I18n.t(`${L.name}.home.po_name`),extensions:["po"]},{name:Editor.I18n.t(`${L.name}.home.csv_name`),extensions:["csv"]},{name:Editor.I18n.t(`${L.name}.home.xlsx_name`),extensions:["xlsx"]}],path:Pe});!he.canceled&&he.filePath&&(u=he.filePath,h(u),S=ye(u),await v.wrapper.exportTranslateFile(u,S,D),Ne.default.shell.showItemInFolder(u))}const ae="panel.default-home",t=`${ae}.lastFile`,l=`${ae}.lastDir`;async function i(){return await Editor.Profile.getTemp(L.name,t)||""}async function _(){return await Editor.Profile.getTemp(L.name,l)||""}function h(o){Editor.Profile.setTemp(L.name,t,o)}function B(o){Editor.Profile.setTemp(L.name,l,o)}async function k(){const o=await Editor.Dialog.select({type:"directory",multi:!1,path:await _()});if(!o.canceled){const u=o.filePaths[0];return B(u),u}return""}async function K(o,u){let S;await Promise.all(F.value.map(async D=>{const M=ea(u),U=I.join(o,`${D.value.bcp47Tag}${M}`);return S||(S=U),await v.wrapper.exportTranslateFile(U,u,D.value.bcp47Tag)})),S&&Ne.default.shell.showItemInFolder(S)}async function X(){Editor.Menu.popup({menu:[{label:"po",async click(){const o=await k();o&&await K(o,z.PO)}},{label:"csv",async click(){const o=await k();o&&await K(o,z.CSV)}},{label:"xlsx",async click(){const o=await k();o&&await K(o,z.XLSX)}}]})}function Y(){Ve(async(o,u)=>{await v.wrapper.addTargetLanguage(o),await V()},F.value.map(o=>o.value.bcp47Tag))}function _e(){Ve(async o=>{await v.wrapper.setLocalLanguage(o),await V()},[w?.value?.bcp47Tag??""])}function fe(o){return w.value?.translateTotal?o.value.translateFinished/w.value.translateTotal:0}function Ce(o){return w.value?`${w.value.translateTotal&&Math.floor(o.value.translateFinished*100/w.value.translateTotal)}%(${v.wrapper.numberFormat(o.value.translateFinished)}/${v.wrapper.numberFormat(w.value.translateTotal)})`:"0%"}function xe(o){o==="i18n"?ge.default.shell.openExternal("https://docs.cocos.com/creator/manual/zh/editor/l10n/overview.html"):ge.default.shell.openExternal("https://docs.cocos.com/creator/manual/zh/editor/l10n/collect-and-count.html")}function Te(){Editor.Menu.popup({menu:[{label:Editor.I18n.t("localization-editor.home.turn_off"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.turn_off_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")]})).response!==1&&(await Ie(),await V())}},{label:Editor.I18n.t("localization-editor.home.delete_data"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.delete_data_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")],cancel:1})).response!==1&&await v.wrapper.uninstall()}}]})}async function Ie(){n("toggle",await v.wrapper.toggle())}return{onExportAllClick:X,onMenuClick:Te,currentCollectCount:a,isCurrentServiceDirty:c,isCurrentServiceLoading:C,onAppKeyUpdate:b,onAppSecretUpdate:N,onLinkClick:xe,onSelectNewLanguageClick:Y,hasService:E,isCurrentServiceDisabled:P,getTranslateProcessDescription:Ce,isCollecting:q,isCollectingHasWrongDir:Q,isCollectionDisabled:O,collectionProgress:T,projectAssetPath:e.ref("db://assets/"),onSelectExcludeDirClick:se,onSelectLocalClick:_e,onScanClick:de,currentService:s,onProviderSummitClick:J,onSetCurrentTranslateProvider:d,currentLanguage:w,onAddCollectionClick:ie,onRemoveCollectionClick:W,collections:x,onAddToCollectionClick:le,onSelectCollectionDirClick:te,onRemoveFromCollectionClick:ce,PKGName:L.name,importedPOfiles:H,onImportPOClick:ee,onRemovePOClick:ue,panelTranslateDataList:F,providerLanguages:y,supportedServices:m,onTranslateClick:pe,onPreviewClick:ne,onDeleteClick:ve,onExportClick:me,onProviderLanguageSelect:p,t:Editor.I18n.t,currentLanguageDisplayName:f,numberFormat:v.wrapper.numberFormat.bind(v.wrapper),getTranslateProcess:fe}}},G=r=>(e.pushScopeId("data-v-2b20646e"),r=r(),e.popScopeId(),r),ta={ref:"rootElement",class:"home"},la={ref:"bodyElement",class:"body"},na={class:"main"},oa={class:"title"},ra=G(()=>e.createBaseVNode("ui-label",{class:"strongWhite"}," L10N ",-1)),ia={ref:"serviceElement",class:"container service"},sa=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),ca=["value"],da={class:"gray service"},ua={class:"container"},va={class:"left container"},ma=["value"],_a=G(()=>e.createBaseVNode("span",null,":",-1)),fa=["value"],ha=G(()=>e.createBaseVNode("option",null,"None",-1)),pa=["value"],ga={key:0,class:"container"},Na=G(()=>e.createBaseVNode("ui-label",{class:"left"}," AppKey: ",-1)),Va={key:1,class:"container"},Ba=G(()=>e.createBaseVNode("ui-label",{class:"left"}," AppSecret: ",-1)),ka={key:0,style:{"margin-top":"3px"}},wa=["value"],ba=["value"],ya=["value"],Ca={ref:"collectionElement",class:"container collect"},xa=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),Ta=["value"],Ia={class:"gray collect"},Pa={class:"container",style:{"margin-bottom":"20px"}},Sa=G(()=>e.createBaseVNode("ui-label",{class:"red",style:{"margin-right":"0px"}}," * ",-1)),Ea=["value"],Da=["placeholder"],La=["value"],Ma={class:"container",style:{"margin-bottom":"5px"}},Fa={style:{flex:"1"},class:"container"},Ka=["value"],Aa=["value"],Ga={style:{flex:"1"}},Wa=["value"],Oa=["value"],ja=e.createTextVNode(" + "),Ua={class:"parent"},za=["value"],qa={class:"weakWhite",style:{"margin-right":"28px"}},Ha={class:"weakWhite",style:{"margin-right":"8px"}},Xa=["value"],Ra=e.createTextVNode(" + "),Ja={class:"parent"},Qa=["value"],Ya={class:"weakWhite",style:{"margin-right":"28px"}},Za=G(()=>e.createBaseVNode("ui-label",{style:{"margin-right":"8px"}}," *. ",-1)),$a=["value"],et=e.createTextVNode(" + "),at={class:"parent"},tt=["value"],lt={class:"weakWhite",style:{"margin-right":"28px"}},nt={class:"weakWhite",style:{"margin-right":"8px"}},ot={class:"container",style:{"margin-top":"62px"}},rt=["value"],it=["value"],st=["value"],ct=["value"],dt=["value"],ut=["value"],vt={ref:"languageElement",class:"container language"},mt=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),_t=["value"],ft={class:"gray language"},ht={class:"container",style:{"margin-bottom":"16px"}},pt=["value"],gt=["disabled"],Nt=["value"],Vt=["value"],Bt=["value"],kt=["value"],wt=["value"],bt=["value"],yt=["value"],Ct=["value"],xt={key:0},Tt=["placeholder","value","onConfirm"],It={key:1},Pt=G(()=>e.createBaseVNode("ui-select",{disabled:""},null,-1)),St=[Pt],Et={class:"container"},Dt=["tooltip","value"],Lt=["value"],Mt=["value"],Ft=["value"],Kt=["value"],At=["value"],Gt=["value"],Wt=["placeholder"],Ot={class:"container"},jt=G(()=>e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray"}," - ")],-1)),Ut={class:"container",style:{"flex-direction":"row-reverse","margin-top":"32px"}},zt=["value"];function qt(r,n,f,a,g,V){const m=e.resolveComponent("m-icon"),C=e.resolveComponent("m-input"),c=e.resolveComponent("m-button"),s=e.resolveComponent("m-file"),b=e.resolveComponent("m-section"),N=e.resolveComponent("m-process");return e.openBlock(),e.createElementBlock("div",ta,[e.createBaseVNode("div",la,[e.createBaseVNode("div",na,[e.createBaseVNode("div",oa,[ra,e.createVNode(m,{style:{"margin-left":"5.5px",display:"inline-flex"},value:"help",onClick:n[0]||(n[0]=d=>a.onLinkClick("i18n"))}),e.createVNode(m,{value:"menu",style:{"margin-left":"auto"},onClick:n[1]||(n[1]=d=>a.onMenuClick())})]),e.createBaseVNode("div",ia,[sa,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".service_provider"},null,8,ca)],512),e.createBaseVNode("div",da,[e.createBaseVNode("div",ua,[e.createBaseVNode("div",va,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".service_provider"},null,8,ma),_a]),e.createBaseVNode("ui-select",{value:a.currentService?.name||"None",onConfirm:n[2]||(n[2]=(...d)=>a.onSetCurrentTranslateProvider&&a.onSetCurrentTranslateProvider(...d))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.supportedServices,d=>(e.openBlock(),e.createElementBlock("option",{key:d},e.toDisplayString(d),1))),128)),ha],40,fa),e.withDirectives(e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray",i18n:"",value:a.PKGName+".unselect_service_tip"},null,8,pa),[[e.vShow,!a.currentService]])]),a.currentService?(e.openBlock(),e.createElementBlock("div",ga,[Na,e.createVNode(C,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appKey,"onUpdate:modelValue":n[3]||(n[3]=d=>a.onAppKeyUpdate(d))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",Va,[Ba,e.createVNode(C,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appSecret,"onUpdate:modelValue":n[4]||(n[4]=d=>a.onAppSecretUpdate(d))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",{key:2,class:"footer",onConfirm:n[5]||(n[5]=(...d)=>a.onProviderSummitClick&&a.onProviderSummitClick(...d))},[e.createVNode(c,{"has-border":!0,color:"blue",disabled:a.isCurrentServiceDisabled},{default:e.withCtx(()=>[a.isCurrentServiceLoading?(e.openBlock(),e.createElementBlock("ui-loading",ka)):a.isCurrentServiceDirty?(e.openBlock(),e.createElementBlock("ui-label",{key:1,i18n:"",color:"",value:a.PKGName+".home.save"},null,8,wa)):a.hasService?(e.openBlock(),e.createElementBlock("ui-label",{key:2,i18n:"",value:a.PKGName+".home.complete",color:""},null,8,ba)):(e.openBlock(),e.createElementBlock("ui-label",{key:3,i18n:"",value:a.PKGName+".home.save",color:""},null,8,ya))]),_:1},8,["disabled"])],32)):e.createCommentVNode("",!0)]),e.createBaseVNode("div",Ca,[xa,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".collection"},null,8,Ta)],512),e.createBaseVNode("div",Ia,[e.createBaseVNode("div",Pa,[Sa,e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".local_language"},null,8,Ea),e.createBaseVNode("ui-select",{placeholder:a.currentLanguageDisplayName||"i18n:"+a.PKGName+".home.select",style:{"margin-right":"17px"},onMousedown:n[6]||(n[6]=e.withModifiers((...d)=>a.onSelectLocalClick&&a.onSelectLocalClick(...d),["prevent"]))},null,40,Da),e.withDirectives(e.createBaseVNode("ui-label",{class:"red",i18n:"",value:a.PKGName+".home.required"},null,8,La),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",Ma,[e.createBaseVNode("div",Fa,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".collected_from_resource_files"},null,8,Ka),e.createVNode(m,{value:"help",onClick:n[7]||(n[7]=d=>a.onLinkClick("collection"))})]),e.createBaseVNode("ui-button",{onClick:n[8]||(n[8]=e.withModifiers(()=>{},["stop"])),onConfirm:n[9]||(n[9]=d=>a.onAddCollectionClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add"},null,8,Aa)],32)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.collections,(d,y)=>(e.openBlock(),e.createBlock(b,{key:d.__key,modelValue:d.value.expanded,"onUpdate:modelValue":p=>d.value.expanded=p,class:"frame",style:{"padding-right":"15px"}},{header:e.withCtx(()=>[e.createBaseVNode("div",Ga,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.collect_group"},null,8,Wa),e.createBaseVNode("ui-label",null,e.toDisplayString(y+1),1)]),e.createVNode(m,{value:"del",onClick:e.withModifiers(p=>a.onRemoveCollectionClick(y),["stop"])},null,8,["onClick"])]),content:e.withCtx(()=>[e.createVNode(b,{modelValue:d.value.dirs.expanded,"onUpdate:modelValue":p=>d.value.dirs.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.search_dir"},null,8,Oa),e.createVNode(m,{onClick:[n[10]||(n[10]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(y,"dirs")]},{default:e.withCtx(()=>[ja]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.dirs.items,(p,E)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(s,{modelValue:p.value,"onUpdate:modelValue":P=>p.value=P,"check-file-exist":!0,style:{}},{icon:e.withCtx(()=>[e.createVNode(m,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",Ua,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.dir"},null,8,za),e.createBaseVNode("ui-label",qa,e.toDisplayString(E+1),1)]),e.createBaseVNode("ui-label",Ha,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(m,{value:"folder-open",onClick:P=>a.onSelectCollectionDirClick(y,E)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(m,{style:e.normalizeStyle({visibility:d.value.dirs.items.length>=2?void 0:"hidden"}),value:"del",onClick:P=>a.onRemoveFromCollectionClick(y,E,"dirs")},null,8,["style","onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(b,{modelValue:d.value.exts.expanded,"onUpdate:modelValue":p=>d.value.exts.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.extname"},null,8,Xa),e.createVNode(m,{onClick:[n[11]||(n[11]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(y,"exts")]},{default:e.withCtx(()=>[Ra]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.exts.items,(p,E)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(s,{modelValue:p.value,"onUpdate:modelValue":P=>p.value=P,"check-empty":!0},{icon:e.withCtx(()=>[e.createVNode(m,{color:"true",value:"warn-triangle",style:{"margin-right":"2px"}})]),label:e.withCtx(()=>[e.createBaseVNode("span",Ja,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.extname"},null,8,Qa),e.createBaseVNode("ui-label",Ya,e.toDisplayString(E+1),1)]),Za])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(m,{value:"del",onClick:P=>a.onRemoveFromCollectionClick(y,E,"exts")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(b,{modelValue:d.value.excludes.expanded,"onUpdate:modelValue":p=>d.value.excludes.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.exclude_path"},null,8,$a),e.createVNode(m,{onClick:[n[12]||(n[12]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(y,"excludes")]},{default:e.withCtx(()=>[et]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.excludes.items,(p,E)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(s,{modelValue:p.value,"onUpdate:modelValue":P=>p.value=P,"check-file-exist":!0},{icon:e.withCtx(()=>[e.createVNode(m,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",at,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.exclude_path"},null,8,tt),e.createBaseVNode("ui-label",lt,e.toDisplayString(E+1),1)]),e.createBaseVNode("ui-label",nt,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(m,{value:"folder-open",onClick:P=>a.onSelectExcludeDirClick(y,E)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(m,{value:"del",onClick:P=>a.onRemoveFromCollectionClick(y,E,"excludes")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128)),e.createBaseVNode("div",ot,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.count"},null,8,rt),e.withDirectives(e.createVNode(N,{value:a.collectionProgress},null,8,["value"]),[[e.vShow,a.collectionProgress!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.numberFormat(a.currentCollectCount)},null,8,it),[[e.vShow,a.currentCollectCount!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.currentLanguage?.translateTotal?a.numberFormat(a.currentLanguage?.translateTotal):""},null,8,st),[[e.vShow,a.currentCollectCount===-1&&a.currentLanguage?.translateTotal]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},class:"weakGray",i18n:"",value:a.PKGName+".home.not_recorded"},null,8,ct),[[e.vShow,a.currentCollectCount===-1&&!a.currentLanguage?.translateTotal]]),e.createVNode(c,{color:"blue",disabled:a.isCollectionDisabled,"has-border":!0,style:{"min-width":"125px"},onConfirm:a.onScanClick},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collecting"},null,8,dt),[[e.vShow,a.isCollecting]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collect_and_count"},null,8,ut),[[e.vShow,!a.isCollecting]])]),_:1},8,["disabled","onConfirm"])])]),e.createBaseVNode("div",vt,[mt,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".language_compilation"},null,8,_t)],512),e.createBaseVNode("div",ft,[e.createBaseVNode("div",ht,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.language:",style:{"margin-right":"8px"}},null,8,pt),e.createBaseVNode("ui-button",{disabled:!a.currentLanguage,onConfirm:n[13]||(n[13]=d=>a.onSelectNewLanguageClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add_new_language"},null,8,Nt)],40,gt)]),e.createBaseVNode("table",null,[e.createBaseVNode("tr",null,[e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language"},null,8,Vt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language_for_service_provider"},null,8,Bt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.translate_process"},null,8,kt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.operation"},null,8,wt)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.panelTranslateDataList,(d,y)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",{key:d.value.bcp47Tag},[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{value:d.value.displayName},null,8,bt),e.createBaseVNode("ui-label",{class:"weakWhite",value:`(${d.value.bcp47Tag})`},null,8,yt),e.withDirectives(e.createBaseVNode("ui-label",{style:{display:"block"},class:"weakWhite",i18n:"",value:a.PKGName+".home.local_language"},null,8,Ct),[[e.vShow,d.value.bcp47Tag===a.currentLanguage?.bcp47Tag]])]),a.hasService?(e.openBlock(),e.createElementBlock("td",xt,[e.createBaseVNode("ui-select",{placeholder:a.providerLanguages[d.value.providerTag]?"":"i18n:"+a.PKGName+".home.select",value:a.providerLanguages[d.value.providerTag],onConfirm:p=>a.onProviderLanguageSelect(p,y)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.providerLanguages,(p,E)=>(e.openBlock(),e.createElementBlock("option",{key:E},e.toDisplayString(p),1))),128))],40,Tt)])):(e.openBlock(),e.createElementBlock("td",It,St)),e.createBaseVNode("td",null,[e.createBaseVNode("div",Et,[e.createVNode(N,{value:a.getTranslateProcess(d),color:"blue"},null,8,["value"]),e.createBaseVNode("ui-label",{tooltip:"i18n:"+a.PKGName+".home.combine_tooltip",value:a.getTranslateProcessDescription(d)},null,8,Dt)])]),e.createBaseVNode("td",null,[e.createVNode(c,{color:"blue",onConfirm:p=>a.onTranslateClick(y)},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.complement"},null,8,Lt),[[e.vShow,d.value.bcp47Tag===a.currentLanguage?.bcp47Tag]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.translate"},null,8,Mt),[[e.vShow,d.value.bcp47Tag!==a.currentLanguage?.bcp47Tag]])]),_:2},1032,["onConfirm"]),e.createVNode(c,{color:"blue",disabled:!d.value.translateFinished,onConfirm:p=>a.onPreviewClick(y)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.preview"},null,8,Ft)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(c,{color:"blue",disabled:!d.value.translateFinished,onConfirm:p=>a.onExportClick(y)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export"},null,8,Kt)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(c,{color:"blue",disabled:d.value.bcp47Tag===a.currentLanguage?.bcp47Tag,onConfirm:p=>a.onDeleteClick(y)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.delete"},null,8,At)]),_:2},1032,["disabled","onConfirm"])])])),[[e.vShow,a.currentLanguage]])),128)),e.withDirectives(e.createBaseVNode("tr",null,[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{class:"weakGray",i18n:"",value:a.PKGName+".home.unselect"},null,8,Gt)]),e.createBaseVNode("td",null,[e.createBaseVNode("ui-select",{disabled:"",placeholder:"i18n:"+a.PKGName+".home.select"},null,8,Wt)]),e.createBaseVNode("td",null,[e.createBaseVNode("div",Ot,[e.createVNode(N,{value:0})])]),jt],512),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",Ut,[e.createVNode(c,{color:"blue",transparent:!0,"has-border":!0,disabled:!a.currentLanguage,onConfirm:n[14]||(n[14]=d=>a.onExportAllClick())},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export_all"},null,8,zt)]),_:1},8,["disabled"])])])])],512)],512)}var Ht=e._export_sfc(aa,[["render",qt],["__scopeId","data-v-2b20646e"]]);const oe=["untranslated","translated","imported"],Xt={components:{"m-button":be,"m-input":j.mInput},props:{targetLocale:{type:String,required:!0}},emits:["home"],async setup(r,{emit:n}){const f=!!await v.wrapper.getCurrentTranslateProvider(),a=e.computed(()=>d.value?.locale===r.targetLocale),g=e.computed(()=>c.value==="untranslated"?m.value:c.value==="translated"?C.value:c.value==="imported"?Object.values(w.value):[]),V=await v.wrapper.getIndexData(),m=e.computed(()=>{const t=T.value?.items??{},l=d.value?.items??{},i=Object.keys(t);return a.value?Object.values(t).filter(_=>_&&!_.value):Object.keys(l).filter(_=>!i.includes(_)&&l[_]?.value).map(_=>l[_])}),C=e.computed(()=>{const t=T.value?.items??{},l=d.value?.items??{},i=Object.keys(t).reverse();return a.value?Object.values(t).filter(_=>_?.value):i.filter(_=>l[_]?.value).map(_=>l[_])}),c=e.ref("untranslated"),s=e.ref({});function b(t,l,i,_,h,B=[]){const k=s.value[t.key]??=new v.WrapperTranslateItem(t.key,l,t.type,i,_,B,h);k.value=l,i&&(k.displayName=i),_&&(k.assetInfo=_),h&&(k._variants=h),B&&(k.associations=B)}const N=e.ref(null),d=e.ref(await $.getPanelTranslateData());async function y(){d.value=await $.getPanelTranslateData()}function p(){return Object.keys(s.value).length}async function E(){await J()}let P=!1;async function J(t,l){l??={},l.mergeOptions??={replaceVariant:P},["untranslated","translated"].includes(c.value)?await Z(t,l):(p()&&await Z(),await ce(t,l))}async function Z(t,l){if(t??=s.value,console.debug("onSaveClick",t),v.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{q()}),t===s.value)s.value={};else if(t instanceof Array)for(let i=0;i<t.length;i++){const _=t[i];delete s.value[_.key]}P=!1}const x=e.ref([]),W=e.ref(new Set);function ie(t,l){t?W.value.add(l):W.value.delete(l)}const te=e.computed({get(){const t=x.value.length;return W.value.size===t},set(t){if(t)for(let l=0;l<x.value.length;l++)W.value.add(l);else W.value.clear()}});function se(t){te.value=t}function le(t,l){if(v.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{q(),y()}),!a.value){const i=Object.values(d.value.items),_=t.filter(h=>!i.some(B=>B?.key===h.key));_.length&&v.wrapper.saveTranslateData(d.value.bcp47Tag,_,l?.mergeOptions).then(h=>{y()})}for(let i=0;i<t.length;i++){const _=t[i];delete w.value[_.key]}P=!1}async function ce(t,l){if(t??=Object.values(w.value),t){const i=Object.values(T.value.items);x.value=t.filter(h=>i.some(B=>B?.key===h.key));const _=t.filter(h=>!i.some(B=>B?.key===h.key));_.length&&le(_,l),l?.force&&(le(t,l),W.value.clear(),x.value=[])}}const T=e.ref(await $.getPanelTranslateData(r.targetLocale));async function q(t){if(t){console.debug("translateResult",t);for(let l=0;l<t.length;l++){const i=t[l],_=s.value[i.key]||T.value.items[i.key];s.value[i.key]=new v.WrapperTranslateItem(i.key,i.value,i.type,i.displayName||v.WrapperTranslateItem.getDisplayName({item:i,assetInfo:_?.assetInfo||i.assetInfo}),_?.assetInfo,i.associations)}}else console.debug("update target translate data get translate data"),T.value=await $.getPanelTranslateData(r.targetLocale)}const Q=e.ref(Wn[T.value.bcp47Tag.split("-")[0]]??["other"]),O=e.ref(null),de=e.computed(()=>{const t=Object.values(d.value.items).filter(l=>l&&l.type===j.TranslateItemType.Media);if(t.length===0)return!1;for(const l of t)if(!(s.value[l.key]??T.value.items[l.key])?.value)return!0;return!1}),H=e.ref(null);async function ee(t){if(p()){if((await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.unsaved_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===0)return!1;J(void 0,{force:!0})}return await t(),!0}function ue(t,l,i){H.value&&clearTimeout(H.value),l?O.value=t:c.value==="imported"?O.value=w.value[t.key]??t:O.value=s.value[t.key]??T.value?.items[t.key]??t}function F(t){H.value=setTimeout(()=>{O.value=null},400)}const w=e.ref({}),ne="default-translate.importFile";async function ve(){return await Editor.Profile.getTemp(e.MainName,ne)||""}function me(t){Editor.Profile.setTemp(e.MainName,ne,t)}function ae(t){if(c.value!==oe[t])switch(t){case 0:case 1:case 2:c.value=oe[t];break;default:c.value=oe[0];break}}return{isConflictSelectAll:te,onConflictItemClick:ie,onConflictItemSelectAllClick:se,selectedConflictItemIndexSet:W,conflictItemsBetweenImportedFilesAndTranslatedFiles:x,importedTranslateItemMap:w,MainName:e.MainName,hasTranslateProvider:f,onItemBlur:F,onItemMouseDown:ue,isTargetTranslateDataHasEmptyMedia:de,currentTranslateDataItems:g,currentSelectedItem:O,isSameLanguage:a,untranslatedTranslateDataItems:m,translatedTranslateDataItems:C,getDisplayNameOfTargetItem(t){let l;if(c.value==="imported")l=w.value[t];else{const i=s.value[t],_=T.value?.items[t];l=i??_}return l?l.type===j.TranslateItemType.Media?l?.displayName??t:l?.value??"":""},getDisplayNameOfLocalItem(t){let l;return c.value==="imported"?(l=d.value?.items[t]??w.value[t],l.value):(l=d.value?.items[t],l?.type===j.TranslateItemType.Media?l.displayName||t:a.value?t:l?.displayName||"")},positionOfAssociation:e.computed(()=>{if(!O.value)return[];const t=V.find(i=>i.key===O.value.key);if(!t)return[];const l=t.associations.filter(i=>i.assetInfo).map(i=>I.relative(Editor.Project.path,i.assetInfo.file));return Array.from(new Set(l)).map(i=>new A(i))}),nodeUuidOfAssociation:e.computed(()=>{if(!O.value)return[];const t=V.find(l=>l.key===O.value.key);return t?Array.from(new Set(t.associations.filter(l=>l.nodeUuid).map(l=>l.nodeUuid))).map(l=>new A(l)):[]}),onSaveClick:E,targetPanelTranslateData:T,localPanelTranslateData:d,currentVariantsItem:N,changedTranslateItemMap:s,TranslateItemType:e.ref(j.TranslateItemType),onTabClick:ae,importedTranslateData:e.ref([]),currentTab:c,Tab:e.ref(oe),async onInputChanged(t,l){let i;if(c.value==="imported"){const _=w.value[t];_.value=l;return}else i=s.value[t]??T.value?.items[t]??d.value?.items[t];if(!i){console.error(`cannot find item with key ${t}`);return}if(i.type===j.TranslateItemType.Media)if(l==="")b(i,"","",void 0,i._variants,i.associations);else{const _=d.value?.items[t];if(!_){console.error(`cannot find item with key ${t} from local`);return}const h=await v.wrapper.getFileInfoByUUIDOrPath(I.join(e.ProjectAssetPath,l));h&&I.extname(_.displayName||"")===I.extname(l)&&b(i,h.uuid,v.WrapperTranslateItem.getDisplayName({item:i,assetInfo:h}),h,i._variants,i.associations)}else b(i,l,v.WrapperTranslateItem.getDisplayName({item:i,value:l}),null,i._variants,i.associations)},async onTranslateClick(){await ee(async()=>{q(await v.wrapper.autoTranslate(T.value.locale))})},variantKeys:Q,onVariantsClick(t){const l=T.value?.items[t],i=s.value[t],_=w.value[t];if(c.value==="imported"&&_)N.value=v.WrapperTranslateItem.parse(_);else if(i)N.value=v.WrapperTranslateItem.parse(i);else if(l)N.value=v.WrapperTranslateItem.parse(l);else{console.error("An item that does not have a value should not be able to set variations",`key:${t}`);return}for(let B=0;B<Q.value.length;B++){const k=Q.value[B],K=`${t}_${k}`;l?._variants.find(Y=>Y.key===K)||N.value._variants.push(new v.WrapperTranslateItem(K,"",N.value.type,"",null,void 0,void 0,!0))}function h(B){const k=B.split("_");if(k.length){const K=k[k.length-1];return Q.value.findIndex(X=>X===K)}else return-1}N.value._variants=N.value._variants.sort((B,k)=>h(B.key)-h(k.key))},onVariantsConfirm(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value._variants=N.value._variants.filter(t=>t.value),P=!0,J([N.value],{mergeOptions:{replaceVariant:!0}}),N.value=null},onVariantsCancel(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value=null},async onVariantsDelete(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}(await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.delete_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")]})).response===1&&(N.value._variants=[],P=!0,await J([N.value])),N.value=null},isVariantsDisable(t){if(c.value==="imported")return!1;{const l=s.value[t],i=T.value?.items[t];return l?.value===""||!l&&!i?.value}},isDeleteVariantsDisable:e.computed(()=>!N.value?._variants.some(t=>t.value)),async onImportAllClick(){await ee(async()=>{const t=d.value.locale,l=m.value.filter(h=>h?.type===j.TranslateItemType.Media).length,i=Editor.I18n.t(e.MainName+".translate.auto_import_warning").replace("{length}",l.toString()).replace("{localLocale}",t).replace("{targetLocale}",r.targetLocale);if((await Editor.Dialog.info(i,{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response){const h=await v.wrapper.importFilesFromDirectory(r.targetLocale,t,r.targetLocale);q(h)}})},async onFileInputClick(){await ee(async()=>{ae(2);const t=await Editor.Dialog.select({extensions:"po,csv,xlsx",multi:!1,path:await ve()});if(!t.canceled){const l=t.filePaths[0];me(l);const i=ye(l),_=T.value.bcp47Tag;let h=await v.wrapper.importTranslateFile(l,i,_);const B=h.filter(k=>w.value[k.key]);if(B.length){const X=(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.import_file_conflicts_with_file_warning").replace("{num}",B.length.toString()),{buttons:[Editor.I18n.t(e.MainName+".translate.jump"),Editor.I18n.t(e.MainName+".translate.cover"),Editor.I18n.t(e.MainName+".translate.cancel")],cancel:2})).response;if(X===0)h=h.filter(Y=>!B.includes(Y)).concat(B);else if(X===1){const Y=Object.values(w.value).filter(_e=>!B.some(fe=>fe.key===_e.key));h=h.concat(Y)}else if(X===2)return}for(let k=0;k<h.length;k++){const K=h[k];w.value[K.key]=K}}})},async onImportClick(t){const l=d.value.items[t]??s.value[t]??T.value?.items[t];if(!l?.assetInfo){console.error(`[${e.MainName}]: item has not assetInfo`,l);return}const i=I.extname(l.assetInfo.file).replace(".",""),_=await Editor.Dialog.select({multi:!1,path:e.ProjectAssetPath,type:"file",extensions:i});if(!_.canceled){const h=await v.wrapper.getFileInfoByUUIDOrPath(_.filePaths[0]);if(h){const B=h.uuid,k=v.WrapperTranslateItem.getDisplayName({assetInfo:h});b(l,B,k,h,l._variants,l.associations)}else console.error("A non-project resource was selected,please select another resource.")}},onConflictCancelClick(){x.value=[],W.value.clear(),P=!1},async onConflictConfirmClick(){await J(Array.from(W.value).map(t=>x.value[t]),{force:!0})},async onHomeClick(){Object.keys(s.value).length>0?(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.quit_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===1&&n("home"):n("home")}}}},Rt={class:"translate"},Jt={class:"toolbar container"},Qt=e.createBaseVNode("ui-icon",{value:"arrow-triangle",style:{transform:"rotate(90deg)"}},null,-1),Yt=e.createBaseVNode("ui-icon",{value:"import"},null,-1),Zt=["value"],$t=e.createBaseVNode("ui-icon",{style:{display:"inline-block","margin-right":"4px"},value:"save"},null,-1),el=["value"],al={class:"tabs container"},tl=["value"],ll=["value"],nl=["value"],ol=["value"],rl=["value"],il={class:"div"},sl={class:"table"},cl={class:"tr head"},dl={class:"th"},ul={tabindex:"0"},vl={class:"container"},ml=["value"],_l=["value"],fl={class:"th"},hl={tabindex:"0"},pl={class:"container"},gl=["value"],Nl=["value"],Vl=["value"],Bl=["value"],kl={class:"td",tabindex:"0"},wl={class:"td"},bl={class:"container"},yl=["value"],Cl=["value"],xl=["value"],Tl=["value"],Il=["value"],Pl=["value"],Sl=["value"],El=["value"],Dl={key:0,class:"variants"},Ll={class:"header"},Ml=["value"],Fl={class:"body"},Kl={class:"tr"},Al={class:"th"},Gl={tabindex:"0"},Wl=["value"],Ol={class:"th"},jl={tabindex:"0",class:"container"},Ul=["value"],zl={class:"td"},ql={class:"td"},Hl={class:"container"},Xl={class:"footer"},Rl={class:"container"},Jl={style:{flex:"1"}},Ql=["value"],Yl=["value"],Zl=["value"],$l={class:"conflict"},en={class:"content"},an={class:"header"},tn=["value"],ln={class:"body"},nn=["value"],on={class:"table"},rn={class:"tr head"},sn={class:"th"},cn=["value"],dn={class:"th"},un=["value"],vn={class:"th"},mn=["value"],_n={class:"th"},fn=["value"],hn={class:"td"},pn=["value","onChange"],gn={class:"td"},Nn=["value"],Vn={class:"td"},Bn=["value"],kn={class:"td"},wn=["value"],bn={class:"footer"},yn=["value"],Cn=["value"];function xn(r,n,f,a,g,V){const m=e.resolveComponent("m-button"),C=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",Rt,[e.createBaseVNode("head",null,[e.createBaseVNode("div",Jt,[e.createVNode(m,{onConfirm:a.onHomeClick},{default:e.withCtx(()=>[Qt]),_:1},8,["onConfirm"]),e.createVNode(m,{onConfirm:a.onFileInputClick},{default:e.withCtx(()=>[Yt,e.createBaseVNode("ui-label",{color:"",i18n:"",value:`${a.MainName}.translate.import_file`},null,8,Zt)]),_:1},8,["onConfirm"]),e.createVNode(m,{onConfirm:a.onSaveClick},{default:e.withCtx(()=>[$t,e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.save"},null,8,el)]),_:1},8,["onConfirm"])])]),e.createBaseVNode("body",null,[e.createBaseVNode("div",al,[e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[0]}]),onClick:n[0]||(n[0]=c=>a.onTabClick(0))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.unfilled"},null,8,tl),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.untranslated"},null,8,ll),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[1]}]),onClick:n[1]||(n[1]=c=>a.onTabClick(1))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.filled"},null,8,nl),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translated"},null,8,ol),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[2]}]),onClick:n[2]||(n[2]=c=>a.onTabClick(2))},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_tab_title"},null,8,rl)],2)]),e.createBaseVNode("div",il,[e.createBaseVNode("div",sl,[e.createBaseVNode("div",cl,[e.createBaseVNode("div",dl,[e.createBaseVNode("div",ul,[e.createBaseVNode("div",vl,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.localPanelTranslateData.displayName},null,8,ml)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,_l)):e.createCommentVNode("",!0)])])]),e.createBaseVNode("div",fl,[e.createBaseVNode("div",hl,[e.createBaseVNode("div",pl,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.targetPanelTranslateData.displayName},null,8,gl)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.origin"},null,8,Nl)):e.createCommentVNode("",!0)]),e.withDirectives(e.createVNode(m,{color:"blue",disabled:!a.hasTranslateProvider,onConfirm:a.onTranslateClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translate"},null,8,Vl)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,!a.isSameLanguage&&a.currentTab===a.Tab[0]]]),e.withDirectives(e.createVNode(m,{color:"blue",disabled:!a.isTargetTranslateDataHasEmptyMedia,onConfirm:a.onImportAllClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_all"},null,8,Bl)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,a.currentTab===a.Tab[0]&&!a.isSameLanguage]])])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentTranslateDataItems,c=>(e.openBlock(),e.createElementBlock("div",{key:c.key,class:"tr"},[e.createBaseVNode("div",kl,[e.createBaseVNode("div",null,[e.createVNode(C,{style:{flex:"1"},"is-textarea":!0,"model-value":a.getDisplayNameOfLocalItem(c.key),readonly:!0,onClick:s=>a.onItemMouseDown(c,!0,s),onBlur:a.onItemBlur},null,8,["model-value","onClick","onBlur"])])]),e.createBaseVNode("div",wl,[e.createBaseVNode("div",bl,[e.createVNode(C,{"is-textarea":!0,"model-value":a.getDisplayNameOfTargetItem(c.key),readonly:a.isSameLanguage&&c.type===a.TranslateItemType.Media,onBlur:a.onItemBlur,onClick:s=>a.onItemMouseDown(c,!1,s),"onUpdate:modelValue":s=>a.onInputChanged(c.key,s)},{default:e.withCtx(()=>[c.type===a.TranslateItemType.Media&&!a.isSameLanguage?(e.openBlock(),e.createBlock(m,{key:0,class:"import",color:"blue",onConfirm:s=>a.onImportClick(c.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import"},null,8,yl)]),_:2},1032,["onConfirm"])):e.createCommentVNode("",!0),c.type!==a.TranslateItemType.Media?(e.openBlock(),e.createBlock(m,{key:1,color:"blue",disabled:a.isVariantsDisable(c.key),onConfirm:s=>a.onVariantsClick(c.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.variant"},null,8,Cl)]),_:2},1032,["disabled","onConfirm"])):e.createCommentVNode("",!0)]),_:2},1032,["model-value","readonly","onBlur","onClick","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("footer",null,[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",value:a.MainName+".translate.key:",i18n:""},null,8,xl),e.createBaseVNode("ui-label",{value:a.currentSelectedItem?.key||""},null,8,Tl)]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.position:"},null,8,Il),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.positionOfAssociation,c=>(e.openBlock(),e.createElementBlock("ui-label",{key:c.__key,value:c.value},null,8,Pl))),128))]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.reference_uuid"},null,8,Sl),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.nodeUuidOfAssociation,c=>(e.openBlock(),e.createElementBlock("ui-label",{key:c.__key,value:c.value},null,8,El))),128))])]),a.currentVariantsItem?(e.openBlock(),e.createElementBlock("div",Dl,[e.createBaseVNode("div",null,[e.createBaseVNode("div",Ll,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.variant"},null,8,Ml)]),e.createBaseVNode("div",Fl,[e.createBaseVNode("div",null,[e.createBaseVNode("div",{class:"table",onClick:n[3]||(n[3]=e.withModifiers(()=>{},["stop"]))},[e.createBaseVNode("div",Kl,[e.createBaseVNode("div",Al,[e.createBaseVNode("div",Gl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.standard",class:"weakWhite"},null,8,Wl)])]),e.createBaseVNode("div",Ol,[e.createBaseVNode("div",jl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.after_variant",class:"weakWhite",style:{flex:"1"}},null,8,Ul)])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentVariantsItem._variants,(c,s)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"tr"},[e.createBaseVNode("div",zl,[e.createBaseVNode("div",null,[e.createVNode(C,{"model-value":a.variantKeys[s],readonly:!0},null,8,["model-value"])])]),e.createBaseVNode("div",ql,[e.createBaseVNode("div",Hl,[e.createVNode(C,{modelValue:c.value,"onUpdate:modelValue":b=>c.value=b,"is-textarea":!0},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("div",Xl,[e.createBaseVNode("div",Rl,[e.createBaseVNode("div",Jl,[e.createVNode(m,{color:"blue",disabled:a.isDeleteVariantsDisable,onConfirm:a.onVariantsDelete},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.delete_variant"},null,8,Ql)]),_:1},8,["disabled","onConfirm"])]),e.createBaseVNode("div",null,[e.createVNode(m,{"has-border":!0,onConfirm:a.onVariantsCancel},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,Yl)]),_:1},8,["onConfirm"]),e.createVNode(m,{"has-border":!0,style:{"margin-left":"16px"},onConfirm:a.onVariantsConfirm},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.confirm"},null,8,Zl)]),_:1},8,["onConfirm"])])])])])])):e.createCommentVNode("",!0),e.withDirectives(e.createBaseVNode("div",$l,[e.createBaseVNode("div",en,[e.createBaseVNode("div",an,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.save"},null,8,tn)]),e.createBaseVNode("div",ln,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.conflict_dialog_content"},null,8,nn),e.createBaseVNode("div",null,[e.createBaseVNode("div",on,[e.createBaseVNode("div",rn,[e.createBaseVNode("div",sn,[e.createBaseVNode("ui-checkbox",{value:a.isConflictSelectAll,onChange:n[4]||(n[4]=c=>a.onConflictItemSelectAllClick(c.target.value))},null,40,cn)]),e.createBaseVNode("div",dn,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,un)]),e.createBaseVNode("div",vn,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.old_value"},null,8,mn)]),e.createBaseVNode("div",_n,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.new_value"},null,8,fn)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.conflictItemsBetweenImportedFilesAndTranslatedFiles,(c,s)=>(e.openBlock(),e.createElementBlock("div",{key:c.key,class:"tr"},[e.createBaseVNode("div",hn,[e.createBaseVNode("ui-checkbox",{value:a.selectedConflictItemIndexSet.has(s),onChange:b=>a.onConflictItemClick(b.target.value,s)},null,40,pn)]),e.createBaseVNode("div",gn,[e.createBaseVNode("ui-label",{value:c.key},null,8,Nn)]),e.createBaseVNode("div",Vn,[e.createBaseVNode("ui-label",{value:a.targetPanelTranslateData?.items[c.key]?.value??c.value},null,8,Bn)]),e.createBaseVNode("div",kn,[e.createBaseVNode("ui-label",{value:a.importedTranslateItemMap[c.key].value},null,8,wn)])]))),128))])])]),e.createBaseVNode("div",bn,[e.createVNode(m,{"has-border":!0,transparent:!0,disabled:a.selectedConflictItemIndexSet.size===0,onConfirm:a.onConflictConfirmClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cover"},null,8,yn)]),_:1},8,["disabled","onConfirm"]),e.createVNode(m,{"has-border":!0,transparent:!0,onConfirm:a.onConflictCancelClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,Cn)]),_:1},8,["onConfirm"])])])],512),[[e.vShow,a.conflictItemsBetweenImportedFilesAndTranslatedFiles.length]])])}var Tn=e._export_sfc(Xt,[["render",xn]]);const In={emits:["confirm"],setup(r,{emit:n}){return{onButtonClick(){n("confirm")},PKGName:L.name}}},Pn={class:"mask"},Sn=["value"],En=["value"];function Dn(r,n,f,a,g,V){return e.openBlock(),e.createElementBlock("div",Pn,[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.turn_on_tip"},null,8,Sn),e.createBaseVNode("ui-button",{onConfirm:n[0]||(n[0]=m=>a.onButtonClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.turn_on"},null,8,En)],32)])])}var Ln=e._export_sfc(In,[["render",Dn]]);const Mn={components:{Home:Ht,Translate:Tn,DefaultMask:Ln},setup(){e.onMounted(()=>{R.eventBus.on("onCustomError",a)}),e.onUnmounted(()=>{R.eventBus.off("onCustomError",a)});const r=e.ref(!0),n=e.ref(""),f=e.ref(0);function a(g){Editor.Dialog.error(g.message),console.error(g)}return v.wrapper.getEnable().then(g=>{r.value=g}),{async onToggle(g){r.value=g},async onMaskConfirm(){r.value=await v.wrapper.toggle()},isLocalizationEditorEnable:r,tabIndex:f,targetLocale:n,onTranslateClick(g){n.value=g,f.value=1},onHomeClick(){R.eventBus.emit("updateAllLanguageConfig"),f.value=0}}}},Fn=r=>(e.pushScopeId("data-v-0f154f19"),r=r(),e.popScopeId(),r),Kn=Fn(()=>e.createBaseVNode("div",{class:"fallback"},[e.createBaseVNode("ui-loading")],-1));function An(r,n,f,a,g,V){const m=e.resolveComponent("DefaultMask"),C=e.resolveComponent("Home"),c=e.resolveComponent("Translate");return e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createBaseVNode("div",null,[e.withDirectives(e.createVNode(m,{onConfirm:n[0]||(n[0]=s=>a.onMaskConfirm())},null,512),[[e.vShow,!a.isLocalizationEditorEnable]]),e.withDirectives(e.createVNode(C,{onTranslate:a.onTranslateClick,onToggle:a.onToggle},null,8,["onTranslate","onToggle"]),[[e.vShow,a.tabIndex===0]]),a.tabIndex===1?(e.openBlock(),e.createBlock(c,{key:0,"target-locale":a.targetLocale,onHome:a.onHomeClick},null,8,["target-locale","onHome"])):e.createCommentVNode("",!0)])]),fallback:e.withCtx(()=>[Kn]),_:1})}var Gn=e._export_sfc(Mn,[["render",An],["__scopeId","data-v-0f154f19"]]);class ${constructor(n,f,a,g,V){this.bcp47Tag=n,this.displayName=f,this.fontName=a,this.localFontName=g,this.items=V}get locale(){return this.bcp47Tag}static async getPanelTranslateData(n){const f=await v.wrapper.getTranslateData(n),a=await v.wrapper.getLocalLanguage(),g=await v.wrapper.getLanguageConfig(n);if(!g||!a)return null;const V={};for(let m=0;m<f.length;m++){const C=f[m];V[C.key]=C}return new $(g.bcp47Tag,L.getLanguageDisplayName(g.bcp47Tag),"","",V)}}const Wn=re.readJsonSync(I.join(__dirname,"../../static/plural-rules/plural-rules.json"),{encoding:"utf8"}),ke=new WeakMap;module.exports=Editor.Panel.define({listeners:{show(){},hide(){}},template:'<div id="app"></div>',style:re.readFileSync(I.join(__dirname,"./index.css"),{encoding:"utf8"})+e.commonCss,$:{app:"#app"},ready(){if(this.$.app){const r=e.createApp(Gn);r.mount(this.$.app),ke.set(this,r)}},methods:{executePanelMethod(r,...n){R.eventBus.emit(r,...n)}},beforeClose(){},close(){const r=ke.get(this);r&&r.unmount()}});
