"use strict";var re=require("fs-extra"),T=require("path"),e=require("../share/scripts/global.js"),J=require("../../dist/virtual-modules/EventBus"),_=require("../../dist/virtual-modules/Wrapper"),Ee=require("electron"),De=require("@electron/remote"),Le=require("fs"),L=require("../share/scripts/languageMap.js"),j=require("../share/scripts/TranslateItemType.js");function we(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var Me=we(Ee),Ne=we(De);const Fe={props:{transparent:{type:Boolean,required:!1,default:!0},hasBorder:{type:Boolean,required:!1,default:!1},color:{type:String,required:!1,default:"white"},disabled:{type:Boolean,required:!1,default:!1}}},Ke=["transparent","border","color","disabled"];function Ae(r,o,f,a,k,B){return e.openBlock(),e.createElementBlock("ui-button",{class:"button",transparent:f.transparent,border:f.hasBorder,color:f.color,disabled:f.disabled},[e.renderSlot(r.$slots,"default",{},void 0,!0)],8,Ke)}var be=e._export_sfc(Fe,[["render",Ae],["__scopeId","data-v-55077cbe"]]);const Ge={components:{"m-input":j.mInput},props:{modelValue:String,checkFileExist:Boolean,checkEmpty:Boolean,placeholder:String},emits:["blur","update:modelValue"],setup:(r,{emit:o})=>{const f=e.ref(!r.checkFileExist||re.existsSync(T.join(e.ProjectAssetPath,r.modelValue??"")));function a(B){o("update:modelValue",B)}function k(B){r.checkFileExist&&(f.value=re.existsSync(T.join(e.ProjectAssetPath,r.modelValue??"")))}return{isFileExist:f,onModelUpdate:a,onBlur:k}},computed:{showIcon(){return this.checkEmpty&&this.modelValue===""||this.checkFileExist&&!this.isFileExist},tooltip(){return this.modelValue===""&&this.checkEmpty?"i18n:"+e.MainName+".cannot_empty":"i18n:"+e.MainName+".file_no_exist"}}},Oe={class:"mFile"},We=["tooltip"],je=e.createTextVNode(" ! "),Ue={class:"label"};function ze(r,o,f,a,k,B){const u=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",Oe,[e.withDirectives(e.createBaseVNode("ui-prop",{style:{width:"0px"},tooltip:B.tooltip},[e.renderSlot(r.$slots,"icon",{},()=>[je],!0)],8,We),[[e.vShow,B.showIcon]]),e.createBaseVNode("div",Ue,[e.renderSlot(r.$slots,"label",{},void 0,!0)]),e.createVNode(u,{"no-vertical-padding":"",class:"mInput",placeholder:f.placeholder,"model-value":f.modelValue,onBlur:r.onBlur,"onUpdate:modelValue":r.onModelUpdate},{default:e.withCtx(()=>[e.renderSlot(r.$slots,"inputIcon",{},void 0,!0)]),_:3},8,["placeholder","model-value","onBlur","onUpdate:modelValue"])])}var qe=e._export_sfc(Ge,[["render",ze],["__scopeId","data-v-24f0d3aa"]]);const He={props:{value:Number,color:{type:String,default:"blue"}}},Xe={class:"mProcess"},Re=["color"];function Je(r,o,f,a,k,B){return e.openBlock(),e.createElementBlock("div",Xe,[e.createBaseVNode("div",{class:"content",style:e.normalizeStyle({width:f.value*100+"%"}),color:f.color},null,12,Re)])}var Qe=e._export_sfc(He,[["render",Je],["__scopeId","data-v-665a2fce"]]);const Ye={components:{"m-icon":j.mIcon},props:{modelValue:Boolean},setup(r,{emit:o}){function f(){o("update:modelValue",!r.modelValue)}return{clickIcon:f}}},Ze={class:"mSection"},$e={class:"content"};function ea(r,o,f,a,k,B){const u=e.resolveComponent("m-icon");return e.openBlock(),e.createElementBlock("div",Ze,[e.createBaseVNode("div",{class:"header",onClick:o[0]||(o[0]=(...x)=>a.clickIcon&&a.clickIcon(...x))},[e.createVNode(u,{style:{"margin-right":"2px"},class:"icon",background:!1,value:"arrow-triangle","upside-down":f.modelValue},null,8,["upside-down"]),e.renderSlot(r.$slots,"header",{},void 0,!0)]),e.withDirectives(e.createBaseVNode("div",$e,[e.renderSlot(r.$slots,"content",{},void 0,!0)],512),[[e.vShow,f.modelValue]])])}var aa=e._export_sfc(Ye,[["render",ea],["__scopeId","data-v-4d579e52"]]);class G{constructor(o){this.value=o,this.__key=`${Date.now().toString()}-${Math.random()}`}}function Ve(r,o=[]){const f=Object.keys(L.languageMap),a=["zh","en","fr","ru","ja","ko","es","ar"],k=a.map(d=>L.getLanguageDisplayName(d)),B=f.map(d=>({label:L.getLanguageDisplayName(d),sublabel:d===a[a.length-1]?Editor.I18n.t(e.MainName+".common_languages"):void 0,submenu:L.languageMap[d].map(N=>{const s=L.getLanguageDisplayName(N);return{label:s,click:()=>{r(N,s??N)},enabled:!o.includes(N)}}).filter(Boolean)})).filter(Boolean),u=B.filter(d=>k.includes(d.label)).sort((d,g)=>k.indexOf(d.label)-k.indexOf(g.label)),x=B.filter(d=>!f.find(g=>d.label===g)&&!u.includes(d)).sort((d,g)=>(d.label??"").localeCompare(g.label??"")),c=B.filter(d=>f.find(g=>d.label===g)&&!u.includes(d)).sort();Editor.Menu.popup({menu:[...u,{type:"separator"},...x,...c]})}var q=(r=>(r[r.PO=0]="PO",r[r.CSV=1]="CSV",r[r.XLSX=2]="XLSX",r))(q||{});function ye(r){let o;const f=T.extname(r);if(f===".po")o=q.PO;else if(f===".csv")o=q.CSV;else if(f===".xlsx")o=q.XLSX;else throw new Error(`[${e.MainName}]: cannot get TranslateFileType of ${r}`);return o}function ta(r){if(r===q.PO)return".po";if(r===q.CSV)return".csv";if(r===q.XLSX)return".xlsx";throw new Error(`[${e.MainName}]: cannot get ExtName of ${r}`)}class Be{constructor(o,f,a,k){this.expanded=o,this.dirs=f,this.exts=a,this.excludes=k}}const la={components:{"m-input":j.mInput,"m-file":qe,"m-process":Qe,"m-icon":j.mIcon,"m-button":be,"m-section":aa},emits:["translate"],async setup(r,{emit:o}){e.onMounted(()=>{J.eventBus.on("scanProgress",B),J.eventBus.on("updateAllLanguageConfig",u)}),e.onUnmounted(()=>{J.eventBus.off("scanProgress",B),J.eventBus.off("updateAllLanguageConfig",u)});const f=e.ref(await _.wrapper.getEnable()),a=e.computed(()=>L.getLanguageDisplayName(F.value?.bcp47Tag,"none")??""),k=e.ref(-1);function B(n,m){H.value=m&&n/m,k.value=n}async function u(){y.value=(await _.wrapper.getAllLanguageConfigs()).map(n=>new G(n)),F.value=await _.wrapper.getLocalLanguageConfig()}const x=e.ref(await _.wrapper.getTranslateProviders()),c=e.ref(!1),d=e.ref(!1),g=e.ref(await _.wrapper.getCurrentTranslateProvider());function N(n){g.value&&(d.value=!0,g.value.appKey=n)}function s(n){g.value&&(d.value=!0,g.value.appSecret=n)}async function C(n){const m=n.target.value;m==="None"?(await _.wrapper.clearTranslateProvider(),g.value=void 0,I.value=!1):g.value=await _.wrapper.getTranslateProvider(m)??{appKey:"",appSecret:"",name:m,qps:0,url:""},d.value=!0}const p=e.ref(await _.wrapper.getProviderLanguages(g.value?.name));async function D(n,m){const P=n.target.value,E=Object.entries(p.value).find(([M,z])=>z===P)?.[0];if(E){const M=y.value[m].value;M.providerTag=E,await _.wrapper.setLanguageConfig(M)}}const I=e.ref(!!g.value),Q=e.computed(()=>!g.value?.appKey||!g.value?.appSecret||!d.value);async function ee(){g.value&&(c.value=!0,await _.wrapper.setCurrentTranslateProvider(g.value),c.value=!1,d.value=!1,I.value=!0,p.value=await _.wrapper.getProviderLanguages(g.value?.name),u())}const W=await _.wrapper.getScanOptions();W.length===0&&W.push({dirs:[""],excludes:[],extNames:[]});const b=e.ref(W.map(n=>new G(new Be(!0,{expanded:!0,items:n.dirs.map(m=>new G(m))},{expanded:!0,items:n.extNames.map(m=>new G(m))},{expanded:!0,items:n.excludes.map(m=>new G(m))}))));function ie(n){b.value.splice(n,1)}function ae(){b.value.push(new G(new Be(!0,{expanded:!0,items:[new G("")]},{expanded:!0,items:[]},{expanded:!0,items:[]})))}async function se(n,m){const P=T.join(Editor.Project.path,"assets"),E=await Editor.Dialog.select({multi:!1,type:"directory",path:P});if(!E.canceled){const M=T.relative(e.ProjectAssetPath,E.filePaths[0]);return b.value[n].value.dirs.items.find(z=>z.value===M)||(b.value[n].value.dirs.items[m].value=M),E}}async function te(n,m){const P=T.join(Editor.Project.path,"assets"),E=await Editor.Dialog.select({multi:!1,type:"directory",path:P});if(!E.canceled){const M=T.relative(e.ProjectAssetPath,E.filePaths[0]);return b.value[n].value.excludes.items.find(z=>z.value===M)||(b.value[n].value.excludes.items[m].value=M),E}}function ce(n,m){b.value[n].value[m].items.push(new G("")),b.value[n].value[m].expanded=!0}function S(n,m,P){b.value[n].value[P].items.splice(m,1)}const H=e.ref(-1),X=e.ref(!1),K=e.computed(()=>b.value.some(n=>n.value.dirs.items.some(m=>!Editor.Utils.Path.contains(e.ProjectAssetPath,T.join(e.ProjectAssetPath,m.value))||!Le.existsSync(T.join(e.ProjectAssetPath,m.value))))),de=e.computed(()=>K.value||X.value||!b.value.length||!F.value);async function $(){return X.value=!0,k.value=0,H.value=0,await _.wrapper.scan(b.value.map(n=>({dirs:n.value.dirs.items.map(m=>m.value),extNames:n.value.exts.items.map(m=>m.value),excludes:n.value.excludes.items.map(m=>m.value)}))),H.value=-1,X.value=!1,u()}const R=e.ref([]);async function ue(){const n=await Editor.Dialog.select({extensions:"po"});if(!n.canceled){const m=n.filePaths.filter(P=>!R.value.find(E=>E.value===P));R.value.push(...m.map(P=>new G(P)))}}function ve(n){R.value.splice(n,1)}const y=e.ref((await _.wrapper.getAllLanguageConfigs()).map(n=>new G(n)));console.debug("All language data",y);const F=e.ref(await _.wrapper.getLocalLanguageConfig());console.debug("Data for the current language",F);function le(n){o("translate",y.value[n].value.bcp47Tag)}async function me(n){const m=y.value[n].value.bcp47Tag;await _.wrapper.previewBy(m),await Editor.Panel.focus("scene")}async function _e(n){await _.wrapper.removeLanguage(y.value[n].value.bcp47Tag)!==!1&&await u()}async function ne(n){let m,P;const E=y.value[n].value.bcp47Tag,M=await v(),z=T.extname(M),Se=T.join(T.dirname(M),`${E}${z||".po"}`),pe=await Editor.Dialog.save({filters:[{name:Editor.I18n.t(`${L.name}.home.po_name`),extensions:["po"]},{name:Editor.I18n.t(`${L.name}.home.csv_name`),extensions:["csv"]},{name:Editor.I18n.t(`${L.name}.home.xlsx_name`),extensions:["xlsx"]}],path:Se});!pe.canceled&&pe.filePath&&(m=pe.filePath,V(m),P=ye(m),await _.wrapper.exportTranslateFile(m,P,E),Ne.default.shell.showItemInFolder(m))}const t="panel.default-home",l=`${t}.lastFile`,i=`${t}.lastDir`;async function v(){return await Editor.Profile.getTemp(L.name,l)||""}async function h(){return await Editor.Profile.getTemp(L.name,i)||""}function V(n){Editor.Profile.setTemp(L.name,l,n)}function w(n){Editor.Profile.setTemp(L.name,i,n)}async function A(){const n=await Editor.Dialog.select({type:"directory",multi:!1,path:await h()});if(!n.canceled){const m=n.filePaths[0];return w(m),m}return""}async function U(n,m){let P;await Promise.all(y.value.map(async E=>{const M=ta(m),z=T.join(n,`${E.value.bcp47Tag}${M}`);return P||(P=z),await _.wrapper.exportTranslateFile(z,m,E.value.bcp47Tag)})),P&&Ne.default.shell.showItemInFolder(P)}async function Y(){Editor.Menu.popup({menu:[{label:"po",async click(){const n=await A();n&&await U(n,q.PO)}},{label:"csv",async click(){const n=await A();n&&await U(n,q.CSV)}},{label:"xlsx",async click(){const n=await A();n&&await U(n,q.XLSX)}}]})}function fe(){Ve(async(n,m)=>{await _.wrapper.addTargetLanguage(n),await u()},y.value.map(n=>n.value.bcp47Tag))}function he(){Ve(async n=>{await _.wrapper.setLocalLanguage(n),await u()},[F?.value?.bcp47Tag??""])}function Ce(n){return F.value?.translateTotal?n.value.translateFinished/F.value.translateTotal:0}function xe(n){return F.value?`${F.value.translateTotal&&Math.floor(n.value.translateFinished*100/F.value.translateTotal)}%(${_.wrapper.numberFormat(n.value.translateFinished)}/${_.wrapper.numberFormat(F.value.translateTotal)})`:"0%"}function Ie(n){Me.default.shell.openExternal("https://docs.cocos.com/creator/manual/zh/")}function Te(){Editor.Menu.popup({menu:[{label:Editor.I18n.t("localization-editor.home.turn_off"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.turn_off_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")]})).response!==1&&(await ge(),await u())}},{label:Editor.I18n.t("localization-editor.home.delete_data"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.delete_data_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")],cancel:1})).response!==1&&await _.wrapper.uninstall()}}]})}async function ge(){f.value=await _.wrapper.toggle()}async function Pe(){await ge()}return{onExportAllClick:Y,onTurnOnClick:Pe,isLocalizationEditorEnable:f,onMenuClick:Te,currentCollectCount:k,isCurrentServiceDirty:d,isCurrentServiceLoading:c,onAppKeyUpdate:N,onAppSecretUpdate:s,onLinkClick:Ie,onSelectNewLanguageClick:fe,hasService:I,isCurrentServiceDisabled:Q,getTranslateProcessDescription:xe,isCollecting:X,isCollectingHasWrongDir:K,isCollectionDisabled:de,collectionProgress:H,projectAssetPath:e.ref("db://assets/"),onSelectExcludeDirClick:te,onSelectLocalClick:he,onScanClick:$,currentService:g,onProviderSummitClick:ee,onSetCurrentTranslateProvider:C,currentLanguage:F,onAddCollectionClick:ae,onRemoveCollectionClick:ie,collections:b,onAddToCollectionClick:ce,onSelectCollectionDirClick:se,onRemoveFromCollectionClick:S,PKGName:L.name,importedPOfiles:R,onImportPOClick:ue,onRemovePOClick:ve,panelTranslateDataList:y,providerLanguages:p,supportedServices:x,onTranslateClick:le,onPreviewClick:me,onDeleteClick:_e,onExportClick:ne,onProviderLanguageSelect:D,t:Editor.I18n.t,currentLanguageDisplayName:a,numberFormat:_.wrapper.numberFormat.bind(_.wrapper),getTranslateProcess:Ce}}},O=r=>(e.pushScopeId("data-v-c04923ca"),r=r(),e.popScopeId(),r),na={ref:"rootElement",class:"home"},oa={ref:"bodyElement",class:"body"},ra={class:"mask"},ia=["value"],sa=["value"],ca={class:"main"},da={class:"title"},ua=O(()=>e.createBaseVNode("ui-label",{class:"strongWhite"}," L10N ",-1)),va={ref:"serviceElement",class:"container service"},ma=O(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),_a=["value"],fa={class:"gray service"},ha={class:"container"},pa={class:"left container"},ga=["value"],Na=O(()=>e.createBaseVNode("span",null,":",-1)),Va=["value"],Ba=O(()=>e.createBaseVNode("option",null,"None",-1)),ka=["value"],wa={key:0,class:"container"},ba=O(()=>e.createBaseVNode("ui-label",{class:"left"}," AppKey: ",-1)),ya={key:1,class:"container"},Ca=O(()=>e.createBaseVNode("ui-label",{class:"left"}," AppSecret: ",-1)),xa={key:0,style:{"margin-top":"3px"}},Ia=["value"],Ta=["value"],Pa=["value"],Sa={ref:"collectionElement",class:"container collect"},Ea=O(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),Da=["value"],La={class:"gray collect"},Ma={class:"container",style:{"margin-bottom":"20px"}},Fa=O(()=>e.createBaseVNode("ui-label",{class:"red",style:{"margin-right":"0px"}}," * ",-1)),Ka=["value"],Aa=["placeholder"],Ga=["value"],Oa={class:"container",style:{"margin-bottom":"5px"}},Wa={style:{flex:"1"},class:"container"},ja=["value"],Ua=["value"],za={style:{flex:"1"}},qa=["value"],Ha=["value"],Xa=e.createTextVNode(" + "),Ra={class:"parent"},Ja=["value"],Qa={class:"weakWhite",style:{"margin-right":"28px"}},Ya={class:"weakWhite",style:{"margin-right":"8px"}},Za=["value"],$a=e.createTextVNode(" + "),et={class:"parent"},at=["value"],tt={class:"weakWhite",style:{"margin-right":"28px"}},lt=O(()=>e.createBaseVNode("ui-label",{style:{"margin-right":"8px"}}," *. ",-1)),nt=["value"],ot=e.createTextVNode(" + "),rt={class:"parent"},it=["value"],st={class:"weakWhite",style:{"margin-right":"28px"}},ct={class:"weakWhite",style:{"margin-right":"8px"}},dt={class:"container",style:{"margin-top":"62px"}},ut=["value"],vt=["value"],mt=["value"],_t=["value"],ft=["value"],ht=["value"],pt={ref:"languageElement",class:"container language"},gt=O(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),Nt=["value"],Vt={class:"gray language"},Bt={class:"container",style:{"margin-bottom":"16px"}},kt=["value"],wt=["disabled"],bt=["value"],yt=["value"],Ct=["value"],xt=["value"],It=["value"],Tt=["value"],Pt=["value"],St=["value"],Et={key:0},Dt=["placeholder","value","onConfirm"],Lt={key:1},Mt=O(()=>e.createBaseVNode("ui-select",{disabled:""},null,-1)),Ft=[Mt],Kt={class:"container"},At=["tooltip","value"],Gt=["value"],Ot=["value"],Wt=["value"],jt=["value"],Ut=["value"],zt=["value"],qt=["placeholder"],Ht={class:"container"},Xt=O(()=>e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray"}," - ")],-1)),Rt={class:"container",style:{"flex-direction":"row-reverse","margin-top":"32px"}},Jt=["value"];function Qt(r,o,f,a,k,B){const u=e.resolveComponent("m-icon"),x=e.resolveComponent("m-input"),c=e.resolveComponent("m-button"),d=e.resolveComponent("m-file"),g=e.resolveComponent("m-section"),N=e.resolveComponent("m-process");return e.openBlock(),e.createElementBlock("div",na,[e.createBaseVNode("div",oa,[e.withDirectives(e.createBaseVNode("div",ra,[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.turn_on_tip"},null,8,ia),e.createBaseVNode("ui-button",{onConfirm:o[0]||(o[0]=s=>a.onTurnOnClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.turn_on"},null,8,sa)],32)])],512),[[e.vShow,!a.isLocalizationEditorEnable]]),e.createBaseVNode("div",ca,[e.createBaseVNode("div",da,[ua,e.createVNode(u,{style:{"margin-left":"5.5px",display:"inline-flex"},value:"help",onClick:o[1]||(o[1]=s=>a.onLinkClick("i18n"))}),e.createVNode(u,{value:"menu",style:{"margin-left":"auto"},onClick:o[2]||(o[2]=s=>a.onMenuClick())})]),e.createBaseVNode("div",va,[ma,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".service_provider"},null,8,_a)],512),e.createBaseVNode("div",fa,[e.createBaseVNode("div",ha,[e.createBaseVNode("div",pa,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".service_provider"},null,8,ga),Na]),e.createBaseVNode("ui-select",{value:a.currentService?.name||"None",onConfirm:o[3]||(o[3]=(...s)=>a.onSetCurrentTranslateProvider&&a.onSetCurrentTranslateProvider(...s))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.supportedServices,s=>(e.openBlock(),e.createElementBlock("option",{key:s},e.toDisplayString(s),1))),128)),Ba],40,Va),e.withDirectives(e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray",i18n:"",value:a.PKGName+".unselect_service_tip"},null,8,ka),[[e.vShow,!a.currentService]])]),a.currentService?(e.openBlock(),e.createElementBlock("div",wa,[ba,e.createVNode(x,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appKey,"onUpdate:modelValue":o[4]||(o[4]=s=>a.onAppKeyUpdate(s))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",ya,[Ca,e.createVNode(x,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appSecret,"onUpdate:modelValue":o[5]||(o[5]=s=>a.onAppSecretUpdate(s))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",{key:2,class:"footer",onConfirm:o[6]||(o[6]=(...s)=>a.onProviderSummitClick&&a.onProviderSummitClick(...s))},[e.createVNode(c,{"has-border":!0,color:"blue",disabled:a.isCurrentServiceDisabled},{default:e.withCtx(()=>[a.isCurrentServiceLoading?(e.openBlock(),e.createElementBlock("ui-loading",xa)):a.isCurrentServiceDirty?(e.openBlock(),e.createElementBlock("ui-label",{key:1,i18n:"",color:"",value:a.PKGName+".home.save"},null,8,Ia)):a.hasService?(e.openBlock(),e.createElementBlock("ui-label",{key:2,i18n:"",value:a.PKGName+".home.complete",color:""},null,8,Ta)):(e.openBlock(),e.createElementBlock("ui-label",{key:3,i18n:"",value:a.PKGName+".home.save",color:""},null,8,Pa))]),_:1},8,["disabled"])],32)):e.createCommentVNode("",!0)]),e.createBaseVNode("div",Sa,[Ea,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".collection"},null,8,Da)],512),e.createBaseVNode("div",La,[e.createBaseVNode("div",Ma,[Fa,e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".local_language"},null,8,Ka),e.createBaseVNode("ui-select",{placeholder:a.currentLanguageDisplayName||"i18n:"+a.PKGName+".home.select",style:{"margin-right":"17px"},onMousedown:o[7]||(o[7]=e.withModifiers((...s)=>a.onSelectLocalClick&&a.onSelectLocalClick(...s),["prevent"]))},null,40,Aa),e.withDirectives(e.createBaseVNode("ui-label",{class:"red",i18n:"",value:a.PKGName+".home.required"},null,8,Ga),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",Oa,[e.createBaseVNode("div",Wa,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".collected_from_resource_files"},null,8,ja),e.createVNode(u,{value:"help",onClick:o[8]||(o[8]=s=>a.onLinkClick("collection"))})]),e.createBaseVNode("ui-button",{onClick:o[9]||(o[9]=e.withModifiers(()=>{},["stop"])),onConfirm:o[10]||(o[10]=s=>a.onAddCollectionClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add"},null,8,Ua)],32)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.collections,(s,C)=>(e.openBlock(),e.createBlock(g,{key:s.__key,modelValue:s.value.expanded,"onUpdate:modelValue":p=>s.value.expanded=p,class:"frame",style:{"padding-right":"15px"}},{header:e.withCtx(()=>[e.createBaseVNode("div",za,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.collect_group"},null,8,qa),e.createBaseVNode("ui-label",null,e.toDisplayString(C+1),1)]),e.createVNode(u,{value:"del",onClick:e.withModifiers(p=>a.onRemoveCollectionClick(C),["stop"])},null,8,["onClick"])]),content:e.withCtx(()=>[e.createVNode(g,{modelValue:s.value.dirs.expanded,"onUpdate:modelValue":p=>s.value.dirs.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.search_dir"},null,8,Ha),e.createVNode(u,{onClick:[o[11]||(o[11]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(C,"dirs")]},{default:e.withCtx(()=>[Xa]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.dirs.items,(p,D)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(d,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-file-exist":!0,style:{}},{icon:e.withCtx(()=>[e.createVNode(u,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",Ra,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.dir"},null,8,Ja),e.createBaseVNode("ui-label",Qa,e.toDisplayString(D+1),1)]),e.createBaseVNode("ui-label",Ya,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(u,{value:"folder-open",onClick:I=>a.onSelectCollectionDirClick(C,D)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(u,{style:e.normalizeStyle({visibility:s.value.dirs.items.length>=2?void 0:"hidden"}),value:"del",onClick:I=>a.onRemoveFromCollectionClick(C,D,"dirs")},null,8,["style","onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(g,{modelValue:s.value.exts.expanded,"onUpdate:modelValue":p=>s.value.exts.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.extname"},null,8,Za),e.createVNode(u,{onClick:[o[12]||(o[12]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(C,"exts")]},{default:e.withCtx(()=>[$a]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.exts.items,(p,D)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(d,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-empty":!0},{icon:e.withCtx(()=>[e.createVNode(u,{color:"true",value:"warn-triangle",style:{"margin-right":"2px"}})]),label:e.withCtx(()=>[e.createBaseVNode("span",et,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.extname"},null,8,at),e.createBaseVNode("ui-label",tt,e.toDisplayString(D+1),1)]),lt])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(u,{value:"del",onClick:I=>a.onRemoveFromCollectionClick(C,D,"exts")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(g,{modelValue:s.value.excludes.expanded,"onUpdate:modelValue":p=>s.value.excludes.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.exclude_path"},null,8,nt),e.createVNode(u,{onClick:[o[13]||(o[13]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(C,"excludes")]},{default:e.withCtx(()=>[ot]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.excludes.items,(p,D)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(d,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-file-exist":!0},{icon:e.withCtx(()=>[e.createVNode(u,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",rt,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.exclude_path"},null,8,it),e.createBaseVNode("ui-label",st,e.toDisplayString(D+1),1)]),e.createBaseVNode("ui-label",ct,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(u,{value:"folder-open",onClick:I=>a.onSelectExcludeDirClick(C,D)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(u,{value:"del",onClick:I=>a.onRemoveFromCollectionClick(C,D,"excludes")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128)),e.createBaseVNode("div",dt,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.count"},null,8,ut),e.withDirectives(e.createVNode(N,{value:a.collectionProgress},null,8,["value"]),[[e.vShow,a.collectionProgress!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.numberFormat(a.currentCollectCount)},null,8,vt),[[e.vShow,a.currentCollectCount!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.currentLanguage?.translateTotal?a.numberFormat(a.currentLanguage?.translateTotal):""},null,8,mt),[[e.vShow,a.currentCollectCount===-1&&a.currentLanguage?.translateTotal]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},class:"weakGray",i18n:"",value:a.PKGName+".home.not_recorded"},null,8,_t),[[e.vShow,a.currentCollectCount===-1&&!a.currentLanguage?.translateTotal]]),e.createVNode(c,{color:"blue",disabled:a.isCollectionDisabled,"has-border":!0,style:{"min-width":"125px"},onConfirm:a.onScanClick},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collecting"},null,8,ft),[[e.vShow,a.isCollecting]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collect_and_count"},null,8,ht),[[e.vShow,!a.isCollecting]])]),_:1},8,["disabled","onConfirm"])])]),e.createBaseVNode("div",pt,[gt,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".language_compilation"},null,8,Nt)],512),e.createBaseVNode("div",Vt,[e.createBaseVNode("div",Bt,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.language:",style:{"margin-right":"8px"}},null,8,kt),e.createBaseVNode("ui-button",{disabled:!a.currentLanguage,onConfirm:o[14]||(o[14]=s=>a.onSelectNewLanguageClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add_new_language"},null,8,bt)],40,wt)]),e.createBaseVNode("table",null,[e.createBaseVNode("tr",null,[e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language"},null,8,yt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language_for_service_provider"},null,8,Ct)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.translate_process"},null,8,xt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.operation"},null,8,It)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.panelTranslateDataList,(s,C)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",{key:s.value.bcp47Tag},[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{value:s.value.displayName},null,8,Tt),e.createBaseVNode("ui-label",{class:"weakWhite",value:`(${s.value.bcp47Tag})`},null,8,Pt),e.withDirectives(e.createBaseVNode("ui-label",{style:{display:"block"},class:"weakWhite",i18n:"",value:a.PKGName+".home.local_language"},null,8,St),[[e.vShow,s.value.bcp47Tag===a.currentLanguage?.bcp47Tag]])]),a.hasService?(e.openBlock(),e.createElementBlock("td",Et,[e.createBaseVNode("ui-select",{placeholder:a.providerLanguages[s.value.providerTag]?"":"i18n:"+a.PKGName+".home.select",value:a.providerLanguages[s.value.providerTag],onConfirm:p=>a.onProviderLanguageSelect(p,C)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.providerLanguages,(p,D)=>(e.openBlock(),e.createElementBlock("option",{key:D},e.toDisplayString(p),1))),128))],40,Dt)])):(e.openBlock(),e.createElementBlock("td",Lt,Ft)),e.createBaseVNode("td",null,[e.createBaseVNode("div",Kt,[e.createVNode(N,{value:a.getTranslateProcess(s),color:"blue"},null,8,["value"]),e.createBaseVNode("ui-label",{tooltip:"i18n:"+a.PKGName+".home.combine_tooltip",value:a.getTranslateProcessDescription(s)},null,8,At)])]),e.createBaseVNode("td",null,[e.createVNode(c,{color:"blue",onConfirm:p=>a.onTranslateClick(C)},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.complement"},null,8,Gt),[[e.vShow,s.value.bcp47Tag===a.currentLanguage?.bcp47Tag]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.translate"},null,8,Ot),[[e.vShow,s.value.bcp47Tag!==a.currentLanguage?.bcp47Tag]])]),_:2},1032,["onConfirm"]),e.createVNode(c,{color:"blue",disabled:!s.value.translateFinished,onConfirm:p=>a.onPreviewClick(C)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.preview"},null,8,Wt)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(c,{color:"blue",disabled:!s.value.translateFinished,onConfirm:p=>a.onExportClick(C)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export"},null,8,jt)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(c,{color:"blue",disabled:s.value.bcp47Tag===a.currentLanguage?.bcp47Tag,onConfirm:p=>a.onDeleteClick(C)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.delete"},null,8,Ut)]),_:2},1032,["disabled","onConfirm"])])])),[[e.vShow,a.currentLanguage]])),128)),e.withDirectives(e.createBaseVNode("tr",null,[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{class:"weakGray",i18n:"",value:a.PKGName+".home.unselect"},null,8,zt)]),e.createBaseVNode("td",null,[e.createBaseVNode("ui-select",{disabled:"",placeholder:"i18n:"+a.PKGName+".home.select"},null,8,qt)]),e.createBaseVNode("td",null,[e.createBaseVNode("div",Ht,[e.createVNode(N,{value:0})])]),Xt],512),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",Rt,[e.createVNode(c,{color:"blue",transparent:!0,"has-border":!0,disabled:!a.currentLanguage,onConfirm:o[15]||(o[15]=s=>a.onExportAllClick())},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export_all"},null,8,Jt)]),_:1},8,["disabled"])])])])],512)],512)}var Yt=e._export_sfc(la,[["render",Qt],["__scopeId","data-v-c04923ca"]]);const oe=["untranslated","translated","imported"],Zt={components:{"m-button":be,"m-input":j.mInput},props:{targetLocale:{type:String,required:!0}},emits:["home"],async setup(r,{emit:o}){const f=!!await _.wrapper.getCurrentTranslateProvider(),a=e.computed(()=>s.value?.locale===r.targetLocale),k=e.computed(()=>c.value==="untranslated"?u.value:c.value==="translated"?x.value:c.value==="imported"?Object.values(y.value):[]),B=await _.wrapper.getIndexData(),u=e.computed(()=>{const t=S.value?.items??{},l=s.value?.items??{},i=Object.keys(t);return a.value?Object.values(t).filter(v=>v&&!v.value):Object.keys(l).filter(v=>!i.includes(v)&&l[v]?.value).map(v=>l[v]).sort((v,h)=>v.index-h.index)}),x=e.computed(()=>{const t=S.value?.items??{},l=s.value?.items??{},i=Object.keys(t);return a.value?Object.values(t).filter(v=>v?.value):Object.keys(l).filter(v=>i.includes(v)&&l[v]?.value).map(v=>l[v]).sort((v,h)=>h.index-v.index)}),c=e.ref("untranslated"),d=e.ref({});function g(t,l,i,v,h,V=[]){const w=d.value[t.key]??=new _.WrapperTranslateItem(t.key,l,t.type,i,v,V,h);w.value=l,i&&(w.displayName=i),v&&(w.assetInfo=v),h&&(w._variants=h),V&&(w.associations=V)}const N=e.ref(null),s=e.ref(await Z.getPanelTranslateData());async function C(){s.value=await Z.getPanelTranslateData()}function p(){return Object.keys(d.value).length}async function D(){await Q()}let I=!1;async function Q(t,l){l??={},l.mergeOptions??={replaceVariant:I},["untranslated","translated"].includes(c.value)?await ee(t,l):(p()&&await ee(),await ce(t,l))}async function ee(t,l){if(t??=d.value,console.debug("onSaveClick",t),_.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{H()}),t===d.value)d.value={};else if(t instanceof Array)for(let i=0;i<t.length;i++){const v=t[i];delete d.value[v.key]}I=!1}const W=e.ref([]),b=e.ref(new Set);function ie(t,l){t?b.value.add(l):b.value.delete(l)}const ae=e.computed({get(){const t=W.value.length;return b.value.size===t},set(t){if(t)for(let l=0;l<W.value.length;l++)b.value.add(l);else b.value.clear()}});function se(t){ae.value=t}function te(t,l){if(_.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{H(),C()}),!a.value){const i=Object.values(s.value.items),v=t.filter(h=>!i.some(V=>V?.key===h.key));v.length&&_.wrapper.saveTranslateData(s.value.bcp47Tag,v,l?.mergeOptions).then(h=>{C()})}for(let i=0;i<t.length;i++){const v=t[i];delete y.value[v.key]}I=!1}async function ce(t,l){if(t??=Object.values(y.value),t){const i=Object.values(S.value.items);W.value=t.filter(h=>i.some(V=>V?.key===h.key));const v=t.filter(h=>!i.some(V=>V?.key===h.key));v.length&&te(v,l),l?.force&&(te(t,l),b.value.clear(),W.value=[])}}const S=e.ref(await Z.getPanelTranslateData(r.targetLocale));async function H(t){if(t){console.debug("translateResult",t);for(let l=0;l<t.length;l++){const i=t[l],v=d.value[i.key]||S.value.items[i.key];d.value[i.key]=new _.WrapperTranslateItem(i.key,i.value,i.type,i.displayName||_.WrapperTranslateItem.getDisplayName({item:i,assetInfo:v?.assetInfo||i.assetInfo}),v?.assetInfo,i.associations)}}else console.debug("update target translate data get translate data"),S.value=await Z.getPanelTranslateData(r.targetLocale)}const X=e.ref(Gn[S.value.bcp47Tag.split("-")[0]]??["other"]),K=e.ref(null),de=e.computed(()=>{const t=Object.values(s.value.items).filter(l=>l&&l.type===j.TranslateItemType.Media);if(t.length===0)return!1;for(const l of t)if(!(d.value[l.key]??S.value.items[l.key])?.value)return!0;return!1}),$=e.ref(null);async function R(t){if(p()){if((await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.unsaved_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===0)return!1;Q(void 0,{force:!0})}return await t(),!0}function ue(t,l,i){$.value&&clearTimeout($.value),l?K.value=t:c.value==="imported"?K.value=y.value[t.key]??t:K.value=d.value[t.key]??S.value?.items[t.key]??t}function ve(t){$.value=setTimeout(()=>{K.value=null},400)}const y=e.ref({}),le="default-translate.importFile";async function me(){return await Editor.Profile.getTemp(e.MainName,le)||""}function _e(t){Editor.Profile.setTemp(e.MainName,le,t)}function ne(t){if(c.value!==oe[t])switch(t){case 0:case 1:case 2:c.value=oe[t];break;default:c.value=oe[0];break}}return{isConflictSelectAll:ae,onConflictItemClick:ie,onConflictItemSelectAllClick:se,selectedConflictItemIndexSet:b,conflictItemsBetweenImportedFilesAndTranslatedFiles:W,importedTranslateItemMap:y,MainName:e.MainName,hasTranslateProvider:f,onItemBlur:ve,onItemMouseDown:ue,isTargetTranslateDataHasEmptyMedia:de,currentTranslateDataItems:k,currentSelectedItem:K,isSameLanguage:a,untranslatedTranslateDataItems:u,translatedTranslateDataItems:x,getDisplayNameOfTargetItem(t){let l;if(c.value==="imported")l=y.value[t];else{const i=d.value[t],v=S.value?.items[t];l=i??v}return l?l.type===j.TranslateItemType.Media?l?.displayName??t:l?.value??"":""},getDisplayNameOfLocalItem(t){let l;return c.value==="imported"?(l=s.value?.items[t]??y.value[t],l.value):(l=s.value?.items[t],l?.type===j.TranslateItemType.Media?l.displayName||t:a.value?t:l?.displayName||"")},positionOfAssociation:e.computed(()=>{if(!K.value)return[];const t=B.find(i=>i.key===K.value.key);if(!t)return[];const l=t.associations.filter(i=>i.assetInfo).map(i=>T.relative(Editor.Project.path,i.assetInfo.file));return Array.from(new Set(l)).map(i=>new G(i))}),nodeUuidOfAssociation:e.computed(()=>{if(!K.value)return[];const t=B.find(l=>l.key===K.value.key);return t?Array.from(new Set(t.associations.filter(l=>l.nodeUuid).map(l=>l.nodeUuid))).map(l=>new G(l)):[]}),onSaveClick:D,targetPanelTranslateData:S,localPanelTranslateData:s,currentVariantsItem:N,changedTranslateItemMap:d,TranslateItemType:e.ref(j.TranslateItemType),onTabClick:ne,importedTranslateData:e.ref([]),currentTab:c,Tab:e.ref(oe),async onInputChanged(t,l){let i;if(c.value==="imported"){const v=y.value[t];v.value=l;return}else i=d.value[t]??S.value?.items[t]??s.value?.items[t];if(!i){console.error(`cannot find item with key ${t}`);return}if(i.type===j.TranslateItemType.Media)if(l==="")g(i,"","",void 0,i._variants,i.associations);else{const v=s.value?.items[t];if(!v){console.error(`cannot find item with key ${t} from local`);return}const h=await _.wrapper.getFileInfoByUUIDOrPath(T.join(e.ProjectAssetPath,l));h&&T.extname(v.displayName||"")===T.extname(l)&&g(i,h.uuid,_.WrapperTranslateItem.getDisplayName({item:i,assetInfo:h}),h,i._variants,i.associations)}else g(i,l,_.WrapperTranslateItem.getDisplayName({item:i,value:l}),null,i._variants,i.associations)},async onTranslateClick(){await R(async()=>{H(await _.wrapper.autoTranslate(S.value.locale))})},variantKeys:X,onVariantsClick(t){const l=S.value?.items[t],i=d.value[t],v=y.value[t];if(c.value==="imported"&&v)N.value=_.WrapperTranslateItem.parse(v);else if(i)N.value=_.WrapperTranslateItem.parse(i);else if(l)N.value=_.WrapperTranslateItem.parse(l);else{console.error("An item that does not have a value should not be able to set variations",`key:${t}`);return}for(let V=0;V<X.value.length;V++){const w=X.value[V],A=`${t}_${w}`;l?._variants.find(Y=>Y.key===A)||N.value._variants.push(new _.WrapperTranslateItem(A,"",N.value.type,"",null,void 0,void 0,!0))}function h(V){const w=V.split("_");if(w.length){const A=w[w.length-1];return X.value.findIndex(U=>U===A)}else return-1}N.value._variants=N.value._variants.sort((V,w)=>h(V.key)-h(w.key))},onVariantsConfirm(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value._variants=N.value._variants.filter(t=>t.value),I=!0,Q([N.value],{mergeOptions:{replaceVariant:!0}}),N.value=null},onVariantsCancel(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value=null},async onVariantsDelete(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}(await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.delete_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")]})).response===1&&(N.value._variants=[],I=!0,await Q([N.value])),N.value=null},isVariantsDisable(t){if(c.value==="imported")return!1;{const l=d.value[t],i=S.value?.items[t];return l?.value===""||!l&&!i?.value}},isDeleteVariantsDisable:e.computed(()=>!N.value?._variants.some(t=>t.value)),async onImportAllClick(){await R(async()=>{const t=s.value.locale,l=u.value.filter(h=>h?.type===j.TranslateItemType.Media).length,i=Editor.I18n.t(e.MainName+".translate.auto_import_warning").replace("{length}",l.toString()).replace("{localLocale}",t).replace("{targetLocale}",r.targetLocale);if((await Editor.Dialog.info(i,{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response){const h=await _.wrapper.importFilesFromDirectory(r.targetLocale,t,r.targetLocale);H(h)}})},async onFileInputClick(){await R(async()=>{ne(2);const t=await Editor.Dialog.select({extensions:"po,csv,xlsx",multi:!1,path:await me()});if(!t.canceled){const l=t.filePaths[0];_e(l);const i=ye(l),v=S.value.bcp47Tag;let h=await _.wrapper.importTranslateFile(l,i,v);const V=h.filter(w=>y.value[w.key]);if(V.length){const U=(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.import_file_conflicts_with_file_warning").replace("{num}",V.length.toString()),{buttons:[Editor.I18n.t(e.MainName+".translate.jump"),Editor.I18n.t(e.MainName+".translate.cover"),Editor.I18n.t(e.MainName+".translate.cancel")],cancel:2})).response;if(U===0)h=h.filter(Y=>!V.includes(Y)).concat(V);else if(U===1){const Y=Object.values(y.value).filter(fe=>!V.some(he=>he.key===fe.key));h=h.concat(Y)}else if(U===2)return}for(let w=0;w<h.length;w++){const A=h[w];y.value[A.key]=A}}})},async onImportClick(t){const l=s.value.items[t]??d.value[t]??S.value?.items[t];if(!l?.assetInfo){console.error(`[${e.MainName}]: item has not assetInfo`,l);return}const i=T.extname(l.assetInfo.file).replace(".",""),v=await Editor.Dialog.select({multi:!1,path:e.ProjectAssetPath,type:"file",extensions:i});if(!v.canceled){const h=await _.wrapper.getFileInfoByUUIDOrPath(v.filePaths[0]);if(h){const V=h.uuid,w=_.WrapperTranslateItem.getDisplayName({assetInfo:h});g(l,V,w,h,l._variants,l.associations)}else console.error("A non-project resource was selected,please select another resource.")}},onConflictCancelClick(){W.value=[],b.value.clear(),I=!1},async onConflictConfirmClick(){await Q(Array.from(b.value).map(t=>W.value[t]),{force:!0})},async onHomeClick(){Object.keys(d.value).length>0?(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.quit_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===1&&o("home"):o("home")}}}},$t={class:"translate"},el={class:"toolbar container"},al=e.createBaseVNode("ui-icon",{value:"arrow-triangle",style:{transform:"rotate(90deg)"}},null,-1),tl=e.createBaseVNode("ui-icon",{value:"import"},null,-1),ll=["value"],nl=e.createBaseVNode("ui-icon",{style:{display:"inline-block","margin-right":"4px"},value:"save"},null,-1),ol=["value"],rl={class:"tabs container"},il=["value"],sl=["value"],cl=["value"],dl=["value"],ul=["value"],vl={class:"div"},ml={class:"table"},_l={class:"tr head"},fl={class:"th"},hl={tabindex:"0"},pl={class:"container"},gl=["value"],Nl=["value"],Vl={class:"th"},Bl={tabindex:"0"},kl={class:"container"},wl=["value"],bl=["value"],yl=["value"],Cl=["value"],xl={class:"td",tabindex:"0"},Il={class:"td"},Tl={class:"container"},Pl=["value"],Sl=["value"],El=["value"],Dl=["value"],Ll=["value"],Ml=["value"],Fl=["value"],Kl=["value"],Al={key:0,class:"variants"},Gl={class:"header"},Ol=["value"],Wl={class:"body"},jl={class:"tr"},Ul={class:"th"},zl={tabindex:"0"},ql=["value"],Hl={class:"th"},Xl={tabindex:"0",class:"container"},Rl=["value"],Jl={class:"td"},Ql={class:"td"},Yl={class:"container"},Zl={class:"footer"},$l={class:"container"},en={style:{flex:"1"}},an=["value"],tn=["value"],ln=["value"],nn={class:"conflict"},on={class:"content"},rn={class:"header"},sn=["value"],cn={class:"body"},dn=["value"],un={class:"table"},vn={class:"tr head"},mn={class:"th"},_n=["value"],fn={class:"th"},hn=["value"],pn={class:"th"},gn=["value"],Nn={class:"th"},Vn=["value"],Bn={class:"td"},kn=["value","onChange"],wn={class:"td"},bn=["value"],yn={class:"td"},Cn=["value"],xn={class:"td"},In=["value"],Tn={class:"footer"},Pn=["value"],Sn=["value"];function En(r,o,f,a,k,B){const u=e.resolveComponent("m-button"),x=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",$t,[e.createBaseVNode("head",null,[e.createBaseVNode("div",el,[e.createVNode(u,{onConfirm:a.onHomeClick},{default:e.withCtx(()=>[al]),_:1},8,["onConfirm"]),e.createVNode(u,{onConfirm:a.onFileInputClick},{default:e.withCtx(()=>[tl,e.createBaseVNode("ui-label",{color:"",i18n:"",value:`${a.MainName}.translate.import_file`},null,8,ll)]),_:1},8,["onConfirm"]),e.createVNode(u,{onConfirm:a.onSaveClick},{default:e.withCtx(()=>[nl,e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.save"},null,8,ol)]),_:1},8,["onConfirm"])])]),e.createBaseVNode("body",null,[e.createBaseVNode("div",rl,[e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[0]}]),onClick:o[0]||(o[0]=c=>a.onTabClick(0))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.unfilled"},null,8,il),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.untranslated"},null,8,sl),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[1]}]),onClick:o[1]||(o[1]=c=>a.onTabClick(1))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.filled"},null,8,cl),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translate"},null,8,dl),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[2]}]),onClick:o[2]||(o[2]=c=>a.onTabClick(2))},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_tab_title"},null,8,ul)],2)]),e.createBaseVNode("div",vl,[e.createBaseVNode("div",ml,[e.createBaseVNode("div",_l,[e.createBaseVNode("div",fl,[e.createBaseVNode("div",hl,[e.createBaseVNode("div",pl,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.localPanelTranslateData.displayName},null,8,gl)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,Nl)):e.createCommentVNode("",!0)])])]),e.createBaseVNode("div",Vl,[e.createBaseVNode("div",Bl,[e.createBaseVNode("div",kl,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.targetPanelTranslateData.displayName},null,8,wl)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.origin"},null,8,bl)):e.createCommentVNode("",!0)]),e.withDirectives(e.createVNode(u,{color:"blue",disabled:!a.hasTranslateProvider,onConfirm:a.onTranslateClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translate"},null,8,yl)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,!a.isSameLanguage&&a.currentTab===a.Tab[0]]]),e.withDirectives(e.createVNode(u,{color:"blue",disabled:!a.isTargetTranslateDataHasEmptyMedia,onConfirm:a.onImportAllClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_all"},null,8,Cl)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,a.currentTab===a.Tab[0]&&!a.isSameLanguage]])])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentTranslateDataItems,c=>(e.openBlock(),e.createElementBlock("div",{key:c.key,class:"tr"},[e.createBaseVNode("div",xl,[e.createBaseVNode("div",null,[e.createVNode(x,{style:{flex:"1"},"is-textarea":!0,"model-value":a.getDisplayNameOfLocalItem(c.key),readonly:!0,onClick:d=>a.onItemMouseDown(c,!0,d),onBlur:a.onItemBlur},null,8,["model-value","onClick","onBlur"])])]),e.createBaseVNode("div",Il,[e.createBaseVNode("div",Tl,[e.createVNode(x,{"is-textarea":!0,"model-value":a.getDisplayNameOfTargetItem(c.key),readonly:a.isSameLanguage&&c.type===a.TranslateItemType.Media,onBlur:a.onItemBlur,onClick:d=>a.onItemMouseDown(c,!1,d),"onUpdate:modelValue":d=>a.onInputChanged(c.key,d)},{default:e.withCtx(()=>[c.type===a.TranslateItemType.Media&&!a.isSameLanguage?(e.openBlock(),e.createBlock(u,{key:0,class:"import",color:"blue",onConfirm:d=>a.onImportClick(c.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import"},null,8,Pl)]),_:2},1032,["onConfirm"])):e.createCommentVNode("",!0),c.type!==a.TranslateItemType.Media?(e.openBlock(),e.createBlock(u,{key:1,color:"blue",disabled:a.isVariantsDisable(c.key),onConfirm:d=>a.onVariantsClick(c.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.variant"},null,8,Sl)]),_:2},1032,["disabled","onConfirm"])):e.createCommentVNode("",!0)]),_:2},1032,["model-value","readonly","onBlur","onClick","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("footer",null,[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",value:a.MainName+".translate.key:",i18n:""},null,8,El),e.createBaseVNode("ui-label",{value:a.currentSelectedItem?.key||""},null,8,Dl)]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.position:"},null,8,Ll),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.positionOfAssociation,c=>(e.openBlock(),e.createElementBlock("ui-label",{key:c.__key,value:c.value},null,8,Ml))),128))]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.reference_uuid"},null,8,Fl),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.nodeUuidOfAssociation,c=>(e.openBlock(),e.createElementBlock("ui-label",{key:c.__key,value:c.value},null,8,Kl))),128))])]),a.currentVariantsItem?(e.openBlock(),e.createElementBlock("div",Al,[e.createBaseVNode("div",null,[e.createBaseVNode("div",Gl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.variant"},null,8,Ol)]),e.createBaseVNode("div",Wl,[e.createBaseVNode("div",null,[e.createBaseVNode("div",{class:"table",onClick:o[3]||(o[3]=e.withModifiers(()=>{},["stop"]))},[e.createBaseVNode("div",jl,[e.createBaseVNode("div",Ul,[e.createBaseVNode("div",zl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.standard",class:"weakWhite"},null,8,ql)])]),e.createBaseVNode("div",Hl,[e.createBaseVNode("div",Xl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.after_variant",class:"weakWhite",style:{flex:"1"}},null,8,Rl)])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentVariantsItem._variants,(c,d)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"tr"},[e.createBaseVNode("div",Jl,[e.createBaseVNode("div",null,[e.createVNode(x,{"model-value":a.variantKeys[d],readonly:!0},null,8,["model-value"])])]),e.createBaseVNode("div",Ql,[e.createBaseVNode("div",Yl,[e.createVNode(x,{modelValue:c.value,"onUpdate:modelValue":g=>c.value=g,"is-textarea":!0},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("div",Zl,[e.createBaseVNode("div",$l,[e.createBaseVNode("div",en,[e.createVNode(u,{color:"blue",disabled:a.isDeleteVariantsDisable,onConfirm:a.onVariantsDelete},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.delete_variant"},null,8,an)]),_:1},8,["disabled","onConfirm"])]),e.createBaseVNode("div",null,[e.createVNode(u,{"has-border":!0,onConfirm:a.onVariantsCancel},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,tn)]),_:1},8,["onConfirm"]),e.createVNode(u,{"has-border":!0,style:{"margin-left":"16px"},onConfirm:a.onVariantsConfirm},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.confirm"},null,8,ln)]),_:1},8,["onConfirm"])])])])])])):e.createCommentVNode("",!0),e.withDirectives(e.createBaseVNode("div",nn,[e.createBaseVNode("div",on,[e.createBaseVNode("div",rn,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.save"},null,8,sn)]),e.createBaseVNode("div",cn,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.conflict_dialog_content"},null,8,dn),e.createBaseVNode("div",null,[e.createBaseVNode("div",un,[e.createBaseVNode("div",vn,[e.createBaseVNode("div",mn,[e.createBaseVNode("ui-checkbox",{value:a.isConflictSelectAll,onChange:o[4]||(o[4]=c=>a.onConflictItemSelectAllClick(c.target.value))},null,40,_n)]),e.createBaseVNode("div",fn,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,hn)]),e.createBaseVNode("div",pn,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.old_value"},null,8,gn)]),e.createBaseVNode("div",Nn,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.new_value"},null,8,Vn)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.conflictItemsBetweenImportedFilesAndTranslatedFiles,(c,d)=>(e.openBlock(),e.createElementBlock("div",{key:c.key,class:"tr"},[e.createBaseVNode("div",Bn,[e.createBaseVNode("ui-checkbox",{value:a.selectedConflictItemIndexSet.has(d),onChange:g=>a.onConflictItemClick(g.target.value,d)},null,40,kn)]),e.createBaseVNode("div",wn,[e.createBaseVNode("ui-label",{value:c.key},null,8,bn)]),e.createBaseVNode("div",yn,[e.createBaseVNode("ui-label",{value:a.targetPanelTranslateData?.items[c.key]?.value??c.value},null,8,Cn)]),e.createBaseVNode("div",xn,[e.createBaseVNode("ui-label",{value:a.importedTranslateItemMap[c.key].value},null,8,In)])]))),128))])])]),e.createBaseVNode("div",Tn,[e.createVNode(u,{"has-border":!0,transparent:!0,disabled:a.selectedConflictItemIndexSet.size===0,onConfirm:a.onConflictConfirmClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cover"},null,8,Pn)]),_:1},8,["disabled","onConfirm"]),e.createVNode(u,{"has-border":!0,transparent:!0,onConfirm:a.onConflictCancelClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,Sn)]),_:1},8,["onConfirm"])])])],512),[[e.vShow,a.conflictItemsBetweenImportedFilesAndTranslatedFiles.length]])])}var Dn=e._export_sfc(Zt,[["render",En]]);const Ln={components:{Home:Yt,Translate:Dn},setup(){const r=e.ref(""),o=e.ref(0);function f(a){Editor.Dialog.error(a.message),console.error(a)}return e.onMounted(()=>{J.eventBus.on("onCustomError",f)}),e.onUnmounted(()=>{J.eventBus.off("onCustomError",f)}),{tabIndex:o,targetLocale:r,onTranslateClick(a){r.value=a,o.value=1},onHomeClick(){J.eventBus.emit("updateAllLanguageConfig"),o.value=0}}}},Mn=r=>(e.pushScopeId("data-v-55882d8d"),r=r(),e.popScopeId(),r),Fn=Mn(()=>e.createBaseVNode("div",{class:"fallback"},[e.createBaseVNode("ui-loading")],-1));function Kn(r,o,f,a,k,B){const u=e.resolveComponent("Home"),x=e.resolveComponent("Translate");return e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createBaseVNode("div",null,[e.withDirectives(e.createVNode(u,{onTranslate:a.onTranslateClick},null,8,["onTranslate"]),[[e.vShow,a.tabIndex===0]]),a.tabIndex===1?(e.openBlock(),e.createBlock(x,{key:0,"target-locale":a.targetLocale,onHome:a.onHomeClick},null,8,["target-locale","onHome"])):e.createCommentVNode("",!0)])]),fallback:e.withCtx(()=>[Fn]),_:1})}var An=e._export_sfc(Ln,[["render",Kn],["__scopeId","data-v-55882d8d"]]);class Z{constructor(o,f,a,k,B){this.bcp47Tag=o,this.displayName=f,this.fontName=a,this.localFontName=k,this.items=B}get locale(){return this.bcp47Tag}static async getPanelTranslateData(o){const f=await _.wrapper.getTranslateData(o),a=await _.wrapper.getLanguageConfig(o),k=await _.wrapper.getLocalLanguage();if(!a||!k)return null;const B={};for(let u=0;u<f.length;u++){const x=f[u];B[x.key]={...x,index:u}}return new Z(a.bcp47Tag,L.getLanguageDisplayName(a.bcp47Tag),"","",B)}}const Gn=re.readJsonSync(T.join(__dirname,"../../static/plural-rules/plural-rules.json"),{encoding:"utf8"}),ke=new WeakMap;module.exports=Editor.Panel.define({listeners:{show(){},hide(){}},template:'<div id="app"></div>',style:re.readFileSync(T.join(__dirname,"./index.css"),{encoding:"utf8"})+e.commonCss,$:{app:"#app"},ready(){if(this.$.app){const r=e.createApp(An);r.mount(this.$.app),ke.set(this,r)}},methods:{executePanelMethod(r,...o){J.eventBus.emit(r,...o)}},beforeClose(){},close(){const r=ke.get(this);r&&r.unmount()}});
