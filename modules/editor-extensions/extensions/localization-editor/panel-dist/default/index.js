"use strict";var de=require("fs-extra"),P=require("path"),e=require("../share/scripts/global.js"),J=require("../../dist/virtual-modules/EventBus"),v=require("../../dist/virtual-modules/Wrapper"),Pe=require("electron"),Se=require("@electron/remote"),Ee=require("fs"),D=require("../share/scripts/languageMap.js"),O=require("../share/scripts/TranslateItemType.js");function xe(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var Ve=xe(Pe),we=xe(Se);const De={props:{transparent:{type:Boolean,required:!1,default:!0},hasBorder:{type:Boolean,required:!1,default:!1},color:{type:String,required:!1,default:"white"},disabled:{type:Boolean,required:!1,default:!1}}},Le=["transparent","border","color","disabled"];function Me(r,n,f,a,g,k){return e.openBlock(),e.createElementBlock("ui-button",{class:"button",transparent:f.transparent,border:f.hasBorder,color:f.color,disabled:f.disabled},[e.renderSlot(r.$slots,"default",{},void 0,!0)],8,Le)}var Ie=e._export_sfc(De,[["render",Me],["__scopeId","data-v-55077cbe"]]);const Fe={components:{"m-input":O.mInput},props:{modelValue:String,checkFileExist:Boolean,checkEmpty:Boolean,placeholder:String},emits:["blur","update:modelValue"],setup:(r,{emit:n})=>{const f=e.ref(!r.checkFileExist||de.existsSync(P.join(e.ProjectAssetPath,r.modelValue??"")));function a(k){n("update:modelValue",k)}function g(k){r.checkFileExist&&(f.value=de.existsSync(P.join(e.ProjectAssetPath,r.modelValue??"")))}return{isFileExist:f,onModelUpdate:a,onBlur:g}},computed:{showIcon(){return this.checkEmpty&&this.modelValue===""||this.checkFileExist&&!this.isFileExist},tooltip(){return this.modelValue===""&&this.checkEmpty?"i18n:"+e.MainName+".cannot_empty":"i18n:"+e.MainName+".file_no_exist"}}},Ke={class:"mFile"},Ae=["tooltip"],Ge={class:"label"};function je(r,n,f,a,g,k){const _=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",Ke,[e.withDirectives(e.createBaseVNode("ui-prop",{style:{width:"0px"},tooltip:k.tooltip},[e.renderSlot(r.$slots,"icon",{},()=>[e.createTextVNode(" ! ")],!0)],8,Ae),[[e.vShow,k.showIcon]]),e.createBaseVNode("div",Ge,[e.renderSlot(r.$slots,"label",{},void 0,!0)]),e.createVNode(_,{"no-vertical-padding":"",class:"mInput",placeholder:f.placeholder,"model-value":f.modelValue,onBlur:r.onBlur,"onUpdate:modelValue":r.onModelUpdate},{default:e.withCtx(()=>[e.renderSlot(r.$slots,"inputIcon",{},void 0,!0)]),_:3},8,["placeholder","model-value","onBlur","onUpdate:modelValue"])])}var We=e._export_sfc(Fe,[["render",je],["__scopeId","data-v-24f0d3aa"]]);const Oe={props:{value:Number,color:{type:String,default:"blue"}}},Ue={class:"mProcess"},ze=["color"];function qe(r,n,f,a,g,k){return e.openBlock(),e.createElementBlock("div",Ue,[e.createBaseVNode("div",{class:"content",style:e.normalizeStyle({width:f.value*100+"%"}),color:f.color},null,12,ze)])}var He=e._export_sfc(Oe,[["render",qe],["__scopeId","data-v-665a2fce"]]);const Xe={components:{"m-icon":O.mIcon},props:{modelValue:Boolean},setup(r,{emit:n}){function f(){n("update:modelValue",!r.modelValue)}return{clickIcon:f}}},Re={class:"mSection"},Je={class:"content"};function Qe(r,n,f,a,g,k){const _=e.resolveComponent("m-icon");return e.openBlock(),e.createElementBlock("div",Re,[e.createBaseVNode("div",{class:"header",onClick:n[0]||(n[0]=(...C)=>a.clickIcon&&a.clickIcon(...C))},[e.createVNode(_,{style:{"margin-right":"2px"},class:"icon",background:!1,value:"arrow-triangle","upside-down":f.modelValue},null,8,["upside-down"]),e.renderSlot(r.$slots,"header",{},void 0,!0)]),e.withDirectives(e.createBaseVNode("div",Je,[e.renderSlot(r.$slots,"content",{},void 0,!0)],512),[[e.vShow,f.modelValue]])])}var Ye=e._export_sfc(Xe,[["render",Qe],["__scopeId","data-v-4d579e52"]]);class A{constructor(n){this.value=n,this.__key=`${Date.now().toString()}-${Math.random()}`}}function be(r,n=[]){const f=Object.keys(D.languageMap),a=["zh","en","fr","ru","ja","ko","es","ar"],g=a.map(c=>D.getLanguageDisplayName(c)),k=f.map(c=>({label:D.getLanguageDisplayName(c),sublabel:c===a[a.length-1]?Editor.I18n.t(e.MainName+".common_languages"):void 0,submenu:D.languageMap[c].map(N=>{const d=D.getLanguageDisplayName(N);return{label:d,click:()=>{r(N,d??N)},enabled:!n.includes(N)}}).filter(Boolean)})).filter(Boolean),_=k.filter(c=>g.includes(c.label)).sort((c,V)=>g.indexOf(c.label)-g.indexOf(V.label)),C=k.filter(c=>!f.find(V=>c.label===V)&&!_.includes(c)).sort((c,V)=>(c.label??"").localeCompare(V.label??"")),s=k.filter(c=>f.find(V=>c.label===V)&&!_.includes(c)).sort();Editor.Menu.popup({menu:[..._,{type:"separator"},...C,...s]})}var q=(r=>(r[r.PO=0]="PO",r[r.CSV=1]="CSV",r[r.XLSX=2]="XLSX",r))(q||{});function Te(r){let n;const f=P.extname(r);if(f===".po")n=q.PO;else if(f===".csv")n=q.CSV;else if(f===".xlsx")n=q.XLSX;else throw new Error(`[${e.MainName}]: cannot get TranslateFileType of ${r}`);return n}function Ze(r){if(r===q.PO)return".po";if(r===q.CSV)return".csv";if(r===q.XLSX)return".xlsx";throw new Error(`[${e.MainName}]: cannot get ExtName of ${r}`)}class Ce{constructor(n,f,a,g){this.expanded=n,this.dirs=f,this.exts=a,this.excludes=g}}const $e={components:{"m-input":O.mInput,"m-file":We,"m-process":He,"m-icon":O.mIcon,"m-button":Ie,"m-section":Ye},emits:["translate"],async setup(r,{emit:n}){e.onMounted(()=>{J.eventBus.on("scanProgress",g),J.eventBus.on("updateAllLanguageConfig",k)}),e.onUnmounted(()=>{J.eventBus.off("scanProgress",g),J.eventBus.off("updateAllLanguageConfig",k)});const f=e.computed(()=>D.getLanguageDisplayName(M.value?.bcp47Tag,"none")??""),a=e.ref(-1);function g(o,u){x.value=u&&o/u,a.value=o}async function k(){L.value=(await v.wrapper.getAllLanguageConfigs()).map(o=>new A(o)),M.value=await v.wrapper.getLocalLanguageConfig()}const _=e.ref(await v.wrapper.getTranslateProviders()),C=e.ref(!1),s=e.ref(!1),c=e.ref(await v.wrapper.getCurrentTranslateProvider());function V(o){c.value&&(s.value=!0,c.value.appKey=o)}function N(o){c.value&&(s.value=!0,c.value.appSecret=o)}async function d(o){const u=o.target.value;u==="None"?(await v.wrapper.clearTranslateProvider(),c.value=void 0,S.value=!1):c.value=await v.wrapper.getTranslateProvider(u)??{appKey:"",appSecret:"",name:u,qps:0,url:""},s.value=!0}const w=e.ref(await v.wrapper.getProviderLanguages(c.value?.name));async function p(o,u){const T=o.target.value,E=Object.entries(w.value).find(([K,z])=>z===T)?.[0];if(E){const K=L.value[u].value;K.providerTag=E,await v.wrapper.setLanguageConfig(K)}}const S=e.ref(!!c.value),I=e.computed(()=>!c.value?.appKey||!c.value?.appSecret||!s.value);async function Q(){c.value&&(C.value=!0,await v.wrapper.setCurrentTranslateProvider(c.value),C.value=!1,s.value=!1,S.value=!0,w.value=await v.wrapper.getProviderLanguages(c.value?.name),k())}const $=await v.wrapper.getScanOptions();$.length===0&&$.push({dirs:[""],excludes:[],extNames:[]});const y=e.ref($.map(o=>new A(new Ce(!0,{expanded:!0,items:o.dirs.map(u=>new A(u))},{expanded:!0,items:o.extNames.map(u=>new A(u))},{expanded:!0,items:o.excludes.map(u=>new A(u))}))));function j(o){y.value.splice(o,1)}function ue(){y.value.push(new A(new Ce(!0,{expanded:!0,items:[new A("")]},{expanded:!0,items:[]},{expanded:!0,items:[]})))}async function le(o,u){const T=P.join(Editor.Project.path,"assets"),E=await Editor.Dialog.select({multi:!1,type:"directory",path:T});if(!E.canceled){const K=P.relative(e.ProjectAssetPath,E.filePaths[0]);return y.value[o].value.dirs.items.find(z=>z.value===K)||(y.value[o].value.dirs.items[u].value=K),E}}async function ve(o,u){const T=P.join(Editor.Project.path,"assets"),E=await Editor.Dialog.select({multi:!1,type:"directory",path:T});if(!E.canceled){const K=P.relative(e.ProjectAssetPath,E.filePaths[0]);return y.value[o].value.excludes.items.find(z=>z.value===K)||(y.value[o].value.excludes.items[u].value=K),E}}function ne(o,u){y.value[o].value[u].items.push(new A("")),y.value[o].value[u].expanded=!0}function me(o,u,T){y.value[o].value[T].items.splice(u,1)}const x=e.ref(-1),H=e.ref(!1),Y=e.computed(()=>y.value.some(o=>o.value.dirs.items.some(u=>!Editor.Utils.Path.contains(e.ProjectAssetPath,P.join(e.ProjectAssetPath,u.value))||!Ee.existsSync(P.join(e.ProjectAssetPath,u.value))))),W=e.computed(()=>Y.value||H.value||!y.value.length||!M.value);async function _e(){return H.value=!0,a.value=0,x.value=0,await v.wrapper.scan(y.value.map(o=>({dirs:o.value.dirs.items.map(u=>u.value),extNames:o.value.exts.items.map(u=>u.value),excludes:o.value.excludes.items.map(u=>u.value)}))),x.value=-1,H.value=!1,k()}const X=e.ref([]);async function ae(){const o=await Editor.Dialog.select({extensions:"po"});if(!o.canceled){const u=o.filePaths.filter(T=>!X.value.find(E=>E.value===T));X.value.push(...u.map(T=>new A(T)))}}function fe(o){X.value.splice(o,1)}const L=e.ref((await v.wrapper.getAllLanguageConfigs()).map(o=>new A(o)));console.debug("All language data",L);const M=e.ref(await v.wrapper.getLocalLanguageConfig());console.debug("Data for the current language",M);function he(o){n("translate",L.value[o].value.bcp47Tag)}async function oe(o){const u=L.value[o].value.bcp47Tag;await v.wrapper.previewBy(u),await Editor.Panel.focus("scene")}async function F(o){await v.wrapper.removeLanguage(L.value[o].value.bcp47Tag)!==!1&&await k()}async function Be(o){let u,T;const E=L.value[o].value.bcp47Tag,K=await se(),z=P.join(P.dirname(K),`${E}`),ke=await Editor.Dialog.save({filters:[{name:Editor.I18n.t(`${D.name}.home.po_name`),extensions:["po"]},{name:Editor.I18n.t(`${D.name}.home.csv_name`),extensions:["csv"]},{name:Editor.I18n.t(`${D.name}.home.xlsx_name`),extensions:["xlsx"]}],path:z});!ke.canceled&&ke.filePath&&(u=ke.filePath,t(u),T=Te(u),await v.wrapper.exportTranslateFile(u,T,E),we.default.shell.showItemInFolder(u))}const te="panel.default-home",re=`${te}.lastFile`,ie=`${te}.lastDir`;async function se(){return await Editor.Profile.getTemp(D.name,re)||""}async function pe(){return await Editor.Profile.getTemp(D.name,ie)||""}function t(o){Editor.Profile.setTemp(D.name,re,o)}function l(o){Editor.Profile.setTemp(D.name,ie,o)}async function i(){const o=await Editor.Dialog.select({type:"directory",multi:!1,path:await pe()});if(!o.canceled){const u=o.filePaths[0];return l(u),u}return""}async function m(o,u){let T;await Promise.all(L.value.map(async E=>{const K=Ze(u),z=P.join(o,`${E.value.bcp47Tag}${K}`);return T||(T=z),await v.wrapper.exportTranslateFile(z,u,E.value.bcp47Tag)})),T&&we.default.shell.showItemInFolder(T)}async function h(){Editor.Menu.popup({menu:[{label:"po",async click(){const o=await i();o&&await m(o,q.PO)}},{label:"csv",async click(){const o=await i();o&&await m(o,q.CSV)}},{label:"xlsx",async click(){const o=await i();o&&await m(o,q.XLSX)}}]})}function B(){be(async(o,u)=>{await v.wrapper.addTargetLanguage(o),await k()},L.value.map(o=>o.value.bcp47Tag))}function b(){be(async o=>{await v.wrapper.setLocalLanguage(o),await k()},[M?.value?.bcp47Tag??""])}function U(o){return M.value?.translateTotal?o.value.translateFinished/M.value.translateTotal:0}function R(o){return M.value?`${M.value.translateTotal&&Math.floor(o.value.translateFinished*100/M.value.translateTotal)}%(${v.wrapper.numberFormat(o.value.translateFinished)}/${v.wrapper.numberFormat(M.value.translateTotal)})`:"0%"}function Z(o){o==="i18n"?Ve.default.shell.openExternal("https://docs.cocos.com/creator/manual/zh/editor/l10n/overview.html"):Ve.default.shell.openExternal("https://docs.cocos.com/creator/manual/zh/editor/l10n/collect-and-count.html")}function ge(){Editor.Menu.popup({menu:[{label:Editor.I18n.t("localization-editor.home.turn_off"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.turn_off_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")]})).response!==1&&(await Ne(),await k())}},{label:Editor.I18n.t("localization-editor.home.delete_data"),async click(){(await Editor.Dialog.warn(Editor.I18n.t("localization-editor.home.delete_data_warning"),{buttons:[Editor.I18n.t("localization-editor.confirm"),Editor.I18n.t("localization-editor.cancel")],cancel:1})).response!==1&&await v.wrapper.uninstall()}}]})}async function Ne(){n("toggle",await v.wrapper.toggle())}return{onExportAllClick:h,onMenuClick:ge,currentCollectCount:a,isCurrentServiceDirty:s,isCurrentServiceLoading:C,onAppKeyUpdate:V,onAppSecretUpdate:N,onLinkClick:Z,onSelectNewLanguageClick:B,hasService:S,isCurrentServiceDisabled:I,getTranslateProcessDescription:R,isCollecting:H,isCollectingHasWrongDir:Y,isCollectionDisabled:W,collectionProgress:x,projectAssetPath:e.ref("db://assets/"),onSelectExcludeDirClick:ve,onSelectLocalClick:b,onScanClick:_e,currentService:c,onProviderSummitClick:Q,onSetCurrentTranslateProvider:d,currentLanguage:M,onAddCollectionClick:ue,onRemoveCollectionClick:j,collections:y,onAddToCollectionClick:ne,onSelectCollectionDirClick:le,onRemoveFromCollectionClick:me,PKGName:D.name,importedPOfiles:X,onImportPOClick:ae,onRemovePOClick:fe,panelTranslateDataList:L,providerLanguages:w,supportedServices:_,onTranslateClick:he,onPreviewClick:oe,onDeleteClick:F,onExportClick:Be,onProviderLanguageSelect:p,t:Editor.I18n.t,currentLanguageDisplayName:f,numberFormat:v.wrapper.numberFormat.bind(v.wrapper),getTranslateProcess:U}}},G=r=>(e.pushScopeId("data-v-5d487f9c"),r=r(),e.popScopeId(),r),ea={ref:"rootElement",class:"home"},aa={ref:"bodyElement",class:"body"},ta={class:"main"},la={class:"title"},na=G(()=>e.createBaseVNode("ui-label",{class:"strongWhite"}," L10N ",-1)),oa={ref:"serviceElement",class:"container service"},ra=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),ia=["value"],sa={class:"gray service"},ca={class:"container"},da={class:"left container"},ua=["value"],va=G(()=>e.createBaseVNode("span",null,":",-1)),ma=["value"],_a=G(()=>e.createBaseVNode("option",null,"None",-1)),fa=["value"],ha={key:0,class:"container"},pa=G(()=>e.createBaseVNode("ui-label",{class:"left"}," AppKey: ",-1)),ga={key:1,class:"container"},Na=G(()=>e.createBaseVNode("ui-label",{class:"left"}," AppSecret: ",-1)),ka={key:0,style:{"margin-top":"3px"}},Ba=["value"],Va=["value"],wa=["value"],ba={ref:"collectionElement",class:"container collect"},Ca=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),ya=["value"],xa={class:"gray collect"},Ia={class:"container",style:{"margin-bottom":"20px"}},Ta=G(()=>e.createBaseVNode("ui-label",{class:"red",style:{"margin-right":"0px"}}," * ",-1)),Pa=["value"],Sa=["placeholder"],Ea=["value"],Da={class:"container",style:{"margin-bottom":"5px"}},La={style:{flex:"1"},class:"container"},Ma=["value"],Fa=["value"],Ka={style:{flex:"1"}},Aa=["value"],Ga=["value"],ja={class:"parent"},Wa=["value"],Oa={class:"weakWhite",style:{"margin-right":"28px"}},Ua={class:"weakWhite",style:{"margin-right":"8px"}},za=["value"],qa={class:"parent"},Ha=["value"],Xa={class:"weakWhite",style:{"margin-right":"28px"}},Ra=G(()=>e.createBaseVNode("ui-label",{style:{"margin-right":"8px"}}," *. ",-1)),Ja=["value"],Qa={class:"parent"},Ya=["value"],Za={class:"weakWhite",style:{"margin-right":"28px"}},$a={class:"weakWhite",style:{"margin-right":"8px"}},et={class:"container",style:{"margin-top":"62px"}},at=["value"],tt=["value"],lt=["value"],nt=["value"],ot=["value"],rt=["value"],it={ref:"languageElement",class:"container language"},st=G(()=>e.createBaseVNode("div",{class:"ball shadow"},null,-1)),ct=["value"],dt={class:"gray language"},ut={class:"container",style:{"margin-bottom":"16px"}},vt=["value"],mt=["disabled"],_t=["value"],ft=["value"],ht=["value"],pt=["value"],gt=["value"],Nt=["value"],kt=["value"],Bt=["value"],Vt={key:0},wt=["placeholder","value","onConfirm"],bt={key:1},Ct=G(()=>e.createBaseVNode("ui-select",{disabled:""},null,-1)),yt=[Ct],xt={class:"container"},It=["tooltip","value"],Tt=["value"],Pt=["value"],St=["value"],Et=["value"],Dt=["value"],Lt=["value"],Mt=["placeholder"],Ft={class:"container"},Kt=G(()=>e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray"}," - ")],-1)),At={class:"container",style:{"flex-direction":"row-reverse","margin-top":"32px"}},Gt=["value"];function jt(r,n,f,a,g,k){const _=e.resolveComponent("m-icon"),C=e.resolveComponent("m-input"),s=e.resolveComponent("m-button"),c=e.resolveComponent("m-file"),V=e.resolveComponent("m-section"),N=e.resolveComponent("m-process");return e.openBlock(),e.createElementBlock("div",ea,[e.createBaseVNode("div",aa,[e.createBaseVNode("div",ta,[e.createBaseVNode("div",la,[na,e.createVNode(_,{style:{"margin-left":"5.5px",display:"inline-flex"},value:"help",onClick:n[0]||(n[0]=d=>a.onLinkClick("i18n"))}),e.createVNode(_,{value:"menu",style:{"margin-left":"auto"},onClick:n[1]||(n[1]=d=>a.onMenuClick())})]),e.createBaseVNode("div",oa,[ra,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".service_provider"},null,8,ia)],512),e.createBaseVNode("div",sa,[e.createBaseVNode("div",ca,[e.createBaseVNode("div",da,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".service_provider"},null,8,ua),va]),e.createBaseVNode("ui-select",{value:a.currentService?.name||"None",onConfirm:n[2]||(n[2]=(...d)=>a.onSetCurrentTranslateProvider&&a.onSetCurrentTranslateProvider(...d))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.supportedServices,d=>(e.openBlock(),e.createElementBlock("option",{key:d},e.toDisplayString(d),1))),128)),_a],40,ma),e.withDirectives(e.createBaseVNode("ui-label",{style:{"margin-left":"16px"},class:"weakGray",i18n:"",value:a.PKGName+".unselect_service_tip"},null,8,fa),[[e.vShow,!a.currentService]])]),a.currentService?(e.openBlock(),e.createElementBlock("div",ha,[pa,e.createVNode(C,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appKey,"onUpdate:modelValue":n[3]||(n[3]=d=>a.onAppKeyUpdate(d))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",ga,[Na,e.createVNode(C,{"no-vertical-padding":"",i18n:"","model-value":a.currentService.appSecret,"onUpdate:modelValue":n[4]||(n[4]=d=>a.onAppSecretUpdate(d))},null,8,["model-value"])])):e.createCommentVNode("",!0),a.currentService?(e.openBlock(),e.createElementBlock("div",{key:2,class:"footer",onConfirm:n[5]||(n[5]=(...d)=>a.onProviderSummitClick&&a.onProviderSummitClick(...d))},[e.createVNode(s,{"has-border":!0,color:"blue",disabled:a.isCurrentServiceDisabled},{default:e.withCtx(()=>[a.isCurrentServiceLoading?(e.openBlock(),e.createElementBlock("ui-loading",ka)):a.isCurrentServiceDirty?(e.openBlock(),e.createElementBlock("ui-label",{key:1,i18n:"",color:"",value:a.PKGName+".home.save"},null,8,Ba)):a.hasService?(e.openBlock(),e.createElementBlock("ui-label",{key:2,i18n:"",value:a.PKGName+".home.complete",color:""},null,8,Va)):(e.openBlock(),e.createElementBlock("ui-label",{key:3,i18n:"",value:a.PKGName+".home.save",color:""},null,8,wa))]),_:1},8,["disabled"])],32)):e.createCommentVNode("",!0)]),e.createBaseVNode("div",ba,[Ca,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".collection"},null,8,ya)],512),e.createBaseVNode("div",xa,[e.createBaseVNode("div",Ia,[Ta,e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".local_language"},null,8,Pa),e.createBaseVNode("ui-select",{placeholder:a.currentLanguageDisplayName||"i18n:"+a.PKGName+".home.select",style:{"margin-right":"17px"},onMousedown:n[6]||(n[6]=e.withModifiers((...d)=>a.onSelectLocalClick&&a.onSelectLocalClick(...d),["prevent"]))},null,40,Sa),e.withDirectives(e.createBaseVNode("ui-label",{class:"red",i18n:"",value:a.PKGName+".home.required"},null,8,Ea),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",Da,[e.createBaseVNode("div",La,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".collected_from_resource_files"},null,8,Ma),e.createVNode(_,{value:"help",onClick:n[7]||(n[7]=d=>a.onLinkClick("collection"))})]),e.createBaseVNode("ui-button",{onClick:n[8]||(n[8]=e.withModifiers(()=>{},["stop"])),onConfirm:n[9]||(n[9]=d=>a.onAddCollectionClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add"},null,8,Fa)],32)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.collections,(d,w)=>(e.openBlock(),e.createBlock(V,{key:d.__key,modelValue:d.value.expanded,"onUpdate:modelValue":p=>d.value.expanded=p,class:"frame",style:{"padding-right":"15px"}},{header:e.withCtx(()=>[e.createBaseVNode("div",Ka,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.collect_group"},null,8,Aa),e.createBaseVNode("ui-label",null,e.toDisplayString(w+1),1)]),e.createVNode(_,{value:"del",onClick:e.withModifiers(p=>a.onRemoveCollectionClick(w),["stop"])},null,8,["onClick"])]),content:e.withCtx(()=>[e.createVNode(V,{modelValue:d.value.dirs.expanded,"onUpdate:modelValue":p=>d.value.dirs.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.search_dir"},null,8,Ga),e.createVNode(_,{onClick:[n[10]||(n[10]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(w,"dirs")]},{default:e.withCtx(()=>[e.createTextVNode(" + ")]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.dirs.items,(p,S)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(c,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-file-exist":!0,style:{}},{icon:e.withCtx(()=>[e.createVNode(_,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",ja,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.dir"},null,8,Wa),e.createBaseVNode("ui-label",Oa,e.toDisplayString(S+1),1)]),e.createBaseVNode("ui-label",Ua,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(_,{value:"folder-open",onClick:I=>a.onSelectCollectionDirClick(w,S)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(_,{style:e.normalizeStyle({visibility:d.value.dirs.items.length>=2?void 0:"hidden"}),value:"del",onClick:I=>a.onRemoveFromCollectionClick(w,S,"dirs")},null,8,["style","onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(V,{modelValue:d.value.exts.expanded,"onUpdate:modelValue":p=>d.value.exts.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.extname"},null,8,za),e.createVNode(_,{onClick:[n[11]||(n[11]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(w,"exts")]},{default:e.withCtx(()=>[e.createTextVNode(" + ")]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.exts.items,(p,S)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(c,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-empty":!0},{icon:e.withCtx(()=>[e.createVNode(_,{color:"true",value:"warn-triangle",style:{"margin-right":"2px"}})]),label:e.withCtx(()=>[e.createBaseVNode("span",qa,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.extname"},null,8,Ha),e.createBaseVNode("ui-label",Xa,e.toDisplayString(S+1),1)]),Ra])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(_,{value:"del",onClick:I=>a.onRemoveFromCollectionClick(w,S,"exts")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(V,{modelValue:d.value.excludes.expanded,"onUpdate:modelValue":p=>d.value.excludes.expanded=p},{header:e.withCtx(()=>[e.createBaseVNode("ui-label",{style:{flex:"1"},i18n:"",value:a.PKGName+".home.exclude_path"},null,8,Ja),e.createVNode(_,{onClick:[n[12]||(n[12]=e.withModifiers(()=>{},["stop"])),p=>a.onAddToCollectionClick(w,"excludes")]},{default:e.withCtx(()=>[e.createTextVNode(" + ")]),_:2},1032,["onClick"])]),content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.excludes.items,(p,S)=>(e.openBlock(),e.createElementBlock("div",{key:p.__key,class:"container"},[e.createVNode(c,{modelValue:p.value,"onUpdate:modelValue":I=>p.value=I,"check-file-exist":!0},{icon:e.withCtx(()=>[e.createVNode(_,{color:"true",value:"warn-triangle"})]),label:e.withCtx(()=>[e.createBaseVNode("span",Qa,[e.createBaseVNode("span",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.exclude_path"},null,8,Ya),e.createBaseVNode("ui-label",Za,e.toDisplayString(S+1),1)]),e.createBaseVNode("ui-label",$a,e.toDisplayString(a.projectAssetPath),1)])]),inputIcon:e.withCtx(()=>[e.createVNode(_,{value:"folder-open",onClick:I=>a.onSelectExcludeDirClick(w,S)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.createVNode(_,{value:"del",onClick:I=>a.onRemoveFromCollectionClick(w,S,"excludes")},null,8,["onClick"])]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128)),e.createBaseVNode("div",et,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.count"},null,8,at),e.withDirectives(e.createVNode(N,{value:a.collectionProgress},null,8,["value"]),[[e.vShow,a.collectionProgress!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.numberFormat(a.currentCollectCount)},null,8,tt),[[e.vShow,a.currentCollectCount!==-1]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},value:a.currentLanguage?.translateTotal?a.numberFormat(a.currentLanguage?.translateTotal):""},null,8,lt),[[e.vShow,a.currentCollectCount===-1&&a.currentLanguage?.translateTotal]]),e.withDirectives(e.createBaseVNode("ui-label",{style:{flex:"1"},class:"weakGray",i18n:"",value:a.PKGName+".home.not_recorded"},null,8,nt),[[e.vShow,a.currentCollectCount===-1&&!a.currentLanguage?.translateTotal]]),e.createVNode(s,{color:"blue",disabled:a.isCollectionDisabled,"has-border":!0,style:{"min-width":"125px"},onConfirm:a.onScanClick},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collecting"},null,8,ot),[[e.vShow,a.isCollecting]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.collect_and_count"},null,8,rt),[[e.vShow,!a.isCollecting]])]),_:1},8,["disabled","onConfirm"])])]),e.createBaseVNode("div",it,[st,e.createBaseVNode("ui-label",{class:"strongWhite",i18n:"",value:a.PKGName+".language_compilation"},null,8,ct)],512),e.createBaseVNode("div",dt,[e.createBaseVNode("div",ut,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.language:",style:{"margin-right":"8px"}},null,8,vt),e.createBaseVNode("ui-button",{disabled:!a.currentLanguage,onConfirm:n[13]||(n[13]=d=>a.onSelectNewLanguageClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.add_new_language"},null,8,_t)],40,mt)]),e.createBaseVNode("table",null,[e.createBaseVNode("tr",null,[e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language"},null,8,ft)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.language_for_service_provider"},null,8,ht)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.translate_process"},null,8,pt)]),e.createBaseVNode("th",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.PKGName+".home.operation"},null,8,gt)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.panelTranslateDataList,(d,w)=>e.withDirectives((e.openBlock(),e.createElementBlock("tr",{key:d.value.bcp47Tag},[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{value:d.value.displayName},null,8,Nt),e.createBaseVNode("ui-label",{class:"weakWhite",value:`(${d.value.bcp47Tag})`},null,8,kt),e.withDirectives(e.createBaseVNode("ui-label",{style:{display:"block"},class:"weakWhite",i18n:"",value:a.PKGName+".home.local_language"},null,8,Bt),[[e.vShow,d.value.bcp47Tag===a.currentLanguage?.bcp47Tag]])]),a.hasService?(e.openBlock(),e.createElementBlock("td",Vt,[e.createBaseVNode("ui-select",{placeholder:a.providerLanguages[d.value.providerTag]?"":"i18n:"+a.PKGName+".home.select",value:a.providerLanguages[d.value.providerTag],onConfirm:p=>a.onProviderLanguageSelect(p,w)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.providerLanguages,(p,S)=>(e.openBlock(),e.createElementBlock("option",{key:S},e.toDisplayString(p),1))),128))],40,wt)])):(e.openBlock(),e.createElementBlock("td",bt,yt)),e.createBaseVNode("td",null,[e.createBaseVNode("div",xt,[e.createVNode(N,{value:a.getTranslateProcess(d),color:"blue"},null,8,["value"]),e.createBaseVNode("ui-label",{tooltip:"i18n:"+a.PKGName+".home.combine_tooltip",value:a.getTranslateProcessDescription(d)},null,8,It)])]),e.createBaseVNode("td",null,[e.createVNode(s,{color:"blue",onConfirm:p=>a.onTranslateClick(w)},{default:e.withCtx(()=>[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.complement"},null,8,Tt),[[e.vShow,d.value.bcp47Tag===a.currentLanguage?.bcp47Tag]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.translate"},null,8,Pt),[[e.vShow,d.value.bcp47Tag!==a.currentLanguage?.bcp47Tag]])]),_:2},1032,["onConfirm"]),e.createVNode(s,{color:"blue",disabled:!d.value.translateFinished,onConfirm:p=>a.onPreviewClick(w)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.preview"},null,8,St)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(s,{color:"blue",disabled:!d.value.translateFinished,onConfirm:p=>a.onExportClick(w)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export"},null,8,Et)]),_:2},1032,["disabled","onConfirm"]),e.createVNode(s,{color:"blue",disabled:d.value.bcp47Tag===a.currentLanguage?.bcp47Tag,onConfirm:p=>a.onDeleteClick(w)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.delete"},null,8,Dt)]),_:2},1032,["disabled","onConfirm"])])])),[[e.vShow,a.currentLanguage]])),128)),e.withDirectives(e.createBaseVNode("tr",null,[e.createBaseVNode("td",null,[e.createBaseVNode("ui-label",{class:"weakGray",i18n:"",value:a.PKGName+".home.unselect"},null,8,Lt)]),e.createBaseVNode("td",null,[e.createBaseVNode("ui-select",{disabled:"",placeholder:"i18n:"+a.PKGName+".home.select"},null,8,Mt)]),e.createBaseVNode("td",null,[e.createBaseVNode("div",Ft,[e.createVNode(N,{value:0})])]),Kt],512),[[e.vShow,!a.currentLanguage]])]),e.createBaseVNode("div",At,[e.createVNode(s,{color:"blue",transparent:!0,"has-border":!0,disabled:!a.currentLanguage,onConfirm:n[14]||(n[14]=d=>a.onExportAllClick())},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.export_all"},null,8,Gt)]),_:1},8,["disabled"])])])])],512)],512)}var Wt=e._export_sfc($e,[["render",jt],["__scopeId","data-v-5d487f9c"]]);const ce=["untranslated","translated","imported"],Ot={components:{"m-button":Ie,"m-input":O.mInput},props:{targetLocale:{type:String,required:!0}},emits:["home"],async setup(r,{emit:n}){const f=!!await v.wrapper.getCurrentTranslateProvider(),a=e.computed(()=>d.value?.locale===r.targetLocale),g=e.computed(()=>s.value==="untranslated"?_.value:s.value==="translated"?C.value:s.value==="imported"?Object.values(F.value):[]),k=await v.wrapper.getIndexData(),_=e.computed(()=>{const t=x.value?.items??{},l=d.value?.items??{},i=Object.keys(t);return a.value?Object.values(t).filter(m=>m&&!m.value):Object.keys(l).filter(m=>!i.includes(m)&&l[m]?.value).map(m=>l[m])}),C=e.computed(()=>{const t=x.value?.items??{},l=d.value?.items??{},i=Object.keys(t).reverse();return a.value?Object.values(t).filter(m=>m?.value):i.filter(m=>l[m]?.value).map(m=>l[m])}),s=e.ref("untranslated"),c=e.ref({});function V(t,l,i,m,h,B=[]){const b=c.value[t.key]??=new v.WrapperTranslateItem(t.key,l,t.type,i,m,B,h);b.value=l,i&&(b.displayName=i),m&&(b.assetInfo=m),h&&(b._variants=h),B&&(b.associations=B)}const N=e.ref(null),d=e.ref(await ee.getPanelTranslateData());async function w(){d.value=await ee.getPanelTranslateData()}function p(){return Object.keys(c.value).length}async function S(){await Q()}let I=!1;async function Q(t,l){l??={},l.mergeOptions??={replaceVariant:I},["untranslated","translated"].includes(s.value)?await $(t,l):(p()&&await $(),await me(t,l))}async function $(t,l){if(t??=c.value,console.debug("onSaveClick",t),v.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{H()}),t===c.value)c.value={};else if(t instanceof Array)for(let i=0;i<t.length;i++){const m=t[i];delete c.value[m.key]}I=!1}const y=e.ref([]),j=e.ref(new Set);function ue(t,l){t?j.value.add(l):j.value.delete(l)}const le=e.computed({get(){const t=y.value.length;return j.value.size===t},set(t){if(t)for(let l=0;l<y.value.length;l++)j.value.add(l);else j.value.clear()}});function ve(t){le.value=t}function ne(t,l){if(v.wrapper.saveTranslateData(r.targetLocale,t,l?.mergeOptions).then(i=>{H(),w()}),!a.value){const i=Object.values(d.value.items),m=t.filter(h=>!i.some(B=>B?.key===h.key));m.length&&v.wrapper.saveTranslateData(d.value.bcp47Tag,m,l?.mergeOptions).then(h=>{w()})}for(let i=0;i<t.length;i++){const m=t[i];delete F.value[m.key]}I=!1}async function me(t,l){if(t??=Object.values(F.value),t){const i=Object.values(x.value.items);y.value=t.filter(h=>i.some(B=>B?.key===h.key));const m=t.filter(h=>!i.some(B=>B?.key===h.key));m.length&&ne(m,l),l?.force&&(ne(t,l),j.value.clear(),y.value=[])}}const x=e.ref(await ee.getPanelTranslateData(r.targetLocale));async function H(t){if(t){console.debug("translateResult",t);for(let l=0;l<t.length;l++){const i=t[l],m=c.value[i.key]||x.value.items[i.key];c.value[i.key]=new v.WrapperTranslateItem(i.key,i.value,i.type,i.displayName||v.WrapperTranslateItem.getDisplayName({item:i,assetInfo:m?.assetInfo||i.assetInfo}),m?.assetInfo,i.associations)}}else console.debug("update target translate data get translate data"),x.value=await ee.getPanelTranslateData(r.targetLocale)}const Y=e.ref(Ln[x.value.bcp47Tag.split("-")[0]]??["other"]),W=e.ref(null),_e=e.computed(()=>{const t=Object.values(d.value.items).filter(l=>l&&l.type===O.TranslateItemType.Media);if(t.length===0)return!1;for(const l of t)if(!(c.value[l.key]??x.value.items[l.key])?.value)return!0;return!1}),X=e.ref(null);async function ae(t){if(p()){if((await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.unsaved_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===0)return!1;Q(void 0,{force:!0})}return await t(),!0}function fe(t,l,i){L.value=!1,X.value&&clearTimeout(X.value),l?W.value=t:s.value==="imported"?W.value=F.value[t.key]??t:W.value=c.value[t.key]??x.value?.items[t.key]??t}const L=e.ref(!1);function M(){L.value=!0}function he(){L.value||(X.value=setTimeout(()=>{oe()},400))}function oe(){W.value=null}const F=e.ref({}),te="default-translate.importFile";async function re(){return await Editor.Profile.getTemp(e.MainName,te)||""}function ie(t){Editor.Profile.setTemp(e.MainName,te,t)}function se(t){if(s.value!==ce[t])switch(t){case 0:case 1:case 2:s.value=ce[t];break;default:s.value=ce[0];break}}async function pe(t){await Editor.Panel.focus("assets"),Editor.Message.send("assets","twinkle",t,"shake")}return{clearSelected:oe,isLockItem:L,onPositionInfoClick:pe,onCancelItemBlur:M,isConflictSelectAll:le,onConflictItemClick:ue,onConflictItemSelectAllClick:ve,selectedConflictItemIndexSet:j,conflictItemsBetweenImportedFilesAndTranslatedFiles:y,importedTranslateItemMap:F,MainName:e.MainName,hasTranslateProvider:f,onItemBlur:he,onItemMouseDown:fe,isTargetTranslateDataHasEmptyMedia:_e,currentTranslateDataItems:g,currentSelectedItem:W,isSameLanguage:a,untranslatedTranslateDataItems:_,translatedTranslateDataItems:C,getDisplayNameOfTargetItem(t){let l;if(s.value==="imported")l=F.value[t];else{const i=c.value[t],m=x.value?.items[t];l=i??m}return l?l.type===O.TranslateItemType.Media?l?.displayName??t:l?.value??"":""},getDisplayNameOfLocalItem(t){let l;return s.value==="imported"?(l=d.value?.items[t]??F.value[t],l.value):(l=d.value?.items[t],l?.type===O.TranslateItemType.Media?l.displayName||t:a.value?t:l?.displayName||"")},positionInfoOfAssociation:e.computed(()=>{if(!W.value)return[];const t=k.find(i=>i.key===W.value.key);if(!t)return[];const l=t.associations.filter(i=>i.assetInfo).map(i=>({path:P.relative(Editor.Project.path,i.assetInfo.file),uuid:i.assetInfo.uuid}));return Array.from(new Set(l)).map(i=>new A(i))}),nodeUuidOfAssociation:e.computed(()=>{if(!W.value)return[];const t=k.find(l=>l.key===W.value.key);return t?Array.from(new Set(t.associations.filter(l=>l.nodeUuid).map(l=>l.nodeUuid))).map(l=>new A(l)):[]}),onSaveClick:S,targetPanelTranslateData:x,localPanelTranslateData:d,currentVariantsItem:N,changedTranslateItemMap:c,TranslateItemType:e.ref(O.TranslateItemType),onTabClick:se,importedTranslateData:e.ref([]),currentTab:s,Tab:e.ref(ce),async onInputChanged(t,l){let i;if(s.value==="imported"){const m=F.value[t];m.value=l;return}else i=c.value[t]??x.value?.items[t]??d.value?.items[t];if(!i){console.error(`cannot find item with key ${t}`);return}if(i.type===O.TranslateItemType.Media)if(l==="")V(i,"","",void 0,i._variants,i.associations);else{const m=d.value?.items[t];if(!m){console.error(`cannot find item with key ${t} from local`);return}const h=await v.wrapper.getFileInfoByUUIDOrPath(P.join(e.ProjectAssetPath,l));h&&P.extname(m.displayName||"")===P.extname(l)&&V(i,h.uuid,v.WrapperTranslateItem.getDisplayName({item:i,assetInfo:h}),h,i._variants,i.associations)}else V(i,l,v.WrapperTranslateItem.getDisplayName({item:i,value:l}),null,i._variants,i.associations)},async onTranslateClick(){await ae(async()=>{H(await v.wrapper.autoTranslate(x.value.locale))})},variantKeys:Y,onVariantsClick(t){const l=x.value?.items[t],i=c.value[t],m=F.value[t];if(s.value==="imported"&&m)N.value=v.WrapperTranslateItem.parse(m);else if(i)N.value=v.WrapperTranslateItem.parse(i);else if(l)N.value=v.WrapperTranslateItem.parse(l);else{console.error("An item that does not have a value should not be able to set variations",`key:${t}`);return}for(let B=0;B<Y.value.length;B++){const b=Y.value[B],U=`${t}_${b}`;l?._variants.find(Z=>Z.key===U)||N.value._variants.push(new v.WrapperTranslateItem(U,"",N.value.type,"",null,void 0,void 0,!0))}function h(B){const b=B.split("_");if(b.length){const U=b[b.length-1];return Y.value.findIndex(R=>R===U)}else return-1}N.value._variants=N.value._variants.sort((B,b)=>h(B.key)-h(b.key))},onVariantsConfirm(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value._variants=N.value._variants.filter(t=>t.value),I=!0,Q([N.value],{mergeOptions:{replaceVariant:!0}}),N.value=null},onVariantsCancel(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}N.value=null},async onVariantsDelete(){if(!N.value){console.error(`save variants error: currentVariantsItem.value is ${N.value}`);return}(await Editor.Dialog.info(Editor.I18n.t(e.MainName+".translate.delete_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")]})).response===1&&(N.value._variants=[],I=!0,await Q([N.value])),N.value=null},isVariantsDisable(t){if(s.value==="imported")return!1;{const l=c.value[t],i=x.value?.items[t];return l?.value===""||!l&&!i?.value}},isDeleteVariantsDisable:e.computed(()=>!N.value?._variants.some(t=>t.value)),async onImportAllClick(){await ae(async()=>{const t=d.value.locale,l=_.value.filter(h=>h?.type===O.TranslateItemType.Media).length,i=Editor.I18n.t(e.MainName+".translate.auto_import_warning").replace("{length}",l.toString()).replace("{localLocale}",t).replace("{targetLocale}",r.targetLocale);if((await Editor.Dialog.info(i,{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response){const h=await v.wrapper.importFilesFromDirectory(r.targetLocale,t,r.targetLocale);H(h)}})},async onFileInputClick(){await ae(async()=>{se(2);const t=await Editor.Dialog.select({extensions:"po,csv,xlsx",multi:!1,path:await re()});if(!t.canceled){const l=t.filePaths[0];ie(l);const i=Te(l),m=x.value.bcp47Tag;let h=await v.wrapper.importTranslateFile(l,i,m);const B=h.filter(b=>F.value[b.key]);if(B.length){const R=(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.import_file_conflicts_with_file_warning").replace("{num}",B.length.toString()),{buttons:[Editor.I18n.t(e.MainName+".translate.jump"),Editor.I18n.t(e.MainName+".translate.cover"),Editor.I18n.t(e.MainName+".translate.cancel")],cancel:2})).response;if(R===0)h=h.filter(Z=>!B.includes(Z)).concat(B);else if(R===1){const Z=Object.values(F.value).filter(ge=>!B.some(Ne=>Ne.key===ge.key));h=h.concat(Z)}else if(R===2)return}for(let b=0;b<h.length;b++){const U=h[b];F.value[U.key]=U}}})},async onImportClick(t){const l=d.value.items[t]??c.value[t]??x.value?.items[t];if(!l?.assetInfo){console.error(`[${e.MainName}]: item has not assetInfo`,l);return}let i;l.assetInfo.type==="cc.ImageAsset"?i="png,jpg,jpeg,bmp,webp,pvr,pkm,astc":i=P.extname(l.assetInfo.file).replace(".","");const m=await Editor.Dialog.select({multi:!1,path:e.ProjectAssetPath,type:"file",extensions:i});if(!m.canceled){const h=await v.wrapper.getFileInfoByUUIDOrPath(m.filePaths[0]);if(h){const B=h.uuid,b=v.WrapperTranslateItem.getDisplayName({assetInfo:h});V(l,B,b,h,l._variants,l.associations)}else console.error("A non-project resource was selected,please select another resource.")}},onConflictCancelClick(){y.value=[],j.value.clear(),I=!1},async onConflictConfirmClick(){await Q(Array.from(j.value).map(t=>y.value[t]),{force:!0})},async onHomeClick(){Object.keys(c.value).length>0?(await Editor.Dialog.warn(Editor.I18n.t(e.MainName+".translate.quit_warning"),{buttons:[Editor.I18n.t(e.MainName+".translate.cancel"),Editor.I18n.t(e.MainName+".translate.confirm")],cancel:0})).response===1&&n("home"):n("home")}}}},Ut={class:"translate"},zt={class:"toolbar container"},qt=e.createBaseVNode("ui-icon",{value:"arrow-triangle",style:{transform:"rotate(90deg)"}},null,-1),Ht=e.createBaseVNode("ui-icon",{value:"import"},null,-1),Xt=["value"],Rt=e.createBaseVNode("ui-icon",{style:{display:"inline-block","margin-right":"4px"},value:"save"},null,-1),Jt=["value"],Qt={class:"tabs container"},Yt=["value"],Zt=["value"],$t=["value"],el=["value"],al=["value"],tl={class:"div"},ll={class:"tr head"},nl={class:"th"},ol={tabindex:"0"},rl={class:"container"},il=["value"],sl=["value"],cl={class:"th"},dl={tabindex:"0"},ul={class:"container"},vl=["value"],ml=["value"],_l=["value"],fl=["value"],hl={class:"td",tabindex:"0"},pl={class:"td"},gl={class:"container"},Nl=["value"],kl=["value"],Bl=["value"],Vl=["value"],wl=["value"],bl=["value","onClick"],Cl=["value"],yl=["value"],xl={key:0,class:"variants"},Il={class:"header"},Tl=["value"],Pl={class:"body"},Sl={class:"tr"},El={class:"th"},Dl={tabindex:"0"},Ll=["value"],Ml={class:"th"},Fl={tabindex:"0",class:"container"},Kl=["value"],Al={class:"td"},Gl={class:"td"},jl={class:"container"},Wl={class:"footer"},Ol={class:"container"},Ul={style:{flex:"1"}},zl=["value"],ql=["value"],Hl=["value"],Xl={class:"conflict"},Rl={class:"content"},Jl={class:"header"},Ql=["value"],Yl={class:"body"},Zl=["value"],$l={class:"table"},en={class:"tr head"},an={class:"th"},tn=["value"],ln={class:"th"},nn=["value"],on={class:"th"},rn=["value"],sn={class:"th"},cn=["value"],dn={class:"td"},un=["value","onChange"],vn={class:"td"},mn=["value"],_n={class:"td"},fn=["value"],hn={class:"td"},pn=["value"],gn={class:"footer"},Nn=["value"],kn=["value"];function Bn(r,n,f,a,g,k){const _=e.resolveComponent("m-button"),C=e.resolveComponent("m-input");return e.openBlock(),e.createElementBlock("div",Ut,[e.createBaseVNode("head",null,[e.createBaseVNode("div",zt,[e.createVNode(_,{onConfirm:a.onHomeClick},{default:e.withCtx(()=>[qt]),_:1},8,["onConfirm"]),e.createVNode(_,{onConfirm:a.onFileInputClick},{default:e.withCtx(()=>[Ht,e.createBaseVNode("ui-label",{color:"",i18n:"",value:`${a.MainName}.translate.import_file`},null,8,Xt)]),_:1},8,["onConfirm"]),e.createVNode(_,{onConfirm:a.onSaveClick},{default:e.withCtx(()=>[Rt,e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.save"},null,8,Jt)]),_:1},8,["onConfirm"])])]),e.createBaseVNode("body",null,[e.createBaseVNode("div",Qt,[e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[0]}]),onClick:n[0]||(n[0]=s=>a.onTabClick(0))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.unfilled"},null,8,Yt),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.untranslated"},null,8,Zt),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[1]}]),onClick:n[1]||(n[1]=s=>a.onTabClick(1))},[e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.filled"},null,8,$t),[[e.vShow,a.isSameLanguage]]),e.withDirectives(e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translated"},null,8,el),[[e.vShow,!a.isSameLanguage]])],2),e.createBaseVNode("div",{class:e.normalizeClass(["tab",{selected:a.currentTab===a.Tab[2]}]),onClick:n[2]||(n[2]=s=>a.onTabClick(2))},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_tab_title"},null,8,al)],2)]),e.createBaseVNode("div",tl,[e.createBaseVNode("div",{class:"table",tabindex:"1",onClick:n[3]||(n[3]=s=>a.isLockItem&&a.clearSelected())},[e.createBaseVNode("div",ll,[e.createBaseVNode("div",nl,[e.createBaseVNode("div",ol,[e.createBaseVNode("div",rl,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.localPanelTranslateData.displayName},null,8,il)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,sl)):e.createCommentVNode("",!0)])])]),e.createBaseVNode("div",cl,[e.createBaseVNode("div",dl,[e.createBaseVNode("div",ul,[a.currentTab==="imported"||!a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:0,class:"weakWhite",i18n:"",value:a.targetPanelTranslateData.displayName},null,8,vl)):a.isSameLanguage?(e.openBlock(),e.createElementBlock("ui-label",{key:1,class:"weakWhite",i18n:"",value:a.MainName+".translate.origin"},null,8,ml)):e.createCommentVNode("",!0)]),e.withDirectives(e.createVNode(_,{color:"blue",disabled:!a.hasTranslateProvider,onConfirm:a.onTranslateClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.translate"},null,8,_l)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,!a.isSameLanguage&&a.currentTab===a.Tab[0]]]),e.withDirectives(e.createVNode(_,{color:"blue",disabled:!a.isTargetTranslateDataHasEmptyMedia,onConfirm:a.onImportAllClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import_all"},null,8,fl)]),_:1},8,["disabled","onConfirm"]),[[e.vShow,a.currentTab===a.Tab[0]&&!a.isSameLanguage]])])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentTranslateDataItems,s=>(e.openBlock(),e.createElementBlock("div",{key:s.key,class:"tr"},[e.createBaseVNode("div",hl,[e.createBaseVNode("div",null,[e.createVNode(C,{style:{flex:"1"},"is-textarea":!0,"model-value":a.getDisplayNameOfLocalItem(s.key),readonly:!0,onClick:c=>a.onItemMouseDown(s,!0,c),onBlur:a.onItemBlur},null,8,["model-value","onClick","onBlur"])])]),e.createBaseVNode("div",pl,[e.createBaseVNode("div",gl,[e.createVNode(C,{"is-textarea":!0,"model-value":a.getDisplayNameOfTargetItem(s.key),readonly:a.isSameLanguage&&s.type===a.TranslateItemType.Media,onBlur:a.onItemBlur,onClick:c=>a.onItemMouseDown(s,!1,c),"onUpdate:modelValue":c=>a.onInputChanged(s.key,c)},{default:e.withCtx(()=>[s.type===a.TranslateItemType.Media&&!a.isSameLanguage?(e.openBlock(),e.createBlock(_,{key:0,class:"import",color:"blue",onConfirm:c=>a.onImportClick(s.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.import"},null,8,Nl)]),_:2},1032,["onConfirm"])):e.createCommentVNode("",!0),s.type!==a.TranslateItemType.Media?(e.openBlock(),e.createBlock(_,{key:1,color:"blue",disabled:a.isVariantsDisable(s.key),onConfirm:c=>a.onVariantsClick(s.key)},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.variant"},null,8,kl)]),_:2},1032,["disabled","onConfirm"])):e.createCommentVNode("",!0)]),_:2},1032,["model-value","readonly","onBlur","onClick","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("footer",{tabindex:"1",onMousedown:n[4]||(n[4]=(...s)=>a.onCancelItemBlur&&a.onCancelItemBlur(...s))},[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",value:a.MainName+".translate.key:",i18n:""},null,8,Bl),e.createBaseVNode("ui-label",{class:"selectable",value:a.currentSelectedItem?.key||""},null,8,Vl)]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.position:"},null,8,wl),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.positionInfoOfAssociation,s=>(e.openBlock(),e.createElementBlock("ui-label",{key:s.__key,class:"selectable link",value:s.value.path,onClick:c=>a.onPositionInfoClick(s.value.uuid)},null,8,bl))),128))]),e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.reference_uuid"},null,8,Cl),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.nodeUuidOfAssociation,s=>(e.openBlock(),e.createElementBlock("ui-label",{key:s.__key,class:"selectable",value:s.value},null,8,yl))),128))])],32),a.currentVariantsItem?(e.openBlock(),e.createElementBlock("div",xl,[e.createBaseVNode("div",null,[e.createBaseVNode("div",Il,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.variant"},null,8,Tl)]),e.createBaseVNode("div",Pl,[e.createBaseVNode("div",null,[e.createBaseVNode("div",{class:"table",onClick:n[5]||(n[5]=e.withModifiers(()=>{},["stop"]))},[e.createBaseVNode("div",Sl,[e.createBaseVNode("div",El,[e.createBaseVNode("div",Dl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.standard",class:"weakWhite"},null,8,Ll)])]),e.createBaseVNode("div",Ml,[e.createBaseVNode("div",Fl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.after_variant",class:"weakWhite",style:{flex:"1"}},null,8,Kl)])])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.currentVariantsItem._variants,(s,c)=>(e.openBlock(),e.createElementBlock("div",{key:s,class:"tr"},[e.createBaseVNode("div",Al,[e.createBaseVNode("div",null,[e.createVNode(C,{"model-value":a.variantKeys[c],readonly:!0},null,8,["model-value"])])]),e.createBaseVNode("div",Gl,[e.createBaseVNode("div",jl,[e.createVNode(C,{modelValue:s.value,"onUpdate:modelValue":V=>s.value=V,"is-textarea":!0},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))])])]),e.createBaseVNode("div",Wl,[e.createBaseVNode("div",Ol,[e.createBaseVNode("div",Ul,[e.createVNode(_,{color:"blue",disabled:a.isDeleteVariantsDisable,onConfirm:a.onVariantsDelete},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.delete_variant"},null,8,zl)]),_:1},8,["disabled","onConfirm"])]),e.createBaseVNode("div",null,[e.createVNode(_,{"has-border":!0,onConfirm:a.onVariantsCancel},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,ql)]),_:1},8,["onConfirm"]),e.createVNode(_,{"has-border":!0,style:{"margin-left":"16px"},onConfirm:a.onVariantsConfirm},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.confirm"},null,8,Hl)]),_:1},8,["onConfirm"])])])])])])):e.createCommentVNode("",!0),e.withDirectives(e.createBaseVNode("div",Xl,[e.createBaseVNode("div",Rl,[e.createBaseVNode("div",Jl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.save"},null,8,Ql)]),e.createBaseVNode("div",Yl,[e.createBaseVNode("ui-label",{i18n:"",value:a.MainName+".translate.conflict_dialog_content"},null,8,Zl),e.createBaseVNode("div",null,[e.createBaseVNode("div",$l,[e.createBaseVNode("div",en,[e.createBaseVNode("div",an,[e.createBaseVNode("ui-checkbox",{value:a.isConflictSelectAll,onChange:n[6]||(n[6]=s=>a.onConflictItemSelectAllClick(s.target.value))},null,40,tn)]),e.createBaseVNode("div",ln,[e.createBaseVNode("ui-label",{class:"weakWhite",i18n:"",value:a.MainName+".translate.key"},null,8,nn)]),e.createBaseVNode("div",on,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.old_value"},null,8,rn)]),e.createBaseVNode("div",sn,[e.createBaseVNode("ui-label",{i18n:"",class:"weakWhite",value:a.MainName+".translate.new_value"},null,8,cn)])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.conflictItemsBetweenImportedFilesAndTranslatedFiles,(s,c)=>(e.openBlock(),e.createElementBlock("div",{key:s.key,class:"tr"},[e.createBaseVNode("div",dn,[e.createBaseVNode("ui-checkbox",{value:a.selectedConflictItemIndexSet.has(c),onChange:V=>a.onConflictItemClick(V.target.value,c)},null,40,un)]),e.createBaseVNode("div",vn,[e.createBaseVNode("ui-label",{value:s.key},null,8,mn)]),e.createBaseVNode("div",_n,[e.createBaseVNode("ui-label",{value:a.targetPanelTranslateData?.items[s.key]?.value??s.value},null,8,fn)]),e.createBaseVNode("div",hn,[e.createBaseVNode("ui-label",{value:a.importedTranslateItemMap[s.key].value},null,8,pn)])]))),128))])])]),e.createBaseVNode("div",gn,[e.createVNode(_,{"has-border":!0,transparent:!0,disabled:a.selectedConflictItemIndexSet.size===0,onConfirm:a.onConflictConfirmClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cover"},null,8,Nn)]),_:1},8,["disabled","onConfirm"]),e.createVNode(_,{"has-border":!0,transparent:!0,onConfirm:a.onConflictCancelClick},{default:e.withCtx(()=>[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.MainName+".translate.cancel"},null,8,kn)]),_:1},8,["onConfirm"])])])],512),[[e.vShow,a.conflictItemsBetweenImportedFilesAndTranslatedFiles.length]])])}var Vn=e._export_sfc(Ot,[["render",Bn]]);const wn={emits:["confirm"],setup(r,{emit:n}){return{onButtonClick(){n("confirm")},PKGName:D.name}}},bn={class:"mask"},Cn=["value"],yn=["value"];function xn(r,n,f,a,g,k){return e.openBlock(),e.createElementBlock("div",bn,[e.createBaseVNode("div",null,[e.createBaseVNode("ui-label",{i18n:"",value:a.PKGName+".home.turn_on_tip"},null,8,Cn),e.createBaseVNode("ui-button",{onConfirm:n[0]||(n[0]=_=>a.onButtonClick())},[e.createBaseVNode("ui-label",{color:"",i18n:"",value:a.PKGName+".home.turn_on"},null,8,yn)],32)])])}var In=e._export_sfc(wn,[["render",xn]]);const Tn={components:{Home:Wt,Translate:Vn,DefaultMask:In},setup(){e.onMounted(()=>{J.eventBus.on("onCustomError",a)}),e.onUnmounted(()=>{J.eventBus.off("onCustomError",a)});const r=e.ref(!0),n=e.ref(""),f=e.ref(0);function a(g){Editor.Dialog.error(g.message),console.error(g)}return v.wrapper.getEnable().then(g=>{r.value=g}),{async onToggle(g){r.value=g},async onMaskConfirm(){r.value=await v.wrapper.toggle()},isLocalizationEditorEnable:r,tabIndex:f,targetLocale:n,onTranslateClick(g){n.value=g,f.value=1},onHomeClick(){J.eventBus.emit("updateAllLanguageConfig"),f.value=0}}}},Pn=r=>(e.pushScopeId("data-v-4e6e4381"),r=r(),e.popScopeId(),r),Sn=Pn(()=>e.createBaseVNode("div",{class:"fallback"},[e.createBaseVNode("ui-loading")],-1));function En(r,n,f,a,g,k){const _=e.resolveComponent("DefaultMask"),C=e.resolveComponent("Home"),s=e.resolveComponent("Translate");return e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createBaseVNode("div",null,[e.withDirectives(e.createVNode(_,{onConfirm:n[0]||(n[0]=c=>a.onMaskConfirm())},null,512),[[e.vShow,!a.isLocalizationEditorEnable]]),e.withDirectives(e.createVNode(C,{onTranslate:a.onTranslateClick,onToggle:a.onToggle},null,8,["onTranslate","onToggle"]),[[e.vShow,a.tabIndex===0]]),a.tabIndex===1?(e.openBlock(),e.createBlock(s,{key:0,"target-locale":a.targetLocale,onHome:a.onHomeClick},null,8,["target-locale","onHome"])):e.createCommentVNode("",!0)])]),fallback:e.withCtx(()=>[Sn]),_:1})}var Dn=e._export_sfc(Tn,[["render",En],["__scopeId","data-v-4e6e4381"]]);class ee{constructor(n,f,a,g,k){this.bcp47Tag=n,this.displayName=f,this.fontName=a,this.localFontName=g,this.items=k}get locale(){return this.bcp47Tag}static async getPanelTranslateData(n){const f=await v.wrapper.getTranslateData(n),a=await v.wrapper.getLocalLanguage(),g=await v.wrapper.getLanguageConfig(n);if(!g||!a)return null;const k={};for(let _=0;_<f.length;_++){const C=f[_];k[C.key]=C}return new ee(g.bcp47Tag,D.getLanguageDisplayName(g.bcp47Tag),"","",k)}}const Ln=de.readJsonSync(P.join(__dirname,"../../static/plural-rules/plural-rules.json"),{encoding:"utf8"}),ye=new WeakMap;module.exports=Editor.Panel.define({listeners:{show(){},hide(){}},template:'<div id="app"></div>',style:de.readFileSync(P.join(__dirname,"./index.css"),{encoding:"utf8"})+e.commonCss,$:{app:"#app"},ready(){if(this.$.app){const r=e.createApp(Dn);r.mount(this.$.app),ye.set(this,r)}},methods:{executePanelMethod(r,...n){J.eventBus.emit(r,...n)}},beforeClose(){},close(){const r=ye.get(this);r&&r.unmount()}});
