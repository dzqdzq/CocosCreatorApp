"use strict";var D=require("fs-extra"),I=require("path"),e=require("../share/scripts/global.js"),u=require("../../dist/virtual-modules/EventBus"),s=require("../share/scripts/languageMap.js");require("../../dist/virtual-modules/Builder");var V=require("../../dist/virtual-modules/Wrapper");const S={class:"home"},j=["value"],F={slot:"content"},q={class:"language"},A={id:"fix-box"},U=["value"],T={id:"selectAll",class:"selectItem"},z=["value"],H=["value"],K={id:"selectContainer"},W=["value","readonly","onConfirm"],G=["value"],P=["value"],J=["value"],Q=["value"],R=["value"],X=["value"],Y=e.defineComponent({__name:"build-home",setup(l){async function p(n,t){const a=await V.wrapper.getAllLanguageConfigs(),i={},$=await V.wrapper.getLocalLanguage()||"";let _=n.packages["localization-editor"]?.defaultLanguage,B=n.packages["localization-editor"]?.fallbackLanguage;for(let o=0;o<a.length;o++){const C=a[o];i[C.bcp47Tag]={locale:C.bcp47Tag,value:!1}}typeof _=="string"&&!a.some(o=>o.bcp47Tag===_)&&(_=void 0),typeof B=="string"&&!a.some(o=>o.bcp47Tag===B)&&(B=void 0);const E=n.packages["localization-editor"]?.targetLanguageMap??{},h={};for(const o in i)h[o]=Object.assign(E[o]??i[o]),h[o].displayName=s.getLanguageDisplayName(h[o].locale);r.value=h,c.value=_??$,_||(u.eventBus.emit("changeBuilderOptions",`packages.${s.name}.${y}`,c.value,!c.value),m(c.value,!0)),v.value=B??$,B||(u.eventBus.emit("changeBuilderOptions",`packages.${s.name}.${N}`,v.value,!1),m(v.value,!0))}const k=e.computed(()=>s.getLanguageDisplayName(c.value)),b=e.computed(()=>s.getLanguageDisplayName(v.value)),f=async(n,t)=>{await p(n)},d=e.computed({get(){return Object.values(r.value).every(n=>n.value)},set(n){for(const t in r.value)!n&&(t===c.value||t===v.value)||m(t,n)}}),g=e.ref(""),L=e.computed(()=>{const n=Object.values(r.value),t=g.value.toLowerCase();return t.length===0?n:n.filter(a=>a.displayName.toLowerCase().includes(t)||a.locale.toLowerCase().includes(t))});e.onMounted(()=>{u.eventBus.on("onBuilderUpdated",f)}),e.onUnmounted(()=>{u.eventBus.off("onBuilderUpdated",f)});const r=e.ref({});e.ref({});const c=e.ref(""),v=e.ref(""),x="targetLanguageMap",y="defaultLanguage",N="fallbackLanguage";function m(n,t){const a=r.value[n];a&&(a.value=t,u.eventBus.emit("changeBuilderOptions",`packages.${s.name}.${x}.${n}`,{locale:a.locale,value:t},!1))}async function M(n){const t=Object.values(r.value).find(a=>a.displayName===n)?.locale;if(!t){console.error(`The content named ${n} cannot be found in the table`);return}u.eventBus.emit("changeBuilderOptions",`packages.${s.name}.${y}`,t,!n),m(t,!0)}function w(n){const t=Object.values(r.value).find(a=>a.displayName===n)?.locale;if(!t){console.error(`The content named ${n} cannot be found in the table`);return}u.eventBus.emit("changeBuilderOptions",`packages.${s.name}.${N}`,t,!1),m(t,!0)}return(n,t)=>(e.openBlock(),e.createElementBlock("div",S,[e.createBaseVNode("ui-prop",null,[e.createBaseVNode("ui-label",{slot:"label",i18n:"",value:e.unref(s.name)+".build.use_language"},null,8,j),e.createBaseVNode("div",F,[e.createBaseVNode("div",q,[e.createBaseVNode("div",A,[e.createBaseVNode("ui-input",{id:"search",placeholder:"Search...",value:g.value,onInput:t[0]||(t[0]=a=>g.value=a.target.value)},null,40,U),e.createBaseVNode("div",T,[e.createBaseVNode("ui-checkbox",{value:e.unref(d),onConfirm:t[1]||(t[1]=a=>d.value=a.target.value)},null,40,z),e.createBaseVNode("ui-label",{i18n:"",value:e.unref(s.name)+".build.select_all"},null,8,H)])]),e.createBaseVNode("div",K,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(L),a=>(e.openBlock(),e.createElementBlock("div",{key:a.locale,class:"selectItem"},[e.createBaseVNode("ui-checkbox",{value:a.locale===c.value?!0:a.value,readonly:a.locale===c.value||a.locale===v.value,onConfirm:i=>m(a.locale,i.target.value)},null,40,W),e.createBaseVNode("ui-label",{class:e.normalizeClass({weakGray:a.locale===c.value||a.locale===v.value}),value:a.displayName},null,10,G),e.createBaseVNode("ui-label",{class:"weakGray",value:`(${a.locale})`},null,8,P)]))),128))])])])]),e.createBaseVNode("ui-prop",null,[e.createBaseVNode("ui-label",{slot:"label",i18n:"",value:e.unref(s.name)+".build.default_language"},null,8,J),e.createBaseVNode("ui-select",{slot:"content",value:e.unref(k),onConfirm:t[2]||(t[2]=a=>M(a.target.value))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(a,i)=>(e.openBlock(),e.createElementBlock("option",{key:i},e.toDisplayString(a.displayName),1))),128))],40,Q)]),e.createBaseVNode("ui-prop",null,[e.createBaseVNode("ui-label",{slot:"label",i18n:"",value:e.unref(s.name)+".build.fallback_language"},null,8,R),e.createBaseVNode("ui-select",{slot:"content",value:e.unref(b),onConfirm:t[3]||(t[3]=a=>w(a.target.value))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(a,i)=>(e.openBlock(),e.createElementBlock("option",{key:i},e.toDisplayString(a.displayName),1))),128))],40,X)])]))}});const Z={components:{Home:Y},setup(){function l(p){console.error(p)}e.onMounted(()=>{u.eventBus.on("onCustomError",l)}),e.onUnmounted(()=>{u.eventBus.off("onCustomError",l)})}},ee=l=>(e.pushScopeId("data-v-8e570598"),l=l(),e.popScopeId(),l),ae=ee(()=>e.createBaseVNode("div",{class:"fallback"},[e.createBaseVNode("ui-loading")],-1));function te(l,p,k,b,f,d){const g=e.resolveComponent("Home");return e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createBaseVNode("div",null,[e.createVNode(g)])]),fallback:e.withCtx(()=>[ae]),_:1})}var ne=e._export_sfc(Z,[["render",te],["__scopeId","data-v-8e570598"]]);const O=new WeakMap;module.exports=Editor.Panel.define({$:{app:"#app"},template:'<div id="app"></div>',ready(l,p,k,b){const f=(d,g,L)=>{this.dispatch("update",d,g,L)};if(this.$.app){const d=e.createApp(ne);d.mount(this.$.app),O.set(this,{app:d,onChangeBuilderOptions:f}),u.eventBus.emit("onBuilderUpdated",l)}u.eventBus.on("changeBuilderOptions",f)},style:D.readFileSync(I.join(__dirname,"./index.css"),{encoding:"utf8"})+e.commonCss,update(l,p){u.eventBus.emit("onBuilderUpdated",l,p)},close(){const l=O.get(this);l&&(l.app?.unmount(),u.eventBus.off("changeBuilderOptions",l.onChangeBuilderOptions))}});
