"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var i,n=arguments.length,s=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,a);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(r,a){t(r,a,e)}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const tsyringe_1=require("tsyringe"),PoHeader_1=__importDefault(require("../entity/gettext/PoHeader")),gettext_parser_1=require("gettext-parser"),fs_extra_1=require("fs-extra"),TranslateItemType_1=__importDefault(require("../entity/translate/TranslateItemType")),type_1=require("../type/type");let POWriter=class{constructor(e){this.pluralRules=e,this.type=type_1.TranslateFileType.PO}async write(e,t,r){const a=new PoHeader_1.default(t.locale,"CocosCreator","cocosCreator",(new Date).toUTCString(),(new Date).toUTCString(),"",""),i={};for(const[e,a]of r.items.entries())a.type!==TranslateItemType_1.default.Media&&(i[e]=this.transform(a,t.locale,t.items.get(e)));const n={charset:"utf-8",headers:a,translations:{"":i}},s=gettext_parser_1.po.compile(n,{escapeCharacters:!0});await(0,fs_extra_1.writeFile)(e,s,"utf-8")}transform(e,t,r){return{comments:{extracted:"",flag:"",previous:"",reference:e.key,translator:""},msgid:e.value,msgid_plural:(()=>r&&r.variants.length>0?r.value:e.variants.length>0?e.value:void 0)(),msgstr:(()=>{var a,i;if(e.variants.length>0){return(null!==(a=this.pluralRules[new Intl.Locale(t).language])&&void 0!==a?a:["other"]).map(e=>{var t;const a=null===r||void 0===r?void 0:r.variants.find(t=>t.key.endsWith(e));return null!==(t=null===a||void 0===a?void 0:a.value)&&void 0!==t?t:""})}return[null!==(i=null===r||void 0===r?void 0:r.value)&&void 0!==i?i:""]})()}}};POWriter=__decorate([(0,tsyringe_1.singleton)(),__param(0,(0,tsyringe_1.inject)("PluralRules")),__metadata("design:paramtypes",[Object])],POWriter),exports.default=POWriter;