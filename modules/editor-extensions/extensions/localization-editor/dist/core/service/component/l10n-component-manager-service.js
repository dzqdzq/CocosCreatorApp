"use strict";var __decorate=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),require("reflect-metadata");const path_1=require("path");module.paths.push((0,path_1.join)(Editor.App.path,"node_modules"));const cc_1=require("cc"),tsyringe_1=require("tsyringe"),MainIPC_1=__importDefault(require("../../ipc/MainIPC")),SceneProcessor_1=__importDefault(require("../scanner/processor/SceneProcessor")),EditorMessageService_1=__importDefault(require("../EditorMessageService"));let L10nComponentManagerService=class{constructor(e,t){this.mainIpc=e,this.editorMessageService=t,this.tempAssociation={},this._onComponentAdd=this.onComponentAdd.bind(this),this._onComponentRemoved=this.onComponentRemoved.bind(this),this.initialized=!1}onSceneReady(e){this.tempAssociation.sceneUuid=e,this.tempAssociation.reference=e}async onComponentAdd(e){const t=cc_1.js.getClassByName(SceneProcessor_1.default.L10nLabelComponentName);if(t&&e instanceof t){const t=e.key;t&&(this.tempAssociation.nodeUuid=e.node.uuid,await this.mainIpc.addAssociation(t,this.tempAssociation))}}async onComponentRemoved(e){const t=cc_1.js.getClassByName(SceneProcessor_1.default.L10nLabelComponentName);if(t&&e instanceof t){const t=e.key;t&&(this.tempAssociation.nodeUuid=e.node.uuid,await this.mainIpc.removeAssociation(t,this.tempAssociation))}}async register(e){if(!this.initialized){if(await this.editorMessageService.queryIsReady()){const e=await this.editorMessageService.queryCurrentScene();this.onSceneReady(e)}console.debug("L10nComponentManagerService register"),e.Component.on("added",this._onComponentAdd),e.Component.on("removed",this._onComponentRemoved),this.initialized=!0}}unregister(e){this.initialized&&(console.debug("L10nComponentManagerService unregister"),e.Component.off("added",this._onComponentAdd),e.Component.off("removed",this._onComponentRemoved),this.initialized=!1)}};L10nComponentManagerService=__decorate([(0,tsyringe_1.singleton)(),__metadata("design:paramtypes",[MainIPC_1.default,EditorMessageService_1.default])],L10nComponentManagerService),exports.default=L10nComponentManagerService;