"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(n<3?o(a):n>3?o(t,r,a):o(t,r))||a);return n>3&&a&&Object.defineProperty(t,r,a),a},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path");module.paths.push((0,path_1.join)(Editor.App.path,"node_modules"));const cc=__importStar(require("cc")),tsyringe_1=require("tsyringe"),AssetSerializeService_1=__importDefault(require("../serialize/AssetSerializeService")),SceneProcessor_1=__importDefault(require("./SceneProcessor"));let ComponentUnLoader=class{constructor(e){this.assetSerializeService=e}process(e){let t,r=null;if(e.type.includes("Scene")){const i=this.assetSerializeService.deserializeFile(e.file);t=i,r=i.scene}else if(e.type.includes("Prefab")){const i=this.assetSerializeService.deserializeFile(e.file);t=i,r=i.data}if(!r)return;this.unloadComponent(r)>0&&this.assetSerializeService.serialize(e.file,t)}unloadComponent(e){let t=0;return e.walk(e=>{if(e instanceof cc.Node){const r=e.getComponent(SceneProcessor_1.default.L10nLabelComponentName);r&&(r.destroy(),t+=1);const i=e.getComponent(SceneProcessor_1.default.ICUComponentName);i&&(i.destroy(),t+=1)}}),cc.CCObject._deferredDestroy(),t}};ComponentUnLoader=__decorate([(0,tsyringe_1.autoInjectable)(),__metadata("design:paramtypes",[AssetSerializeService_1.default])],ComponentUnLoader),exports.default=ComponentUnLoader;