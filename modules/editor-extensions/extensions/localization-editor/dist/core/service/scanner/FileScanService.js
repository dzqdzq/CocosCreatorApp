"use strict";var __decorate=this&&this.__decorate||function(e,t,a,r){var s,n=arguments.length,i=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,a,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(n<3?s(i):n>3?s(t,a,i):s(t,a))||i);return n>3&&i&&Object.defineProperty(t,a,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const tsyringe_1=require("tsyringe"),TranslateItemType_1=__importDefault(require("../../entity/translate/TranslateItemType")),EditorMessageService_1=__importDefault(require("../EditorMessageService")),TranslateDataSourceService_1=__importDefault(require("../persistent/TranslateDataSourceService"));let FileScanService=class{constructor(e,t){this.editorMessageService=e,this.translateDataSourceService=t}async scan(e,t,{fromPattern:a,toPattern:r,progress:s}={}){const n=this.translateDataSourceService.getShouldTranslateItems(t.locale).filter(e=>e.type===TranslateItemType_1.default.Media);console.debug("FileScanService.scan shouldTranslateItems",n);const i=[];for(const[o,c]of n.entries()){null===s||void 0===s||s(o+1,n.length);const l=await this.editorMessageService.queryAssetInfo(c.value);if(!l){console.debug(`FileScanService.scan not found: ${c.value} assetInfo`);continue}const u=l.url.replaceAll(null!==a&&void 0!==a?a:e.locale,null!==r&&void 0!==r?r:t.locale);if(!u.startsWith("db://assets/")){console.warn(`FileScanService.scan the resources: ${u} not into db://assets/`);continue}if(u===l.url)continue;const f=await this.editorMessageService.queryAssetInfo(u);if(!f){console.warn(`FileScanService.scan not found: ${u} assetInfo`);continue}const d=c.clone();d.value=f.uuid,i.push(d)}return i}};FileScanService=__decorate([(0,tsyringe_1.singleton)(),__metadata("design:paramtypes",[EditorMessageService_1.default,TranslateDataSourceService_1.default])],FileScanService),exports.default=FileScanService;