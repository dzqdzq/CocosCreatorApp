"use strict";var __decorate=this&&this.__decorate||function(e,i,r,t){var a,o=arguments.length,n=o<3?i:null===t?t=Object.getOwnPropertyDescriptor(i,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,i,r,t);else for(var f=e.length-1;f>=0;f--)(a=e[f])&&(n=(o<3?a(n):o>3?a(i,r,n):a(i,r))||n);return o>3&&n&&Object.defineProperty(i,r,n),n},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const EditorConfig_1=__importDefault(require("../../entity/config/EditorConfig")),global_1=require("../util/global"),tsyringe_1=require("tsyringe"),TranslateProviderConfigMap_1=__importDefault(require("../../entity/config/TranslateProviderConfigMap"));let EditorConfigService=class{initDataSource(){this.editorConfig=new EditorConfig_1.default,this.translateProviderConfigMap=new TranslateProviderConfigMap_1.default}async persistent(){await Editor.Profile.setConfig(global_1.MainName,EditorConfig_1.default.ConfigName,this.editorConfig,"local"),await Editor.Profile.setConfig(global_1.MainName,TranslateProviderConfigMap_1.default.ConfigsName,this.translateProviderConfigMap,"global")}async read(){try{this.editorConfig=EditorConfig_1.default.parse(await Editor.Profile.getConfig(global_1.MainName,EditorConfig_1.default.ConfigName)),this.translateProviderConfigMap=TranslateProviderConfigMap_1.default.parse(await Editor.Profile.getConfig(global_1.MainName,TranslateProviderConfigMap_1.default.ConfigsName))}catch(e){this.initDataSource()}}async uninstall(){await Editor.Profile.removeConfig(global_1.MainName,EditorConfig_1.default.ConfigName),await Editor.Profile.removeConfig(global_1.MainName,TranslateProviderConfigMap_1.default.ConfigsName),this.initDataSource()}async preview(e){this.editorConfig.currentPreview=e,await this.persistent()}getCurrentPreview(){return this.editorConfig.currentPreview}getCurrentTranslateProviderConfig(){const e=this.translateProviderConfigMap.currentProviderConfig;if(e)return this.getTranslateProviderConfig(e)}getTranslateProviderConfig(e){var i;return null===(i=this.translateProviderConfigMap.translateProviderConfigs[e])||void 0===i?void 0:i.clone()}async setCurrentTranslateProviderConfig(e){let i=!1;return e.name!==this.translateProviderConfigMap.currentProviderConfig&&(i=!0),this.translateProviderConfigMap.currentProviderConfig=e.name,this.translateProviderConfigMap.translateProviderConfigs[e.name]=e,await this.persistent(),i}async clearTranslateProviderConfig(){this.translateProviderConfigMap=new TranslateProviderConfigMap_1.default,await this.persistent()}};EditorConfigService=__decorate([(0,tsyringe_1.singleton)()],EditorConfigService),exports.default=EditorConfigService;