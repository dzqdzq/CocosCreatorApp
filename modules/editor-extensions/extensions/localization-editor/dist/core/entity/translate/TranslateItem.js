"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const Association_1=__importDefault(require("./Association")),TranslateItemType_1=__importDefault(require("./TranslateItemType")),crypto_js_1=__importDefault(require("crypto-js"));class TranslateItem{constructor(t,s,a,e=!1,i=[],n=[]){this.key=t,this.value=s,this.type=a,this.isVariant=e,this.associations=i,this._variants=n}get variants(){return this._variants}addVariant(t){return t.isVariant=!0,this._variants.push(t),this}clone(){const t=new TranslateItem(this.key,this.value,this.type);return t.isVariant=this.isVariant,t._variants=this._variants.map(t=>t.clone()),t.associations=this.associations.map(t=>t.clone()),t}clearValue(){return this.value="",this}clearAssociation(){return this.associations.length=0,this}clearVariant(){return this._variants.length=0,this}removeAssociation(t){let s;s="number"==typeof t?t:this.associations.findIndex(s=>s.equals(t));const a=this.associations[s];for(let t=s+1;t<this.associations.length;t++)this.associations[t-1]=this.associations[t];return this.associations.length-=1,a}static parse(t){return new TranslateItem(t.key,t.value,t.type,t.isVariant,t.associations.map(t=>Association_1.default.parse(t)),t._variants.map(t=>TranslateItem.parse(t)))}equals(t){return this.key===t.key&&this.value===t.value&&this.type===t.type&&this.isVariant===t.isVariant&&this.associations.length===t.associations.length&&this._variants.length===t._variants.length}merge(t,{replaceVariant:s=!1,replaceValue:a=!0,replaceKey:e=!1,replaceAssociation:i=!1}={}){if(e&&(this.key=t.key),a&&(this.value=t.value),this.type===TranslateItemType_1.default.Media&&(this.associations.length=0),i)this.associations=t.associations;else{const s=new Set(this.associations.map(t=>JSON.stringify(t)));for(const a of t.associations)s.has(JSON.stringify(a))||this.associations.push(a)}if(s)this._variants=t._variants;else{const s=new Set(this._variants.map(t=>JSON.stringify(t)));for(const a of t._variants)s.has(JSON.stringify(a))||this._variants.push(a)}return this}get length(){switch(this.type){case TranslateItemType_1.default.Text:case TranslateItemType_1.default.Script:return this.value.length;case TranslateItemType_1.default.Media:return 1;default:return 0}}static base64Decode(t){const s=crypto_js_1.default.enc.Base64.parse(t),a=crypto_js_1.default.enc.Utf8.stringify(s);try{return TranslateItem.parse(JSON.parse(a))}catch(t){return}}base64Encode(){const t=JSON.stringify(this),s=crypto_js_1.default.enc.Utf8.parse(t);return crypto_js_1.default.enc.Base64.stringify(s)}}exports.default=TranslateItem;