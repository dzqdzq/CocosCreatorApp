"use strict";var L10nManagerWrapper_1,__decorate=this&&this.__decorate||function(e,a,r,t){var n,s=arguments.length,i=s<3?a:null===t?t=Object.getOwnPropertyDescriptor(a,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,a,r,t);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(i=(s<3?n(i):s>3?n(a,r,i):n(a,r))||i);return s>3&&i&&Object.defineProperty(a,r,i),i},__metadata=this&&this.__metadata||function(e,a){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,a)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path");module.paths.push((0,path_1.join)(Editor.App.path,"node_modules"));const cc_1=require("cc"),global_1=require("../service/util/global"),tsyringe_1=require("tsyringe"),EditorMessageService_1=__importDefault(require("../service/EditorMessageService")),MainIPC_1=__importDefault(require("../ipc/MainIPC"));let L10nManagerWrapper=L10nManagerWrapper_1=class{constructor(e,a){this.editorMessageService=e,this.mainIpc=a}async l10nManager(){return(await Editor.Module.importProjectModule(`db://${global_1.MainName}/core/l10n-manager.ts`)).default}async preview(e){const a=await this.l10nManager();a.isInitialized()||await a.createIntl({}),await(await this.l10nManager()).changeLanguage(e),await this.releaseAsset(),this.editorMessageService.softReload()}async reloadResourceData(){const e=(await this.l10nManager()).reloadResourceData();return await this.releaseAsset(),await this.editorMessageService.softReload(),e}async addResourceBundle(e,a){await Promise.all(L10nManagerWrapper_1.ALLOW_NAMESPACE.map(r=>this.addResourceBundleForNamespace(e,a,r))),this.editorMessageService.softReload()}async addResourceBundleForNamespace(e,a,r){var t,n;const s=await this.l10nManager(),i=s._intl;(null===i||void 0===i?void 0:i.hasResourceBundle(e,r))&&(null===i||void 0===i||i.removeResourceBundle(e,r));const o=a[e][r];null===i||void 0===i||i.addResourceBundle(e,r,o,!0,!0),null!==(t=(n=s.resourceBundle)[e])&&void 0!==t||(n[e]={}),s.resourceBundle[e][r]=o}async removeResourceBundle(e){const a=await this.l10nManager(),r=a._intl;null===r||void 0===r||r.removeResourceBundle(e,L10nManagerWrapper_1.DEFAULT_NAMESPACE),null===r||void 0===r||r.removeResourceBundle(e,L10nManagerWrapper_1.ASSET_NAMESPACE),delete a.resourceBundle[e],await this.releaseAsset(),this.editorMessageService.softReload()}async uninstall(){const e=await this.l10nManager();e._intl=void 0,e.resourceList=void 0,e.resourceBundle={}}async releaseAsset(){cc_1.assetManager.releaseAll()}};L10nManagerWrapper.DEFAULT_NAMESPACE=global_1.DEFAULT_NAMESPACE,L10nManagerWrapper.ASSET_NAMESPACE=global_1.ASSET_NAMESPACE,L10nManagerWrapper.ALLOW_NAMESPACE=global_1.ALLOW_NAMESPACE,L10nManagerWrapper=L10nManagerWrapper_1=__decorate([(0,tsyringe_1.singleton)(),__metadata("design:paramtypes",[EditorMessageService_1.default,MainIPC_1.default])],L10nManagerWrapper),exports.default=L10nManagerWrapper;