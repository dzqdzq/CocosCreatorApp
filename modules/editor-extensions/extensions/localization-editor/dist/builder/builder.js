"use strict";var __decorate=this&&this.__decorate||function(e,t,a,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(o=(r<3?s(o):r>3?s(t,a,o):s(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),require("reflect-metadata");const fs_extra_1=require("fs-extra"),path_1=require("path"),tsyringe_1=require("tsyringe"),CacheService_1=__importDefault(require("../core/service/util/CacheService")),global_1=require("../core/service/util/global"),EditorMessageService_1=__importDefault(require("../core/service/EditorMessageService")),MainIPC_1=__importDefault(require("../core/ipc/MainIPC")),editorMessageService=tsyringe_1.container.resolve(EditorMessageService_1.default);let Builder=class{constructor(e,t){this.mainIPC=e,this.editorMessageService=t,this.panelPath="../../panel-dist/builder/index.js",this.configs={"*":{hooks:"./hooks"}},this.icuDirPath=(0,path_1.join)(__dirname,"../../static/assets/polyfills").replace("app.asar","app.asar.unpacked"),this.ResourceListJsonURL=`db://${global_1.MainName}/${global_1.RuntimeBundleName}/${global_1.resourceListPath}.json`,this.ResourceBundleJsonURL=`db://${global_1.MainName}/${global_1.RuntimeBundleName}/${global_1.resourceBundlePath}.json`}async load(){tsyringe_1.container.resolve(CacheService_1.default).clear(),this.configs["*"].panel=await this.mainIPC.getLocalLanguage()?this.panelPath:void 0}async getAllLanguagesInfo(){const e=await this.mainIPC.getLocalLanguage(),t=[];if(e){const a=await this.mainIPC.getLanguageConfig(e),i=await this.mainIPC.getAllLanguageConfigs();t.push(...i),a&&t.push(a)}return t}async getICUlPolyfillFileInfos(){if((0,fs_extra_1.existsSync)(this.icuDirPath)){const e=(await(0,fs_extra_1.readdir)(this.icuDirPath)).map(e=>(0,path_1.join)(this.icuDirPath,e)).filter(e=>e.endsWith(".ts")),t=[];for(let a=0;a<e.length;a++){const i=e[a],s=await editorMessageService.queryAssetInfo(i);(null===s||void 0===s?void 0:s.uuid)?t.push({name:(0,path_1.basename)(i,".ts"),uuid:s.uuid}):console.warn(`[${global_1.MainName}]: cannot get assetInfo of ${i}`)}return t}return[]}async getResourceListJsonAssetInfo(){const e=await this.editorMessageService.queryAssetInfo(this.ResourceListJsonURL);return e||console.warn(`[${global_1.MainName}]: cannot get assetInfo of ${this.ResourceListJsonURL}`),e}async getResourceBundleJsonAssetInfo(){const e=await this.editorMessageService.queryAssetInfo(this.ResourceBundleJsonURL);return e||console.warn(`[${global_1.MainName}]: cannot get assetInfo of ${this.ResourceBundleJsonURL}`),e}};Builder=__decorate([(0,tsyringe_1.singleton)(),__metadata("design:paramtypes",[MainIPC_1.default,EditorMessageService_1.default])],Builder);const builder=tsyringe_1.container.resolve(Builder);module.exports=builder,exports.default=builder;