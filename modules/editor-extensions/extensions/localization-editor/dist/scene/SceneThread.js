"use strict";var __decorate=this&&this.__decorate||function(e,r,a,t){var n,s=arguments.length,i=s<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,a):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,a,t);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(i=(s<3?n(i):s>3?n(r,a,i):n(r,a))||i);return s>3&&i&&Object.defineProperty(r,a,i),i},__metadata=this&&this.__metadata||function(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const tsyringe_1=require("tsyringe"),ScanOption_1=__importDefault(require("../core/entity/messages/ScanOption")),ScanService_1=__importDefault(require("../core/service/scanner/ScanService")),EditorMessageService_1=__importDefault(require("../core/service/EditorMessageService")),MainMessage_1=require("../core/entity/messages/MainMessage"),Errors_1=require("../core/error/Errors"),TranslateData_1=__importDefault(require("../core/entity/translate/TranslateData")),MainIPC_1=__importDefault(require("../core/ipc/MainIPC")),l10n_component_manager_service_1=__importDefault(require("../core/service/component/l10n-component-manager-service")),l10n_manager_wrapper_1=__importDefault(require("../core/wrapper/l10n-manager-wrapper"));let SceneThread=class{constructor(e,r,a,t){this.l10nManagerWrapper=e,this.editorMessageService=r,this.mainIpc=a,this.l10nComponentManagerService=t}async scan(e){if(await this.editorMessageService.queryDirty())throw new Error(`${Errors_1.CustomError.NAME}:${MainMessage_1.MessageCode.EDITOR_DIRTY}`);if(0===e.length)throw new Error(`${Errors_1.CustomError.NAME}:${MainMessage_1.MessageCode.SCAN_OPTION_EMPTY}`);e=e.map(e=>ScanOption_1.default.parse(e));const r=tsyringe_1.container.resolve(ScanService_1.default),a=await this.mainIpc.getTranslateDataObject(),t=TranslateData_1.default.fromObject(a),n=await r.scan(t,e.map(e=>ScanOption_1.default.parse(e)),(e,r)=>{this.editorMessageService.scanProgress(e,r)});await this.mainIpc.saveTranslateData(t.locale,n),await this.editorMessageService.refreshAssets()}async uninstall(e,r){if(await this.editorMessageService.queryDirty())throw new Error(`${Errors_1.CustomError.NAME}:${MainMessage_1.MessageCode.EDITOR_DIRTY}`);const a=tsyringe_1.container.resolve(ScanService_1.default);await a.scanAndUnInstall(e.map(e=>ScanOption_1.default.parse(e)),(e,r)=>{this.editorMessageService.scanProgress(e,r)}),await this.l10nManagerWrapper.uninstall(),await this.l10nManagerWrapper.releaseAsset(r),await this.editorMessageService.softReload()}async onSceneReady(e){this.l10nComponentManagerService.onSceneReady(e)}addResourceBundle(e,r){return this.l10nManagerWrapper.addResourceBundle(e,r)}preview(e,r){return this.l10nManagerWrapper.preview(e,r)}reloadResourceData(){return this.l10nManagerWrapper.reloadResourceData()}removeResourceBundle(e,r){return this.l10nManagerWrapper.removeResourceBundle(e,r)}};SceneThread=__decorate([(0,tsyringe_1.singleton)(),__metadata("design:paramtypes",[l10n_manager_wrapper_1.default,EditorMessageService_1.default,MainIPC_1.default,l10n_component_manager_service_1.default])],SceneThread),exports.default=SceneThread;