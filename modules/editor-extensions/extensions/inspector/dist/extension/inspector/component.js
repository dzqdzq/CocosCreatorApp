"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InspectorPropComponent=exports.InspectorComponent=void 0;const element_1=require("../element"),ui_1=require("./ui");class InspectorComponent extends HTMLElement{constructor(){super(),this._uuids=[],this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="\n        <style>\n            :host { display: block; }\n        </style>\n        <slot></slot>\n        ",this._content=this}set uuids(e){this._uuids=e,this.createTempalte()}get uuids(){return this._uuids}update(){this.updateTempalte(this._uuids)}async queryTemplate(){return await Editor.Message.request("scene","execute-scene-script",{name:"inspector",method:"queryComponentRender",args:[this.uuids]})}async emitEvent(e,t){Editor.Message.send("scene","execute-scene-script",{name:"inspector",method:"emitComponentRenderEvent",args:[this.uuids,e.id,t,e.attrs]})}async createTempalte(){const e=await this.queryTemplate();if(!e)return;const t=element_1.deserialize(e);t.addEventListener("elem-change",this.emitEvent.bind(this));const s=ui_1.createElement(t);this._content.innerHTML="",this._content.appendChild(s),this._vElem=t}async updateTempalte(e){const t=await this.queryTemplate();if(!t)return;const s=element_1.deserialize(t);this._vElem.apply(s),this._vElem.addEventListener("elem-change",this.emitEvent.bind(this))}}exports.InspectorComponent=InspectorComponent;class InspectorPropComponent extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.hasAttribute("dump")&&setTimeout(()=>{this.updateDump(this.getAttribute("dump")||"")},0),this.shadowRoot.addEventListener("change-dump",()=>{const e=this.$prop.dump;Editor.Message.send("scene","set-property",{uuid:e.nodeUUID,path:e.path,dump:e})})}updateDump(e){if("string"!=typeof e)return;const t=this.shadowRoot;if(!this.$prop){const e=document.createElement("ui-prop");e.setAttribute("type","dump"),t.appendChild(e),this.$prop=e}this.$prop.dump=JSON.parse(e),this.$prop.render(),!1===this.$prop.dump.visible?this.setAttribute("hidden",""):this.removeAttribute("hidden")}static get observedAttributes(){return["dump"]}attributeChangedCallback(e,t,s){switch(e){case"dump":this.updateDump(s)}}}exports.InspectorPropComponent=InspectorPropComponent;