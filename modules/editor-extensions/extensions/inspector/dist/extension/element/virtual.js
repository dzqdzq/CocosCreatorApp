"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualElement=void 0;let ID=1e3;class Additional{constructor(){this.parent=null,this.events={}}changeCallback(){}}const elementMap=new WeakMap;class VirtualElement{constructor(t){this.id=ID++,this.tag=t.toLocaleLowerCase(),this.text="",this.attrs={},this.events=[],this.children=[],elementMap.set(this,new Additional)}setAttribute(t,e){e+="",this.attrs[t]=e+""}removeAttribute(t){delete this.attrs[t]}getAttribute(t){return this.attrs[t]}hasAttribute(t){return t in this.attrs}addEventListener(t,e){if("function"!=typeof e)return;const n=elementMap.get(this);n.events[t]||(n.events[t]=[],this.events.push(t));const s=n.events[t];s.includes(e)||s.push(e)}removeEventListener(t,e){const n=elementMap.get(this);if(!n.events[t])return;const s=n.events[t],i=s.indexOf(e);if(-1!==i&&s.splice(i,1),0===s.length){delete n.events[t];const e=this.events.indexOf(t);-1!==e&&this.events.splice(e,1)}}removeAllEventListener(t){const e=elementMap.get(this);if(!e.events[t])return;delete e.events[t];const n=this.events.indexOf(t);-1!==n&&this.events.splice(n,1)}async dispatch(t,...e){const n=elementMap.get(this);if(!n.events[t])return;const s=n.events[t];return Promise.all(s.map(t=>t.call(this,...e)))}setParent(t){elementMap.get(this).parent=t}getParent(){return elementMap.get(this).parent||null}getRoot(){let t=this.getParent(),e=t;for(;t;)e=t,t=t.getParent();return e}appendChild(t){this.children.includes(t)||(this.children.push(t),t.setParent(this))}insertChild(t,e){this.children.includes(t)&&this.removeChild(t),this.children.splice(e,0,t),t.setParent(this)}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.setParent(null))}queryChildrenByTag(t){const e=[];return function n(s){for(const n of s)n.tag===t&&e.push(n);for(const t of s)n(t.children)}(this.children),e}queryChildByID(t){return function e(n){for(const e of n)if(e.id===t)return e;for(const t of n){const n=e(t.children);if(n)return n}}(this.children)}apply(t){this.tag=t.tag,this.text=t.text,this.attrs=JSON.parse(JSON.stringify(t.attrs)),this.events=JSON.parse(JSON.stringify(t.events));const e=elementMap.get(this);e.events={};const n=elementMap.get(t);for(const t in n.events)e.events[t]=n.events[t];t.children.forEach((t,e)=>{let n;for(let s=e;s<this.children.length;s++)if(t.tag===this.children[s].tag){n=this.children[s];break}n?n.apply(t):n=t,this.insertChild(n,e)}),this.children.length=t.children.length,e.changeCallback.call(this)}setChangeCallback(t){const e=elementMap.get(this);e.changeCallback="function"==typeof t?t:function(){}}}exports.VirtualElement=VirtualElement;