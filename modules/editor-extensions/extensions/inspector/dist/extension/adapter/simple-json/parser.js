'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.decode = exports.parserJSONObjectMap = void 0;
const element_1 = require("../../element");
exports.parserJSONObjectMap = {
    '*': {
        generate() {
            return { type: 'vbox', children: [] };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('unknown');
            $elem.setAttribute('ui-type', json.type);
            return $elem;
        },
    },
    prop: {
        generate() {
            return { type: 'prop', children: [] };
        },
        decode(json) {
            let $elem;
            if ('bind' in json && json.bind) {
                $elem = new element_1.VirtualElement('inspector-prop');
                $elem.setAttribute('type', 'dump');
                $elem.setAttribute('bind', json.bind);
                if ('properties' in json && json.properties) {
                    $elem.setAttribute('properties', JSON.stringify(json.properties));
                }
                // array
                // asset
                // bit-mask
                // boolean
                // color
                // component
                // enum
                // vec2
                // vec3
                // vec4
                // rect
                // size
                // string
                // object
                // node
                // number
                // animation-socket
                // click-event
                // curve-range
                // gradient-range
                // gradient
                // mat4
                // null
                // object-optional-types
                // real-curve
                // unknown
            }
            else {
                $elem = new element_1.VirtualElement('ui-prop');
                if ('label' in json && json.label) {
                    const $label = new element_1.VirtualElement('ui-label');
                    $label.setAttribute('slot', 'label');
                    $label.setAttribute('value', json.label);
                    $elem.appendChild($label);
                }
                if ('children' in json && json.children) {
                    const $contentArray = json.children.map(child => parse(child));
                    $contentArray?.forEach($child => {
                        $child.setAttribute('slot', 'content');
                        $elem.appendChild($child);
                    });
                }
            }
            return $elem;
        },
    },
    button: {
        generate() {
            return { type: 'button', label: '' };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('ui-button');
            if ('label' in json && json.label) {
                const $label = new element_1.VirtualElement('ui-label');
                $label.setAttribute('value', json.label);
                $elem.appendChild($label);
            }
            if ('icon' in json && json.icon) {
                const $icon = new element_1.VirtualElement('ui-icon');
                $icon.setAttribute('value', json.icon);
                $elem.appendChild($icon);
            }
            if ('click' in json && json.click) {
                $elem.setAttribute('click', json.click);
            }
            return $elem;
        },
    },
    line: {
        generate() {
            return { type: 'line' };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('div');
            $elem.setAttribute('style', 'border-top: 1px solid #000;');
            return $elem;
        },
    },
    space: {
        generate() {
            return { type: 'space', size: 1 };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('div');
            $elem.setAttribute('style', `padding: ${json.size}px;`);
            return $elem;
        },
    },
    vbox: {
        generate() {
            return { type: 'vbox', children: [] };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('div');
            $elem.setAttribute('style', 'display: flex; flex-direction: column;');
            json.children.forEach((childJSON) => {
                const $child = parse(childJSON);
                $elem.appendChild($child);
            });
            return $elem;
        },
    },
    hbox: {
        generate() {
            return { type: 'hbox', children: [] };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('div');
            $elem.setAttribute('style', 'display: flex; flex-direction: row;');
            json.children.forEach((childJSON) => {
                const $child = parse(childJSON);
                $elem.appendChild($child);
            });
            return $elem;
        },
    },
    label: {
        generate() {
            return { type: 'label', label: '' };
        },
        decode(json) {
            const $elem = new element_1.VirtualElement('ui-label');
            $elem.setAttribute('value', json.label || '');
            return $elem;
        },
    },
};
function parse(json) {
    const parser = exports.parserJSONObjectMap[json.type] || exports.parserJSONObjectMap['*'];
    return parser.decode(json);
}
/**
 * 传入一个 json 对象
 * 解析成 VirtualElement 数据
 * 如果传入了一个 target，则会反序列化到这个 target 上，复用元素
 * @param xml
 * @param target
 * @returns
 */
function decode(json, target, map) {
    if (target && target.tag !== 'inspector-root') {
        throw new Error('Not a legitimate root node');
    }
    // const map: Map<VirtualElement, number> = new Map();
    const $elem = new element_1.VirtualElement('inspector-root');
    const $child = parse(json);
    $elem.appendChild($child);
    if (target) {
        target.apply($elem);
    }
    else {
        target = $elem;
    }
    // // 删除多余的元素
    // function step(elem: VirtualElement) {
    //     const length = map.get(elem) || 0;
    //     elem.children.length = length;
    //     elem.children.forEach(step);
    // }
    // if (target) {
    //     step(target);
    // }
    return target;
}
exports.decode = decode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc291cmNlL2V4dGVuc2lvbi9hZGFwdGVyL3NpbXBsZS1qc29uL3BhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7OztBQUViLDJDQUErQztBQVlsQyxRQUFBLG1CQUFtQixHQUU1QjtJQUNBLEdBQUcsRUFBRTtRQUNELFFBQVE7WUFDSixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDMUMsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFjO1lBQ2pCLE1BQU0sS0FBSyxHQUFHLElBQUksd0JBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM1QyxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekMsT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQztLQUNKO0lBQ0QsSUFBSSxFQUFFO1FBQ0YsUUFBUTtZQUNKLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQztRQUMxQyxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQVc7WUFDZCxJQUFJLEtBQWlDLENBQUM7WUFDdEMsSUFBSSxNQUFNLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQzdCLEtBQUssR0FBRyxJQUFJLHdCQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDN0MsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ25DLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdEMsSUFBSSxZQUFZLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7b0JBQ3pDLEtBQUssQ0FBQyxZQUFZLENBQUMsWUFBWSxF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RDs7Ozs7OztHQU9HO0FBQ0gsU0FBZ0IsTUFBTSxDQUFDLElBQWMsRUFBRSxNQUF1QixFQUFFLEdBQStDO0lBQzNHLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxHQUFHLEtBQUssZ0JBQWdCLEVBQUU7UUFDM0MsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0tBQ2pEO0lBRUQsc0RBQXNEO0lBQ3RELE1BQU0sS0FBSyxHQUFHLElBQUksd0JBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBRW5ELE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixLQUFLLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRTFCLElBQUksTUFBTSxFQUFFO1FBQ1IsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN2QjtTQUFNO1FBQ0gsTUFBTSxHQUFHLEtBQUssQ0FBQztLQUNsQjtJQUVELGFBQWE7SUFDYix3Q0FBd0M7SUFDeEMseUNBQXlDO0lBQ3pDLHFDQUFxQztJQUNyQyxtQ0FBbUM7SUFDbkMsSUFBSTtJQUNKLGdCQUFnQjtJQUNoQixvQkFBb0I7SUFDcEIsSUFBSTtJQUVKLE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUE1QkQsd0JBNEJDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBWaXJ0dWFsRWxlbWVudCB9IGZyb20gJy4uLy4uL2VsZW1lbnQnO1xuaW1wb3J0IHtcbiAgICBJRWxlbWVudCxcbiAgICBJUHJvcCxcbiAgICBJQnV0dG9uLFxuICAgIElWQm94LFxuICAgIElIQm94LFxuICAgIElMYWJlbCxcbiAgICBJTGluZSxcbiAgICBJU3BhY2UsXG59IGZyb20gJy4vaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHBhcnNlckpTT05PYmplY3RNYXA6IHtcbiAgICBba2V5OiBzdHJpbmddOiB7IGdlbmVyYXRlKCk6IElFbGVtZW50LCBkZWNvZGUoanNvbjogSUVsZW1lbnQpOiBWaXJ0dWFsRWxlbWVudCB9XG59ID0ge1xuICAgICcqJzoge1xuICAgICAgICBnZW5lcmF0ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICd2Ym94JywgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIH0sXG4gICAgICAgIGRlY29kZShqc29uOiBJRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgJGVsZW0gPSBuZXcgVmlydHVhbEVsZW1lbnQoJ3Vua25vd24nKTtcbiAgICAgICAgICAgICRlbGVtLnNldEF0dHJpYnV0ZSgndWktdHlwZScsIGpzb24udHlwZSk7XG4gICAgICAgICAgICByZXR1cm4gJGVsZW07XG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBwcm9wOiB7XG4gICAgICAgIGdlbmVyYXRlKCk6IElQcm9wIHtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdwcm9wJywgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIH0sXG4gICAgICAgIGRlY29kZShqc29uOiBJUHJvcCkge1xuICAgICAgICAgICAgbGV0ICRlbGVtOiBWaXJ0dWFsRWxlbWVudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmICgnYmluZCcgaW4ganNvbiAmJiBqc29uLmJpbmQpIHtcbiAgICAgICAgICAgICAgICAkZWxlbSA9IG5ldyBWaXJ0dWFsRWxlbWVudCgnaW5zcGVjdG9yLXByb3AnKTtcbiAgICAgICAgICAgICAgICAkZWxlbS5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnZHVtcCcpO1xuICAgICAgICAgICAgICAgICRlbGVtLnNldEF0dHJpYnV0ZSgnYmluZCcsIGpzb24uYmluZCk7XG4gICAgICAgICAgICAgICAgaWYgKCdwcm9wZXJ0aWVzJyBpbiBqc29uICYmIGpzb24ucHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICAkZWxlbS5zZXRBdHRyaWJ1dGUoJ3Byb3BlcnRpZXMnLCBKU09OLnN0cmluZ2lmeShqc29uLnByb3BlcnRpZXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gYXJyYXlcbiAgICAgICAgICAgICAgICAvLyBhc3NldFxuICAgICAgICAgICAgICAgIC8vIGJpdC1tYXNrXG4gICAgICAgICAgICAgICAgLy8gYm9vbGVhblxuICAgICAgICAgICAgICAgIC8vIGNvbG9yXG4gICAgICAgICAgICAgICAgLy8gY29tcG9uZW50XG4gICAgICAgICAgICAgICAgLy8gZW51bVxuICAgICAgICAgICAgICAgIC8vIHZlYzJcbiAgICAgICAgICAgICAgICAvLyB2ZWMzXG4gICAgICAgICAgICAgICAgLy8gdmVjNFxuICAgICAgICAgICAgICAgIC8vIHJlY3RcbiAgICAgICAgICAgICAgICAvLyBzaXplXG4gICAgICAgICAgICAgICAgLy8gc3RyaW5nXG4gICAgICAgICAgICAgICAgLy8gb2JqZWN0XG4gICAgICAgICAgICAgICAgLy8gbm9kZVxuICAgICAgICAgICAgICAgIC8vIG51bWJlclxuXG4gICAgICAgICAgICAgICAgLy8gYW5pbWF0aW9uLXNvY2tldFxuICAgICAgICAgICAgICAgIC8vIGNsaWNrLWV2ZW50XG4gICAgICAgICAgICAgICAgLy8gY3VydmUtcmFuZ2VcbiAgICAgICAgICAgICAgICAvLyBncmFkaWVudC1yYW5nZVxuICAgICAgICAgICAgICAgIC8vIGdyYWRpZW50XG4gICAgICAgICAgICAgICAgLy8gbWF0NFxuICAgICAgICAgICAgICAgIC8vIG51bGxcbiAgICAgICAgICAgICAgICAvLyBvYmplY3Qtb3B0aW9uYWwtdHlwZXNcbiAgICAgICAgICAgICAgICAvLyByZWFsLWN1cnZlXG4gICAgICAgICAgICAgICAgLy8gdW5rbm93blxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkZWxlbSA9IG5ldyBWaXJ0dWFsRWxlbWVudCgndWktcHJvcCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCdsYWJlbCcgaW4ganNvbiAmJiBqc29uLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRsYWJlbCA9IG5ldyBWaXJ0dWFsRWxlbWVudCgndWktbGFiZWwnKTtcbiAgICAgICAgICAgICAgICAgICAgJGxhYmVsLnNldEF0dHJpYnV0ZSgnc2xvdCcsICdsYWJlbCcpO1xuICAgICAgICAgICAgICAgICAgICAkbGFiZWwuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGpzb24ubGFiZWwpO1xuICAgICAgICAgICAgICAgICAgICAkZWxlbS5hcHBlbmRDaGlsZCgkbGFiZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoJ2NoaWxkcmVuJyBpbiBqc29uICYmIGpzb24uY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGNvbnRlbnRBcnJheSA9IGpzb24uY2hpbGRyZW4ubWFwKGNoaWxkID0+IHBhcnNlKGNoaWxkKSk7XG4gICAgICAgICAgICAgICAgICAgICRjb250ZW50QXJyYXk/LmZvckVhY2goJGNoaWxkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjaGlsZC5zZXRBdHRyaWJ1dGUoJ3Nsb3QnLCAnY29udGVudCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW0hLmFwcGVuZENoaWxkKCRjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkZWxlbTtcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIGJ1dHRvbjoge1xuICAgICAgICBnZW5lcmF0ZSgpOiBJQnV0dG9uIHtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdidXR0b24nLCBsYWJlbDogJycgfTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVjb2RlKGpzb246IElCdXR0b24pIHtcbiAgICAgICAgICAgIGNvbnN0ICRlbGVtID0gbmV3IFZpcnR1YWxFbGVtZW50KCd1aS1idXR0b24nKTtcbiAgICAgICAgICAgIGlmICgnbGFiZWwnIGluIGpzb24gJiYganNvbi5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0ICRsYWJlbCA9IG5ldyBWaXJ0dWFsRWxlbWVudCgndWktbGFiZWwnKTtcbiAgICAgICAgICAgICAgICAkbGFiZWwuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGpzb24ubGFiZWwpO1xuICAgICAgICAgICAgICAgICRlbGVtLmFwcGVuZENoaWxkKCRsYWJlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJ2ljb24nIGluIGpzb24gJiYganNvbi5pY29uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGljb24gPSBuZXcgVmlydHVhbEVsZW1lbnQoJ3VpLWljb24nKTtcbiAgICAgICAgICAgICAgICAkaWNvbi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywganNvbi5pY29uKTtcbiAgICAgICAgICAgICAgICAkZWxlbS5hcHBlbmRDaGlsZCgkaWNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJ2NsaWNrJyBpbiBqc29uICYmIGpzb24uY2xpY2spIHtcbiAgICAgICAgICAgICAgICAkZWxlbS5zZXRBdHRyaWJ1dGUoJ2NsaWNrJywganNvbi5jbGljayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJGVsZW07XG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBsaW5lOiB7XG4gICAgICAgIGdlbmVyYXRlKCk6IElMaW5lIHtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdsaW5lJyB9O1xuICAgICAgICB9LFxuICAgICAgICBkZWNvZGUoanNvbjogSUxpbmUpIHtcbiAgICAgICAgICAgIGNvbnN0ICRlbGVtID0gbmV3IFZpcnR1YWxFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICRlbGVtLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnYm9yZGVyLXRvcDogMXB4IHNvbGlkICMwMDA7Jyk7XG4gICAgICAgICAgICByZXR1cm4gJGVsZW07XG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBzcGFjZToge1xuICAgICAgICBnZW5lcmF0ZSgpOiBJU3BhY2Uge1xuICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ3NwYWNlJywgc2l6ZTogMSB9O1xuICAgICAgICB9LFxuICAgICAgICBkZWNvZGUoanNvbjogSVNwYWNlKSB7XG4gICAgICAgICAgICBjb25zdCAkZWxlbSA9IG5ldyBWaXJ0dWFsRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAkZWxlbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYHBhZGRpbmc6ICR7anNvbi5zaXplfXB4O2ApO1xuICAgICAgICAgICAgcmV0dXJuICRlbGVtO1xuICAgICAgICB9LFxuICAgIH0sXG4gICAgdmJveDoge1xuICAgICAgICBnZW5lcmF0ZSgpOiBJVkJveCB7XG4gICAgICAgICAgICByZXR1cm4geyB0eXBlOiAndmJveCcsIGNoaWxkcmVuOiBbXSB9O1xuICAgICAgICB9LFxuICAgICAgICBkZWNvZGUoanNvbjogSVZCb3gpIHtcbiAgICAgICAgICAgIGNvbnN0ICRlbGVtID0gbmV3IFZpcnR1YWxFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICRlbGVtLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsnKTtcbiAgICAgICAgICAgIGpzb24uY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGRKU09OKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGNoaWxkID0gcGFyc2UoY2hpbGRKU09OKTtcbiAgICAgICAgICAgICAgICAkZWxlbS5hcHBlbmRDaGlsZCgkY2hpbGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJGVsZW07XG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBoYm94OiB7XG4gICAgICAgIGdlbmVyYXRlKCk6IElIQm94IHtcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdoYm94JywgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIH0sXG4gICAgICAgIGRlY29kZShqc29uOiBJSEJveCkge1xuICAgICAgICAgICAgY29uc3QgJGVsZW0gPSBuZXcgVmlydHVhbEVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgJGVsZW0uc2V0QXR0cmlidXRlKCdzdHlsZScsICdkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogcm93OycpO1xuICAgICAgICAgICAganNvbi5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZEpTT04pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCAkY2hpbGQgPSBwYXJzZShjaGlsZEpTT04pO1xuICAgICAgICAgICAgICAgICRlbGVtLmFwcGVuZENoaWxkKCRjaGlsZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkZWxlbTtcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIGxhYmVsOiB7XG4gICAgICAgIGdlbmVyYXRlKCk6IElMYWJlbCB7XG4gICAgICAgICAgICByZXR1cm4geyB0eXBlOiAnbGFiZWwnLCBsYWJlbDogJycgfTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVjb2RlKGpzb246IElMYWJlbCkge1xuICAgICAgICAgICAgY29uc3QgJGVsZW0gPSBuZXcgVmlydHVhbEVsZW1lbnQoJ3VpLWxhYmVsJyk7XG4gICAgICAgICAgICAkZWxlbS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywganNvbi5sYWJlbCB8fCAnJyk7XG4gICAgICAgICAgICByZXR1cm4gJGVsZW07XG4gICAgICAgIH0sXG4gICAgfSxcbn07XG5cbmZ1bmN0aW9uIHBhcnNlKGpzb246IElFbGVtZW50KTogVmlydHVhbEVsZW1lbnQge1xuICAgIGNvbnN0IHBhcnNlciA9IHBhcnNlckpTT05PYmplY3RNYXBbanNvbi50eXBlXSB8fCBwYXJzZXJKU09OT2JqZWN0TWFwWycqJ107XG4gICAgcmV0dXJuIHBhcnNlci5kZWNvZGUoanNvbik7XG59XG5cbi8qKlxuICog5Lyg5YWl5LiA5LiqIGpzb24g5a+56LGhXG4gKiDop6PmnpDmiJAgVmlydHVhbEVsZW1lbnQg5pWw5o2uXG4gKiDlpoLmnpzkvKDlhaXkuobkuIDkuKogdGFyZ2V077yM5YiZ5Lya5Y+N5bqP5YiX5YyW5Yiw6L+Z5LiqIHRhcmdldCDkuIrvvIzlpI3nlKjlhYPntKBcbiAqIEBwYXJhbSB4bWwgXG4gKiBAcGFyYW0gdGFyZ2V0IFxuICogQHJldHVybnMgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGUoanNvbjogSUVsZW1lbnQsIHRhcmdldD86IFZpcnR1YWxFbGVtZW50LCBtYXA/OiBXZWFrTWFwPElFbGVtZW50LCB7IFtrZXk6IHN0cmluZ106IGFueSB9Pik6IFZpcnR1YWxFbGVtZW50IHtcbiAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC50YWcgIT09ICdpbnNwZWN0b3Itcm9vdCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgYSBsZWdpdGltYXRlIHJvb3Qgbm9kZScpO1xuICAgIH1cblxuICAgIC8vIGNvbnN0IG1hcDogTWFwPFZpcnR1YWxFbGVtZW50LCBudW1iZXI+ID0gbmV3IE1hcCgpO1xuICAgIGNvbnN0ICRlbGVtID0gbmV3IFZpcnR1YWxFbGVtZW50KCdpbnNwZWN0b3Itcm9vdCcpO1xuXG4gICAgY29uc3QgJGNoaWxkID0gcGFyc2UoanNvbik7XG4gICAgJGVsZW0uYXBwZW5kQ2hpbGQoJGNoaWxkKTtcblxuICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgdGFyZ2V0LmFwcGx5KCRlbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXQgPSAkZWxlbTtcbiAgICB9XG5cbiAgICAvLyAvLyDliKDpmaTlpJrkvZnnmoTlhYPntKBcbiAgICAvLyBmdW5jdGlvbiBzdGVwKGVsZW06IFZpcnR1YWxFbGVtZW50KSB7XG4gICAgLy8gICAgIGNvbnN0IGxlbmd0aCA9IG1hcC5nZXQoZWxlbSkgfHwgMDtcbiAgICAvLyAgICAgZWxlbS5jaGlsZHJlbi5sZW5ndGggPSBsZW5ndGg7XG4gICAgLy8gICAgIGVsZW0uY2hpbGRyZW4uZm9yRWFjaChzdGVwKTtcbiAgICAvLyB9XG4gICAgLy8gaWYgKHRhcmdldCkge1xuICAgIC8vICAgICBzdGVwKHRhcmdldCk7XG4gICAgLy8gfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbn1cblxuLy8gLyoqXG4vLyAgKiDkvKDlhaUgVmlydHVhbEVsZW1lbnQg5pWw5o2u77yM6L6T5Ye6IGpzb24g5a+56LGhXG4vLyAgKiBAcGFyYW0gZWxlbSBcbi8vICAqIEByZXR1cm5zIFxuLy8gICovXG4vLyBleHBvcnQgZnVuY3Rpb24gZW5jb2RlKGVsZW06IFZpcnR1YWxFbGVtZW50KTogc3RyaW5nIHtcbi8vICAgICBsZXQgeG1sID0gJyc7XG4vLyAgICAgZnVuY3Rpb24gc3RlcChjaGlsZHJlbjogVmlydHVhbEVsZW1lbnRbXSkge1xuLy8gICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4vLyAgICAgICAgICAgICBsZXQgYXR0cnMgPSAnJztcbi8vICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNoaWxkLmF0dHJzKSB7XG4vLyAgICAgICAgICAgICAgICAgYXR0cnMgKz0gYCAke2tleX09XCIke2NoaWxkLmF0dHJzW2tleV19XCJgO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgeG1sICs9IGA8JHtjaGlsZC50YWcudG9Mb3dlckNhc2UoKX0ke2F0dHJzfT5gO1xuLy8gICAgICAgICAgICAgc3RlcChjaGlsZC5jaGlsZHJlbik7XG4vLyAgICAgICAgICAgICB4bWwgKz0gYCR7Y2hpbGQudGV4dH08LyR7Y2hpbGQudGFnLnRvTG93ZXJDYXNlKCl9PmA7XG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgc3RlcChlbGVtLmNoaWxkcmVuKTtcbi8vICAgICByZXR1cm4geG1sO1xuLy8gfVxuIl19