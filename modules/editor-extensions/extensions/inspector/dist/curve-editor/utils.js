"use strict";const DEFAULT_KEYFRAMES=[[{time:0,value:1,outTangent:0,inTangent:0},{time:1,value:1,outTangent:0,inTangent:0}],[{time:0,value:0,outTangent:1,inTangent:1},{time:1,value:1,outTangent:1,inTangent:1}],[{time:0,value:1,outTangent:-1,inTangent:-1},{time:1,value:0,outTangent:-1,inTangent:-1}],[{time:0,value:0,outTangent:0,inTangent:0},{time:1,value:1,outTangent:2,inTangent:2}],[{time:0,value:1,outTangent:-2,inTangent:-2},{time:1,value:0,outTangent:0,inTangent:0}],[{time:0,value:0,outTangent:2,inTangent:2},{time:1,value:1,outTangent:0,inTangent:0}],[{time:0,value:1,outTangent:0,inTangent:0},{time:1,value:0,outTangent:0,inTangent:0}]];class Point{constructor(n){this.x=Number(n.x),this.y=Number(n.y),n.type&&(this.type=n.type)}}function drawLine(n,t,e){e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(t.x,t.y),e.closePath(),e.stroke()}function calcHermite(n,t,e,a){if(t===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY)return{a:0,b:0,c:0,d:n.y};const i=n.x,o=n.y,u=e.x,T=e.y;let c,r,g,l,m,s,I;const v=[1,i,i*i,i*i*i,1,u,u*u,u*u*u,0,1,2*i,3*i*i,0,1,2*u,3*u*u],f=n=>n[0]*n[4]*n[8]+n[1]*n[5]*n[6]+n[2]*n[3]*n[7]-n[2]*n[4]*n[6]-n[1]*n[3]*n[8]-n[0]*n[5]*n[7];for(c=I=0;c<4;I+=f(s)*v[c]*(c%2?-1:1),c++)if(v[c])for(r=4,s=[];r<v.length;r++)r%4!==c&&s.push(v[r]);for(m=[],c=0;c<4;c++)for(r=0;r<4;m[c+4*r]=((c+r)%2?-1:1)*f(s)/I,r++)for(s=[],g=0;g<3;g++)for(l=0;l<3;l++)s.push(v[(c+g+1)%4*4+(r+l+1)%4]);const p=o*m[0]+T*m[1]+t*m[2]+a*m[3],E=o*m[4]+T*m[5]+t*m[6]+a*m[7],F=o*m[8]+T*m[9]+t*m[10]+a*m[11];return{a:o*m[12]+T*m[13]+t*m[14]+a*m[15],b:F,c:E,d:p}}function drawHermite(n,t,e){n||(n=DEFAULT_KEYFRAMES[0]);const a=t.canvas.width,i=t.canvas.height;let o;t.clearRect(0,0,a,i),o=e?i/a/2:i/a;const u=n.map(n=>{return{point:{x:n.time*a,y:n.value*i},outTangent:"number"==typeof n.outTangent?n.outTangent*o:1/0,inTangent:"number"==typeof n.inTangent?n.inTangent*o:1/0}});for(let n=0;n<u.length-1;n++){const a=u[n+1],o=u[n],T=calcFunc(calcHermite(o.point,o.outTangent,a.point,a.inTangent));t.beginPath();for(let n=o.point.x;n<=a.point.x;n++)e?t.lineTo(n,i-.5*T(n)-i/2):t.lineTo(n,i-T(n));o.outTangent!==Number.POSITIVE_INFINITY&&a.inTangent!==Number.POSITIVE_INFINITY||(t.lineTo(a.point.x,i-a.point.y),console.log(u,n),t.stroke()),t.stroke()}e&&(t.strokeStyle="#ccc",t.lineWidth=.5,t.beginPath(),t.moveTo(0,i/2),t.lineTo(a,i/2),t.stroke())}function calcFunc(n){const{a:t,b:e,c:a,d:i}=n;return n=>t*n*n*n+e*n*n+a*n+i}module.exports={Point:Point,drawLine:drawLine,calcHermite:calcHermite,drawHermite:drawHermite,calcFunc:calcFunc,DEFAULT_KEYFRAMES:DEFAULT_KEYFRAMES};