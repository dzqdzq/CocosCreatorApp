"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const HALF_TEXT_WIDTH=5,POINT_LENGTH=2,{Point:Point}=require("./utils");class Grid{set cxt2D(t){this.canvas=t.canvas,this._cxt2D=t}get cxt2D(){return this._cxt2D}set multiplier(t){0!==t&&(this._multiplier=t,this.rePaint())}get multiplier(){return this._multiplier}set negative(t){t!==this._negative&&(this._negative=t,this.rePaint())}get negative(){return this._negative}get step(){const t=this.location.w/this.axis.piece,i=this.location.h/this.axis.piece,{rangeX:e,rangeY:s}=this.axis,a=Number((e/this.axis.piece).toFixed(POINT_LENGTH));let h=Number((s/this.axis.piece).toFixed(POINT_LENGTH));const n=Number((1/this.axis.piece).toFixed(POINT_LENGTH));let r=Number((1/this.axis.piece).toFixed(POINT_LENGTH));return this.negative&&(h*=2,r*=2),{spaceX:t,spaceY:i,stepX:a,stepY:h,orgStepX:n,orgStepY:r}}get location(){return{x:this.axesMargin,y:this.axesMargin,w:this.canvas.width-2*this.axesMargin,h:this.canvas.height-2*this.axesMargin}}constructor(t){this._negative=!1,this.cxt2D=t.context,this.axesMargin=t.axisMargin,this.axis=t.axis,this._multiplier=t.multiplier||1,this.cxt2D.lineWidth=t.lineWidth,this.cxt2D.strokeStyle=t.color||"#333"}draw(){const{spaceX:t,spaceY:i}=this.step;this.drawGrid(t/4,i/2,"rgba(51, 51, 51, 0.44)",.5),this.negative?this.drawGrid(t,1*i,"#3a3939",1):this.drawGrid(t,2*i,"#3a3939",1);const{x:e,w:s,h:a}=this.location;this.cxt2D.strokeStyle="#333",this.cxt2D.lineWidth=1.5,this.negative&&(this.cxt2D.beginPath(),this.cxt2D.moveTo(e,a/2+e+.5),this.cxt2D.lineTo(s+e,a/2+e+.5),this.cxt2D.stroke()),this.drawAxis()}rePaint(){this.clear(),this.draw()}axisToOri(t){const{w:i,h:e}=this.location;let s;return{time:Number((t.x/i).toFixed(POINT_LENGTH)),value:s=this.negative?Number((t.y/e*2).toFixed(POINT_LENGTH)):Number((t.y/e).toFixed(POINT_LENGTH))}}tranToAxis(t){const{w:i,h:e}=this.location;let s;s=this.negative?t.value*e/2:t.value*e;const a=t.time*i;return new Point({x:a,y:s})}tranToCanvas(t){const i=this.tranToAxis(t);return this.axisToCanvas(i)}canvasToAxis(t){const{x:i,y:e,h:s}=this.location,a=t.x-i;let h=s-t.y+e;return this.negative&&(h=s/2-t.y+e),new Point({x:a,y:h})}axisToCanvas(t){const{x:i,y:e,h:s}=this.location;return this.negative?new Point({x:t.x+i,y:s/2-t.y+e}):new Point({x:t.x+i,y:s-t.y+e})}clear(){const{x:t,y:i,w:e,h:s}=this.location;this.cxt2D.clearRect(t,i,e,s)}drawAxis(){this.cxt2D.lineWidth=2;const{x:t,y:i,w:e,h:s}=this.location,{stepX:a,stepY:h,spaceX:n,spaceY:r}=this.step;this.cxt2D.clearRect(0,0,this.axesMargin,s+this.axesMargin),this.cxt2D.clearRect(0,s+this.axesMargin,e+this.axesMargin,this.axesMargin),this.cxt2D.strokeRect(t,i,e,s),this.cxt2D.fillStyle="#ccc";let c=t-HALF_TEXT_WIDTH,o=0;for(;c<t+e;)this.cxt2D.fillText(o,c,i+s+t/2),o=Number((o+a).toFixed(2)),c+=n;let x=i+s,l=this.negative?-1*this.multiplier:0;for(;Math.ceil(x)>=i;)this.cxt2D.fillText(l,i/2-HALF_TEXT_WIDTH,x),l=Number((l+h*this.multiplier).toFixed(2)),x-=r}drawGrid(t,i,e,s){s&&(this.cxt2D.lineWidth=s),e&&(this.cxt2D.strokeStyle=e);const{x:a,y:h,w:n,h:r}=this.location;for(let i=a;i<n+a;i+=t)this.cxt2D.beginPath(),this.cxt2D.moveTo(i+.5,h),this.cxt2D.lineTo(i+.5,r+h),this.cxt2D.stroke();for(let t=r+a;t>a;t-=i)this.cxt2D.beginPath(),this.cxt2D.moveTo(a,t+.5),this.cxt2D.lineTo(n+a,t+.5),this.cxt2D.stroke()}}exports.default=Grid;