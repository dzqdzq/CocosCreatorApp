"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.addCompileTask=exports.addChromeDebugSetting=exports.vscodeWorkflowError=exports.vscodeWorkflowWarn=exports.vscodeWorkflowLog=void 0;const fs_extra_1=require("fs-extra"),json5_1=__importDefault(require("json5")),path_1=__importDefault(require("path"));function vscodeWorkflowLog(o){console.log("[vscode-workflow]: "+o)}function vscodeWorkflowWarn(o){console.warn("[vscode-workflow]: "+o)}function vscodeWorkflowError(o){console.error("[vscode-workflow]: "+o)}async function addChromeDebugSetting(){const o=Editor.Project.path,e=path_1.default.join(o,".vscode"),r=path_1.default.join(e,"launch.json"),t="http://localhost:"+await Editor.Message.request("server","query-port"),s={version:"0.2.0",configurations:[{type:"chrome",request:"launch",name:"Cocos Creator Launch Chrome against localhost",url:t,webRoot:"${workspaceFolder}"}]};let a;try{const o=await fs_extra_1.readFile(r,"utf-8");a=json5_1.default.parse(o)}catch(o){a=s}fs_extra_1.ensureDirSync(e),a.configurations=a.configurations||[];const n=a.configurations.find(o=>"Cocos Creator Launch Chrome against localhost"===o.name);return n?n.url=t:a.configurations.push(...s.configurations),await fs_extra_1.writeFile(r,JSON.stringify(a,null,4),"utf-8"),vscodeWorkflowLog(String.raw`Chrome debug setting has been updated to ${o}\.vscode\launch.json,`+" please install Debugger for Chrome VS Code extension to debug your project."),null}async function addCompileTask(){const o=Editor.Project.path,e=path_1.default.join(o,".vscode"),r=path_1.default.join(e,"tasks.json"),t=[`http://localhost:${await Editor.Message.request("server","query-port")}/asset-db/refresh`],s={version:"2.0.0",tasks:[{label:"Cocos Creator compile",command:"curl",args:t,type:"shell",isBackground:!0,group:"build",presentation:{reveal:"always"}}]};let a;try{const o=await fs_extra_1.readFile(r,"utf-8");a=json5_1.default.parse(o)}catch(o){a=s}fs_extra_1.ensureDirSync(e),a.tasks=a.tasks||[];const n=a.tasks.find(o=>"Cocos Creator compile"===o.label);n?n.args=t:a.tasks.push(...s.tasks),await fs_extra_1.writeFile(r,JSON.stringify(a,null,4),"utf-8"),vscodeWorkflowLog(String.raw`Cocos Creator Compiling task has been added to ${o}\.vscode\tasks.json, please run "${"Cocos Creator compile"}" task in VS Code to trigger compile in Cocos Creator.`)}exports.vscodeWorkflowLog=vscodeWorkflowLog,exports.vscodeWorkflowWarn=vscodeWorkflowWarn,exports.vscodeWorkflowError=vscodeWorkflowError,exports.addChromeDebugSetting=addChromeDebugSetting,exports.addCompileTask=addCompileTask;