'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.isOnlineExtension = exports.sleep = exports.checkPackagePathType = exports.throttle = exports.formatDate = exports.recursive = exports.getPackageType = exports.handleUnexpectedImportError = exports.handleManualInstall = exports.handleInvalidPath = exports.handleCancelImport = exports.handleDecompressFail = exports.FAKE_AUTHOR_ID = exports.INTERNAL_EXTENSION_NAME = void 0;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
// FIXME: 使用 import 时需要额外配置 tsconfig。配置后使用 tsc 编译时， package.json 会被同步复制到 dist 目录，这一点不符合预期
// 暂时只能用 require
const packageJson = require('../../package.json');
/**
 * extension 插件自身的名称
 */
exports.INTERNAL_EXTENSION_NAME = packageJson.name;
exports.FAKE_AUTHOR_ID = -1;
/**
 *
 * @param zipPath
 * @param extensionName
 * @param handleError 是否自己采用默认方法处理错误，否的话就会向上抛出
 */
async function handleDecompressFail(zipPath, extensionName, handleError) {
    // 自动安装失败
    const infoResult = await Editor.Dialog.info(Editor.I18n.t('extension.menu.decompressFail'), {
        cancel: 0,
        buttons: [
            Editor.I18n.t('extension.store.cancel'),
            Editor.I18n.t('extension.store.confirm'),
        ],
    });
    if (infoResult.response) {
        const saveResult = await Editor.Dialog.select({
            title: Editor.I18n.t('extension.menu.copyPackageTitle', { extensionName: extensionName + '.zip' }),
            type: 'directory',
        });
        if (saveResult.canceled) {
            if (handleError) {
                handleCancelImport();
            }
            else {
                throw new Error('cancel');
            }
        }
        else if (saveResult.filePaths[0]) {
            const targetPath = path_1.join(saveResult.filePaths[0], extensionName + '.zip');
            await Editor.Utils.File.copy(zipPath, targetPath);
            console.log(`[extension] copy ${extensionName}.zip to ${targetPath}`);
            if (handleError) {
                handleManualInstall();
            }
            else {
                throw new Error('manual install');
            }
        }
    }
    else {
        if (handleError) {
            handleCancelImport();
        }
        else {
            throw new Error('cancel');
        }
    }
}
exports.handleDecompressFail = handleDecompressFail;
function handleCancelImport() {
    Editor.Task.addNotice({
        title: Editor.I18n.t('extension.store.install_cancel'),
        type: 'log',
        source: 'extension',
        timeout: 8000,
    });
}
exports.handleCancelImport = handleCancelImport;
function handleInvalidPath(path) {
    Editor.Task.addNotice({
        title: Editor.I18n.t('extension.menu.invalidPath', { path }),
        type: 'error',
        source: 'extension',
        timeout: 8000,
    });
}
exports.handleInvalidPath = handleInvalidPath;
function handleManualInstall() {
    console.log(Editor.I18n.t('extension.store.install_manual_guide', { url: Editor.App.urls.manual }));
    // 用户在自动安装失败的时候选择了自己手动安装
    Editor.Task.addNotice({
        title: Editor.I18n.t('extension.store.install_manual_title'),
        message: Editor.I18n.t('extension.store.install_manual_content'),
        source: 'extension',
        type: 'warn',
    });
}
exports.handleManualInstall = handleManualInstall;
function handleUnexpectedImportError(error) {
    Editor.Task.addNotice({
        title: Editor.I18n.t('extension.store.install_fail'),
        message: error?.message,
        type: 'error',
        source: 'extension',
        timeout: 10000,
    });
}
exports.handleUnexpectedImportError = handleUnexpectedImportError;
function getPackageType(path) {
    let type;
    if (Editor.Utils.Path.contains(Editor.App.path, path)) {
        type = 'internal';
    }
    else if (Editor.Utils.Path.contains(Editor.Project.path, path)) {
        type = 'project';
    }
    else if (Editor.Utils.Path.contains(Editor.App.home, path)) {
        type = 'global';
    }
    else {
        type = 'develop';
    }
    return type;
}
exports.getPackageType = getPackageType;
/**
 * 递归某个文件夹
 * @param dir
 * @param handle
 */
function recursive(dir, handle) {
    function step(file) {
        if (!fs_extra_1.existsSync(file)) {
            return;
        }
        const stat = fs_extra_1.statSync(file);
        if (stat.isDirectory()) {
            fs_extra_1.readdirSync(file).forEach((name) => {
                const child = path_1.join(file, name);
                step(child);
            });
        }
        else {
            handle(file);
        }
    }
    step(dir);
}
exports.recursive = recursive;
/**
 * 格式化时间， 默认将时间戳处理成yyyy-MM-dd
 * @param str 时间戳或者时间格式字符串
 * @param strFormat 返回的格式，支持 yyyy-MM-dd HH:mm:ss
 * @returns
 */
function formatDate(str, strFormat) {
    if (!str)
        return;
    if (!strFormat)
        strFormat = 'yyyy-MM-dd';
    switch (typeof str) {
        case 'string':
            str = new Date(str.replace(/-/g, '/'));
            break;
        case 'number':
            str = new Date(str);
            break;
    }
    if (str instanceof Date) {
        const dict = {
            yyyy: str.getFullYear(),
            M: str.getMonth() + 1,
            d: str.getDate(),
            H: str.getHours,
            m: str.getMinutes(),
            s: str.getSeconds(),
            MM: ('' + (str.getMonth() + 101)).substr(1),
            dd: ('' + (str.getDate() + 100)).substr(1),
            HH: ('' + (str.getHours() + 100)).substr(1),
            mm: ('' + (str.getMinutes() + 100)).substr(1),
            ss: ('' + (str.getSeconds() + 100)).substr(1),
        };
        return strFormat.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g, function (...args) {
            return dict[args[0]];
        });
    }
}
exports.formatDate = formatDate;
/**
 * 节流
 * @param func 要执行的函数
 * @param time 间隔时间 毫秒
 * @param immediate 是否要立即执行
 * @returns
 */
const throttle = (func, time, immediate = false) => {
    if (immediate) {
        let prevTime = 0;
        return (...args) => {
            const nowTime = Date.now();
            if (nowTime - prevTime >= time) {
                func.apply(this, args);
                prevTime = nowTime;
            }
        };
    }
    else {
        let timer = null;
        return (...args) => {
            if (!timer) {
                func.apply(this, args);
                timer = window.setTimeout(() => {
                    if (timer) {
                        clearTimeout(timer);
                    }
                    timer = null;
                }, time);
            }
        };
    }
};
exports.throttle = throttle;
function checkPackagePathType(path) {
    //@ts-ignore
    return Editor.Package.__protected__.checkType(path);
}
exports.checkPackagePathType = checkPackagePathType;
const sleep = (ms = 100) => {
    let abort = () => { };
    const p = new Promise((resovle, reject) => {
        const handle = window.setTimeout(() => {
            resovle();
        }, ms);
        abort = () => {
            window.clearTimeout(handle);
            reject(new Error('cancel'));
        };
    });
    p.abort = abort;
    return p;
};
exports.sleep = sleep;
/**
 * 判断一个插件是不是服务端插件（在服务端存在数据）
 */
function isOnlineExtension(item) {
    // 存在 latest_version 数据，判断是服务端存在的插件
    const keyLatestVersion = 'latest_version';
    return keyLatestVersion in item;
}
exports.isOnlineExtension = isOnlineExtension;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvcHVibGljL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBQ2IsdUNBQTZEO0FBQzdELCtCQUE0QjtBQUc1Qix5RkFBeUY7QUFDekYsZ0JBQWdCO0FBQ2hCLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBRWxEOztHQUVHO0FBQ1UsUUFBQSx1QkFBdUIsR0FBVyxXQUFXLENBQUMsSUFBSSxDQUFDO0FBRW5ELFFBQUEsY0FBYyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBRWpDOzs7OztHQUtHO0FBQ0ksS0FBSyxVQUFVLG9CQUFvQixDQUFDLE9BQWUsRUFBRSxhQUFxQixFQUFFLFdBQW9CO0lBQ25HLFNBQVM7SUFDVCxNQUFNLFVBQVUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLCtCQUErQixDQUFDLEVBQUU7UUFDeEYsTUFBTSxFQUFFLENBQUM7UUFDVCxPQUFPLEVBQUU7WUFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQztZQUN2QyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQztTQUMzQztLQUNKLENBQUMsQ0FBQztJQUNILElBQUksVUFBVSxDQUFDLFFBQVEsRUFBRTtRQUNyQixNQUFNLFVBQVUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxpQ0FBaUMsRUFBRSxFQUFFLGFBQWEsRUFBRSxhQUFhLEdBQUcsTUFBTSxFQUFFLENBQUM7WUFDbEcsSUFBSSxFQUFFLFdBQVc7U0FDcEIsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxVQUFVLENBQUMsUUFBUSxF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QUVGOztHQUVHO0FBQ0gsU0FBZ0IsaUJBQWlCLENBQUMsSUFBbUI7SUFDakQsbUNBQW1DO0lBQ25DLE1BQU0sZ0JBQWdCLEdBQThCLGdCQUFnQixDQUFDO0lBRXJFLE9BQU8sZ0JBQWdCLElBQUksSUFBSSxDQUFDO0FBQ3BDLENBQUM7QUFMRCw4Q0FLQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IGV4aXN0c1N5bmMsIHJlYWRkaXJTeW5jLCBzdGF0U3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IFBhY2thZ2VJbmZvLCBQYWNrYWdlUGF0aFR5cGUsIEV4dGVuc2lvbkl0ZW1PbmxpbmUsIEV4dGVuc2lvbkl0ZW0gfSBmcm9tICcuL2ludGVyZmFjZSc7XG5cbi8vIEZJWE1FOiDkvb/nlKggaW1wb3J0IOaXtumcgOimgemineWklumFjee9riB0c2NvbmZpZ+OAgumFjee9ruWQjuS9v+eUqCB0c2Mg57yW6K+R5pe277yMIHBhY2thZ2UuanNvbiDkvJrooqvlkIzmraXlpI3liLbliLAgZGlzdCDnm67lvZXvvIzov5nkuIDngrnkuI3nrKblkIjpooTmnJ9cbi8vIOaaguaXtuWPquiDveeUqCByZXF1aXJlXG5jb25zdCBwYWNrYWdlSnNvbiA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2UuanNvbicpO1xuXG4vKipcbiAqIGV4dGVuc2lvbiDmj5Lku7boh6rouqvnmoTlkI3np7BcbiAqL1xuZXhwb3J0IGNvbnN0IElOVEVSTkFMX0VYVEVOU0lPTl9OQU1FOiBzdHJpbmcgPSBwYWNrYWdlSnNvbi5uYW1lO1xuXG5leHBvcnQgY29uc3QgRkFLRV9BVVRIT1JfSUQgPSAtMTtcblxuLyoqXG4gKiBcbiAqIEBwYXJhbSB6aXBQYXRoIFxuICogQHBhcmFtIGV4dGVuc2lvbk5hbWUgXG4gKiBAcGFyYW0gaGFuZGxlRXJyb3Ig5piv5ZCm6Ieq5bex6YeH55So6buY6K6k5pa55rOV5aSE55CG6ZSZ6K+v77yM5ZCm55qE6K+d5bCx5Lya5ZCR5LiK5oqb5Ye6XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVEZWNvbXByZXNzRmFpbCh6aXBQYXRoOiBzdHJpbmcsIGV4dGVuc2lvbk5hbWU6IHN0cmluZywgaGFuZGxlRXJyb3I6IGJvb2xlYW4pIHtcbiAgICAvLyDoh6rliqjlronoo4XlpLHotKVcbiAgICBjb25zdCBpbmZvUmVzdWx0ID0gYXdhaXQgRWRpdG9yLkRpYWxvZy5pbmZvKEVkaXRvci5JMThuLnQoJ2V4dGVuc2lvbi5tZW51LmRlY29tcHJlc3NGYWlsJyksIHtcbiAgICAgICAgY2FuY2VsOiAwLFxuICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICBFZGl0b3IuSTE4bi50KCdleHRlbnNpb24uc3RvcmUuY2FuY2VsJyksXG4gICAgICAgICAgICBFZGl0b3IuSTE4bi50KCdleHRlbnNpb24uc3RvcmUuY29uZmlybScpLFxuICAgICAgICBdLFxuICAgIH0pO1xuICAgIGlmIChpbmZvUmVzdWx0LnJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnN0IHNhdmVSZXN1bHQgPSBhd2FpdCBFZGl0b3IuRGlhbG9nLnNlbGVjdCh7XG4gICAgICAgICAgICB0aXRsZTogRWRpdG9yLkkxOG4udCgnZXh0ZW5zaW9uLm1lbnUuY29weVBhY2thZ2VUaXRsZScsIHsgZXh0ZW5zaW9uTmFtZTogZXh0ZW5zaW9uTmFtZSArICcuemlwJyB9KSxcbiAgICAgICAgICAgIHR5cGU6ICdkaXJlY3RvcnknLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNhdmVSZXN1bHQuY2FuY2VsZWQpIHtcbiAgICAgICAgICAgIGlmIChoYW5kbGVFcnJvcikge1xuICAgICAgICAgICAgICAgIGhhbmRsZUNhbmNlbEltcG9ydCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhbmNlbCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHNhdmVSZXN1bHQuZmlsZVBhdGhzWzBdKSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRQYXRoID0gam9pbihzYXZlUmVzdWx0LmZpbGVQYXRoc1swXSwgZXh0ZW5zaW9uTmFtZSArICcuemlwJyk7XG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuVXRpbHMuRmlsZS5jb3B5KHppcFBhdGgsIHRhcmdldFBhdGgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFtleHRlbnNpb25dIGNvcHkgJHtleHRlbnNpb25OYW1lfS56aXAgdG8gJHt0YXJnZXRQYXRofWApO1xuICAgICAgICAgICAgaWYgKGhhbmRsZUVycm9yKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlTWFudWFsSW5zdGFsbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hbnVhbCBpbnN0YWxsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaGFuZGxlRXJyb3IpIHtcbiAgICAgICAgICAgIGhhbmRsZUNhbmNlbEltcG9ydCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW5jZWwnKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUNhbmNlbEltcG9ydCgpIHtcbiAgICBFZGl0b3IuVGFzay5hZGROb3RpY2Uoe1xuICAgICAgICB0aXRsZTogRWRpdG9yLkkxOG4udCgnZXh0ZW5zaW9uLnN0b3JlLmluc3RhbGxfY2FuY2VsJyksXG4gICAgICAgIHR5cGU6ICdsb2cnLFxuICAgICAgICBzb3VyY2U6ICdleHRlbnNpb24nLFxuICAgICAgICB0aW1lb3V0OiA4MDAwLFxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlSW52YWxpZFBhdGgocGF0aDogc3RyaW5nKSB7XG4gICAgRWRpdG9yLlRhc2suYWRkTm90aWNlKHtcbiAgICAgICAgdGl0bGU6IEVkaXRvci5JMThuLnQoJ2V4dGVuc2lvbi5tZW51LmludmFsaWRQYXRoJywgeyBwYXRoIH0pLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBzb3VyY2U6ICdleHRlbnNpb24nLFxuICAgICAgICB0aW1lb3V0OiA4MDAwLFxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlTWFudWFsSW5zdGFsbCgpIHtcbiAgICBjb25zb2xlLmxvZyhFZGl0b3IuSTE4bi50KCdleHRlbnNpb24uc3RvcmUuaW5zdGFsbF9tYW51YWxfZ3VpZGUnLCB7IHVybDogRWRpdG9yLkFwcC51cmxzLm1hbnVhbCB9KSk7XG4gICAgLy8g55So5oi35Zyo6Ieq5Yqo5a6J6KOF5aSx6LSl55qE5pe25YCZ6YCJ5oup5LqG6Ieq5bex5omL5Yqo5a6J6KOFXG4gICAgRWRpdG9yLlRhc2suYWRkTm90aWNlKHtcbiAgICAgICAgdGl0bGU6IEVkaXRvci5JMThuLnQoJ2V4dGVuc2lvbi5zdG9yZS5pbnN0YWxsX21hbnVhbF90aXRsZScpLFxuICAgICAgICBtZXNzYWdlOiBFZGl0b3IuSTE4bi50KCdleHRlbnNpb24uc3RvcmUuaW5zdGFsbF9tYW51YWxfY29udGVudCcpLFxuICAgICAgICBzb3VyY2U6ICdleHRlbnNpb24nLFxuICAgICAgICB0eXBlOiAnd2FybicsXG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVVbmV4cGVjdGVkSW1wb3J0RXJyb3IoZXJyb3I/OiBFcnJvcikge1xuICAgIEVkaXRvci5UYXNrLmFkZE5vdGljZSh7XG4gICAgICAgIHRpdGxlOiBFZGl0b3IuSTE4bi50KCdleHRlbnNpb24uc3RvcmUuaW5zdGFsbF9mYWlsJyksXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yPy5tZXNzYWdlLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBzb3VyY2U6ICdleHRlbnNpb24nLFxuICAgICAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRQYWNrYWdlVHlwZShwYXRoOiBzdHJpbmcpIHtcbiAgICBsZXQgdHlwZTogUGFja2FnZUluZm9bJ3R5cGUnXTtcbiAgICBpZiAoRWRpdG9yLlV0aWxzLlBhdGguY29udGFpbnMoRWRpdG9yLkFwcC5wYXRoLCBwYXRoKSkge1xuICAgICAgICB0eXBlID0gJ2ludGVybmFsJztcbiAgICB9IGVsc2UgaWYgKEVkaXRvci5VdGlscy5QYXRoLmNvbnRhaW5zKEVkaXRvci5Qcm9qZWN0LnBhdGgsIHBhdGgpKSB7XG4gICAgICAgIHR5cGUgPSAncHJvamVjdCc7XG4gICAgfSBlbHNlIGlmIChFZGl0b3IuVXRpbHMuUGF0aC5jb250YWlucyhFZGl0b3IuQXBwLmhvbWUsIHBhdGgpKSB7XG4gICAgICAgIHR5cGUgPSAnZ2xvYmFsJztcbiAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gJ2RldmVsb3AnO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZTtcbn1cblxuLyoqXG4gKiDpgJLlvZLmn5DkuKrmlofku7blpLlcbiAqIEBwYXJhbSBkaXJcbiAqIEBwYXJhbSBoYW5kbGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlY3Vyc2l2ZShkaXI6IHN0cmluZywgaGFuZGxlOiBGdW5jdGlvbikge1xuICAgIGZ1bmN0aW9uIHN0ZXAoZmlsZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICghZXhpc3RzU3luYyhmaWxlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXQgPSBzdGF0U3luYyhmaWxlKTtcbiAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgcmVhZGRpclN5bmMoZmlsZSkuZm9yRWFjaCgobmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBqb2luKGZpbGUsIG5hbWUpO1xuICAgICAgICAgICAgICAgIHN0ZXAoY2hpbGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYW5kbGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGVwKGRpcik7XG59XG5cbi8qKlxuICog5qC85byP5YyW5pe26Ze077yMIOm7mOiupOWwhuaXtumXtOaIs+WkhOeQhuaIkHl5eXktTU0tZGRcbiAqIEBwYXJhbSBzdHIg5pe26Ze05oiz5oiW6ICF5pe26Ze05qC85byP5a2X56ym5LiyXG4gKiBAcGFyYW0gc3RyRm9ybWF0IOi/lOWbnueahOagvOW8j++8jOaUr+aMgSB5eXl5LU1NLWRkIEhIOm1tOnNzXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGUoc3RyOiBhbnksIHN0ckZvcm1hdD86IGFueSkge1xuICAgIGlmICghc3RyKSByZXR1cm47XG4gICAgaWYgKCFzdHJGb3JtYXQpIHN0ckZvcm1hdCA9ICd5eXl5LU1NLWRkJztcbiAgICBzd2l0Y2ggKHR5cGVvZiBzdHIpIHtcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgIHN0ciA9IG5ldyBEYXRlKHN0ci5yZXBsYWNlKC8tL2csICcvJykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICBzdHIgPSBuZXcgRGF0ZShzdHIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChzdHIgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIGNvbnN0IGRpY3Q6IGFueSA9IHtcbiAgICAgICAgICAgIHl5eXk6IHN0ci5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgICAgTTogc3RyLmdldE1vbnRoKCkgKyAxLFxuICAgICAgICAgICAgZDogc3RyLmdldERhdGUoKSxcbiAgICAgICAgICAgIEg6IHN0ci5nZXRIb3VycyxcbiAgICAgICAgICAgIG06IHN0ci5nZXRNaW51dGVzKCksXG4gICAgICAgICAgICBzOiBzdHIuZ2V0U2Vjb25kcygpLFxuICAgICAgICAgICAgTU06ICgnJyArIChzdHIuZ2V0TW9udGgoKSArIDEwMSkpLnN1YnN0cigxKSxcbiAgICAgICAgICAgIGRkOiAoJycgKyAoc3RyLmdldERhdGUoKSArIDEwMCkpLnN1YnN0cigxKSxcbiAgICAgICAgICAgIEhIOiAoJycgKyAoc3RyLmdldEhvdXJzKCkgKyAxMDApKS5zdWJzdHIoMSksXG4gICAgICAgICAgICBtbTogKCcnICsgKHN0ci5nZXRNaW51dGVzKCkgKyAxMDApKS5zdWJzdHIoMSksXG4gICAgICAgICAgICBzczogKCcnICsgKHN0ci5nZXRTZWNvbmRzKCkgKyAxMDApKS5zdWJzdHIoMSksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzdHJGb3JtYXQucmVwbGFjZSgvKHl5eXl8TU0/fGRkP3xISD98c3M/fG1tPykvZywgZnVuY3Rpb24oLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgICAgIHJldHVybiBkaWN0W2FyZ3NbMF1dO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICog6IqC5rWBXG4gKiBAcGFyYW0gZnVuYyDopoHmiafooYznmoTlh73mlbBcbiAqIEBwYXJhbSB0aW1lIOmXtOmalOaXtumXtCDmr6vnp5JcbiAqIEBwYXJhbSBpbW1lZGlhdGUg5piv5ZCm6KaB56uL5Y2z5omn6KGMXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGNvbnN0IHRocm90dGxlID0gKGZ1bmM6ICguLi5hcmdzOiBhbnkpID0+IGFueSwgdGltZTogbnVtYmVyLCBpbW1lZGlhdGUgPSBmYWxzZSkgPT4ge1xuICAgIGlmIChpbW1lZGlhdGUpIHtcbiAgICAgICAgbGV0IHByZXZUaW1lID0gMDtcbiAgICAgICAgcmV0dXJuICguLi5hcmdzOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vd1RpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgaWYgKG5vd1RpbWUgLSBwcmV2VGltZSA+PSB0aW1lKSB7XG4gICAgICAgICAgICAgICAgZnVuYy5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgICAgICBwcmV2VGltZSA9IG5vd1RpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHRpbWVyOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgICAgICAgcmV0dXJuICguLi5hcmdzOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGlmICghdGltZXIpIHtcbiAgICAgICAgICAgICAgICBmdW5jLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIHRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGltZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGVja1BhY2thZ2VQYXRoVHlwZShwYXRoOiBzdHJpbmcpOiBQYWNrYWdlUGF0aFR5cGUge1xuICAgIC8vQHRzLWlnbm9yZVxuICAgIHJldHVybiBFZGl0b3IuUGFja2FnZS5fX3Byb3RlY3RlZF9fLmNoZWNrVHlwZShwYXRoKTtcbn1cblxuZXhwb3J0IGNvbnN0IHNsZWVwID0gKG1zID0gMTAwKSA9PiB7XG4gICAgbGV0IGFib3J0ID0gKCkgPT4ge307XG5cbiAgICBjb25zdCBwID0gbmV3IFByb21pc2U8dm9pZD4oKHJlc292bGUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGUgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICByZXNvdmxlKCk7XG4gICAgICAgIH0sIG1zKTtcbiAgICAgICAgYWJvcnQgPSAoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGhhbmRsZSk7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdjYW5jZWwnKSk7XG4gICAgICAgIH07XG4gICAgfSkgYXMgUHJvbWlzZTx2b2lkPiAmIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNhbmNlbCBzbGVlcCBhbmQgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBhYm9ydCgpOiB2b2lkO1xuICAgIH07XG5cbiAgICBwLmFib3J0ID0gYWJvcnQ7XG5cbiAgICByZXR1cm4gcDtcbn07XG5cbi8qKlxuICog5Yik5pat5LiA5Liq5o+S5Lu25piv5LiN5piv5pyN5Yqh56uv5o+S5Lu277yI5Zyo5pyN5Yqh56uv5a2Y5Zyo5pWw5o2u77yJXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc09ubGluZUV4dGVuc2lvbihpdGVtOiBFeHRlbnNpb25JdGVtKTogaXRlbSBpcyBFeHRlbnNpb25JdGVtT25saW5lIHtcbiAgICAvLyDlrZjlnKggbGF0ZXN0X3ZlcnNpb24g5pWw5o2u77yM5Yik5pat5piv5pyN5Yqh56uv5a2Y5Zyo55qE5o+S5Lu2XG4gICAgY29uc3Qga2V5TGF0ZXN0VmVyc2lvbjoga2V5b2YgRXh0ZW5zaW9uSXRlbU9ubGluZSA9ICdsYXRlc3RfdmVyc2lvbic7XG5cbiAgICByZXR1cm4ga2V5TGF0ZXN0VmVyc2lvbiBpbiBpdGVtO1xufVxuIl19