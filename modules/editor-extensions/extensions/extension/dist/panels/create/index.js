"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const path_1 = require("path");
const Vue = require('vue/dist/vue.js');
Vue.config.productionTip = false;
Vue.config.devtools = false;
const panelDataMap = new WeakMap();
const app_1 = require("./app");
const utils_build_1 = require("../../public/utils-build");
module.exports = Editor.Panel.define({
    template: '<div id="app"></div>',
    style: (0, fs_1.readFileSync)((0, path_1.join)(__dirname, '../../create.css'), 'utf8'),
    $: {
        app: '#app',
    },
    async ready(startupArgs) {
        const extensionInfoMap = (await Editor.Message.request('extension', 'get-extension-info-map'));
        const author = (await Editor.Profile.getTemp('extension', utils_build_1.TempProfileKeys.author)) || 'Cocos Creator';
        const tempShowInManager = await Editor.Profile.getTemp('extension', utils_build_1.TempProfileKeys.showInManager);
        const showInManager = tempShowInManager === null ? true : Boolean(tempShowInManager);
        const tempShowInFolder = await Editor.Profile.getTemp('extension', utils_build_1.TempProfileKeys.showInFolder);
        const showInFolder = tempShowInFolder === null ? true : Boolean(tempShowInFolder);
        const vm = new Vue({
            extends: app_1.ExtensionCreation,
            propsData: {
                showInFolder,
                showInManager,
                author,
                preloadExtensionInfo: extensionInfoMap,
            },
        });
        this.vm = vm;
        vm.$mount(this.$.app);
        if (startupArgs?.selectedTemplate) {
            const { packageName, templatePath } = startupArgs.selectedTemplate;
            const templateFound = vm.getAvailableTemplate(packageName, templatePath);
            if (templateFound) {
                vm.selectTemplate(packageName, templateFound);
            }
        }
        vm.loadAllCreatorModule({ force: true });
        function onExtensionEnable(info) {
            vm && vm.onPluginEnable(info);
        }
        function onExtensionDisable(info) {
            vm && vm.onPluginDisable(info);
        }
        Editor.Package.__protected__.on('enable', onExtensionEnable);
        Editor.Package.__protected__.on('disable', onExtensionDisable);
        panelDataMap.set(this, {
            onExtensionDisable,
            onExtensionEnable,
            async releaseAllCreatorModule() {
                return await vm.unloadAllCreatorModule();
            },
        });
    },
    async close() {
        const info = panelDataMap.get(this);
        if (info) {
            await info.releaseAllCreatorModule();
            Editor.Package.__protected__.removeListener('enable', info.onExtensionEnable);
            Editor.Package.__protected__.removeListener('disable', info.onExtensionDisable);
        }
        panelDataMap.delete(this);
        this.vm?.$destroy();
        delete this.vm;
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvcGFuZWxzL2NyZWF0ZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDJCQUE4QztBQUM5QywrQkFBNEI7QUFLNUIsTUFBTSxHQUFHLEdBQW1CLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQ3ZELEdBQUcsQ0FBQyxNQUFNLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztBQUNqQyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7QUFFNUIsTUFBTSxZQUFZLEdBQUcsSUFBSSxPQUFPLEVBTzdCLENBQUM7QUFFSiwrQkFBeUM7QUFDekMsMERBQTJEO0FBTTNELE1BQU0sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDakMsUUFBUSxFQUFFLHNCQUFzQjtJQUNoQyxLQUFLLEVBQUUsSUFBQSxpQkFBWSxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxrQkFBa0IsQ0FBQyxFQUFFLE1BQU0sQ0FBQztJQUNoRSxDQUFDLEVBQUU7UUFDQyxHQUFHLEVBQUUsTUFBTTtLQUNkO0lBRUQsS0FBSyxDQUFDLEtBQUssQ0FBa0IsV0FBaUM7UUFDMUQsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLHdCQUF3QixDQUFDLENBQWdCLENBQUM7UUFDOUcsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSw2QkFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksZUFBZSxDQUFDO1FBQ3RHLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsNkJBQWUsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNu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WyJpbXBvcnQgeyBzaGVsbCB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7IGV4aXN0c1N5bmMsIHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IGNvZXJjZSwgc2F0aXNmaWVzLCB2YWxpZCB9IGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgeyBFeHRlbnNpb25DcmVhdG9yLCBUZW1wbGF0ZU1hcCwgQ3JlYXRpb25TdGFydHVwQXJncyB9IGZyb20gJy4uLy4uL3B1YmxpYy9pbnRlcmZhY2UnO1xuXG5pbXBvcnQgdHlwZSB7IFZ1ZUNvbnN0cnVjdG9yIH0gZnJvbSAndnVlJztcbmNvbnN0IFZ1ZTogVnVlQ29uc3RydWN0b3IgPSByZXF1aXJlKCd2dWUvZGlzdC92dWUuanMnKTtcblZ1ZS5jb25maWcucHJvZHVjdGlvblRpcCA9IGZhbHNlO1xuVnVlLmNvbmZpZy5kZXZ0b29scyA9IGZhbHNlO1xuXG5jb25zdCBwYW5lbERhdGFNYXAgPSBuZXcgV2Vha01hcDxcbiAgICBhbnksXG4gICAge1xuICAgICAgICBvbkV4dGVuc2lvbkVuYWJsZTogKHBhY2thZ2VJbmZvOiBFZGl0b3IuSW50ZXJmYWNlLlBhY2thZ2VJbmZvKSA9PiB2b2lkO1xuICAgICAgICBvbkV4dGVuc2lvbkRpc2FibGU6IChwYWNrYWdlSW5mbzogRWRpdG9yLkludGVyZmFjZS5QYWNrYWdlSW5mbykgPT4gdm9pZDtcbiAgICAgICAgcmVsZWFzZUFsbENyZWF0b3JNb2R1bGU6ICgpID0+IFByb21pc2U8dm9pZD47XG4gICAgfVxuPigpO1xuXG5pbXBvcnQgeyBFeHRlbnNpb25DcmVhdGlvbn0gZnJvbSAnLi9hcHAnO1xuaW1wb3J0IHsgVGVtcFByb2ZpbGVLZXlzIH0gZnJvbSAnLi4vLi4vcHVibGljL3V0aWxzLWJ1aWxkJztcblxudHlwZSBQYW5lbFRoaXMgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+ICYge1xuICAgIHZtPzogSW5zdGFuY2VUeXBlPHR5cGVvZiBWdWU+O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3IuUGFuZWwuZGVmaW5lKHtcbiAgICB0ZW1wbGF0ZTogJzxkaXYgaWQ9XCJhcHBcIj48L2Rpdj4nLFxuICAgIHN0eWxlOiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICcuLi8uLi9jcmVhdGUuY3NzJyksICd1dGY4JyksXG4gICAgJDoge1xuICAgICAgICBhcHA6ICcjYXBwJyxcbiAgICB9LFxuXG4gICAgYXN5bmMgcmVhZHkodGhpczogUGFuZWxUaGlzLCBzdGFydHVwQXJncz86IENyZWF0aW9uU3RhcnR1cEFyZ3MpIHtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uSW5mb01hcCA9IChhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdleHRlbnNpb24nLCAnZ2V0LWV4dGVuc2lvbi1pbmZvLW1hcCcpKSBhcyBUZW1wbGF0ZU1hcDtcbiAgICAgICAgY29uc3QgYXV0aG9yID0gKGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldFRlbXAoJ2V4dGVuc2lvbicsIFRlbXBQcm9maWxlS2V5cy5hdXRob3IpKSB8fCAnQ29jb3MgQ3JlYXRvcic7XG4gICAgICAgIGNvbnN0IHRlbXBTaG93SW5NYW5hZ2VyID0gYXdhaXQgRWRpdG9yLlByb2ZpbGUuZ2V0VGVtcCgnZXh0ZW5zaW9uJywgVGVtcFByb2ZpbGVLZXlzLnNob3dJbk1hbmFnZXIpO1xuICAgICAgICBjb25zdCBzaG93SW5NYW5hZ2VyID0gdGVtcFNob3dJbk1hbmFnZXIgPT09IG51bGwgPyB0cnVlIDogQm9vbGVhbih0ZW1wU2hvd0luTWFuYWdlcik7XG4gICAgICAgIGNvbnN0IHRlbXBTaG93SW5Gb2xkZXIgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRUZW1wKCdleHRlbnNpb24nLCBUZW1wUHJvZmlsZUtleXMuc2hvd0luRm9sZGVyKTtcbiAgICAgICAgY29uc3Qgc2hvd0luRm9sZGVyID0gdGVtcFNob3dJbkZvbGRlciA9PT0gbnVsbCA/IHRydWUgOiBCb29sZWFuKHRlbXBTaG93SW5Gb2xkZXIpO1xuXG4gICAgICAgIGNvbnN0IHZtID0gbmV3IFZ1ZSh7XG4gICAgICAgICAgICBleHRlbmRzOiBFeHRlbnNpb25DcmVhdGlvbixcbiAgICAgICAgICAgIHByb3BzRGF0YToge1xuICAgICAgICAgICAgICAgIHNob3dJbkZvbGRlcixcbiAgICAgICAgICAgICAgICBzaG93SW5NYW5hZ2VyLFxuICAgICAgICAgICAgICAgIGF1dGhvcixcbiAgICAgICAgICAgICAgICBwcmVsb2FkRXh0ZW5zaW9uSW5mbzogZXh0ZW5zaW9uSW5mb01hcCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudm0gPSB2bTtcblxuICAgICAgICB2bS4kbW91bnQodGhpcy4kLmFwcCBhcyBIVE1MRWxlbWVudCk7XG5cbiAgICAgICAgaWYgKHN0YXJ0dXBBcmdzPy5zZWxlY3RlZFRlbXBsYXRlKSB7XG4gICAgICAgICAgICBjb25zdCB7IHBhY2thZ2VOYW1lLCB0ZW1wbGF0ZVBhdGggfSA9IHN0YXJ0dXBBcmdzLnNlbGVjdGVkVGVtcGxhdGU7XG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZUZvdW5kID0gdm0uZ2V0QXZhaWxhYmxlVGVtcGxhdGUocGFja2FnZU5hbWUsIHRlbXBsYXRlUGF0aCk7XG4gICAgICAgICAgICBpZiAodGVtcGxhdGVGb3VuZCkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdFRlbXBsYXRlKHBhY2thZ2VOYW1lLCB0ZW1wbGF0ZUZvdW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmxvYWRBbGxDcmVhdG9yTW9kdWxlKHsgZm9yY2U6IHRydWUgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gb25FeHRlbnNpb25FbmFibGUoaW5mbzogRWRpdG9yLkludGVyZmFjZS5QYWNrYWdlSW5mbykge1xuICAgICAgICAgICAgdm0gJiYgdm0ub25QbHVnaW5FbmFibGUoaW5mbyk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gb25FeHRlbnNpb25EaXNhYmxlKGluZm86IEVkaXRvci5JbnRlcmZhY2UuUGFja2FnZUluZm8pIHtcbiAgICAgICAgICAgIHZtICYmIHZtLm9uUGx1Z2luRGlzYWJsZShpbmZvKTtcbiAgICAgICAgfVxuICAgICAgICBFZGl0b3IuUGFja2FnZS5fX3Byb3RlY3RlZF9fLm9uKCdlbmFibGUnLCBvbkV4dGVuc2lvbkVuYWJsZSk7XG4gICAgICAgIEVkaXRvci5QYWNrYWdlLl9fcHJvdGVjdGVkX18ub24oJ2Rpc2FibGUnLCBvbkV4dGVuc2lvbkRpc2FibGUpO1xuICAgICAgICBwYW5lbERhdGFNYXAuc2V0KHRoaXMsIHtcbiAgICAgICAgICAgIG9uRXh0ZW5zaW9uRGlzYWJsZSxcbiAgICAgICAgICAgIG9uRXh0ZW5zaW9uRW5hYmxlLFxuICAgICAgICAgICAgYXN5bmMgcmVsZWFzZUFsbENyZWF0b3JNb2R1bGUoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHZtLnVubG9hZEFsbENyZWF0b3JNb2R1bGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgY2xvc2UodGhpczogUGFuZWxUaGlzKSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBwYW5lbERhdGFNYXAuZ2V0KHRoaXMpO1xuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgYXdhaXQgaW5mby5yZWxlYXNlQWxsQ3JlYXRvck1vZHVsZSgpO1xuICAgICAgICAgICAgRWRpdG9yLlBhY2thZ2UuX19wcm90ZWN0ZWRfXy5yZW1vdmVMaXN0ZW5lcignZW5hYmxlJywgaW5mby5vbkV4dGVuc2lvbkVuYWJsZSk7XG4gICAgICAgICAgICBFZGl0b3IuUGFja2FnZS5fX3Byb3RlY3RlZF9fLnJlbW92ZUxpc3RlbmVyKCdkaXNhYmxlJywgaW5mby5vbkV4dGVuc2lvbkRpc2FibGUpO1xuICAgICAgICB9XG4gICAgICAgIHBhbmVsRGF0YU1hcC5kZWxldGUodGhpcyk7XG5cbiAgICAgICAgdGhpcy52bT8uJGRlc3Ryb3koKTtcbiAgICAgICAgZGVsZXRlIHRoaXMudm07XG4gICAgfSxcbn0pO1xuIl19