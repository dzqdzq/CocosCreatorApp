"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PackageSearchList=exports.createDefaultGroup=void 0;const vue_js_1=__importDefault(require("vue/dist/vue.js")),interface_1=require("../../public/interface"),utils_1=require("../../public/utils"),pkg_node_1=__importDefault(require("./pkg-node")),template='\n    <div class="pkg-list">\n        <div ref="main" class="content">\n            <section v-for="(group) in groups" v-show="group.list.length > 0" :key="group.key" class="content-group">\n                <div class="pkg-list__subtitle">\n                    <ui-label>{{ "i18n:extension.manager." + group.key }}</ui-label>\n                </div>\n                <pkg-node\n                    class="pkg-list-item"\n                    v-for="(pkg, index) in group.list"\n                    :key="`${index}__${pkg.name}`"\n                    :choosed="choosed === pkg.name"\n                    :pkg="pkg"\n                    :label="label"\n                    @choose="choose"\n                    @toggle-enable="toggleEnable"\n                    @update-package="updatePackage"\n                    @remove-package="removePackage"\n                    @uninstall-package="uninstallPackage"\n                ></pkg-node>\n            </section>\n        </div>\n\n        <div class="extenstions-empty" v-show="loading && isGroupEmpty">\n            <ui-loading></ui-loading>\n        </div>\n\n        <div class="extenstions-empty" v-show="isNoData && !errorMessage">\n            <ui-label value="i18n:extension.manager.not_data"></ui-label>\n        </div>\n\n        <div class="extenstions-empty error" v-show="errorMessage">\n            <ui-label :value="errorMessage"></ui-label>\n            <ui-button outline @click.stop="refresh">\n                <ui-label value="i18n:extension.manager.refresh"></ui-label>\n            </ui-button>\n        </div>\n    </div>\n';function createDefaultGroup(){return[{key:interface_1.ExtensionManagerTab.BuiltIn,label:interface_1.ExtensionManagerTab.BuiltIn,list:[],total:0},{key:interface_1.ExtensionManagerTab.Cocos,label:interface_1.ExtensionManagerTab.Cocos,list:[],total:0},{key:interface_1.ExtensionManagerTab.Installed,label:interface_1.ExtensionManagerTab.Installed,list:[],total:0}]}exports.createDefaultGroup=createDefaultGroup,exports.PackageSearchList=vue_js_1.default.extend({name:"PackageSearchList",components:{pkgNode:pkg_node_1.default},mixins:[],props:{label:{type:String,default:interface_1.ExtensionManagerTab.Search},active:{type:Boolean,default:!1},choosed:{type:String,default:""},pageSize:{type:Number,default:15},searchKey:{type:String,default:""}},data:()=>({groups:createDefaultGroup(),page:1,loading:!1,errorMessage:""}),computed:{isGroupEmpty(){return this.groups.every(e=>0===e.list.length)},isNoData(){return!this.loading&&this.isGroupEmpty&&""!==this.searchKey},isNoMore:()=>!0},watch:{},mounted(){},methods:{t:e=>Editor.I18n.t(`extension.manager.${e}`),scrollToBottom(e){if(this.loading||this.errorMessage||this.isNoMore)return;const t=e.path[0];t.scrollHeight-t.scrollTop-5<t.clientHeight&&(this.page+=1,this.$emit("update-list",this.label,this.page,this.pageSize))},updateList(e,t,s){const a=this.groups.find(t=>t.key===e);null!=a&&(a.list.push(...t),a.total=s,this.active&&1===this.page&&a.list.length>0&&this.choose(a.list[0]))},batchUpdateList(e){let t=void 0;for(const s of this.groups){if(!utils_1.hasOwn(e,s.key))continue;const a=e[s.key];s.list.push(...a.list),s.total=a.total,void 0===t&&s.list.length>0&&(t=s.list[0])}this.active&&1===this.page&&void 0!==t&&this.choose(t)},updateDownloadStatus(e,t,s,a){for(const n of this.groups)n.list.forEach(n=>{n.name===e&&(t?(n.state="none",n.progress=0):s?(n.state="none",n.isInstalled=!0,n.enable=!0,n.isBuiltIn&&!n.builtInVersion?(n.builtInPath=n.path,n.builtInVersion=n.version,n.version=s.version,n.path=s.path):(n.path=s.path,n.version=s.version),n.progress=0):("installing"!==n.state&&(n.state="installing"),n.progress=a))})},updateUninstallStatus(e,t,s,a){for(const n of this.groups)n.list.forEach(n=>{if(n.name===e)if(t)n.state="none",n.progress=0;else if(s){n.state="none",n.progress=0;const e="function"==typeof s?s(n):s;n.version=e.version,n.path=e.path,""===e.path&&(n.isInstalled=!1)}else"uninstalling"!==n.state&&(n.state="uninstalling"),n.progress=a})},refresh(){this.$emit("refresh")},reset(){this.groups=createDefaultGroup(),this.page=1,this.loading=!1,this.errorMessage=""},setError(e){this.groups=createDefaultGroup(),this.errorMessage=e},remove(e){for(const t of this.groups){const s=t.list.findIndex(t=>t.name===e);s>-1&&(t.list.splice(s,1),this.active&&(t.list.length>0?this.choose(t.list[0]):this.choose(void 0)))}},toggleEnableHandle(e){for(const t of this.groups)t.list.forEach(t=>{t.name===e.name&&t.path===e.path&&(t.enable=e.enable)})},handleListUpdate(e){if(!this.groups.every(e=>0===e.list.length))for(const t of this.groups)e.forEach(e=>{const s=t.list.findIndex(t=>t.name===e.name&&t.path===e.path);s>-1&&this.$set(t.list,s,{...t.list[s],enable:e.enable,isInstalled:e.isInstalled,progress:e.progress,state:e.state,version:e.version,path:e.path})})},updateUninstallLoading(e,t){for(const s of this.groups)s.list.forEach(s=>{s.name===e&&(s.state=t?"uninstalling":"none")})},toggleEnable(e,t,s){this.$emit("set-enable",e,!t,s)},removePackage(e){for(const t of this.groups)t.list.forEach(t=>{t.name===e&&(t.state="uninstalling")});this.$emit("remove-package",e)},uninstallPackage(e,t,s){this.$emit("uninstall-package",e,t,s)},updatePackage(e,t,s){for(const t of this.groups)t.list.forEach(t=>{t.name===e&&(t.state="installing")});this.$emit("update-package",e,t,s)},choose(e){this.$emit("choose",e)}},template:template});