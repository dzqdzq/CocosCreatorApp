"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=require("fs"),path_1=require("path"),vue_js_1=__importDefault(require("vue/dist/vue.js")),pkg_node_1=__importDefault(require("./pkg-node"));exports.default=vue_js_1.default.extend({name:"PkgList",components:{"pkg-node":pkg_node_1.default},props:{label:{type:String,default:""},active:{type:Boolean,default:!1},choosed:{type:String,default:""},pageSize:{type:Number,default:15},isSearch:{type:Boolean,default:!1},searchKey:{type:String,default:""}},data:()=>({list:[],page:1,loading:!1,total:0,errorMessage:""}),computed:{isNoData(){return!(this.loading||0!==this.list.length||this.isSearch&&""===this.searchKey)},isNoMore(){return this.list.length>0&&(this.list.length===this.total||this.list.length>this.total)}},watch:{active(t,e){this.isSearch||!t||0!==this.list.length||this.errorMessage||this.loading?t&&this.list.length>0&&this.choose(this.list[0]):(this.page=1,this.$emit("update-list",this.label,this.page,this.pageSize))},loading(t){t&&this.list.length>0&&this.$nextTick(()=>{this.$refs.main.scrollTop=this.$refs.main.scrollTop+this.$refs.loading.scrollHeight})}},created(){},mounted(){},methods:{t:t=>Editor.I18n.t(`extension.manager.${t}`),scrollToBottom(t){if(this.loading||this.errorMessage||this.isNoMore)return;const e=t.path[0];e.scrollHeight-e.scrollTop-5<e.clientHeight&&(this.page+=1,this.$emit("update-list",this.label,this.page,this.pageSize))},updateList(t,e){this.list.push(...t),this.total=e,this.active&&1===this.page&&this.list.length>0&&this.choose(this.list[0])},updateDownloadStatus(t,e,s,i){this.list.forEach(a=>{a.name===t&&(e?(a.state="none",a.progress=0):s?(a.state="none",a.isInstalled=!0,a.enable=!0,a.isBuiltIn&&!a.builtInVersion?(a.builtInPath=a.path,a.builtInVersion=a.version,a.version=s.version,a.path=s.path):(a.path=s.path,a.version=s.version),a.progress=0):("installing"!==a.state&&(a.state="installing"),a.progress=i))})},updateUninstallStatus(t,e,s,i){this.list.forEach(a=>{if(a.name===t)if(e)a.state="none",a.progress=0;else if(s){a.state="none",a.progress=0;const t="function"==typeof s?s(a):s;a.version=t.version,a.path=t.path,""===t.path&&(a.isInstalled=!1)}else"uninstalling"!==a.state&&(a.state="uninstalling"),a.progress=i})},addPackage(t){this.list.length>0&&this.list.unshift(t)},refresh(){this.$emit("refresh")},reset(){this.list=[],this.page=1,this.loading=!1,this.total=0,this.errorMessage=""},setError(t){this.list=[],this.errorMessage=t},remove(t){const e=this.list.findIndex(e=>e.name===t);e>-1&&(this.list.splice(e,1),this.active&&(this.list.length>0?this.choose(this.list[0]):this.choose(void 0)))},toggleEnableHandle(t){this.list.forEach(e=>{e.name===t.name&&e.path===t.path&&(e.enable=t.enable)})},handleListUpdate(t){0!==this.list.length&&t.forEach(t=>{const e=this.list.findIndex(e=>e.name===t.name&&e.path===t.path);e>-1&&(this.list[e].enable=t.enable,this.list[e].isInstalled=t.isInstalled,this.list[e].progress=t.progress,this.list[e].state=t.state,this.list[e].version=t.version,this.list[e].path=t.path)})},updateUninstallLoading(t,e){this.list.forEach(s=>{s.name===t&&(s.state=e?"uninstalling":"none")})},toggleEnable(t,e,s){this.$emit("set-enable",t,!e,s)},removePackage(t){this.list.forEach(e=>{e.name===t&&(e.state="uninstalling")}),this.$emit("remove-package",t)},uninstallPackage(t,e,s){this.$emit("uninstall-package",t,e,s)},updatePackage(t,e,s){this.list.forEach(e=>{e.name===t&&(e.state="installing")}),this.$emit("update-package",t,e,s)},choose(t){this.$emit("choose",t)}},template:fs_1.readFileSync(path_1.join(__dirname,"../../../static/template/manager/pkg-list.html"),"utf8")});