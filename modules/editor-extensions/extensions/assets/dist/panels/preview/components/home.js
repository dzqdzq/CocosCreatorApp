"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AssetsPreviewHomeVM=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const utils=__importStar(require("../../../components/utils")),panel_menu_1=require("../../../components/panel-menu"),tree_node_icon_1=require("../../../components/tree-node-icon"),template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static","/template/preview/index.html"),"utf8");exports.AssetsPreviewHomeVM=Vue.extend({components:{thumbnail:tree_node_icon_1.TreeNodeIcon},data:()=>({active:"",uuid:"",path:"",crumbs:[],list:[],prev:[],next:[],requestAnimationId:null}),methods:{async select(e){const t=this;t.crumbs=[],t.path="",t.uuid=e,t.list=[],window.cancelAnimationFrame(t.requestAnimationId);const i=await utils.getAssetForPreview(e);if(!i)return;t.next[t.next.length-1]!==e&&t.prev[t.prev.length-1]!==e&&(t.prev.length>100&&t.prev.shift(),t.prev.push(e),t.next=[]),t.path=i.path,t.crumbs=i.url.substr(5).split("/");const s=await utils.getChildrenForPreview(e);if(!s||!s.length)return;const n=s.length;if(n<200)return void(t.list=s);let r=0;t.requestAnimationId=window.requestAnimationFrame(function e(){if(r<n){for(let e=0;e<10;e++){if(!s[++r])return;t.list.push(s[r])}t.requestAnimationId=window.requestAnimationFrame(e)}})},async unselect(){this.path="",this.crumbs=[],this.list=[]},getAdditional(e){const t=[{type:e.type,value:e.uuid}];return e.redirect&&t.push({type:e.redirect.type,value:e.redirect.uuid}),e.extends&&e.extends.length>0&&e.extends.forEach(i=>{t.push({type:i,value:e.uuid})}),JSON.stringify(t)},dblClick(e){e.isDirectory?(Editor.Selection.clear("asset"),Editor.Selection.select("asset",e.uuid),Editor.Message.send("assets","twinkle",e.uuid,"light")):utils.openAsset(e)},async crumbsClick(e){const t=this.crumbs.slice(0,e+1),i=await Editor.Message.request("asset-db","query-uuid",`db://${t.join("/")}`);Editor.Selection.clear("asset"),i&&(Editor.Selection.select("asset",i),Editor.Message.send("assets","twinkle",i))},async prevClick(){const e=this,t=e.prev.pop();if(!t)return;if(e.next[e.next.length-1]!==t&&e.next.push(t),0===e.prev.length)return;const i=e.prev[e.prev.length-1];await Editor.Message.request("asset-db","query-asset-info",i)?(Editor.Selection.clear("asset"),Editor.Selection.select("asset",i)):e.prevClick()},async nextClick(){const e=this,t=e.next.pop();t&&(await Editor.Message.request("asset-db","query-asset-info",t)?(e.prev[e.prev.length-1]!==t&&e.prev.push(t),Editor.Selection.clear("asset"),Editor.Selection.select("asset",t)):e.nextClick())},popupMenu(e){(0,panel_menu_1.previewPopupContextMenu)(e)}},template:template});