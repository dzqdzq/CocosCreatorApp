"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.pushAdditional=exports.transI18nName=exports.stringToRegExp=exports.openAsset=exports.twinkle=exports.closestWhichCanCreate=exports.scrollIntoView=exports.isAIncludeB=exports.getChildrenUuid=exports.getDirectory=exports.getSibling=exports.getParent=exports.getChildrenForPreview=exports.getAssetForPreview=exports.getAsset=exports.isSearchingMode=exports.canNotReimport=exports.canNotRevealInLibrary=exports.canNotRevealInExplorer=exports.canNotDrop=exports.isEmptyToPaste=exports.canNotPaste=exports.canNotDrag=exports.canNotRename=exports.canNotCut=exports.canNotDuplicate=exports.canNotCopy=exports.canNotCreate=exports.canNotDelete=void 0;const panelData=__importStar(require("./panel-data")),treeData=__importStar(require("./tree-data"));function canNotDelete(e){return!e||e.isDB||e.readonly||e.isSubAsset}function canNotCreate(e){return!e||e.isSubAsset||e.readonly||!e.isDirectory}function canNotCopy(e){return!e||e.isDB||e.isSubAsset}function canNotDuplicate(e){return!e||!e.uuid||(e=treeData.uuidToParentUuid[e.uuid])&&canNotCreate(treeData.uuidToAsset[e])}function canNotCut(e){return canNotDelete(e)}function canNotRename(e){return canNotDelete(e)}function canNotDrag(e){return!e||e.isDB}function canNotPaste(e){return!e||e.isSubAsset||e.readonly||!e.isDirectory}function isEmptyToPaste(){var e=Editor.Clipboard.read("assets-copied-info"),e=!e||!e.assetInfo.length,t=Editor.Clipboard.read("assets-cut-info"),t=!t||!t.assetInfo.length||Editor.Project.path!==t.projectPath;return e&&t}function canNotDrop(e){return!e||e.readonly}function canNotRevealInExplorer(e){return!e||!e.file||e.isSubAsset}function canNotRevealInLibrary(e){return!e||0===Object.keys(e.library).length}function canNotReimport(e){return!e||e.isDB}function isSearchingMode(){var e,t,r,a,n=panelData.$.panel;return!!n&&({searchValue:n,searchType:e,extendSearchFunc:t,searchInFolder:r,searchAssetTypes:a}=n,""!==n||"fails"===e||t[e]||r||!!a.length)}function getAsset(e){return e?treeData.uuidToAsset[e]:null}async function getAssetForPreview(e,t){return!e||t?null:treeData.uuidToAsset[e]||Editor.Message.request("assets","query-asset",e,!!panelData.$.panel)}async function getChildrenForPreview(e,t){return!e||t?null:(t=treeData.uuidToChildren[e])&&t.length?t.map(e=>treeData.uuidToAsset[e]).filter(Boolean):Editor.Message.request("assets","query-children",e,!!panelData.$.panel)}function getParent(e){return e?getAsset(treeData.uuidToParentUuid[e]):null}function getSibling(e){var{displayArray:t,uuidToAsset:r}=treeData,a=t.indexOf(e),n=t.length-1;let o=a-1,s=a+1;return 0===a&&(o=n),a===t.length-1&&(s=0),[r[e],r[t[o]],r[t[s]]]}function getDirectory(e){var t=getAsset(e);return!!t&&(t.isDirectory?t:getDirectory(treeData.uuidToParentUuid[e]))}function getChildrenUuid(e,t,r=!1,a=!1){var n=treeData.uuidToChildren[e];if(n&&(!r||treeData.uuidToExpand[e])){var o=n.length;for(let e=0;e<o;e++){var s=n[e],i=getAsset(s);i&&i.visible&&(t.push(s),!i.isParent||a&&!i.isDirectory||getChildrenUuid(s,t,r,a))}}}function isAIncludeB(e,t){e=treeData.uuidToAsset[e],t=treeData.uuidToAsset[t];return!(!e||!t)&&t.url.startsWith(e.url+"/")}async function scrollIntoView(r,a=!1){var n=getAsset(r);if(n){await treeData.pointExpand(r);var o=panelData.$.viewBox.clientHeight,s=panelData.$.viewBox.offsetWidth,i=panelData.$.viewBox.scrollWidth;let e=panelData.$.viewBox.scrollLeft,t=panelData.$.viewBox.scrollTop;const d=panelData.config.assetHeight;var c=panelData.config.iconWidth,l=panelData.$.tree.scrollTop,u=l+o-d-4,p=e>n.left,i=s<i&&.3*s<n.left-e;(p||i)&&(e=n.left-2*c);const g=treeData.displayArray.indexOf(r)*d;a?t=g-o/2:g<=l?t=g:g>=u&&(t=g-o+d+4,setTimeout(()=>{t=g-panelData.$.viewBox.clientHeight+d+4,panelData.$.viewBox.scrollWidth!==panelData.$.viewBox.clientWidth&&(t+=10),panelData.$.viewBox.scrollTo(e,t)},100)),panelData.$.tree.$nextTick(()=>{panelData.$.viewBox.scrollTo(e,t)})}}function closestWhichCanCreate(e){var t=getAsset(e);return t?canNotCreate(t)?t.isDirectory?null:closestWhichCanCreate(treeData.uuidToParentUuid[e]):t:null}async function openAsset(e){if(!e.isSubAsset&&!e.isDirectory)try{await Editor.Message.request("asset-db","open-asset",e.url)}catch(e){console.error(e)}}function stringToRegExp(e){var t=e.replace(/^\/|\/[gimsuy]*$/g,""),e=e.replace(/.*\/([gimsuy]*)$/,"$1");return new RegExp(t,e)}function transI18nName(e){return"string"!=typeof e?"":e.startsWith("i18n:")&&(e=e.replace("i18n:",""),Editor.I18n.t(e)||console.debug(e+" is not defined in i18n"),Editor.I18n.t(e))||e}function pushAdditional(e,t){e.some(e=>e.type===t.type&&e.value===t.value)||e.push(t)}exports.canNotDelete=canNotDelete,exports.canNotCreate=canNotCreate,exports.canNotCopy=canNotCopy,exports.canNotDuplicate=canNotDuplicate,exports.canNotCut=canNotCut,exports.canNotRename=canNotRename,exports.canNotDrag=canNotDrag,exports.canNotPaste=canNotPaste,exports.isEmptyToPaste=isEmptyToPaste,exports.canNotDrop=canNotDrop,exports.canNotRevealInExplorer=canNotRevealInExplorer,exports.canNotRevealInLibrary=canNotRevealInLibrary,exports.canNotReimport=canNotReimport,exports.isSearchingMode=isSearchingMode,exports.getAsset=getAsset,exports.getAssetForPreview=getAssetForPreview,exports.getChildrenForPreview=getChildrenForPreview,exports.getParent=getParent,exports.getSibling=getSibling,exports.getDirectory=getDirectory,exports.getChildrenUuid=getChildrenUuid,exports.isAIncludeB=isAIncludeB,exports.scrollIntoView=scrollIntoView,exports.closestWhichCanCreate=closestWhichCanCreate,exports.twinkle={requestAnimationId:0,watch:!0,start(){this.watch=!0},stop(){this.watch=!1},add(e,t="hint"){this.watch&&(panelData.act.twinkles[e]=t,setTimeout(()=>{panelData.act.twinkles[e]=void 0,delete panelData.act.twinkles[e],window.cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=requestAnimationFrame(()=>{panelData.$.tree.render()})},1e3))}},exports.openAsset=openAsset,exports.stringToRegExp=stringToRegExp,exports.transI18nName=transI18nName,exports.pushAdditional=pushAdditional;