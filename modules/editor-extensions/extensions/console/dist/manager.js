"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const throttle_debounce_1=require("throttle-debounce"),list=exports.list=[],outputList=exports.outputList=[];let updateFn,lineHeight,animationId,collapse=!0,filterTypes=[],filterText="",filterRegex=!1,isShowDate=!1;const logCounter={log:0,warn:0,error:0,info:0};exports.setUpdateFn=(t=>{updateFn=t}),exports.setLineHeight=(t=>{lineHeight=exports.lineHeight=t,exports.update()}),exports.reset=(t=>{exports.clear();for(const e of t)exports.addItem(e);exports.update()}),exports.addItem=(t=>{t.dateTime=dateFormat(t.time);const e={type:"log"},o=t.message.toString().split("\n").filter(t=>""!==t.trim());e.type=t.type,t.stack&&"string"==typeof t.stack?e.stack=t.stack.split(/(\r\n|\r|\n)/).filter(t=>/^[^\n|\r]+$/.test(t)):e.stack=[],e.rows=o.length+e.stack.length,e.title=o[0]||"",e.content=o.splice(1),e.fold=!0,e.count=1,e.time=t.time,e.dateTime=t.dateTime,list.push(e),e.title&&(logCounter[e.type]+=1,updateFooterCounter())}),exports.setCollapse=(t=>{collapse=t,exports.update()}),exports.setFilterType=(t=>{filterTypes=t,exports.update()}),exports.setFilterText=(t=>{filterText=t,exports.update()}),exports.setFilterRegex=(t=>{filterRegex=t,filterText&&exports.update()}),exports.showDate=(t=>{isShowDate=t,exports.update()}),exports.clear=(()=>{list.length=0,logCounter.log=0,logCounter.warn=0,logCounter.error=0,logCounter.info=0,exports.update()});let updateLocker=!1;exports.update=((...t)=>{updateLocker||(updateLocker=!0,window.cancelAnimationFrame(animationId),animationId=requestAnimationFrame(()=>{let e=filterText,o=0;if(outputList.length=0,filterRegex)try{e=new RegExp(e)}catch(t){e=/.*/}list.filter(t=>{const o=!!t.title,r=filterTypes.some(e=>e===t.type),s=filterRegex?e.test(t.title):-1!==t.title.indexOf(e);return o&&r&&s}).forEach(t=>{const e=outputList[outputList.length-1],r=e&&e.title===t.title&&e.type===t.type&&e.content.join("\n")===t.content.join("\n")&&e.stack.join("\n")===t.stack.join("\n");collapse&&r?e.count+=1:(t.count=1,t.translateY=o,t.date=isShowDate?t.dateTime:null,outputList.push(t),o+=t.fold?lineHeight:t.rows*lineHeight)}),"function"==typeof updateFn&&updateFn(...t),updateLocker=!1}))});const updateFooterCounter=(0,throttle_debounce_1.debounce)(500,()=>{Editor.Message.broadcast("console:logsUpdate",logCounter)});function dateFormat(t){const e=new Date(t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}