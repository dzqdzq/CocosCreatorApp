"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const list=exports.list=[],outputList=exports.outputList=[];let updateFn,lineHeight,animationId,collapse=!0,filterType="",filterText="",filterRegex=!1,isShowDate=!1;const logCounter={log:0,warn:0,error:0};let updateFooterCounterTimer=null;exports.setUpdateFn=(t=>{updateFn=t}),exports.setLineHeight=(t=>{lineHeight=exports.lineHeight=t,exports.update()}),exports.reset=(t=>{exports.clear();for(const e of t)exports.addItem(e);exports.update()}),exports.addItem=(t=>{t.dateTime=dateFormat(t.time);const e={type:"log"},o=t.message.toString().split("\n").filter(t=>""!==t.trim());e.type=t.type,t.stack&&"string"==typeof t.stack?e.stack=t.stack.split(/(\r\n|\r|\n)/).filter(t=>/^[^\n|\r]+$/.test(t)):e.stack=[],e.rows=o.length+e.stack.length,e.title=o[0]||"",e.content=o.splice(1),e.fold=!0,e.count=1,e.time=t.time,e.dateTime=t.dateTime,list.push(e),logCounter[e.type]+=1,updateFooterCounterTimer||updateFooterCounter()}),exports.setCollapse=(t=>{collapse=t,exports.update()}),exports.setFilterType=(t=>{filterType="all"===t?"":t,Editor.Message.broadcast("console:update-log-level",t),exports.update()}),exports.setFilterText=(t=>{filterText=t,exports.update()}),exports.setFilterRegex=(t=>{filterRegex=t,exports.update()}),exports.showDate=(t=>{isShowDate=t,exports.update()}),exports.clear=(()=>{list.length=0,logCounter.log=0,logCounter.warn=0,logCounter.error=0,exports.update()});let updateLocker=!1;function updateFooterCounter(){updateFooterCounterTimer=window.setTimeout(()=>{Editor.Message.broadcast("console:logsUpdate",logCounter),updateFooterCounterTimer=null},500)}function dateFormat(t){const e=new Date(t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}exports.update=(()=>{updateLocker||(updateLocker=!0,window.cancelAnimationFrame(animationId),animationId=requestAnimationFrame(()=>{let t=filterText,e=0;if(outputList.length=0,filterRegex)try{t=new RegExp(t)}catch(e){t=/.*/}list.filter(e=>{const o=!!e.title,r=!filterType||e.type===filterType,s=filterRegex?t.test(e.title):-1!==e.title.indexOf(t);return o&&r&&s}).forEach(t=>{const o=outputList[outputList.length-1],r=o&&o.title===t.title&&o.type===t.type&&o.content.join("\n")===t.content.join("\n")&&o.stack.join("\n")===t.stack.join("\n");collapse&&r?o.count+=1:(t.count=1,t.translateY=e,t.date=isShowDate?t.dateTime:null,outputList.push(t),e+=t.fold?lineHeight:t.rows*lineHeight)}),"function"==typeof updateFn&&updateFn(),updateLocker=!1}))});