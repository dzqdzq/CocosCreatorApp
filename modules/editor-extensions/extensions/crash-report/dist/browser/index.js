"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.unload=exports.load=void 0;const data_1=require("../data"),esm_require=require("esm")(module),{uploadMgr:uploadMgr}=esm_require("../../dist/browser/upload"),crashReportArr=[];function load(){}function unload(){}exports.load=load,exports.unload=unload,exports.methods={async onCrashReport(r){const e=r&&r.details;if(!e||["crashed","oom"].includes(e.reason))if(await Editor.Network.testConnectServer())try{if(r.param=await Editor.Metrics._trackCrashEvent({category:"crash",value:r.value}),!await uploadMgr.check())return;const e=await data_1.createCrashReport(r);crashReportArr.find(r=>r.process===e.process)||crashReportArr.push(e),await Editor.Panel.has("crash-reporter")?Editor.Message.send("crash-reporter","refresh",e):Editor.Panel.open("crash-reporter",e)}catch(r){console.debug(r)}else console.debug("[crash-report] Offline status, no reporting.")},queryCrashReportInfos:()=>crashReportArr,async onUpload(r){0!==crashReportArr.length&&(await uploadMgr.packMultipleZipAndUpload(r,crashReportArr),crashReportArr.length=0)}};