'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createCrashReport = exports.validValue = void 0;
const os_1 = __importDefault(require("os"));
const utils_1 = require("../utils");
const path_1 = require("path");
function validValue(value) {
    return value === undefined ? 'unknow' : value;
}
exports.validValue = validValue;
/**
 * 创建崩溃数据
 * @param info
 */
async function createCrashReport(info) {
    const userInfo = await Editor.User.getData();
    const uid = validValue(userInfo?.cocos_uid);
    return {
        zipName: `${validValue(info?.param?.msgID)}-${uid}-${(validValue(info?.time?.getTime()))}.zip`,
        process: validValue(info?.process),
        details: validValue(info?.details),
        version: Editor.App.version,
        userAgent: Editor.App.userAgent,
        cid: await utils_1.getClientID(),
        uid: uid,
        time: validValue(info?.time?.toString()),
        editorLog: path_1.join(Editor.Project.path, './temp/logs/project.log'),
        buildLog: path_1.join(Editor.Project.path, 'temp', 'builder', 'log'),
        dbLog: path_1.join(Editor.Project.path, 'temp', 'asset-db', 'log'),
        crashLog: path_1.join(Editor.Project.path, 'temp', 'crash', process.platform === 'win32' ? 'reports' : 'pending'),
        projectJSON: path_1.join(Editor.Project.path, 'package.json'),
        arch: os_1.default.arch(),
        osVersion: os_1.default.version(),
        platform: os_1.default.platform(),
        totalmem: os_1.default.totalmem(),
        freemem: os_1.default.freemem(),
        uptime: os_1.default.uptime(),
        packages: utils_1.getPackages(),
        cpus: os_1.default.cpus(),
    };
}
exports.createCrashReport = createCrashReport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvZGF0YS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7OztBQUViLDRDQUFpQztBQUNqQyxvQ0FBb0Q7QUFDcEQsK0JBQTRCO0FBNkQ1QixTQUFnQixVQUFVLENBQUMsS0FBVTtJQUNqQyxPQUFPLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2xELENBQUM7QUFGRCxnQ0FFQztBQUVEOzs7R0FHRztBQUNJLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxJQUFrQjtJQUN0RCxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDN0MsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUM1QyxPQUFPO1FBQ0gsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxNQUFNO1FBQzlGLE9BQU8sRUFBRSxVQUFVLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQztRQUNsQyxPQUFPLEVBQUUsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUM7UUFDbEMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTztRQUMzQixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTO1FBQy9CLEdBQUcsRUFBRSxNQUFNLG1CQUFXLEVBQUU7UUFDeEIsR0FBRyxFQUFFLEdBQUc7UUFDUixJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7UUFDeEMsU0FBUyxFQUFFLFdBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSx5QkFBeUIsQ0FBQztRQUMvRCxRQUFRLEVBQUUsV0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDO1FBQzdELEtBQUssRUFBRSxXQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUM7UUFDM0QsUUFBUSxFQUFFLFdBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUMxRyxXQUFXLEVBQUUsV0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQztRQUN0RCxJQUFJLEVBQUUsWUFBRSxDQUFDLElBQUksRUFBRTtRQUNmLFNBQVMsRUFBRSxZQUFFLENBQUMsT0FBTyxFQUFFO1FBQ3ZCLFFBQVEsRUFBRSxZQUFFLENBQUMsUUFBUSxFQUFFO1FBQ3ZCLFFBQVEsRUFBRSxZQUFFLENBQUMsUUFBUSxFQUFFO1FBQ3ZCLE9BQU8sRUFBRSxZQUFFLENBQUMsT0FBTyxFQUFFO1FBRXJCLE1BQU0sRUFBRSxZQUFFLENBQUMsTUFBTSxFQUFFO1FBQ25CLFFBQVEsRUFBRSxtQkFBVyxFQUFFO1FBQ3ZCLElBQUksRUFBRSxZQUFFLENBQUMsSUFBSSxFQUFFO0tBQ2xCLENBQUM7QUFDTixDQUFDO0FBM0JELDhDQTJCQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFJlbmRlclByb2Nlc3NHb25lRGV0YWlscyB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCBvcywgeyBDcHVJbmZvIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgZ2V0Q2xpZW50SUQsIGdldFBhY2thZ2VzIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuXG4vKipcbiAqIOW0qea6g+i/m+eoi1xuICovXG5leHBvcnQgdHlwZSBJQ3Jhc2hXb3JrZXIgPSAnU2NlbmUgV2ViIFZpZXcnIHwgJ0Fzc2V0REImQnVpbGQnIHwgJ1Byb2dyYW1taW5nJztcblxuZXhwb3J0IGludGVyZmFjZSBJQ3Jhc2hSZXBvcnQge1xuICAgIHByb2Nlc3M6IElDcmFzaFdvcmtlcjsvLyDltKnmuoPov5vnqItcbiAgICB2YWx1ZTogYW55Oy8vIENyYXNoIOe7n+iuoeaJgOmcgOimgeaVsOaNrlxuICAgIGRldGFpbHM6IFJlbmRlclByb2Nlc3NHb25lRGV0YWlscyAvLyDltKnmuoPkv6Hmga9cbiAgICBwYXJhbT86IGFueTsgLy8g57uf6K6h55qE5Y+C5pWw77yM6YeM6Z2i5YyF5ZCr5LqGIG1zZyBpZFxuICAgIHRpbWU6IERhdGU7IC8vIOW0qea6g+eahOaXtumXtFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyYXNoUmVwb3J0IHtcbiAgICB6aXBOYW1lOiBzdHJpbmc7XG4gICAgLy8g5bSp5rqD55qE6L+b56iLXG4gICAgcHJvY2Vzczogc3RyaW5nO1xuICAgIC8vIOW0qea6g+WOn+WboFxuICAgIGRldGFpbHM6IFJlbmRlclByb2Nlc3NHb25lRGV0YWlscztcbiAgICAvLyA9PT09IOWfuuehgOS/oeaBryA9PT09XG4gICAgLy8g57yW6L6R5Zmo54mI5pys5L+h5oGvXG4gICAgdmVyc2lvbjogc3RyaW5nO1xuICAgIC8vXG4gICAgdXNlckFnZW50OiBzdHJpbmc7XG4gICAgLy8g55So5oi3IGlkXG4gICAgdWlkOiBzdHJpbmc7XG4gICAgLy8g5a6i5oi356uvIGlkXG4gICAgY2lkOiBzdHJpbmc7XG4gICAgLy8g5bSp5rqD5pe255qE5pe26Ze0XG4gICAgdGltZTogc3RyaW5nO1xuICAgIC8vIOe8lui+keWZqOaXpeW/l+i3r+W+hFxuICAgIGVkaXRvckxvZzogc3RyaW5nO1xuICAgIC8vIEFzc2V0REIg5pel5b+X6Lev57uPXG4gICAgZGJMb2c6IHN0cmluZztcbiAgICAvLyDmnoTlu7rml6Xlv5fot6/lvoRcbiAgICBidWlsZExvZzogc3RyaW5nO1xuICAgIC8vIGNyYXNoIGRtcCDmlofku7ZcbiAgICBjcmFzaExvZzogc3RyaW5nO1xuICAgIC8vIOmhueebruS/oeaBr1xuICAgIHByb2plY3RKU09OOiBzdHJpbmc7XG4gICAgLy8g5o+S5Lu25L+h5oGvXG4gICAgcGFja2FnZXM6IHN0cmluZ1tdO1xuICAgIC8vID09PT09IOiuvuWkh+S/oeaBryA9PT09XG4gICAgLy8gQ1BV5p625p6EXG4gICAgYXJjaDogc3RyaW5nO1xuICAgIC8vIOaTjeS9nOezu+e7n+WGheaguOS4jueJiOacrOS/oeaBryB0eXBlICsgdmVyc2lvblxuICAgIG9zVmVyc2lvbjogc3RyaW5nO1xuICAgIC8vIOaTjeS9nOezu+e7n+W5s+WPsFxuICAgIHBsYXRmb3JtOiBzdHJpbmc7XG4gICAgLy8g57O757uf5byA5py65pe26Ze0XG4gICAgdXB0aW1lOiBudW1iZXI7XG4gICAgLy8g5oC75YaF5a2YXG4gICAgdG90YWxtZW06IG51bWJlcjtcbiAgICAvLyDnqbrpl7LlhoXlrZhcbiAgICBmcmVlbWVtOiBudW1iZXI7XG4gICAgLy8gQ1BVIOS/oeaBr+WIl+ihqCBbbW9kZWwgKyBzcGVlZCArIHRpbWVzXVxuICAgIGNwdXM6IENwdUluZm9bXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gJ3Vua25vdycgOiB2YWx1ZTtcbn1cblxuLyoqXG4gKiDliJvlu7rltKnmuoPmlbDmja5cbiAqIEBwYXJhbSBpbmZvXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDcmFzaFJlcG9ydChpbmZvOiBJQ3Jhc2hSZXBvcnQpOiBQcm9taXNlPENyYXNoUmVwb3J0PiB7XG4gICAgY29uc3QgdXNlckluZm8gPSBhd2FpdCBFZGl0b3IuVXNlci5nZXREYXRhKCk7XG4gICAgY29uc3QgdWlkID0gdmFsaWRWYWx1ZSh1c2VySW5mbz8uY29jb3NfdWlkKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB6aXBOYW1lOiBgJHt2YWxpZFZhbHVlKGluZm8/LnBhcmFtPy5tc2dJRCl9LSR7dWlkfS0keyh2YWxpZFZhbHVlKGluZm8/LnRpbWU/LmdldFRpbWUoKSkpfS56aXBgLFxuICAgICAgICBwcm9jZXNzOiB2YWxpZFZhbHVlKGluZm8/LnByb2Nlc3MpLFxuICAgICAgICBkZXRhaWxzOiB2YWxpZFZhbHVlKGluZm8/LmRldGFpbHMpLFxuICAgICAgICB2ZXJzaW9uOiBFZGl0b3IuQXBwLnZlcnNpb24sXG4gICAgICAgIHVzZXJBZ2VudDogRWRpdG9yLkFwcC51c2VyQWdlbnQsXG4gICAgICAgIGNpZDogYXdhaXQgZ2V0Q2xpZW50SUQoKSxcbiAgICAgICAgdWlkOiB1aWQsXG4gICAgICAgIHRpbWU6IHZhbGlkVmFsdWUoaW5mbz8udGltZT8udG9TdHJpbmcoKSksXG4gICAgICAgIGVkaXRvckxvZzogam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCAnLi90ZW1wL2xvZ3MvcHJvamVjdC5sb2cnKSxcbiAgICAgICAgYnVpbGRMb2c6IGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3RlbXAnLCAnYnVpbGRlcicsICdsb2cnKSxcbiAgICAgICAgZGJMb2c6IGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3RlbXAnLCAnYXNzZXQtZGInLCAnbG9nJyksXG4gICAgICAgIGNyYXNoTG9nOiBqb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsICd0ZW1wJywgJ2NyYXNoJywgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJyA/ICdyZXBvcnRzJyA6ICdwZW5kaW5nJyksXG4gICAgICAgIHByb2plY3RKU09OOiBqb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsICdwYWNrYWdlLmpzb24nKSxcbiAgICAgICAgYXJjaDogb3MuYXJjaCgpLFxuICAgICAgICBvc1ZlcnNpb246IG9zLnZlcnNpb24oKSxcbiAgICAgICAgcGxhdGZvcm06IG9zLnBsYXRmb3JtKCksXG4gICAgICAgIHRvdGFsbWVtOiBvcy50b3RhbG1lbSgpLFxuICAgICAgICBmcmVlbWVtOiBvcy5mcmVlbWVtKCksXG5cbiAgICAgICAgdXB0aW1lOiBvcy51cHRpbWUoKSxcbiAgICAgICAgcGFja2FnZXM6IGdldFBhY2thZ2VzKCksXG4gICAgICAgIGNwdXM6IG9zLmNwdXMoKSxcbiAgICB9O1xufSJdfQ==