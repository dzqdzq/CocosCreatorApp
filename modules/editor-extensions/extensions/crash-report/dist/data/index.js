'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createCrashReport = exports.validValue = void 0;
const os_1 = __importDefault(require("os"));
const utils_1 = require("../utils");
const path_1 = require("path");
function validValue(value) {
    return value === undefined ? 'unknow' : value;
}
exports.validValue = validValue;
/**
 * 创建崩溃数据
 * @param info
 */
async function createCrashReport(info) {
    const userInfo = await Editor.User.getData();
    const uid = validValue(userInfo?.cocos_uid);
    return {
        zipName: `${validValue(info?.param?.msgID)}-${uid}-${(validValue(info?.time?.getTime()))}.zip`,
        process: validValue(info?.process),
        details: validValue(info?.details),
        version: Editor.App.version,
        userAgent: Editor.App.userAgent,
        cid: await (0, utils_1.getClientID)(),
        uid: uid,
        time: validValue(info?.time?.toString()),
        editorLog: (0, path_1.join)(Editor.Project.path, './temp/logs/project.log'),
        buildLog: (0, path_1.join)(Editor.Project.path, 'temp', 'builder', 'log'),
        dbLog: (0, path_1.join)(Editor.Project.path, 'temp', 'asset-db', 'log'),
        crashLog: (0, path_1.join)(Editor.Project.path, 'temp', 'crash', process.platform === 'win32' ? 'reports' : 'pending'),
        projectJSON: (0, path_1.join)(Editor.Project.path, 'package.json'),
        arch: os_1.default.arch(),
        osVersion: os_1.default.version(),
        platform: os_1.default.platform(),
        totalmem: os_1.default.totalmem(),
        freemem: os_1.default.freemem(),
        uptime: os_1.default.uptime(),
        packages: (0, utils_1.getPackages)(),
        cpus: os_1.default.cpus(),
    };
}
exports.createCrashReport = createCrashReport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvZGF0YS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7OztBQUViLDRDQUFpQztBQUNqQyxvQ0FBb0Q7QUFDcEQsK0JBQTRCO0FBNkQ1QixTQUFnQixVQUFVLENBQUMsS0FBVTtJQUNqQyxPQUFPLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2xELENBQUM7QUFGRCxnQ0FFQztBQUVEOzs7R0FHRztBQUNJLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxJQUFrQjtJQUN0RCxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDN0MsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUM1QyxPQUFPO1FBQ0gsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxNQUFNO1FBQzlGLE9BQU8sRUFBRSxVQUFVLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQztRQUNsQyxPQUFPLEVBQUUsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUM7UUFDbEMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTztRQUMzQixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTO1FBQy9CLEdBQUcsRUFBRSxNQUFNLElBQUEsbUJBQVcsR0FBRTtRQUN4QixHQUFHLEVBQUUsR0FBRztRQUNSLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztRQUN4QyxTQUFTLEVBQUUsSUFBQSxXQUFJLEVBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUseUJBQXlCLENBQUM7UUFDL0QsUUFBUSxFQUFFLElBQUEsV0FBSSxFQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDO1FBQzdELEtBQUssRUFBRSxJQUFBLFdBQUksRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQztRQUMzRCxRQUFRLEVBQUUsSUFBQSxXQUFJLEVBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDMUcsV0FBVyxFQUFFLElBQUEsV0FBSSxFQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQztRQUN0RCxJQUFJLEVBQUUsWUFBRSxDQUFDLElBQUksRUFBRTtRQUNmLFNBQVMsRUFBRSxZQUFFLENBQUMsT0FBTyxFQUFFO1FBQ3ZCLFFBQVEsRUFBRSxZQUFFLENBQUMsUUFBUSxFQUFFO1FBQ3ZCLFFBQVEsRUFBRSxZQUFFLENBQUMsUUFBUSxFQUFFO1FBQ3ZCLE9BQU8sRUFBRSxZQUFFLENBQUMsT0FBTyxFQUFFO1FBRXJCLE1BQU0sRUFBRSxZQUFFLENBQUMsTUFBTSxFQUFFO1FBQ25CLFFBQVEsRUFBRSxJQUFBLG1CQUFXLEdBQUU7UUFDdkIsSUFBSSxFQUFFLFlBQUUsQ0FBQyxJQUFJLEVBQUU7S0FDbEIsQ0FBQztBQUNOLENBQUM7QUEzQkQsOENBMkJDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgUmVuZGVyUHJvY2Vzc0dvbmVEZXRhaWxzIH0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IG9zLCB7IENwdUluZm8gfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBnZXRDbGllbnRJRCwgZ2V0UGFja2FnZXMgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5cbi8qKlxuICog5bSp5rqD6L+b56iLXG4gKi9cbmV4cG9ydCB0eXBlIElDcmFzaFdvcmtlciA9ICdTY2VuZSBXZWIgVmlldycgfCAnQXNzZXREQiZCdWlsZCcgfCAnUHJvZ3JhbW1pbmcnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElDcmFzaFJlcG9ydCB7XG4gICAgcHJvY2VzczogSUNyYXNoV29ya2VyOy8vIOW0qea6g+i/m+eoi1xuICAgIHZhbHVlOiBhbnk7Ly8gQ3Jhc2gg57uf6K6h5omA6ZyA6KaB5pWw5o2uXG4gICAgZGV0YWlsczogUmVuZGVyUHJvY2Vzc0dvbmVEZXRhaWxzIC8vIOW0qea6g+S/oeaBr1xuICAgIHBhcmFtPzogYW55OyAvLyDnu5/orqHnmoTlj4LmlbDvvIzph4zpnaLljIXlkKvkuoYgbXNnIGlkXG4gICAgdGltZTogRGF0ZTsgLy8g5bSp5rqD55qE5pe26Ze0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3Jhc2hSZXBvcnQge1xuICAgIHppcE5hbWU6IHN0cmluZztcbiAgICAvLyDltKnmuoPnmoTov5vnqItcbiAgICBwcm9jZXNzOiBzdHJpbmc7XG4gICAgLy8g5bSp5rqD5Y6f5ZugXG4gICAgZGV0YWlsczogUmVuZGVyUHJvY2Vzc0dvbmVEZXRhaWxzO1xuICAgIC8vID09PT0g5Z+656GA5L+h5oGvID09PT1cbiAgICAvLyDnvJbovpHlmajniYjmnKzkv6Hmga9cbiAgICB2ZXJzaW9uOiBzdHJpbmc7XG4gICAgLy9cbiAgICB1c2VyQWdlbnQ6IHN0cmluZztcbiAgICAvLyDnlKjmiLcgaWRcbiAgICB1aWQ6IHN0cmluZztcbiAgICAvLyDlrqLmiLfnq68gaWRcbiAgICBjaWQ6IHN0cmluZztcbiAgICAvLyDltKnmuoPml7bnmoTml7bpl7RcbiAgICB0aW1lOiBzdHJpbmc7XG4gICAgLy8g57yW6L6R5Zmo5pel5b+X6Lev5b6EXG4gICAgZWRpdG9yTG9nOiBzdHJpbmc7XG4gICAgLy8gQXNzZXREQiDml6Xlv5fot6/nu49cbiAgICBkYkxvZzogc3RyaW5nO1xuICAgIC8vIOaehOW7uuaXpeW/l+i3r+W+hFxuICAgIGJ1aWxkTG9nOiBzdHJpbmc7XG4gICAgLy8gY3Jhc2ggZG1wIOaWh+S7tlxuICAgIGNyYXNoTG9nOiBzdHJpbmc7XG4gICAgLy8g6aG555uu5L+h5oGvXG4gICAgcHJvamVjdEpTT046IHN0cmluZztcbiAgICAvLyDmj5Lku7bkv6Hmga9cbiAgICBwYWNrYWdlczogc3RyaW5nW107XG4gICAgLy8gPT09PT0g6K6+5aSH5L+h5oGvID09PT1cbiAgICAvLyBDUFXmnrbmnoRcbiAgICBhcmNoOiBzdHJpbmc7XG4gICAgLy8g5pON5L2c57O757uf5YaF5qC45LiO54mI5pys5L+h5oGvIHR5cGUgKyB2ZXJzaW9uXG4gICAgb3NWZXJzaW9uOiBzdHJpbmc7XG4gICAgLy8g5pON5L2c57O757uf5bmz5Y+wXG4gICAgcGxhdGZvcm06IHN0cmluZztcbiAgICAvLyDns7vnu5/lvIDmnLrml7bpl7RcbiAgICB1cHRpbWU6IG51bWJlcjtcbiAgICAvLyDmgLvlhoXlrZhcbiAgICB0b3RhbG1lbTogbnVtYmVyO1xuICAgIC8vIOepuumXsuWGheWtmFxuICAgIGZyZWVtZW06IG51bWJlcjtcbiAgICAvLyBDUFUg5L+h5oGv5YiX6KGoIFttb2RlbCArIHNwZWVkICsgdGltZXNdXG4gICAgY3B1czogQ3B1SW5mb1tdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyAndW5rbm93JyA6IHZhbHVlO1xufVxuXG4vKipcbiAqIOWIm+W7uuW0qea6g+aVsOaNrlxuICogQHBhcmFtIGluZm9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNyYXNoUmVwb3J0KGluZm86IElDcmFzaFJlcG9ydCk6IFByb21pc2U8Q3Jhc2hSZXBvcnQ+IHtcbiAgICBjb25zdCB1c2VySW5mbyA9IGF3YWl0IEVkaXRvci5Vc2VyLmdldERhdGEoKTtcbiAgICBjb25zdCB1aWQgPSB2YWxpZFZhbHVlKHVzZXJJbmZvPy5jb2Nvc191aWQpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHppcE5hbWU6IGAke3ZhbGlkVmFsdWUoaW5mbz8ucGFyYW0/Lm1zZ0lEKX0tJHt1aWR9LSR7KHZhbGlkVmFsdWUoaW5mbz8udGltZT8uZ2V0VGltZSgpKSl9LnppcGAsXG4gICAgICAgIHByb2Nlc3M6IHZhbGlkVmFsdWUoaW5mbz8ucHJvY2VzcyksXG4gICAgICAgIGRldGFpbHM6IHZhbGlkVmFsdWUoaW5mbz8uZGV0YWlscyksXG4gICAgICAgIHZlcnNpb246IEVkaXRvci5BcHAudmVyc2lvbixcbiAgICAgICAgdXNlckFnZW50OiBFZGl0b3IuQXBwLnVzZXJBZ2VudCxcbiAgICAgICAgY2lkOiBhd2FpdCBnZXRDbGllbnRJRCgpLFxuICAgICAgICB1aWQ6IHVpZCxcbiAgICAgICAgdGltZTogdmFsaWRWYWx1ZShpbmZvPy50aW1lPy50b1N0cmluZygpKSxcbiAgICAgICAgZWRpdG9yTG9nOiBqb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsICcuL3RlbXAvbG9ncy9wcm9qZWN0LmxvZycpLFxuICAgICAgICBidWlsZExvZzogam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCAndGVtcCcsICdidWlsZGVyJywgJ2xvZycpLFxuICAgICAgICBkYkxvZzogam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCAndGVtcCcsICdhc3NldC1kYicsICdsb2cnKSxcbiAgICAgICAgY3Jhc2hMb2c6IGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3RlbXAnLCAnY3Jhc2gnLCBwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInID8gJ3JlcG9ydHMnIDogJ3BlbmRpbmcnKSxcbiAgICAgICAgcHJvamVjdEpTT046IGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3BhY2thZ2UuanNvbicpLFxuICAgICAgICBhcmNoOiBvcy5hcmNoKCksXG4gICAgICAgIG9zVmVyc2lvbjogb3MudmVyc2lvbigpLFxuICAgICAgICBwbGF0Zm9ybTogb3MucGxhdGZvcm0oKSxcbiAgICAgICAgdG90YWxtZW06IG9zLnRvdGFsbWVtKCksXG4gICAgICAgIGZyZWVtZW06IG9zLmZyZWVtZW0oKSxcblxuICAgICAgICB1cHRpbWU6IG9zLnVwdGltZSgpLFxuICAgICAgICBwYWNrYWdlczogZ2V0UGFja2FnZXMoKSxcbiAgICAgICAgY3B1czogb3MuY3B1cygpLFxuICAgIH07XG59Il19