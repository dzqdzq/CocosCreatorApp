"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function register(e){const t=e.contributions.profile.editor,i=await getDefaultDevice(),o=[];i.forEach(e=>{e.name&&"number"==typeof e.width&&"number"==typeof e.height&&"number"==typeof e.ratio?e.enable&&o.push(e.name):console.warn(`Invalid device data ${JSON.stringify(e)}`)}),t.devices.default=i,t.enable.default=o,await Editor.Profile.setConfig("device","enable",o,"default")}async function getDefaultDevice(){let e=[];console.log("Request namespace: device-list");try{const t=await Editor.Profile.getConfig("device","releaseKey")||"",i=await Editor.Network.get(`https://config.cocos.com/configs/creator-settings/default/device-list?releaseKey=${t}`),o=JSON.parse(i.toString());e=JSON.parse(o.configurations.list),Editor.Profile.setConfig("device","releaseKey",o.releaseKey,"global"),Editor.Profile.setConfig("device","devices",e,"global")}catch(t){console.warn(`update profile: ${t}`),e=await Editor.Profile.getConfig("device","devices")}return e&&0!==e.length||(e=(0,fs_extra_1.readJSONSync)((0,path_1.join)(__dirname,"../static/devices.json"))),await Editor.Profile.setConfig("device","devices",e,"global"),e}exports.register=register;