"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue");let vm=null;exports.style=fs_1.readFileSync(path_1.join(__dirname,"./preferences.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/contributions/preferences.html"),"utf8"),exports.$={device:".device"};const component={data:{config:{builtin:[],custom:[],enable:[]},deviceType:"",num:-1,device:{name:"",width:0,height:0,ratio:0},editType:""},computed:{confirmButtonDisabled(){return!this.device.name||0===this.device.height||0===this.device.width||0===this.device.ratio},deviceFormDisabled(){return"builtin"===this.deviceType&&"add"!==this.editType}},methods:{async refresh(){const e=this,i=await Editor.Profile.getConfig("device","devices","default");i&&(e.config.builtin=i);const t=await Editor.Profile.getConfig("device","custom","global");t&&(e.config.custom=t);const c=await Editor.Profile.getConfig("device","enable");c&&(e.config.enable=c),e.chooseDevice("builtin",0)},chooseDevice(e,i){const t=this;"add"!==t.editType&&(t.editType="",t.deviceType=e,t.num=i,t.updateDevice())},updateDevice(){const e=this;void 0===e.timer&&(e.timer=requestAnimationFrame(()=>{if(e.timer=void 0,!e.config[e.deviceType]||!e.config[e.deviceType][e.num])return;const i=e.config[e.deviceType][e.num];e.device.name=i.name,e.device.width=i.width,e.device.height=i.height,e.device.ratio=i.ratio}))},async onDeviceChange(e){const i=this,t=e.target.getAttribute("path"),c=e.target.value;t&&void 0!==i.device[t]&&(i.device[t]=c,"add"!==i.editType&&(i.isDeviceChanged()?i.editType="update":i.editType=""))},createDevice(){const e=this;e.device.name=Editor.I18n.t("device.markname"),e.device.width=0,e.device.height=0,e.device.ratio=1,e.editType="add"},confirmDevice(){const e=this;if("add"===e.editType){if(e.isDeviceNameExist(e.device.name))return void Editor.Dialog.warn(Editor.I18n.t("device.invalid.exists"));e.config.custom.push(JSON.parse(JSON.stringify(e.device))),e.editType="",e.chooseDevice("custom",e.config.custom.length-1)}else{const i=e.config.custom[e.num];if(!i)return;if(i.name!==e.device.name&&e.isDeviceNameExist(e.device.name))return void Editor.Dialog.warn(Editor.I18n.t("device.invalid.exists"));i.name=e.device.name,i.width=e.device.width,i.height=e.device.height,i.ratio=e.device.ratio,e.editType=""}Editor.Profile.setConfig("device","custom",e.config.custom,"global")},cancelCreate(){const e=this;e.editType="";const i=e.config[e.deviceType][e.num];e.device.name=i.name,e.device.width=i.width,e.device.height=i.height,e.device.ratio=i.ratio},deleteDevice(e){const i=this;if(!i.config.custom[e])return;const t=i.config.custom[e].name;i.config.custom.splice(e,1),"custom"===i.deviceType&&e<=i.num&&(0===i.config.custom.length?i.chooseDevice("builtin",0):i.chooseDevice("custom",i.num-1)),Editor.Profile.setConfig("device","custom",i.config.custom,"global");const c=i.config.enable.indexOf(t);-1!==c&&(i.config.enable.splice(c,1),Editor.Profile.setConfig("device","enable",i.config.enable,"global"))},switchEnable(e,i){const t=this,c=t.config.enable.indexOf(i);e?-1===c&&(t.config.enable.push(i),Editor.Profile.setConfig("device","enable",t.config.enable,"global")):-1!==c&&(t.config.enable.splice(c,1),Editor.Profile.setConfig("device","enable",t.config.enable,"global")),Editor.Message.broadcast("device:devices-changed")},isDeviceNameExist:e=>vm.config.builtin.some(i=>e===i.name)||vm.config.custom.some(i=>e===i.name),isDeviceChanged(){const e=vm.config.custom[vm.num];let i=!1;for(const t in e)e[t]!==vm.device[t]&&(i=!0);return i}}};function ready(){component.el=this.$.device,(vm=new Vue(component)).refresh()}exports.ready=ready;