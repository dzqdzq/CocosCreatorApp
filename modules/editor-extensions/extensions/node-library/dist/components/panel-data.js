"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extension=exports.config=void 0;const path_1=require("path");exports.config={vm:null,panel:null,extend:{async attach(e){const a=exports.config.vm,t=e.info.contributions["node-library"];try{for(const o of t){const t={name:o.name,data:o.data,refresh:o.refresh,packageName:e.name,packageBroadcast:{}};if("string"==typeof o.module){const a=(0,path_1.join)(e.path,o.module);delete require.cache[a],t.packageModule=require(a),t.packageModule.load&&await t.packageModule.load(),"string"==typeof o.data&&(t.data=t.packageModule.methods[o.data]())}t.data.forEach(e=>{this.legalItems(e.items)}),t.refresh&&(t.packageBroadcast[t.refresh]=(()=>{"string"==typeof o.data&&(t.data=t.packageModule.methods[o.data](),t.data.forEach(e=>{this.legalItems(e.items)}))}),Editor.Message.__protected__.addBroadcastListener(t.refresh,t.packageBroadcast[t.refresh])),a.extensions.push(t)}}catch(e){console.error(e)}},async detach(e){const a=exports.config.vm;for(let t=0;t<a.extensions.length;t++){const o=a.extensions[t];o.packageName===e.name&&(o.packageModule.unload&&await o.packageModule.unload(),a.extensions.splice(t,1),Editor.Message.__protected__.removeBroadcastListener(o.update,o.packageBroadcast[o.update]),t--)}},legalItems(e){e.forEach(e=>{e.icon||(e.icon="ui-kit://icon/images/ui-prefab/default.png"),void 0===e.unlinkPrefab&&(e.unlinkPrefab=!0)})}}},exports.extension={attach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions["node-library"])try{exports.config.extend.attach(e)}catch(e){console.error(e)}},detach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions["node-library"])try{exports.config.extend.detach(e)}catch(e){console.error(e)}}};