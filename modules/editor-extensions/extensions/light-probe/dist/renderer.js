"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;function ready(){vm=new Vue({el:(panel=this).$.container,components:{},directives:{},data:{isInit:!1,isBaking:!1,rate:0,logs:[],isStart:!1,isFinish:!1,isEnd:!1},watch:{},async mounted(){this.sceneReady=await Editor.Message.request("scene","query-is-ready"),this.sceneReady&&await this.refresh()},updated(){vm.scrollToBottom()},methods:{async refresh(){const e=await Editor.Message.request("scene","execute-scene-script",{name:"light-probe",method:"query",args:[]});e&&(vm.isInit=!0,vm.$refs.props.render(e),vm.$refs.props.querySelector("ui-section").setAttribute("whole",""))},confirm(e){const t=e.target;if(!t)return;const s=t.dump;s&&Editor.Message.send("scene","execute-scene-script",{name:"light-probe",method:"update",args:[s]})},async baking(){if(!vm.clickedBake){vm.clickedBake=!0,setTimeout(()=>{vm.clickedBake=!1},1e3);try{if(vm.isBaking)Editor.Message.send("lightmap","cancelLightProbe");else{const e=path_1.join(Editor.Project.path,"temp/light-probe"),t=await Editor.Message.request("lightmap","getConfig");t.path=e,Editor.Message.send("lightmap","bakeLightProbe",t),Editor.Metrics._trackEventWithTimer({category:"bakingSystem",id:"A100009",value:1})}}catch(e){return void console.error(e)}}},clear(){Editor.Message.send("scene","execute-scene-script",{name:"light-probe",method:"clear",args:[]})},async updateLog(){const e=await Editor.Message.request("light-probe","unstaging");vm.rate=e.rate,vm.logs=e.logs,vm.isStart=e.isStart,vm.isFinish=e.isFinish,vm.isEnd=e.isEnd},scrollToBottom(){vm.$nextTick(()=>{const e=vm.$refs.logs;e&&e.scrollHeight-e.scrollTop!==e.clientHeight&&(e.scrollTop=e.scrollHeight)})}}})}async function beforeClose(){return await Editor.Message.request("scene","execute-scene-script",{name:"light-probe",method:"beforeClose",args:[]})}function close(){}function delDir(e,t=!1){let s=[];fs_1.existsSync(e)&&(s=fs_1.readdirSync(e)).forEach((t,s)=>{const r=e+"/"+t;t.endsWith(".meta")||(fs_1.statSync(r).isDirectory()?delDir(r,!0):fs_1.unlinkSync(r))})}exports.style=fs_1.readFileSync(path_1.join(__dirname,"../dist/index.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../static","/index.html"),"utf8"),exports.$={container:".container"},exports.methods={refresh(){vm&&vm.refresh()},start(){vm.isBaking=!0,vm.updateLog()},cancel(){vm.isBaking=!1,vm.updateLog()},log(){vm.updateLog()},progress(){vm.updateLog()},finished(){vm.updateLog()},end(){vm.isBaking=!1,vm.updateLog()},clear(){vm.updateLog()}},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;