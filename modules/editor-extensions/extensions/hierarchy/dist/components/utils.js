"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){e[a=void 0===a?n:a]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var r=function(e){return(r=Object.getOwnPropertyNames||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n})(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),a=0;a<n.length;a++)"default"!==n[a]&&__createBinding(t,e,n[a]);return __setModuleDefault(t,e),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.ccComponentsOrder=exports.twinkle=exports.ATTRIBUTE_TO_NODE=void 0,exports.forbidOperate=forbidOperate,exports.enableContextMenu=enableContextMenu,exports.canNotDeleteNode=canNotDeleteNode,exports.canNotCreateNode=canNotCreateNode,exports.canNotCopyNode=canNotCopyNode,exports.canNotCutNode=canNotCutNode,exports.canNotRename=canNotRename,exports.canNotDragNode=canNotDragNode,exports.canNotPasteNode=canNotPasteNode,exports.isNoneCopyOrCut=isNoneCopyOrCut,exports.isExistedAsset=isExistedAsset,exports.isSearching=isSearching,exports.isAllExpand=isAllExpand,exports.isActive=isActive,exports.getCanInsideDisplayNode=getCanInsideDisplayNode,exports.isExpand=isExpand,exports.isLastChild=isLastChild,exports.isParent=isParent,exports.isAnimating=isAnimating,exports.isSelected=isSelected,exports.isSelectedSingle=isSelectedSingle,exports.getNode=getNode,exports.getParent=getParent,exports.getSibling=getSibling,exports.getLastChildUuid=getLastChildUuid,exports.getLastExpandChildUuid=getLastExpandChildUuid,exports.getParentWhenAddNode=getParentWhenAddNode,exports.getNextDisplayNode=getNextDisplayNode,exports.getDisplayNodeLeft=getDisplayNodeLeft,exports.getDisplayNodeTopOfParent=getDisplayNodeTopOfParent,exports.getDisplayNodeBottomOfParent=getDisplayNodeBottomOfParent,exports.getDisplayParentNodeTop=getDisplayParentNodeTop,exports.getDisplayNodeTop=getDisplayNodeTop,exports.getDisplayNodeBottom=getDisplayNodeBottom,exports.inDisplayArray=inDisplayArray,exports.getDisplayNodeChildrenUuids=getDisplayNodeChildrenUuids,exports.filterChildren=filterChildren,exports.isAIncludeB=isAIncludeB,exports.getChildrenUuids=getChildrenUuids,exports.scrollIntoView=scrollIntoView,exports.calcScrollPosition=calcScrollPosition,exports.sortComponents=sortComponents;const panelData=__importStar(require("./panel-data")),treeData=__importStar(require("./tree-data"));function forbidOperate(){return panelData.act.animationUuid||panelData.$.panel.isOperating}function enableContextMenu(){return!forbidOperate()}function canNotDeleteNode(e){return!e||e.readonly||e.isScene||e.isPrefabRoot}function canNotCreateNode(e){return!e||e.readonly}function canNotCopyNode(e){return canNotDeleteNode(e)}function canNotCutNode(e){return canNotDeleteNode(e)}function canNotRename(e){return canNotDeleteNode(e)||forbidOperate()}function canNotDragNode(e){return canNotDeleteNode(e)}function canNotPasteNode(e){return!e||e.readonly||isNoneCopyOrCut()}function isNoneCopyOrCut(){var e=Editor.Clipboard.read("nodes-info");return!e||!e.uuids.length||e.projectPath!==Editor.Project.path}function isExistedAsset(){return!!panelData.act.assetUuid}function isSearching(){var e,t;return!!panelData.$.panel&&({searchValue:e,searchType:t}=panelData.$.panel,""!==e||"missAsset"===t||"hasCustomComponent"===t)}function isAllExpand(){let n=!0;if(!treeData.nodeTree)return n;let a=treeData.uuidToChildren[treeData.nodeTree.uuid];var e=panelData.act.selects.length;if(!(a=e?panelData.act.selects:a)||!a.length)return n;var r=a.length;for(let t=0;t<r;t++){let e=a[t];treeData.uuidToNode[e];if(isParent(e)||(e=treeData.uuidToParentUuid[e]),treeData.uuidToExpand[e]){n=!1;break}}return!n}function isActive(e){let t=!0;var n=treeData.uuidToNode[e];return t=n&&(t=!!n.active)&&(n=treeData.uuidToParentUuid[e])?isActive(n):t}function getCanInsideDisplayNode(n,e){var t=getNode(e);if(!t||!isLastChild(t))return null;var a=[e];let r=t;for(;r&&(!(r=getNode(r.parent))||(a.push(r.uuid),isLastChild(r))););if(0===a.length)return null;var i=[];for(const s of panelData.$.tree.$children){var o=s.$el.getBoundingClientRect(),d=s.$options.propsData.node;a.includes(d.uuid)&&i.push({node:d,rect:o,left:getDisplayNodeLeft(d,!0)})}return 0===i.length?null:(i.sort((e,t)=>e.left-t.left),i.reduce((e,t)=>Math.abs(t.left-n)<Math.abs(e.left-n)?t:e).node)}function isExpand(e){return!!treeData.uuidToExpand[e]}function isLastChild(e){return getLastChildUuid(e.parent)===e.uuid}function isParent(e){return treeData.uuidToChildren[e]&&0<treeData.uuidToChildren[e].length}function isAnimating(e){return!!treeData.uuidToAnimating[e]}function isSelected(e){return-1!==panelData.act.selects.indexOf(e)}function isSelectedSingle(e){return-1!==panelData.act.selects.indexOf(e)&&1===panelData.act.selects.length}function getNode(e=""){return e?treeData.uuidToNode[e]:null}function getParent(e){return e?getNode(treeData.uuidToParentUuid[e]):null}function getSibling(e){var{displayArray:t,uuidToNode:n}=treeData,a=t.indexOf(e),r=t.length-1;let i=a-1,o=a+1;return 0===a&&(i=r),a===t.length-1&&(o=0),[n[e],n[t[i]],n[t[o]]]}function getLastChildUuid(e){var t;return treeData.uuidToExpand[e]&&0!==treeData.uuidToChildren[e].length&&(t=treeData.uuidToChildren[e].length-1,e=treeData.uuidToChildren[e][t]),e}function getLastExpandChildUuid(e){var t=getLastChildUuid(e);return e=t!==e?getLastExpandChildUuid(t):e}function getParentWhenAddNode(e){if(!e.parent)return null;var t=getNode(e.parent);if(!t)return null;if(canNotCreateNode(t))return null;if(e.canvasRequired){if(hasCanvasComponent(t))return t;for(let e=treeData.uuidToChildren[t.uuid].length-1;0<=e;e--){var n=getNode(treeData.uuidToChildren[t.uuid][e]);if(n&&n.active&&hasCanvasComponent(n))return n}}return t}function getUuid(e){return"string"==typeof e?e:e.uuid}function getNextDisplayNode(e){e=treeData.displayArray.indexOf(e.uuid)-1;return getNode(treeData.displayArray[e])}function getDisplayNodeLeft(e,t=!1){let n=e.depth*panelData.config.iconWidth+panelData.config.padding;return t&&(n+=panelData.config.iconWidth),n}function getDisplayNodeTopOfParent(e){return e.parent?getDisplayNodeChildrenUuids(e.parent).indexOf(e.uuid)*panelData.config.nodeHeight:getDisplayNodeTop(e)}function getDisplayNodeBottomOfParent(e){return getDisplayNodeTopOfParent(e)+(getDisplayNodeChildrenUuids(e.uuid).length+1)*panelData.config.nodeHeight}function getDisplayParentNodeTop(e){return treeData.displayArray.indexOf(e.parent)*panelData.config.nodeHeight+panelData.config.padding}function getDisplayNodeTop(e){e=getUuid(e);return treeData.displayArray.indexOf(e)*panelData.config.nodeHeight+panelData.config.padding}function getDisplayNodeBottom(e){return getDisplayNodeTop(e)+panelData.config.nodeHeight}function inDisplayArray(e){return treeData.displayArray.includes(e)}function getDisplayNodeChildrenUuids(e,t=!1){if(!t&&!treeData.uuidToExpand[e])return[];var n=[];for(const a of treeData.uuidToChildren[e])n.push(a),(t||treeData.uuidToExpand[a])&&n.push(...getChildrenUuids(a,t));return n}function filterChildren(e){if(!e||!e.length)return[];let n=[];return e.forEach(t=>{(n=n.filter(e=>!isAIncludeB(t,e))).some(e=>isAIncludeB(e,t))||n.push(t)}),n}function isAIncludeB(e,t){if(e===t)return!0;e=treeData.uuidToChildren[e];if(Array.isArray(e))for(const n of e)if(isAIncludeB(n,t))return!0;return!1}function getChildrenUuids(e,t=!1){var n=[];for(const a of treeData.uuidToChildren[e])n.push(a),treeData.uuidToParentUuid[a]&&(t||treeData.uuidToExpand[a])&&n.push(...getChildrenUuids(a,t));return n}async function scrollIntoView(a){return new Promise(e=>{var t=getNode(a);if(t){inDisplayArray(a)||treeData.pointExpand(a);const n=calcScrollPosition(t);window.setTimeout(()=>{panelData.$.viewBox.scrollTo(n.left,n.top),e(!0)})}else e(!1)})}function calcScrollPosition(e){var t=panelData.$.viewBox.clientHeight,n=panelData.$.viewBox.offsetWidth,a=panelData.$.viewBox.scrollWidth;let r=panelData.$.viewBox.scrollLeft,i=panelData.$.viewBox.scrollTop;var o=panelData.config.nodeHeight,d=panelData.config.iconWidth,s=panelData.$.tree.scrollTop,c=s+t-o-4,l=getDisplayNodeLeft(e),e=getDisplayNodeTop(e);return(r>l||n<a&&.3*n<l)&&(r=l-2*d),e<=s?i=e:c<=e&&(i=e-t+2*o),{left:r,top:i}}function hasCanvasComponent(e){return e&&e.components.some(e=>"cc.Canvas"===e.type)}function sortComponents(e,t){let n=exports.ccComponentsOrder.indexOf(e.type),a=exports.ccComponentsOrder.indexOf(t.type);return-1===n&&(n=exports.ccComponentsOrder.length),-1===a&&(a=exports.ccComponentsOrder.length),n-a}exports.ATTRIBUTE_TO_NODE="to-node",exports.twinkle={watch:!0,start(){this.watch=!0},stop(){this.watch=!1},add(e,t="hint"){this.watch&&(panelData.$.tree.$set(panelData.$.tree.twinkles,e,t),setTimeout(()=>{panelData.$.tree.twinkles[e]=void 0,delete panelData.$.tree.twinkles[e]},1e3))},asset(e){e.isScene?Editor.Message.send("assets","twinkle",panelData.act.assetUuid):e.prefab&&e.prefab.state&&Editor.Message.send("assets","twinkle",e.prefab.assetUuid)}},exports.ccComponentsOrder=["cc.Camera","cc.Terrain","cc.DirectionalLight","cc.RangedDirectionalLight","cc.SphereLight","cc.SpotLight","cc.LightProbeGroup","cc.ReflectionProbe","cc.ParticleSystem","cc.MeshRenderer","cc.SkinnedMeshBatchRenderer","cc.SkinnedMeshRenderer","cc.RigidBody","cc.AudioSource","cc.VideoPlayer","sp.Skeleton","dragonBones.ArmatureDisplay","cc.ParticleSystem2D","cc.TiledMap","cc.TiledTile","cc.RigidBody2D","cc.Mask","cc.SpriteRenderer","cc.Sprite","cc.Graphics","cc.RichText","cc.Label","cc.RigidBody","cc.UIMeshRenderer","cc.Toggle","cc.ToggleContainer","cc.Button","cc.Slider","cc.EditBox","cc.ProgressBar","cc.LabelOutline","cc.LabelShadow","cc.ScrollView","cc.ScrollBar","cc.PageView","cc.PageViewIndicator","cc.SafeArea","cc.UIMeshRenderer","cc.Canvas","cc.UICoordinateTracker","cc.UIStaticBatch","cc.Layout","cc.UIOpacity","cc.Widget","cc.UITransform"];