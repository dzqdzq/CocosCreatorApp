"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extension=exports.config=exports.ready=exports.act=exports.$=void 0;const path_1=require("path");async function ready(e){if(await exports.config.update(),exports.act.assetUuid=e.assetUuid,exports.act.expandLevels=e.expandLevels,e.animationUuid){if("animation"===await Editor.Message.request("scene","query-scene-mode"))return void(exports.act.animationUuid=e.animationUuid);exports.act.animationUuid=""}exports.act.assetInfo=await Editor.Message.request("asset-db","query-asset-info",exports.act.assetUuid),exports.act.selects.length=0,exports.$.tree.clear()}exports.$={panel:null,searchInput:null,toggleExpandIcon:null,viewBox:null,tree:null},exports.act={assetUuid:"",assetInfo:{},animationUuid:"",expandLevels:[],selects:[],twinkleQueues:[]},exports.ready=ready,exports.config={nodeHeight:20,iconWidth:16,padding:4,creatableTypes:[],extendMenu:{packages:{},async show(e,t){const s=[],a=this.packages;let o=void 0;if(t){const{active:e,isScene:s,name:a,parent:n,type:i,uuid:r,components:c,isPrefabRoot:p,readonly:d,prefab:u}=t;o={active:e,isScene:s,name:a,parent:n,type:i,uuid:r,components:c,isPrefabRoot:p,readonly:d,prefab:u}}for(const t in a){const n=a[t];if(!n)continue;const i=n[e];if(!i||!n.methods[i])continue;const r=await n.methods[i](o);Array.isArray(r)&&r.length&&(s.push({type:"separator"}),s.push(...r))}return s},attach(e,t){exports.config.extendMenu.packages[e]=t},detach(e){delete exports.config.extendMenu.packages[e]}},extendDrop:{types:[],callbacks:{},attach(e,t){t.forEach(t=>{const s=t.type;s&&!this.types.includes(s)&&(this.types.push(s),this.callbacks[s]||(this.callbacks[s]={}),this.callbacks[s][e]=((s,a)=>{Editor.Message.send(e,t.message,s,a)}))})},detach(e,t){t.forEach(t=>{const s=t.type;s&&this.types.includes(s)&&(this.types=this.types.filter(e=>e!==s),this.callbacks[s]&&delete this.callbacks[s][e])})}},async update(){this.creatableTypes=await Editor.Message.request("scene","query-creatable-asset-types")}},exports.extension={attach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions.hierarchy)try{const t=e.info.contributions.hierarchy;if(Array.isArray(t.drop)&&exports.config.extendDrop.attach(e.name,t.drop),t.menu&&"string"==typeof t.menu.methods){const s=path_1.join(e.path,t.menu.methods);Editor.Module.removeCache(s);const a=s.replace(/^\w:/,e=>e.toLocaleUpperCase());Editor.Module.removeCache(a),t.menu.methods=Editor.Module.requireFile(s),exports.config.extendMenu.attach(e.name,t.menu)}exports.$.tree.update()}catch(e){console.error(e)}},detach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions.hierarchy)try{const t=e.info.contributions.hierarchy;Array.isArray(t.drop)&&exports.config.extendDrop.detach(e.name,t.drop),t.menu&&exports.config.extendMenu.detach(e.name),exports.$.tree.update()}catch(e){console.error(e)}}};