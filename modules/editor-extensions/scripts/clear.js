"use strict";const{join:join}=require("path"),{readdirSync:readdirSync,statSync:statSync,unlinkSync:unlinkSync,rmdirSync:rmdirSync,existsSync:existsSync}=require("fs"),builder=require("@editor/build");function removeSync(n){if(!existsSync(n))return;if(statSync(n).isDirectory()){readdirSync(n).forEach(e=>{removeSync(join(n,e))}),rmdirSync(n)}else unlinkSync(n)}function scan(n){readdirSync(n).forEach(e=>{const c=join(n,e);statSync(c).isDirectory()&&builder.addWorkspace(c)})}scan(join(__dirname,"../extensions"));const cacheFile=join(__dirname,".build-cache.json");builder.config({entry:".editor.js",config:cacheFile}),async function(){console.log(["================================================================================","删除 node_moduels 文件夹"].join("\n")),removeSync(join(__dirname,"../node_modules"));const n=await builder.executeTask(["clear"]);let e=[];for(let c in n){const i=n[c];for(let n of i)"error"===n.state&&e.push(n)}e.length&&(console.log(["================================================================================","没有正确完成构建任务，请查看日志，并根据建议尝试修复"].join("\n")),e.forEach(n=>{console.log(n)}),console.log(["================================================================================"].join("\n")),process.exit(-1)),removeSync(cacheFile)}();