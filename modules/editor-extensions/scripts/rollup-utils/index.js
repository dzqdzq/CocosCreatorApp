"use strict";const VuePlugin=require("rollup-plugin-vue"),commonjs=require("@rollup/plugin-commonjs"),postcss=require("rollup-plugin-postcss"),{babel:babel}=require("@rollup/plugin-babel"),typescript=require("rollup-plugin-typescript2"),{terser:terser}=require("rollup-plugin-terser"),json=require("@rollup/plugin-json"),url=require("@rollup/plugin-url"),del=require("rollup-plugin-delete"),{join:join,relative:relative,dirname:dirname}=require("path"),{writeFileSync:writeFileSync}=require("fs");exports.getTaskConfig=function(e,t){const o="production"!==process.env.NODE_ENV;let n=join(t,e.distDir),i=join(t,e.sourceDir);const l=join(__dirname,"./","normalize-component.js").replace(/\\/g,"/"),r=join(__dirname,"./","style-injector.js").replace(/\\/g,"/"),u=join(t,e.tsconfigPath);let s={};for(let t=0;t<e.sources.length;t++){const o=e.sources[t];s[o.replace(".ts","")]=join(i,o)}const p=new RegExp("\\.("+["png","jpe?g","gif","svg","ico","webp","avif","mp4","webm","ogg","mp3","wav","flac","aac","woff2?","eot","ttf","otf","wasm","webmanifest","pdf","txt"].join("|")+")(\\?.*)?$"),a={vue:{defaultOptions:{defaultLang:{script:"ts"},css:!0,isWebComponent:!0,normalizer:`~${l}`,styleInjectorShadow:`~${r}`},pluginModule:VuePlugin},commonjs:{defaultOptions:{},pluginModule:commonjs},postcss:{defaultOptions:{inject:!1,extract:!1},pluginModule:postcss},babel:{defaultOptions:{babelHelpers:"bundled"},pluginModule:babel},typescript:{defaultOptions:{tsconfig:u},pluginModule:typescript,enable:e.tsconfigPath},terser:{defaultOptions:{},pluginModule:terser,enable:!o},json:{defaultOptions:{},pluginModule:json},url:{defaultOptions:{limit:0,fileName:"[dirname][name][extname]",destDir:n,publicPath:n+"/",sourceDir:join(t,i),include:p},pluginModule:url},del:{defaultOptions:{targets:e.distDir+"/*",runOnce:!0,cwd:t},pluginModule:del,enable:!o},relativeRoot:{defaultOptions:{},pluginModule:function(){return{name:"relative-root",resolveImportMeta:(e,o)=>"relativePath"===e?`"${relative(dirname(join(n,o.chunkId)),t).replace(/\\/g,"/")}"`:null}}},importEditorCC:{defaultOptions:{},pluginModule:function(){return{name:"import-editor-cc",async writeBundle(e,t){for(const e in t){const o=t[e];o&&o.imports&&o.imports.includes("cc")&&writeFileSync(join(n,o.fileName),c+o.code,{encoding:"utf8"})}}}}}};const c="{const {join} = require('path');const __editorModulePath__ = join(Editor.App.path,'node_modules');module.paths.push(__editorModulePath__);}";let d=[];for(const t in a){const o=a[t],n=e.pluginSetting&&e.pluginSetting[t];if(!1!==o.enable&&!n||n&&!1!==n.enable){let e=o.defaultOptions;n&&(e="function"==typeof n.options?n.options(o.defaultOptions):o.defaultOptions),d.push(o.pluginModule(e))}}e.extraPlugin&&d.push(...e.extraPlugin);const g={input:s,plugins:d,external:["vue","fs","path","cc","child_process","events"]},f="function"==typeof e.inputOptions?Object.assign({},e.inputOptions(g),{plugins:d,input:s}):g;f.input||console.error("请配置 rollup 的入口！");const m={format:e.format||"cjs",dir:n};let j;return(j="function"==typeof e.outputOptions?Object.assign({},e.outputOptions(m),{format:e.format,dir:n}):m).dir||console.error("请配置 rollup 的输出目录！"),j.format||console.error("请配置 rollup 的输出格式！"),{inputOptions:f,outputOptions:j,sourceDir:i}};