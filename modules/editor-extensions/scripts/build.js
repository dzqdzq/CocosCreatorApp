"use strict";const{join:join}=require("path"),{readFileSync:readFileSync,existsSync:existsSync,writeFileSync:writeFileSync}=require("fs"),{execSync:execSync}=require("child_process"),configFile=join(__dirname,"../config.json");existsSync(configFile)||(console.error("没有找到 config.json，无法正常构建"),process.exit(-1));try{const e=readFileSync(configFile),c=JSON.parse(e);let s="";s+=`/// <reference path="${join(c.enginePath,"./bin/.declarations/cc.d.ts")}"/>\n`,s+=`/// <reference path="${join(c.enginePath,"/bin/.declarations/cc.editor.d.ts")}"/>\n`,writeFileSync(join(__dirname,"../@types/cc.d.ts"),s)}catch(e){console.error("config.json 格式错误"),console.error(e),process.exit(-1)}process.argv.some(e=>e.startsWith("--only-dts"))&&process.exit(0);const extensionArray=["lightmap"];extensionArray.forEach(e=>{const c=join(__dirname,"../extensions",e),s=require(join(c,".editor.js"));if(s.js){const e=s.js();console.time("tsc"+c),e.forEach(e=>{const s=join(c,e);try{execSync("tsc",{cwd:s,stdio:[0,1,2]})}catch(e){console.error(`tsc ${s} failed!`)}}),console.timeEnd("tsc"+c)}if(s.css){console.time("lessc"+c),s.css().forEach(e=>{execSync(`lessc ${e.source} ${e.dist}`,{cwd:c,stdio:[0,1,2]})}),console.timeEnd("lessc"+c)}});