"use strict";const chalk=require("chalk"),fse=require("fs-extra"),ps=require("path"),{spawn:spawn}=require("child_process");function bash(s,o){return new Promise((e,n)=>{const r=spawn(ps.join(__dirname,"../node_modules/.bin/mocha"+("win32"===process.platform?".cmd":"")),s,o);r.on("close",s=>{e(s)}),r.on("error",s=>{n(s)})})}async function check(s){const o=ps.join(s,"test.spec");if(fse.existsSync(o)&&(console.log(chalk.magenta(`==== ${s} ====`)),0!==await bash([o],{stdio:[0,1,2],cwd:ps.join(__dirname,"..")})))throw new Error(`测试失败 ${s}`)}const root=ps.join(__dirname,"../extensions"),list=fse.readdirSync(root);!async function(){for(let s of list)await check(ps.join(root,s))}();