"use strict";const t=require("fire-path"),i=require("fire-fs"),e=require("chalk"),r=require("util"),s=e.green,n=e.yellow,l=e.red,a=e.cyan;let o={};module.exports=o;let u,c,h,f,p,m,y=global.Editor;u=console.log,c=function(){let t=r.format.apply(r,arguments);console.log(s(t))},f=function(){let t=r.format.apply(r,arguments);console.info(a(t))},h=y&&y.failed?y.failed:function(){let t=r.format.apply(r,arguments);console.log(l(t))},p=y&&y.warn?y.warn:function(){let t=r.format.apply(r,arguments);t=t+"\n"+new Error("dummy").stack.split("\n").splice(2).join("\n"),console.warn(n(t))},m=y&&y.error?y.error:function(){let t=r.format.apply(r,arguments);t=t+"\n"+new Error("dummy").stack.split("\n").splice(2).join("\n"),console.error(l(t))},y&&y.throw?o.throw=y.throw:o.throw=function(t){let i=[].slice.call(arguments,1),e=r.format.apply(r,i);if("type"===t)throw new TypeError(e);throw new Error(e)},o.log=function(){if(this.dev&&!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),u.apply(this,t),void 0}u.apply(this,arguments)}},o.info=function(){if(this.dev&&!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),f.apply(this,t),void 0}f.apply(this,arguments)}},o.success=function(){if(this.dev&&!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),c.apply(this,t),void 0}c.apply(this,arguments)}},o.failed=function(){if(!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),h.apply(this,t),void 0}h.apply(this,arguments)}},o.warn=function(){if(!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),p.apply(this,t),void 0}p.apply(this,arguments)}},o.error=function(){if(!this.silent){if(this._curTask){let t=[].slice.call(arguments,1);return t.unshift("[db-task][%s] "+arguments[0],this._curTask.name),m.apply(this,t),void 0}m.apply(this,arguments)}},o.mkdirForAsset=function(e){e&&""!==e||this.throw("normal","Invalid uuid");let r=e.substring(0,2),s=t.join(this._importPath,r);return i.existsSync(s)||i.mkdirSync(s),s},o.copyAssetToLibrary=function(e,r){let s=this._uuidToImportPathNoExt(e)+t.extname(r);return this.mkdirForAsset(e),i.copySync(r,s),s},o.saveAssetToLibrary=function(e,r,s){let n;"string"==typeof r||r instanceof Buffer?n=r:(r.serialize&&(n=r.serialize()),n||(n=JSON.stringify(r,null,2))),s=s||".json";let l=this.mkdirForAsset(e);return l=t.join(l,e+s),i.writeFileSync(l,n),l};let d=null;o.updateMtime=function(t){if(!this.isSubAssetByUuid(t)){if(t){let e=this._uuid2path[t];if(e&&i.existsSync(e)){let r=i.statSync(e).mtime.getTime(),s=i.statSync(e+".meta").mtime.getTime(),n=this.getRelativePath(e);this._uuid2mtime[t]={asset:r,meta:s,relativePath:n}}else delete this._uuid2mtime[t];try{i.removeSync(this.getCachePath(t))}catch(t){}}d&&(clearTimeout(d),d=null),d=setTimeout(()=>{let t=JSON.stringify(this._uuid2mtime,null,2);i.existsSync(this.library)&&i.writeFileSync(this._uuid2mtimePath,t,"utf8")},50)}},o.arrayCmpFilter=function(t,i){let e=[];for(let r=0;r<t.length;++r){let s=t[r],n=!0;for(let t=0;t<e.length;++t){let r=e[t];if(s===r){n=!1;break}let l=i(r,s);if(l>0){n=!1;break}l<0&&(e.splice(t,1),--t)}n&&e.push(s)}return e},o.padLeft=function(t,i,e){return(i-=(t=t.toString()).length)>0?new Array(i+1).join(e)+t:t},o.replacePathForGlobAndDel=function(t){return"win32"===process.platform?Array.isArray(t)?t.map(t=>t.replace(/\\/g,"/")):t.replace(/\\/g,"/"):t},o.restorePathForGlob=function(t){return"win32"===process.platform?Array.isArray(t)?t.map(t=>t.replace(/\//g,"\\")):t.replace(/\//g,"\\"):t};