"use strict";const e=require("fast-glob"),t=require("fs"),s=(require("path"),require("path-plus")),{replacePathForGlobAndDel:l,restorePathForGlob:r}=require("../lib/utils");let o={create:function(s,o={}){let c=[];for(let t=0;t<s.length;t++){let o=e.sync("**/*",{onlyFiles:!1,absolute:!0,cwd:l(s[t])});c=c.concat(r(o))}let n=new Map;for(let e=0;e<c.length;e++){let s,l=c[e];try{s=t.statSync(l)}catch(e){return}n.set(l,s)}return n},diff:function(e,t){let s={deletes:[],creates:[],changes:[]},l=e.entries();for(const[e,r]of l){const l=t.get(e);void 0===l?s.deletes.push(e):r.isDirectory()!==l.isDirectory()?(s.deletes.push(e),s.creates.push(e)):r.isFile()&&r.mtime.getTime()!==l.mtime.getTime()&&s.changes.push(e)}l=t.entries();for(const[t,r]of l){void 0===e.get(t)&&s.creates.push(t)}return s},simplify:function(e){e.deletes.sort((e,t)=>e.localeCompare(t));for(let t=0;t<e.deletes.length-1;++t){let l=e.deletes[t];for(let r=t+1;r<e.deletes.length;++r){let t=e.deletes[r];s.contains(l,t)&&(e.deletes.splice(r,1),--r)}}e.changes.sort((e,t)=>e.localeCompare(t));for(let t=0;t<e.changes.length-1;++t){let l=e.changes[t];for(let r=t+1;r<e.changes.length;++r){let t=e.changes[r];s.contains(l,t)&&(e.changes.splice(r,1),--r)}}e.creates.sort((e,t)=>e.localeCompare(t));for(let t=0;t<e.creates.length-1;++t){let l=e.creates[t];for(let r=t+1;r<e.creates.length;++r){let t=e.creates[r];s.contains(l,t)&&(e.creates.splice(r,1),--r)}}return e}};module.exports=o;