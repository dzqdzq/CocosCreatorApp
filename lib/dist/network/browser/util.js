"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendPostRequest=exports.sendGetRequest=exports.portIsOccupied=exports.canConnectPassport=exports.queryIpList=void 0;const semver=require("semver"),os=require("os"),https=require("https"),net=require("net"),http=require("http"),{parse:parse}=require("url"),{stringify:stringify}=require("querystring");function queryIpList(){const e=os.networkInterfaces();let t=[];for(const r of Object.keys(e))e[r].forEach(e=>{"IPv4"===e.family&&!1===e.internal&&t.push(e.address)});return"win32"===process.platform&&(t=t.filter(e=>/^(?!169\.254)/.test(e))),t}function canConnectPassport(){return new Promise(e=>{const t=https.request({method:"GET",host:"passport.cocos.com",port:443,path:"/oauth/token?xxx",headers:{},timeout:3e3},t=>{if(200!==t.statusCode)return console.warn("failed to connect login server... skipping login"),t.resume(),e(!1);e(!0)}).on("error",t=>{console.warn("failed to connect login server... skipping login"),e(!1)}).on("timeout",()=>{console.warn("failed to connect login server due to request timeout"),e(!1)});t.write(""),t.end()})}async function portIsOccupied(e){return new Promise((t,r)=>{const o=net.createServer().listen(e);o.on("listening",function(){o.close(),t(!1)}),o.on("error",function(e){e.code,t(!0)})})}function sendGetRequest(e,t){return new Promise((r,o)=>{var s=parse(e);t=stringify(t||{});semver.valid(semver.coerce(Editor.App.version));var n={"User-Agent":Editor.App.userAgent},i={method:"GET",host:s.hostname,port:s.port||80,path:s.pathname+(t?"?"+t:""),headers:n,ciphers:"ALL",secureProtocol:"TLSv1_method"},p=[];http.request(i,e=>{if(200!==e.statusCode)return r(null),void e.resume();e.on("data",e=>{p.push(e)}).on("end",()=>{r(Buffer.concat(p))})}).on("error",e=>{o(e)}).setTimeout(8e3,()=>{o(new Error(`POST Timeout: ${e}`))}).end()})}function sendPostRequest(e,t){return new Promise((r,o)=>{let s=parse(e),n={"Content-Type":"application/x-www-form-urlencoded","Content-Length":(t=stringify(t||{})).length,"User-Agent":Editor.App.userAgent},i={method:"POST",host:s.hostname,port:s.port||443,path:s.pathname,headers:n,ciphers:"ALL",secureProtocol:"TLSv1_method"};var p=[];let u=(s.protocol.startsWith("https:")?https:http).request(i,e=>{if(200!==e.statusCode)return o(new Error("Connect Failed")),void e.resume();e.on("data",e=>{p.push(e)}).on("end",()=>{r(Buffer.concat(p))})}).on("error",e=>{o(e)}).setTimeout(8e3,()=>{o(new Error(`POST Timeout: ${e}`))});u.write(t),u.end()})}exports.queryIpList=queryIpList,exports.canConnectPassport=canConnectPassport,exports.portIsOccupied=portIsOccupied,exports.sendGetRequest=sendGetRequest,exports.sendPostRequest=sendPostRequest;