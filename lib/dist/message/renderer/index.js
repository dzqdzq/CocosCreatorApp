"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeBroadcastListener=exports.addBroadcastListener=exports.broadcast=exports.send=exports.request=void 0;const ipc=require("@base/electron-base-ipc"),broadcastListenerMap={};async function request(e,s,...r){return new Promise((t,a)=>{ipc.send("editor-lib-message:call","request",e,s,...r).callback((e,s)=>e?a(new Error(e.message)):t(s))})}function send(e,s,...r){ipc.send("editor-lib-message:call","send",e,s,...r)}function broadcast(e,...s){ipc.send("editor-lib-message:call","broadcast",e,...s)}function addBroadcastListener(e,s){var r;ipc.send("editor-lib-message:add-broadcast-listener",e),broadcastListenerMap[e]=null!==(r=broadcastListenerMap[e])&&void 0!==r?r:[],broadcastListenerMap[e].push(s)}function removeBroadcastListener(e,s){if(broadcastListenerMap[e]){const r=broadcastListenerMap[e].indexOf(s);-1!==r&&(broadcastListenerMap[e].splice(r,1),0===broadcastListenerMap[e].length&&ipc.send("editor-lib-message:remove-broadcast-listener",e))}}exports.request=request,exports.send=send,exports.broadcast=broadcast,exports.addBroadcastListener=addBroadcastListener,exports.removeBroadcastListener=removeBroadcastListener,ipc.on("editor-lib-message:emit-broadcast-listener",async(e,s,...r)=>{if(broadcastListenerMap[s]){const e=broadcastListenerMap[s];for(let s of e)try{s(...r)}catch(e){console.error(e)}}else ipc.send("editor-lib-message:remove-broadcast-listener",s)});