"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.copy=exports.unzip=exports.getName=void 0;const fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),{existsSync:existsSync}=require("fs"),{basename:basename,dirname:dirname,extname:extname,join:join}=require("path");function getName(e){if(!existsSync(e))return e;const t=dirname(e),n=extname(e);let r=basename(e,n);do{/(\d+)$/.test(r)?r=r.replace(/(\d+)$/,(e,t)=>{let n=parseInt(t,10);return n=(n+=1).toString().padStart(t.length,"0")}):r+="-001",e=join(t,r)}while(existsSync(e+n));return e+n}exports.getName=getName;const unzipOfDarwin=function(e,t,n){let r=dirname(t);fs_extra_1.ensureDirSync(r);let s=child_process_1.spawn("unzip",[e,"-d",t]),o="";s.stderr.on("data",e=>{o+=e});let i="";s.stdout.on("data",e=>{i+=e}),s.on("close",e=>{i&&console.log(i),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),n(t)})},unzipOfWin32=function(e,t,n){let r=dirname(t);fs_extra_1.ensureDirSync(r);let s=child_process_1.spawn(join(Editor.App.path,"../tools/unzip.exe"),[e,"-d",t]),o="";s.stderr.on("data",e=>{o+=e});let i="";s.stdout.on("data",e=>{i+=e}),s.on("close",e=>{i&&console.log(i),o&&console.warn(o);let t=null;0!==e&&(t=new Error("The decompression has failed")),n(t)})};async function unzip(e,t,n={}){let r;r="win32"===process.platform?unzipOfWin32:unzipOfDarwin;const s=join(Editor.Project.tmpDir,".utils_temp",basename(e,".zip"));if(await fs_extra_1.remove(s),await new Promise((t,n)=>{r(e,s,e=>{if(e)return n(e);t()})}),n.peel){const e=fs_extra_1.readdirSync(s);1===e.length?await fs_extra_1.copy(join(s,e[0]),t):await fs_extra_1.copy(s,t)}else await fs_extra_1.copy(s,t);await fs_extra_1.remove(s)}function copy(e,t){!function e(t,n){if(!existsSync(t))return;if(fs_extra_1.statSync(t).isDirectory()){fs_extra_1.ensureDirSync(n);const r=fs_extra_1.readdirSync(t);for(let s of r)e(join(t,s),join(n,s))}else fs_extra_1.copySync(t,n),fs_extra_1.chmodSync(n,511)}(e,t)}exports.unzip=unzip,exports.copy=copy;