"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Markdown=void 0;const fs_1=require("fs"),path_1=require("path"),I18n=require("@base/electron-i18n"),Hljs=require("highlight.js"),Remarkable=require("remarkable"),STYLE=`<style>${fs_1.readFileSync(path_1.join(__dirname,"./markdown.css"),"utf8")}</style>`,instanceArray=[];function translateAll(){instanceArray.forEach(e=>{e.innerHTML.startsWith("i18n:")&&e._refresh(),e._refresh()})}I18n.on("switch",translateAll);class Markdown extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}<slot></slot><div class="content"></div>`,this.$slot=this.shadowRoot.querySelector("slot"),this.$content=this.shadowRoot.querySelector(".content"),this._refresh(),this.$slot.addEventListener("slotchange",()=>{this._refresh()}))}static get observedAttributes(){return[]}attributeChangedCallback(e,t,r){}connectedCallback(){instanceArray.push(this)}disconnectedCallback(){const e=instanceArray.indexOf(this);instanceArray.splice(e,1)}_refresh(){let e=this.innerHTML;if(!e)return void(this.$content.innerHTML="");e.startsWith("i18n:")&&(e=I18n.translation(e.substr(5)));const t=e.match(/( +)[^ ]/);t&&t[1]&&(e=e.replace(new RegExp("^"+t[1],"gm"),""));const r=new Remarkable({html:!0,highlight(e,t){if(t&&Hljs.getLanguage(t))try{return Hljs.highlight(t,e).value}catch(e){console.error(`Syntax highlight failed: ${e.message}`)}try{return Hljs.highlightAuto(e).value}catch(e){console.error(`Syntax highlight failed: ${e.message}`)}return""}}).render(e);this.$content.innerHTML=r}}exports.Markdown=Markdown;