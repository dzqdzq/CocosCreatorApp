"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Code=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base");let customStyle="";const Hljs=require("highlight.js"),CUSTOM_STYLE='<style id="custom-style"></style>',STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./code.css"),"utf8")}</style>`,HTML=`${fs.readFileSync(path.join(__dirname,"./code.html"),"utf8")}`,instanceArray=[];class Code extends base_1.Base{constructor(){super(),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$slot=this.shadowRoot.querySelector("slot"),this.$pre=this.shadowRoot.querySelector("pre"),this.$code=this.shadowRoot.querySelector("code"),this.$slot.$root=this,this.$slot.addEventListener("slotchange",this._slotTextChange),new MutationObserver(this.render.bind(this)).observe(this,{characterData:!0,subtree:!0}))}static importStyle(e){fs.existsSync(e)&&(customStyle=fs.readFileSync(e,"utf8"),instanceArray.map(e=>{e.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}get language(){return this.getAttribute("language")||"glsl"}set language(e){e?this.setAttribute("language",e):this.removeAttribute("language")}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.readonly=null!==this.getAttribute("readonly"),this.disabled=null!==this.getAttribute("disabled"),this.render(),!this.shadowRoot)return;const e=this.shadowRoot.querySelector("#custom-style");e&&(e.innerHTML=customStyle)}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this);instanceArray.splice(e,1)}static get observedAttributes(){return["language","disabled"]}attributeChangedCallback(e,t,s){switch(e){case"language":this.render()}}_slotTextChange(){this.$root.render()}render(){let e=this.innerHTML;/<[^>]+>/.test(e)&&(this.innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"));let t=this.textContent;const s=t.match(/( +)[^ ]/);s&&s[1]&&(t=t.replace(new RegExp("^"+s[1],"gm"),"")),t=t.trim();const r=Hljs.highlight(this.language,t);this.$code.innerHTML=r.value,this.scrollTop=0,this.scrollLeft=0}}exports.Code=Code;