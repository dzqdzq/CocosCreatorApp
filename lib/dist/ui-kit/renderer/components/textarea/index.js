"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextArea=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./textarea.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./textarea.html"),"utf8")}`,instanceArray=[];let customStyle="";class TextArea extends base_1.Base{constructor(){super(),this.compositionStart=!1,this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$textarea=this.shadowRoot.querySelector("textarea"),this.$child=this.$textarea,this.$textarea.$root=this)}static importStyle(t){fs.existsSync(t)&&(customStyle=fs.readFileSync(t,"utf8"),instanceArray.map(t=>{t.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}get pressed(){return null!==this.getAttribute("pressed")}set pressed(t){(t=!!t)?this.setAttribute("pressed",""):this.removeAttribute("pressed")}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.shadowRoot){const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle)}this.$textarea.addEventListener("focus",this._onTextareaFocus),this.$textarea.addEventListener("blur",this._onTextareaBlur),this.$textarea.addEventListener("input",this._onTextareaChange),this.$textarea.addEventListener("keydown",this._onTextareaKeyDown),this.$textarea.addEventListener("compositionstart",this._onTextareaCompositionStart),this.$textarea.addEventListener("compositionend",this._onTextareaCompositionEnd)}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1),this.$textarea.removeEventListener("focus",this._onTextareaFocus),this.$textarea.removeEventListener("blur",this._onTextareaBlur),this.$textarea.removeEventListener("input",this._onTextareaChange),this.$textarea.removeEventListener("keydown",this._onTextareaKeyDown),this.$textarea.removeEventListener("compositionstart",this._onTextareaCompositionStart),this.$textarea.removeEventListener("compositionend",this._onTextareaCompositionEnd)}static get observedAttributes(){return["disabled","value","invalid","placeholder","readonly","autoheight","password","path"]}attributeChangedCallback(t,e,a){switch(super.attributeChangedCallback(t,e,a),t){case"disabled":this.$textarea.disabled=null!==a;break;case"invalid":this.$textarea.value="-";break;case"value":this.invalid=!1,this.$textarea.value=a;break;case"placeholder":this.$textarea.placeholder=a;break;case"readonly":this.$textarea.readOnly=null!==a;break;case"autoheight":this.$textarea.autoHeight=null!==a}}get value(){return this.getAttribute("value")||""}set value(t){t+="",this.setAttribute("value",t)}get placeholder(){return this.$textarea.getAttribute("placeholder")}set placeholder(t){t+="",this.$textarea.setAttribute("placeholder",t)}get readOnly(){return!!this.getAttribute("readonly")}set readOnly(t){t?this.setAttribute("readonly",String(t)):this.removeAttribute("readonly")}get autoHeight(){return!!this.getAttribute("autoheight")}set autoHeight(t){t?this.setAttribute("autoheight",String(t)):this.removeAttribute("autoheight")}_onFocus(t){super._onFocus(t),this.$textarea.focus()}_onTextareaFocus(){this.$root.disabled||this.$root.readOnly||(this.$root._staging=this.$root.value,this._staging=this.$root.value)}_onTextareaBlur(){this.$root.disabled||this.$root.readOnly||this.$root._staging!==this.value&&(delete this.$root._staging,this.$root.dispatch("confirm"))}_onTextareaCompositionStart(){this.$root.compositionStart=!0}_onTextareaCompositionEnd(t){this.$root.compositionStart=!1,this.$root._onTextareaChange.call(this,t)}_onTextareaChange(t){const e=this;if(!e.$root.compositionStart&&!e.$root.disabled&&!e.$root.readOnly&&e._staging!==e.value&&(e.$root.value=e.value,e._staging=e.value,e.$root.dispatch("change"),e.autoHeight)){const t=e.scrollHeight;e.style.height=t/2+"px"}}_onTextareaKeyDown(t){const e=this;if(t.stopPropagation(),!e.$root.disabled&&!e.$root.readOnly)switch(t.keyCode){case 13:if(e.$root._staging===e.value)break;e.$root.dispatch("confirm"),e.$root._staging=e.$root.value;break;case 27:if(e.$root._staging===e.value)break;e.$root.value=e.$root._staging,e._staging=e.$root.value,e.$root.dispatch("change"),e.$root.dispatch("cancel")}}}exports.TextArea=TextArea;