"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Color=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base");let customStyle="";const Chroma=require("chroma-js"),{domUtils:domUtils}=require("../../utils"),CUSTOM_STYLE='<style id="custom-style"></style>',STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./color.css"),"utf8")}</style>`,HTML=`${fs.readFileSync(path.join(__dirname,"./color.html"),"utf8")}`,instanceArray=[];class Color extends base_1.Base{constructor(){super(),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$colorWrap=this.shadowRoot.querySelector(".color-wrap"),this.$color=this.shadowRoot.querySelector(".color"),this.$alpha=this.shadowRoot.querySelector(".alpha-line"),this.$alpha.$root=this.$color.$root=this)}static importStyle(t){fs.existsSync(t)&&(customStyle=fs.readFileSync(t,"utf8"),instanceArray.map(t=>{t.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),!this.shadowRoot)return;const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle)}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1)}get value(){const t=this.getAttribute("value");return domUtils.getValidColor(t)}set value(t){t=domUtils.getValidColor(t),this.setAttribute("value",JSON.stringify(t))}static get observedAttributes(){return["focused","readonly","disabled","invalid","value","path"]}attributeChangedCallback(t,e,o){switch(super.attributeChangedCallback(t,e,o),t){case"invalid":this._updateColor([0,0,0,0]);break;case"value":this.invalid=!1,this._updateColor(this.value)}}_updateColor(t){let e;(t=domUtils.getValidColor(t)).length>3?(this.$alpha.style.width=100*t[3]/255+"%",e=Array.from(t).splice(0,3)):e=t,this.$color.style.backgroundColor=Chroma(e).css()}}exports.Color=Color;