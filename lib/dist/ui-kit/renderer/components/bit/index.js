"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bit=void 0;const fs=require("fs"),path=require("path"),menu=require("@base/electron-menu"),{nodeList:nodeList}=require("../../utils"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./bit.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./bit.html"),"utf8")}`,instanceArray=[];let customStyle="";class Bit extends base_1.Base{constructor(){super(),this.maskList=[],this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$slot=this.shadowRoot.querySelectorAll("slot")[0],this.$placeholder=this.shadowRoot.querySelector("#placeholder"),this.$child=this.$select=this.shadowRoot.querySelector("#content"),this.$slot.$root=this.$placeholder.$root=this.$select.$root=this,this.$select.addEventListener("click",this._selectClick),this.$slot.addEventListener("slotchange",this._slotChange),this.$slot.addEventListener("DOMSubtreeModified",this._slotTextChange))}static importStyle(e){fs.existsSync(e)&&(customStyle=fs.readFileSync(e,"utf8"),instanceArray.map(e=>{e.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}static get observedAttributes(){return["readonly","disabled","invalid","path","value","placeholder"]}attributeChangedCallback(e,t,s){switch(super.attributeChangedCallback(e,t,s),e){case"invalid":null!==s&&process.nextTick(()=>{this.$select.value=""});break;case"value":this.invalid&&(this.invalid=!1),this.value=s,this.value&&0!==this.value?this.$placeholder.style.display="none":this.$placeholder.style.display="block";break;case"placeholder":this.$placeholder.innerHTML=s}}get value(){const e=this.$select.getAttribute("value");return e?e-0:0}set value(e){this.$select.innerHTML=e,this.$select.setAttribute("value",e)}connectedCallback(){if(super.connectedCallback(),nodeList.push(this),instanceArray.push(this),!this.shadowRoot)return;const e=this.shadowRoot.querySelector("#custom-style");e&&(e.innerHTML=customStyle)}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this),t=nodeList.indexOf(this);instanceArray.splice(e,1),nodeList.splice(t,1)}_onFocus(e){super._onFocus(e),this.$select.focus()}_selectClick(e){const t=[],s=this;t.push({label:"Everything",checked:s.$root.value===4294967295..toString(),type:"checkbox",click(){s.$root._selectChange(4294967295)}}),t.push({label:"Nothing",checked:0===s.$root.value,type:"checkbox",click(){s.$root._selectChange(0)}}),t.push({type:"separator"});let l=0;s.$root.maskList.forEach(e=>{0!==e.value&&4294967295!==e.value&&(l^=e.value,t.push({label:e.name,checked:!!(s.$root.value&e.value),type:"checkbox",click(){let t=Number(s.$root.value);t^=e.value;let a=0;s.$root.maskList.forEach(e=>{0!==e.value&&4294967295!==e.value&&t&e.value&&(a^=e.value)}),a!==l?s.$root._selectChange(a):s.$root._selectChange(4294967295)}}))}),menu.popup({x:e.pageX,y:e.pageY,menu:t})}_selectChange(e){this.disabled||this.readonly||(this.value=e,this.dispatch("change"),this.dispatch("confirm"))}_slotChange(){const e=this;e.$root.maskList=[];const t=e.assignedNodes();for(const s of t)"OPTION"!==s.tagName&&"OPTGROUP"!==s.tagName||e.$root.maskList.push({name:s.innerHTML,value:Number(s.value)})}_slotTextChange(){this.$root._slotChange.call(this)}}exports.Bit=Bit;