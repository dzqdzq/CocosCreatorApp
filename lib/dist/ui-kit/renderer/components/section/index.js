"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Section=void 0;const path=require("path"),fs=require("fs"),base_1=require("../base"),{domUtils:domUtils}=require("../../utils");let customStyle="";const CUSTOM_STYLE='<style id="custom-style"></style>',STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./section.css"),"utf8")}</style>`,HTML=`${fs.readFileSync(path.join(__dirname,"./section.html"),"utf8")}`,instanceArray=[],cacheExpand={};class Section extends base_1.Base{constructor(){super(),this._noFocusFlag=!1,this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$header=this.shadowRoot.querySelector("#header"),this.$headerSlot=this.shadowRoot.querySelector('slot[name="header"]'),this.$content=this.shadowRoot.querySelector(".content"),this.$contentSlot=this.shadowRoot.querySelector(".content > slot"),this.$header.$root=this.$content.$root=this.$contentSlot.$root=this,this._useCacheExpand(this,this.getAttribute("cache-expand")))}static importStyle(e){fs.existsSync(e)&&(customStyle=fs.readFileSync(e,"utf8"),instanceArray.map(e=>{e.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.$header.addEventListener("click",this._onHeaderClick),this.shadowRoot){const e=this.shadowRoot.querySelector("#custom-style");e&&(e.innerHTML=customStyle)}}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this);instanceArray.splice(e,1),this.$header.removeEventListener("click",this._onHeaderClick)}static get observedAttributes(){return["focused","readonly","disabled","header","expand","scroll","cache-expand"]}attributeChangedCallback(e,t,s){switch(e){case"header":if(t===s)break;this._updateHeader(s);break;case"readonly":s=null!==s,this.updateUIAttr("readonly",s,this);break;case"disabled":s=null!==s,this.updateUIAttr("disabled",s,this);break;case"cache-expand":this._useCacheExpand(this,s);break;default:return}}get expand(){return this.hasAttribute("expand")}set expand(e){e?this.setAttribute("expand",""):this.removeAttribute("expand"),this.dispatch("expand");const t=this.getAttribute("cache-expand");null!==t&&(cacheExpand[t]=e)}get header(){return this.getAttribute("header")}set header(e){e?this.setAttribute("header",e):this.removeAttribute("header")}_useCacheExpand(e,t){if(!t||void 0==cacheExpand[t])return;cacheExpand[t]?e.setAttribute("expand",""):e.removeAttribute("expand")}updateUIAttr(e,t,s){if(s.childNodes)for(const a of s.childNodes)domUtils.isUIComponent(a)&&(a[e]=!!t)}_onHeaderClick(e){const t=e.target.tagName.toLowerCase();["ui-num-input","input","ui-select","select","ui-checkbox","checkbox"].includes(t)||(this.$root.expand=!this.$root.expand)}_onFocus(){this._noFocusFlag||(this.focused=!0)}_onMouseDown(e){e.target===this||this.$header.contains(e.target)||"header"===e.target.slot?this._noFocusFlag=!1:this._noFocusFlag=!0}_updateHeader(e){e&&e.startsWith("i18n:")&&(e=e.replace(/i18n:([^\s]+)/g,(e,t)=>{let s=Editor.I18n.t(t);return s||(s=t),s})),this.$headerSlot.innerHTML=e}}exports.Section=Section;