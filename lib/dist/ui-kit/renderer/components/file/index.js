"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.File=void 0;const fs=require("fs"),path=require("path"),I18n=require("@base/electron-i18n"),electron_1=require("electron"),ipc=require("@base/electron-base-ipc"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./file.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./file.html"),"utf8")}`,instanceArray=[];let customStyle="";function translateAll(){instanceArray.forEach(t=>{t._placeholder(t.getAttribute("placeholder"))})}I18n.on("switch",translateAll);class File extends base_1.Base{constructor(){super(),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$input=this.shadowRoot.querySelector(".input"),this.$select=this.shadowRoot.querySelector(".select"),this.$open=this.shadowRoot.querySelector(".open"),this.$input.$root=this.$select.$root=this.$open.$root=this,this.$input.addEventListener("change",this._onInputChange),this.$select.addEventListener("click",this._onSelectClick),this.$open.addEventListener("click",this._onOpenClick),this.addEventListener("mousedown",this._onMouseDown))}static importStyle(t){fs.existsSync(t)&&(customStyle=fs.readFileSync(t,"utf8"),instanceArray.map(t=>{t.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}get value(){const t=this.getAttribute("value");return t?t.trim():t}set value(t){t?(this.setAttribute("value",t),this.invalid&&(this.invalid=!1)):this.removeAttribute("value")}get type(){const t=this.getAttribute("type");return t?t.trim():t}set type(t){t?this.setAttribute("type",t):this.removeAttribute("type")}get extensions(){const t=this.getAttribute("extensions");return t?t.trim():t}set extensions(t){t?this.setAttribute("extensions",t):this.removeAttribute("extensions")}get multi(){return this.hasAttribute("multi")}set multi(t){t?this.setAttribute("multi",""):this.removeAttribute("multi")}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.shadowRoot){const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle)}}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1)}static get observedAttributes(){return["focused","readonly","disabled","invalid","placeholder","value","type","extensions","multi"]}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case"value":this.$input.value=s;break;case"placeholder":this._placeholder(s);break;case"readonly":this.$input.setAttribute("readonly",s)}}_onSelectClick(){const t=this;t.$root.readonly||ipc.send("editor-lib-ui-kit:select-file",{type:t.$root.type,extensions:t.$root.extensions,multi:t.$root.multi,defaultPath:t.$root.value||void 0}).callback((e,s)=>{if(e)return console.error(e);s&&(t.$root.value=s,t.$root.dispatch("change"),t.$root.dispatch("confirm"))})}_onOpenClick(){fs.existsSync(this.$root.value)?electron_1.shell.showItemInFolder(this.$root.value):Editor.Dialog.warn("File does not exist.")}_onInputChange(t){this.$root.readonly||(this.$root.value=t.target.value,this.$root.dispatch("change"),this.$root.dispatch("confirm"))}_placeholder(t){t&&t.startsWith("i18n:")&&(t=t.replace(/i18n:([^\s]+)/g,(t,e)=>{let s=Editor.I18n.t(e);return s||(console.debug(`${e} is not defined in 1i8n`),s=e),s})),this.$input.placeholder=t||""}}exports.File=File;