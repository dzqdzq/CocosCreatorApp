"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileUrl=exports.fileUrlManager=exports.FileUrlManager=void 0;const path_1=require("path"),ipc=require("@base/electron-base-ipc");class FileUrlManager{getAllFileProtocol(){return Object.keys(FileUrlManager.urlMap).map(r=>({protocol:r,label:FileUrlManager.urlMap[r].label,path:FileUrlManager.urlMap[r].path}))}resolveToRaw(r){const t=r.match(/^([a-zA-z]*):\/\/(.*)$/);if(t){const r=t[2].replace(/\\/g,"/"),o=this.getProtocalInfo(t[1]);if(o)return path_1.join(o.path,r)}return r}resolveToUrl(r,t){if(!r||!path_1.isAbsolute(r)||!t)return"";const o=this.getProtocalInfo(t);return o?o.protocol+"://"+path_1.relative(o.path,r).replace(/\\/g,"/"):""}getProtocalInfo(r){if(FileUrlManager.urlMap[r])return Object.assign({protocol:r},FileUrlManager.urlMap[r])}}exports.FileUrlManager=FileUrlManager,FileUrlManager.urlMap={},FileUrlManager.hasInit=!1,exports.fileUrlManager=new FileUrlManager,ipc.send("editor-lib-ui-kit:query-protocols").callback((r,t)=>{if(r)return console.error(r);FileUrlManager.urlMap=t||{},FileUrlManager.hasInit=!0,console.debug("init urlMap")});class FileUrl{constructor(r){this._relPath="",this._$root=r}get invalid(){return!!this.value&&(!(!this._protocolInfo||!path_1.isAbsolute(this.relPath))||!this._protocolInfo&&!path_1.isAbsolute(this.raw))}get protocolInfo(){return this._protocolInfo}set relPath(r){r=null!==r&&void 0!==r?r:"",this._protocolInfo?this._relPath=r.replace(/\\/g,"/"):this._relPath=r}get relPath(){return this._relPath}get protocol(){var r;return null===(r=this._protocolInfo)||void 0===r?void 0:r.protocol}set protocol(r){if(!r)return void(this._protocolInfo=void 0);const t=exports.fileUrlManager.getProtocalInfo(r);this._protocolInfo=t}get raw(){return this._protocolInfo&&this._protocolInfo.path?path_1.join(this._protocolInfo.path,this.relPath||""):this.relPath}get url(){return this._protocolInfo?this._protocolInfo.protocol+"://"+this.relPath:this.relPath}set value(r){if(!r)return;const t=r.match(/^([a-zA-z]*):\/\/(.*)$/);if(t){this.relPath=t[2].replace(/\\/g,"/");const r=()=>{const r=exports.fileUrlManager.getProtocalInfo(t[1]);this._protocolInfo=r};exports.fileUrlManager.getProtocalInfo(t[1])||FileUrlManager.hasInit?r():(this._timer=setTimeout(()=>{this._protocolInfo||(r(),this._$root._urlChange())},300),this._protocolInfo={protocol:t[1]})}else this.relPath=r}get value(){return this._protocolInfo?this.relPath:this.raw}toString(){return this._protocolInfo?this.url:this.raw}}exports.FileUrl=FileUrl,ipc.on("editor-lib-ui-kit:protocols-change",(r,t)=>{FileUrlManager.urlMap=t||{}});