"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileUrl=exports.fileUrlManager=exports.FileUrlManager=void 0;const path_1=require("path"),ipc=require("@base/electron-base-ipc");class FileUrlManager{getAllFileProtocol(){return Object.keys(FileUrlManager.urlMap).map(t=>({protocol:t,label:FileUrlManager.urlMap[t].label,path:FileUrlManager.urlMap[t].path}))}resolveToRaw(t){const r=t.match(/^([a-zA-z]*):\/\/(.*)$/);if(r){const t=r[2].replace(/\\/g,"/"),o=this.getProtocalInfo(r[1]);if(o)return path_1.join(o.path,t)}return t}resolveToUrl(t,r){if(!t||!path_1.isAbsolute(t)||!r)return"";const o=this.getProtocalInfo(r);return o?o.protocol+"://"+path_1.relative(o.path,t).replace(/\\/g,"/"):""}getProtocalInfo(t){if(FileUrlManager.urlMap[t])return Object.assign({protocol:t},FileUrlManager.urlMap[t])}}exports.FileUrlManager=FileUrlManager,FileUrlManager.urlMap={},FileUrlManager.hasInit=!1,exports.fileUrlManager=new FileUrlManager,ipc.send("editor-lib-ui-kit:query-protocols").callback((t,r)=>{if(t)return console.error(t);FileUrlManager.urlMap=r||{},FileUrlManager.hasInit=!0,console.debug("init urlMap")});class FileUrl{constructor(t){this._relPath="",this._$root=t}get invalid(){return!!this.value&&(!(!this._protocolInfo||!path_1.isAbsolute(this.relPath)&&!this.relPath.includes("../"))||!this._protocolInfo&&!path_1.isAbsolute(this.raw))}get protocolInfo(){return this._protocolInfo}set relPath(t){t=null!==t&&void 0!==t?t:"",this._protocolInfo?this._relPath=t.replace(/\\/g,"/"):this._relPath=t}get relPath(){return this._relPath}get protocol(){var t;return null===(t=this._protocolInfo)||void 0===t?void 0:t.protocol}set protocol(t){if(!t)return void(this._protocolInfo=void 0);const r=exports.fileUrlManager.getProtocalInfo(t);this._protocolInfo=r}get raw(){return this._protocolInfo&&this._protocolInfo.path?path_1.join(this._protocolInfo.path,this.relPath||""):this.relPath}get url(){return this._protocolInfo?this._protocolInfo.protocol+"://"+this.relPath:this.relPath}set value(t){if(!t)return;const r=t.match(/^([a-zA-z]*):\/\/(.*)$/);if(r){this.relPath=r[2].replace(/\\/g,"/");const t=()=>{const t=exports.fileUrlManager.getProtocalInfo(r[1]);this._protocolInfo=t};exports.fileUrlManager.getProtocalInfo(r[1])||FileUrlManager.hasInit?t():(this._timer=setTimeout(()=>{this._protocolInfo||(t(),this._$root._urlChange())},300),this._protocolInfo={protocol:r[1]})}else this.relPath=t}get value(){return this._protocolInfo?this.relPath:this.raw}toString(){return this._protocolInfo?this.url:this.raw}}exports.FileUrl=FileUrl,ipc.on("editor-lib-ui-kit:protocols-change",(t,r)=>{FileUrlManager.urlMap=r||{}});