"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Prop=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./prop.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./prop.html"),"utf8")}`,instanceArray=[];let customStyle="";class Prop extends base_1.Base{constructor(){super(),this.__render__=null,this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$wrap=this.shadowRoot.querySelector(".wrap"),this.$label=this.shadowRoot.querySelector(".text"),this.$content=this.shadowRoot.querySelector(".content"),this.$content.$root=this)}static importStyle(t){fs.existsSync(t)&&(customStyle=fs.readFileSync(t,"utf8"),instanceArray.map(t=>{t.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}))}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.removeAttribute("tabindex"),this.shadowRoot){const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle)}}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1)}static get observedAttributes(){return["render","label","tabindex"]}attributeChangedCallback(t,e,i){switch(t){case"render":this._renderUI();break;case"label":this._renderLabel();break;case"tabindex":this.setAttribute("tanindex","")}}_renderLabel(){if(null===this.getAttribute("label"))return this.__label__.parentElement&&this.__label__.parentElement.removeChild(this.__label__),void(this.__label__=null);this.__label__||(this.__label__=document.createElement("ui-label")),this.__label__.setAttribute("slot","label"),this.__label__.setAttribute("value",this.getAttribute("label")),this.appendChild(this.__label__)}_renderUI(){const t=this.getAttribute("render");if(!t)return this.__ui__.parentElement&&this.__ui__.parentElement.removeChild(this.__ui__),void(this.__ui__=null);try{const e=JSON.parse(t);if(e.ui!==this.__render__&&(this.__ui__&&this.__ui__.parentElement.removeChild(this.__ui__),this.__ui__=document.createElement(e.ui),this.__ui__.setAttribute("slot","content")),e.attributes)for(let t in e.attributes){this.__ui__.getAttribute(t)!==e.attributes[t]&&this.__ui__.setAttribute(t,e.attributes[t])}if(e.tooltip?e.tooltip.startsWith("i18n:")?this.setAttribute("title",Editor.I18n.t(e.tooltip.substr(5))):this.setAttribute("title",e.tooltip):this.removeAttribute("title"),"ui-select"===e.ui&&e.items&&Array.isArray(e.items)){let t="";e.items.forEach(e=>{let i=e.label||e.value;i.startsWith("i18n:")&&(i=Editor.I18n.t(i.substr(5))),t+=`<option value="${e.value}">${i}</option>`}),this.__ui__.innerHTML=t}this.__ui__.parentElement!==this&&this.appendChild(this.__ui__),this.__render__=e.ui}catch(t){console.error(t)}}}exports.Prop=Prop;