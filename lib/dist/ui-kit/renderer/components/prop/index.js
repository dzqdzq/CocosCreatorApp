"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Prop=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./prop.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./prop.html"),"utf8")}`,instanceArray=[],renderMap={};class Prop extends base_1.Base{constructor(){super(),this.renderInfo=null,this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$wrap=this.shadowRoot.querySelector(".wrap"),this.$label=this.shadowRoot.querySelector(".text"),this.$icon=this.shadowRoot.querySelector(".icon"),this.$content=this.shadowRoot.querySelector(".content"),this.$content.$root=this)}static registerRender(t,e){renderMap[t]=e}static hasRender(t){return!!renderMap[t]}connectedCallback(){super.connectedCallback(),this.removeAttribute("tabindex"),instanceArray.push(this)}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1)}static get observedAttributes(){return["render"]}attributeChangedCallback(t,e,r){switch(t){case"render":try{const t=JSON.parse(r);this.render(t)}catch(t){console.error(t)}}}render(t){!t&&this.dump&&(t=this.dump);const e=this.getAttribute("type")||"ui";if(this.renderInfo&&this.renderInfo.type===e)this.renderInfo.panel.update.call(this.renderInfo.panelThis,t);else if(renderMap[e]){const r=renderMap[e];if(this.renderInfo&&this.renderInfo.panel===r)return void r.update.call(this.renderInfo.panelThis,t);let s="";if(r.style){this.shadowRoot.querySelector("#custom-style").innerHTML=r.style}r.template&&(s+=r.template),s&&(this.innerHTML=s);const i={$this:this,$:{}};if(r.methods)for(const t in r.methods)i[t]=r.methods[t];if(r.$)for(const t in r.$){const e=this.querySelectorAll(r.$[t]);i.$[t]=e.length>1?e:e[0]||null}if(r.listeners)for(const t in r.listeners)this.addEventListener(t,e=>{r.listeners[t].call(i,e)}),this.shadowRoot.addEventListener(t,e=>{r.listeners[t].call(i,e)});r.ready.call(i),r.update.call(i,t),this.renderInfo={panel:r,panelThis:i,type:e}}}getName(t){if(t||(t=this.dump),!t)return"";if(t.displayName)return t.displayName;let e=t.name||"";return(e=(e=(e=e.replace(/^\S/,t=>t.toUpperCase())).replace(/_/g,t=>" ")).replace(/ \S/g,t=>` ${t.toUpperCase()}`)).trim()}setLabel(t,e){if(e||(e=this.dump),t&&e)if(t.innerHTML=this.getName(e),e.tooltip){let r=e.tooltip;r.startsWith("i18n:")&&((r=Editor.I18n.t("ENGINE."+r.substr(5)))&&r!==e.tooltip||(r=Editor.I18n.t(e.tooltip.substr(5))||e.tooltip)),t.setAttribute("tooltip",r)}else t.removeAttribute("tooltip")}setReadonly(t,e){t||(t=this.dump),t&&t.readonly?e.setAttribute("disabled","true"):e.removeAttribute("disabled")}}exports.Prop=Prop,Prop.registerRender("ui",{ready(){},update(t){const e=this.$this;if(e.hasAttribute("label")){let t=e.querySelector("*[slot=label]");t||((t=document.createElement("ui-label")).setAttribute("slot","label"),e.appendChild(t)),t.setAttribute("value",e.getAttribute("label"))}let r=e.querySelector("*[slot=content]");if(r||(r=document.createElement(t.ui)).setAttribute("slot","content"),t.attributes)for(const e in t.attributes){r.getAttribute(e)!==t.attributes[e]&&r.setAttribute(e,t.attributes[e])}if(t.tooltip?t.tooltip.startsWith("i18n:")?e.setAttribute("title",Editor.I18n.t(t.tooltip.substr(5))):e.setAttribute("title",t.tooltip):e.removeAttribute("title"),"ui-select"===t.ui&&t.items&&Array.isArray(t.items)){let e="";t.items.forEach(t=>{let r=t.label||t.value;r.startsWith("i18n:")&&(r=Editor.I18n.t(r.substr(5))),e+=`<option value="${t.value}">${r}</option>`}),r.innerHTML=e}r.parentElement!==e&&e.appendChild(r)}});