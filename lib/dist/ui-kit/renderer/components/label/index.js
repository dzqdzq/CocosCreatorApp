"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Label=void 0;const fs=require("fs"),path=require("path"),I18n=require("@base/electron-i18n"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./label.css"),"utf8")}</style>`,HTML=`${fs.readFileSync(path.join(__dirname,"./label.html"),"utf8")}`,instanceArray=[],prefix="i18n:";function translateAll(){instanceArray.forEach(e=>{e._render()})}I18n.on("switch",translateAll);class Label extends base_1.Base{constructor(){super(),this._renderLock=!1,this.shadowRoot&&(this.defaultTabIndex="-1",this.shadowRoot.innerHTML=`${STYLE}${HTML}`,this.$span=this.shadowRoot.querySelector("span"),this.$slot=this.shadowRoot.querySelector("slot"),this.$slot.$root=this,this._renderLock=!1,this.$slot.addEventListener("slotchange",this._slotChange),this.$slot.addEventListener("DOMSubtreeModified",this._slotChange))}get value(){return this.getAttribute("value")||""}set value(e){e?(this.setAttribute("value",e),this.innerHTML=e):(this.removeAttribute("value"),this.innerHTML="")}get i18n(){return null!==this.getAttribute("i18n")||this.value.startsWith(prefix)}set i18n(e){e?this.setAttribute("i18n",""):this.removeAttribute("i18n")}connectedCallback(){super.connectedCallback(),instanceArray.push(this)}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this);instanceArray.splice(e,1)}static get observedAttributes(){return["value","i18n"]}attributeChangedCallback(e,t,s){switch(e){case"value":case"i18n":if(this._renderLock)return;requestAnimationFrame(()=>{this._render(),this._renderLock=!1}),this._renderLock=!0}}_render(){let e=this.value||this.innerHTML;this.i18n||e.startsWith(prefix)?(e=e.replace(/(i18n:)?([^\s]+)/g,(e,t,s)=>{let i=I18n.translation(s);return i||(i=s),i}),this.$span.innerHTML=e):this.$span.innerHTML=e}_slotChange(){this.$root.value!==this.$root.innerHTML&&(this.$root.value=this.$root.innerHTML)}}exports.Label=Label;