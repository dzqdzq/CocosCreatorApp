"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DragArea=void 0;const ipc=require("@base/electron-base-ipc");let dragInfo=null;ipc.on("editor-lib-ui-kit:drag-start",(e,t)=>{dragInfo=t}),ipc.on("editor-lib-ui-kit:drag-end",e=>{dragInfo=null});class DragArea extends HTMLElement{constructor(){super(...arguments),this._types=[]}static get currentDragInfo(){return dragInfo}get additional(){return null!==this.getAttribute("additional")}set additional(e){clearTimeout(this.additionalTimer),(e=!!e)?this.setAttribute("additional",""):this.removeAttribute("additional")}get hoving(){return null!==this.getAttribute("hoving")}get droppable(){return(this.getAttribute("droppable")||"").split(",")}set droppable(e){Array.isArray(e)||(e=[e+""]),e?this.setAttribute("droppable",e.join(",")):this.removeAttribute("droppable")}connectedCallback(){this.addEventListener("dragover",this._onDragOver),this.addEventListener("dragleave",this._onDragLevel),this.addEventListener("drop",this._onDrop),this.addEventListener("drop",this._onPreDrop,!0)}disconnectedCallback(){this.removeEventListener("dragover",this._onDragOver),this.removeEventListener("dragleave",this._onDragLevel),this.removeEventListener("drop",this._onDrop),this.removeEventListener("drop",this._onPreDrop,!0)}static get observedAttributes(){return["focused","readonly","disabled","invalid","droppable"]}attributeChangedCallback(e,t,r){switch(e){case"droppable":this._types=r?r.split(",").map(e=>e.trim()):[]}}_onDragOver(e){e.preventDefault();let t=dragInfo?dragInfo.type:null;-1!==e.dataTransfer.types.indexOf("Files")&&(t="file");const r=this._types;let i=r&&-1!==r.indexOf(t);!i&&dragInfo&&Array.isArray(dragInfo.extends)&&(i=dragInfo.extends.some(e=>r&&-1!==r.indexOf(e))),this.additional=!1,dragInfo&&dragInfo.additional&&Array.isArray(dragInfo.additional)&&(this.additional=dragInfo.additional.some(e=>r&&-1!==r.indexOf(e.type))),(i||this.additional)&&(clearTimeout(this.hovingTimer),this.setAttribute("hoving",""),e.stopPropagation())}_onDragLevel(){clearTimeout(this.hovingTimer),this.hovingTimer=setTimeout(()=>{this.removeAttribute("hoving")},200)}_onDrop(e){this.hasAttribute("hoving")&&(e.stopPropagation(),e.preventDefault())}_onPreDrop(e){clearTimeout(this.hovingTimer),this.hovingTimer=setTimeout(()=>{this.removeAttribute("hoving")},200)}}exports.DragArea=DragArea;