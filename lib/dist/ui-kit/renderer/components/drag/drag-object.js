"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DragObject=void 0;const fs=require("fs"),path=require("path"),base_1=require("../base"),drag_area_1=require("./drag-area"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./drag-object.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./drag-object.html"),"utf8")}`,instanceArray=[];class DragObject extends base_1.Base{constructor(){super(),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$name=this.shadowRoot.querySelector(".name"),this.$area=this.shadowRoot.querySelector("ui-drag-area"),this.$clear=this.shadowRoot.querySelector(".clear"),this.$select=this.shadowRoot.querySelector(".select"),this.$value=this.shadowRoot.querySelector("ui-drag-area .value"),this.$placeholder=this.shadowRoot.querySelector("ui-drag-area .placeholder"),this.$area.$root=this.$clear.$root=this.$select.$root=this)}static get observedAttributes(){return["disabled","droppable","value","placeholder","readonly","invalid","path"]}async attributeChangedCallback(e,t,r){switch(super.attributeChangedCallback(e,t,r),e){case"droppable":this._droppable=r.trim(),this.placeholder=this._droppable,this.$area.droppable=this._droppable,this.$name.innerHTML=this._droppable;break;case"value":r=r||"",this._value!==r.trim()&&(this._value=r,this._onTranslationName(this._value).then(e=>{this.$value.innerHTML=e})),this._value?(this.setAttribute("effective",""),this.hasAttribute("editable")&&this.setAttribute("editable","true")):(this.removeAttribute("effective"),this.hasAttribute("editable")&&this.setAttribute("editable","false"));break;case"placeholder":this._placeholder=r.trim(),this.$placeholder.innerHTML=this._placeholder}}get droppable(){return this._droppable}set droppable(e){this.setAttribute("droppable",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get placeholder(){return this._placeholder}set placeholder(e){e=e.toString().trim(),this._placeholder!==e&&this.setAttribute("placeholder",e)}get invalid(){return null!==this.getAttribute("invalid")}set invalid(e){e?this.setAttribute("invalid",""):this.removeAttribute("invalid")}async connectedCallback(){super.connectedCallback(),instanceArray.push(this),this._droppable=this.getAttribute("droppable")||"",this._value=this.getAttribute("value")||"",this._placeholder=this.getAttribute("placeholder")||this._droppable||"NONE",this._droppable&&(this.$area.droppable=this._droppable),this._placeholder&&(this.$placeholder.innerHTML=this._placeholder),this.$area.setAttribute("title",this._droppable),this.$area.addEventListener("dragover",this._onAreaDragOver),this.$area.addEventListener("dragleave",this._onAreaDragLeave),this.$area.addEventListener("drop",this._onAreaDrop),this.$area.addEventListener("click",this._onAreaClick),this.$clear.addEventListener("click",this._onClearClick),this.$select.addEventListener("click",this._onSelectClick)}disconnectedCallback(){super.disconnectedCallback();const e=instanceArray.indexOf(this);instanceArray.splice(e,1),this.$area.removeEventListener("dragover",this._onAreaDragOver),this.$area.removeEventListener("dragleave",this._onAreaDragLeave),this.$area.removeEventListener("drop",this._onAreaDrop),this.$area.removeEventListener("click",this._onAreaClick),this.$clear.removeEventListener("click",this._onClearClick),this.$select.removeEventListener("click",this._onSelectClick)}_onAreaDragOver(){this.$root.disabled||this.$root.readonly||this.$root.setAttribute("state",this.hoving||this.additional?"allow":"refused")}_onAreaDragLeave(){this.$root.disabled||this.$root.readonly||this.$root.removeAttribute("state")}_onAreaDrop(e){const t=this;if(t.$root.disabled||t.$root.readonly)return;const r=t.$root.getAttribute("state");if(t.$root.removeAttribute("state"),"refused"!==r){if(t.additional){const e=t.droppable,r=drag_area_1.DragArea.currentDragInfo.additional;if(r)for(const a of r)if(e.includes(a.type))return t.$root.value=a.value,t.$root.removeAttribute("invalid"),t.$root.dispatch("change"),void t.$root.dispatch("confirm")}else t.$root.invalid&&(t.$root.invalid=!1);t.$root.value=e.dataTransfer.getData("value"),t.$root.dispatch("change"),t.$root.dispatch("confirm")}}_onClearClick(e){this.$root.disabled||this.$root.readonly||(e.stopPropagation(),this.$root.value="",this.$root.removeAttribute("invalid"),this.$root.dispatch("clear"),this.$root.dispatch("change"),this.$root.dispatch("confirm"))}_onAreaClick(){}_onSelectClick(){}async _onTranslationName(e){return e}}exports.DragObject=DragObject;