"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Input=void 0;const fs=require("fs"),path=require("path"),I18n=require("@base/electron-i18n"),base_1=require("../base"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./input.css"),"utf8")}</style>`,CUSTOM_STYLE='<style id="custom-style"></style>',HTML=`${fs.readFileSync(path.join(__dirname,"./input.html"),"utf8")}`,instanceArray=[];let customStyle="";function translateAll(){instanceArray.forEach(t=>{t._placeholder(t.getAttribute("placeholder"))})}I18n.on("switch",translateAll);class Input extends base_1.Base{constructor(){super(),this._staging=null,this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${CUSTOM_STYLE}${HTML}`,this.$input=this.shadowRoot.querySelector("input"),this.$clear=this.shadowRoot.querySelector(".clear"),this.$input.$root=this.$clear.$root=this,this._staging=null,this.$input.addEventListener("focus",this._onInputFocus),this.$input.addEventListener("blur",this._onInputBlur),this.$input.addEventListener("input",this._onInputChange),this.$clear.addEventListener("click",this._onClear,!0))}static importStyle(t){return!!fs.existsSync(t)&&(customStyle=fs.readFileSync(t,"utf8"),instanceArray.map(t=>{t.shadowRoot.querySelector("#custom-style").innerHTML=customStyle}),!0)}static get observedAttributes(){return["disabled","readonly","invalid","path","value","password","placeholder","auto-select","show-clear"]}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case"disabled":this.$input.disabled=null!==s;break;case"readonly":null!==s?this.$input.setAttribute("readonly",""):this.$input.removeAttribute("readonly");break;case"invalid":this.$input.value=null!==s?"-":this.value;break;case"value":if(this.invalid)return;if(""!==s&&this["show-clear"]?this.$clear.style.display="inline-block":this.$clear.style.display="none",null!==this._staging)break;this.$input.value=s;break;case"placeholder":this._placeholder(s);break;case"password":this.$input.type=null!==s?"password":"text";break;case"show-clear":""!==this.value&&this["show-clear"]?this.$clear.style.display="inline-block":this.$clear.style.display="none"}}get value(){return this.getAttribute("value")||""}set value(t){t+="",this.setAttribute("value",t)}get password(){return null!==this.getAttribute("password")}set password(t){t?this.setAttribute("password",""):this.removeAttribute("password")}get placeholder(){return this.getAttribute("placeholder")}set placeholder(t){t+="",this.setAttribute("placeholder",t)}get"auto-select"(){return!("false"===this.getAttribute("auto-select"))}set"auto-select"(t){t?this.$input.setAttribute("auto-select",""):this.$input.setAttribute("auto-select","false")}get"show-clear"(){return null!==this.getAttribute("show-clear")}set"show-clear"(t){t?this.setAttribute("show-clear",""):this.removeAttribute("show-clear")}connectedCallback(){if(super.connectedCallback(),instanceArray.push(this),this.shadowRoot){const t=this.shadowRoot.querySelector("#custom-style");t&&(t.innerHTML=customStyle)}}disconnectedCallback(){super.disconnectedCallback();const t=instanceArray.indexOf(this);instanceArray.splice(t,1)}_onFocus(t){super._onFocus(t),this.disabled||this.$input.focus()}_onInputFocus(){const t=this;t.disabled||t.readonly||(t.$root._staging=t.value,t.$root["auto-select"]&&t.select())}_onInputBlur(){const t=this;t.$root._staging!==this.value&&t.$root._confirm(!0),t.$root._staging=null}_onInputChange(){this.$root.value=this.value,this.$root.dispatch("change")}_onKeyDown(t){if(!this.disabled&&!this.readonly)switch(t.keyCode){case 13:this._confirm();break;case 27:this._cancel()}}_onClear(){this.style.display="none",this.$root._clear()}_confirm(t){const e=null!==this._staging;this._onInputChange.call(this.$input),null!==this._staging&&this._staging!==this.value&&(this._staging=this.value,this.dispatch("change"),this.dispatch("confirm")),t||(e?this.focus():this.$input.focus())}_cancel(){const t=null!==this._staging;null!==this._staging&&this._staging!==this.value&&(this.value=this.$input.value=this._staging||"",this.dispatch("change"),this.dispatch("cancel"),this.dispatch("confirm")),t&&this.focus()}_clear(){""!==this.value&&(this.value="",this.$input.value="",this.dispatch("change"),this.dispatch("confirm"),this.focus())}_placeholder(t){t&&t.startsWith("i18n:")&&(t=t.replace(/i18n:([^\s]+)/g,(t,e)=>{let s=Editor.I18n.t(e);return s||(console.debug(`${e} is not defined in 1i8n`),s=e),s})),this.$input.placeholder=t||""}}exports.Input=Input;