"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Panel=void 0;const fs_1=require("fs"),path_1=require("path"),STYLE=`<style>${fs_1.readFileSync(path_1.join(__dirname,"./panel.css"),"utf8")}</style>`;class Panel extends HTMLElement{constructor(){super(),this.panel=null,this.panelObject=null,this.__listeners={},this.connected=!1,this._injectionStyle=""}set config(e){this._setPanel(e)}_setPanel(e){if(this.__listeners)for(let e in this.__listeners)this.removeEventListener(e,this.__listeners[e]),this.shadowRoot.removeEventListener(e,this.__listeners[e]);this.panel&&this.panel.close&&this.panel.close.call(this.panelObject),this.panel=e,this._refresh()}connectedCallback(){this.connected=!0,this.panel&&this.panel.ready&&this.panel.ready.call(this.panelObject)}disconnectedCallback(){this.connected=!1,this.panel&&this.panel.close&&this.panel.close.call(this.panelObject)}static get observedAttributes(){return["src"]}async attributeChangedCallback(e,t,s){switch(e){case"src":if(s){if(t!==s)try{this._setPanel(require(s))}catch(e){console.error(e),this._setPanel(null)}}else this._setPanel(null);break;default:return}}dispatch(e,...t){const s=document.createEvent("HTMLEvents");s.initEvent(e,!0,!0),s.args=t,this.dispatchEvent(s)}update(...e){this.panel.update&&this.panel.update.call(this.panelObject,...e)}injectionStyle(e){if(this._injectionStyle=e,this.shadowRoot){this.shadowRoot.querySelector("#injection-style").innerHTML=e}}async canClose(){if(this.panel&&this.panel.beforeClose){if(!1===await this.panel.beforeClose.call(this.panelObject))return!1}return!0}async callMethod(e,...t){if(this.panel&&this.panel.methods&&this.panel.methods[e])return await this.panel.methods[e].call(this.panelObject,...t)}_refresh(){const e=null!==this.getAttribute("inline");e||this.shadowRoot||this.attachShadow({mode:"open"});const t=e?this:this.shadowRoot;if(this.panel){if(e)t.innerHTML=this.panel.template||"";else if(t.innerHTML=`${STYLE}<style id="injection-style"></style><style>${this.panel.style||""}</style>${this.panel.template||""}`,!e&&this._injectionStyle){this.shadowRoot.querySelector("#injection-style").innerHTML=this._injectionStyle}if(this.panelObject={$this:this,dispatch:this.dispatch.bind(this)},this.panel.$){const e={};for(const s in this.panel.$){const i=this.panel.$[s];"string"==typeof i&&(e[s]=t.querySelector(i))}this.panelObject.$=e}if(this.panel.listeners)for(let e in this.panel.listeners)this.__listeners[e]=(t=>{this.panel.listeners[e].call(this.panelObject,t)}),this.addEventListener(e,this.__listeners[e]),this.shadowRoot.addEventListener(e,this.__listeners[e]);if(this.panel.methods&&"object"==typeof this.panel.methods)for(const e in this.panel.methods)this.panelObject[e]=this.panel.methods[e];this.connected&&this.panel.ready&&this.panel.ready.call(this.panelObject)}else t.innerHTML=""}}exports.Panel=Panel;