"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Channel=void 0;class Channel{constructor(e){this.vertexSource="\n        attribute vec2 a_position;\n        attribute vec2 a_texCoord;\n        uniform vec2 u_resolution;\n        varying vec2 v_texCoord;\n\n        void main() {\n            vec2 zero_one = a_position / u_resolution;\n            vec2 zero_two = zero_one * 2.0;\n            vec2 clipSpace = zero_two - 1.0;\n            gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n            v_texCoord = a_texCoord;\n        }\n    ",this.fragmentSource="\n        precision mediump float;\n        uniform sampler2D u_image;\n        uniform bool u_r;\n        uniform bool u_g;\n        uniform bool u_b;\n        varying vec2 v_texCoord;\n\n        void main() {\n            vec4 color = texture2D(u_image, v_texCoord);\n            vec4 result = vec4(0, 0, 0, 1);\n            if (u_r) {\n                result.r = color.r;\n                if (!u_g && !u_b) {\n                    result.g = color.r;\n                    result.b = color.r;\n                }\n            }\n            if (u_g) {\n                result.g = color.g;\n                if (!u_r && !u_b) {\n                    result.r = color.g;\n                    result.b = color.g;\n                }\n            }\n            if (u_b) {\n                result.b = color.b;\n                if (!u_r && !u_g) {\n                    result.r = color.b;\n                    result.g = color.b;\n                }\n            }\n            gl_FragColor = result;\n        }\n    ",this.uiImage=e,this.gl=e.$canvas.getContext("webgl"),this.shaderProgram=this.gl.createProgram();const t=this.loadShader(this.gl.VERTEX_SHADER,this.vertexSource),r=this.loadShader(this.gl.FRAGMENT_SHADER,this.fragmentSource);t&&r&&this.gl.linkProgram(this.shaderProgram)}loadShader(e,t){const r=this.gl.createShader(e);return this.gl.shaderSource(r,t),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?(this.gl.attachShader(this.shaderProgram,r),!0):(console.error(`${t}\nError:${this.gl.getShaderInfoLog(r)}`),this.gl.deleteShader(r),!1)}update(){this.image=new Image,this.image.onload=(()=>{this.width=this.uiImage.$canvas.width=this.image.width,this.height=this.uiImage.$canvas.height=this.image.height,this.render()}),this.image.src=this.uiImage.src}render(){const{gl:e,width:t,height:r,shaderProgram:i}=this,o=e.getAttribLocation(i,"a_position");this.positionBuffer=this.positionBuffer||e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,t,0,0,r,0,r,t,0,t,r]),e.DYNAMIC_DRAW),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0);const s=e.getAttribLocation(i,"a_texCoord");this.texCoordBuffer||(this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0)),this.generateTexture(),e.enableVertexAttribArray(o),e.enableVertexAttribArray(s),e.viewport(0,0,t,r),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(i),e.uniform2f(e.getUniformLocation(i,"u_resolution"),t,r),e.uniform1i(e.getUniformLocation(i,"u_r"),this.uiImage.channel.includes("r")),e.uniform1i(e.getUniformLocation(i,"u_g"),this.uiImage.channel.includes("g")),e.uniform1i(e.getUniformLocation(i,"u_b"),this.uiImage.channel.includes("b")),e.drawArrays(e.TRIANGLES,0,6)}generateTexture(){const{gl:e,image:t}=this;this.gl.deleteTexture(this.texture),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}clear(){this.gl&&(this.positionBuffer instanceof WebGLBuffer&&this.gl.isBuffer(this.positionBuffer)&&this.gl.deleteBuffer(this.positionBuffer),this.texCoordBuffer instanceof WebGLBuffer&&this.gl.isBuffer(this.texCoordBuffer)&&this.gl.deleteBuffer(this.texCoordBuffer),this.shaderProgram instanceof WebGLProgram&&this.gl.isProgram(this.shaderProgram)&&this.gl.deleteProgram(this.shaderProgram),this.texture instanceof WebGLTexture&&this.gl.isTexture(this.texture)&&this.gl.deleteTexture(this.texture)),this.texture=void 0,this.shaderProgram=void 0,this.texCoordBuffer=void 0,this.positionBuffer=void 0,this.gl=void 0}}exports.Channel=Channel;