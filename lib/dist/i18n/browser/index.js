"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=exports.select=exports.t=exports.getLanguage=void 0;const path_1=require("path"),electron_1=require("electron"),fs_extra_1=require("fs-extra"),message_1=require("../../message"),i18n=require("@base/electron-i18n"),setting=require("@editor/setting"),ipc=require("@base/electron-base-ipc"),languages={zh:require("../languages/zh"),en:require("../languages/en")},file=path_1.join(setting.PATH.HOME,"editor/i18n.json"),oldFile=path_1.join(setting.PATH.HOME.replace(".CocosCreator",".CocosEditor3D"),"editor/i18n.json");let json;!fs_extra_1.existsSync(file)&&fs_extra_1.existsSync(oldFile)&&fs_extra_1.copySync(oldFile,file);try{json=fs_extra_1.readJSONSync(file)}catch(e){const n=electron_1.app.getLocale();json={language:n.indexOf("zh")>=0?"zh":"en"}}"zh"!==json.language&&"en"!==json.language||i18n.switch(json.language);const save=function(){try{fs_extra_1.outputJSONSync(file,json,{spaces:2})}catch(e){console.error(e)}};function getLanguage(){return json.language}function t(e,n){let t=i18n.translation(e)||i18n.translation(e,"en");if(n&&"object"==typeof n){if(Object.keys(n).length){const e=/\{([a-zA-Z_]+[a-zA-Z0-9_])\}/g;t=t.replace(e,function(e,t){return n[t]})}}return t}function select(e){"zh"!==e&&"en"!==e||i18n.switch(e)}function register(e,n,t){i18n.append(n,t,e)}i18n.register(languages.en,"en"),i18n.register(languages.zh,"zh"),exports.getLanguage=getLanguage,exports.t=t,exports.select=select,exports.register=register,ipc.on("editor3d-lib-i18n:language",()=>json.language),i18n.on("switch",e=>{json.language!==e&&(json.language=e,message_1.Message.broadcast("i18n:change",e),save())});