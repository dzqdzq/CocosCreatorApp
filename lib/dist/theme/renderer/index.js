"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),fs_1=require("fs"),path_1=require("path"),Profile=require("@base/electron-profile"),ipc=require("@base/electron-base-ipc"),ps=require("path"),fse=require("fs-extra"),dock=require("@editor/dock"),panel=require("@editor/panel"),Chroma=require("chroma-js"),profile=Profile.load("global://editor/theme.json"),uiKit=require("../../ui-kit"),window=require("../../windows");function mColor(e,r){if(e){switch(e=Chroma(`#${e}`),r){case"weakest":e=e.brighten(.6);break;case"weaker":e=e.brighten(.3);break;case"emphasis":e=e.darken(.3);break;case"important":e=e.darken(.6)}return e.name()}}class Theme extends events_1.EventEmitter{constructor(){super(),this.$style=document.createElement("style"),document.head.appendChild(this.$style),dock.importStyle(path_1.join(__dirname,"../dist/dock.css")),panel.importStyle(path_1.join(__dirname,"../dist/panel.css"))}getList(){return fse.readdirSync(ps.join(__dirname,"../color")).map(e=>{const r=ps.extname(e);return e.replace(r,"")})}use(e){if(!e)return profile.get("theme");ipc.send("editor3d-lib-theme:use",e)}}const manager=module.exports=new Theme;function apply(e){e||(e="creator");let r=path_1.join(__dirname,`../color/${e}.js`);if(!fs_1.existsSync(r))return console.log("The theme does not exist. Use the default theme."),void manager.use("creator");const t=JSON.parse(JSON.stringify(require(r)));let o="body {\n";Object.keys(t.color).forEach(e=>{Object.keys(t.color[e]).forEach(r=>{let s=t.color[e][r];"string"==typeof s&&(s={normal:s}),o+=`  --color-${e}-${r}: ${s.normal};\n`,s.weaker||(s.weaker=Chroma(`${s.normal}`).brighten(t.contrast).hex()),s.weakest||(s.weakest=Chroma(`${s.weaker}`).brighten(t.contrast).hex()),s.emphasis||(s.emphasis=Chroma(`${s.normal}`).darken(t.contrast).hex()),s.important||(s.important=Chroma(`${s.emphasis}`).darken(t.contrast).hex()),Object.keys(s).forEach(t=>{o+=`  --color-${e}-${r}-${t}: ${s[t]};\n`})})}),Object.keys(t.size).forEach(e=>{Object.keys(t.size[e]).forEach(r=>{o+=`  --size-${e}-${r}: ${t.size[e][r]};\n`})}),Object.keys(t.font).forEach(e=>{o+=`  --font-${e}: ${t.font[e]};\n`}),o+="\n}",manager.$style.innerHTML=o}apply(profile.get("theme")),ipc.on("editor3d-lib-theme:use",async(e,r)=>{apply(r)});