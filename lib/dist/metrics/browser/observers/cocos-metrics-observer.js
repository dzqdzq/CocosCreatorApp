"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const metrics_observer_base_1=require("./metrics-observer-base"),encrypt=require("./cocos-encrypt"),https=require("https"),uuid=require("node-uuid");function createParam(e,n){return{appVersion:Editor.App.version,versionCode:"v1",uniqueID:n.uid,appID:"681395864",channelID:"100000",platform:"darwin"===process.platform?"Mac":"Windows",engine:"electron",userID:n.uid,resolution:"unknown",osVersion:require("os").release(),language:"unknown",manufacturer:"",store:"unknown",age:0,sex:0,callNumber:"unknown",model:null,msgID:uuid.v4(),chargeTime:String(Date.now()/1e3|0),language:Editor.I18n.getLanguage()||"unknown",confinfo:"creator.cocos.com"}}function sendData(e,n=!1){https.get(e,e=>{e.on("data",e=>{n&&console.log("receive analytics data --\x3e",e.toString())})}).on("error",e=>{n&&console.error("send analytics data fail",e)})}class CocosMetricsObserver extends metrics_observer_base_1.MetricsObserverBase{constructor(){super(),this._caURL="https://logstorage.cocos.com/log/v2?"}trackEvent(e,n){n.cid?e.sendToCocosAnalyticsOnly?this.trackCocosEvent(e,n):this.trackNormalEvent(e,n):console.warn("Metrics: no valid client ID")}trackNormalEvent(e,n){const t=Object.assign({},e.opts||{});t.action=e.action,e.label&&(t.label=e.label);let o="succeed";e.opts&&e.opts.eventTag&&(o=e.opts.eventTag,delete t.eventTag);const a=createParam(e,n);a.eventID=e.category,a.eventValue=t,a.eventTag=o,e.exitTag&&(a.exitTag=e.exitTag,a.eventTag=e.exitTag),e.onlineDuration&&(a.onlineDuration=e.onlineDuration),delete e.onlineDuration,n.debug&&console.log("send analytics ---\x3e",JSON.stringify(a)),sendData(this._caURL+encodeURIComponent(encrypt.encryptPostData(JSON.stringify(a))),n.debug)}trackCocosEvent(e,n){if(!e.eventId)return void console.error("Metrics: no valid eventId");delete e.sendToCocosAnalyticsOnly;const t=createParam(e,n);e.store&&(t.store=e.store,delete e.store),e.packageName&&(t.packageName=e.packageName,delete e.packageName);let o=e.eventId;delete e.eventId,t.eventID=o,t.eventValue=e,t.eventTag="succeed",e.onlineDuration&&(t.onlineDuration=e.onlineDuration),delete e.onlineDuration,n.debug&&console.log("send analytics ---\x3e",JSON.stringify(t)),sendData(this._caURL+encodeURIComponent(encrypt.encryptPostData(JSON.stringify(t))),n.debug)}trackException(e,n){if(!n.cid)return void console.warn("Metrics: no valid client ID");const t=createParam({},n);t.eventID="exception",t.eventValue={code:e.code,desc:e.message},t.eventTag="succeed",sendData(this._caURL+encodeURIComponent(JSON.stringify(t)))}sendAppInfo(e){}}module.exports=new CocosMetricsObserver;