"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.trackException=exports.trackEvent=exports.init=exports.removeAllMetricsObservers=exports.removeMetricsObserver=exports.addMetricsObserver=void 0;const electron_1=require("electron"),utils_1=require("./utils"),setting=require("@editor/setting"),user=require("@editor/user");let _metricsObservers=[],_clientID="",_userID="",_metricsDebugMode=!1;function addMetricsObserver(e){_metricsObservers.includes(e)||_metricsObservers.push(e)}function removeMetricsObserver(e){const r=_metricsObservers.indexOf(e);r<0||_metricsObservers.splice(r,1)}function removeAllMetricsObservers(){_metricsObservers=[]}async function init(){_clientID=await utils_1.getClientID();const e=await Editor.User.getData();_userID=e&&e.cocos_uid?e.cocos_uid:"-1",_metricsDebugMode=await Editor.Profile.getConfig("utils","features.analytics-debug"),addMetricsObserver(require("./observers/google-metrics-observer")),addMetricsObserver(require("./observers/cocos-metrics-observer"));const r={cid:_clientID,uid:_userID,debug:_metricsDebugMode||!1};_metricsObservers.forEach(e=>{e.sendAppInfo(r)})}function trackEvent(e){const r={cid:_clientID,uid:_userID,debug:_metricsDebugMode||!1};e.sendToCocosAnalyticsOnly||delete e.sendToCocosAnalyticsOnly,_metricsObservers.forEach(t=>{t.trackEvent(e,r)})}function trackException(e){const r={cid:_clientID,uid:_userID,debug:_metricsDebugMode||!1};_metricsObservers.forEach(t=>{t.trackException(e,r)})}exports.addMetricsObserver=addMetricsObserver,exports.removeMetricsObserver=removeMetricsObserver,exports.removeAllMetricsObservers=removeAllMetricsObservers,exports.init=init,exports.trackEvent=trackEvent,exports.trackException=trackException,electron_1.ipcMain.on("metrics:track-event",(e,r)=>{trackEvent(r)}),electron_1.ipcMain.on("metrics:track-exception",(e,r)=>{trackException(r)});