"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),Profile=require("@base/electron-profile"),profile=Profile.load("global://editor/user.json"),ipc=require("@base/electron-base-ipc"),index_1=require("./login-panel/index");window.customElements.define("login-panel",index_1.Login);const flag="editor-lib-user";class UserManager extends events_1.EventEmitter{constructor(){if(super(),this.isReady=!1,!window.__MAIN__)return;ipc.sendSync(`${flag}:check-skip-init`)||this._init()}_init(){this.isReady||(this.isReady=!0,this._panel=document.createElement("login-panel"),this._panel.loading=!0,this._panel.hidden=!0,document.body.prepend(this._panel),this.isLoggedIn().then(e=>{this._panel.loading=!1,e?ipc.send(`${flag}:call`,"nextInit"):this._panel.hidden=!1}).catch(e=>{console.warn(e),this._panel.loading=!1,this._panel.hidden=!1}),this.on("login",()=>{this._panel.loading=!1,this.hideMask()}),this.on("logout",()=>{this._panel.loading=!1,this.showMask()}))}skip(){ipc.send(`${flag}:call`,"skip")}showMask(){ipc.send(`${flag}:call`,"showMask")}hideMask(){ipc.send(`${flag}:call`,"hideMask")}getData(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"getData").callback((i,s)=>i?n(i):e(s))})}async isLoggedIn(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"isLoggedIn").callback((i,s)=>i?n(i):e(s))})}async login(e,n){return new Promise((i,s)=>{ipc.send(`${flag}:call`,"login",e,n).callback((e,n)=>e?s(e):i(n))})}async logout(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"logout").callback((i,s)=>i?n(i):e(s))})}async getUserToken(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"getUserToken").callback((i,s)=>i?n(i):e(s))})}async getSessionCode(e){return new Promise((n,i)=>{ipc.send(`${flag}:call`,"getSessionCode",e).callback((e,s)=>e?i(e):n(s))})}}let user=module.exports=new UserManager;ipc.on(`${flag}:emit`,(e,n,...i)=>{user.emit(n,...i)}),window.__MAIN__&&(ipc.on(`${flag}:showMask`,(e,n,...i)=>{user._panel.hidden=!1}),ipc.on(`${flag}:hideMask`,(e,n,...i)=>{user._panel.hidden=!0}),ipc.on(`${flag}:init`,async()=>{user._init()}));