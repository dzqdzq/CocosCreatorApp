"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Login=void 0;const fs=require("fs-extra"),path=require("path"),{shell:shell}=require("electron"),ipc=require("@base/electron-base-ipc"),STYLE=`<style>${fs.readFileSync(path.join(__dirname,"./panel.css"),"utf8")}</style>`,HTML=`${fs.readFileSync(path.join(__dirname,"./panel.html"),"utf8")}`,flag="editor-lib-user",queryElements={username:"#username",password:"#password",error:".error",forget:".forget",register:".register",login:".login",skip:".skip",loading:".loading"};class Login extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML=`${STYLE}${HTML}`,this.$={},Object.keys(queryElements).forEach(e=>{this.$[e]=this.shadowRoot.querySelector(queryElements[e])}),this.$.username.addEventListener("focus",()=>{this.$.error.innerHTML=""}),this.$.password.addEventListener("focus",()=>{this.$.error.innerHTML=""}),this.$.username.addEventListener("keydown",e=>{13===e.keyCode&&this.$.password.focus(),9===e.keyCode&&(e.stopPropagation(),e.preventDefault(),this.$.password.focus())}),this.$.password.addEventListener("keydown",e=>{if(13===e.keyCode){const e=document.createEvent("HTMLEvents");e.initEvent("click",!1,!1),this.$.login.dispatchEvent(e)}9===e.keyCode&&(e.stopPropagation(),e.preventDefault(),this.$.username.focus())}),this.$.forget.addEventListener("click",()=>{shell.openExternal("https://auth.cocos.com/#/find_password?from=creator3d&version="+Editor.App.version),shell.beep()}),this.$.register.addEventListener("click",()=>{shell.openExternal("https://auth.cocos.com/#/sign_up/register?from=creator3d&version="+Editor.App.version),shell.beep()}),this.$.login.addEventListener("click",async()=>{const e=this.$.username.value,t=this.$.password.value;this.loading=!0;try{await Editor.User.login(e,t)}catch(e){return this.$.error.innerHTML=e,this.loading=!1,void(this.$.skip.style.display="block")}ipc.send(`${flag}:call`,"nextInit")}),this.$.skip.addEventListener("click",async()=>{ipc.send(`${flag}:call`,"nextInit"),Editor.User.skip()}),window.navigator.onLine||(this.$.skip.style.display="block"))}get loading(){return null!==this.getAttribute("loading")}set loading(e){e?this.setAttribute("loading",""):this.removeAttribute("loading")}connectedCallback(){}disconnectedCallback(){}dispatch(e,t){const s=document.createEvent("HTMLEvents");s.initEvent(e,!0,!0),this.dispatchEvent(s)}}exports.Login=Login;