"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),Vue=require("vue/dist/vue"),lodash=require("lodash");exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./engine.css"),"utf8"),exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/contributions/preferences-engine.html"),"utf8"),exports.$={engine:".custom-engine"};const component={data:{config:null,types:{"javascript.builtin":"global","javascript.custom":"global","native.builtin":"global"},showRestartInfo:!1},watch:{"config.javascript.builtin":{async handler(e){const i=this;e&&(lodash.set(i.config,"native.builtin",!0),await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.native.builtin`,!0,i.types["native.builtin"]))},deep:!0},"config.javascript.custom":{handler(e){e.startsWith("project://")&&(e=Editor.UI.File.resolveToRaw(e)),this.config.native.custom=e?(0,path_1.join)(e,"./native"):""},deep:!0}},methods:{async onConfirm(e){const i=this,t=e.target.getAttribute("path");let n=e.target.value;"javascript.builtin"===t?n=!i.config.javascript.builtin:"native.builtin"===t&&(n=!i.config.native.builtin),lodash.set(i.config,t,n),await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`,n,i.types[t]),i.showRestartInfo=await compareEngineInfo(i.config)},async refresh(e){const i=this,t=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${e}`,"local");i.types[e]=void 0!==t&&null!==t?"local":"global"},onChangePosition(e,i,t){const n=this;Editor.Menu.popup({x:e,y:i,menu:[{label:Editor.I18n.t("preferences.menu.move_local"),enabled:"global"===n.types[t],async click(){const e=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`);if(await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`,e),n.refresh(t),"javascript.builtin"===t){const e=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.javascript.custom`);await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.javascript.custom`,e),n.refresh("javascript.custom")}}},{label:Editor.I18n.t("preferences.menu.move_global"),enabled:"local"===n.types[t],async click(){const e=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`,"local");if(await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`,e,"global"),await Editor.Profile.removeConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.${t}`,n.types[t]),n.refresh(t),"javascript.builtin"===t){const e=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.javascript.custom`,"local");await Editor.Profile.setConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.javascript.custom`,e,"global"),await Editor.Profile.removeConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}.javascript.custom`,n.types["javascript.custom"]),n.refresh("javascript.custom")}}}]})}}};async function ready(){component.el=this.$.engine;const e=new Vue(component);e.config=await Editor.Profile.getConfig("engine",`engine.${Editor.App.version.replace(/\./g,"")}`),e.$set(e.config.javascript,"path",(0,path_1.join)(Editor.App.path,"../resources/3d/engine")),e.$set(e.config.native,"path",(0,path_1.join)(Editor.App.path,"../resources/3d/engine/native"));for(const i of Object.keys(e.types))await e.refresh(i)}async function compareEngineInfo(e){try{const i=await Editor.Message.request("engine","query-engine-info"),t="builtin"===i.typescript.type,n=i.typescript.path,o="builtin"===i.native.type;if(t!==e.javascript.builtin||o!==e.native.builtin||!t&&n!==e.javascript.custom)return!0}catch(e){console.error(e)}return!1}exports.ready=ready;