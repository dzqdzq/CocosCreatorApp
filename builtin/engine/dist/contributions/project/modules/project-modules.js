"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),Vue=require("vue/dist/vue");exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./project-modules.css"),"utf8"),exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../../../static/contributions/project-modules.html"),"utf8"),exports.$={modules:".modules"};const component={data:{all:!0,modulesDump:null,moduleCache:{},categories:{},noDeprecatedFeatures:{value:!1,version:""}},methods:{t:e=>e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):"",async refresh(){const e=this;e.noDeprecatedFeatures=await Editor.Profile.getProject("engine","modules.noDeprecatedFeatures");const t=await Editor.Message.request("engine","query-info",Editor.Project.type),o=fs_extra_1.readJSONSync(path_1.join(t.path,"editor","engine-features","render-config.json"));e.categories=o.categories||{};const r=o.features,s=await Editor.Profile.getProject("engine","modules.cache");e.all=!Object.keys(r).some(e=>s[e]&&!s[e]._value);const a={default:{}};Object.entries(r).forEach(([e,t])=>{if(t.category)return a[t.category]||(a[t.category]={}),void(a[t.category][e]=t);a.default[e]=t}),e.modulesDump=a,e.moduleCache=s},async save(){const e=this;let t=!0;const o=[];Object.values(e.modulesDump).forEach(r=>(function r(s){Object.keys(s).forEach(a=>{const n=s[a];if(n.options&&n.multi)return r(n.options);const i=e.moduleCache[a];(i||n.default)&&(!n.default||i?(i._value||(t=!1),i._option?i._value&&o.push(i._option):i._value&&o.push(a)):o.push(n.default[0]))})})(r)),e.all=t,Editor.Profile.setProject("engine","modules.cache",e.moduleCache),Editor.Profile.setProject("engine","modules.includeModules",o),Editor.Profile.setProject("engine","modules.noDeprecatedFeatures",e.noDeprecatedFeatures),Editor.Message.broadcast("engine:modules-changed")},onDeprecatedAPI(e,t){this.noDeprecatedFeatures[e]=t},_onConfirm(){const e=this;clearTimeout(e.saveTimer),e.saveTimer=setTimeout(()=>{e.save()},200)},_onSelectAllChanged(e){const t=this.moduleCache;Object.values(this.modulesDump).forEach(function o(r){Object.keys(r).forEach(s=>{const a=r[s];a.options&&!1!==a.multi&&o(a.options),a.required||(t[s]||(t[s]={_value:e.target.value}),t[s]._value=e.target.value)})}),this._onConfirm()}},components:{"module-item":require("./module-item")}};async function ready(){component.el=this.$.modules,new Vue(component).refresh()}exports.ready=ready;