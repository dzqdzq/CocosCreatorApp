"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importConfig=exports.exportConfig=exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),Vue=require("vue/dist/vue.js");let vueInstance;exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./project-modules.css"),"utf8"),exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static/contributions/project-modules.html"),"utf8"),exports.$={modules:".modules"};const component={data:{all:!0,modulesDump:null,moduleCache:{},categories:{},noDeprecatedFeatures:{value:!1,version:""}},methods:{t:e=>e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):"",async refresh(){const e=this;e.noDeprecatedFeatures=await Editor.Profile.getProject("engine","modules.noDeprecatedFeatures");const t=await Editor.Message.request("engine","query-engine-info"),o=(0,fs_extra_1.readJSONSync)((0,path_1.join)(t.typescript.path,"editor","engine-features","render-config.json"));e.categories=o.categories||{};const s=o.features,r=await Editor.Profile.getProject("engine","modules.cache");e.all=!Object.keys(s).some(e=>r[e]&&!r[e]._value);const a={default:{}};Object.entries(s).forEach(([e,t])=>{if(t.category)return a[t.category]||(a[t.category]={}),void(a[t.category][e]=t);a.default[e]=t}),e.modulesDump=a,e.moduleCache=r},async save(){const e=this;let t=!0;const o=[],s={};Object.values(e.modulesDump).forEach(r=>(function r(a){Object.keys(a).forEach(n=>{const i=a[n];if(i.options&&i.multi)return r(i.options);const c=e.moduleCache[n];c.flags&&(s[n]=c.flags),(c||i.default)&&(!i.default||c?(c._value||(t=!1),c._option?c._value&&o.push(c._option):c._value&&o.push(n)):o.push(i.default[0]))})})(r)),e.all=t,Editor.Profile.setProject("engine","modules.cache",e.moduleCache),Editor.Profile.setProject("engine","modules.flags",s),Editor.Profile.setProject("engine","modules.includeModules",o.sort()),Editor.Profile.setProject("engine","modules.noDeprecatedFeatures",e.noDeprecatedFeatures),Editor.Message.broadcast("engine:modules-changed")},onDeprecatedAPI(e,t){this.noDeprecatedFeatures[e]=t},_onConfirm(){const e=this;clearTimeout(e.saveTimer),e.saveTimer=setTimeout(()=>{e.save()},200)},_onSelectAllChanged(e){const t=this.moduleCache;Object.values(this.modulesDump).forEach(function o(s){Object.keys(s).forEach(r=>{const a=s[r];a.options&&!1!==a.multi&&o(a.options),a.required||(t[r]||(t[r]={_value:e.target.value}),t[r]._value=e.target.value)})}),this._onConfirm()}},components:{"module-item":require("./module-item")}};async function ready(){component.el=this.$.modules,(vueInstance=new Vue(component)).refresh(),Editor.Message.__protected__.addBroadcastListener("project:engine-modules-changed",vueInstance.refresh)}function close(){vueInstance&&Editor.Message.__protected__.removeBroadcastListener("project:engine-modules-changed",vueInstance.refresh)}async function exportConfig(){const e={};return e["modules.cache"]=await Editor.Message.request("project","query-config","engine","modules.cache")||{},e["modules.flags"]=await Editor.Message.request("project","query-config","engine","modules.flags")||{},e["modules.includeModules"]=await Editor.Message.request("project","query-config","engine","modules.includeModules")||[],e["modules.noDeprecatedFeatures"]=await Editor.Message.request("project","query-config","engine","modules.cache")||{},e}async function importConfig(e){e["modules.cache"]&&await Editor.Message.request("project","set-config","engine","modules.cache",e["modules.cache"]),e["modules.flags"]&&await Editor.Message.request("project","set-config","engine","modules.flags",e["modules.flags"]),e["modules.includeModules"]&&await Editor.Message.request("project","set-config","engine","modules.includeModules",e["modules.includeModules"]),e["modules.noDeprecatedFeatures"]&&await Editor.Message.request("project","set-config","engine","modules.noDeprecatedFeatures",e["modules.noDeprecatedFeatures"])}exports.ready=ready,exports.close=close,exports.exportConfig=exportConfig,exports.importConfig=importConfig;