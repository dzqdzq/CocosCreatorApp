"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.$=exports.template=exports.style=void 0;const Vue=require("vue/dist/vue"),utils_1=require("./utils");exports.style="\n.item { display: flex; }\nui-prop { flex: 1; --left-width: 40%; margin-bottom: 4px; }\nui-prop > div {\n    display: flex;\n    overflow: hidden;\n}\nui-prop ui-icon { visibility: hidden; cursor: pointer; opacity: 0.6;margin: 0 2px; }\nui-prop ui-icon:hover { opacity: 1; }\nui-prop:hover ui-icon { visibility: visible; }\n\n.generateMacro > ui-prop > div {\n    padding-left: 32px;\n}\n\n.add { text-align: center; margin: 4px; }\n.add ui-button { width: 90%; }\n\n.danger {\n    border-color: var(--color-danger-fill-weaker);\n}\n\n.error-info {\n    font-size: 0.8em;\n    line-height: 12px;\n    color: var(--color-danger-fill-weaker);\n    margin-bottom: 4px;\n    padding-left: 32px;\n}\n",exports.template='\n<ui-section expand class="modules config">\n    <ui-label slot="header" value="i18n:engine.project.macroConfig.customMacro"></ui-label>\n\n    <template\n        v-for="(item, index) in macro"\n    >\n        <div class="item"\n            :key="index"\n        >\n            <ui-prop>\n                <div slot="label">\n                    <ui-icon value="del"\n                        tooltip="i18n:engine.project.macroConfig.del"\n                        @click="delMacro(item)"\n                    ></ui-icon>\n                    <ui-icon value="edit"\n                        tooltip="i18n:engine.project.macroConfig.edit"\n                        @click="editMacro($event, item.key)"\n                    ></ui-icon>\n                    <ui-label\n                        v-if="item.key !== editName"\n                        :value="item.key"\n                    ></ui-label>\n                    <ui-input\n                        v-else\n                        :class="!!errorInfo ? \'danger\' : \'\'"\n                        :value="item.key"\n                        @change="changeMacroName($event.target.value)"\n                        @blur="confirmMacroName(item, $event.target.value)"\n                        @keyup.enter.stop="$event.target.blur()"\n                    ></ui-input>\n                </div>\n                <ui-checkbox slot="content"\n                    :value="item.value"\n                    :disabled="item.key === editName && !!errorInfo"\n                    @confirm="toggleMacro(item)"\n                ></ui-checkbox>\n            </ui-prop>\n        </div>\n        <div class="error-info"\n            v-if="item.key === editName && !!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </template>\n    \n    <div class="generateMacro"\n        v-show="generateMacro"\n    >\n        <ui-prop>\n            <div slot="label">\n                <ui-input ref="addInput"\n                    :class="!!errorInfo ? \'danger\' : \'\'"\n                    @change="changeMacroName($event.target.value)"\n                    @blur="confirmNewMacro"\n                    @keyup.enter.stop="$event.target.blur()"\n                ></ui-input>\n            </div>\n            <ui-checkbox slot="content" disabled></ui-checkbox>\n        </ui-prop>\n        <div class="error-info"\n            v-if="!!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </div>\n\n    <div class="add">\n        <ui-button\n            tooltip="i18n:engine.project.macroConfig.add"\n            @confirm="addMacro"\n        >\n            <ui-icon value="add"></ui-icon>\n        </ui-button>\n    </div>\n</ui-section>\n',exports.$={modules:".modules"};const component={data:{generateMacro:!1,macro:[],editName:"",errorInfo:""},methods:{t:e=>e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):"",async refresh(){this.editName=this.errorInfo="";const e=await Editor.Profile.getProject("engine","macroCustom");this.macro=e},async save(){await Editor.Profile.setProject("engine","macroCustom",this.macro)},addMacro(){const e=this;e.errorInfo="",e.$refs.addInput.value="",e.generateMacro=!0,requestAnimationFrame(()=>{e.$refs.addInput.focus()})},editMacro(e,n){this.editName=n,this.errorInfo="";const o=e.target.parentElement.parentElement;requestAnimationFrame(()=>{o.querySelector("ui-input").focus()})},async delMacro(e){const n=this;if(0===(await Editor.Dialog.info(Editor.I18n.t("engine.project.macroConfig.delete.msg",{name:e.key}),{title:Editor.I18n.t("engine.project.macroConfig.delete.title"),buttons:[Editor.I18n.t("engine.project.macroConfig.delete.confirm"),Editor.I18n.t("engine.project.macroConfig.delete.cancel")],default:0,cancel:1})).response){const o=n.macro.indexOf(e);o>=0&&(n.macro.splice(o,1),n.save())}},confirmNewMacro(){const e=this;e.generateMacro=!1;const n=e.$refs.addInput.value;e.$refs.addInput.value="",n&&!e.errorInfo&&(e.macro.push({key:n,value:!1}),e.editName="",e.save())},toggleMacro(e){e.value=!e.value,this.save()},changeMacroName(e){const n=this,o=(0,utils_1.checkMacro)(n.macro,e);o.value?n.errorInfo="":n.errorInfo=o.msg},confirmMacroName(e,n){this.editName="",this.errorInfo||e.key===n||(e.key=n,this.save())}},components:{}};async function ready(){component.el=this.$.modules;const e=new Vue(component);await e.refresh()}exports.ready=ready;