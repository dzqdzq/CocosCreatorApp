"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importConfig=exports.exportConfig=exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const utils_1=require("./utils"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const vueTemplate='\n<ui-section expand whole class="modules">\n    <ui-label slot="header" value="i18n:engine.project.macroConfig.customMacro"></ui-label>\n\n    <template\n        v-for="(item, index) in macro"\n    >\n        <div class="item"\n            :key="index"\n        >\n            <ui-prop>\n                <div slot="label"\n                    :editing="item.key === editName"\n                >\n                    <ui-label\n                        :value="item.key"\n                    ></ui-label>\n                    <ui-input\n                        :class="!!errorInfo ? \'danger\' : \'\'"\n                        :value="item.key"\n                        @change="changeMacroName($event.target.value)"\n                        @blur="confirmMacroName(item, $event.target.value)"\n                        @keyup.enter.stop="$event.target.blur()"\n                    ></ui-input>\n                    <ui-button class="btn transparent" type="icon"\n                        tooltip="i18n:engine.project.macroConfig.edit"\n                        @click="editMacro($event, item.key)"\n                    >\n                        <ui-icon value="edit"></ui-icon>\n                    </ui-button>\n                    <ui-button class="btn transparent" type="icon"\n                        tooltip="i18n:engine.project.macroConfig.del"\n                        @click="delMacro(item)"\n                    >\n                        <ui-icon color="true" value="del"></ui-icon>\n                    </ui-button>\n                </div>\n                <ui-checkbox slot="content"\n                    :value="item.value"\n                    :disabled="item.key === editName && !!errorInfo"\n                    @confirm="toggleMacro(item)"\n                ></ui-checkbox>\n            </ui-prop>\n        </div>\n        <div class="error-info"\n            v-if="item.key === editName && !!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </template>\n    \n    <div class="generateMacro"\n        v-show="generateMacro"\n    >\n        <ui-prop>\n            <div slot="label" editing>\n                <ui-input ref="addInput"\n                    :class="!!errorInfo ? \'danger\' : \'\'"\n                    @change="changeMacroName($event.target.value)"\n                    @blur="confirmNewMacro"\n                    @keyup.enter.stop="$event.target.blur()"\n                ></ui-input>\n            </div>\n            <ui-checkbox slot="content" disabled></ui-checkbox>\n        </ui-prop>\n        <div class="error-info"\n            v-if="!!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </div>\n\n    <div class="add">\n        <ui-button class="blue"\n            @confirm="addMacro"\n        >\n            <ui-icon value="add"></ui-icon>\n            <ui-label value="i18n:engine.project.macroConfig.add"></ui-label>\n        </ui-button>\n    </div>\n</ui-section>\n',EngineProjectMacroVM=Vue.extend({data:()=>({generateMacro:!1,macro:[],editName:"",errorInfo:""}),methods:{t:e=>e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):"",async refresh(){this.editName=this.errorInfo="";const e=await Editor.Profile.getProject("engine","macroCustom");this.macro=e},async save(){await Editor.Profile.setProject("engine","macroCustom",this.macro)},addMacro(){this.errorInfo="";const e=this.$refs.addInput;e.value="",this.generateMacro=!0,requestAnimationFrame(()=>{e.focus()})},editMacro(e,n){var i;this.editName=n,this.errorInfo="";const o=null===(i=e.target.parentElement)||void 0===i?void 0:i.parentElement;requestAnimationFrame(()=>{if(o){const e=o.querySelector("ui-input");e&&e.focus()}})},async delMacro(e){if(0===(await Editor.Dialog.info(Editor.I18n.t("engine.project.macroConfig.delete.msg",{name:e.key}),{title:Editor.I18n.t("engine.project.macroConfig.delete.title"),buttons:[Editor.I18n.t("engine.project.macroConfig.delete.confirm"),Editor.I18n.t("engine.project.macroConfig.delete.cancel")],default:0,cancel:1})).response){const n=this.macro.indexOf(e);n>=0&&(this.macro.splice(n,1),this.save())}},confirmNewMacro(){this.generateMacro=!1;const e=this.$refs.addInput,n=e.value;e.value="",n&&!this.errorInfo&&(this.macro.push({key:n,value:!1}),this.editName="",this.save())},toggleMacro(e){e.value=!e.value,this.save()},changeMacroName(e){const n=(0,utils_1.checkMacro)(this.macro,e);n.value||!n.msg?this.errorInfo="":this.errorInfo=n.msg},confirmMacroName(e,n){this.editName="",this.errorInfo||e.key===n||(e.key=n,this.save())}},template:vueTemplate});async function ready(){this.vm=new EngineProjectMacroVM,this.vm.$mount(this.$.container),await this.vm.refresh()}function close(){var e;null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=null}async function exportConfig(){const e={};return e.macroCustom=await Editor.Message.request("project","query-config","engine","macroCustom")||[],e}async function importConfig(e){e.macroCustom&&await Editor.Message.request("project","set-config","engine","macroCustom",e.macroCustom)}exports.style="\n.modules { margin-top: 2em; }\n.modules .item { display: flex; margin: 4px 0; }\n.modules .item:hover ui-prop > div:not([editing]) > .btn { display: flex; }\n.modules ui-prop { flex: 1; --left-width: 40%; }\n.modules ui-prop > div { display: flex; flex: 1; }\n\n.modules ui-prop > div ui-input { display: none; }\n\n.modules ui-prop > div[editing] ui-input { display: flex; }\n\n.modules ui-prop > div[editing] ui-label,\n.modules ui-prop > div[editing] ui-button { display: none; }\n\n.modules ui-prop > div > ui-label,\n.modules ui-prop > div > ui-input { flex: 1; }\n\n.modules ui-prop > div > ui-input.danger { border-color: var(--color-danger-fill-weaker); }\n.modules ui-prop > div > .btn { display: none; margin: 0 4px; }\n.modules .add { margin-top: 1em; }\n.modules .add > ui-button { width: 200px; }\n.modules .add > ui-button > ui-icon { margin-right: 8px; }\n\n.modules .error-info {\n    color: var(--color-danger-fill-weaker);\n    margin-bottom: 4px;\n}\n",exports.template='<div class="container"></div>',exports.$={container:".container"},exports.ready=ready,exports.close=close,exports.exportConfig=exportConfig,exports.importConfig=importConfig;