"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importConfig=exports.exportConfig=exports.ready=exports.$=exports.template=exports.style=void 0;const Vue=require("vue/dist/vue.js"),utils_1=require("./utils");exports.style="\n.modules { margin-top: 2em; }\n.modules .item { display: flex; margin: 4px 0; }\n.modules .item:hover ui-prop > div:not([editing]) > .btn { display: flex; }\n.modules ui-prop { flex: 1; --left-width: 40%; }\n.modules ui-prop > div { display: flex; flex: 1; }\n\n.modules ui-prop > div ui-input { display: none; }\n\n.modules ui-prop > div[editing] ui-input { display: flex; }\n\n.modules ui-prop > div[editing] ui-label,\n.modules ui-prop > div[editing] ui-button { display: none; }\n\n.modules ui-prop > div > ui-label,\n.modules ui-prop > div > ui-input { flex: 1; }\n\n.modules ui-prop > div > ui-input.danger { border-color: var(--color-danger-fill-weaker); }\n.modules ui-prop > div > .btn { display: none; margin: 0 4px; }\n.modules .add { margin-top: 1em; }\n.modules .add > ui-button { width: 200px; }\n.modules .add > ui-button > ui-icon { margin-right: 8px; }\n\n.modules .error-info {\n    color: var(--color-danger-fill-weaker);\n    margin-bottom: 4px;\n}\n",exports.template='\n<ui-section expand whole class="modules">\n    <ui-label slot="header" value="i18n:engine.project.macroConfig.customMacro"></ui-label>\n\n    <template\n        v-for="(item, index) in macro"\n    >\n        <div class="item"\n            :key="index"\n        >\n            <ui-prop>\n                <div slot="label"\n                    :editing="item.key === editName"\n                >\n                    <ui-label\n                        :value="item.key"\n                    ></ui-label>\n                    <ui-input\n                        :class="!!errorInfo ? \'danger\' : \'\'"\n                        :value="item.key"\n                        @change="changeMacroName($event.target.value)"\n                        @blur="confirmMacroName(item, $event.target.value)"\n                        @keyup.enter.stop="$event.target.blur()"\n                    ></ui-input>\n                    <ui-button class="btn transparent" type="icon"\n                        tooltip="i18n:engine.project.macroConfig.edit"\n                        @click="editMacro($event, item.key)"\n                    >\n                        <ui-icon value="edit"></ui-icon>\n                    </ui-button>\n                    <ui-button class="btn transparent" type="icon"\n                        tooltip="i18n:engine.project.macroConfig.del"\n                        @click="delMacro(item)"\n                    >\n                        <ui-icon color="true" value="del"></ui-icon>\n                    </ui-button>\n                </div>\n                <ui-checkbox slot="content"\n                    :value="item.value"\n                    :disabled="item.key === editName && !!errorInfo"\n                    @confirm="toggleMacro(item)"\n                ></ui-checkbox>\n            </ui-prop>\n        </div>\n        <div class="error-info"\n            v-if="item.key === editName && !!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </template>\n    \n    <div class="generateMacro"\n        v-show="generateMacro"\n    >\n        <ui-prop>\n            <div slot="label" editing>\n                <ui-input ref="addInput"\n                    :class="!!errorInfo ? \'danger\' : \'\'"\n                    @change="changeMacroName($event.target.value)"\n                    @blur="confirmNewMacro"\n                    @keyup.enter.stop="$event.target.blur()"\n                ></ui-input>\n            </div>\n            <ui-checkbox slot="content" disabled></ui-checkbox>\n        </ui-prop>\n        <div class="error-info"\n            v-if="!!errorInfo"\n        >\n            <ui-label\n                :value="errorInfo"\n            ></ui-label>\n        </div>\n    </div>\n\n    <div class="add">\n        <ui-button class="blue"\n            @confirm="addMacro"\n        >\n            <ui-icon value="add"></ui-icon>\n            <ui-label value="i18n:engine.project.macroConfig.add"></ui-label>\n        </ui-button>\n    </div>\n</ui-section>\n',exports.$={modules:".modules"};const component={data:{generateMacro:!1,macro:[],editName:"",errorInfo:""},methods:{t:e=>e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):"",async refresh(){this.editName=this.errorInfo="";const e=await Editor.Profile.getProject("engine","macroCustom");this.macro=e},async save(){await Editor.Profile.setProject("engine","macroCustom",this.macro)},addMacro(){const e=this;e.errorInfo="",e.$refs.addInput.value="",e.generateMacro=!0,requestAnimationFrame(()=>{e.$refs.addInput.focus()})},editMacro(e,n){this.editName=n,this.errorInfo="";const o=e.target.parentElement.parentElement;requestAnimationFrame(()=>{o.querySelector("ui-input").focus()})},async delMacro(e){const n=this;if(0===(await Editor.Dialog.info(Editor.I18n.t("engine.project.macroConfig.delete.msg",{name:e.key}),{title:Editor.I18n.t("engine.project.macroConfig.delete.title"),buttons:[Editor.I18n.t("engine.project.macroConfig.delete.confirm"),Editor.I18n.t("engine.project.macroConfig.delete.cancel")],default:0,cancel:1})).response){const o=n.macro.indexOf(e);o>=0&&(n.macro.splice(o,1),n.save())}},confirmNewMacro(){const e=this;e.generateMacro=!1;const n=e.$refs.addInput.value;e.$refs.addInput.value="",n&&!e.errorInfo&&(e.macro.push({key:n,value:!1}),e.editName="",e.save())},toggleMacro(e){e.value=!e.value,this.save()},changeMacroName(e){const n=this,o=(0,utils_1.checkMacro)(n.macro,e);o.value?n.errorInfo="":n.errorInfo=o.msg},confirmMacroName(e,n){this.editName="",this.errorInfo||e.key===n||(e.key=n,this.save())}},components:{}};async function ready(){component.el=this.$.modules;const e=new Vue(component);await e.refresh()}async function exportConfig(){const e={};return e.macroCustom=await Editor.Message.request("project","query-config","engine","macroCustom")||[],e}async function importConfig(e){e.macroCustom&&await Editor.Message.request("project","set-config","engine","macroCustom",e.macroCustom)}exports.ready=ready,exports.exportConfig=exportConfig,exports.importConfig=importConfig;