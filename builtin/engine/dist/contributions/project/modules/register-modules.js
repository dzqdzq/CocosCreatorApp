"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initEngineModules=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function initEngineModules(e){const t=path_1.join(e,"editor","engine-features","render-config.json");if(!fs_extra_1.existsSync(t))return void console.error("render-config.json is not exist in engine!");const o=fs_extra_1.readJSONSync(t);if(!o||!o.features)return void console.error("render-config.json is not exist in engine!");const n={},i={},s=[];function r(e,t){n[t]={_value:!!e.default},e.default?s.push(...e.default):e.required&&(s.push(t),n[t]._value=!0),e.native&&(i[t]={native:e.native})}Object.keys(o.features).forEach(e=>{const t=o.features[e];r(t,e),t.options&&(t.multi?Object.keys(t.options).forEach(o=>{r(t.options[o],o),t.default&&!t.default.includes(o)&&(n[e]._value=!1)}):(t.default&&(n[e]._option=t.default[0]),Object.keys(t.options).forEach(e=>{r(t.options[e],e)})))}),await Editor.Profile.setProject("engine","modules.includeModules",Array.from(new Set(s)),"default"),await Editor.Profile.setConfig("engine","modules.moduleConfig",i,"default"),await Editor.Profile.setProject("engine","modules.cache",n,"default");const u=await Editor.Profile.getProject("engine","modules.includeModules","project");if(u&&u.length){const e=await Editor.Profile.getProject("engine","modules.cache"),t=[];!function o(n){Object.keys(n).forEach(i=>{const s=n[i];if(s.options&&s.multi)return o(s.options);const r=e[i];(r||s.default)&&(!s.default||r?r._option?r._value&&t.push(r._option):r._value&&t.push(i):t.push(s.default[0]))})}(o.features),await Editor.Profile.setProject("engine","modules.includeModules",Array.from(new Set(t)))}}exports.initEngineModules=initEngineModules;