"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initEngineModules=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function initEngineModules(e){const t=path_1.join(e,"editor","engine-features","render-config.json");if(!fs_extra_1.existsSync(t))return void console.error("render-config.json is not exist in engine!");const o=fs_extra_1.readJSONSync(t);if(!o||!o.features)return void console.error("render-config.json is not exist in engine!");const n={},i={},r=[];function s(e,t){n[t]={_value:!!e.default},e.default?r.push(...e.default):e.required&&(r.push(t),n[t]._value=!0),e.native&&(i[t]={native:e.native})}Object.keys(o.features).forEach(e=>{const t=o.features[e];s(t,e),t.options&&(t.multi?Object.keys(t.options).forEach(o=>{s(t.options[o],o),t.default&&!t.default.includes(o)&&(n[e]._value=!1)}):t.default&&(n[e]._option=t.default[0]))}),await Editor.Profile.setProject("engine","modules.includeModules",Array.from(new Set(r)),"default"),await Editor.Profile.setConfig("engine","modules.moduleConfig",i,"default"),await Editor.Profile.setProject("engine","modules.cache",n,"default");const u=await Editor.Profile.getProject("engine","modules.includeModules","project");if(u&&u.length){const e=await Editor.Profile.getProject("engine","modules.cache"),t=[];!function o(n){Object.keys(n).forEach(i=>{const r=n[i];if(r.options&&r.multi)return o(r.options);const s=e[i];(s||r.default)&&(!r.default||s?s._option?s._value&&t.push(s._option):s._value&&t.push(i):t.push(r.default[0]))})}(o.features),await Editor.Profile.setProject("engine","modules.includeModules",Array.from(new Set(t)))}}exports.initEngineModules=initEngineModules;