"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerMacroConfig=void 0;const path_1=require("path"),ts=__importStar(require("typescript")),fs_1=require("fs"),type2UI={string:"ui-input",number:"ui-num-input",boolean:"ui-checkbox"},ReadonlyKeyList=["SUPPORT_TEXTURE_FORMATS","KEY","RAD","DEG","FLT_EPSILON","ORIENTATION_PORTRAIT","ORIENTATION_LANDSCAPE","ORIENTATION_AUTO","REPEAT_FOREVER"];async function registerMacroConfig(e){const{macro:t}=await Promise.resolve().then(()=>__importStar(require("cc/editor/macro"))),o=Editor.Package.getPackages({name:"engine"});if(o.length<=0)return;const r=o[0];if(!r.info.contributions)return;const n=(0,path_1.join)(e,"cocos/core/platform/macro.ts"),i={},c=Editor.I18n.getLanguage();try{if((0,fs_1.existsSync)(n)){const e=ts.createSourceFile(n,(0,fs_1.readFileSync)(n).toString(),ts.ScriptTarget.Latest,!0).statements.find(e=>ts.isInterfaceDeclaration(e)&&"Macro"===e.name.escapedText);e&&e.members.filter(e=>{var t;return(null===(t=e.jsDoc)||void 0===t?void 0:t.length)&&["en","zh"].every(t=>e.jsDoc[0].tags.some(e=>e.tagName.escapedText===t))}).forEach(e=>{const t=e.jsDoc[0].tags;i[e.name.escapedText]={en:t.find(e=>"en"===e.tagName.escapedText).comment,zh:t.find(e=>"zh"===e.tagName.escapedText).comment}})}}catch(e){console.error(e)}const a=r.info.contributions.project.macroConfig;a.content={};const s={},u={};Object.keys(t).forEach(e=>{var o,r;if(ReadonlyKeyList.includes(e))return;const n=t[e],f=typeof n;["string","number","boolean"].includes(f)&&(s[`macroConfig.${e}`]={label:e,default:n,description:null!==(r=null===(o=null===i||void 0===i?void 0:i[e])||void 0===o?void 0:o[c])&&void 0!==r?r:e},u[e]=n,a.content[`macroConfig.${e}`]={ui:type2UI[f]})}),await Editor.Profile.setProject("engine","macroConfig",u,"default"),r.info.contributions.profile.project||(r.info.contributions.profile.project={}),Object.assign(r.info.contributions.profile.project,s),r.info.contributions.project.macroConfig=a}exports.registerMacroConfig=registerMacroConfig;