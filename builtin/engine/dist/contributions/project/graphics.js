"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),pipeline_1=require("./pipeline"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;const vueTemplate=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/contributions/project-graphics.html"),"utf8"),EngineGraphicsVM=Vue.extend({name:"EngineGraphicsVM",data(){return{customPipeline:!0,renderPipeline:"",renderPipelines:[],pipelineName:"",switchPipelineTipTaskId:0,postProcessRenderConfig:{default:!1,label:"i18n:ENGINE.features.custom_pipeline_post_process.label",description:"i18n:ENGINE.features.custom_pipeline_post_process.description"},includeModules:[]}},async mounted(){this.switchPipelineTipTaskId=await Editor.Profile.getTemp("engine","switchPipelineTipTaskId"),this.pipelineName=await Editor.Profile.getProject("engine","macroConfig.CUSTOM_PIPELINE_NAME");const e=await Editor.Profile.getProject("project","general.renderPipeline");this.renderPipeline=e;var i=await Editor.Profile.getConfig("engine","deferred_pipeline");let t=await Editor.Message.request("asset-db","query-assets",{pattern:"db://**/*.rpp"},["meta"]);if(Array.isArray(t)||(t=[]),!i&&(t=t.filter(e=>"5d45ba66-829a-46d3-948e-2ed3fa7ee421"!==e.uuid),"5d45ba66-829a-46d3-948e-2ed3fa7ee421"===this.renderPipeline)){await Editor.Profile.removeProject("project","general.renderPipeline","project");const e=await Editor.Profile.getProject("project","general.renderPipeline");this.renderPipeline=e}this.renderPipelines=t.map(e=>({uuid:e.uuid,name:e.name,contributed:e.meta&&e.meta.userData&&e.meta.userData.contributed?e.meta.userData.contributed:""}));i=(await Editor.Profile.getProject("engine","modules")).includeModules;this.customPipeline=i.includes("custom-pipeline"),this.includeModules=i},methods:{renderPipelineChanged(e){this.renderPipeline=e.target.value,Editor.Profile.setProject("project","general.renderPipeline",this.renderPipeline)},pipelineNameChange(e){this.pipelineName=e.target.value,Editor.Profile.setProject("engine","macroConfig.CUSTOM_PIPELINE_NAME",this.pipelineName)},postProcessRenderConfigChanged(e){e=e.target.value;Editor.Profile.setProject("engine","modules.cache.custom-pipeline-post-process",{_value:e}),e?this.includeModules.push("custom-pipeline-post-process"):this.includeModules=this.includeModules.filter(e=>"custom-pipeline-post-process"!==e),Editor.Profile.setProject("engine","modules.includeModules",this.includeModules),Editor.Message.broadcast("engine:modules-changed")},async customPipelineChanged(e){var e=e.target.value,i=await Editor.Profile.getConfig("engine","customPipeline","default");null==i&&Editor.Profile.setConfig("engine","customPipeline",this.customPipeline,"default"),this.customPipeline="customPipeline"===e,(this.customPipeline?(0,pipeline_1.afterUseNewPipeline):(0,pipeline_1.afterUseDeprecatedPipeline))(),i!==this.customPipeline&&Editor.Dialog.info(Editor.I18n.t("engine.project.graphics.switchPipelineTips"),{title:Editor.I18n.t("engine.project.graphics.title"),buttons:[Editor.I18n.t("engine.confirm")]})},_onModuleChanged(e,i,t,n){console.log(e,i,t,n)}},template:vueTemplate});async function ready(){panel=this,null!==vm&&void 0!==vm&&vm.$destroy(),(vm=new EngineGraphicsVM).$mount(panel.$.container)}function close(){null!==vm&&void 0!==vm&&vm.$destroy(),vm=null,panel=null}exports.style=`
ui-radio-group {
    width: 100%;
}
.ml {
    margin-left: 40px;
}
div[disabled], ui-prop[disabled] {
    opacity: 0.5;
}

ui-radio-group ui-prop {
    --left-width: 50%;
}
`,exports.template='<div class="container"></div>',exports.$={container:".container"},exports.ready=ready,exports.close=close;