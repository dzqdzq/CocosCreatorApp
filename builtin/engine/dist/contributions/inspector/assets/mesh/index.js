"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.data=exports.watch=exports.methods=exports.props=exports.template=exports.style=void 0;const ElectronModule=require("@base/electron-module"),GlPreview=ElectronModule.require("PreviewExtends").default;let glPreview=new GlPreview("scene:mesh-preview","query-mesh-preview-data");exports.style="\n.asset-mesh {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.asset-mesh > section {\n    flex: 1;\n    overflow: auto;\n}\n\n.asset-mesh > footer {\n    margin-top: 5px;\n    border-top: 1px solid var(--color-normal-border);\n}\n.asset-mesh > footer> .preview-info {\n    padding: 4px 8px;\n}\n.asset-mesh > footer> .preview-info > ui-label {\n    margin-right: 6px;\n}\n\n.asset-mesh > footer > .imageDiv {\n    height: 200px;\n    overflow: hidden;\n    display: flex;\n    flex: 1;\n    margin-right: 10px;\n}\n.asset-mesh > footer > .imageDiv > .image {\n    flex: 1;\n}\n",exports.template='\n<section class="asset-mesh">\n    <section></section>\n    <footer>\n        <div class="preview-info">\n            <ui-label value="Vertices:0" ref="verticesLabel"></ui-label>\n            <ui-label value="Triangles:0" ref="trianglesLabel"></ui-label>\n            <ui-label value="" ref="uvsLabel"></ui-label>\n        </div>\n        <div class="imageDiv" ref="imageDiv">\n            <canvas class="image" ref="image"\n                @mousedown=onPreviewMouseDown($event)\n            ></canvas>\n        </div>\n    </footer>\n</section>\n',exports.props=["info"];const previewConfig={};function data(){return{meta:null,readonly:{value:!0},isPreviewDataDirty:!0}}function mounted(){const e=this;e.info=e.infos[0],e.meta=e.metas[0],e.refresh(),Editor.Message.addBroadcastListener("scene:mesh-preview-mesh-info",e.updateMeshInfo)}function destroyed(){Editor.Message.removeBroadcastListener("scene:mesh-preview-mesh-info",this.updateMeshInfo),Editor.Message.request("scene","hide-mesh-preview")}exports.methods={refresh(){this.isPreviewDataDirty=!0,this.initPreview()},async initPreview(){const e=this;e.$refs.image&&(e.from||(await glPreview.init({width:e.$refs.image.clientWidth,height:e.$refs.image.clientHeight}),await Editor.Message.request("scene","set-mesh-preview-mesh",e.info.uuid),e.$refs.image&&(glPreview.initGL(e.$refs.image,{width:e.$refs.image.clientWidth,height:e.$refs.image.clientHeight}),previewConfig.width=e.$refs.image.clientWidth,previewConfig.height=e.$refs.image.clientHeight,e.updateTask&&(cancelAnimationFrame(e.updateTask),e.updateTask=null),e.update())))},async update(){const e=this,i=e.$refs.image;if(e&&i){if(e.isPreviewDataDirty){i.width=e.$refs.imageDiv.clientWidth,i.height=e.$refs.imageDiv.clientHeight;const t=await glPreview.queryPreviewData({width:e.$refs.imageDiv.clientWidth,height:e.$refs.imageDiv.clientHeight});t.width===previewConfig.width&&t.height===previewConfig.height||(glPreview.resizeGL(t.width,t.height),previewConfig.width=t.width,previewConfig.height=t.height);try{glPreview.drawGL(t.buffer,t.width,t.height)}catch(e){console.warn(e)}e.isPreviewDataDirty=!1}e.updateTask=requestAnimationFrame(async()=>{await e.update()})}else e.updateTask=null},onPreviewMouseDown(e){Editor.Message.request("scene","on-mesh-preview-mouse-down",{x:e.x,y:e.y}),e.target.requestPointerLock(),document.addEventListener("mousemove",this.onPreviewMouseMove),document.addEventListener("mouseup",this.onPreviewMouseUp);this.isPreviewDataDirty=!0},onPreviewMouseMove(e){Editor.Message.request("scene","on-mesh-preview-mouse-move",{movementX:e.movementX,movementY:e.movementY});this.isPreviewDataDirty=!0},onPreviewMouseUp(e){Editor.Message.request("scene","on-mesh-preview-mouse-up",{x:e.x,y:e.y}),document.exitPointerLock(),document.removeEventListener("mousemove",this.onPreviewMouseMove),document.removeEventListener("mouseup",this.onPreviewMouseUp);this.isPreviewDataDirty=!0},updateMeshInfo(e){const i=this;i.$refs.verticesLabel&&(i.$refs.verticesLabel.value="Vertices:"+e.vertices),i.$refs.trianglesLabel&&(i.$refs.trianglesLabel.value="Triangles:"+e.polygons),i.$refs.uvsLabel&&(i.$refs.uvsLabel.value="",e.uvs.length>0&&(i.$refs.uvsLabel.value="UV:",e.uvs.forEach((t,s)=>{i.$refs.uvsLabel.value+=t,s!==e.uvs.length-1&&(i.$refs.uvsLabel.value+=",")}))),i.isPreviewDataDirty=!0}},exports.watch={info(){this.readonly.value=this.info&&this.info.readonly,this.refresh()}},exports.data=data,exports.mounted=mounted,exports.destroyed=destroyed;