"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.data=exports.watch=exports.methods=exports.components=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");function data(){return{meta:null,info:null,readonly:{value:!0},imgSrc:"",imgRect:{width:0,height:0},isUnlegalWrapModeS:!1,isUnlegalWrapModeT:!1}}function mounted(){this.info=this.infos[0],this.meta=this.metas[0]}async function getImageLikeAssetSource(e){if(!e)return"";switch(e.importer){case"image":case"gltf-embeded-image":return getLibrariedSource(e);case"texture":{const t=e.userData,n=t.imageUuidOrDatabaseUri;if(!n)return"";if(!t.isUuid){const e=await Editor.Message.request("asset-db","query-asset-info",n);return e?getImageLikeAssetSource(e):""}return n?getImageLikeAssetSource(await Editor.Message.request("asset-db","query-asset-meta",n.split("@")[0])):""}default:return""}}async function getLibrariedSource(e){const t=await Editor.Message.request("asset-db","query-asset-info",e.uuid);if(!t)return;const n=t.library,a=Object.keys(n).find(e=>".json"!==e)||"";return a?n[a]:""}exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8"),exports.template='\n<section class="asset-texture">\n    <div class="content"\n        v-if="meta"\n    >\n        <ui-prop>\n            <ui-label slot="label" tooltip="Anisotropy" value="Anisotropy"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'anisotropy\')"\n                :value="meta.userData.anisotropy"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'anisotropy\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Min Filter" value="Min Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'minfilter\')"\n                :value="meta.userData.minfilter"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'minfilter\')"\n            >\n                <option\n                    v-for="item in [\'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Mag Filter" value="Mag Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'magfilter\')"\n                :value="meta.userData.magfilter"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'magfilter\')"\n            >\n                <option\n                    v-for="item in [\'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Mip Filter" value="Mip Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'mipfilter\')"\n                :value="meta.userData.mipfilter"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'mipfilter\')"\n            >\n                <option\n                    v-for="item in [\'none\', \'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop\n            :class="isUnlegalWrapModeS?\'warn\':undefined"\n        >\n            <ui-label slot="label" tooltip="Wrap Mode S" value="Wrap Mode S"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'wrapModeS\')"\n                :value="meta.userData.wrapModeS"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'wrapModeS\')"\n            >\n                <option\n                    v-for="item in [\'repeat\', \'clamp-to-edge\', \'mirrored-repeat\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop\n            :class="isUnlegalWrapModeT?\'warn\':undefined"\n        >\n            <ui-label slot="label" tooltip="Wrap Mode T" value="Wrap Mode T"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'wrapModeT\')"\n                :value="meta.userData.wrapModeT"\n                :disabled="readonly.value"\n                @change="_onChangeData($event, \'wrapModeT\')"\n            >\n                <option\n                    v-for="item in [\'repeat\', \'clamp-to-edge\', \'mirrored-repeat\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <div class="warn-words">\n            <ui-label value="i18n:inspector.asset.texture.modeWarn"\n                v-if="isUnlegalWrapModeT || isUnlegalWrapModeS"\n            ></ui-label>\n        </div>\n    </div>\n\n    <asset-image-preview \n        v-if="imgSrc && meta && metas.length === 1"\n        :meta="meta"\n        :imgSrc="imgSrc"\n    ></asset-image-preview>\n</section>\n',exports.components={"asset-image-preview":require("../../components/image-preview")},exports.methods={getInvalid(e){const t=this.metas[0].userData[e];return!this.metas.every(n=>t===n.userData[e])},async refresh(){const e=this;try{if(!e.meta)return e.imgSrc="";e.imgSrc=await getImageLikeAssetSource(e.meta)}catch(t){console.error(t),e.imgSrc=""}},_onChangeData(e,t){const n=this;n.metas.forEach(a=>{n.$set(a.userData,t,e.target.value)}),n.checkWrapMode()},checkWrapMode(){const{wrapModeT:e,wrapModeS:t}=this.meta.userData,{width:n,height:a}=this.imgRect,i=n&n-1||a&a-1;this.isUnlegalWrapModeT=i&&"repeat"===e,this.isUnlegalWrapModeS=i&&"repeat"===t}},exports.watch={infos(){this.info=this.infos[0]},info(){this.readonly.value=this.info&&this.info.readonly},metas(){this.meta=this.metas[0]},meta(){this.refresh()},imgSrc(){const e=this;if(e.imgSrc){const t=new Image;t.onload=(()=>{e.imgRect=t}),t.src=e.imgSrc}else e.imgRect={width:0,height:0}},imgRect(){this.checkWrapMode()}},exports.data=data,exports.mounted=mounted;