"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.data=exports.watch=exports.methods=exports.props=exports.template=exports.style=void 0;const ElectronModule=require("@base/electron-module"),GlPreview=ElectronModule.require("PreviewExtends").default;let glPreview=new GlPreview("scene:skeleton-preview","query-skeleton-preview-data");exports.style="\n.asset-skeleton {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.asset-skeleton > section {\n    flex: 1;\n    overflow: auto;\n}\n\n.asset-skeleton > footer {\n    margin-top: 5px;\n    border-top: 1px solid var(--color-normal-border);\n}\n.asset-skeleton > footer> .preview-info {\n    padding: 4px 8px;\n}\n.asset-skeleton > footer> .preview-info > ui-label {\n    margin-right: 6px;\n}\n\n.asset-skeleton > footer > .imageDiv {\n    height: 200px;\n    overflow: hidden;\n    display: flex;\n    flex: 1;\n    margin-right: 10px;\n}\n.asset-skeleton > footer > .imageDiv > .image {\n    flex: 1;\n}\n",exports.template='\n<section class="asset-skeleton">\n    <section></section>\n    <footer>\n        <div class="preview-info">\n            <ui-label value="JointCount:0" ref="jointCountLabel"></ui-label>\n        </div>\n        <div class="imageDiv" ref="imageDiv">\n            <canvas class="image" ref="image"\n                @mousedown=onPreviewMouseDown($event)\n            ></canvas>\n        </div>\n    </footer>\n</section>\n',exports.props=["info"];const previewConfig={};function data(){return{meta:null,readonly:{value:!0},isPreviewDataDirty:!0}}function mounted(){const e=this;e.info=e.infos[0],e.meta=e.metas[0],e.refresh(),Editor.Message.addBroadcastListener("scene:skeleton-preview-skeleton-info",e.updateSkeletonInfo)}function destroyed(){Editor.Message.removeBroadcastListener("scene:skeleton-preview-skeleton-info",this.updateSkeletonInfo),Editor.Message.request("scene","hide-skeleton-preview")}exports.methods={refresh(){this.isPreviewDataDirty=!0,this.initPreview()},async initPreview(){const e=this;e.$refs.image&&(e.from||(await glPreview.init({width:e.$refs.image.clientWidth,height:e.$refs.image.clientHeight}),await Editor.Message.request("scene","set-skeleton-preview-skeleton",e.info.uuid),e.$refs.image&&(glPreview.initGL(e.$refs.image,{width:e.$refs.image.clientWidth,height:e.$refs.image.clientHeight}),previewConfig.width=e.$refs.image.clientWidth,previewConfig.height=e.$refs.image.clientHeight,e.updateTask&&(cancelAnimationFrame(e.updateTask),e.updateTask=null),e.update())))},async update(){const e=this,t=e.$refs.image;if(e&&t){if(e.isPreviewDataDirty){t.width=e.$refs.imageDiv.clientWidth,t.height=e.$refs.imageDiv.clientHeight;const i=await glPreview.queryPreviewData({width:e.$refs.imageDiv.clientWidth,height:e.$refs.imageDiv.clientHeight});i.width===previewConfig.width&&i.height===previewConfig.height||(glPreview.resizeGL(i.width,i.height),previewConfig.width=i.width,previewConfig.height=i.height);try{glPreview.drawGL(i.buffer,i.width,i.height)}catch(e){console.warn(e)}e.isPreviewDataDirty=!1}e.updateTask=requestAnimationFrame(async()=>{await e.update()})}else e.updateTask=null},onPreviewMouseDown(e){Editor.Message.request("scene","on-skeleton-preview-mouse-down",{x:e.x,y:e.y}),e.target.requestPointerLock(),document.addEventListener("mousemove",this.onPreviewMouseMove),document.addEventListener("mouseup",this.onPreviewMouseUp);this.isPreviewDataDirty=!0},onPreviewMouseMove(e){Editor.Message.request("scene","on-skeleton-preview-mouse-move",{movementX:e.movementX,movementY:e.movementY});this.isPreviewDataDirty=!0},onPreviewMouseUp(e){Editor.Message.request("scene","on-skeleton-preview-mouse-up",{x:e.x,y:e.y}),document.exitPointerLock(),document.removeEventListener("mousemove",this.onPreviewMouseMove),document.removeEventListener("mouseup",this.onPreviewMouseUp);this.isPreviewDataDirty=!0},updateSkeletonInfo(e){const t=this;t.$refs.jointCountLabel&&(t.$refs.jointCountLabel.value="JointCount:"+e.jointCount),t.isPreviewDataDirty=!0}},exports.watch={info(){this.readonly.value=this.info&&this.info.readonly,this.refresh()}},exports.data=data,exports.mounted=mounted,exports.destroyed=destroyed;