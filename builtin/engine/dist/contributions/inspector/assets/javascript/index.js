"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.data=exports.watch=exports.methods=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8");const{mapSync:mapSync,split:split}=require("event-stream");function data(){return{info:null,meta:null,code:""}}function mounted(){this.info=this.infos[0],this.meta=this.metas[0]}exports.template='\n<section class="asset-javascript">\n\n    <div class="line">\n        \n        <ui-checkbox class="content"\n            :invalid="getInvalid(\'isPlugin\')"\n            :value="meta && meta.userData.isPlugin"\n            @confirm="_onPluginStateChanged($event, \'isPlugin\')"\n        >\n            <ui-label value="i18n:inspector.asset.javascript.plugin"></ui-label>\n        </ui-checkbox>\n    </div>\n\n    <template\n        v-if="meta && meta.userData.isPlugin && !getInvalid(\'isPlugin\')"\n    >\n        <div class="line indent">\n            <ui-label value="i18n:inspector.asset.javascript.dependencies"></ui-label>\n            <ui-num-input class="content" step="1" min="0" max="10"\n                :value="meta.userData.dependencies ? meta.userData.dependencies.length : 0"\n                @confirm="_onChangeDependenciesLength($event)"\n            ></ui-num-input>\n        </div>\n        <div class="line indent"\n            v-if="meta.userData.dependencies && meta.userData.dependencies.length"\n        >\n            <ui-label></ui-label>\n            <div class="assets content">\n                <ui-asset droppable="cc.Script"\n                    v-for="(uuid, index) in meta.userData.dependencies"\n                    :key="index"\n                    :value="uuid"\n                    @confirm="_onChangeDependencies($event.target.value, index)"\n                ></ui-asset>\n            </div>\n        </div>\n\n        <div class="line indent">\n            <ui-label tooltip="i18n:inspector.asset.javascript.executionScopeTip" value="i18n:inspector.asset.javascript.executionScope"></ui-label>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'executionScope\')"\n                :value="meta.userData.executionScope!==\'global\'?\'enclosed\':\'global\'"\n                @confirm="_onPluginStateChanged($event, \'executionScope\')"\n            >\n                <option value="enclosed">{{t(\'executionScopeEnclosed\')}}</option>\n                <option value="global">{{t(\'executionScopeGlobal\')}}</option>\n            </ui-select>\n        </div>\n\n        <div class="line indent"\n            v-if="meta && !getInvalid(\'executionScope\') && meta.userData.executionScope!==\'global\'"\n        >\n            <ui-label></ui-label>\n            <ui-input placeholder=\'self;window;global;globalThis\' tooltip="i18n:inspector.asset.javascript.simulateGlobals"\n                :value="meta && getSimulateGlobalsRep(meta)"\n                @confirm="onSimulateGlobalsListChanged($event)"\n            ></ui-input>\n        </div>\n    </template>\n\n    <div\n        v-if="meta && meta.userData.isPlugin && !getInvalid(\'isPlugin\')"\n        class="child"\n    >\n        <div class="line indent">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInWeb\')"\n                :value="meta && meta.userData.loadPluginInWeb"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInWeb\')"\n            >\n                <ui-label value="i18n:inspector.asset.javascript.loadPluginInWeb"></ui-label>\n            </ui-checkbox>\n        </div>\n        <div class="line indent">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInNative\')"\n                :value="meta && meta.userData.loadPluginInNative"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInNative\')"\n            >\n                <ui-label value="i18n:inspector.asset.javascript.loadPluginInNative"></ui-label>\n            </ui-checkbox>\n        </div>\n        <div class="line indent">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInEditor\')"\n                :value="meta && meta.userData.loadPluginInEditor"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInEditor\')"\n            >\n                <ui-label value="i18n:inspector.asset.javascript.loadPluginInEditor"></ui-label>\n            </ui-checkbox>\n        </div>\n    </div>\n\n    <ui-code language="javascript"\n        v-show="metas.length === 1"\n    >{{code}}</ui-code>\n</section>\n',exports.methods={getInvalid(e){const n=this.metas[0].userData[e];return!this.metas.every(t=>n===t.userData[e])},t:e=>Editor.I18n.t(`inspector.asset.javascript.${e}`),onSimulateGlobalsStateChanged(e){const n=this;n.metas.forEach(t=>n.$set(t.userData,"simulateGlobals",e.target.value))},getSimulateGlobalsRep:e=>Array.isArray(e.userData.simulateGlobals)?e.userData.simulateGlobals.join(";"):"",onSimulateGlobalsListChanged(e){const n=this,t=e.target.value;let a=[];0!==t.length&&(a=t.split(";").map(e=>e.trim()).filter(e=>0!==e.length)),n.metas.forEach(e=>n.$set(e.userData,"simulateGlobals",a))},_onPluginStateChanged(e,n){const t=this;t.metas.forEach(a=>{t.$set(a.userData,n,e.target.value),"isPlugin"===n&&(t.$set(a.userData,"importAsPlugin",e.target.value),e.target.value&&("loadPluginInWeb"in a.userData||t.$set(a.userData,"loadPluginInWeb",!0),"loadPluginInNative"in a.userData||t.$set(a.userData,"loadPluginInNative",!0),"loadPluginInEditor"in a.userData||t.$set(a.userData,"loadPluginInEditor",!1)))})},_onChangeDependenciesLength(e){const n=this;Array.isArray(n.meta.userData.dependencies)||n.$set(n.meta.userData,"dependencies",[]);const t=Number(e.target.value);if(!(t<0||t>10)){for(;n.meta.userData.dependencies.length<t;)n.meta.userData.dependencies.push("");for(;n.meta.userData.dependencies.length>t;)n.meta.userData.dependencies.pop()}},_onChangeDependencies(e,n){this.meta.userData.dependencies[n]=e},refresh(){const e=this;if(!e.info||"javascript"!==e.info.importer||e.metas.length>1)return;const n=fs_extra_1.createReadStream(e.info.file,{encoding:"utf-8"});let t=400,a=2e4,i="";const s=n.pipe(split()).pipe(mapSync(e=>{const l=e.length;l>a?(e=e.substr(0,a),a=0):a-=l,i+=e+"\n",(--t<=0||a<=0)&&(i+="...\n",n.close(),s.push(null),s.end())})).on("close",n=>{if(n)throw n;e.code=i})}},exports.watch={info(){this.refresh()},infos(){this.info=this.infos[0]},metas(){this.meta=this.metas[0]}},exports.data=data,exports.mounted=mounted;