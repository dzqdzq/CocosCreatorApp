"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.data=exports.watch=exports.methods=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8");const{mapSync:mapSync,split:split}=require("event-stream");function data(){return{info:null,meta:null,code:""}}function mounted(){this.info=this.infos[0],this.meta=this.metas[0]}exports.template='\n<section class="asset-javascript">\n\n    <div class="line">\n        <ui-label i18n>inspector.asset.javascript.plugin</ui-label>\n        <ui-checkbox class="content"\n            :invalid="getInvalid(\'isPlugin\')"\n            :value="meta && meta.userData.isPlugin"\n            @confirm="_onPluginStateChanged($event, \'isPlugin\')"\n        ></ui-checkbox>\n    </div>\n\n    <template\n        v-if="meta && meta.userData.isPlugin && !getInvalid(\'isPlugin\')"\n    >\n\n        <div class="line indent">\n            <ui-label>Dependencies</ui-label>\n            <ui-num-input class="content" step="1" min="0" max="10"\n                :value="meta.userData.dependencies ? meta.userData.dependencies.length : 0"\n                @confirm="_onChangeDependenciesLength($event)"\n            ></ui-num-input>\n        </div>\n        <div class="line indent">\n            <ui-label></ui-label>\n            <div class="assets content"\n                v-if="meta.userData.dependencies"\n            >\n                <ui-asset droppable="cc.Script"\n                    v-for="(uuid, index) in meta.userData.dependencies"\n                    :key="uuid"\n                    :value="uuid"\n                    @confirm="_onChangeDependencies($event.target.value, index)"\n                ></ui-asset>\n            </div>\n        </div>\n\n        <div class="line indent">\n            <ui-section class="content"\n                :header="t(\'advanced\')"\n                :expand="$root.expand(\'advanced\', true)"\n                expand-key="advanced"\n            >\n                <div class="line">\n                    <ui-label i18n>inspector.asset.javascript.simulateGlobals</ui-label>\n                    <ui-checkbox\n                        :value="meta && isSimulateGlobalsEnabled(meta)"\n                        @confirm="onSimulateGlobalsStateChanged($event)"\n                    ></ui-checkbox>\n                    <ui-input placeholder=\'self;window;global;globalThis\'\n                        v-if="meta && !!meta.userData.simulateGlobals"\n                        :value="meta && getSimulateGlobalsRep(meta)"\n                        @confirm="onSimulateGlobalsListChanged($event)"\n                    ></ui-input>\n                </div>\n            </ui-section>\n        </div>\n    </template>\n\n    <div\n        v-if="meta && meta.userData.isPlugin && !getInvalid(\'isPlugin\')"\n        class="child"\n    >\n        <div class="line">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInWeb\')"\n                :value="meta && meta.userData.loadPluginInWeb"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInWeb\')"\n            >{{t(\'loadPluginInWeb\')}}</ui-checkbox>\n        </div>\n        <div class="line">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInNative\')"\n                :value="meta && meta.userData.loadPluginInNative"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInNative\')"\n            >{{t(\'loadPluginInNative\')}}</ui-checkbox>\n        </div>\n        <div class="line">\n            <ui-checkbox\n                :invalid="getInvalid(\'loadPluginInEditor\')"\n                :value="meta && meta.userData.loadPluginInEditor"\n                @confirm="_onPluginStateChanged($event, \'loadPluginInEditor\')"\n            >{{t(\'loadPluginInEditor\')}}</ui-checkbox>\n        </div>\n    </div>\n\n    <ui-code language="javascript"\n        v-show="metas.length === 1"\n    >{{code}}</ui-code>\n</section>\n',exports.methods={getInvalid(e){const n=this.metas[0].userData[e];return!this.metas.every(a=>n===a.userData[e])},t:e=>Editor.I18n.t(`inspector.asset.javascript.${e}`),isSimulateGlobalsEnabled:e=>!!e.userData.simulateGlobals,onSimulateGlobalsStateChanged(e){const n=this;n.metas.forEach(a=>n.$set(a.userData,"simulateGlobals",e.target.value))},getSimulateGlobalsRep:e=>Array.isArray(e.userData.simulateGlobals)?e.userData.simulateGlobals.join(";"):"",onSimulateGlobalsListChanged(e){const n=this,a=e.target.value;let t=[];0!==a.length&&(t=a.split(";").map(e=>e.trim()).filter(e=>0!==e.length)),n.metas.forEach(e=>n.$set(e.userData,"simulateGlobals",0===t.length||t))},_onPluginStateChanged(e,n){const a=this;a.metas.forEach(t=>{a.$set(t.userData,n,e.target.value),"isPlugin"===n&&e.target.value&&("loadPluginInWeb"in t.userData||a.$set(t.userData,"loadPluginInWeb",!0),"loadPluginInNative"in t.userData||a.$set(t.userData,"loadPluginInNative",!0),"loadPluginInEditor"in t.userData||a.$set(t.userData,"loadPluginInEditor",!1))})},_onChangeDependenciesLength(e){const n=this;Array.isArray(n.meta.userData.dependencies)||n.$set(n.meta.userData,"dependencies",[]);const a=Number(e.target.value);if(!(a<0||a>10)){for(;n.meta.userData.dependencies.length<a;)n.meta.userData.dependencies.push("");for(;n.meta.userData.dependencies.length>a;)n.meta.userData.dependencies.pop()}},_onChangeDependencies(e,n){this.meta.userData.dependencies[n]=e},refresh(){const e=this;if(!e.info||"javascript"!==e.info.importer||e.metas.length>1)return;const n=fs_extra_1.createReadStream(e.info.file,{encoding:"utf-8"});let a=400,t=2e4,i="";const s=n.pipe(split()).pipe(mapSync(e=>{const l=e.length;l>t?(e=e.substr(0,t),t=0):t-=l,i+=e+"\n",(--a<=0||t<=0)&&(i+="...\n",n.close(),s.push(null),s.end())})).on("close",n=>{if(n)throw n;e.code=i})}},exports.watch={info(){this.refresh()},infos(){this.info=this.infos[0]},metas(){this.meta=this.metas[0]}},exports.data=data,exports.mounted=mounted;