"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.computed=exports.data=exports.components=exports.watch=exports.methods=exports.props=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");function data(){return{info:null,meta:null,readonly:{value:!0},types:["raw","texture","normal map","sprite-frame","texture cube"],tab:"default",textureCompressConfig:null,componentName:"",importers:["texture","texture-cube","erp-texture-cube","sprite-frame"],subInfos:null,subMetas:null,subDirtyData:""}}async function mounted(){const e=this;e.info=e.infos[0],e.meta=e.metas[0],await e.refreshCompressConfig()}exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8"),exports.template='\n<section class="asset-image">\n    <div class="main">\n        <ui-prop class="type"\n            v-if="meta && from!==\'auto-atlas\'"\n            :readonly="readonly.value"\n        >\n            <ui-label slot="label" tooltip="Type" value="Type"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'type\')"\n                :value="meta.userData.type"\n                @confirm="_onDataChanged($event, \'type\')"\n            >\n                <option\n                    v-for="(item, index) in types"\n                    :value="item"\n                    :index="index"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n\n        <ui-prop class="flipVertical"\n            v-if="meta && from!==\'auto-atlas\'"\n        >\n            <ui-label slot="label" tooltip="Flip Vertical" value="Flip Vertical"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-checkbox slot="content"\n                :disabled="readonly.value"\n                :invalid="getInvalid(\'flipVertical\')"\n                :value="meta.userData.flipVertical"\n                @confirm="_onDataChanged($event, \'flipVertical\')"\n            ></ui-checkbox>\n        </ui-prop>\n\n        <ui-prop\n            v-if="meta && meta.userData.type === \'texture cube\'"\n            :readonly="readonly.value"\n        >\n            <ui-label slot="label" tooltip="isRGBE" value="isRGBE"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-checkbox slot="content"\n                :invalid="getInvalid(\'isRGBE\')"\n                :value="meta.userData.isRGBE"\n                @confirm="_onDataChanged($event, \'isRGBE\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop\n            v-if="meta && meta.userData"\n            :readonly="readonly.value"\n        >\n            <ui-label slot="label" tooltip="useCompressTexture" value="useCompressTexture"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.compressSettings && meta.userData.compressSettings.useCompressTexture"\n                @confirm="_onCompressSettingsChanged($event, \'useCompressTexture\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop\n            v-if="textureCompressConfig && meta.userData && meta.userData.compressSettings && meta.userData.compressSettings.useCompressTexture "\n            :readonly="readonly.value"\n        >\n            <ui-label slot="label" tooltip="presetId" value="presetId"></ui-label>\n            <div slot="content">\n                <ui-select\n                    :value="meta.userData.compressSettings && meta.userData.compressSettings.presetId || \'default\'"\n                    @confirm="_onCompressSettingsChanged($event, \'presetId\')"\n                    @click="onSelectClick"\n                >\n                    <option\n                        v-for="(config, id) in textureCompressConfig.userPreset"\n                        v-if="config"\n                        :value="id"\n                        :key="id"\n                    >{{config.name}}</option>\n                    <option\n                        v-for="(config, id) in textureCompressConfig.defaultConfig"\n                        v-if="config"\n                        :value="id"\n                        :key="id"\n                    >{{config.name + \' (builtin)\'}}</option>\n                </ui-select>\n                <ui-button value="edit"\n                    @confirm.stop="jumpToProjectSettings"\n                    tooltip="jump to edit config"\n                ><ui-label value="i18n:builder.assets.image.edit_preset"></ui-label></ui-button>\n            </div>\n        </ui-prop>\n\n        <config-group\n            class="platform-setting"\n            v-if="userTextureCompress"\n            :compress-info="textureCompressConfig"\n            :config="userTextureCompress.config.options"\n            :disabled="true"\n        >\n        </config-group>\n    </div>\n\n    <ui-section class="asset sub-asset"\n        v-if="componentName && subInfos[0]"\n        :expand="$root.expand(\'sub-asset\', true)"\n        expand-key="sub-asset"\n    >\n        <header class="asset-header" slot="header">\n            <div class="name">\n                <label class="label">{{subInfos[0].name}}</label>\n                <ui-icon value="lock"\n                    v-if="readonly.value"\n                ></ui-icon>\n            </div>\n        </header>\n        <component\n            :is="componentName"\n            :infos="subInfos"\n            :metas="subMetas"\n        ></component>\n    </ui-section>\n\n</section>\n',exports.props=["from"],exports.methods={getInvalid(e){const t=this.metas[0].userData[e];return!this.metas.every(s=>t===s.userData[e])},_onCompressSettingsChanged(e,t){const s=this;s.metas.forEach(n=>{let o=n.userData.compressSettings&&JSON.parse(JSON.stringify(n.userData.compressSettings))||{};o[t]=e.target.value,s.$set(n.userData,"compressSettings",o)})},_onDataChanged(e,t){const s=this;s.metas.forEach(n=>{s.$set(n.userData,t,e.target.value)})},subAssets(){const e=this;e.subInfos=[],e.subMetas=[],e.infos.forEach(t=>{if(!t)return;let s=null;for(const e in t.subAssets){const n=t.subAssets[e];if(n&&"*"!==n.importer){if("sprite-frame"===n.importer){s=e;break}s=e}}null!==s&&e.subInfos.push(t.subAssets[s])}),e.metas.forEach(t=>{if(!t)return;let s=null;for(const e in t.subMetas){const n=t.subMetas[e];if(n&&"*"!==n.importer){if("sprite-frame"===n.importer){s=e;break}s=e}}null!==s&&e.subMetas.push(t.subMetas[s])}),e.componentName=e.subInfos[0]&&e.subInfos[0].importer,e.subDirtyData=JSON.stringify(e.subMetas)},async apply(){const e=this;if(e.subDirtyData!==JSON.stringify(e.subMetas)){for(const t of e.subMetas)await Editor.Message.request("asset-db","save-asset-meta",t.uuid,JSON.stringify(t));await new Promise(e=>setTimeout(e,1e3))}},jumpToProjectSettings(){Editor.Message.send("project","open-settings","builder","compress")},onSelectClick(e){const t=this;if(2===t.clickNum)return;t.clickNum=2,t.refreshCompressConfig();const s=e.target;setTimeout(()=>{s.click(),t.clickNum=1},30)},async refreshCompressConfig(){const e=this;let{userPreset:t,defaultConfig:s}=await Editor.Profile.getProject("builder","textureCompressConfig");if(e.textureCompressConfig)e.$set(e.textureCompressConfig,"userPreset",t),e.$set(e.textureCompressConfig,"defaultConfig",s);else{const n=await Editor.Message.request("builder","query-compress-config");Object.assign(n,{userPreset:t,defaultConfig:s}),e.$set(e,"textureCompressConfig",n)}}},exports.watch={infos(){this.info=this.infos[0]},info(){const e=this;e.readonly.value=e.info&&e.info.readonly,e.subAssets(),e.refreshCompressConfig()},metas(){this.meta=this.metas[0]}},exports.components={texture:require("../texture"),"texture-cube":require("../texture-cube"),"erp-texture-cube":require("../erp-texture-cube"),"sprite-frame":require("../sprite-frame"),"config-group":require("../../../../../../builder/dist/contributions/compress-texture/config-group")},exports.data=data,exports.computed={userTextureCompress(){const e=this.meta||this.metas[0];if(!(this.textureCompressConfig&&this.textureCompressConfig.userPreset&&e.userData.compressSettings&&e.userData.compressSettings.useCompressTexture))return null;const t=e.userData.compressSettings.presetId||"default",s=this.textureCompressConfig.userPreset[t]||this.textureCompressConfig.defaultConfig[t];return s?{name:t,config:s}:null}},exports.mounted=mounted;