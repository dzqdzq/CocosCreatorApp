"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.computed=exports.watch=exports.methods=exports.data=exports.components=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),lodash=require("lodash");function data(){return{meta:null,info:null,packedTextures:[],unpackedTextures:[],generating:!1,readonly:{value:!0}}}async function mounted(){this.refresh()}exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8"),exports.template='\n<section class="asset-auto-atlas">\n    <div class="content"\n        v-if="meta && metas.length === 1"\n    >\n        <ui-prop>\n            <ui-label slot="label" value="Max Width"></ui-label>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'maxWidth\')"\n                :value="meta.userData.maxWidth"\n                @change="_onDataChanged($event, \'maxWidth\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Max Height"></ui-label>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'maxHeight\')"\n                :value="meta.userData.maxHeight"\n                @change="_onDataChanged($event, \'maxHeight\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Padding"></ui-label>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'padding\')"\n                :value="meta.userData.padding"\n                @change="_onDataChanged($event, \'padding\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Allow Rotation"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.allowRotation"\n                @confirm="_onDataChanged($event, \'allowRotation\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Force Squared"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.forceSquared"\n                @confirm="_onDataChanged($event, \'forceSquared\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Power of Two"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.powerOfTwo"\n                @confirm="_onDataChanged($event, \'powerOfTwo\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Algorithm"></ui-label>\n            <ui-select slot="content"\n                :value="meta.userData.algorithm"\n                @confirm="_onDataChanged($event, \'algorithm\')"\n            >\n                <option value="MaxRects">MaxRects</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Padding Bleed"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.paddingBleed"\n                @confirm="_onDataChanged($event, \'paddingBleed\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" value="Filter Unused"></ui-label>\n            <ui-checkbox slot="content"\n                :value="meta.userData.filterUnused"\n                @confirm="_onDataChanged($event, \'filterUnused\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Anisotropy" value="Anisotropy"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'anisotropy\')"\n                :value="meta.userData.textureSetting.anisotropy"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.anisotropy\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Min Filter" value="Min Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'minfilter\')"\n                :value="meta.userData.textureSetting.minfilter"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.minfilter\')"\n            >\n                <option\n                    v-for="item in [\'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Mag Filter" value="Mag Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'magfilter\')"\n                :value="meta.userData.textureSetting.magfilter"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.magfilter\')"\n            >\n                <option\n                    v-for="item in [\'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Mip Filter" value="Mip Filter"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'mipfilter\')"\n                :value="meta.userData.textureSetting.mipfilter"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.mipfilter\')"\n            >\n                <option\n                    v-for="item in [\'none\', \'nearest\' , \'linear\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop\n            :class="isIllegalWrapModeS?\'warn\':undefined"\n        >\n            <ui-label slot="label" tooltip="Wrap Mode S" value="Wrap Mode S"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'wrapModeS\')"\n                :value="meta.userData.textureSetting.wrapModeS"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.wrapModeS\')"\n            >\n                <option\n                    v-for="item in [\'repeat\', \'clamp-to-edge\', \'mirrored-repeat\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop\n            :class="isIllegalWrapModeT?\'warn\':undefined"\n        >\n            <ui-label slot="label" tooltip="Wrap Mode T" value="Wrap Mode T"></ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'textureSetting.wrapModeT\')"\n                :value="meta.userData.textureSetting.wrapModeT"\n                :disabled="readonly.value"\n                @change="_onDataChanged($event, \'textureSetting.wrapModeT\')"\n            >\n                <option\n                    v-for="item in [\'repeat\', \'clamp-to-edge\', \'mirrored-repeat\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <div class="warn-words">\n            <ui-label value="i18n:inspector.asset.texture.modeWarn"\n                v-if="isIllegalWrapModeT || isIllegalWrapModeS"\n            ></ui-label>\n        </div>\n        <asset-image\n            :info="info"\n            :meta="meta"\n            :infos="infos"\n            :metas="metas"\n            from="auto-atlas"\n        ></asset-image>\n\n        <ui-button tabindex="0"\n            @mouseup.stop\n            @confirm.stop="_onPreviewClick"\n        >Preview</ui-button>\n\n        <div>\n            <div class="images-title">Packed Textures:</div>\n            <div class="images"\n            v-if="packedTextures.length!==0"\n            >\n            <div class="image"\n                v-for="(src, index) in packedTextures"\n            >\n                    <img class="img"\n                        :src="src + \'?\' + Math.random()"\n                    >\n                    <ui-link :value="src" :tooltip="src">packed image({{index + 1}})</ui-link>\n                </div>\n            </div>\n            <div class="images-title"\n                v-if="unpackedTextures.length!==0"\n            >\n                Unpacked Textures:\n            </div>\n            <div class="images"\n            v-if="unpackedTextures.length!==0"\n            >\n                <div class="image"\n                    v-for="spriteFrameInfo in unpackedTextures"\n                    @click="twinkle(spriteFrameInfo.imageUuid)"\n                >\n                    <img class="img"\n                        :src="spriteFrameInfo.libraryPath + \'?\' + Math.random()"\n                    >\n                </div>\n            </div>\n        </div>\n        <ui-loading v-if="generating"></ui-loading>\n    </div>\n    <div\n        v-else\n    >No support multiple selections.</div>\n</section>\n',exports.components={"asset-image":require("../image")},exports.data=data,exports.methods={getInvalid(e){const n=lodash.get(this.metas[0].userData,e);return!this.metas.every(t=>n===lodash.get(t.userData,e))},t:e=>Editor.I18n.t(`inspector.asset.autoAtlas.${e}`),_onDataChanged(e,n){lodash.set(this.meta.userData,n,e.target.value)},async _onPreviewClick(e){const n=this;n.generating=!0;try{await Editor.Message.request("builder","preview-pac",n.meta.uuid)}catch(e){console.warn(`Auto Atlas Preview Error: ${e}`)}n.generating=!1,n.showImages()},async showImages(){const e=this;e.packedTextures=[],e.unpackedTextures=[];const n=await Editor.Message.request("builder","query-atlas-files",e.meta.uuid);n&&(e.packedTextures=n.atlasImagePaths,e.unpackedTextures=n.unpackedImages)},twinkle(e){Editor.Message.send("assets","twinkle",e)},refresh(){this.generating=!1,this.info=this.infos[0],this.meta=this.metas[0],this.showImages()}},exports.watch={meta(){this.refresh()},metas(){this.refresh()},info(){this.readonly.value=this.info&&this.info.readonly}},exports.computed={isIllegalWrapModeT(){return"repeat"===this.meta.userData.textureSetting.wrapModeT},isIllegalWrapModeS(){return"repeat"===this.meta.userData.textureSetting.wrapModeS}},exports.mounted=mounted;