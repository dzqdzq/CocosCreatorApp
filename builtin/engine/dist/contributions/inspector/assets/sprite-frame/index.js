"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.data=exports.watch=exports.methods=exports.components=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./style.css"),"utf8");const manager_1=require("../../../../../../inspector/dist/sprite-editor/manager");function data(){return{meta:null,info:null,readonly:{value:!0},imgSrc:"",imgRect:{width:0,height:0},isUnlegalWrapModeS:!1,isUnlegalWrapModeT:!1}}function mounted(){this.info=this.infos[0],this.meta=this.metas[0]}function destroyed(){manager_1.close(this)}async function getImageLikeAssetSource(e){if(!e)return"";switch(e.importer){case"image":case"gltf-embeded-image":return getLibrariedSource(e);case"sprite-frame":case"texture":{const t=e.userData,n=t.imageUuidOrDatabaseUri;if(!n)return"";if(!t.isUuid){const e=await Editor.Message.request("asset-db","query-asset-info",n);return e?getImageLikeAssetSource(e):""}return n?getImageLikeAssetSource(await Editor.Message.request("asset-db","query-asset-meta",n.split("@")[0])):""}default:return""}}async function getLibrariedSource(e){const t=await Editor.Message.request("asset-db","query-asset-info",e.uuid);if(!t)return;const n=t.library,a=Object.keys(n).find(e=>".json"!==e)||"";return a?n[a]:""}exports.template='\n<section class="asset-texture">\n    <div class="content"\n        v-if="meta"\n    >\n        <ui-prop>\n            <ui-label slot="label" tooltip="Packable">Packable</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-checkbox slot="content"\n                :invalid="getInvalid(\'packable\')"\n                :value="meta.userData.packable"\n                @change="_onChangeData($event, \'packable\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Rotated">Rotated</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-checkbox slot="content" disabled\n                :invalid="getInvalid(\'rotated\')"\n                :value="meta.userData.rotated"\n                @change="_onChangeData($event, \'rotated\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Offset X">Offset X</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content" disabled\n                :invalid="getInvalid(\'offsetX\')"\n                :value="meta.userData.offsetX"\n                @change="_onChangeData($event, \'offsetX\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Offset Y">Offset Y</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content" disabled\n                :invalid="getInvalid(\'offsetY\')"\n                :value="meta.userData.offsetY"\n                @change="_onChangeData($event, \'offsetY\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim Type">Trim Type</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-select slot="content"\n                :invalid="getInvalid(\'trimType\')"\n                :disabled="readonly.value"\n                :value="meta.userData.trimType"\n                @change="_onChangeData($event, \'trimType\')"\n            >\n                <option\n                    v-for="item in [\'auto\', \'custom\', \'none\']"\n                    :value="item"\n                >{{item}}</option>\n            </ui-select>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim Threshold">Trim Threshold</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'trimThreshold\')"\n                :disabled="readonly.value"\n                :value="meta.userData.trimThreshold"\n                @change="_onChangeData($event, \'trimThreshold\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim X">Trim X</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'trimX\')"\n                :disabled="!isCustom() || isNone() || readonly.value"\n                :value="meta.userData.trimX"\n                @change="_onChangeData($event, \'trimX\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim Y">Trim Y</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'trimY\')"\n                :disabled="!isCustom() || isNone() || readonly.value"\n                :value="meta.userData.trimY"\n                @change="_onChangeData($event, \'trimY\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim Width">Trim Width</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'width\')"\n                :disabled="!isCustom() || isNone() || readonly.value"\n                :value="meta.userData.width"\n                @change="_onChangeData($event, \'width\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Trim Height">Trim Height</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'height\')"\n                :disabled="!isCustom() || isNone() || readonly.value"\n                :value="meta.userData.height"\n                @change="_onChangeData($event, \'height\')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Border Top">Border Top</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'borderTop\')"\n                :disabled="readonly.value"\n                :value="meta.userData.borderTop"\n                @change="_onChangeData($event, \'borderTop\')"\n                :max="meta.userData.height - meta.userData.borderBottom"\n                :min="0"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Border Bottom">Border Bottom</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'borderBottom\')"\n                :disabled="readonly.value"\n                :value="meta.userData.borderBottom"\n                @change="_onChangeData($event, \'borderBottom\')"\n                :max="meta.userData.height - meta.userData.borderTop"\n                :min="0"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Border Left">Border Left</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'borderLeft\')"\n                :disabled="readonly.value"\n                :value="meta.userData.borderLeft"\n                @change="_onChangeData($event, \'borderLeft\')"\n                :max="meta.userData.width - meta.userData.borderRight"\n                :min="0"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label" tooltip="Border Right">Border Right</ui-label>\n            <ui-icon value="lock" slot="label"\n                v-if="readonly.value"\n            ></ui-icon>\n            <ui-num-input slot="content"\n                :invalid="getInvalid(\'borderRight\')"\n                :disabled="readonly.value"\n                :value="meta.userData.borderRight"\n                :max="meta.userData.width - meta.userData.borderLeft"\n                :min="0"\n                @change="_onChangeData($event, \'borderRight\')"\n            ></ui-num-input>\n        </ui-prop>\n        <div class="edit-btn"\n            v-if="metas.length === 1"\n        >\n            <ui-button tabindex="0"\n                @confirm.stop="openSpriteEditor"\n                @change.stop\n            >{{t(\'edit\')}}</ui-button>\n        </div>\n        <div class="warn-words">\n            <ui-label i18n\n                v-if="isUnlegalWrapModeT || isUnlegalWrapModeS"\n            >inspector.asset.texture.modeWarn</ui-label>\n        </div>\n    </div>\n\n    <asset-image-preview\n        v-if="imgSrc && meta && metas.length === 1"\n        :meta="meta"\n        :imgSrc="imgSrc"\n    ></asset-image-preview>\n</section>\n',exports.components={"asset-image-preview":require("../../components/image-preview")},exports.methods={getInvalid(e){const t=this.metas[0].userData[e];return!this.metas.every(n=>t===n.userData[e])},_onChangeData(e,t){const n=this;n.isNone()&&n.meta&&(n.meta.userData.trimX=0,n.meta.userData.trimY=0,n.meta.userData.width=n.meta.userData.rawWidth,n.meta.userData.height=n.meta.userData.rawHeight),n.metas.forEach(a=>{n.$set(a.userData,t,e.target.value)}),manager_1.update(),n.checkWrapMode()},t:e=>Editor.I18n.t(`inspector.asset.spriteFrame.${e}`),async refresh(){const e=this;try{if(!e.meta)return e.imgSrc="";e.imgSrc=await getImageLikeAssetSource(e.meta)}catch(t){console.error(t),e.imgSrc=""}},isNone(){return"none"===this.meta.userData.trimType},isCustom(){return"custom"===this.meta.userData.trimType},openSpriteEditor(){manager_1.open(this)},saveSpriteEditor(e){const t=this,n=Object.keys(e);for(const a of n)t.metas.forEach(n=>{t.$set(n.userData,a,e[a])})},checkWrapMode(){const{wrapModeT:e,wrapModeS:t}=this.meta.userData,{width:n,height:a}=this.imgRect,i=n&n-1||a&a-1;this.isUnlegalWrapModeT=i&&"repeat"===e,this.isUnlegalWrapModeS=i&&"repeat"===t}},exports.watch={infos(){this.info=this.infos[0]},info(){this.readonly.value=this.info&&this.info.readonly},metas(){this.meta=this.metas[0]},meta(){this.refresh(),manager_1.update(this)},imgSrc(){const e=this;if(e.imgSrc){const t=new Image;t.onload=(()=>{e.imgRect=t}),t.src=e.imgSrc}else e.imgRect={width:0,height:0}},imgRect(){this.checkWrapMode()}},exports.data=data,exports.mounted=mounted,exports.destroyed=destroyed;