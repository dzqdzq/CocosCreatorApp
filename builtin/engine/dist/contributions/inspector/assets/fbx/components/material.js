"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.watch=exports.directives=exports.methods=exports.data=exports.props=exports.template=void 0;const path_1=require("path");function data(){return{materialDumpDir:"",materialDumpDirDefault:"",images:[]}}async function getImageSrc(e,t){if(t.value&&t.value.startsWith("db:")){const a=await Editor.Message.request("asset-db","query-path",t.value);a&&(e.src=a,e.tooltip=t.value)}}function mounted(){this.refresh()}exports.template='\n<div class="material">\n    \x3c!-- dump material --\x3e\n    <ui-prop class="type">\n        <ui-label slot="label"\n            tooltip="i18n:inspector.asset.fbx.GlTFUserData.dumpMaterials.title"\n            :value="t(\'GlTFUserData.dumpMaterials.name\')"\n        ></ui-label>\n        <ui-icon value="lock" slot="label"\n            v-if="readonly.value"\n        ></ui-icon>\n        <ui-checkbox slot="content"\n            :invalid="getInvalid(\'dumpMaterials\')"\n            :disabled="readonly.value"\n            :value="meta ? getDefault(meta.userData.dumpMaterials, false) : false"\n            @confirm.stop="$emit(\'data-confirm\', $event.target.value, \'dumpMaterials\')"\n        ></ui-checkbox>\n    </ui-prop>\n\n    \x3c!-- dump material position --\x3e\n    <ui-prop\n        v-if="meta && meta.userData.dumpMaterials"\n    >\n        <ui-label slot="label"\n            tooltip="i18n:inspector.asset.fbx.GlTFUserData.materialDumpDir.title"\n            :value="t(\'GlTFUserData.materialDumpDir.name\')"\n        ></ui-label>\n        <ui-icon value="lock" slot="label"\n            v-if="readonly.value"\n        ></ui-icon>\n        <ui-file slot="content" style="flex: 1;" type="directory"\n            :disabled="readonly.value"\n            :value="materialDumpDir"\n            @confirm="_onMaterialDumpDirChange($event)"\n        ></ui-file>\n    </ui-prop>\n\n    \x3c!-- dump use vertex colors --\x3e\n    <ui-prop>\n        <ui-label slot="label"\n            tooltip="i18n:inspector.asset.fbx.GlTFUserData.useVertexColors.title"\n            value="i18n:inspector.asset.fbx.GlTFUserData.useVertexColors.name"\n        ></ui-label>\n        <ui-icon value="lock" slot="label"\n            v-if="readonly.value"\n        ></ui-icon>\n        <ui-checkbox slot="content"\n            :invalid="getInvalid(\'useVertexColors\')"\n            :disabled="readonly.value"\n            :value="meta ? getDefault(meta.userData.useVertexColors, true) : true"\n            @confirm.stop="$emit(\'data-confirm\', $event.target.value, \'useVertexColors\')"\n        ></ui-checkbox>\n    </ui-prop>\n\n    \x3c!-- dump depth write alpha mode blend --\x3e\n    <ui-prop>\n        <ui-label slot="label"\n            tooltip="i18n:inspector.asset.fbx.GlTFUserData.depthWriteInAlphaModeBlend.title"\n            value="i18n:inspector.asset.fbx.GlTFUserData.depthWriteInAlphaModeBlend.name"\n        ></ui-label>\n        <ui-icon value="lock" slot="label"\n            v-if="readonly.value"\n        ></ui-icon>\n        <ui-checkbox slot="content"\n            :invalid="getInvalid(\'depthWriteInAlphaModeBlend\')"\n            :disabled="readonly.value"\n            :value="meta ? getDefault(meta.userData.depthWriteInAlphaModeBlend, false) : false"\n            @confirm.stop="$emit(\'data-confirm\', $event.target.value, \'depthWriteInAlphaModeBlend\')"\n        ></ui-checkbox>\n    </ui-prop>\n\n    \x3c!-- 显示 fbx 内可以自定义的 images 路径 --\x3e\n    <ui-section\n        v-if="metas.length === 1"\n        v-for="(item, index) in images"\n        :key="index"\n        :expand="$root.expand(item.name, true)"\n        :expand-key="item.name"\n    >\n        <div slot="header">\n            <span>{{item.name}}</span>\n        </div>\n        <div class="sub-item">\n            <ui-prop>\n                <ui-label slot="label"\n                    :value="t(\'ImageRemap.remapAs\')"\n                ></ui-label>\n                <ui-icon value="lock" slot="label"\n                    v-if="readonly.value"\n                ></ui-icon>\n                <div class="sub-content" slot="content">\n                    <ui-asset\n                        droppable="cc.ImageAsset"\n                        :value="item.remapUuid"\n                        :disabled="readonly.value"\n                        @change="_onChangeTarget($event,item)"\n                    ></ui-asset>\n                    <img class="image"\n                        v-if="item.remap"\n                        v-src="item.remap"\n                        @mousedown.stop="twinkle(item.remap)"\n                    >\n                </div>\n            </ui-prop>\n            <ui-prop>\n                <ui-label slot="label"\n                    :value="t(\'ImageRemap.original\')"\n                ></ui-label>\n                <div class="sub-content" slot="content">\n                    <img class="image"\n                        v-if="item.src"\n                        :src="item.src"\n                        :title="item.imageUuid"\n                        @mousedown.stop="twinkle(item.imageUuid)"\n                    >\n                    <span\n                        v-else\n                        @mousedown.stop="twinkle(item.imageUuid)"\n                    >{{item.imageUuid}}</span>\n                </div>\n            </ui-prop>\n        </div>\n    </ui-section>\n</div>\n',exports.props=["readonly","info","meta","metas"],exports.data=data,exports.methods={t:e=>Editor.I18n.t(`inspector.asset.fbx.${e}`),getDefault:(e,t)=>void 0===e?t:e,getInvalid(e){const t=this.metas[0].userData[e];return!this.metas.every(a=>t===a.userData[e])},async twinkle(e){let t=e;e&&e.startsWith("db:")&&(t=await Editor.Message.request("asset-db","query-uuid",e)),t&&Editor.Message.send("assets","twinkle",t)},async _onChangeTarget(e,t){const a=e.target.value;let i="";if(a){const e=await Editor.Message.request("asset-db","query-asset-info",a);if(!e)return;i=e.source}t.remapUuid=a,t.remap=i,this.meta.userData.imageMetas[t.index].remap=i},async _onMaterialDumpDirChange(e){const t=this,a=e.target.value;t.materialDumpDir=a;const i=path_1.join(Editor.Project.path,"assets");if(!Editor.Utils.Path.contains(i,a))return await Editor.Dialog.warn(Editor.I18n.t("inspector.asset.fbx.limitMaterialDumpDir"),{title:Editor.I18n.t("scene.messages.warning")}),void(t.materialDumpDir=t.materialDumpDirDefault);const n=await Editor.Message.request("asset-db","query-url",t.materialDumpDir);t.meta.userData.materialDumpDir=n},async refresh(){const e=this,t=await Editor.Message.request("asset-db","query-path",e.info.path)||"";e.materialDumpDirDefault=path_1.dirname(t);let a=e.materialDumpDirDefault;if(e.meta.userData.materialDumpDir){const t=await Editor.Message.request("asset-db","query-path",e.meta.userData.materialDumpDir);t&&(a=t)}e.materialDumpDir=a;const i=[];if(!e.meta||!e.meta.userData||!e.meta.userData.imageMetas)return void(e.images=i);const n=Object.keys(e.meta.userData.imageMetas);for(let t=0;t<n.length;t++){const a=n[t],s=e.meta.userData.imageMetas[a],r=s.uri;let l="";l.startsWith("data:")&&(l=s.uri);const o=await Editor.Message.request("asset-db","query-asset-info",r);if(o&&o.library){const e=Object.keys(o.library).find(e=>".json"!==e);e&&(l=o.library[e])}let u="";s.remap&&(u=await Editor.Message.request("asset-db","query-uuid",s.remap)),i.push({name:s.name||a,src:l,imageUuid:r,remapUuid:u,remap:s.remap,index:t})}e.images=i}},exports.directives={src:{inserted:getImageSrc,update:getImageSrc}},exports.watch={meta(){this.refresh()}},exports.mounted=mounted;