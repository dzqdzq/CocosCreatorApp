"use strict";function forEachFace(e,r,t){let c=0;const a=[];switch(r){case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:c=e.length/3;for(let r=0;r<c;r++)a[0]=e[3*r],a[1]=e[3*r+1],a[2]=e[3*r+2],t(a);break;case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:c=e.length-2;let i=0;for(let r=0;r<c;r++)a[0]=e[r-i],a[1]=e[r+i+1],a[2]=e[r+2],t(a),i=~i;break;case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:c=e.length-1;const o=e[0];for(let r=1;r<c;r++)a[0]=o,a[1]=e[r],a[2]=e[r+1],t(a);break;case ccm.gfx.PrimitiveMode.LINE_LIST:c=e.length/2;for(let r=0;r<c;r++)a[0]=e[2*r],a[1]=e[2*r+1],t(a);break;case ccm.gfx.PrimitiveMode.LINE_STRIP:c=e.length-1;for(let r=0;r<c;r++)a[0]=e[r],a[1]=e[r+1],t(a);break;case ccm.gfx.PrimitiveMode.LINE_LOOP:c=e.length;for(let r=0;r<c;r++)a[0]=e[r],a[1]=e[r+1===c?0:r+1],t(a);break;case ccm.gfx.PrimitiveMode.POINT_LIST:c=e.length;for(let r=0;r<c;r++)a[0]=e[r],t(a)}}function getUintArrayCtor(e){return e<1<<8*Uint8Array.BYTES_PER_ELEMENT?Uint8Array:e<1<<8*Uint16Array.BYTES_PER_ELEMENT?Uint16Array:Uint32Array}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUintArrayCtor=exports.splitBasedOnJoints=exports.forEachFace=exports.calculateTangents=exports.calculateNormals=void 0,exports.calculateNormals=(()=>{const{Vec3:e}=cc,r=new e,t=new e,c=new e,a=new e,i=new e,o=new e;return(n,l,s=[])=>{const m=l.length/3,f=n.length/3,d=Array(3*f).fill(0).map(()=>new e);for(let s=0;s<m;++s){const m=l[3*s+0],f=l[3*s+1],g=l[3*s+2];e.fromArray(r,n,3*m),e.fromArray(t,n,3*f),e.fromArray(c,n,3*g),e.subtract(a,t,r),e.subtract(i,c,r),e.cross(o,a,i),e.add(d[m],d[m],o),e.add(d[f],d[f],o),e.add(d[g],d[g],o)}for(let r=0;r<f;++r)e.toArray(s,e.normalize(o,d[r]),3*r);return s}})(),exports.calculateTangents=(()=>{const{Vec2:e,Vec3:r}=cc,t=new r,c=new r,a=new r,i=new r,o=new r,n=new e,l=new e,s=new e,m=new r,f=new r,d=new r,g=new r;return(u,y,A,x,I=[])=>{const T=y.length/3,E=u.length/3,P=Array(E).fill(0).map(()=>new r),L=Array(E).fill(0).map(()=>new r);for(let A=0;A<T;++A){const I=y[3*A+0],T=y[3*A+1],E=y[3*A+2];r.fromArray(t,u,3*I),r.fromArray(c,u,3*T),r.fromArray(a,u,3*E),e.fromArray(n,x,2*I),e.fromArray(l,x,2*T),e.fromArray(s,x,2*E),r.subtract(i,c,t),r.subtract(o,a,t);const S=l.x-n.x,p=s.x-n.x,h=l.y-n.y,w=s.y-n.y;let N=S*w-p*h;0!==N&&(N=1/N),r.multiplyScalar(m,r.subtract(d,r.multiplyScalar(d,i,w),r.multiplyScalar(g,o,h)),N),r.multiplyScalar(f,r.subtract(d,r.multiplyScalar(d,o,S),r.multiplyScalar(g,i,p)),N),r.add(P[I],P[I],m),r.add(P[T],P[T],m),r.add(P[E],P[E],m),r.add(L[I],L[I],f),r.add(L[T],L[T],f),r.add(L[E],L[E],f)}for(let e=0;e<E;++e){const t=P[e],c=L[e],a=r.fromArray(d,A,3*e);r.subtract(g,t,r.multiplyScalar(g,a,r.dot(t,a)/r.dot(a,a))),r.toArray(I,r.normalize(g,g),4*e),I[4*e+3]=r.dot(r.cross(g,c,t),a)>0?1:-1}return I}})(),exports.forEachFace=forEachFace,exports.splitBasedOnJoints=(()=>{class e{constructor(e=ccm.gfx.PrimitiveMode.TRIANGLE_LIST){this.indices=[],this.jointSet=new Set,this.primitiveMode=e}}return(r,t,c,a)=>{let i;switch(c){case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:i=ccm.gfx.PrimitiveMode.TRIANGLE_LIST;break;case ccm.gfx.PrimitiveMode.LINE_LIST:case ccm.gfx.PrimitiveMode.LINE_STRIP:case ccm.gfx.PrimitiveMode.LINE_LOOP:i=ccm.gfx.PrimitiveMode.LINE_LIST;break;case ccm.gfx.PrimitiveMode.POINT_LIST:i=ccm.gfx.PrimitiveMode.POINT_LIST}if(void 0===i)return[];const o=[new e(i)];let n=o[0];return forEachFace(t,c,t=>{(function(e,r,t,c){let a=0;for(let c=0;c<t.length;c++){const i=t[c];for(let t=0;t<4;t++)e.jointSet.has(r[4*i+t])||a++}return e.jointSet.size+a<=c})(n,r,t,a)||(n=new e(i),o.push(n)),function(e,r,t){for(let c=0;c<t.length;c++){const a=t[c];for(let t=0;t<4;t++)e.jointSet.add(r[4*a+t]);e.indices.push(a)}}(n,r,t)}),o}})(),exports.getUintArrayCtor=getUintArrayCtor;