"use strict";function forEachFace(e,t,r){let c=0;const a=[];switch(t){case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:c=e.length/3;for(let t=0;t<c;t++)a[0]=e[3*t],a[1]=e[3*t+1],a[2]=e[3*t+2],r(a);break;case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:c=e.length-2;let i=0;for(let t=0;t<c;t++)a[0]=e[t-i],a[1]=e[t+i+1],a[2]=e[t+2],r(a),i=~i;break;case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:c=e.length-1;const o=e[0];for(let t=1;t<c;t++)a[0]=o,a[1]=e[t],a[2]=e[t+1],r(a);break;case ccm.gfx.PrimitiveMode.LINE_LIST:c=e.length/2;for(let t=0;t<c;t++)a[0]=e[2*t],a[1]=e[2*t+1],r(a);break;case ccm.gfx.PrimitiveMode.LINE_STRIP:c=e.length-1;for(let t=0;t<c;t++)a[0]=e[t],a[1]=e[t+1],r(a);break;case ccm.gfx.PrimitiveMode.LINE_LOOP:c=e.length;for(let t=0;t<c;t++)a[0]=e[t],a[1]=e[t+1===c?0:t+1],r(a);break;case ccm.gfx.PrimitiveMode.POINT_LIST:c=e.length;for(let t=0;t<c;t++)a[0]=e[t],r(a)}}function getUintArrayCtor(e){return e<1<<8*Uint8Array.BYTES_PER_ELEMENT?Uint8Array:e<1<<8*Uint16Array.BYTES_PER_ELEMENT?Uint16Array:Uint32Array}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUintArrayCtor=exports.splitBasedOnJoints=exports.forEachFace=exports.calculateTangents=exports.calculateNormals=void 0,exports.calculateNormals=(()=>{const{Vec3:e}=cc,t=new e,r=new e,c=new e,a=new e,i=new e,o=new e;return(n,l,s=[])=>{const m=l.length/3,f=n.length/3,d=Array(3*f).fill(0).map(()=>new e);for(let s=0;s<m;++s){const m=l[3*s+0],f=l[3*s+1],g=l[3*s+2];e.fromArray(t,n,3*m),e.fromArray(r,n,3*f),e.fromArray(c,n,3*g),e.subtract(a,r,t),e.subtract(i,c,t),e.cross(o,a,i),e.add(d[m],d[m],o),e.add(d[f],d[f],o),e.add(d[g],d[g],o)}for(let t=0;t<f;++t)e.toArray(s,e.normalize(o,d[t]),3*t);return s}})(),exports.calculateTangents=(()=>{const{Vec2:e,Vec3:t}=cc,r=new t,c=new t,a=new t,i=new t,o=new t,n=new e,l=new e,s=new e,m=new t,f=new t,d=new t,g=new t;return(u,y,x,A,I=[])=>{const T=y.length/3,E=u.length/3,P=Array(E).fill(0).map(()=>new t),L=Array(E).fill(0).map(()=>new t);for(let x=0;x<T;++x){const I=y[3*x+0],T=y[3*x+1],E=y[3*x+2];t.fromArray(r,u,3*I),t.fromArray(c,u,3*T),t.fromArray(a,u,3*E),e.fromArray(n,A,2*I),e.fromArray(l,A,2*T),e.fromArray(s,A,2*E),t.subtract(i,c,r),t.subtract(o,a,r);const S=l.x-n.x,p=s.x-n.x,h=l.y-n.y,w=s.y-n.y;let N=S*w-p*h;0!==N&&(N=1/N),t.multiplyScalar(m,t.subtract(d,t.multiplyScalar(d,i,w),t.multiplyScalar(g,o,h)),N),t.multiplyScalar(f,t.subtract(d,t.multiplyScalar(d,o,S),t.multiplyScalar(g,i,p)),N),t.add(P[I],P[I],m),t.add(P[T],P[T],m),t.add(P[E],P[E],m),t.add(L[I],L[I],f),t.add(L[T],L[T],f),t.add(L[E],L[E],f)}for(let e=0;e<E;++e){const r=P[e],c=L[e],a=t.fromArray(d,x,3*e);t.subtract(g,r,t.multiplyScalar(g,a,t.dot(r,a)/t.dot(a,a))),0==t.dot(g,g)&&(a.x||a.z?t.set(g,a.z,0,-a.x):t.set(g,0,a.x,-a.y)),t.toArray(I,t.normalize(g,g),4*e),I[4*e+3]=t.dot(t.cross(g,c,r),a)>0?1:-1}return I}})(),exports.forEachFace=forEachFace,exports.splitBasedOnJoints=(()=>{class e{constructor(e=ccm.gfx.PrimitiveMode.TRIANGLE_LIST){this.indices=[],this.jointSet=new Set,this.primitiveMode=e}}return(t,r,c,a)=>{let i;switch(c){case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:i=ccm.gfx.PrimitiveMode.TRIANGLE_LIST;break;case ccm.gfx.PrimitiveMode.LINE_LIST:case ccm.gfx.PrimitiveMode.LINE_STRIP:case ccm.gfx.PrimitiveMode.LINE_LOOP:i=ccm.gfx.PrimitiveMode.LINE_LIST;break;case ccm.gfx.PrimitiveMode.POINT_LIST:i=ccm.gfx.PrimitiveMode.POINT_LIST}if(void 0===i)return[];const o=[new e(i)];let n=o[0];return forEachFace(r,c,r=>{(function(e,t,r,c){let a=0;for(let c=0;c<r.length;c++){const i=r[c];for(let r=0;r<4;r++)e.jointSet.has(t[4*i+r])||a++}return e.jointSet.size+a<=c})(n,t,r,a)||(n=new e(i),o.push(n)),function(e,t,r){for(let c=0;c<r.length;c++){const a=r[c];for(let r=0;r<4;r++)e.jointSet.add(t[4*a+r]);e.indices.push(a)}}(n,t,r)}),o}})(),exports.getUintArrayCtor=getUintArrayCtor;