"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findRootObject=exports.setName=exports.asAsset=void 0;const cc_1=require("cc");class DynamicBuilder{constructor(e){this.serializedList=[],e=e||{},this.stringify=!("stringify"in e&&!e.stringify),this.minify=!!e.minify,this.forceInline=!!e.forceInline}setProperty_Array(e,t,r,i){return this.addObject(i.writeOnlyArray,t,r,i.formerlySerializedAs,!1)}setProperty_Dict(e,t,r,i){return this.addObject({},t,r,null===i||void 0===i?void 0:i.formerlySerializedAs,!1)}addObject(e,t,r,i,s){let a=-1,o=e;const d=!t;return(!this.forceInline&&s||d)&&(a=this.serializedList.length,this.serializedList.push(e),this.forceInline||(o={__id__:a})),t&&(t.data[r]=o,i&&(t.data[i]=o)),{data:e,id:a}}setProperty_Class(e,t,r,i){const s={__type__:i.type};return this.addObject(s,t,r,i.formerlySerializedAs,!0)}setProperty_CustomizedClass(e,t,r,i){const s={__type__:i.type,content:i.content};return this.addObject(s,t,r,i.formerlySerializedAs,!0)}setProperty_ParsedObject(e,t,r,i){!this.forceInline&&r.id>=0?e.data[t]={__id__:r.id}:e.data[t]=r.data,i&&(e.data[i]=e.data[t])}setProperty_Raw(e,t,r,i,s){t.data[r]=i,(null===s||void 0===s?void 0:s.formerlySerializedAs)&&(t.data[s.formerlySerializedAs]=i)}setProperty_ValueType(e,t,r,i,s){const a={__type__:cc_1.js._getClassId(i,!1)},o=i.constructor.__values__;if(o)for(let e=0;e<o.length;e++){const t=o[e];a[t]=i[t]}return t?(t.data[r]=a,(null===s||void 0===s?void 0:s.formerlySerializedAs)&&(t.data[s.formerlySerializedAs]=a),{data:a,id:-1}):(this.serializedList.push(a),{data:a,id:0})}setProperty_TypedArray(e,t,r,i,s){const a={__type__:"TypedArray",ctor:i.constructor.name,array:Array.from(i)};t.data[r]=a,(null===s||void 0===s?void 0:s.formerlySerializedAs)&&(t.data[s.formerlySerializedAs]=a)}setProperty_AssetUuid(e,t,r,i,s){t.data[r]={__uuid__:i},(null===s||void 0===s?void 0:s.formerlySerializedAs)&&(t.data[s.formerlySerializedAs]=t.data[r])}setRoot(e){console.assert(0===e.id,`Wrong root object to serialize, id is ${e.id}`)}dump(){let e;return e=1!==this.serializedList.length||Array.isArray(this.serializedList[0])?this.serializedList:this.serializedList[0],this.stringify?JSON.stringify(e,null,this.minify?0:2):e}}function asAsset(e){if(!e)return cc_1.error("[EditorExtends.serialize.asAsset] The uuid must be non-nil!"),null;const t=new cc_1.Asset;return t._uuid=e,t}function setName(e,t){Array.isArray(e)?e[0]._name=t:e._name=t}function findRootObject(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++){const i=e[r];if(i.__type__===t)return i}else if(e.__type__===t)return e;return null}exports.default=DynamicBuilder,exports.asAsset=asAsset,exports.setName=setName,exports.findRootObject=findRootObject;