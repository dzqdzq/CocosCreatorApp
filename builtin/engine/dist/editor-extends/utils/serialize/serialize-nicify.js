"use strict";class RefInfos{constructor(){this.objList=[],this.keyList=[],this.referncedIDList=[],this.referencedCounts=[],this.temporaryDataList=[]}}var nicifySerialized=function(e){var t=e[0];if(void 0!==t){var r,i,s,n,a=new RefInfos;a.referencedCounts=new Array(e.length);var o=e.slice();_iterative(t,e,a);var f=0;for(f=0;f<a.temporaryDataList.length;f++)delete a.temporaryDataList[f]._iN$t;for(f=0;f<a.objList.length;f++)if(i=a.objList[f],r=a.referncedIDList[f],s=a.keyList[f],n=o[r],!(a.referencedCounts[r]>1)){i[s]=n;var c=e.indexOf(n);e.splice(c,1)}for(f=0;f<a.objList.length;f++)if(r=a.referncedIDList[f],s=a.keyList[f],i=a.objList[f],a.referencedCounts[r]>1){n=o[r];var d=e.indexOf(n);i[s].__id__=d}}},_iterative=function(e,t,r){if("object"==typeof e){if(e._iN$t=!0,r.temporaryDataList.push(e),e.content){var i=e.__type__&&cc.js._getClassById(e.__type__);if(i&&i.prototype._serialize)return}var s;if(Array.isArray(e))for(var n=0;n<e.length;n++)(s=e[n])&&_traversalChild(s,n,e,t,r);else for(var a in e)(s=e[a])&&_traversalChild(s,a,e,t,r)}},_traversalChild=function(e,t,r,i,s){var n=e.__id__,a=void 0!==n;a&&(e=i[n],-1!==s.referncedIDList.indexOf(n)?s.referencedCounts[n]++:s.referencedCounts[n]=1,s.referncedIDList.push(n),s.keyList.push(t),s.objList.push(r)),!e._iN$t?_iterative(e,i,s):a&&s.referencedCounts[n]++};module.exports=nicifySerialized;