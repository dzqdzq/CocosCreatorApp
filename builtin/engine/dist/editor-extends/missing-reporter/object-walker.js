"use strict";"use static";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNextProperty=exports.walkProperties=exports.walk=exports.ObjectWalker=exports.ObjectWalkerBehavior=void 0;class ObjectWalkerBehavior{constructor(e){this.root=e}walk(e,t,r){}parseObject(e){if(Array.isArray(e))this.forEach(e);else{var t=e.constructor;if((e instanceof cc.Asset||t!==Object&&!cc.js._getClassId(e,!1))&&e!==this.root)return;var r=t&&t.__props__;r?this.parseCCClass(e,t,r):this.forIn(e)}}parseCCClass(e,t,r){for(var s=cc.Class.Attr.getClassAttrs(t),a=0;a<r.length;a++){var o=r[a];!1!==s[o+cc.Class.Attr.DELIMETER+"serializable"]&&this.walk(e,o,e[o])}}forIn(e){for(var t in e)!e.hasOwnProperty(t)||95===t.charCodeAt(0)&&95===t.charCodeAt(1)||this.walk(e,t,e[t])}forEach(e){for(var t=0,r=e.length;t<r;++t)this.walk(e,""+t,e[t])}}exports.ObjectWalkerBehavior=ObjectWalkerBehavior;class ObjectWalker extends ObjectWalkerBehavior{constructor(e,t,r){if(super(e),this.walked=new Set,this.iteratee=t,this.parsedObjects=[],this.parsedKeys=[],this.walked.add(e),this.ignoreParent=r&&r.ignoreParent,this.ignoreSubPrefabHelper=r&&r.ignoreSubPrefabHelper,this.ignoreParent)if(this.root instanceof cc.Component)this.ignoreParent=this.root.node;else{if(!(this.root instanceof cc._BaseNode))return cc.error("can only ignore parent of scene node");this.ignoreParent=this.root}this.parseObject(e)}walk(e,t,r){if(r&&"object"==typeof r){if(this.walked.has(r))return;if(this.ignoreParent)if(r instanceof cc._BaseNode){if(!r.isChildOf(this.ignoreParent))return}else if(r instanceof cc.Component&&!r.node.isChildOf(this.ignoreParent))return;if(this.ignoreSubPrefabHelper&&r instanceof cc._PrefabInfo&&r.root!==e)return;this.walked.add(r),this.iteratee(e,t,r,this.parsedObjects,this.parsedKeys),this.parsedObjects.push(e),this.parsedKeys.push(t),this.parseObject(r),this.parsedObjects.pop(),this.parsedKeys.pop()}}}function walk(e,t){new ObjectWalker(e,t)}exports.ObjectWalker=ObjectWalker,exports.walk=walk;var staticDummyWalker=new ObjectWalkerBehavior(null);function doWalkProperties(e,t){staticDummyWalker.root=null,staticDummyWalker.walk=t,staticDummyWalker.parseObject(e)}function walkProperties(e,t,r){var s=r&&r.dontSkipNull;new ObjectWalker(e,function(e,r,a,o){!a||"object"!=typeof a||(o.push(e),doWalkProperties(a,function(e,r,a){"object"==typeof a&&(s||a)&&t(e,r,a,o)}),o.pop())},r)}function getNextProperty(e,t,r){var s,a=e.lastIndexOf(r);if(a===e.length-1)s=t;else{if(!(0<=a&&a<e.length-1))return"";s=e[a+1]}var o="";return doWalkProperties(r,function(e,t,r){r===s&&(o=t)}),o}exports.walkProperties=walkProperties,exports.getNextProperty=getNextProperty;