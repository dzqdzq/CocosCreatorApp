"use strict";"use static";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNextProperty=exports.walkProperties=exports.walk=exports.ObjectWalker=exports.ObjectWalkerBehavior=void 0;class ObjectWalkerBehavior{walk(e,t,r){}constructor(e){this.root=e}parseObject(e){if(Array.isArray(e))this.forEach(e);else{const t=e.constructor;if((e instanceof cc.Asset||t!==Object&&!cc.js.getClassId(e,!1))&&e!==this.root)return;const r=t&&t.__props__;r?this.parseCCClass(e,t,r):this.forIn(e)}}parseCCClass(e,t,r){const s=cc.Class.Attr.getClassAttrs(t);for(let t=0;t<r.length;t++){const o=r[t];!1!==s[o+cc.Class.Attr.DELIMETER+"serializable"]&&this.walk(e,o,e[o])}}forIn(e){for(const t in e)!e.hasOwnProperty(t)||95===t.charCodeAt(0)&&95===t.charCodeAt(1)||this.walk(e,t,e[t])}forEach(e){for(let t=0,r=e.length;t<r;++t)this.walk(e,""+t,e[t])}}exports.ObjectWalkerBehavior=ObjectWalkerBehavior;class ObjectWalker extends ObjectWalkerBehavior{constructor(e,t,r){if(super(e),this.walked=new Set,this.iteratee=t,this.parsedObjects=[],this.parsedKeys=[],this.walked.add(e),this.ignoreParent=r&&r.ignoreParent,this.ignoreSubPrefabHelper=r&&r.ignoreSubPrefabHelper,this.ignoreParent)if(this.root instanceof cc.Component)this.ignoreParent=this.root.node;else{if(!(this.root instanceof cc.Node))return cc.error("can only ignore parent of scene node");this.ignoreParent=this.root}this.parseObject(e)}walk(e,t,r){if(r&&"object"==typeof r){if(this.walked.has(r))return;if(this.ignoreParent)if(r instanceof cc.Node){if(!r.isChildOf(this.ignoreParent))return}else if(r instanceof cc.Component&&!r.node.isChildOf(this.ignoreParent))return;if(this.ignoreSubPrefabHelper&&r instanceof cc._PrefabInfo&&r.root!==e)return;this.walked.add(r),this.iteratee(e,t,r,this.parsedObjects,this.parsedKeys),this.parsedObjects.push(e),this.parsedKeys.push(t),this.parseObject(r),this.parsedObjects.pop(),this.parsedKeys.pop()}}}function walk(e,t){new ObjectWalker(e,t)}exports.ObjectWalker=ObjectWalker,exports.walk=walk;const staticDummyWalker=new ObjectWalkerBehavior(null);function doWalkProperties(e,t){staticDummyWalker.root=null,staticDummyWalker.walk=t,staticDummyWalker.parseObject(e)}function walkProperties(e,t,r){const s=r&&r.dontSkipNull;new ObjectWalker(e,function(e,r,o,i){!o||"object"!=typeof o||(i.push(e),doWalkProperties(o,function(e,r,o){"object"==typeof o&&(s||o)&&t(e,r,o,i)}),i.pop())},r)}function getNextProperty(e,t,r){let s;const o=e.lastIndexOf(r);if(o===e.length-1)s=t;else{if(!(0<=o&&o<e.length-1))return"";s=e[o+1]}let i="";return doWalkProperties(r,function(e,t,r){r===s&&(i=t)}),i}exports.walkProperties=walkProperties,exports.getNextProperty=getNextProperty;