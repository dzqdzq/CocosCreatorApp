"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MissingObjectReporter=void 0;const missing_reporter_1=require("./missing-reporter"),_=require("lodash"),ps=require("path"),ObjectWalker=require("./object-walker");class MissingObjectReporter extends missing_reporter_1.MissingReporter{doReport(e,s,t,i,o){let r,n,c="";if((r=e instanceof cc.Component||e instanceof cc.Asset?e:_.findLast(t,e=>e instanceof cc.Component||e instanceof cc.Asset))instanceof cc.Component){c=` by ${missing_reporter_1.MissingReporter.getObjectType(r)} "${cc.js.getClassName(r)}"`}else(r=_.findLast(t,e=>e instanceof cc.Node))&&(c=` by node "${r.name}"`);if("string"==typeof s)n=`Asset "${s}" used${c}${o} is missing.`;else{let e=cc.js.getClassName(s);e.startsWith("cc.")&&(e=e.slice(3)),n=s instanceof cc.Asset?`The ${e} used${c}${o} is missing.`:`The ${e} referenced${c}${o} is invalid.`}n+=missing_reporter_1.MissingReporter.INFO_DETAILED,r instanceof cc.Component&&(r=r.node);try{if(r instanceof cc.Node){let e=r,s=e.name;for(;e.parent&&!(e.parent instanceof cc.Scene);)s=`${(e=e.parent).name}/${s}`;n+=`Node path: "${s}"\n`}}catch(e){}i&&(n+=`Asset url: "${i}"\n`),s instanceof cc.Asset&&s._uuid&&(n+=`Missing uuid: "${s._uuid}"\n`),n.slice(0,-1),console[this.outputLevel]?console[this.outputLevel](n):console.warn(n)}report(){let e,s;if(this.root instanceof cc.Asset){try{globalThis.Manager&&globalThis.Manager.AssetWorker&&(s=globalThis.Manager.Utils.queryAssetInfo(this.root._uuid))}catch(e){console.error(e),s=null}e=s?s.path:null}const t=missing_reporter_1.MissingReporter.getObjectType(this.root),i=e?` in ${t} "${ps.basename(e)}"`:"";ObjectWalker.walk(this.root,(s,t,o,r,n)=>{this.missingObjects.has(o)&&this.doReport(s,o,r,e,i)})}reportByOwner(){let e,s;if(this.root instanceof cc.Asset){try{globalThis.Manager&&globalThis.Manager.AssetWorker&&(s=globalThis.Manager.Utils.queryAssetInfo(this.root._uuid))}catch(e){console.error(e),s=null}e=s?s.path:null}const t=missing_reporter_1.MissingReporter.getObjectType(this.root),i=e?` in ${t} "${ps.basename(e)}"`:"";ObjectWalker.walkProperties(this.root,(s,t,o,r)=>{const n=this.missingOwners.get(s);if(n&&t in n){const c=n[t];this.doReport(s,c||o,r,e,i)}},{dontSkipNull:!0})}}exports.MissingObjectReporter=MissingObjectReporter;