"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MissingObjectReporter=void 0;const missing_reporter_1=require("./missing-reporter");var _=require("lodash"),ps=require("path"),ObjectWalker=require("./object-walker");const pkg=require("@editor/package");class MissingObjectReporter extends missing_reporter_1.MissingReporter{doReport(e,s,t,i,r){var o,n,c="";(o=e instanceof cc.Component||e instanceof cc.Asset?e:_.findLast(t,e=>e instanceof cc.Component||e instanceof cc.Asset))instanceof cc.Component?c=` by ${missing_reporter_1.MissingReporter.getObjectType(o)} "${cc.js.getClassName(o)}"`:(o=_.findLast(t,e=>e instanceof cc.Node))&&(c=` by node "${o.name}"`);if("string"==typeof s)n=`Asset "${s}" used${c}${r} is missing.`;else{var a=cc.js.getClassName(s);a.startsWith("cc.")&&(a=a.slice(3)),n=s instanceof cc.Asset?`The ${a} used${c}${r} is missing.`:`The ${a} referenced${c}${r} is invalid.`}n+=missing_reporter_1.MissingReporter.INFO_DETAILED,o instanceof cc.Component&&(o=o.node),i&&(n+=`Asset url: "${i}"\n`),s instanceof cc.Asset&&s._uuid&&(n+=`Missing uuid: "${s._uuid}"\n`),n.slice(0,-1),console.error(n)}report(){var e;if(this.root instanceof cc.Asset){const s=pkg.execSync("asset-db","queryAssetInfo",this.root._uuid);e=s?s.path:null}var s=missing_reporter_1.MissingReporter.getObjectType(this.root),t=e?` in ${s} "${ps.basename(e)}"`:"";ObjectWalker.walk(this.root,(s,i,r,o,n)=>{this.missingObjects.has(r)&&this.doReport(s,r,o,e,t)})}reportByOwner(){var e;if(this.root instanceof cc.Asset){const s=pkg.execSync("asset-db","queryAssetInfo",this.root._uuid);e=s?s.path:null}var s=missing_reporter_1.MissingReporter.getObjectType(this.root),t=e?` in ${s} "${ps.basename(e)}"`:"";ObjectWalker.walkProperties(this.root,(s,i,r,o)=>{var n=this.missingOwners.get(s);if(n&&i in n){var c=n[i];this.doReport(s,c||r,o,e,t)}},{dontSkipNull:!0})}}exports.MissingObjectReporter=MissingObjectReporter;