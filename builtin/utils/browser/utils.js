"use strict";const{join:join,basename:basename,relative:relative}=require("path"),{copy:copy,readdir:readdir,existsSync:existsSync,readFile:readFile,outputFile:outputFile,stat:stat}=require("fs-extra"),privateExclude=["browser","browser.d.ts","renderer","renderer.d.ts","private","private.d.ts"],protectExclude=["protect","protect.d.ts"];exports.exportEditorDTS=async function(e,t=!1){const i=join(Editor.App.path,"@types"),o=t?privateExclude:[...protectExclude,...privateExclude];await exports.recursiveFile(i,async(t,o)=>{if(o.isDirectory())return;const r=relative(i,t),s=join(e,r),n=await readFile(t);await outputFile(s,n)},o);const r=join(e,"message.d.ts");let s=await readFile(r,"utf8");s=s.replace(/'\.\.\/builtin\/([^\/]+)\/@types\//g,(e,t)=>`'./packages/${t}/@types/`),await outputFile(r,s);const n=join(e,"editor.d.ts");let a=await readFile(n,"utf8");a="/// <reference path='./electron.d.ts'/>\n\n"+a,await outputFile(n,a)},exports.exportPackageDTS=async function(e,t=!1){const i={builtinExtensions:join(Editor.App.path,"builtin"),platformExtensions:join(Editor.App.path,"modules","platform-extensions","extensions"),editorExtensions:join(Editor.App.path,"modules","editor-extensions","extensions"),engineExtensions:join(Editor.App.path,"modules","engine-extensions","extensions")},o=t?privateExclude:[...protectExclude,...privateExclude];for(const t of Object.keys(i))try{const r=await readdir(i[t]);for(let s of r){const r=join(i[t],s,"@types");if(!existsSync(r))continue;const n=join(e,"packages",s,"@types");await exports.recursiveFile(r,async(e,t)=>{if(t.isDirectory())return;const i=relative(r,e),o=join(n,i),s=await readFile(e);await outputFile(o,s)},o)}}catch(e){console.error(`Export ${t} .d.ts failed.`),console.error(e)}},exports.recursiveFile=async function(e,t,i){await async function e(o){const r=await readdir(o);for(let s of r){if(i.includes(s))continue;const r=join(o,s),n=await stat(r);await t(r,n),n.isDirectory()&&await e(r)}}(e)};