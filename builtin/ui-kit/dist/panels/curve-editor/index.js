"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.style=exports.template=void 0;const fs_1=require("fs"),fs_extra_1=require("fs-extra"),path_1=require("path"),Vue=require("vue/dist/vue.js"),defaultPresets=fs_extra_1.readJSONSync(path_1.join(__dirname,"../../../static/curve-editor/preset.json"));let panel,vm;async function ready(...e){panel=this,await exports.methods.init()}async function beforeClose(){}async function close(){}function initVue(){let e=null;vm=new Vue({el:panel.$.presets,data(){var e;return{maxValue:{x:5,y:5},showSettings:!1,presets:{default:{},custom:{}},presetConfig:{negative:!(panel.option.config&&(null===(e=panel.option.config)||void 0===e?void 0:e.yRange[0])>=0),tab:"default"},newPreset:{name:""},value:panel.option&&panel.option.value,config:{showPreWrapMode:panel.option.config&&panel.option.config.showPreWrapMode||0,showPostWrapMode:panel.option.config&&panel.option.config.showPostWrapMode||0},label:panel.option.label}},methods:{onRemovePreset(e){this.$set(this.presets.custom,e,null),delete this.presets.custom[e],Editor.Profile.setConfig("ui-kit","curve-editor.customPresets",this.presets.custom,"global")},showPopup(){clearTimeout(e),e=setTimeout(()=>{vm.showSettings=!0},200)},hidePopup(){clearTimeout(e),e=setTimeout(()=>{vm.showSettings=!1},200)},async init(){const e=await Editor.Profile.getConfig("ui-kit","curve-editor.customPresets");this.presets.custom=e||{},this.presets.default=defaultPresets.default.map(e=>({keys:e})),panel.$.editor.curveCtrl.clear(),panel.$.editor.config=Object.assign(panel.$.editor.config,panel.option.config),panel.$.editor.initCurveCtrl(),panel.$.editor.value=this.value},onCurveSettings(e){const t=parseInt(e.target.value),o=e.target.getAttribute("name");switch(o){case"postWrapMode":case"preWrapMode":const e=this;panel.$.editor.curveCtrl.updateWrapMode(o,t),e.value[o]=t,panel.$.editor.value=e.value,Editor.Panel._kitControl.emit("change",panel.timestamp,e.value),Editor.Panel._kitControl.emit("confirm",panel.timestamp,e.value)}},onPreset(e){const t=e.target.getAttribute("index");if(!t)return;const o=this.presets[this.presetConfig.tab][t];o&&o.keys.length&&(vm.value.keys=o.keys,panel.$.editor.value=vm.value,Editor.Panel._kitControl.emit("change",panel.timestamp,vm.value),Editor.Panel._kitControl.emit("confirm",panel.timestamp,vm.value))},onNewPreset(){this.$set(this.presets.custom,this.newPreset.name,this.value),Editor.Profile.setConfig("ui-kit","curve-editor.customPresets",this.presets.custom,"global")},emit(e,t){vm.value.keys=e.target.value.keys,Editor.Panel._kitControl.emit(t,panel.timestamp,vm.value)},onMulti(e){const t=e.target.value,o=this;o.value.multiplier=t,panel.$.editor.curveCtrl.grid.yFormat=function(e){return parseFloat((e*(o.value.multiplier||1)/this.yMaxValue).toFixed(2))},panel.$.editor.curveCtrl.grid.updateLabels(),Editor.Panel._kitControl.emit("change",panel.timestamp,vm.value),Editor.Panel._kitControl.emit("confirm",panel.timestamp,vm.value)}},mounted(){panel.$.editor=this.$refs["curve-editor"],this.init()}})}function initCurveEditor(){}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../../static/curve-editor/index.html"),"utf8"),exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../curve-editor.css"),"utf8"),exports.$={editor:".editor",presets:".curve-editor"},exports.methods={async init(){const e=await Editor.Panel._kitControl.getOptionsCache();e&&(panel.option=e,panel.timestamp=e.timestamp,e.value.multiplier&&(e.config||(e.config={}),e.config.yFormat=function(t){return parseFloat((t*(e.value.multiplier||1)/this.yMaxValue).toFixed(2))}),vm?(vm.value=e.value,vm.label=e.label,vm.config.showPreWrapMode=e.config.showPreWrapMode,vm.config.showPostWrapMode=e.config.showPostWrapMode,vm.config.negative=!(e.config.yRange&&e.config.yRange[0]>=0),vm.presetConfig.negative=vm.config.negative,panel.$.editor.curveCtrl.clear(),panel.$.editor.config=Object.assign(panel.$.editor.config,e.config),panel.$.editor.initCurveCtrl(),panel.$.editor.value=e.value):initVue())},reset(){exports.methods.init()},clear(){}},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;