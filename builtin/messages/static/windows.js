"use strict";let Editor=global.Editor;Editor||(Editor=require("editor"));const requestQueue=[];let id=1;const methods={request(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g),r={process:"renderer",type:"request",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:id++};e.id=r.id,requestQueue.push(r),Editor.Message.send("messages","request",r)},reply(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g),r=requestQueue.find((s,r)=>{if(s.id===e.id)return requestQueue.splice(r,1),!0}),t={process:"renderer",type:"reply",name:e.name,message:e.message,source:s[3],timestamp:Date.now(),time:Date.now()-r.timestamp,args:e.args,id:r.id};Editor.Message.send("messages","reply",t)},send(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g),r={process:"renderer",type:"send",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:0};Editor.Message.send("messages","send",r)},broadcast(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g),r={process:"renderer",type:"broadcast",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:0};Editor.Message.send("messages","broadcast",r)},addListener(){Editor.Message.__eb__.on("request",methods.request),Editor.Message.__eb__.on("reply",methods.reply),Editor.Message.__eb__.on("send",methods.send),Editor.Message.__eb__.on("broadcast",methods.broadcast)},removeListener(){Editor.Message.__eb__.removeListener("request",methods.request),Editor.Message.__eb__.removeListener("reply",methods.reply),Editor.Message.__eb__.removeListener("send",methods.send),Editor.Message.__eb__.removeListener("broadcast",methods.broadcast)}};exports.load=function(){Editor.Message.addBroadcastListener("messages:start",methods.addListener),Editor.Message.addBroadcastListener("messages:stop",methods.removeListener)},exports.unload=function(){Editor.Message.removeBroadcastListener("messages:start",methods.addListener),Editor.Message.removeBroadcastListener("messages:stop",methods.removeListener)};