"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),fs_extra_1=require("fs-extra"),record_message_1=require("../../record-message"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./index.css"),"utf8"),exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static","./debug/index.html"),"utf8");const list=[];exports.$={content:".content"},exports.methods={broadcast(e){list.push(e),list.length>300&&list.shift()},request(e){e.loading=!0,list.push(e),list.length>300&&list.shift()},reply(e){const t=list.find(t=>t.id===e.id);t&&(t.loading=!1),list.push(e),list.length>300&&list.shift()},send(e){list.push(e),list.length>300&&list.shift()}},exports.ready=function(){Editor.Message.broadcast("messages:stop");const e={app:(0,path_1.join)(Editor.App.path,"builtin"),global:(0,path_1.join)(Editor.App.home,"packages"),local:(0,path_1.join)(Editor.Project.path,"packages")};new Vue({el:this.$.content,data:{list:list,message:null,record:!1,autoSave:!1},watch:{list(){const e=this.$refs.slider;e.clientHeight+e.scrollTop>e.scrollHeight-10&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight-e.clientHeight})}},async mounted(){const{hasRecord:e,autoSave:t}=await Editor.Message.request("messages","query-message-state");this.record=e,this.autoSave=t},methods:{start(){Editor.Message.send("messages","start-record"),this.record=!0},stop(){Editor.Message.send("messages","stop-record"),this.record=!1},clear(){for(this.message=null;list.length;)list.shift()},getURL:(t="")=>(t=t.substr(1,t.length-2),Editor.Utils.Path.contains(e.app,t)?"db://packages/"+(0,path_1.relative)(e.app,t):Editor.Utils.Path.contains(e.global,t)?"db://packages/"+(0,path_1.relative)(e.global,t):Editor.Utils.Path.contains(e.local,t)?"db://packages/"+(0,path_1.relative)(e.local,t):t),async save(){const e=await Editor.Dialog.save({title:"保存消息日志",path:Editor.Utils.File.getName(record_message_1.DefaultMessageLogFile)});e.filePath&&(await(0,record_message_1.saveMessageLog)(list,e.filePath),console.info(`output message file in {link(${e.filePath})}`))},async toggleAutoSave(e){const t=e.target.value;this.autoSave=t,t?Editor.Message.send("messages","start-auto-save"):Editor.Message.send("messages","stop-auto-save")}}})},exports.beforeClose=function(){},exports.close=function(){Editor.Message.send("messages","stop-record")};