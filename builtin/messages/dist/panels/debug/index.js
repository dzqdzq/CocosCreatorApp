"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),record_message_1=require("../../record-message"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const list=[],paths={app:(0,path_1.join)(Editor.App.path,"builtin"),global:(0,path_1.join)(Editor.App.home,"packages"),local:(0,path_1.join)(Editor.Project.path,"packages")},vueTemplate=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static","./debug/index.html"),"utf8"),MessagesDebugPanelVM=Vue.extend({name:"MessagesDebugPanelVM",data:()=>({list:list,message:null,record:!1,autoSave:!1}),watch:{list(){const e=this.$refs.slider;e.clientHeight+e.scrollTop>e.scrollHeight-10&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight-e.clientHeight})}},async mounted(){const{hasRecord:e,autoSave:s}=await Editor.Message.request("messages","query-message-state");this.record=e,this.autoSave=s},methods:{start(){Editor.Message.send("messages","start-record"),this.record=!0},stop(){Editor.Message.send("messages","stop-record"),this.record=!1},clear(){for(this.message=null;list.length;)list.shift()},getURL:(e="")=>(e=e.substr(1,e.length-2),Editor.Utils.Path.contains(paths.app,e)?"db://packages/"+(0,path_1.relative)(paths.app,e):Editor.Utils.Path.contains(paths.global,e)?"db://packages/"+(0,path_1.relative)(paths.global,e):Editor.Utils.Path.contains(paths.local,e)?"db://packages/"+(0,path_1.relative)(paths.local,e):e),async save(){const e=await Editor.Dialog.save({title:"Saving Message Logs",path:Editor.Utils.File.getName(record_message_1.DefaultMessageLogFile)});e.filePath&&(await(0,record_message_1.saveMessageLog)(list,e.filePath),console.info(`output message file in {link(${e.filePath})}`))},async toggleAutoSave(e){const s=e.target.value;this.autoSave=s,s?Editor.Message.send("messages","start-auto-save"):Editor.Message.send("messages","stop-auto-save")}},template:vueTemplate});function ready(){var e;Editor.Message.broadcast("messages:stop"),null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=new MessagesDebugPanelVM,this.vm.$mount(this.$.container)}function close(){var e;Editor.Message.send("messages","stop-record"),null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=null}exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./index.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"},exports.methods={broadcast(e){list.push(e),list.length>300&&list.shift()},request(e){e.loading=!0,list.push(e),list.length>300&&list.shift()},reply(e){const s=list.find(s=>s.id===e.id);s&&(s.loading=!1),list.push(e),list.length>300&&list.shift()},send(e){list.push(e),list.length>300&&list.shift()}},exports.ready=ready,exports.close=close;