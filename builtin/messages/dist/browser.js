"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const requestQueue=[];let id=0;function load(){Editor.Package.getPackages().forEach(exports.methods.attach),Editor.Package.on("enable",e=>{exports.methods.attach(e)}),Editor.Package.on("disable",exports.methods.detach)}function unload(){Editor.Package.removeListener("enable",exports.methods.attach),Editor.Package.removeListener("disable",exports.methods.detach)}exports.methods={request(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g)||[],t={process:"browser",type:"request",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:id++};e.id=t.id,requestQueue.push(t),Editor.Message.send("messages","request",t)},reply(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g)||[],t=requestQueue.find((s,t)=>{if(s.id===e.id)return requestQueue.splice(t,1),!0}),r={process:"browser",type:"reply",name:e.name,message:e.message,source:s[3],timestamp:Date.now(),time:Date.now()-(t?t.timestamp:0),args:e.args,id:t?t.id:0};Editor.Message.send("messages","reply",r)},send(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g)||[],t={process:"browser",type:"send",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:0};Editor.Message.send("messages","send",t)},broadcast(e){if("messages"===e.name)return;const s=new Error("message").stack.match(/\(.*\)/g)||[],t={process:"browser",type:"broadcast",name:e.name,message:e.message,source:s[4],timestamp:Date.now(),time:0,args:e.args,id:0};Editor.Message.send("messages","broadcast",t)},addListener(){Editor.Message.__eb__.on("request",exports.methods.request),Editor.Message.__eb__.on("reply",exports.methods.reply),Editor.Message.__eb__.on("send",exports.methods.send),Editor.Message.__eb__.on("broadcast",exports.methods.broadcast)},removeListener(){Editor.Message.__eb__.removeListener("request",exports.methods.request),Editor.Message.__eb__.removeListener("reply",exports.methods.reply),Editor.Message.__eb__.removeListener("send",exports.methods.send),Editor.Message.__eb__.removeListener("broadcast",exports.methods.broadcast)},open(){Editor.Panel.open("messages")},openDebug(){Editor.Panel.open("messages.debug")},attach(e){e.invalid||(e.name,e.info,e.info.contributions&&e.info.contributions.messages&&Editor.Message.__register__(e.name,e.info.contributions.messages))},detach(e){Editor.Message.__unregister__(e.name)}},exports.load=load,exports.unload=unload;