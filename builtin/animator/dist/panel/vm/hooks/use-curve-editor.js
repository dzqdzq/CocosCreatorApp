"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useCurveEditor = exports.generateOperateHandler = void 0;
const vue_js_1 = require("vue/dist/vue.js");
function generateOperateHandler(map) {
    const func = (...args) => {
        const operate = args[0];
        map[operate]?.apply(undefined, args);
    };
    return func;
}
exports.generateOperateHandler = generateOperateHandler;
function useCurveEditor(options) {
    const { size: boxSize, configure } = options;
    const visible = (0, vue_js_1.ref)(false);
    const element = (0, vue_js_1.ref)();
    const initialized = (0, vue_js_1.ref)(false);
    function getElement() {
        const el = (0, vue_js_1.unref)(element);
        if (!el) {
            throw new Error(`curve editor element is not ready`);
        }
        return el;
    }
    const show = () => {
        if (visible.value) {
            return;
        }
        visible.value = true;
        (0, vue_js_1.nextTick)(() => {
            if (!visible.value) {
                return;
            }
            const el = getElement();
            // FIXME: 在第一次显示时重新执行一次初始化配置动作。
            // CurveEditor 内部有计算逻辑依赖了元素高度，隐藏的时候计算值不正确，需要在显示的时候重新计算
            // 如 xAxis yAxis init 时需要 grid.canvas.width, grid.canvas.height
            if (!initialized.value) {
                configure(el);
                initialized.value = true;
            }
            resize();
        });
    };
    const hide = () => {
        if (!visible.value) {
            return;
        }
        visible.value = false;
    };
    const resize = (width, height) => {
        const el = (0, vue_js_1.unref)(element);
        if (!el)
            return;
        if (width === undefined) {
            width = (0, vue_js_1.unref)(boxSize.width);
        }
        if (height === undefined) {
            height = (0, vue_js_1.unref)(boxSize.height);
        }
        el.resize(width, height);
    };
    const paint = (data) => {
        const el = (0, vue_js_1.unref)(element);
        if (!el)
            return;
        el.curveCtrl.paint(data);
    };
    return {
        element,
        getElement,
        visible,
        show,
        hide,
        resize,
        paint,
    };
}
exports.useCurveEditor = useCurveEditor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlLWN1cnZlLWVkaXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NvdXJjZS9wYW5lbC92bS9ob29rcy91c2UtY3VydmUtZWRpdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDRDQVd5QjtBQWtDekIsU0FBZ0Isc0JBQXNCLENBQUMsR0FBdUQ7SUFDMUYsTUFBTSxJQUFJLEdBQXdCLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtRQUMxQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDO0lBQ0YsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQU5ELHdEQU1DO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLE9BQTZCO0lBQ3hELE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxHQUFHLE9BQU8sQ0FBQztJQUU3QyxNQUFNLE9BQU8sR0FBRyxJQUFBLFlBQUcsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFBLFlBQUcsR0FBcUIsQ0FBQztJQUN6QyxNQUFNLFdBQVcsR0FBRyxJQUFBLFlBQUcsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUUvQixTQUFTLFVBQVU7UUFDZixNQUFNLEVBQUUsR0FBRyxJQUFBLGNBQUssRUFBQyxPQUFPLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1NBQ3hEO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsTUFBTSxJQUFJLEdBQUcsR0FBRyxFQUFFO1FBQ2QsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ2YsT0FBTztTQUNWO1FBQ0QsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFFckIsSUFBQSxpQkFBUSxFQUFDLEdBQUcsRUFBRTtZQUNWLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO2dCQUNoQixPQUFPO2FBQ1Y7WUFDRCxNQUFNLEVBQUUsR0FBRyxVQUFVLEVBQUUsQ0FBQztZQUV4QiwrQkFBK0I7WUFDL0Isc0RBQXNEO1lBQ3RELCtEQUErRDtZQUMvRCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTtnQkFDcEIsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNkLFdBQVcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO2FBQzVCO1lBQ0QsTUFBTSxFQUFFLENBQUM7UUFDYixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQUNGLE1BQU0sSUFBSSxHQUFHLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ2hCLE9BQU87U0FDVjtRQUNELE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQzFCLENBQUMsQ0FBQztJQUVGLE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBYyxFQUFFLE1BQWUsRUFBRSxFQUFFO1FBQy9DLE1BQU0sRUFBRSxHQUFHLElBQUEsY0FBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxFQUFFO1lBQUUsT0FBTztRQUVoQixJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDckIsS0FBSyxHQUFHLElBQUEsY0FBSyxFQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNoQztRQUNELElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtZQUN0QixNQUFNLEdBQUcsSUFBQSxjQUFLLEVBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ2xDO1FBRUQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDN0IsQ0FBQyxDQUFDO0lBRUYsTUFBTSxLQUFLLEdBQUcsQ0FBQyxJQUFvQyxFQUFFLEVBQUU7UUFDbkQsTUFBTSxFQUFFLEdBQUcsSUFBQSxjQUFLLEVBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLEVBQUU7WUFBRSxPQUFPO1FBRWhCLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQztJQUVGLE9BQU87UUFDSCxPQUFPO1FBQ1AsVUFBVTtRQUVWLE9BQU87UUFDUCxJQUFJO1FBQ0osSUFBSTtRQUVKLE1BQU07UUFDTixLQUFLO0tBQ1IsQ0FBQztBQUNOLENBQUM7QUE1RUQsd0NBNEVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBjb21wdXRlZCxcbiAgICByZWYsXG4gICAgd2F0Y2gsXG4gICAgb25Nb3VudGVkLFxuICAgIG9uVW5tb3VudGVkLFxuICAgIFJlZixcbiAgICB1bnJlZixcbiAgICBuZXh0VGljayxcbiAgICB3YXRjaEVmZmVjdCxcbiAgICB0b1JlZixcbn0gZnJvbSAndnVlL2Rpc3QvdnVlLmpzJztcblxuaW1wb3J0IHsgSFRNTEN1c3RvbUVsZW1lbnQsIElDdXJ2ZUtleUluZm9zLCBJQ3VydmVWYWx1ZSwgTWF5YmVSZWYgfSBmcm9tICcuLi8uLi8uLi8uLi9AdHlwZXMvcHJpdmF0ZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlckN1cnZlQmFzZU9wdGlvbnMge1xuICAgIHNpemU6IHsgd2lkdGg6IE1heWJlUmVmPG51bWJlcj47IGhlaWdodDogTWF5YmVSZWY8bnVtYmVyPiB9O1xuICAgIGNvbmZpZ3VyZShlbDogSFRNTEN1c3RvbUVsZW1lbnQpOiB2b2lkO1xufVxuXG5leHBvcnQgdHlwZSBDdXJ2ZU9wZXJhdGVIYW5kbGVyID0gKFxuICAgIG9wZXJhdGU6IEN1cnZlT3BlcmF0ZSxcbiAgICBjdXJ2ZUtleUZyYW1lczogSUN1cnZlS2V5SW5mb3NbXSxcbiAgICB0YXJnZXRGcmFtZT86IG51bWJlcixcbikgPT4gdm9pZDtcblxuZXhwb3J0IHR5cGUgQ3VydmVPcGVyYXRlID1cbiAgICB8ICdzZWxlY3QnXG4gICAgfCAnZGItc2VsZWN0J1xuICAgIHwgJ3Vuc2VsZWN0J1xuICAgIHwgJ2NyZWF0ZS1rZXlzJ1xuICAgIHwgJ3JlbW92ZS1rZXlzJ1xuICAgIHwgJ21vdmUta2V5cydcbiAgICB8ICdzY2FsZS1rZXlzJ1xuICAgIHwgJ2FwcGx5LWJlemllcidcbiAgICB8ICdjb3B5J1xuICAgIHwgJ3NlbGVjdC1jdXJ2ZSdcbiAgICB8ICdzZWxlY3QtY3VydmUtY2xpcCdcbiAgICB8ICdtb3ZlLWN1cnZlJ1xuICAgIHwgJ2NoYW5nZS10YW5nZW50LXdlaWdodCdcbiAgICB8ICdjaGFuZ2UtaW50ZXJwLW1vZGUnXG4gICAgfCAnY2hhbmdlLWJyb2tlbi1zdGF0ZSdcbiAgICB8ICdwYXN0ZSdcbiAgICB8ICd0YW5nZW50JztcblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlT3BlcmF0ZUhhbmRsZXIobWFwOiBQYXJ0aWFsPFJlY29yZDxDdXJ2ZU9wZXJhdGUsIEN1cnZlT3BlcmF0ZUhhbmRsZXI+Pikge1xuICAgIGNvbnN0IGZ1bmM6IEN1cnZlT3BlcmF0ZUhhbmRsZXIgPSAoLi4uYXJncykgPT4ge1xuICAgICAgICBjb25zdCBvcGVyYXRlID0gYXJnc1swXTtcbiAgICAgICAgbWFwW29wZXJhdGVdPy5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VDdXJ2ZUVkaXRvcihvcHRpb25zOiBVc2VyQ3VydmVCYXNlT3B0aW9ucykge1xuICAgIGNvbnN0IHsgc2l6ZTogYm94U2l6ZSwgY29uZmlndXJlIH0gPSBvcHRpb25zO1xuXG4gICAgY29uc3QgdmlzaWJsZSA9IHJlZihmYWxzZSk7XG4gICAgY29uc3QgZWxlbWVudCA9IHJlZjxIVE1MQ3VzdG9tRWxlbWVudD4oKTtcbiAgICBjb25zdCBpbml0aWFsaXplZCA9IHJlZihmYWxzZSk7XG5cbiAgICBmdW5jdGlvbiBnZXRFbGVtZW50KCkge1xuICAgICAgICBjb25zdCBlbCA9IHVucmVmKGVsZW1lbnQpO1xuICAgICAgICBpZiAoIWVsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGN1cnZlIGVkaXRvciBlbGVtZW50IGlzIG5vdCByZWFkeWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbDtcbiAgICB9XG5cbiAgICBjb25zdCBzaG93ID0gKCkgPT4ge1xuICAgICAgICBpZiAodmlzaWJsZS52YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZpc2libGUudmFsdWUgPSB0cnVlO1xuXG4gICAgICAgIG5leHRUaWNrKCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdmlzaWJsZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsID0gZ2V0RWxlbWVudCgpO1xuXG4gICAgICAgICAgICAvLyBGSVhNRTog5Zyo56ys5LiA5qyh5pi+56S65pe26YeN5paw5omn6KGM5LiA5qyh5Yid5aeL5YyW6YWN572u5Yqo5L2c44CCXG4gICAgICAgICAgICAvLyBDdXJ2ZUVkaXRvciDlhoXpg6jmnInorqHnrpfpgLvovpHkvp3otZbkuoblhYPntKDpq5jluqbvvIzpmpDol4/nmoTml7blgJnorqHnrpflgLzkuI3mraPnoa7vvIzpnIDopoHlnKjmmL7npLrnmoTml7blgJnph43mlrDorqHnrpdcbiAgICAgICAgICAgIC8vIOWmgiB4QXhpcyB5QXhpcyBpbml0IOaXtumcgOimgSBncmlkLmNhbnZhcy53aWR0aCwgZ3JpZC5jYW52YXMuaGVpZ2h0XG4gICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY29uZmlndXJlKGVsKTtcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplZC52YWx1ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNpemUoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCBoaWRlID0gKCkgPT4ge1xuICAgICAgICBpZiAoIXZpc2libGUudmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2aXNpYmxlLnZhbHVlID0gZmFsc2U7XG4gICAgfTtcblxuICAgIGNvbnN0IHJlc2l6ZSA9ICh3aWR0aD86IG51bWJlciwgaGVpZ2h0PzogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGVsID0gdW5yZWYoZWxlbWVudCk7XG4gICAgICAgIGlmICghZWwpIHJldHVybjtcblxuICAgICAgICBpZiAod2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgd2lkdGggPSB1bnJlZihib3hTaXplLndpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGVpZ2h0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlaWdodCA9IHVucmVmKGJveFNpemUuaGVpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICB9O1xuXG4gICAgY29uc3QgcGFpbnQgPSAoZGF0YTogSUN1cnZlVmFsdWUgfCBudWxsIHwgdW5kZWZpbmVkKSA9PiB7XG4gICAgICAgIGNvbnN0IGVsID0gdW5yZWYoZWxlbWVudCk7XG4gICAgICAgIGlmICghZWwpIHJldHVybjtcblxuICAgICAgICBlbC5jdXJ2ZUN0cmwucGFpbnQoZGF0YSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQsXG4gICAgICAgIGdldEVsZW1lbnQsXG5cbiAgICAgICAgdmlzaWJsZSxcbiAgICAgICAgc2hvdyxcbiAgICAgICAgaGlkZSxcblxuICAgICAgICByZXNpemUsXG4gICAgICAgIHBhaW50LFxuICAgIH07XG59XG4iXX0=