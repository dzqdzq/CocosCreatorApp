"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useGridScrollSync = exports.useScrollVm = void 0;
const vue_js_1 = require("vue/dist/vue.js");
const grid_ctrl_1 = require("../../share/grid-ctrl");
function useScrollVm() {
    // 根据目前的组件实现逻辑，这里都是百分比值，scale + offset <= 1
    const scale = (0, vue_js_1.ref)(1);
    const offset = (0, vue_js_1.ref)(0);
    const onChange = (event) => {
        const data = event.detail;
        scale.value = data.scale;
        offset.value = data.offset;
    };
    const onConfirm = (event) => {
        const data = event.detail;
        scale.value = data.scale;
        offset.value = data.offset;
    };
    const reset = () => {
        scale.value = 1;
        offset.value = 0;
    };
    return {
        scale,
        offset,
        onChange,
        onConfirm,
        reset,
    };
}
exports.useScrollVm = useScrollVm;
function useGridScrollSync(options) {
    const { curveElement: curveEl, emitGlobalTransform } = options;
    const getCurveCtrl = () => {
        return curveEl.value?.curveCtrl;
    };
    const { offset: xOffset, scale: xScale, onChange: handleXChange } = useScrollVm();
    const { offset: yOffset, scale: yScale, onChange: handleYChange } = useScrollVm();
    const updateGlobalGrid = () => {
        const curveCtrl = getCurveCtrl();
        if (grid_ctrl_1.gridCtrl.grid && curveCtrl) {
            // 只同步 x 轴。y 轴独立，不处理
            (0, grid_ctrl_1.syncAxisX)(curveCtrl.grid, grid_ctrl_1.gridCtrl.grid);
        }
    };
    const updateScrollFromCurve = () => {
        const curveCtrl = getCurveCtrl();
        if (curveCtrl) {
            const scrollData = curveCtrl.getScroll();
            xScale.value = scrollData.xScale;
            xOffset.value = scrollData.xOffset;
            yScale.value = scrollData.yScale;
            yOffset.value = scrollData.yOffset;
        }
    };
    const onTransform = () => {
        updateGlobalGrid();
        updateScrollFromCurve();
        emitGlobalTransform();
    };
    const onXChange = (event) => {
        handleXChange(event);
        const curveCtrl = getCurveCtrl();
        if (!curveCtrl) {
            return;
        }
        curveCtrl.setScroll({
            xOffset: xOffset.value,
            xScale: xScale.value,
            yOffset: yOffset.value,
            yScale: yScale.value,
        });
        updateGlobalGrid();
        emitGlobalTransform();
        // TODO: 暂时在根组件中统一针对 transform 事件做 repaint。后续要做逻辑拆分
        // curveCtrl.repaint();
    };
    const onYChange = (event) => {
        handleYChange(event);
        const curveCtrl = getCurveCtrl();
        if (!curveCtrl) {
            return;
        }
        curveCtrl.setScroll({
            yOffset: yOffset.value,
            yScale: yScale.value,
            xScale: xScale.value,
            xOffset: xOffset.value,
        });
        updateGlobalGrid();
        emitGlobalTransform();
        // curveCtrl.repaint();
    };
    return {
        xOffset,
        xScale,
        yOffset,
        yScale,
        onTransform,
        onXChange,
        onYChange,
        updateScrollFromCurve,
        updateGlobalGrid,
    };
}
exports.useGridScrollSync = useGridScrollSync;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlLWdyaWQtc2Nyb2xsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc291cmNlL3BhbmVsL3ZtL2hvb2tzL3VzZS1ncmlkLXNjcm9sbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw0Q0FBcUQ7QUFJckQscURBQTREO0FBSzVELFNBQWdCLFdBQVc7SUFDdkIsMkNBQTJDO0lBQzNDLE1BQU0sS0FBSyxHQUFHLElBQUEsWUFBRyxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JCLE1BQU0sTUFBTSxHQUFHLElBQUEsWUFBRyxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXRCLE1BQU0sUUFBUSxHQUFHLENBQUMsS0FBbUMsRUFBRSxFQUFFO1FBQ3JELE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFFMUIsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUMvQixDQUFDLENBQUM7SUFFRixNQUFNLFNBQVMsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRTtRQUN0RCxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBRTFCLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN6QixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDL0IsQ0FBQyxDQUFDO0lBRUYsTUFBTSxLQUFLLEdBQUcsR0FBRyxFQUFFO1FBQ2YsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDaEIsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDckIsQ0FBQyxDQUFDO0lBRUYsT0FBTztRQUNILEtBQUs7UUFDTCxNQUFNO1FBQ04sUUFBUTtRQUNSLFNBQVM7UUFDVCxLQUFLO0tBQ1IsQ0FBQztBQUNOLENBQUM7QUEvQkQsa0NBK0JDO0FB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Qix1QkFBdUI7SUFDM0IsQ0FBQyxDQUFDO0lBRUYsT0FBTztRQUNILE9BQU87UUFDUCxNQUFNO1FBQ04sT0FBTztRQUNQLE1BQU07UUFFTixXQUFXO1FBQ1gsU0FBUztRQUNULFNBQVM7UUFFVCxxQkFBcUI7UUFDckIsZ0JBQWdCO0tBQ25CLENBQUM7QUFDTixDQUFDO0FBekZELDhDQXlGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlZiwgcmVhY3RpdmUsIFJlZiB9IGZyb20gJ3Z1ZS9kaXN0L3Z1ZS5qcyc7XG5pbXBvcnQgeyBDdXJ2ZUVkaXRvciB9IGZyb20gJ0BlZGl0b3IvY3JlYXRvci11aS1raXQvZGlzdC9yZW5kZXJlcic7XG5cbmltcG9ydCB7IHVzZUdyaWRTdG9yZSB9IGZyb20gJy4vc3RvcmUtZ3JpZCc7XG5pbXBvcnQgeyBncmlkQ3RybCwgc3luY0F4aXNYIH0gZnJvbSAnLi4vLi4vc2hhcmUvZ3JpZC1jdHJsJztcblxuZXhwb3J0IHR5cGUgQ2hhbmdlRXZlbnREYXRhID0geyBzY2FsZTogbnVtYmVyOyBvZmZzZXQ6IG51bWJlciB9O1xuZXhwb3J0IHR5cGUgQ2hhbmdlRXZlbnRIYW5kbGVyID0gKGV2ZW50OiBDdXN0b21FdmVudDxDaGFuZ2VFdmVudERhdGE+KSA9PiB2b2lkO1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlU2Nyb2xsVm0oKSB7XG4gICAgLy8g5qC55o2u55uu5YmN55qE57uE5Lu25a6e546w6YC76L6R77yM6L+Z6YeM6YO95piv55m+5YiG5q+U5YC877yMc2NhbGUgKyBvZmZzZXQgPD0gMVxuICAgIGNvbnN0IHNjYWxlID0gcmVmKDEpO1xuICAgIGNvbnN0IG9mZnNldCA9IHJlZigwKTtcblxuICAgIGNvbnN0IG9uQ2hhbmdlID0gKGV2ZW50OiBDdXN0b21FdmVudDxDaGFuZ2VFdmVudERhdGE+KSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBldmVudC5kZXRhaWw7XG5cbiAgICAgICAgc2NhbGUudmFsdWUgPSBkYXRhLnNjYWxlO1xuICAgICAgICBvZmZzZXQudmFsdWUgPSBkYXRhLm9mZnNldDtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25Db25maXJtID0gKGV2ZW50OiBDdXN0b21FdmVudDxDaGFuZ2VFdmVudERhdGE+KSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBldmVudC5kZXRhaWw7XG5cbiAgICAgICAgc2NhbGUudmFsdWUgPSBkYXRhLnNjYWxlO1xuICAgICAgICBvZmZzZXQudmFsdWUgPSBkYXRhLm9mZnNldDtcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgICAgIHNjYWxlLnZhbHVlID0gMTtcbiAgICAgICAgb2Zmc2V0LnZhbHVlID0gMDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NhbGUsXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgIG9uQ29uZmlybSxcbiAgICAgICAgcmVzZXQsXG4gICAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHcmlkU2Nyb2xsU3luY09wdGlvbnMge1xuICAgIGN1cnZlRWxlbWVudDogUmVmPEVkaXRvci5VSS5IVE1MQ3VzdG9tRWxlbWVudCB8IHVuZGVmaW5lZD47XG4gICAgZW1pdEdsb2JhbFRyYW5zZm9ybTogKCkgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUdyaWRTY3JvbGxTeW5jKG9wdGlvbnM6IEdyaWRTY3JvbGxTeW5jT3B0aW9ucykge1xuICAgIGNvbnN0IHsgY3VydmVFbGVtZW50OiBjdXJ2ZUVsLCBlbWl0R2xvYmFsVHJhbnNmb3JtIH0gPSBvcHRpb25zO1xuXG4gICAgY29uc3QgZ2V0Q3VydmVDdHJsID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gY3VydmVFbC52YWx1ZT8uY3VydmVDdHJsO1xuICAgIH07XG5cbiAgICBjb25zdCB7IG9mZnNldDogeE9mZnNldCwgc2NhbGU6IHhTY2FsZSwgb25DaGFuZ2U6IGhhbmRsZVhDaGFuZ2UgfSA9IHVzZVNjcm9sbFZtKCk7XG4gICAgY29uc3QgeyBvZmZzZXQ6IHlPZmZzZXQsIHNjYWxlOiB5U2NhbGUsIG9uQ2hhbmdlOiBoYW5kbGVZQ2hhbmdlIH0gPSB1c2VTY3JvbGxWbSgpO1xuXG4gICAgY29uc3QgdXBkYXRlR2xvYmFsR3JpZCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgY3VydmVDdHJsID0gZ2V0Q3VydmVDdHJsKCk7XG4gICAgICAgIGlmIChncmlkQ3RybC5ncmlkICYmIGN1cnZlQ3RybCkge1xuICAgICAgICAgICAgLy8g5Y+q5ZCM5q2lIHgg6L2044CCeSDovbTni6znq4vvvIzkuI3lpITnkIZcbiAgICAgICAgICAgIHN5bmNBeGlzWChjdXJ2ZUN0cmwuZ3JpZCwgZ3JpZEN0cmwuZ3JpZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHVwZGF0ZVNjcm9sbEZyb21DdXJ2ZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgY3VydmVDdHJsID0gZ2V0Q3VydmVDdHJsKCk7XG4gICAgICAgIGlmIChjdXJ2ZUN0cmwpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbERhdGEgPSBjdXJ2ZUN0cmwuZ2V0U2Nyb2xsKCk7XG5cbiAgICAgICAgICAgIHhTY2FsZS52YWx1ZSA9IHNjcm9sbERhdGEueFNjYWxlO1xuICAgICAgICAgICAgeE9mZnNldC52YWx1ZSA9IHNjcm9sbERhdGEueE9mZnNldDtcbiAgICAgICAgICAgIHlTY2FsZS52YWx1ZSA9IHNjcm9sbERhdGEueVNjYWxlO1xuICAgICAgICAgICAgeU9mZnNldC52YWx1ZSA9IHNjcm9sbERhdGEueU9mZnNldDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBvblRyYW5zZm9ybSA9ICgpID0+IHtcbiAgICAgICAgdXBkYXRlR2xvYmFsR3JpZCgpO1xuICAgICAgICB1cGRhdGVTY3JvbGxGcm9tQ3VydmUoKTtcblxuICAgICAgICBlbWl0R2xvYmFsVHJhbnNmb3JtKCk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uWENoYW5nZTogQ2hhbmdlRXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIGhhbmRsZVhDaGFuZ2UoZXZlbnQpO1xuXG4gICAgICAgIGNvbnN0IGN1cnZlQ3RybCA9IGdldEN1cnZlQ3RybCgpO1xuICAgICAgICBpZiAoIWN1cnZlQ3RybCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGN1cnZlQ3RybC5zZXRTY3JvbGwoe1xuICAgICAgICAgICAgeE9mZnNldDogeE9mZnNldC52YWx1ZSxcbiAgICAgICAgICAgIHhTY2FsZTogeFNjYWxlLnZhbHVlLFxuICAgICAgICAgICAgeU9mZnNldDogeU9mZnNldC52YWx1ZSxcbiAgICAgICAgICAgIHlTY2FsZTogeVNjYWxlLnZhbHVlLFxuICAgICAgICB9KTtcblxuICAgICAgICB1cGRhdGVHbG9iYWxHcmlkKCk7XG4gICAgICAgIGVtaXRHbG9iYWxUcmFuc2Zvcm0oKTtcblxuICAgICAgICAvLyBUT0RPOiDmmoLml7blnKjmoLnnu4Tku7bkuK3nu5/kuIDpkojlr7kgdHJhbnNmb3JtIOS6i+S7tuWBmiByZXBhaW5044CC5ZCO57ut6KaB5YGa6YC76L6R5ouG5YiGXG4gICAgICAgIC8vIGN1cnZlQ3RybC5yZXBhaW50KCk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uWUNoYW5nZTogQ2hhbmdlRXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIGhhbmRsZVlDaGFuZ2UoZXZlbnQpO1xuXG4gICAgICAgIGNvbnN0IGN1cnZlQ3RybCA9IGdldEN1cnZlQ3RybCgpO1xuICAgICAgICBpZiAoIWN1cnZlQ3RybCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VydmVDdHJsLnNldFNjcm9sbCh7XG4gICAgICAgICAgICB5T2Zmc2V0OiB5T2Zmc2V0LnZhbHVlLFxuICAgICAgICAgICAgeVNjYWxlOiB5U2NhbGUudmFsdWUsXG4gICAgICAgICAgICB4U2NhbGU6IHhTY2FsZS52YWx1ZSxcbiAgICAgICAgICAgIHhPZmZzZXQ6IHhPZmZzZXQudmFsdWUsXG4gICAgICAgIH0pO1xuICAgICAgICB1cGRhdGVHbG9iYWxHcmlkKCk7XG4gICAgICAgIGVtaXRHbG9iYWxUcmFuc2Zvcm0oKTtcbiAgICAgICAgLy8gY3VydmVDdHJsLnJlcGFpbnQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgeE9mZnNldCxcbiAgICAgICAgeFNjYWxlLFxuICAgICAgICB5T2Zmc2V0LFxuICAgICAgICB5U2NhbGUsXG5cbiAgICAgICAgb25UcmFuc2Zvcm0sXG4gICAgICAgIG9uWENoYW5nZSxcbiAgICAgICAgb25ZQ2hhbmdlLFxuXG4gICAgICAgIHVwZGF0ZVNjcm9sbEZyb21DdXJ2ZSxcbiAgICAgICAgdXBkYXRlR2xvYmFsR3JpZCxcbiAgICB9O1xufVxuIl19