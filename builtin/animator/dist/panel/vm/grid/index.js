"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Grid=void 0;const HALF_TEXT_WIDTH=5,POINT_LENGTH=2,LinearTicks=require("./../../../../static//script/linear-ticks.js"),{clamp:clamp}=Editor.Utils.Math;class Grid{constructor(t){this.xAxisScale=1,this.xAxisOffset=0,this.xAnchor=.5,this.yAxisScale=1,this.yAxisOffset=0,this.yAnchor=.5,this.labelShowType="time",this.cxt2D=t.context,this.axis=t.axis,this.labelShowType=t.showType,this.cxt2D.lineWidth=t.lineWidth||1,this.cxt2D.strokeStyle=t.color||"red",this.hticks=new LinearTicks;const{lods:s,minScale:i,maxScale:e,sample:h,startOffset:a,container:c}=this.axis;this.xAxisOffset=a||0,this.startOffset=a||0,this.sample=h,this.container=c,this.hticks.initTicks(s,i,e,h).spacing(10,20),this.xAxisScale=clamp(this.xAxisScale,this.hticks.minValueScale,this.hticks.maxValueScale),this.hformat=t.hformat}set cxt2D(t){this.canvas=t.canvas,this._cxt2D=t}get cxt2D(){return this._cxt2D}get xMinScale(){return this.hticks.minValueScale}get xMaxScale(){return this.hticks.maxValueScale}updateScale(t,s){const{lods:i,sample:e}=this.axis;this.hticks.initTicks(i,t,s,e).spacing(10,20)}xAxisScaleAt(t,s){const i=this.pixelToValueH(t);this.xAxisScale=clamp(s,this.hticks.minValueScale,this.hticks.maxValueScale);const e=this.valueToPixelH(i);return this.transferX(t-e),this.xAxisScale}transferX(t){if(this.xAxisOffset===this.startOffset&&t>0)return;let s,i,e=this.xAxisOffset+t;e>this.startOffset&&(e=this.startOffset),void 0!==this.xMinRange&&null!==this.xMinRange&&(s=this.valueToPixelH(this.xMinRange)),void 0!==this.xMaxRange&&null!==this.xMaxRange&&(i=this.valueToPixelH(this.xMaxRange),i=Math.max(0,i-this.canvas.width)),this.xAxisOffset=e,void 0===s||void 0===i?void 0===s?void 0===i||(this.xAxisOffset=Math.max(this.xAxisOffset,-i)):this.xAxisOffset=Math.min(this.xAxisOffset,-s):this.xAxisOffset=clamp(this.xAxisOffset,-i,-s)}resize(t,s){if(!t||!s){const i=this.canvas.getBoundingClientRect();t=t||i.width,s=s||i.height,t=Math.round(t),s=Math.round(s)}this.canvas.width===t&&this.canvas.height===s||(this.canvas.width=t,this.canvas.height=s,this.render())}render(){this.clear(),this.updateGrids(),this.updateLabels()}pixelToValueH(t){return(t-this.xAxisOffset)/this.xAxisScale}valueToPixelH(t){return t*this.xAxisScale+this.xAxisOffset}updateLabels(){if(!this.container)return;const t=this.hticks.levelForStep(50);let s="";this.hticks.ticksAtLevel(t,!1).forEach(t=>{const i=Math.floor(this.valueToPixelH(t))+5,e=this.hformat(t,this.labelShowType,this.sample);s+=`<span style="transform: translateX(${Math.floor(i-this.startOffset)}px);">${e}</span>`}),this.container.x.innerHTML=s}clear(){this.cxt2D.clearRect(0,0,this.canvas.width,this.canvas.height)}updateGrids(){let t,s,i;const e=this.pixelToValueH(0),h=this.pixelToValueH(this.canvas.width);this.hticks.range(e,h,this.canvas.width);for(let e=this.hticks.minTickLevel;e<=this.hticks.maxTickLevel;++e)if((s=this.hticks.tickRatios[e])>0){this.cxt2D.strokeStyle=`rgba(99, 99, 99, ${3*s})`,t=this.hticks.ticksAtLevel(e,!0);for(const s of t)this.cxt2D.beginPath(),i=this.valueToPixelH(s),this.cxt2D.moveTo(Math.floor(i)+.5,18),this.cxt2D.lineTo(Math.floor(i)+.5,this.canvas.height),this.cxt2D.stroke()}}}exports.Grid=Grid;