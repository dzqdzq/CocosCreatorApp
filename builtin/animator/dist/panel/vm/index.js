"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,o)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.components=exports.methods=exports.watch=exports.computed=exports.setup=exports.data=void 0;const vue_js_1=require("vue/dist/vue.js"),animation_ctrl_1=require("../share/animation-ctrl"),ipc_event_1=require("../share/ipc-event"),utils_1=require("./../utils"),grid_ctrl_1=require("../share/grid-ctrl"),global_data_1=require("../share/global-data"),animation_editor_1=require("../share/animation-editor"),store_aux_1=require("./hooks/store-aux"),hooks_1=require("./hooks"),maskComp=__importStar(require("./components/mask")),auxiliary_curves_1=require("./components/auxiliary-curves"),auxiliary_curve_list_1=require("./components/auxiliary-curve-list"),bezier_presets_1=require("../share/bezier-presets"),changeFailedClips=[],data=function(){return{loading:"wait_scene_ready",scale:0,toast:{message:""},currentFrame:0,root:"",selectedId:"",selectedIds:new Set,selectPath:"",moveNodePath:"",selectProperty:null,nodeDump:null,eventsDump:null,clipsMenu:[],selectKeyInfo:null,selectEventInfo:null,selectEmbeddedPlayerInfo:null,aniCompType:null,animationMode:!1,animationState:"stop",editEventFrame:0,maskPanel:"",selectDataChange:0,nodesHeight:0,nodeScrollInfo:null,propertyScrollInfo:null,embeddedPlayerScrollInfo:null,moveInfo:null,boxInfo:null,boxStyle:null,boxData:null,previewPointer:null,propertiesMenu:null,properties:null,updateKeyFrame:0,updatePosition:0,updateSelectKey:1,updateSelectNode:1,scrolling:!1,expandInfo:{},layout:{topPec:25,centerPec:30,auxCurvePec:15,leftPec:30,_totalPec:100,__version__:"1.0.1"},leftResizeMoving:!1,expandLayout:{embeddedPlayer:!1,node:!0,property:!0,auxiliaryCurve:!1},enableEmbeddedPlayer:!0,filterInvalid:!1,filterName:"",active:!0,wrapModeList:[],showAnimCurve:!1,showAnimEmbeddedPlayer:!0,lightCurve:null,hasSelectedCurveClip:!1,curveDisabledCCtypes:animation_editor_1.animationEditor.curveDisabledCCtypes,presetSize:110,expandTab:"",searchPresetName:"",timeInfos:[],showType:"frame",embeddedPlayerGroups:[]}};exports.data=data;const setup=(e,t)=>{const i=(0,hooks_1.useBaseStore)(),r=(0,vue_js_1.toRef)(i,"isSkeletonClip"),o=(0,vue_js_1.toRef)(i,"offset"),a=(0,vue_js_1.toRef)(i,"clipConfig"),n=(0,vue_js_1.toRef)(i,"currentClip"),s=(0,vue_js_1.ref)(),l=(0,vue_js_1.ref)(),c=(0,vue_js_1.ref)(),d=(0,vue_js_1.ref)(),p=(0,store_aux_1.useAuxCurveStore)(),u=(0,hooks_1.useTransformEvent)();u.onUpdate(e=>{var t,i;grid_ctrl_1.gridCtrl.grid&&(o.value=grid_ctrl_1.gridCtrl.grid.xAxisOffset),"property"!==e&&d.value&&d.value.curveCtrl&&grid_ctrl_1.gridCtrl.grid&&(0,grid_ctrl_1.syncAxisX)(grid_ctrl_1.gridCtrl.grid,d.value.curveCtrl.grid),null===(t=grid_ctrl_1.gridCtrl.grid)||void 0===t||t.render(),animation_editor_1.animationEditor.updatePositionInfo(),null===(i=d.value)||void 0===i||i.rePaint(),animation_editor_1.animationEditor.renderTimeAxis()});const m=(0,vue_js_1.computed)(()=>p.enabled&&r.value);return{auxCurveStore:p,currentClip:n,clipConfig:a,isSkeletonClip:r,offset:o,curve:d,gridCanvas:c,chart:s,right:l,toPercent:e=>`${e}%`,transformEvent:u,enableAuxCurve:m,updateAuxCurveEnableState:async()=>{await p.updateEnableState()}}};exports.setup=setup;const vComputed={displayLayout(){const e=this;if(!Object.keys(e.expandLayout).filter(t=>!e.expandLayout[t]).length)return e.layout;const t=Object.assign({},e.layout),i=["topPec","centerPec","auxCurvePec"],r=animation_editor_1.animationEditor.layoutConfig.totalPec;if(e.expandLayout.embeddedPlayer||(t.topPec=0,i.splice(i.findIndex(e=>"topPec"===e),1)),e.expandLayout.node||(t.centerPec=0,i.splice(i.findIndex(e=>"centerPec"===e),1)),e.expandLayout.auxiliaryCurve||(t.auxCurvePec=0,i.splice(i.findIndex(e=>"auxCurvePec"===e),1)),e.expandLayout.property)t[i[0]]=Math.min(r,e.layout.topPec+e.layout.centerPec);else{const e=r-(t.topPec+t.centerPec+t.auxCurvePec);if(i.length>0&&e>0){const r=e/i.length;i.forEach(e=>{t[e]+=r})}}return t},currentTime(){return(0,utils_1.transFrameByType)(this.currentFrame,this.showType,this.sample)},displayPropertiesMenu(){var e;if(!this.propertiesMenu)return[];const t=(0,utils_1.sortPropertyMenu)(this.propertiesMenu,null!==(e=this.properties)&&void 0!==e?e:{});return animation_editor_1.animationEditor.calcCreatePropMenu(t)},selectPropertyRenderDump(){const e=this;if(!e.selectProperty||!e.selectProperty.dump)return null;const t=JSON.parse(JSON.stringify(e.selectProperty.dump));return t.extends&&t.extends.includes("cc.Asset")&&(t.type===t.extends[0]||t.extends[0].startsWith("cc.")||(t.type=t.extends[0],e.selectProperty.dump.type=t.extends[0])),t.readonly=e.clipConfig&&e.clipConfig.isLock||e.selectProperty.missing,JSON.stringify(t)},presetArr(){const e=this;return e.searchPresetName?bezier_presets_1.defaultBezier.filter(t=>new RegExp(e.searchPresetName,"i").test(t.name)):bezier_presets_1.defaultBezier},lock(){return Boolean(!this.clipConfig||this.clipConfig.isLock||this.maskPanel||!this.animationMode)},selectPropData(){if(!animation_ctrl_1.animationCtrl.clipsDump||!this.selectProperty)return null;const{prop:e,nodePath:t}=this.selectProperty;return animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t]&&animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t][e]},computeSelectPath(){const e=this;if(!e.updateSelectNode)return"";if(e.selectPath)return e.selectPath;let t="";return e.selectedId&&e.nodeDump&&(t=animation_ctrl_1.animationCtrl.nodesDump.uuid2path[e.selectedId]),t},sample(){let e=60;return this.clipConfig&&(e=this.clipConfig.sample),animation_editor_1.animationEditor.updateSample(e),e},lastFrameInfo(){const e=this;let t=0;return e.clipConfig&&e.clipConfig.duration&&(t=(0,utils_1.timeToFrame)(e.clipConfig.duration,e.sample)),{frame:t,x:grid_ctrl_1.gridCtrl.frameToCanvas(t)}},propertyHeight(){const e=this;if(!e.properties)return 0;let t=0;return Object.keys(e.properties).forEach(i=>{e.properties[i].hidden||(t+=animation_editor_1.animationEditor.LINE_HEIGHT)}),t},stickInfo(){const e=this;if(!e.properties||!e.selectKeyInfo||!e.selectKeyInfo.keyFrames||e.selectKeyInfo.keyFrames.length<2||!e.updateSelectKey||!e.updatePosition||!e.propertyScrollInfo)return animation_editor_1.animationEditor.hasShowStick=!1,null;const t=[],i=[],r=[];return e.selectKeyInfo.keyFrames.forEach((o,a)=>{e.computeSelectPath&&e.selectKeyInfo.keyFrames[a]&&e.selectKeyInfo.keyFrames[a].nodePath!==e.computeSelectPath||(t.push(o.x||0),e.properties[o.prop]&&i.push(e.properties[o.prop].top),r.push(o.frame))}),r.sort((e,t)=>e-t),animation_editor_1.animationEditor.stickInfo.leftFrame=r[0],animation_editor_1.animationEditor.stickInfo.rightFrame=r[r.length-1],t.sort((e,t)=>e-t),i.sort((e,t)=>e-t),t[t.length-1]===t[0]?(animation_editor_1.animationEditor.hasShowStick=!1,null):(animation_editor_1.animationEditor.stickInfo.width=t[t.length-1]-t[0]+18,animation_editor_1.animationEditor.stickInfo.height=i[i.length-1]-i[0]+animation_editor_1.animationEditor.LINE_HEIGHT,animation_editor_1.animationEditor.stickInfo.left=t[0]+grid_ctrl_1.gridCtrl.grid.xAxisOffset-10,animation_editor_1.animationEditor.stickInfo.top=i[0]-e.propertyScrollInfo.top,animation_editor_1.animationEditor.hasShowStick=!0,JSON.parse(JSON.stringify(animation_editor_1.animationEditor.stickInfo)))},curveData(){var e;const t=this;if(!t.selectProperty||!t.showAnimCurve||!t.properties)return animation_editor_1.animationEditor.repaintCurve(null),null;const i=null===(e=animation_ctrl_1.animationCtrl.clipsDump)||void 0===e?void 0:e.pathsDump[t.selectProperty.nodePath];if(!i)return null;const r=i[t.selectProperty.prop];if(!(r&&r.isCurveSupport&&r.type&&t.properties[t.selectProperty.prop]))return animation_editor_1.animationEditor.repaintCurve(null),null;if(r.type&&animation_editor_1.animationEditor.curveDisabledCCtypes.includes(r.type.value))return animation_editor_1.animationEditor.repaintCurve(null),null;const o={curveInfos:{},wrapMode:t.clipConfig.wrapMode,duration:t.clipConfig.duration*t.clipConfig.sample};let a=!1;if(r.partKeys)for(const e of r.partKeys){const r=i[e];o.curveInfos[e]={keys:r.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:r.preExtrap,postWrapMode:r.postExtrap,color:t.properties[e].color},a=!(!a&&!o.curveInfos[e].keys.find(e=>e.easingMethod))}else o.curveInfos={[t.selectProperty.prop]:{keys:r.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:r.preExtrap,postWrapMode:r.postExtrap,color:t.properties[t.selectProperty.prop].color}},a=!(!a&&!o.curveInfos[t.selectProperty.prop].keys.find(e=>e.easingMethod));return animation_editor_1.animationEditor.checkCurveDataDirty(o)&&animation_editor_1.animationEditor.repaintCurve(o),Object.assign(Object.assign({},o),{hasUserEasingMethod:a})},curveStyle(){return this.showAnimCurve&&this.computeSelectPath?{width:"100%",height:"100%"}:{display:"none"}},stickBoxStyle(){return this.stickInfo?{width:this.stickInfo.width+"px",height:this.stickInfo.height+"px",top:this.stickInfo.top+"px",left:this.stickInfo.left+"px"}:null},currentKeyEmptyInfo(){const e=this;if(!animation_ctrl_1.animationCtrl.clipsDump||!e.properties)return{};const t={},i=animation_ctrl_1.animationCtrl.clipsDump.pathsDump[e.computeSelectPath];return i?(Object.keys(e.properties).forEach(r=>{if(!i[r])return;const o=i[r].keyFrames;t[r]=!o.find(t=>t.frame===e.currentFrame)}),t):t},nodeTitle(){return this.filterInvalid?"i18n:animator.node.nodeHasAnimation":"i18n:animator.node.title"}};async function mounted(){var e,t;const i=this;animation_ctrl_1.animationCtrl.init(i),animation_editor_1.animationEditor.init(i),global_data_1.Flags.sceneReady=await Editor.Message.request("scene","query-is-ready"),global_data_1.Flags.sceneReady&&await animation_editor_1.animationEditor.debounceRefresh(),i.wrapModeList=await Editor.Message.request("scene","query-enum-list-with-path","AnimationClip.WrapMode"),null===(e=i.wrapModeList)||void 0===e||e.forEach(e=>{e.tip=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.tip`)||e.name,e.name=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.label`)||e.name});const r=await animation_editor_1.animationEditor.getConfig("layout");r&&"object"==typeof r&&(r.topPec||(r.topPec=r.top&&r.top/i.$refs.container.offsetHeight*100||25,r.leftPec=r.left&&r.left/i.$refs.container.offsetWidth*100||30),"string"==typeof r.topPec&&(r.topPec=Number(r.topPec.replace("%",""))||25),"string"==typeof r.leftPec&&(r.leftPec=Number(r.leftPec.replace("%",""))||30),r.centerPec=null!==(t=r.centerPec)&&void 0!==t?t:30,Object.assign(i.layout,r)),i.expandLayout=Object.assign(i.expandLayout,await animation_editor_1.animationEditor.getConfig("expandLayout")||{}),await i.updateEnableEmbeddedPlayer(),await i.updateAuxCurveEnableState(),i.selectedIds=new Set(Editor.Selection.getSelected("node")),i.selectedId=Editor.Selection.getLastSelected("node")}exports.computed=vComputed,exports.watch={async selectedId(e,t){const i=this,r=i.computeSelectPath;if(i.selectKeyInfo){i.selectKeyInfo.keyFrames.find(e=>e.nodePath!==r)&&(i.selectKeyInfo=null)}if(!e&&animation_ctrl_1.animationCtrl.nodesDump){if(animation_ctrl_1.animationCtrl.nodesDump.uuid2path[t]!==r&&r)return}if(i.updateSelectNode=-i.updateSelectNode,await animation_editor_1.animationEditor.updateSelectedId(),i.properties&&(i.selectProperty&&i.selectProperty.nodePath!==r||!i.selectProperty)){const e=Object.keys(i.properties)[0];animation_editor_1.animationEditor.updateSelectProperty({nodePath:r,prop:e,missing:i.properties[e].missing,clipUuid:animation_ctrl_1.animationCtrl.clipsDump.uuid,isCurveSupport:i.properties[e].isCurveSupport})}else i.selectProperty=null},selectKeyInfo(){this.showAnimCurve?animation_editor_1.animationEditor.selectKeyUpdateFlag&&animation_editor_1.animationEditor.updateCurveSelecteKeys():animation_editor_1.animationEditor.selectKeyUpdateFlag=!0},root(){this.filterInvalid=!1,this.filterName="",this.nodesHeight=0},async currentClip(e,t){const i=this;if(e===t||!e)return;if(!await(0,ipc_event_1.IsetEditClip)(e))return changeFailedClips.push(e),console.warn(`Set edit clip failed!${e}`),void(changeFailedClips.includes(t)?i.currentClip="":i.currentClip=t);i.selectEventInfo=null,i.selectKeyInfo=null;const r=await(0,ipc_event_1.IqueryPlayingClipTime)(i.currentClip),o=(0,utils_1.timeToFrame)(r,i.sample);animation_editor_1.animationEditor.setCurrentFrame(o)},layout:{deep:!0,handler(){(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.resize()})}},currentFrame(){this.calcSelectProperty(null,!0)},boxData(){var e,t;const i=this;if(!i.boxData||!animation_ctrl_1.animationCtrl.clipsDump)return;const{origin:r,h:o,w:a,type:n}=i.boxData;if("property"===n&&!i.properties)return;const s=null===(e=i.boxInfo)||void 0===e?void 0:e.rawKeyFrames,l=s||[],c="node"===n?i.nodeScrollInfo.top:i.propertyScrollInfo.top;const d=s?function(e){l.find(t=>t.rawFrame===e.rawFrame&&t.prop===e.prop&&t.nodePath==t.nodePath)||l.push(e)}:e=>l.push(e);function p(e,t){Object.values(e).forEach(e=>{const n=e.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-c;!t&&(n<r.y||n>r.y+o)||e.keyFrames.forEach(t=>{const o=t.x+i.offset;if(o>r.x&&o<r.x+a){const i={frame:t.frame,rawFrame:t.frame,nodePath:e.nodePath,x:t.x,prop:e.prop};d(Object.assign(Object.assign({},i),{key:(0,utils_1.calcKeyFrameKey)(i)}))}})})}"node"===n?Object.keys(animation_ctrl_1.animationCtrl.clipsDump.pathsDump).forEach(e=>{const t=i.nodeDump.find(t=>t.path===e);if(!t)return;const a=t.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-c;a<r.y||a>r.y+o||p(animation_ctrl_1.animationCtrl.clipsDump.pathsDump[e],!0)}):p(i.properties),l.sort((e,t)=>e.frame-t.frame),i.selectKeyInfo={nodePath:i.computeSelectPath,keyFrames:l,location:"prop",prop:null===(t=i.selectProperty)||void 0===t?void 0:t.prop}}},exports.methods={t:(e,t="")=>Editor.I18n.t(`animator.${t}${e}`),onClipCurvePreset(e){this.$refs.curve.curveCtrl.applyBezierToSelectedCurveClip(e),Editor.Metrics._trackEventWithTimer({category:"hippoAnimator",id:"A100000",value:1})},toggleExpandLayoutChange(e){this.expandLayout[e]=!this.expandLayout[e],animation_editor_1.animationEditor.setConfig("expandLayout",this.expandLayout),(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.resize()})},showAllKeys(){if(!this.clipConfig.duration||!this.curveData)return;const e=this.curveData,t=[],i=[],r=this.$refs.curve.curveCtrl.grid,o=Math.abs(r.pixelToValueX(20)-r.pixelToValueX(0)),a=Math.abs(r.pixelToValueY(20)-r.pixelToValueY(0));Object.values(e.curveInfos).forEach(e=>{var r,n,s,l;if(!e.keys.length)return;const c=e.keys[0].point.x-o,d=e.keys[e.keys.length-1].point.x+o;t[0]=Math.min(c,null!==(r=t[0])&&void 0!==r?r:c),t[1]=Math.max(d,null!==(n=t[1])&&void 0!==n?n:d),e.keys.sort((e,t)=>e.point.y-t.point.y);const p=e.keys[0].point.y-a,u=e.keys[e.keys.length-1].point.y+a;i[0]=Math.min(p,null!==(s=i[0])&&void 0!==s?s:p),i[1]=Math.max(u,null!==(l=i[1])&&void 0!==l?l:u)}),i.length&&t.length&&(t[0]=Math.max(0,t[0]),this.$refs.curve.curveCtrl.setDisplayRange(t,i))},onUpdateEvent(e,t,i){0!==i.length?(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.IupdateEvent)(e,t,i)):animation_ctrl_1.animationCtrl.deleteEvent()},toggleInvalidNode(){this.filterInvalid=!this.filterInvalid,this.$refs.nodes.scrollTop=this.nodeScrollInfo.top=0,animation_editor_1.animationEditor.calcDisplayClips()},onFilter(e){e.stopPropagation(),e.preventDefault(),this.filterName!==e.target.value&&animation_editor_1.animationEditor.debounceFilterNode(e.target.value)},async calcSelectProperty(e,t=!1){const i=this;if(t&&i.selectProperty&&(e=i.selectProperty),!e)return;const r=await(0,ipc_event_1.IgetPropValueAtFrame)(i.currentClip,e.nodePath,e.prop,i.currentFrame);i.selectProperty=Object.assign(e,{dump:r})},queryDurationStyle(e){if(!e||!grid_ctrl_1.gridCtrl.grid)return"";let t=grid_ctrl_1.gridCtrl.grid.valueToPixelH(0);t<0&&(t=0);let i=grid_ctrl_1.gridCtrl.grid.valueToPixelH(e)-t;return i<0&&(t=i,i=0),`transform: translateX(${t}px); width: ${i}px`},pointerPosition(e=0){var t,i;return grid_ctrl_1.gridCtrl.frameToCanvas(this.currentFrame)+(null!==(i=null!==e&&void 0!==e?e:null===(t=grid_ctrl_1.gridCtrl.grid)||void 0===t?void 0:t.xAxisOffset)&&void 0!==i?i:0)-grid_ctrl_1.gridCtrl.startOffset},onMouseWheel(e){e.shiftKey?animation_editor_1.animationEditor.moveTimeLine("darwin"===process.platform?e.deltaX:e.deltaY):Math.abs(e.deltaX)>Math.abs(e.deltaY)?animation_editor_1.animationEditor.moveTimeLine(e.deltaY):animation_editor_1.animationEditor.scaleTimeLineAt(-e.deltaY,Math.round(e.offsetX))},onMouseDown(e){const t=this;t.moveNodePath="",t.boxInfo=null,t.boxStyle=null;const i=e.target.getAttribute("name");"event"!==i&&(t.selectEventInfo=null),"key"===i||"stick"===i||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectKeyInfo=null),"range"===i||"stick"===i||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectEmbeddedPlayerInfo=null,Editor.Selection.unselect("animation-embeddedPlayer",Editor.Selection.getSelected("animation-embeddedPlayer")));let r=null;function o(){e.offsetY>t.$refs["property-content"].offsetTop?global_data_1.Flags.mouseDownName="property":e.offsetY>t.$refs["node-content"].offsetTop&&e.offsetY<t.$refs["property-content"].offsetTop&&(global_data_1.Flags.mouseDownName="node")}switch(i){case"time-pointer":global_data_1.Flags.mouseDownName="time-pointer";break;case"pointer":1!==e.button&&(global_data_1.Flags.mouseDownName="pointer");break;case"stick":global_data_1.Flags.mouseDownName="stick",t.selectKeyInfo.startX=e.x,t.selectKeyInfo.offset=0,t.selectKeyInfo.offsetFrame=0,global_data_1.Flags.startDragStickInfo={type:"center"};break;default:if(1===e.button||2===e.button){if(global_data_1.Flags.startDragGridInfo={start:e.x,lastStart:e.x},2===e.button&&(o(),global_data_1.Flags.mouseDownName))break;return void(global_data_1.Flags.mouseDownName="grid")}if(!i)break;global_data_1.Flags.mouseDownName=i}if(r||global_data_1.Flags.mouseDownName||(o(),global_data_1.Flags.mouseDownName&&(r={type:global_data_1.Flags.mouseDownName,ctrlKey:(0,utils_1.checkCtrlOrCommand)(e)})),["node","property"].includes(global_data_1.Flags.mouseDownName)&&r){const i=grid_ctrl_1.gridCtrl.pageToCtrl(e.x,e.y);r.startX=i.x,r.startY=i.y,r.ctrlKey=(0,utils_1.checkCtrlOrCommand)(e),r.ctrlKey&&t.selectKeyInfo&&t.selectKeyInfo.keyFrames&&(r.rawKeyFrames=t.selectKeyInfo.keyFrames),t.boxInfo=r}},onPropertyListContextMouseDown(e){global_data_1.Flags.mouseDownName="property-list-content"},onScroll(e,t){const i=this;if(global_data_1.Flags.onScrolling)return;const r="node"===t?i.nodeScrollInfo:i.propertyScrollInfo,o=e.target.scrollTop;o!==r.top&&(global_data_1.Flags.lastScrollTops.splice(0,0,o),global_data_1.Flags.lastScrollTops.length=3,global_data_1.Flags.lastScrollTops[0]!==global_data_1.Flags.lastScrollTops[2]&&(i.scrolling||(global_data_1.Flags.onScrolling=!0,i.scrolling=!0,requestAnimationFrame(()=>{var e;r.top=o,(null===(e=animation_ctrl_1.animationCtrl.nodesDump)||void 0===e?void 0:e.nodesDump)||animation_editor_1.animationEditor.calcNodes(),animation_editor_1.animationEditor.calcDisplayClips(),i.updateKeyFrame++,i.scrolling=!1,global_data_1.Flags.onScrolling=!1}))))},async onConfirm(e){const t=e.target.getAttribute("name"),i=e.target.value;"sample"===t&&animation_editor_1.animationEditor.updateSample(i),await animation_ctrl_1.animationCtrl.updateConfig(t,i)},onStartResize(e,t){animation_editor_1.animationEditor.onStartResize(e,t)},toggleAniCurve(){this.showAnimCurve=!this.showAnimCurve,(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.initCurve()})},async onEditEasingMethodCurve(e){const t=this;if(t.showAnimCurve&&t.curveData&&t.curveData.hasUserEasingMethod){if(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),0===(await Editor.Dialog.warn(Editor.I18n.t("animator.tips.abort_easing_method"),{buttons:[Editor.I18n.t("animator.cancel"),Editor.I18n.t("animator.abort")],default:0,cancel:0})).response)return;const i=[],{nodePath:r}=t.selectProperty;for(const e of Object.keys(t.curveData.curveInfos)){t.curveData.curveInfos[e].keys.forEach(o=>{o.easingMethod&&i.push((0,ipc_event_1.ImodifyCurveOfKey)(t.currentClip,r,e,Math.round(o.point.x),{easingMethod:0}))})}(0,ipc_event_1.IApplyOperation)(i)}},changeFrameShowType(e){const t=this;requestAnimationFrame(()=>{t.showType=e,grid_ctrl_1.gridCtrl.grid.labelShowType=e,grid_ctrl_1.gridCtrl.grid.updateLabels(),animation_editor_1.animationEditor.setConfig("showType",e)})},onScale(e){animation_editor_1.animationEditor.scaleTimeLineWith(e)},onTimeConfirm(e){const t=this,i=e.target.value;if(/^([0-9]*)f?$/.test(i))return void animation_editor_1.animationEditor.updateCurrentFrame(Number(i));const r=animation_ctrl_1.animationCtrl.clipConfig.sample,o=i.match(/^([0-9]*)-([0-9]*)$/);if(o){const e=Number(o[1])*r+Number(o[2]);return void animation_editor_1.animationEditor.updateCurrentFrame(e)}const a=/^((?<m>\d((\.\d*)?))m)?(?<s>(\d((\.\d*)?)))s$/;if(a.test(i)){const{groups:{m:e,s:t}}=i.match(a);let o=(0,utils_1.timeToFrame)(Number(t),r);e&&(o+=Number(e)*r),animation_editor_1.animationEditor.updateCurrentFrame(o)}requestAnimationFrame(()=>{e.path[0].value=t.currentTime})},onPropChange(e){if(!this.selectProperty)return;if(e.detail&&e.detail.ignoreChange)return;const t={value:{newValue:e.target.dump.value},prop:this.selectProperty.prop,nodePath:this.computeSelectPath,frame:this.currentFrame};animation_ctrl_1.animationCtrl.callByDebounce("createKey",t)},async onShowEmbeddedPlayerMenu(e){const t=await animation_editor_1.animationEditor.getEmbeddedPlayerMenu();Editor.Menu.popup({menu:t})},async updateEnableEmbeddedPlayer(){var e;const t=this;t.enableEmbeddedPlayer=null===(e=await animation_editor_1.animationEditor.getConfig("enableEmbeddedPlayer"))||void 0===e||e,t.enableEmbeddedPlayer||(t.expandLayout.embeddedPlayer=!1)}},exports.components={"control-preview":require("./components/control-pointer"),"control-track-tree":require("./components/control-track-tree"),"preview-row":require("./components/preview-row"),"preview-range-row":require("./components/preview-range-row"),"tool-bar":require("./components/toolbar"),"node-tree":require("./components/node-tree"),"property-tree":require("./components/property-tree"),"tips-mask":require("./components/tips-mask"),events:require("./components/events"),"property-tools":require("./components/property-tools"),"event-editor":require("./components/event-editor"),"ctrl-stick":require("./components/ctrl-stick"),"ani-mask":maskComp,AuxiliaryCurves:auxiliary_curve_list_1.AuxiliaryCurves,AuxiliaryCurveFrames:auxiliary_curves_1.AuxiliaryCurveFrames},exports.mounted=mounted;