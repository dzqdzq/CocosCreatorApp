"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.components=exports.methods=exports.watch=exports.computed=exports.data=void 0;const animation_ctrl_1=require("../share/animation-ctrl"),ipc_event_1=require("../share/ipc-event"),utils_1=require("./../utils"),grid_ctrl_1=require("../share/grid-ctrl"),global_data_1=require("../share/global-data"),animation_editor_1=require("../share/animation-editor"),maskComp=__importStar(require("./components/mask")),bezier_presets_1=require("../share/bezier-presets"),changeFailedClips=[],data=function(){return{loading:"wait_scene_ready",offset:240,scale:0,toast:{message:""},currentFrame:0,root:"",selectedId:"",selectedIds:new Set,selectPath:"",moveNodePath:"",selectProperty:null,nodeDump:null,eventsDump:null,currentClip:"",clipConfig:null,clipsMenu:[],selectKeyInfo:null,selectEventInfo:null,selectEmbeddedPlayerInfo:null,aniCompType:null,animationMode:!1,animationState:"stop",editEventFrame:0,maskPanel:"",selectDataChange:0,nodesHeight:0,nodeScrollInfo:null,propertyScrollInfo:null,embeddedPlayerScrollInfo:null,moveInfo:null,boxInfo:null,boxStyle:null,boxData:null,previewPointer:null,propertiesMenu:null,properties:null,updateKeyFrame:0,updatePosition:0,updateSelectKey:1,updateSelectNode:1,scrolling:!1,expandInfo:{},layout:{topPec:25,centerPec:30,leftPec:30,_totalPec:100,__version__:"1.0.0"},leftResizeMoving:!1,expandLayout:{embeddedPlayer:!1,node:!0,property:!0},enableEmbeddedPlayer:!0,filterInvalid:!1,filterName:"",active:!0,wrapModeList:[],showAnimCurve:!1,showAnimEmbeddedPlayer:!0,lightCurve:null,hasSelectedCurveClip:!1,curveDisabledCCtypes:animation_editor_1.animationEditor.curveDisabledCCtypes,presetSize:110,expandTab:"",searchPresetName:"",timeInfos:[],showType:"frame",embeddedPlayerGroups:[]}};async function mounted(){var e,t;const o=this;animation_ctrl_1.animationCtrl.init(o),animation_editor_1.animationEditor.init(o),global_data_1.Flags.sceneReady=await Editor.Message.request("scene","query-is-ready"),global_data_1.Flags.sceneReady&&await animation_editor_1.animationEditor.debounceRefresh(),o.wrapModeList=await Editor.Message.request("scene","query-enum-list-with-path","AnimationClip.WrapMode"),null===(e=o.wrapModeList)||void 0===e||e.forEach(e=>{e.tip=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.tip`)||e.name,e.name=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.label`)||e.name});const i=await animation_editor_1.animationEditor.getConfig("layout");i&&"object"==typeof i&&(i.topPec||(i.topPec=i.top&&i.top/o.$refs.container.offsetHeight*100||25,i.leftPec=i.left&&i.left/o.$refs.container.offsetWidth*100||30),"string"==typeof i.topPec&&(i.topPec=Number(i.topPec.replace("%",""))||25),"string"==typeof i.leftPec&&(i.leftPec=Number(i.leftPec.replace("%",""))||30),i.centerPec=null!==(t=i.centerPec)&&void 0!==t?t:30,Object.assign(o.layout,i)),o.expandLayout=Object.assign(o.expandLayout,await animation_editor_1.animationEditor.getConfig("expandLayout")||{}),await o.updateEnableEmbeddedPlayer(),o.selectedIds=new Set(Editor.Selection.getSelected("node")),o.selectedId=Editor.Selection.getLastSelected("node")}exports.data=data,exports.computed={displayLayout(){const e=this;if(!Object.keys(e.expandLayout).filter(t=>!e.expandLayout[t]).length)return e.layout;const t=Object.assign({},e.layout),o=["topPec","centerPec"];if(e.expandLayout.embeddedPlayer||(t.topPec=0,o.splice(o.findIndex(e=>"topPec"===e),1)),e.expandLayout.node||(t.centerPec=0,o.splice(o.findIndex(e=>"centerPec"===e),1)),e.expandLayout.property)t[o[0]]=e.layout.topPec+e.layout.centerPec;else{const e=animation_editor_1.animationEditor.layoutConfig.totalPec-(t.topPec+t.centerPec);o.length&&o.forEach(i=>{t[i]+=e/o.length})}return t},currentTime(){return(0,utils_1.transFrameByType)(this.currentFrame,this.showType,this.sample)},displayPropertiesMenu(){var e;if(!this.propertiesMenu)return[];const t=(0,utils_1.sortPropertyMenu)(this.propertiesMenu,null!==(e=this.properties)&&void 0!==e?e:{});return animation_editor_1.animationEditor.calcCreatePropMenu(t)},selectPropertyRenderDump(){const e=this;if(!e.selectProperty||!e.selectProperty.dump)return null;const t=JSON.parse(JSON.stringify(e.selectProperty.dump));return t.extends&&t.extends.includes("cc.Asset")&&(t.type===t.extends[0]||t.extends[0].startsWith("cc.")||(t.type=t.extends[0],e.selectProperty.dump.type=t.extends[0])),t.readonly=e.clipConfig&&e.clipConfig.isLock||e.selectProperty.missing,JSON.stringify(t)},presetArr(){const e=this;return e.searchPresetName?bezier_presets_1.defaultBezier.filter(t=>new RegExp(e.searchPresetName,"i").test(t.name)):bezier_presets_1.defaultBezier},lock(){return Boolean(!this.clipConfig||this.clipConfig.isLock||this.maskPanel||!this.animationMode)},selectPropData(){if(!animation_ctrl_1.animationCtrl.clipsDump||!this.selectProperty)return null;const{prop:e,nodePath:t}=this.selectProperty;return animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t]&&animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t][e]},computeSelectPath(){const e=this;if(!e.updateSelectNode)return"";if(e.selectPath)return e.selectPath;let t="";return e.selectedId&&e.nodeDump&&(t=animation_ctrl_1.animationCtrl.nodesDump.uuid2path[e.selectedId]),t},sample(){let e=60;return this.clipConfig&&(e=this.clipConfig.sample),animation_editor_1.animationEditor.updateSample(e),e},lastFrameInfo(){const e=this;let t=0;return e.clipConfig&&e.clipConfig.duration&&(t=(0,utils_1.timeToFrame)(e.clipConfig.duration,e.sample)),{frame:t,x:grid_ctrl_1.gridCtrl.frameToCanvas(t)}},propertyHeight(){const e=this;if(!e.properties)return 0;let t=0;return Object.keys(e.properties).forEach(o=>{e.properties[o].hidden||(t+=animation_editor_1.animationEditor.LINE_HEIGHT)}),t},stickInfo(){const e=this;if(!e.properties||!e.selectKeyInfo||!e.selectKeyInfo.keyFrames||e.selectKeyInfo.keyFrames.length<2||!e.updateSelectKey||!e.updatePosition||!e.propertyScrollInfo)return animation_editor_1.animationEditor.hasShowStick=!1,null;const t=[],o=[],i=[];return e.selectKeyInfo.keyFrames.forEach((r,n)=>{e.computeSelectPath&&e.selectKeyInfo.keyFrames[n]&&e.selectKeyInfo.keyFrames[n].nodePath!==e.computeSelectPath||(t.push(r.x||0),e.properties[r.prop]&&o.push(e.properties[r.prop].top),i.push(r.frame))}),i.sort((e,t)=>e-t),animation_editor_1.animationEditor.stickInfo.leftFrame=i[0],animation_editor_1.animationEditor.stickInfo.rightFrame=i[i.length-1],t.sort((e,t)=>e-t),o.sort((e,t)=>e-t),t[t.length-1]===t[0]?(animation_editor_1.animationEditor.hasShowStick=!1,null):(animation_editor_1.animationEditor.stickInfo.width=t[t.length-1]-t[0]+18,animation_editor_1.animationEditor.stickInfo.height=o[o.length-1]-o[0]+animation_editor_1.animationEditor.LINE_HEIGHT,animation_editor_1.animationEditor.stickInfo.left=t[0]+grid_ctrl_1.gridCtrl.grid.xAxisOffset-10,animation_editor_1.animationEditor.stickInfo.top=o[0]-e.propertyScrollInfo.top,animation_editor_1.animationEditor.hasShowStick=!0,JSON.parse(JSON.stringify(animation_editor_1.animationEditor.stickInfo)))},curveData(){var e;const t=this;if(!t.selectProperty||!t.showAnimCurve||!t.properties)return animation_editor_1.animationEditor.repaintCurve(null),null;const o=null===(e=animation_ctrl_1.animationCtrl.clipsDump)||void 0===e?void 0:e.pathsDump[t.selectProperty.nodePath];if(!o)return null;const i=o[t.selectProperty.prop];if(!(i&&i.isCurveSupport&&i.type&&t.properties[t.selectProperty.prop]))return animation_editor_1.animationEditor.repaintCurve(null),null;if(i.type&&animation_editor_1.animationEditor.curveDisabledCCtypes.includes(i.type.value))return animation_editor_1.animationEditor.repaintCurve(null),null;const r={curveInfos:{},wrapMode:t.clipConfig.wrapMode,duration:t.clipConfig.duration*t.clipConfig.sample};let n=!1;if(i.partKeys)for(const e of i.partKeys){const i=o[e];r.curveInfos[e]={keys:i.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:i.preExtrap,postWrapMode:i.postExtrap,color:t.properties[e].color},n=!(!n&&!r.curveInfos[e].keys.find(e=>e.easingMethod))}else r.curveInfos={[t.selectProperty.prop]:{keys:i.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:i.preExtrap,postWrapMode:i.postExtrap,color:t.properties[t.selectProperty.prop].color}},n=!(!n&&!r.curveInfos[t.selectProperty.prop].keys.find(e=>e.easingMethod));return animation_editor_1.animationEditor.checkCurveDataDirty(r)&&animation_editor_1.animationEditor.repaintCurve(r),Object.assign(Object.assign({},r),{hasUserEasingMethod:n})},curveStyle(){return this.showAnimCurve&&this.computeSelectPath?{width:"100%",height:"100%"}:{display:"none"}},stickBoxStyle(){return this.stickInfo?{width:this.stickInfo.width+"px",height:this.stickInfo.height+"px",top:this.stickInfo.top+"px",left:this.stickInfo.left+"px"}:null},currentKeyEmptyInfo(){const e=this;if(!animation_ctrl_1.animationCtrl.clipsDump||!e.properties)return{};const t={},o=animation_ctrl_1.animationCtrl.clipsDump.pathsDump[e.computeSelectPath];return o?(Object.keys(e.properties).forEach(i=>{if(!o[i])return;const r=o[i].keyFrames;t[i]=!r.find(t=>t.frame===e.currentFrame)}),t):t},nodeTitle(){return this.filterInvalid?"i18n:animator.node.nodeHasAnimation":"i18n:animator.node.title"}},exports.watch={async selectedId(e,t){const o=this,i=o.computeSelectPath;if(o.selectKeyInfo){o.selectKeyInfo.keyFrames.find(e=>e.nodePath!==i)&&(o.selectKeyInfo=null)}if(!e&&animation_ctrl_1.animationCtrl.nodesDump){if(animation_ctrl_1.animationCtrl.nodesDump.uuid2path[t]!==i&&i)return}if(o.updateSelectNode=-o.updateSelectNode,await animation_editor_1.animationEditor.updateSelectedId(),o.properties&&(o.selectProperty&&o.selectProperty.nodePath!==i||!o.selectProperty)){const e=Object.keys(o.properties)[0];animation_editor_1.animationEditor.updateSelectProperty({nodePath:i,prop:e,missing:o.properties[e].missing,clipUuid:animation_ctrl_1.animationCtrl.clipsDump.uuid,isCurveSupport:o.properties[e].isCurveSupport})}else o.selectProperty=null},selectKeyInfo(){this.showAnimCurve?animation_editor_1.animationEditor.selectKeyUpdateFlag&&animation_editor_1.animationEditor.updateCurveSelecteKeys():animation_editor_1.animationEditor.selectKeyUpdateFlag=!0},root(){this.filterInvalid=!1,this.filterName="",this.nodesHeight=0},async currentClip(e,t){const o=this;if(e===t||!e)return;if(!await(0,ipc_event_1.IsetEditClip)(e))return changeFailedClips.push(e),console.warn(`Set edit clip failed!${e}`),void(changeFailedClips.includes(t)?o.currentClip="":o.currentClip=t);o.selectEventInfo=null,o.selectKeyInfo=null;const i=await(0,ipc_event_1.IqueryPlayingClipTime)(o.currentClip),r=(0,utils_1.timeToFrame)(i,o.sample);animation_editor_1.animationEditor.setCurrentFrame(r)},layout:{deep:!0,handler(){process.nextTick(()=>{animation_editor_1.animationEditor.resize()})}},currentFrame(){this.calcSelectProperty(null,!0)},boxData(){var e,t;const o=this;if(!o.boxData||!animation_ctrl_1.animationCtrl.clipsDump)return;const{origin:i,h:r,w:n,type:a}=o.boxData;if("property"===a&&!o.properties)return;const l=null===(e=o.boxInfo)||void 0===e?void 0:e.rawKeyFrames,s=l||[],c="node"===a?o.nodeScrollInfo.top:o.propertyScrollInfo.top;const p=l?function(e){s.find(t=>t.rawFrame===e.rawFrame&&t.prop===e.prop&&t.nodePath==t.nodePath)||s.push(e)}:e=>s.push(e);function d(e,t){Object.values(e).forEach(e=>{const a=e.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-c;!t&&(a<i.y||a>i.y+r)||e.keyFrames.forEach(t=>{const r=t.x+o.offset;if(r>i.x&&r<i.x+n){const o={frame:t.frame,rawFrame:t.frame,nodePath:e.nodePath,x:t.x,prop:e.prop};p(Object.assign(Object.assign({},o),{key:(0,utils_1.calcKeyFrameKey)(o)}))}})})}"node"===a?Object.keys(animation_ctrl_1.animationCtrl.clipsDump.pathsDump).forEach(e=>{const t=o.nodeDump.find(t=>t.path===e);if(!t)return;const n=t.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-c;n<i.y||n>i.y+r||d(animation_ctrl_1.animationCtrl.clipsDump.pathsDump[e],!0)}):d(o.properties),s.sort((e,t)=>e.frame-t.frame),o.selectKeyInfo={nodePath:o.computeSelectPath,keyFrames:s,location:"prop",prop:null===(t=o.selectProperty)||void 0===t?void 0:t.prop}}},exports.methods={t:(e,t="")=>Editor.I18n.t(`animator.${t}${e}`),onClipCurvePreset(e){this.$refs.curve.curveCtrl.applyBezierToSelectedCurveClip(e),Editor.Metrics._trackEventWithTimer({category:"hippoAnimator",id:"A100000",value:1})},toggleExpandLayoutChange(e){this.expandLayout[e]=!this.expandLayout[e],animation_editor_1.animationEditor.setConfig("expandLayout",this.expandLayout),process.nextTick(()=>{animation_editor_1.animationEditor.resize()})},showAllKeys(){if(!this.clipConfig.duration||!this.curveData)return;const e=this.curveData,t=[],o=[],i=this.$refs.curve.curveCtrl.grid,r=Math.abs(i.pixelToValueX(20)-i.pixelToValueX(0)),n=Math.abs(i.pixelToValueY(20)-i.pixelToValueY(0));Object.values(e.curveInfos).forEach(e=>{var i,a,l,s;if(!e.keys.length)return;const c=e.keys[0].point.x-r,p=e.keys[e.keys.length-1].point.x+r;t[0]=Math.min(c,null!==(i=t[0])&&void 0!==i?i:c),t[1]=Math.max(p,null!==(a=t[1])&&void 0!==a?a:p),e.keys.sort((e,t)=>e.point.y-t.point.y);const d=e.keys[0].point.y-n,m=e.keys[e.keys.length-1].point.y+n;o[0]=Math.min(d,null!==(l=o[0])&&void 0!==l?l:d),o[1]=Math.max(m,null!==(s=o[1])&&void 0!==s?s:m)}),o.length&&t.length&&(t[0]=Math.max(0,t[0]),this.$refs.curve.curveCtrl.setDisplayRange(t,o))},onUpdateEvent(e,t,o){0!==o.length?(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.IupdateEvent)(e,t,o)):animation_ctrl_1.animationCtrl.deleteEvent()},toggleInvalidNode(){this.filterInvalid=!this.filterInvalid,this.$refs.nodes.scrollTop=this.nodeScrollInfo.top=0,animation_editor_1.animationEditor.calcDisplayClips()},onFilter(e){e.stopPropagation(),e.preventDefault(),this.filterName!==e.target.value&&animation_editor_1.animationEditor.debounceFilterNode(e.target.value)},async calcSelectProperty(e,t=!1){const o=this;if(t&&o.selectProperty&&(e=o.selectProperty),!e)return;const i=await(0,ipc_event_1.IgetPropValueAtFrame)(o.currentClip,e.nodePath,e.prop,o.currentFrame);o.selectProperty=Object.assign(e,{dump:i})},queryDurationStyle(e){if(!e||!grid_ctrl_1.gridCtrl.grid)return"";let t=grid_ctrl_1.gridCtrl.grid.valueToPixelH(0);t<0&&(t=0);let o=grid_ctrl_1.gridCtrl.grid.valueToPixelH(e)-t;return o<0&&(t=o,o=0),`transform: translateX(${t}px); width: ${o}px`},pointerPosition(e=0){return grid_ctrl_1.gridCtrl.frameToCanvas(this.currentFrame)+(e||grid_ctrl_1.gridCtrl.grid&&grid_ctrl_1.gridCtrl.grid.xAxisOffset||0)-grid_ctrl_1.gridCtrl.startOffset},onMouseWheel(e){e.shiftKey?animation_editor_1.animationEditor.moveTimeLine("darwin"===process.platform?e.deltaX:e.deltaY):Math.abs(e.deltaX)>Math.abs(e.deltaY)?animation_editor_1.animationEditor.moveTimeLine(e.deltaY):animation_editor_1.animationEditor.scaleTimeLineAt(-e.deltaY,Math.round(e.offsetX))},onMouseDown(e){const t=this;t.moveNodePath="",t.boxInfo=null,t.boxStyle=null;const o=e.target.getAttribute("name");"event"!==o&&(t.selectEventInfo=null),"key"===o||"stick"===o||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectKeyInfo=null),"range"===o||"stick"===o||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectEmbeddedPlayerInfo=null,Editor.Selection.unselect("animation-embeddedPlayer",Editor.Selection.getSelected("animation-embeddedPlayer")));let i=null;function r(){e.offsetY>t.$refs["property-content"].offsetTop?global_data_1.Flags.mouseDownName="property":e.offsetY>t.$refs["node-content"].offsetTop&&e.offsetY<t.$refs["property-content"].offsetTop&&(global_data_1.Flags.mouseDownName="node")}switch(o){case"time-pointer":global_data_1.Flags.mouseDownName="time-pointer";break;case"pointer":1!==e.button&&(global_data_1.Flags.mouseDownName="pointer");break;case"stick":global_data_1.Flags.mouseDownName="stick",t.selectKeyInfo.startX=e.x,t.selectKeyInfo.offset=0,t.selectKeyInfo.offsetFrame=0,global_data_1.Flags.startDragStickInfo={type:"center"};break;default:if(1===e.button||2===e.button){if(global_data_1.Flags.startDragGridInfo={start:e.x,lastStart:e.x},2===e.button&&(r(),global_data_1.Flags.mouseDownName))break;return void(global_data_1.Flags.mouseDownName="grid")}if(!o)break;global_data_1.Flags.mouseDownName=o}if(i||global_data_1.Flags.mouseDownName||(r(),global_data_1.Flags.mouseDownName&&(i={type:global_data_1.Flags.mouseDownName,ctrlKey:(0,utils_1.checkCtrlOrCommand)(e)})),["node","property"].includes(global_data_1.Flags.mouseDownName)&&i){const o=grid_ctrl_1.gridCtrl.pageToCtrl(e.x,e.y);i.startX=o.x,i.startY=o.y,i.ctrlKey=(0,utils_1.checkCtrlOrCommand)(e),i.ctrlKey&&t.selectKeyInfo&&t.selectKeyInfo.keyFrames&&(i.rawKeyFrames=t.selectKeyInfo.keyFrames),t.boxInfo=i}},onPropertyListContextMouseDown(e){global_data_1.Flags.mouseDownName="property-list-content"},onScroll(e,t){const o=this;if(global_data_1.Flags.onScrolling)return;const i="node"===t?o.nodeScrollInfo:o.propertyScrollInfo,r=e.target.scrollTop;r!==i.top&&(global_data_1.Flags.lastScrollTops.splice(0,0,r),global_data_1.Flags.lastScrollTops.length=3,global_data_1.Flags.lastScrollTops[0]!==global_data_1.Flags.lastScrollTops[2]&&(o.scrolling||(global_data_1.Flags.onScrolling=!0,o.scrolling=!0,requestAnimationFrame(()=>{var e;i.top=r,(null===(e=animation_ctrl_1.animationCtrl.nodesDump)||void 0===e?void 0:e.nodesDump)||animation_editor_1.animationEditor.calcNodes(),animation_editor_1.animationEditor.calcDisplayClips(),o.updateKeyFrame++,o.scrolling=!1,global_data_1.Flags.onScrolling=!1}))))},async onConfirm(e){const t=e.target.getAttribute("name"),o=e.target.value;"sample"===t&&animation_editor_1.animationEditor.updateSample(o),await animation_ctrl_1.animationCtrl.updateConfig(t,o)},onStartResize(e,t){animation_editor_1.animationEditor.onStartResize(e,t)},toggleAniCurve(){this.showAnimCurve=!this.showAnimCurve,animation_editor_1.animationEditor.initCurve()},async onEditEasingMethodCurve(e){const t=this;if(t.showAnimCurve&&t.curveData&&t.curveData.hasUserEasingMethod){if(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),0===(await Editor.Dialog.warn(Editor.I18n.t("animator.tips.abort_easing_method"),{buttons:[Editor.I18n.t("animator.cancel"),Editor.I18n.t("animator.abort")],default:0,cancel:0})).response)return;const o=[],{nodePath:i}=t.selectProperty;for(const e of Object.keys(t.curveData.curveInfos)){t.curveData.curveInfos[e].keys.forEach(r=>{r.easingMethod&&o.push((0,ipc_event_1.ImodifyCurveOfKey)(t.currentClip,i,e,Math.round(r.point.x),{easingMethod:0}))})}(0,ipc_event_1.IApplyOperation)(o)}},changeFrameShowType(e){const t=this;requestAnimationFrame(()=>{t.showType=e,grid_ctrl_1.gridCtrl.grid.labelShowType=e,grid_ctrl_1.gridCtrl.grid.updateLabels(),animation_editor_1.animationEditor.setConfig("showType",e)})},onScale(e){animation_editor_1.animationEditor.scaleTimeLineWith(e)},onTimeConfirm(e){const t=this,o=e.target.value;if(/^([0-9]*)f?$/.test(o))return void animation_editor_1.animationEditor.updateCurrentFrame(Number(o));const i=animation_ctrl_1.animationCtrl.clipConfig.sample,r=o.match(/^([0-9]*)-([0-9]*)$/);if(r){const e=Number(r[1])*i+Number(r[2]);return void animation_editor_1.animationEditor.updateCurrentFrame(e)}const n=/^((?<m>\d((\.\d*)?))m)?(?<s>(\d((\.\d*)?)))s$/;if(n.test(o)){const{groups:{m:e,s:t}}=o.match(n);let r=(0,utils_1.timeToFrame)(Number(t),i);e&&(r+=Number(e)*i),animation_editor_1.animationEditor.updateCurrentFrame(r)}requestAnimationFrame(()=>{e.path[0].value=t.currentTime})},onPropChange(e){if(!this.selectProperty)return;if(e.detail&&e.detail.ignoreChange)return;const t={value:{newValue:e.target.dump.value},prop:this.selectProperty.prop,nodePath:this.computeSelectPath,frame:this.currentFrame};animation_ctrl_1.animationCtrl.callByDebounce("createKey",t)},async onShowEmbeddedPlayerMenu(e){const t=await animation_editor_1.animationEditor.getEmbeddedPlayerMenu();Editor.Menu.popup({menu:t})},async updateEnableEmbeddedPlayer(){var e;const t=this;t.enableEmbeddedPlayer=null===(e=await animation_editor_1.animationEditor.getConfig("enableEmbeddedPlayer"))||void 0===e||e,t.enableEmbeddedPlayer||(t.expandLayout.embeddedPlayer=!1)}},exports.components={"control-preview":require("./components/control-pointer"),"control-track-tree":require("./components/control-track-tree"),"preview-row":require("./components/preview-row"),"preview-range-row":require("./components/preview-range-row"),"tool-bar":require("./components/toolbar"),"node-tree":require("./components/node-tree"),"property-tree":require("./components/property-tree"),"tips-mask":require("./components/tips-mask"),events:require("./components/events"),"property-tools":require("./components/property-tools"),"event-editor":require("./components/event-editor"),"ctrl-stick":require("./components/ctrl-stick"),"ani-mask":maskComp},exports.mounted=mounted;