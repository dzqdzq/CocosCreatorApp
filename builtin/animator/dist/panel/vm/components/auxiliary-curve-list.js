"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuxiliaryCurves=void 0;const vue_js_1=require("vue/dist/vue.js"),ipc_event_1=require("../../share/ipc-event"),animation_ctrl_1=require("../../share/animation-ctrl"),pop_menu_1=require("../../share/pop-menu"),animation_editor_1=require("../../share/animation-editor"),hooks_1=require("../hooks"),directives_1=require("../directives"),keyframe_btn_1=require("./keyframe-btn"),sharedProps={offset:{type:Number,default:0}},AuxListItem=(0,vue_js_1.defineComponent)({name:"AuxListItem",components:{KeyframeBtn:keyframe_btn_1.KeyframeBtn},directives:{AutoFocus:directives_1.AutoFocus},props:Object.assign(Object.assign({},sharedProps),{name:{type:String,default:""},selected:{type:Boolean,default:!1},keyframeEmpty:{type:Boolean,default:!0}}),emits:{select:null,remove:null,rename:null},setup(e,n){const t=(0,vue_js_1.ref)(e.name),i=(0,hooks_1.useAuxCurveStore)(),a=(0,vue_js_1.computed)(()=>i.renaming.includes(e.name));return{tempName:t,onNameChange:e=>{t.value=e.target.value},onNameConfirm:a=>{t.value=a.target.value,n.emit("rename",{oldName:e.name,newName:(0,vue_js_1.unref)(t)}),i.switchRename(e.name,!1),t.value=""},onNameBlur:n=>{t.value="",i.switchRename(e.name,!1)},isEditing:a,onSwitchFrame:n=>{e.keyframeEmpty?animation_ctrl_1.animationCtrl.createAuxKey(e.name):animation_ctrl_1.animationCtrl.removeAuxKey(e.name)},onClick:e=>{n.emit("select")},onContextmenu:a=>{const r=(0,pop_menu_1.getPopMenuMap)(pop_menu_1.onAuxNameContextMenus,!0);r.removeAuxCurve.click=(async()=>{n.emit("remove")}),r.renameAuxCurve.click=(async()=>{t.value=e.name,i.switchRename(e.name,!0)}),Editor.Menu.popup({menu:Object.values(r)})}}},template:'\n        <div\n            :class="{\n                selected: selected,\n            }"\n            class="auxiliary-curves-list-item"\n            @click="onClick"\n            @contextmenu="onContextmenu"\n        >\n            <span class="auxiliary-curves-list-item__name">\n                <ui-input\n                    v-if="isEditing"\n                    v-auto-focus\n                    :value="tempName"\n                    @change="onNameChange"\n                    @confirm="onNameConfirm"\n                    @blur="onNameBlur"\n                ></ui-input>\n                <template v-else>{{ name }}</template>\n            </span>\n            <div class="auxiliary-curves-list-item__operate">\n                <KeyframeBtn :empty="keyframeEmpty" @click.native="onSwitchFrame"></KeyframeBtn>\n            </div>\n        </div>\n    '});exports.AuxiliaryCurves=(0,vue_js_1.defineComponent)({name:"AuxiliaryCurvesList",components:{KeyframeBtn:keyframe_btn_1.KeyframeBtn,AuxListItem:AuxListItem},props:Object.assign(Object.assign({},sharedProps),{currentClip:{type:String,required:!0},currentFrame:{type:Number,default:0}}),setup(e,n){const t=Editor.I18n.t.bind(Editor.I18n),i=(0,hooks_1.useAuxCurveStore)();return{curves:(0,vue_js_1.computed)(()=>i.curves),getListItemKey:(e,n)=>`${n}__${e}`,isItemSelected:e=>{const n=i.selectedCurveName;return""!=n&&n===e.displayName},isKeyframeEmpty:n=>void 0===n.find(n=>n.frame===e.currentFrame),onHeaderMousedown:e=>{animation_editor_1.animationEditor.onStartResize(e,"auxCurve")},onAddClick:()=>{const n=`aux_curve_${Date.now()}`;(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.addNewAuxiliaryCurve)(e.currentClip,n)).then(()=>{i.switchRename(n,!0)})},onItemSelect:e=>{i.selectedCurveName=e.displayName},onItemRemove:n=>{(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.removeAuxiliaryCurve)(e.currentClip,n.key))},onItemRename:async n=>{if(void 0===i.curveNameMap[n.newName])return(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.renameAuxiliaryCurve)(e.currentClip,n.oldName,n.newName));{const e=t("animator.auxiliaryCurve.nameExistedTip",{name:n.newName});await Editor.Dialog.info(e,{title:t("animator.title"),buttons:[t("animator.ok")]})}}}},template:'\n        <div class="auxiliary-curves">\n            <div class="auxiliary-curves__title content-device ns-resize" @mousedown="onHeaderMousedown">\n                <ui-label value="i18n:animator.auxiliaryCurve.title" class="tw-flex-0 tw-min-w-0"></ui-label>\n                <ui-icon color="true" value="experiment" class="tw-flex-0"></ui-icon>\n                <div class="tw-flex-1"></div>\n                <ui-button\n                    tooltip="i18n:animator.auxiliaryCurve.createNew"\n                    class="icon-btn tw-flex-0"\n                    transparent\n                    @click="onAddClick"\n                >\n                    <ui-icon value="add"></ui-icon>\n                </ui-button>\n            </div>\n\n            <div class="auxiliary-curves__list auxiliary-curves-list">\n                <template v-for="(curve, index) in curves">\n                    <AuxListItem\n                        :key="getListItemKey(curve.displayName, index)"\n                        :name="curve.displayName"\n                        :keyframe-empty="isKeyframeEmpty(curve.keyframes)"\n                        :selected="isItemSelected(curve)"\n                        @select="onItemSelect(curve)"\n                        @remove="onItemRemove(curve)"\n                        @rename="onItemRename"\n                    >\n                    </AuxListItem>\n                </template>\n            </div>\n        </div>\n    '});