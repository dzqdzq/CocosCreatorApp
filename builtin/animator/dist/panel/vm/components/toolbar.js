"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.computed=exports.data=exports.props=exports.template=void 0;const animation_ctrl_1=require("../../share/animation-ctrl"),animation_editor_1=require("../../share/animation-editor"),electron_1=require("electron"),grid_ctrl_1=require("../../share/grid-ctrl"),ipc_event_1=require("../../share/ipc-event"),utils_1=require("../../utils"),{join:join}=require("path"),{readFileSync:readFileSync}=require("fs-extra");function data(){return{spacingFrame:1,showType:"time",menu:[]}}async function mounted(){this.spacingFrame=await animation_editor_1.animationEditor.getConfig("spacingFrame");const t=await animation_editor_1.animationEditor.getConfig("showType");t&&(this.showType=t)}exports.template=readFileSync(join(__dirname,"./../../../../static/template/components/toolbar.html"),"utf-8"),exports.props=["currentFrame","state","clipsMenu","currentClip","sample"],exports.data=data,exports.computed={currentTime(){return utils_1.frameFormat(this.currentFrame,this.showType,this.sample)}},exports.methods={t:(t,e="toolbar.")=>Editor.I18n.t(`animator.${e}${t}`),async onMouseDown(t){const e=this,a=t.target.getAttribute("name");if(a)switch(a){case"jump_prev_frame":animation_editor_1.animationEditor.jumpPrevFrame();break;case"jump_first_frame":animation_editor_1.animationEditor.jumpFirstFrame();break;case"jump_next_frame":animation_editor_1.animationEditor.jumpNextFrame();break;case"jump_last_frame":animation_editor_1.animationEditor.jumpLastFrame();break;case"play":case"pause":case"stop":animation_ctrl_1.animationCtrl.updatePlayState(a);break;case"arrange":animation_ctrl_1.animationCtrl.spacingKeys(e.$refs.spacingFrame.value);break;case"exit":animation_ctrl_1.animationCtrl.exit();break;case"saveClip":animation_ctrl_1.animationCtrl.save();break;case"addEvent":animation_ctrl_1.animationCtrl.addEvent();break;case"shortcuts":Editor.Panel.open("shortcuts","animator");break;case"doc":electron_1.shell.openExternal(Editor.Utils.Url.getDocUrl("editor/animation/animation.html"))}},onSpacingFrame(t){this.spacingFrame=t.target.value,animation_editor_1.animationEditor.spacingFrame=this.spacingFrame},changeFrameShowType(t){const e=this;console.debug(t),requestAnimationFrame(()=>{e.showType=t,grid_ctrl_1.gridCtrl.grid.labelShowType=t,grid_ctrl_1.gridCtrl.grid.updateLabels(),animation_editor_1.animationEditor.setConfig("showType",t)})},onTimeConfirm(t){const e=this,a=t.target.value;if(/^([0-9]*)f?$/.test(a))return void animation_editor_1.animationEditor.updateCurrentFrame(Number(a));const i=animation_ctrl_1.animationCtrl.clipConfig.sample,r=a.match(/^([0-9]*)-([0-9]*)$/);if(r){const t=Number(r[1])*i+Number(r[2]);return void animation_editor_1.animationEditor.updateCurrentFrame(t)}const n=/^((?<m>\d((\.\d*)?))m)?(?<s>(\d((\.\d*)?)))s$/;if(n.test(a)){const{groups:{m:t,s:e}}=a.match(n);let r=utils_1.timeToFrame(Number(e),i);t&&(r+=Number(t)*i),animation_editor_1.animationEditor.updateCurrentFrame(r)}requestAnimationFrame(()=>{t.path[0].value=e.currentTime})},async setCurrentClip(t){const e=this,a=t.target;await ipc_event_1.IsetEditClip(t.target.value)||(a.value=e.currentClip)}},exports.mounted=mounted;