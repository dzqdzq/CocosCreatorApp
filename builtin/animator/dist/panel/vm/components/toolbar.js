"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.computed=exports.watch=exports.data=exports.props=exports.template=void 0;const animation_ctrl_1=require("../../share/animation-ctrl"),animation_editor_1=require("../../share/animation-editor"),grid_ctrl_1=require("../../share/grid-ctrl"),ipc_event_1=require("../../share/ipc-event"),utils_1=require("../../utils"),{join:join}=require("path"),{readFileSync:readFileSync}=require("fs-extra");function data(){return{spacingFrame:1,showType:"frame",menu:[]}}async function mounted(){this.spacingFrame=await animation_editor_1.animationEditor.getConfig("spacingFrame")||1;const t=await animation_editor_1.animationEditor.getConfig("showType");t&&(this.showType=t)}exports.template=readFileSync(join(__dirname,"./../../../../static/template/components/toolbar.html"),"utf-8"),exports.props=["currentFrame","state","clipsMenu","currentClip","sample","aniComp"],exports.data=data,exports.watch={showType(){this.$root.showType=this.showType}},exports.computed={currentTime(){return(0,utils_1.transFrameByType)(this.currentFrame,this.showType,this.sample)}},exports.methods={t:(t,a="toolbar.")=>Editor.I18n.t(`animator.${a}${t}`),onMouseDown(t){const a=this,e=t.target.getAttribute("name");if(e)switch(e){case"jump_prev_frame":animation_editor_1.animationEditor.jumpPrevFrame();break;case"jump_first_frame":animation_editor_1.animationEditor.jumpFirstFrame();break;case"jump_next_frame":animation_editor_1.animationEditor.jumpNextFrame();break;case"jump_last_frame":animation_editor_1.animationEditor.jumpLastFrame();break;case"play":case"pause":case"stop":animation_ctrl_1.animationCtrl.updatePlayState(e);break;case"arrange":animation_editor_1.animationEditor.spacingSelectedKeys(a.$refs.spacingFrame.value);break;case"exit":animation_ctrl_1.animationCtrl.exit();break;case"saveClip":animation_ctrl_1.animationCtrl.save();break;case"addEvent":animation_ctrl_1.animationCtrl.addEvent();break;case"shortcuts":Editor.Panel.open("shortcuts","animator");break;case"applyClipCache":animation_editor_1.animationEditor.selectCacheClipToApply()}},onSpacingFrame(t){this.spacingFrame=t.target.value,animation_editor_1.animationEditor.spacingFrame=this.spacingFrame},changeFrameShowType(t){const a=this;requestAnimationFrame(()=>{a.showType=t,grid_ctrl_1.gridCtrl.grid.labelShowType=t,grid_ctrl_1.gridCtrl.grid.updateLabels(),animation_editor_1.animationEditor.setConfig("showType",t)})},onTimeConfirm(t){const a=this,e=t.target.value;if(/^([0-9]*)f?$/.test(e))return void animation_editor_1.animationEditor.updateCurrentFrame(Number(e));const i=animation_ctrl_1.animationCtrl.clipConfig.sample,r=e.match(/^([0-9]*)-([0-9]*)$/);if(r){const t=Number(r[1])*i+Number(r[2]);return void animation_editor_1.animationEditor.updateCurrentFrame(t)}const n=/^((?<m>\d((\.\d*)?))m)?(?<s>(\d((\.\d*)?)))s$/;if(n.test(e)){const{groups:{m:t,s:a}}=e.match(n);let r=(0,utils_1.timeToFrame)(Number(a),i);t&&(r+=Number(t)*i),animation_editor_1.animationEditor.updateCurrentFrame(r)}requestAnimationFrame(()=>{t.path[0].value=a.currentTime})},async setCurrentClip(t){const a=this,e=t.target;if("addClip"===e.value){if("cc.animation.AnimationController"===a.aniComp)return void animation_editor_1.animationEditor.showToast("i18n:animator.mask.editInAnimationControl",2e3);const t=await animation_ctrl_1.animationCtrl.createAniClip();e.value=t||a.currentClip}await(0,ipc_event_1.IsetEditClip)(e.value)||(e.value=a.currentClip)}},exports.mounted=mounted;