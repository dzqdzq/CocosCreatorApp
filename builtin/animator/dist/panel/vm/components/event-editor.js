"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.components=exports.computed=exports.watch=exports.data=exports.props=exports.template=void 0;const ipc_event_1=require("../../share/ipc-event"),animation_ctrl_1=require("../../share/animation-ctrl"),animation_editor_1=require("../../share/animation-editor"),{join:join}=require("path"),{readFileSync:readFileSync}=require("fs-extra"),defaultParams={string:"param",number:0,boolean:!1},defaultFunc=[{func:"",params:[]}];function data(){return{toast:"",toastTask:[],value:[],dirty:!1,debounceSave:null}}function mounted(){this.refresh(),this.debounceSave=require("lodash").debounce(this.saveData,300)}exports.template=readFileSync(join(__dirname,"./../../../../static/template/components/event-editor.html"),"utf-8"),exports.props=["events","frame","uuid"],exports.data=data,exports.watch={},exports.computed={},exports.components={},exports.methods={t:(e,t="event.")=>Editor.I18n.t(`animator.${t}${e}`),onConfirm(e){const t=this,a=e.target.getAttribute("name");if(!a)return;let r=e.target.getAttribute("index");const s=e.target.value;let n;switch(a){case"funcName":if(s===t.value[r].func)break;t.value[r].func=s,t.dirty=!0;break;case"changeParamType":r=JSON.parse(r),(n=t.value[r[0]].params).splice(r[1],1,defaultParams[s]),t.dirty=!0;break;case"param":if(r=JSON.parse(r),(n=t.value[r[0]].params)[r[1]]===s)break;n.splice(r[1],1,s),t.dirty=!0}t.debounceSave()},async onMouseDown(e){const t=this,a=e.target.getAttribute("name");let r=e.target.getAttribute("index");switch(a){case"save":return void t.debounceSave();case"close":return void animation_editor_1.animationEditor.closeEventEditor();case"addFunc":t.value.push(JSON.parse(JSON.stringify(defaultFunc[0])));break;case"delFunc":t.value.splice(r,1);break;case"addParams":t.value[r].params.push("param");break;case"delParams":r=JSON.parse(r),t.value[r[0]].params.splice(r[1],1);break;case"clearParams":t.value[r].params=[]}t.dirty=!0,t.debounceSave()},showToast(e){const t=this;t.toast?t.toastTask.push(e):(t.toast=e,requestAnimationFrame(()=>{t.toast=null,t.toastTask.length>0&&t.showToast(t.toastTask.shift())}))},async saveData(){const e=this,t=e.value.map(e=>({frame:e.frame,func:e.func,params:e.params}));if(0===t.length)return animation_ctrl_1.animationCtrl.deleteEvent(),void(e.dirty=!1);ipc_event_1.IApplyOperation(ipc_event_1.IupdateEvent(e.uuid,e.frame,t)),e.dirty=!1},refresh(){const e=this;let t=JSON.parse(JSON.stringify(e.events));(t=t.filter(t=>t.frame===e.frame)).length<1&&((t=JSON.parse(JSON.stringify(defaultFunc)))[0].frame=e.frame),e.value=t}},exports.mounted=mounted;