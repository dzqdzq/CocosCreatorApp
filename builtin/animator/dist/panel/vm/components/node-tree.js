"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.components=exports.computed=exports.watch=exports.data=exports.name=exports.props=exports.template=void 0;const animation_editor_1=require("../../share/animation-editor"),animation_ctrl_1=require("../../share/animation-ctrl"),utils_1=require("../../utils"),pop_menu_1=require("../../share/pop-menu"),{join:join}=require("path"),{readFileSync:readFileSync}=require("fs-extra");function data(){return{hoving:!1}}function mounted(){}exports.template=readFileSync(join(__dirname,"./../../../../static/template/components/node-tree.html"),"utf-8"),exports.props=["dumps","selectPath","movePath","lock","selectedIds","index","showType","currentFrame"],exports.name="node-tree",exports.data=data,exports.watch={},exports.computed={disabled(){return!(!this.lock&&this.dumps.uuid&&!this.dumps.disabled)},nodeStyle(){return{"padding-left":`${4*this.dumps.indent}px`}},nodeClass(){let t="";t=this.index%2==0?"dark":"light";const e=this.dumps.disabled?"disabled":"";return this.movePath&&this.movePath===this.dumps.path?`content-item moving ${t} ${e}`:`content-item ${t} ${e}`},movingProperty(){return this.movePath&&!this.dumps.uuid?"missing":!(!this.movePath||!this.dumps.uuid)}},exports.components={},exports.methods={t:(t,e="node.")=>Editor.I18n.t(`animator.${e}${t}`),async onMouseDown(t,e){const o=this;if(o.movePath){if(!o.dumps.uuid||o.movePath===o.dumps.path)return;await o.checkMoveData()?animation_ctrl_1.animationCtrl.moveNodeData(e):animation_editor_1.animationEditor.cancelMoveNode()}else{if("showPopMenu"===t.target.getAttribute("name")||2===t.button){const t=(0,pop_menu_1.getPopMenuMap)(pop_menu_1.onNodeMenus,!0);return t.copyNodeData.enabled=!(o.lock||o.dumps.disabled),t.copyNodeData.click=(()=>{animation_ctrl_1.animationCtrl.copyNodeData([e])}),t.pasteNodeData.enabled=!(o.lock||o.dumps.disabled||!animation_ctrl_1.animationCtrl.copyNodeInfo),t.pasteNodeData.click=(()=>{animation_ctrl_1.animationCtrl.pasteNodeData(e)}),t.moveNodeData.enabled=!o.lock&&!o.dumps.disabled,t.moveNodeData.click=(()=>{animation_editor_1.animationEditor.startMoveNode(e)}),t.clearNodeData.enabled=!o.lock&&!o.dumps.disabled,t.clearNodeData.click=(()=>{animation_ctrl_1.animationCtrl.clearNodeKeys(e)}),void Editor.Menu.popup({menu:Object.values(t)})}o.selectPath!==e&&animation_editor_1.animationEditor.selectNode(e,(0,utils_1.checkCtrlOrCommand)(t))}},onDragStart(){animation_editor_1.animationEditor.setMovePath(this.dumps.path)},onDragEnd(){animation_editor_1.animationEditor.cancelMoveNode()},onDragOver(t){this.movePath&&this.dumps.uuid&&this.dumps.path!==this.movePath&&(this.hoving=!0,t.preventDefault())},onDragLeave(){this.hoving=!1},onDrop(){animation_ctrl_1.animationCtrl.moveNodeData(this.dumps.path)},async checkMoveData(){const t=this,e=e=>t.t("",e);return 1===(await Editor.Dialog.warn(e("is_move_data_message"),{title:e("is_move_data"),buttons:[e("cancel"),e("move")],default:0,cancel:0})).response}},exports.mounted=mounted;