"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gridCtrl=void 0;const utils_1=require("../utils"),grid_1=require("../vm/grid");class GridCtrl{constructor(){this.gridCanvas=null,this.grid=null,this.startOffset=10,this.$left=null,this.$right=null}get scale(){return this.grid&&this.grid.xAxisScale||100}init(t){const{$canvas:i,$left:e,$right:r,$xAxis:s,showType:a}=t;i.width=r.offsetWidth,i.height=r.offsetHeight,this.gridCanvas=i,this.$left=e,this.$right=r;const l=i.getContext("2d");this.grid=new grid_1.Grid({context:l,lineWidth:.5,showType:a||"time",axis:{container:{x:s},startOffset:this.startOffset,lods:[5,2,3,2],minScale:t.minScale||1,maxScale:t.maxScale||50,sample:60},hformat:utils_1.frameFormat}),this.grid.xAxisScaleAt(this.$left.offsetWidth,20)}getFrameRang(){if(!this.grid||!this.gridCanvas)return{start:0,end:0};const t=this.gridCanvas.width;return{start:Math.ceil(this.grid.pixelToValueH(this.startOffset+this.grid.xAxisScale/2)),end:Math.floor(this.grid.pixelToValueH(this.startOffset+t-this.grid.xAxisScale/2))}}checkOverFlow(t){const i=this.getFrameRang();return i?t>i.end?t-i.end:t<i.start?t-i.start:0:0}pageToFrame(t){if(!exports.gridCtrl.grid)return 0;const i=t-this.$left.getBoundingClientRect().right,e=Math.round(exports.gridCtrl.grid.pixelToValueH(Math.abs(i)));return i>0?e:-e}pageToCtrl(t,i){return{x:t-=this.$left.getBoundingClientRect().right,y:i-=this.$left.getBoundingClientRect().top}}frameToCanvas(t){let i=0;return this.grid&&(i=this.grid.valueToPixelH(t)-exports.gridCtrl.grid.xAxisOffset),Number(i)}canvasToFrame(t){let i=Math.ceil(exports.gridCtrl.grid.pixelToValueH(t+exports.gridCtrl.grid.xAxisOffset));return i<0&&(i=0),i}}exports.gridCtrl=new GridCtrl;