"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../panel/utils"),Vue=require("vue/dist/vue.js");exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/embedded-player.css"),"utf8"),exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/embedded-player.html"),"utf8");let panel=null,vm=null;function update(e){vm||initVue(),panel=this;try{const t=e.map(e=>JSON.parse(e))[0];vm.nodeFilterOptions.pathPattern=`${t.root}/**`,vm.$set(vm,"embeddedPlayer",t.dump),vm.$set(vm,"selectInfo",t)}catch(e){console.error(e)}}function ready(){panel=this,initVue()}function initVue(){vm=new Vue({el:panel.$.root,data:function(){return{embeddedPlayer:null,selectInfo:null,nodeFilterOptions:{pathPattern:""}}},computed:{typeInfo(){return this.embeddedPlayer?utils_1.EmbeddedPlayerMenuMap[this.embeddedPlayer.playable.type]:null},defaultDisplayName(){const e=this;return e.embeddedPlayer?e.embeddedPlayer.displayName?e.embeddedPlayer.displayName:e.embeddedPlayer.playable.path?(0,path_1.basename)(e.embeddedPlayer.playable.path):"":""}},methods:{onSelectNode(e){Date.now();const t=e.target,d=this;Editor.Panel.__protected__.openKit("ui-kit.searcher",{elem:t,params:[{type:"node",droppable:"cc.Node",filterOptions:d.nodeFilterOptions}],listeners:{confirm:e=>{e&&d.onNodeConfirm(e.info.path)},change:e=>{e&&d.onNodeConfirm(e.info.path)},cancel:e=>{e&&d.onNodeConfirm(e.info.path)}}})},onNodeConfirm(e){if(!e)return;const t={...this.embeddedPlayer,playable:{...this.embeddedPlayer.playable,path:e.replace(this.selectInfo.root,"")}};this.updateEmbeddedPlayer(t),this.embeddedPlayer=t},onAssetConfirm(e){const t={...this.embeddedPlayer,playable:{...this.embeddedPlayer.playable,clip:e}};this.updateEmbeddedPlayer(t),this.embeddedPlayer=t},onDisplayNameConfirm(e){const t={...this.embeddedPlayer,displayName:e};this.updateEmbeddedPlayer(t),this.embeddedPlayer=t},updateEmbeddedPlayer(e){Editor.Message.request("scene","animation-operation",[{funcName:"updateEmbeddedPlayer",args:[this.selectInfo.clipUuid,this.embeddedPlayer,e]}])},onReconciledSpeed(e){this.embeddedPlayer.reconciledSpeed=e,this.updateEmbeddedPlayer(this.embeddedPlayer)}}})}exports.$={root:".root",clip:".clip",data:".data",node:".node",clipWrap:".clip-wrap"},exports.methods={undo(){},redo(){}},exports.update=update,exports.ready=ready;