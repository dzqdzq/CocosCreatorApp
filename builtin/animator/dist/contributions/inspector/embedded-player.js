"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t);var l=Object.getOwnPropertyDescriptor(a,t);l&&("get"in l?a.__esModule:!l.writable&&!l.configurable)||(l={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(e,r,l)}:function(e,a,t,r){e[r=void 0===r?t:r]=a[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(a,e,t);return __setModuleDefault(a,e),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../panel/utils"),vue_js_1=__importStar(require("vue/dist/vue.js")),vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/embedded-player.html"),"utf8");let panel=null,vm=null;const EmbeddedPlayerVM=(0,vue_js_1.defineComponent)({name:"EmbeddedPlayerVM",setup(e,{expose:a}){const t=(0,vue_js_1.ref)(""),r=(0,vue_js_1.ref)(),l=(0,vue_js_1.ref)({root:"",clipUuid:""}),u=(0,vue_js_1.ref)(null),n=(0,vue_js_1.ref)("{}"),o=(0,vue_js_1.ref)({});var s=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);if(e&&e.playable)return utils_1.EmbeddedPlayerMenuMap[e.playable.type]});const d=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);const a=(0,vue_js_1.unref)(o);if(!e||!e.playable||!e.playable.path)return"";const t=""+l.value.root+e.playable.path;return Object.keys(a).find(e=>a[e]===t)||""});var i=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);return e?e.displayName||(e.playable&&e.playable.path?(0,path_1.basename)(e.playable.path):""):""});const p=(e,a={})=>{a[e.uuid]=e.path,e.children&&e.children.forEach(e=>{p(e,a)})},_=((0,vue_js_1.onMounted)(async()=>{var e,a=await Editor.Message.request("scene","query-current-animation-info");a&&(t.value=a.rootid,a=await Editor.Message.request("scene","query-node-tree",a.rootid),e={},p(a,e),o.value=e)}),e=>{var a=(0,vue_js_1.unref)(r.value);Editor.Message.request("scene","animation-operation",[{funcName:"updateEmbeddedPlayer",args:[l.value.clipUuid,a,e]}])});return a({updatePlayerData:e=>{var a={rootNode:t.value,pathPattern:e.root+"/**"};n.value=JSON.stringify(a),r.value=e.dump,l.value=e}}),{selectInfo:l,childNodeRef:u,embeddedPlayer:r,nodeFilterOptionsStr:n,typeInfo:s,childNodeUuid:d,defaultDisplayName:i,onDisplayNameConfirm:e=>{var a=(0,vue_js_1.unref)(r);a&&(a={...a,displayName:e},_(a),r.value=a)},onReconciledSpeed:e=>{var a=(0,vue_js_1.unref)(r);a&&(a={...a,reconciledSpeed:e},_(a),r.value=a)},onNodeConfirm:e=>{var a=(0,vue_js_1.unref)(r),t=(0,vue_js_1.unref)(o);a?.playable&&(a={...a,playable:{...a.playable}},!(t=(t[e]||"").replace(l.value.root,""))&&e?u.value.value=d.value:(a.playable.path=e&&t,_(a),r.value=a))},onAssetConfirm:e=>{var a=(0,vue_js_1.unref)(r);a&&a.playable&&(a={...a,playable:{...a.playable,clip:e}},_(a),r.value=a)}}},template:vueTemplate}),EmbeddedPlayerVMExtend=vue_js_1.default.extend(EmbeddedPlayerVM);async function update(e){if(vm)try{var a=e.map(e=>JSON.parse(e));vm.updatePlayerData(a[0])}catch(e){console.error(e)}}function ready(){panel=this,vm?.$destroy(),(vm=new EmbeddedPlayerVMExtend).$mount(panel.$.container)}function close(){vm?.$destroy(),vm=null,panel=null}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/embedded-player.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"},exports.update=update,exports.ready=ready,exports.close=close;