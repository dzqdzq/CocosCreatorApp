"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){e[r=void 0===r?a:r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t,a=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[a.length]=t);return a})(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),r=0;r<a.length;r++)"default"!==a[r]&&__createBinding(t,e,a[r]);return __setModuleDefault(t,e),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.$=exports.template=exports.style=void 0,exports.update=update,exports.ready=ready,exports.close=close;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../panel/utils"),vue_js_1=__importStar(require("vue/dist/vue.js")),vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/embedded-player.html"),"utf8");let panel=null,vm=null;const EmbeddedPlayerVM=(0,vue_js_1.defineComponent)({name:"EmbeddedPlayerVM",setup(e,{expose:t}){const a=(0,vue_js_1.ref)(""),r=(0,vue_js_1.ref)(),n=(0,vue_js_1.ref)({root:"",clipUuid:""}),u=(0,vue_js_1.ref)(null),l=(0,vue_js_1.ref)("{}"),o=(0,vue_js_1.ref)({});var s=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);if(e&&e.playable)return utils_1.EmbeddedPlayerMenuMap[e.playable.type]});const i=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);const t=(0,vue_js_1.unref)(o);if(!e||!e.playable||!e.playable.path)return"";const a=""+n.value.root+e.playable.path;return Object.keys(t).find(e=>t[e]===a)||""});var d=(0,vue_js_1.computed)(()=>{var e=(0,vue_js_1.unref)(r);return e?e.displayName||(e.playable&&e.playable.path?(0,path_1.basename)(e.playable.path):""):""});const p=(e,t={})=>{t[e.uuid]=e.path,e.children&&e.children.forEach(e=>{p(e,t)})},_=((0,vue_js_1.onMounted)(async()=>{var e,t=await Editor.Message.request("scene","query-current-animation-info");t&&(a.value=t.rootid,t=await Editor.Message.request("scene","query-node-tree",t.rootid),e={},p(t,e),o.value=e)}),e=>{var t=(0,vue_js_1.unref)(r.value);Editor.Message.request("scene","animation-operation",[{funcName:"updateEmbeddedPlayer",args:[n.value.clipUuid,t,e]}])});return t({updatePlayerData:e=>{var t={rootNode:a.value,pathPattern:e.root+"/**"};l.value=JSON.stringify(t),r.value=e.dump,n.value=e}}),{selectInfo:n,childNodeRef:u,embeddedPlayer:r,nodeFilterOptionsStr:l,typeInfo:s,childNodeUuid:i,defaultDisplayName:d,onDisplayNameConfirm:e=>{var t=(0,vue_js_1.unref)(r);t&&(t={...t,displayName:e},_(t),r.value=t)},onReconciledSpeed:e=>{var t=(0,vue_js_1.unref)(r);t&&(t={...t,reconciledSpeed:e},_(t),r.value=t)},onNodeConfirm:e=>{var t=(0,vue_js_1.unref)(r),a=(0,vue_js_1.unref)(o);t?.playable&&(t={...t,playable:{...t.playable}},!(a=(a[e]||"").replace(n.value.root,""))&&e?u.value.value=i.value:(t.playable.path=e&&a,_(t),r.value=t))},onAssetConfirm:e=>{var t=(0,vue_js_1.unref)(r);t&&t.playable&&(t={...t,playable:{...t.playable,clip:e}},_(t),r.value=t)}}},template:vueTemplate}),EmbeddedPlayerVMExtend=vue_js_1.default.extend(EmbeddedPlayerVM);async function update(e){if(vm)try{var t=e.map(e=>JSON.parse(e));vm.updatePlayerData(t[0])}catch(e){console.error(e)}}function ready(){panel=this,vm?.$destroy(),(vm=new EmbeddedPlayerVMExtend).$mount(panel.$.container)}function close(){vm?.$destroy(),vm=null,panel=null}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/embedded-player.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"};