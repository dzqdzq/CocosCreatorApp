"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../panel/utils"),Vue=require("vue/dist/vue.js");exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/embedded-player.css"),"utf8"),exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/embedded-player.html"),"utf8");let panel=null,vm=null;function update(e){vm||initVue(),panel=this;try{const t=e.map(e=>JSON.parse(e))[0];vm.nodeFilterOptions.pathPattern=`${t.root}/**`,vm.$set(vm,"embeddedPlayer",t.dump),vm.$set(vm,"selectInfo",t)}catch(e){console.error(e)}}function ready(){panel=this,initVue()}function initVue(){vm=new Vue({el:panel.$.root,data:function(){return{embeddedPlayer:null,selectInfo:null,nodeFilterOptions:{pathPattern:""}}},computed:{typeInfo(){return this.embeddedPlayer&&this.embeddedPlayer.playable?utils_1.EmbeddedPlayerMenuMap[this.embeddedPlayer.playable.type]:null}},methods:{onSelectNode(e){const t=Date.now(),d=e.target,a=this;Editor.Panel._kitControl.open({$kit:d,name:"ui-kit.searcher",droppable:"cc.Node",type:"node",timestamp:t,filterOptions:a.nodeFilterOptions,events:{confirm:(e,t)=>{a.onNodeConfirm(t.path)},change:(e,t)=>{a.onNodeConfirm(t.path)},cancel:(e,t)=>{a.onNodeConfirm(t.path)}}})},onNodeConfirm(e){if(!e)return;const t=Object.assign(Object.assign({},this.embeddedPlayer),{playable:Object.assign(Object.assign({},this.embeddedPlayer.playable),{path:e.replace(this.selectInfo.root,"")})});this.updateEmbeddedPlayer(t),this.embeddedPlayer=t},onAssetConfirm(e){const t=Object.assign(Object.assign({},this.embeddedPlayer),{playable:Object.assign(Object.assign({},this.embeddedPlayer.playable),{clip:e})});this.updateEmbeddedPlayer(t),this.embeddedPlayer=t},updateEmbeddedPlayer(e){Editor.Message.request("scene","animation-operation",[{funcName:"updateEmbeddedPlayer",args:[this.selectInfo.clipUuid,this.embeddedPlayer,e]}])},onReconciledSpeed(e){this.embeddedPlayer.reconciledSpeed=e,this.updateEmbeddedPlayer(this.embeddedPlayer)}}})}exports.$={root:".root",clip:".clip",data:".data",node:".node",clipWrap:".clip-wrap"},exports.methods={undo(){},redo(){}},exports.update=update,exports.ready=ready;