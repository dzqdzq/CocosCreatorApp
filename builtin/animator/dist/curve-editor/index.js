"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.listeners=exports.methods=exports.$=exports.style=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),curve_ctrl_1=require("../curve/curve-ctrl"),hermite_1=require("../curve/hermite"),DEFAULT_PRESETS=require("../../static/curve-editor/preset").default,Vue=require("vue/dist/vue.js");let panel,vm,curveCtrl;async function ready(){vm=new Vue({el:(panel=this).$.main,data:()=>({sample:60,showType:"frame",keyframes:[{outTangent:1,time:.2,value:.4},{inTangent:1,outTangent:1,time:.5,value:.5},{inTangent:.5,time:.8,value:0}],curveConfig:{preWrapMode:22,postWrapMode:22},userPreset:[],presetCanvas:{},presetConfig:{size:{w:200,h:200},negative:!1,tab:"default"}}),methods:{init(){this.$refs.curve.width=this.$refs["curve-wrap"].offsetWidth,this.$refs.curve.height=this.$refs["curve-wrap"].offsetHeight,this.presetConfig.size={w:this.$refs.presets.offsetWidth,h:.3*this.$refs.presets.offsetWidth},(curveCtrl=new curve_ctrl_1.CurveCtrl(this.$refs.curve,{curveConfig:{strokeStyle:"red",preWrapMode:this.curveConfig.preWrapMode,postWrapMode:this.curveConfig.postWrapMode},gridConfig:{negative:!0,axisXConfig:{$container:this.$refs.curveX,startOffset:0,maxValue:1,lods:[5,2]},axisYConfig:{$container:this.$refs.curveY,startOffset:0,maxValue:1,lods:[5,2]},axisMargin:30},handlerSize:30})).paint(this.translateToGrid(this.keyframes)),this.initDefaultPreset()},translateToRaw(e){const t=curveCtrl.grid.xMaxValue,r=curveCtrl.grid.axisXConfig.maxValue,a=curveCtrl.grid.yMaxValue,i=curveCtrl.grid.axisYConfig.maxValue;return e.map(e=>{const s={outTangent:e.outTangent,inTangent:e.inTangent,time:0,value:0};return s.time=t/e.point.x*r,s.value=a/e.point.y*i,s.outTangent&&(s.outTangent*=t/r/(a/i)),s.inTangent&&(s.inTangent*=t/r/(a/i)),s})},translateToGrid(e){const t=curveCtrl.grid.xMaxValue,r=curveCtrl.grid.axisXConfig.maxValue,a=curveCtrl.grid.yMaxValue,i=curveCtrl.grid.axisYConfig.maxValue;return e.map(e=>{const s={outTangent:e.outTangent,inTangent:e.inTangent,point:{x:0,y:0}};return s.point.x=t/r*e.time,s.point.y=a/i*e.value,s.outTangent&&(s.outTangent*=a/i/(t/r)),s.outTangent&&(s.inTangent*=a/i/(t/r)),s})},onMouseWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)?curveCtrl.moveTimeLineX(e.deltaY):curveCtrl.scaleTimeLine(e.offsetX,e.clientY,-e.deltaY),curveCtrl.rePaint()},onWrapMode(e){const t=parseInt(e.target.value),r=e.target.getAttribute("name");this.curveConfig[r]=t,curveCtrl.updateWrapMode(r,t)},initDefaultPreset(){const e=this,t=e.$refs.presets;DEFAULT_PRESETS.forEach((r,a)=>{const i=e.drawPreset(r,e.presetConfig.negative,e.presetCanvas[a]);e.presetCanvas["default"+a]=i,i&&(i.setAttribute("path","default"),i.setAttribute("index",a),t.append(i))})},drawPreset(e,t,r){const a=this;let i=r;return i||(i=document.createElement("canvas"),a.resizeCanvas(i,a.presetConfig.size)),hermite_1.Hermite.paintHermit(e,i,t),r?null:i},resizeCanvas(e,t){e.width=t.w,e.height=t.h},onPreset(e){const t=this,r=e.target.getAttribute("path"),a=e.target.getAttribute("index");let i;(i="default"===r?DEFAULT_PRESETS[a]:t.userPresets[a])&&curveCtrl.paint(t.translateToGrid(i))}},mounted(){this.init()}})}exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static","/curve-editor/index.html"),"utf8"),exports.style=fs_1.readFileSync(path_1.join(__dirname,"style.css"),"utf8"),exports.$={main:".curve-editor"},exports.methods={},exports.listeners={},exports.ready=ready;