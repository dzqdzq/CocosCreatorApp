"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.directives=exports.created=exports.methods=exports.computed=exports.watch=exports.data=exports.props=exports.name=exports.template=void 0;const fs=__importStar(require("fs-extra")),path=__importStar(require("path")),huawei=require("./lib/huawei"),phone_1=require("../../utils/phone"),log_1=require("../../utils/log"),info_1=require("../../utils/info");function data(){return{rpkPath:"",params:"",huaweiPlugin:huawei}}exports.template=fs.readFileSync(path.join(__dirname,"../../../static/plugins/huawei/ui.html"),"utf-8"),exports.name="huawei-runtime",exports.props=[],exports.data=data,exports.watch={},exports.computed={runDisabled:function(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free},cancelDisabled:function(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free}},exports.methods={t:e=>Editor.I18n.t(e),paramsChange(e){this.params=e.target.value},rpkSelected(e){this.rpkPath=e.target.value},register_handler(){phone_1.phone.on("add_device",async e=>{huawei.needToCreatLogcat(e)&&(await huawei.checkRuntime(),huawei.openLogcat(e))}),phone_1.phone.on("remove_device",e=>{})},async installApk(){await huawei.installRuntime()},async onChooseRpkPath(e){e.stopPropagation();let t=this,a=await Editor.Dialog.select({path:path.join(Editor.Project.path,"/build"),type:"file",filters:[{name:`${this.t("runtime-dev-tools.huawei")} runtime rpk`,extensions:["rpk"]}]});a.filePaths&&a.filePaths[0]&&(t.rpkPath=a.filePaths[0])},getLaunchParams(){let e=this,t=["--ei","debugmode","1"];if(e.uri&&(t.push("--es"),t.push("uri"),t.push(encodeURIComponent(e.uri))),e.params){let a="";try{a=JSON.parse(e.params),t.push("--es"),t.push("params"),t.push(encodeURIComponent(e.params))}catch(e){log_1.log.warn(this.t("runtime-dev-tools.error_params"))}}return t.join(" ")},async launch(){let e=this;if(!fs.existsSync(e.rpkPath))return log_1.log.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath),void info_1.info.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath);await huawei.stopRuntime(),await huawei.pushRpkToPhone(e.rpkPath),await huawei.startRuntimeWithRpk(path.basename(e.rpkPath),this.getLaunchParams())},async stop(){await huawei.stopRuntime()}},exports.created=async function(){this.register_handler(),await huawei.checkRuntimeVersion(),this.rpkPath=await huawei.getRpkPath()},exports.directives={};