"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateCommonTsConfig=void 0;const path_1=__importDefault(require("path")),fs_extra_1=__importDefault(require("fs-extra")),db_module_url_1=require("../utils/db-module-url");async function generateCommonTsConfig(){const e=path_1.default.join(Editor.Project.path,"tsconfig.json"),t=path_1.default.join(Editor.Project.path,"temp"),n=path_1.default.join(t,"tsconfig.cocos.json"),a=path_1.default.join(t,"declarations"),o=[],i=function(){const e=[];return 0===e.length?void 0:e}(),r={};await Promise.all([async function(){const e=await Editor.Message.request("engine","query-info"),t=path_1.default.join(a,"cc.d.ts");await fs_extra_1.default.outputFile(t,generateEngineDeclarationFile(e.path),{encoding:"utf8"}),o.push(u(t))}(),async function(){const e=path_1.default.join(a,"cc.env.d.ts");await fs_extra_1.default.outputFile(e,await generateEnvDeclarationFile(),{encoding:"utf8"}),o.push(u(e))}(),async function(){const e=path_1.default.join(a,"jsb.d.ts");await fs_extra_1.default.outputFile(e,generateJsbDeclarationFile(),{encoding:"utf8"}),o.push(u(e))}(),async function(){const e=await Editor.Message.request("asset-db","query-db-list");for(const t of e){const e=await Editor.Message.request("asset-db","query-db-info",t),n=db_module_url_1.getDatabaseModuleRootURL(t);r[`${n}*`]=[path_1.default.join(e.target,"*")]}}()]);const s={$schema:"https://json.schemastore.org/tsconfig",compilerOptions:{target:"ES2015",module:"ES2015",strict:!0,types:o,libs:i,paths:r,experimentalDecorators:!0,isolatedModules:!0,moduleResolution:"node",noEmit:!0,forceConsistentCasingInFileNames:!0}};function u(t){const n=path_1.default.relative(path_1.default.dirname(e),t),a=(n.endsWith(".d.ts")?n.substr(0,n.length-5):n).replace(/\\/g,"/");return a.startsWith("./")||a.startsWith("../")?a:`./${a}`}await fs_extra_1.default.outputJson(n,s,{spaces:2})}function generateEngineDeclarationFile(e){return`\n    /// <reference path="${path_1.default.join(e,"bin/.declarations/cc.d.ts")}"/>\n    \n    /**\n     * @deprecated Global variable \`cc\` was dropped since 3.0. Use ES6 module syntax to import Cocos Creator APIs.\n     */\n    declare const cc: never;\n    `}function generateJsbDeclarationFile(){return`/// <reference path="${path_1.default.join(Editor.App.path,"../resources/3d/engine/@types/jsb.d.ts")}"/>\n`}async function generateEnvDeclarationFile(){const e=await Promise.resolve().then(()=>__importStar(require("cc/editor/populate-internal-constants")));return`declare module "cc/env" {\n${Object.entries(e).map(([e,t])=>`    export const ${e}: ${typeof t};\n`).join("\n")}\n}\n`}exports.generateCommonTsConfig=generateCommonTsConfig;