"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,a,r,t){void 0===t&&(t=r),Object.defineProperty(e,t,{enumerable:!0,get:function(){return a[r]}})}:function(e,a,r,t){void 0===t&&(t=r),e[t]=a[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(a,e,r);return __setModuleDefault(a,e),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.messages=exports.initialize=void 0;const asserts_1=require("../utils/asserts");let globalPackerDriver=null;async function initialize(){asserts_1.asserts(!globalPackerDriver);const{PackerDriver:e}=await Promise.resolve().then(()=>__importStar(require("./packer-driver"))),a=await e.create();globalPackerDriver=a,Editor.Message.addBroadcastListener("asset-db:ready",async()=>{await a.resetDatabases(!1),await a.pullAssetDb()}),Editor.Message.addBroadcastListener("asset-db:close",async()=>{await a.shutDown()}),Editor.Message.addBroadcastListener("asset-db:db-ready",async()=>{await a.resetDatabases()}),Editor.Message.addBroadcastListener("asset-db:db-close",async()=>{await a.resetDatabases()})}exports.initialize=initialize,exports.messages={async"packer-driver/get-loader-context"(e){var a;return asserts_1.assertsNonNullable(globalPackerDriver),null===(a=globalPackerDriver.getQuickPackLoaderContext(e))||void 0===a?void 0:a.serialize()},"packer-driver/ready":async e=>null===globalPackerDriver||void 0===globalPackerDriver?void 0:globalPackerDriver.isReady(e)};