"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(a,e,t);return __setModuleDefault(a,e),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.messages=exports.initialize=void 0;const asserts_1=require("../utils/asserts"),intelligence_1=require("../intelligence"),getGlobalPackDriver=(()=>{let e,a=null;return async()=>a||(e||(e=async function(){const{PackerDriver:e}=await Promise.resolve().then(()=>__importStar(require("./packer-driver"))),t=await e.create();a=t;let r=!1;return Editor.Message.addBroadcastListener("asset-db:ready",async()=>{s=500,new Promise(e=>{setTimeout(e,s)}),asserts_1.asserts(!r,"DB is still opening."),r=!0,await t.resetDatabases(!1),await t.pullAssetDb()}),Editor.Message.addBroadcastListener("asset-db:close",async()=>{asserts_1.asserts(r,"DB has not been ready."),r=!1,await t.shutDown()}),Editor.Message.addBroadcastListener("asset-db:db-ready",async()=>{r&&await t.resetDatabases()}),Editor.Message.addBroadcastListener("asset-db:db-close",async()=>{r&&await t.resetDatabases()}),t;var s}()),await e)})();async function initialize(){await getGlobalPackDriver()}exports.initialize=initialize,exports.messages={async"packer-driver/get-loader-context"(e){var a;return null===(a=(await getGlobalPackDriver()).getQuickPackLoaderContext(e))||void 0===a?void 0:a.serialize()},"packer-driver/ready":async e=>(await getGlobalPackDriver()).isReady(e),async"clear-code-cache"(){console.debug("Clearing code cache");const e=await getGlobalPackDriver();await e.clearCache()},async"custom-macro-changed"(){await intelligence_1.updateCustomMacro()}};