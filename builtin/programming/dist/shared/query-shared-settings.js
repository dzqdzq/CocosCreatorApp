"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.querySharedSettings=void 0;const fs_extra_1=__importDefault(require("fs-extra")),url_1=require("url");async function querySharedSettings(e){const[r,t,o,i,s,l]=await Promise.all([Editor.Profile.getProject("project","script.useDefineForClassFields"),Editor.Profile.getProject("project","script.allowDeclareFields"),Editor.Profile.getProject("project","script.loose"),!1,Editor.Profile.getProject("project","script.exportsConditions"),Editor.Profile.getProject("project","script.importMap")]);let n;if(l)try{const r=Editor.UI.File.resolveToRaw(l),t=await fs_extra_1.default.readJson(r,{encoding:"utf8"});verifyImportMapJson(t)?n={json:t,url:(0,url_1.pathToFileURL)(r).href}:e.error("Ill-formed import map.")}catch(r){e.error(`Failed to load import map at ${l}: ${r}`)}return{useDefineForClassFields:null===r||void 0===r||r,allowDeclareFields:null===t||void 0===t||t,loose:null!==o&&void 0!==o&&o,exportsConditions:null!==s&&void 0!==s?s:[],guessCommonJsExports:null!==i&&void 0!==i&&i,importMap:n}}function verifyImportMapJson(e){if("object"!=typeof e||!e)return!1;const r=e=>{if("object"!=typeof e||!e)return!1;for(const r of Object.values(e))if("string"!=typeof r)return!1;return!0};if("imports"in e&&!r(e.imports))return!1;if("scopes"in e)for(const t of Object.values(e))if(!r(t))return!1;return!0}exports.querySharedSettings=querySharedSettings;