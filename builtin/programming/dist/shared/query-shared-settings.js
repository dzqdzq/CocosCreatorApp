"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.querySharedSettings=querySharedSettings;const fs_extra_1=__importDefault(require("fs-extra")),url_1=require("url"),fs_1=require("fs");async function querySharedSettings(r){var[e,t,o,i,s,l,a]=await Promise.all([Editor.Profile.getProject("project","script.useDefineForClassFields"),Editor.Profile.getProject("project","script.allowDeclareFields"),Editor.Profile.getProject("project","script.loose"),!1,Editor.Profile.getProject("project","script.exportsConditions"),Editor.Profile.getProject("project","script.importMap"),Editor.Profile.getProject("project","script.preserveSymlinks")]);let n;if(l&&"project://"!==l){var p=Editor.UI.__protected__.File.resolveToRaw(l);if(p&&(0,fs_1.existsSync)(p))try{var f=await fs_extra_1.default.readJson(p,{encoding:"utf8"});verifyImportMapJson(f)?n={json:f,url:(0,url_1.pathToFileURL)(p).href}:r.error("Ill-formed import map.")}catch(e){r.error(`Failed to load import map at ${l}: `+e)}else r.warn("Import map file not found in: "+(p||l))}return{useDefineForClassFields:e??!0,allowDeclareFields:t??!0,loose:o??!1,exportsConditions:s??[],guessCommonJsExports:i??!1,importMap:n,preserveSymlinks:a??!1}}function verifyImportMapJson(e){if("object"!=typeof e||!e)return!1;var r=e=>{if("object"!=typeof e||!e)return!1;for(const r of Object.values(e))if("string"!=typeof r)return!1;return!0};if("imports"in e&&!r(e.imports))return!1;if("scopes"in e)for(const t of Object.values(e))if(!r(t))return!1;return!0}