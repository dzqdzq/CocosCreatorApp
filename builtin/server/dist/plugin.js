"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detach=exports.attach=exports.socketArray=exports.postArray=exports.getArray=exports.fileArray=void 0;const path_1=require("path"),express_1=__importDefault(require("express")),socket_1=require("./socket"),glob2rex_1=require("./glob2rex");function attach(e){if(e.invalid)return;if(!e.info.contributions||!e.info.contributions.server)return;const r=(0,path_1.join)(e.path,e.info.contributions.server),t=e=>e instanceof RegExp?e:(0,glob2rex_1.globToRegExp)(e);try{const o=Editor.Module.__protected__.requireFile(r);o.file&&o.file.forEach(r=>{exports.fileArray.push({name:e.name,url:r.url,regexp:(e=>e instanceof RegExp?e:(0,glob2rex_1.globToRegExp)(e+"*"))(r.url),handle:express_1.default.static(r.path)})}),o.get&&o.get.forEach(r=>{exports.getArray.push({name:e.name,url:r.url,regexp:t(r.url),handle:r.handle})}),o.post&&o.post.forEach(r=>{exports.postArray.push({name:e.name,url:r.url,regexp:t(r.url),handle:r.handle})}),o.connection&&exports.socketArray.push({name:e.name,connection:o.connection,disconnect:o.disconnect})}catch(e){console.error(e)}}function detach(e){for(let r=0;r<exports.fileArray.length;r++)exports.fileArray[r].name===e.name&&exports.fileArray.splice(r--,1);for(let r=0;r<exports.getArray.length;r++)exports.getArray[r].name===e.name&&exports.getArray.splice(r--,1);for(let r=0;r<exports.postArray.length;r++)exports.postArray[r].name===e.name&&exports.postArray.splice(r--,1);for(let r=0;r<exports.socketArray.length;r++)exports.socketArray[r].name===e.name&&(exports.socketArray[r].disconnect((0,socket_1.getSocket)()),exports.socketArray.splice(r--,1))}exports.fileArray=[],exports.getArray=[],exports.postArray=[],exports.socketArray=[],exports.attach=attach,exports.detach=detach;