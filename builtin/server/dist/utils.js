"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.sortIp=exports.scan=void 0;const os_1=__importDefault(require("os"));function getIPAdress(){const t=[],e=os_1.default.networkInterfaces();for(const r in e){const o=e[r];if(o)for(let e=0;e<o.length;e++){const r=o[e];"IPv4"!==r.family||"127.0.0.1"===r.address||r.internal||t.push(r)}}return t}async function scan(){const t=getIPAdress().map(t=>{const e=t.netmask.split(".").map(t=>Number(t)),r=t.address.split(".").map(t=>Number(t));return e.map((t,e)=>{const o=t&r[e];return[o,o+(255-t)]})}),e=[[]];let r=0,o=!1;for(const s of t)for(let t=s[0][0];t<=s[0][1];t++)for(let n=s[1][0];n<=s[1][1];n++)for(let p=s[2][0];p<=s[2][1];p++)for(let a=s[3][0];a<=s[3][1];a++){if(!1===o){o=!0;continue}const s=e[r];s.push(new Promise(async e=>{setTimeout(()=>{e(null)},1e4);for(let r=7456;r<7460;r++)Editor.Network.get(`http://${t}.${n}.${p}.${a}:${r}/__server__/handshake`).then(o=>{if(o)try{const s=JSON.parse(o.toString());return s.ip=`${t}.${n}.${p}.${a}`,s.port=r,e(s)}catch(t){return}else e(null)})})),s.length>=100&&(e[++r]=[])}const s=[];for(const t of e)t&&t.length&&(await Promise.all(t)).forEach(t=>t&&s.push(t));return s}exports.scan=scan;const otherIp="other",ipAddrMap={192.168:1,172:2,10:3,169.254:4,[otherIp]:5,127:6},ipReg=/^((\d+)(?:\.(\d+))?)(\..*)?$/;function sortIp(t){return t.sort((t,e)=>{const[,r,o]=t.match(ipReg)||[],[,s,n]=e.match(ipReg)||[];return(ipAddrMap[r]||ipAddrMap[o]||ipAddrMap[otherIp])-(ipAddrMap[s]||ipAddrMap[n]||ipAddrMap[otherIp])})}exports.sortIp=sortIp;