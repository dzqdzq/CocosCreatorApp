module.exports=function(e,a){if("string"!=typeof e)throw new TypeError("Expected a string");for(var s,r=String(e),c="",t=!!a&&!!a.extended,f=!!a&&!!a.globstar,i=!1,n=a&&"string"==typeof a.flags?a.flags:"",o=0,g=r.length;o<g;o++)switch(s=r[o]){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":c+="\\"+s;break;case"?":if(t){c+=".";break}case"[":case"]":t&&(c+=s);break;case"{":if(t){i=!0,c+="(";break}case"}":if(t){i=!1,c+=")";break}case",":if(i){c+="|";break}c+="\\"+s;break;case"*":for(var b=r[o-1],d=1;"*"===r[o+1];)d++,o++;var k=r[o+1];if(f)d>1&&("/"===b||void 0===b)&&("/"===k||void 0===k)?(c+="((?:[^/]*(?:/|$))*)",o++):c+="([^/]*)";else c+="(.*?)";break;default:c+=s}return n&&~n.indexOf("g")||(c="^"+c+"$"),new RegExp(c,n)};