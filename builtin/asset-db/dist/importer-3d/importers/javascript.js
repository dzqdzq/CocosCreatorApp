"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const asset_db_1=require("@editor/asset-db"),fs_extra_1=require("fs-extra"),script_compiler_1=require("./utils/script-compiler"),utils_1=require("../utils");class JavascriptImporter extends asset_db_1.Importer{constructor(r){super(r)}get version(){return"4.0.21"}get name(){return"javascript"}get assetType(){return"cc.Script"}async import(r){if(!(r instanceof asset_db_1.Asset))return console.error("Expect non-virtual asset"),!1;const e=r.userData;try{return!e.isPlugin||await this._importPluginScript(r)}catch(e){return console.error(utils_1.i18nTranslate("asset-db.importers.javascript.transform_failure",{path:r.source,reason:e}),utils_1.linkToAssetTarget(r.uuid)),!1}}async _importPluginScript(r){let e=await fs_extra_1.readFile(r.source,"utf-8");const{experimentalHideCommonJs:t,experimentalHideAmd:s,simulateGlobals:i}=r.userData,a=i?Array.isArray(i)?i:["self","window","global","globalThis"]:[],o=await script_compiler_1.transformPluginScript(e,{simulateGlobals:a,hideCommonJs:null===t||void 0===t||t,hideAmd:null===s||void 0===s||s});return await r.saveToLibrary(".js",o.code),r.meta.userData.importAsPlugin=!0,!0}}exports.default=JavascriptImporter;