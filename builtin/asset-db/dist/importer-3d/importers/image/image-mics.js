"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertHDR=exports.convertTGA=void 0;const path_1=require("path"),child_process_1=require("child_process"),pngjs_1=require("pngjs"),tga_js_1=__importDefault(require("tga-js")),fs_extra_1=require("fs-extra");function convertTGA(t){return new Promise((e,o)=>{const r=new tga_js_1.default;r.load(t);const n=r.getImageData(),s=new pngjs_1.PNG({width:n.width,height:n.height});s.data=Buffer.from(n.data);const p=[];s.on("data",t=>{p.push(t)}),s.on("end",()=>{e({extName:".png",data:Buffer.concat(p)})}),s.on("error",t=>{o(t)}),s.pack()})}function convertHDR(t,e,o){const r=path_1.join(o,e);let n;return fs_extra_1.ensureDirSync(o),n="darwin"===process.platform?child_process_1.spawn(path_1.join(Editor.App.path,"../tools/cmft/cmftRelease64"),["--bypassoutputtype","--output0params","png,rgbm,latlong","--input",t,"--output0",r]):child_process_1.spawn(path_1.join(Editor.App.path,"../tools/cmft/cmftRelease64.exe"),["--bypassoutputtype","--output0params","png,rgbm,latlong","--input",t,"--output0",r]),new Promise((t,e)=>{n.on("close",()=>{t({extName:".png",source:r+".png"})})})}exports.convertTGA=convertTGA,exports.convertHDR=convertHDR;