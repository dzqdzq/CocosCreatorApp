"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;const vueTemplate='\n<div class="assetDB">\n    <div class="default-meta">\n        <ui-icon value="setting" type=\'local\' class="setting"></ui-icon>\n        <ui-label value="i18n:asset-db.preferences.defaultMeta"></ui-label>\n        <ui-icon value="help" tooltip="i18n:asset-db.preferences.defaultMetaTip"></ui-icon>\n        <template v-for="(asset, assetKey) in importAssetTypes">\n            <ui-prop type="ui"\n                v-for="(attr, attrKey) in asset"\n                :key="attrKey"\n                :label="attr.label"\n                :render="getRenderText(attr.render)"\n                :tooltip="attr.description"\n                @confirm="defaultMetaConfirm($event, assetKey, attrKey)"\n            ></ui-prop>\n        </template>\n    </div>\n</div>\n',PreferencesVM=Vue.extend({name:"PreferencesVM",data:()=>({importAssetTypes:{image:{type:{label:Editor.I18n.t("asset-db.preferences.defaultImageMeta"),render:{ui:"ui-select",items:[{label:"raw",value:"raw"},{label:"texture",value:"texture"},{label:"normal map",value:"normal map"},{label:"sprite-frame",value:"sprite-frame"},{label:"texture cube",value:"texture cube"}],attributes:{value:"texture"}}}}},defaultMeta:{}}),mounted(){this.initDefaultMeta()},methods:{getRenderText:e=>(e.attributes=e.attributes||{},JSON.stringify(e)),initDefaultMeta(){const e=this;try{const t=(0,path_1.join)(Editor.Project.path,".creator","default-meta.json");if((0,fs_extra_1.existsSync)(t)){const a=(0,fs_extra_1.readJSONSync)(t);for(const t in a){e.defaultMeta[t]={};for(const s in a[t])e.importAssetTypes[t]&&e.importAssetTypes[t][s]&&e.$set(e.importAssetTypes[t][s].render.attributes,"value",a[t][s]),e.$set(e.defaultMeta[t],s,a[t][s])}}}catch(e){console.error(e)}},defaultMetaConfirm(e,t,a){const s=this,r=(0,path_1.join)(Editor.Project.path,".creator","default-meta.json");if((0,fs_extra_1.existsSync)(r)){let n=(0,fs_extra_1.readJSONSync)(r);s.defaultMeta[t]=s.defaultMeta[t]||{},e.target&&s.$set(s.defaultMeta[t],a,e.target.value),n=Object.assign({},n,s.defaultMeta),(0,fs_extra_1.outputJSONSync)(r,n,{spaces:2})}else s.defaultMeta[t]={},e.target&&s.$set(s.defaultMeta[t],a,e.target.value),(0,fs_extra_1.outputJSONSync)(r,s.defaultMeta,{spaces:2});Editor.Message.send("asset-db","refresh-default-user-data-config"),Editor.Task.addNotice({title:"Asset-DB",message:"User data has been updated.",timeout:5e3})}},template:vueTemplate});function ready(){panel=this,null===vm||void 0===vm||vm.$destroy(),(vm=new PreferencesVM).$mount(panel.$.container)}function close(){null===vm||void 0===vm||vm.$destroy(),vm=null,panel=null}exports.style="\nui-prop { --left-width: 40%; }\nui-prop > ui-label { padding-left: 2em; }\nui-icon { cursor: pointer; }\n.setting[type='local'] { color: var(--color-warn-fill); padding-right: 2px; }\n",exports.template='\n<div class="container"></div>\n',exports.$={container:".container"},exports.ready=ready,exports.close=close;