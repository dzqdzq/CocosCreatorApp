"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const ipc_1=require("../ipc"),scripting_1=require("./scripting"),asset_db_manager_1=require("../asset-db-manager"),plugin_1=__importDefault(require("../plugin"));(0,ipc_1.ipcAddListener)("asset-worker:init",async(e,a)=>{try{Editor.Metrics.trackTimeStart("asset-db:worker-init"),await asset_db_manager_1.assetDBManager.init(a),plugin_1.default.init(),Editor.Metrics.trackTimeEnd("asset-db:worker-init",{output:!0}),e.reply(null)}catch(a){console.error("Init asset worker failed!"),console.error(a),e.reply(a)}}),(0,ipc_1.ipcAddListener)("asset-worker:init-script",async e=>{try{Editor.Metrics.trackTimeStart("asset-db:worker-init-script"),await(0,scripting_1.initializeAssetDBScriptingEnvironment)(),Editor.Metrics.trackTimeEnd("asset-db:worker-init-script",{output:!0}),e.reply(null)}catch(a){console.error("init script env failed!"),console.error(a),e.reply(a)}}),(0,ipc_1.ipcAddListener)("asset-worker:startup-database",async(e,a,r)=>{if(asset_db_manager_1.assetDBManager.hasDB(a.name))e.reply(null);else{try{const s=asset_db_manager_1.assetDBManager.createDB(a);await plugin_1.default.registerImporterList(s),await asset_db_manager_1.assetDBManager.startDB(a.name,r)}catch(r){return console.error(`Start database ${a.name} failed!`,a),console.error(r),void e.reply(r,!1)}e.reply(null,!0)}}),(0,ipc_1.ipcAddListener)("asset-worker:effect-data-processing",async e=>{await(0,asset_db_manager_1.effectDataProcessing)(),e.reply(null)}),(0,ipc_1.ipcAddListener)("asset-worker:startup-await-database",async e=>{await asset_db_manager_1.assetDBManager.startup(),e.reply(null)}),(0,ipc_1.ipcAddListener)("asset-worker:shutdown-database",async(e,a)=>{await asset_db_manager_1.assetDBManager.removeDB(a),e.reply(null)}),(0,ipc_1.ipcAddListener)("asset-worker:database-ready",e=>{console.debug("Asset DB is ready!"),e.reply(null)}),(0,ipc_1.ipcAddListener)("asset-worker:query-database-busy",e=>{e.reply(null,asset_db_manager_1.assetDBManager.isBusy())}),(0,ipc_1.ipcAddListener)("asset-worker:pause-database",async(e,a)=>{e.reply(null,await asset_db_manager_1.assetDBManager.pause(a))}),(0,ipc_1.ipcAddListener)("asset-worker:resume-database",async e=>{await asset_db_manager_1.assetDBManager.resume(),e.reply(null,!0)}),(0,ipc_1.ipcAddListener)("asset-worker:refresh-all-database",async e=>{await asset_db_manager_1.assetDBManager.refresh(),e.reply(null,!0)});