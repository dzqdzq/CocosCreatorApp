"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const asset_db_1=require("@editor/asset-db"),path_1=require("path");class ImageImporter extends asset_db_1.Importer{get version(){return"1.0.1"}get name(){return"texture"}async validate(e){return!0}async import(e){let t=!1;const r=path_1.extname(e.source);if(await e.existsInLibrary(r)||(e.userData.type="sprite",e.userData.wrapMode="clamp",e.userData.filterMode="bilinear",await e.copyToLibrary(r,e.source),t=!0),!await e.existsInLibrary(".json")){const r=this.createTexture(e);await e.saveToLibrary(".json",JSON.stringify({__type__:"cc.Texture2D",content:this.serialize(r)},null,2)),t=!0}if(!e.meta.subMetas["sprite-frame"]||"sprite-frame"!==e.meta.subMetas["sprite-frame"].importer){const r=await e.createSubAsset("sprite-frame","sprite-frame");r&&(r.userData.textureUuid=e.uuid,await e.save(),t=!0)}return t}createTexture(e){const t=new cc.Texture2D,r=cc.Texture2D.WrapMode,a=cc.Texture2D.Filter;switch(e.userData.wrapMode){case"clamp":t.setWrapMode(r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE);break;case"repeat":t.setWrapMode(r.REPEAT,r.REPEAT)}switch(e.userData.filterMode){case"point":t.setFilters(a.NEAREST,a.NEAREST);break;case"bilinear":case"trilinear":t.setFilters(a.LINEAR,a.LINEAR)}return t}serialize(e){let t="";if(e._native){const r=cc.path.extname(e._native);r&&(t=cc.Texture2D.extnames.indexOf(r))<0&&(t=r)}return(t||0)+","+e._minFilter+","+e._magFilter+","+e._wrapS+","+e._wrapT}}exports.default=ImageImporter;