"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const asset_db_1=require("@editor/asset-db"),fntParser=require("../../../static/utils/fnt-parser");function createFntConfigString(t,e,i,a,r){const s=i.charCodeAt(0);let n=`\n        info face="Arial" size=${r}         bold=0 italic=0 charset="" unicode=0         stretchH=100 smooth=1 aa=1 padding=0,0,0,0 spaceing=0,0\n        common lineHeight=${e.height} base=${r}         scaleW=${t.width} scaleH=${t.height} pages=1 packed=0\n        page id=0 file="${a}"\n\n        chars count=0\n\n    `,h=0;for(let i=e.height;i<=t.height;i+=e.height)for(let a=0;a<t.width&&a+e.width<=t.width;a+=e.width){const t=s+h,r=a,o=i-e.height,d=String.fromCharCode(t);n+=`\n            char id=${t} x=${r} y=${o} width=${e.width}             height=${e.height} xoffset=0 yoffset=0 xadvance=${e.width}             page=0 chnl=0 letter="${d}"\n        `,++h}return n}class LabelAtlasImporter extends asset_db_1.Importer{get version(){return"1.0.0"}get name(){return"label-atlas"}async validate(t){return!0}async import(t){let e=!1;if(!await t.existsInLibrary(".json")){const i=t.userData;i.itemWidth=i.itemWidth||0,i.itemHeight=i.itemHeight||0,i.startChar=i.startChar||"",i.rawTextureUuid=i.rawTextureUuid||"",i.fontSize=i.fontSize||0;const a=this.createAtlas(t);await t.saveToLibrary(".json",EditorExtends.serialize(a)),e=!0}return e}createAtlas(t){const e=new cc.LabelAtlas;if(e.name=t.basename,!this.assetDB)return e;const i=t.userData.rawTextureUuid+"@sprite-frame",a=this.assetDB.getAsset(i);if(!a)return e;e.spriteFrame=EditorExtends.serialize.asAsset(i);const r=t.userData;if(e.fontSize=r.fontSize=.88*r.itemHeight,r.itemWidth>0&&r.itemHeight>0&&r.itemWidth<=a.userData.rawWidth&&r.itemHeight<=a.userData.rawHeight){const t=createFntConfigString({width:a.userData.rawWidth,height:a.userData.rawHeight},{width:r.itemWidth,height:r.itemHeight},r.startChar,r.textureName,r.fontSize);r._fntConfig=fntParser.parseFnt(t)}return e}}exports.default=LabelAtlasImporter;