"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const asset_db_1=require("@editor/asset-db"),cc_1=require("cc"),fntParser=require("../../../static/utils/fnt-parser");function createFntConfigString(t,e,i,r,a){const s=i.charCodeAt(0);let n=`\n        info face="Arial" size=${a}         bold=0 italic=0 charset="" unicode=0         stretchH=100 smooth=1 aa=1 padding=0,0,0,0 spaceing=0,0\n        common lineHeight=${e.height} base=${a}         scaleW=${t.width} scaleH=${t.height} pages=1 packed=0\n        page id=0 file="${r}"\n\n        chars count=0\n\n    `,h=0;for(let i=e.height;i<=t.height;i+=e.height)for(let r=0;r<t.width&&r+e.width<=t.width;r+=e.width){const t=s+h,a=r,o=i-e.height,c=String.fromCharCode(t);n+=`\n            char id=${t} x=${a} y=${o} width=${e.width}             height=${e.height} xoffset=0 yoffset=0 xadvance=${e.width}             page=0 chnl=0 letter="${c}"\n        `,++h}return n}class LabelAtlasImporter extends asset_db_1.Importer{get version(){return"1.0.0"}get name(){return"label-atlas"}async validate(t){return!0}async import(t){let e=!1;if(!await t.existsInLibrary(".json")){const i=t.userData;i.itemWidth=i.itemWidth||0,i.itemHeight=i.itemHeight||0,i.startChar=i.startChar||"",i.rawTextureUuid=i.rawTextureUuid||"",i.fontSize=i.fontSize||0;const r=this.createAtlas(t);await t.saveToLibrary(".json",EditorExtends.serialize(r)),e=!0}return e}createAtlas(t){const e=new cc.LabelAtlas;if(e.name=t.basename,!this.assetDB)return e;const i=t.userData.rawTextureUuid+"@sprite-frame",r=this.assetDB.getAsset(i);if(!r)return e;e.spriteFrame=EditorExtends.serialize.asAsset(i,cc_1.SpriteFrame);const a=t.userData;if(e.fontSize=a.fontSize=.88*a.itemHeight,a.itemWidth>0&&a.itemHeight>0&&a.itemWidth<=r.userData.rawWidth&&a.itemHeight<=r.userData.rawHeight){const t=createFntConfigString({width:r.userData.rawWidth,height:r.userData.rawHeight},{width:a.itemWidth,height:a.itemHeight},a.startChar,a.textureName,a.fontSize);a._fntConfig=fntParser.parseFnt(t)}return e}}exports.default=LabelAtlasImporter;