"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=exports.contributions=void 0;const opener_1=require("./opener"),tasks_1=require("./worker/tasks"),operation_1=require("./operation"),index_1=require("./worker/index"),worker=require("@base/electron-worker"),Profile=require("@base/electron-profile"),_profile=Profile.load("local://editor/packages.json"),_profileDefault=Profile.load("defaultPreferences://editor/packages.json");exports.contributions={register(e,a){_profile.get(`disable-packages.${e.path}`)||_profileDefault.get(`disable-packages.${e.path}`)||(0,tasks_1.register)(e.name,e.path,a,"register")},enable(e,a){(0,tasks_1.register)(e.name,e.path,a,"enable")},disable(e,a){(0,tasks_1.unregister)(e.name)}};let noticeDate=0;async function load(){Editor.Task.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading")),(0,index_1.init)()}async function unload(){worker.close("Assets"),Editor.Message.broadcast("asset-db:close")}exports.methods={noticeReloadEditor(){const e=Date.now();e-noticeDate<3e4||(noticeDate=e,Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.ignore_changed"),message:Editor.I18n.t("asset-db.preferences.notice_reload_editor"),source:Editor.I18n.t("asset-db.title"),type:"warn"}))},updateConfig(e,a){switch(e){case"autoScan":(0,tasks_1.setAutoRefresh)(!!a),a||Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.auto_scan"),message:Editor.I18n.t("asset-db.preferences.auto_scan_info"),source:Editor.I18n.t("asset-db.title"),type:"log"})}},refreshAllDatabase(){(0,tasks_1.refreshAllDatabase)()},refreshDefaultUserDataConfig:()=>(0,index_1.forwarding)("asset-worker:refresh-default-user-data")||null,ready(){Editor.Task.removeSyncTask("import-asset")},close(){Editor.Task.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading"))},createAsset:async(e,a,s)=>await(0,operation_1.createAsset)(e,a,s),importAsset:async(e,a,s)=>await(0,operation_1.importAsset)(e,a,s),copyAsset:async(e,a,s)=>await(0,operation_1.copyAsset)(e,a,s),moveAsset:async(e,a,s)=>await(0,operation_1.moveAsset)(e,a,s),deleteAsset:async e=>await(0,operation_1.deleteAsset)(e),async openAsset(e){await(0,opener_1.openAsset)(e)},saveAsset:async(e,a)=>await(0,operation_1.saveAsset)(e,a),saveAssetMeta:async(e,a)=>await(0,operation_1.saveAssetMeta)(e,a),reimportAsset:async e=>await(0,operation_1.reimportAsset)(e),async refreshAsset(e){const a=await(0,operation_1.refreshAsset)(e);return await new Promise(e=>{setTimeout(e,500)}),a},refreshAllEffect:async()=>(0,operation_1.refreshAllEffect)(),queryPath:async e=>await(0,index_1.forwarding)("asset-worker:query-path",e)||null,queryUrl:async e=>await(0,index_1.forwarding)("asset-worker:query-url",e)||null,queryUUID:async e=>await(0,index_1.forwarding)("asset-worker:query-uuid",e),queryAssets:async e=>await(0,index_1.forwarding)("asset-worker:query-assets",e),queryAssetInfo:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-info",e),queryAssetMeta:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-meta",e),queryAssetMtime:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-mtime",e),queryAssetDependencies:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-dependencies",e),queryAssetUsed:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-used",e),queryAssetData:async e=>await(0,index_1.forwarding)("asset-worker:query-asset-data",e),isBusy:async()=>await(0,index_1.forwarding)("asset-worker:query-database-busy"),pause:async e=>await(0,index_1.forwarding)("asset-worker:pause-database",e),resume:async()=>await(0,index_1.forwarding)("asset-worker:resume-database"),generateAvailableUrl:async e=>await(0,operation_1.generateAvailableURL)(e),"query-db-info":async e=>await(0,index_1.forwarding)("asset-worker:query-db-info",e),"query-db-list":async()=>await(0,index_1.forwarding)("asset-worker:query-db-list"),refresh(){(0,index_1.reload)()},"open-devtools"(){(0,index_1.debug)()},queryReady:async()=>(0,tasks_1.isReady)(),"create-asset-dialog":async(e,a)=>await(0,operation_1.createAssetDialog)(e,a),"init-asset":async(e,a)=>(0,operation_1.initAsset)(e,a),"query-all-importer":async()=>await(0,operation_1.queryAllImporter)(),"query-all-asset-types":async()=>await(0,operation_1.queryAllAssetTypes)(),executeScript:async e=>await(0,index_1.forwarding)("asset-worker:execute-script",e),projectChangeHighQuality:async e=>await(0,index_1.forwarding)("asset-worker:change-high-quality",e)},exports.load=load,exports.unload=unload;