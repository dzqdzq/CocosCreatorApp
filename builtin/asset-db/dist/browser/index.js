"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=exports.contributions=void 0;const opener_1=require("./opener"),tasks_1=require("./worker/tasks"),operation_1=require("./operation"),index_1=require("./worker/index"),worker=require("@base/electron-worker");exports.contributions={register(e,s){tasks_1.register(e.name,e.path,s)},unregister(e,s){tasks_1.unregister(e.name)}};let noticeDate=0;async function load(){Editor.Task.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading")),index_1.init()}async function unload(){worker.close("asset-db"),Editor.Message.broadcast("asset-db:close")}exports.methods={noticeReloadEditor(){const e=Date.now();e-noticeDate<3e4||(noticeDate=e,Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.ignore_changed"),message:Editor.I18n.t("asset-db.preferences.notice_reload_editor"),source:Editor.I18n.t("asset-db.title"),type:"warn"}))},updateConfig(e,s){switch(e){case"autoScan":tasks_1.setAutoRefresh(!!s),Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.auto_scan"),message:Editor.I18n.t("asset-db.preferences.auto_scan_info"),source:Editor.I18n.t("asset-db.title"),type:"log"})}},refreshAllDatabase(){tasks_1.refreshAllDatabase()},refreshDefaultUserDataConfig:()=>index_1.forwarding("asset-worker:refresh-default-user-data")||null,ready(){Editor.Task.removeSyncTask("import-asset")},close(){Editor.Task.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading"))},createAsset:async(e,s,t)=>await operation_1.createAsset(e,s,t),importAsset:async(e,s,t)=>await operation_1.importAsset(e,s,t),copyAsset:async(e,s,t)=>await operation_1.copyAsset(e,s,t),moveAsset:async(e,s,t)=>await operation_1.moveAsset(e,s,t),deleteAsset:async e=>await operation_1.deleteAsset(e),async openAsset(e){await opener_1.openAsset(e)},saveAsset:async(e,s)=>await operation_1.saveAsset(e,s),saveAssetMeta:async(e,s)=>await operation_1.saveAssetMeta(e,s),reimportAsset:async e=>await operation_1.reimportAsset(e),async refreshAsset(e){const s=await operation_1.refreshAsset(e);return await new Promise(e=>{setTimeout(e,500)}),s},queryPath:async e=>await index_1.forwarding("asset-worker:query-path",e)||null,queryUrl:async e=>await index_1.forwarding("asset-worker:query-url",e)||null,queryUUID:async e=>await index_1.forwarding("asset-worker:query-uuid",e),queryAssets:async e=>await index_1.forwarding("asset-worker:query-assets",e),queryAssetInfo:async e=>await index_1.forwarding("asset-worker:query-asset-info",e),queryAssetMeta:async e=>await index_1.forwarding("asset-worker:query-asset-meta",e),queryAssetMtime:async e=>await index_1.forwarding("asset-worker:query-asset-mtime",e),generateAvailableUrl:async e=>await operation_1.generateAvailableURL(e),"query-db-info":async e=>await index_1.forwarding("asset-worker:query-db-info",e),"query-db-list":async()=>await index_1.forwarding("asset-worker:query-db-list"),refresh(){index_1.reload()},"open-devtools"(){index_1.debug()},queryReady:async()=>tasks_1.isReady(),"create-asset-dialog":async(e,s)=>await operation_1.createAssetDialog(e,s),"init-asset":async(e,s)=>operation_1.initAsset(e,s),"query-all-importer":async()=>await operation_1.queryAllImporter(),"query-all-asset-types":async()=>await operation_1.queryAllAssetTypes(),executeScript:async e=>await index_1.forwarding("asset-worker:execute-script",e)},exports.load=load,exports.unload=unload;