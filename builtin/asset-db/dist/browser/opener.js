"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.openAsset=void 0;const child_process_1=require("child_process"),electron_1=require("electron"),fs_extra_1=require("fs-extra"),path_1=require("path"),index_1=require("./worker/index"),parse=require("plist").parse;function openAssetWithProgram(e,t,s){s=s||[];let o="";if("darwin"===process.platform){if(t.endsWith(".app")){t=path_1.join(t,"/Contents/MacOS/");const e=parse(fs_extra_1.readFileSync(path_1.join(t,"../Info.plist"),"utf8"));t=path_1.join(t,e.CFBundleExecutable)}o="open",s?(s.splice(0,0,t),s.splice(0,0,"-a")):s=["-a",t,e]}else o=t,s||(s=[e]);child_process_1.spawn(o,s,{detached:!0,stdio:"ignore"}).unref()}const map={"*"(e){electron_1.shell.openPath(e.file)},scene(e){Editor.Message.send("scene","open-scene",e.uuid)},terrain(e){},prefab(e){Editor.Message.send("scene","open-scene",e.uuid)},javascript(e){openCodeAsset(e)},typescript(e){openCodeAsset(e)},effect(e){openCodeAsset(e)},image(e){openImageAsset(e)}};async function getCodeEditor(){let e="";e="darwin"===process.platform?"/Applications/Visual Studio Code.app":"C:\\Program Files (x86)\\Microsoft VS Code\\Code.exe";const t=await Editor.Profile.getConfig("program","script_editor");return t&&(e=t),e}async function openCodeAsset(e){const t=await getCodeEditor();fs_extra_1.existsSync(t)?openAssetWithProgram(e.file,t,[Editor.Project.path,e.file]):map["*"](e)}async function openImageAsset(e){let t="";const s=await Editor.Profile.getConfig("program","picture_editor");s&&(t=s),fs_extra_1.existsSync(t)?openAssetWithProgram(e.file,t,[Editor.Project.path,e.file]):map["*"](e)}async function openAsset(e){let t;if(!(t=e.startsWith("db://")?await index_1.forwarding("asset-worker:query-uuid",e):e))throw new Error(`The resource does not exist and cannot be opened.\n  urlOrUUID: ${e}`);const s=await index_1.forwarding("asset-worker:query-asset-info",t),o=map[s.importer]||map["*"];await o(s)}exports.openAsset=openAsset;