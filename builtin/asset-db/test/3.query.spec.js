"use struct";const{expect:expect}=require("chai"),{join:join}=require("path"),{existsSync:existsSync}=require("fs-extra"),invalidParams=[{name:"undefined",value:void 0},{name:"null",value:null},{name:"number - 0",value:0},{name:"number - 2",value:2},{name:"string - empty",value:""},{name:"string - str",value:"str"},{name:"boolean - true",value:!0},{name:"boolean- false",value:!1},{name:"array",value:[]},{name:"object",value:{}}];describe("测试 db 的查询接口",async function(){const e=`__${Date.now()}__.test`;let s="";before(async function(){const t=await Editor.Message.request("asset-db","create-asset",`db://assets/${e}`);s=t.uuid}),after(async function(){await Editor.Message.request("asset-db","delete-asset",`db://assets/${e}`)}),describe("query-db-info",async function(){const e=["alwaysStat","binaryInterval","followSymlinks","ignoreFiles","ignoreRegular","interval","level","library","name","readonly","target","temp","usePolling","visible"];it("查询 assets 数据库",async function(){const s=await Editor.Message.request("asset-db","query-db-info","db://assets");expect(s).not.null,expect(s).to.have.all.keys(e)}),it("查询 internal 数据库",async function(){const s=await Editor.Message.request("asset-db","query-db-info","db://internal");expect(s).not.null,expect(s).to.have.all.keys(e)}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-db-info","db://不存在");expect(e).is.null}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-db-info",e.value);expect(s).is.null})})}),describe("query-path",async function(){it("查询 assets 数据库",async function(){const e=await Editor.Message.request("asset-db","query-path","db://assets");expect(e).not.null;const s=existsSync(e);expect(s).is.equal(!0)}),it("查询 internal 数据库",async function(){const e=await Editor.Message.request("asset-db","query-path","db://internal");expect(e).not.null;const s=existsSync(e);expect(s).is.equal(!0)}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-path","db://不存在");expect(e).is.null}),it("查询 assets 数据库里测试生成的临时资源",async function(){const s=await Editor.Message.request("asset-db","query-path",`db://assets/${e}`);expect(s).not.null;const t=existsSync(s);expect(t).is.equal(!0)}),it("查询 assets 数据库里不存在的资源",async function(){const s=await Editor.Message.request("asset-db","query-path",`db://assets/${e}.xxx`);expect(s).not.null;const t=existsSync(s);expect(t).is.equal(!1)}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-db-info",e.value);expect(s).is.null})})}),describe("query-url",async function(){const s=join(Editor.Project.path,"assets");it("查询 assets 数据库",async function(){const e=await Editor.Message.request("asset-db","query-url",s);expect(e).is.equal("db://assets")}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-url",__dirname);expect(e).is.null}),it("查询 assets 数据库里测试生成的临时资源",async function(){const t=await Editor.Message.request("asset-db","query-url",join(s,e));expect(t).is.equal(`db://assets/${e}`)}),it("查询 assets 数据库里不存在的资源",async function(){const t=await Editor.Message.request("asset-db","query-url",join(s,e+".xxx"));expect(t).is.equal(`db://assets/${e}.xxx`)}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-db-info",e.value);expect(s).is.null})})}),describe("query-uuid",async function(){it("查询 assets 数据库",async function(){const e=await Editor.Message.request("asset-db","query-uuid","db://assets");expect(e).is.equal("db://assets")}),it("查询 internal 数据库",async function(){const e=await Editor.Message.request("asset-db","query-uuid","db://internal");expect(e).is.equal("db://internal")}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-uuid","db://不存在");expect(e).is.equal("")}),it("查询 assets 数据库里测试生成的临时资源",async function(){const t=await Editor.Message.request("asset-db","query-uuid",`db://assets/${e}`);expect(t).is.equal(s)}),it("查询 assets 数据库里不存在的资源",async function(){const s=await Editor.Message.request("asset-db","query-uuid",`db://assets/${e}.xxx`);expect(s).is.equal("")}),it("查询 assets 数据库里不存在的资源",async function(){const s=await Editor.Message.request("asset-db","query-uuid",`db://assets/${e}.xxx`);expect(s).is.equal("")}),it("查询 assets 数据库里不存在的资源2",async function(){const e=await Editor.Message.request("asset-db","query-uuid","db://internal/default_file_content/abc.xxx");expect(e).is.equal("")}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-db-info",e.value);expect(s).is.null})})}),describe("query-asset-info",async function(){const t=Object.keys({displayName:"string",file:"string",imported:"boolean",importer:"string",invalid:"boolean",isDirectory:"boolean",library:"object",name:"string",path:"string",readonly:"boolean",source:"string",subAssets:"object",type:"string",url:"string",uuid:"string",visible:"boolean"});it("查询 assets 数据库",async function(){const e=await Editor.Message.request("asset-db","query-asset-info","db://assets");expect(e).to.have.all.keys(t)}),it("查询 internal 数据库",async function(){const e=await Editor.Message.request("asset-db","query-asset-info","db://internal");expect(e).to.have.all.keys(t)}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-asset-info","db://不存在");expect(e).is.null}),it("查询 assets 数据库里测试生成的临时资源",async function(){const e=await Editor.Message.request("asset-db","query-asset-info",s);expect(e).not.null,expect(e).to.have.all.keys(t)}),it("查询 assets 数据库里测试生成的临时资源",async function(){const s=await Editor.Message.request("asset-db","query-asset-info",`db://assets/${e}`);expect(s).not.null,expect(s).to.have.all.keys(t)}),it("查询 assets 数据库里不存在的资源",async function(){const e=await Editor.Message.request("asset-db","query-asset-info",s+"@xxx");expect(e).is.null}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-db-info",e.value);expect(s).is.null})})}),describe("query-asset-meta",async function(){const e=Object.keys({ver:"string",importer:"string",imported:"boolean",uuid:"string",files:"array",subMetas:"object",userData:"object"});it("查询 assets 数据库",async function(){const s=await Editor.Message.request("asset-db","query-asset-meta","db://assets");expect(s).to.have.all.keys(e)}),it("查询 internal 数据库",async function(){const s=await Editor.Message.request("asset-db","query-asset-meta","db://internal");expect(s).to.have.all.keys(e)}),it("查询不存在的数据库",async function(){const e=await Editor.Message.request("asset-db","query-asset-meta","db://不存在");expect(e).is.null}),it("查询 assets 数据库里测试生成的临时资源",async function(){const t=await Editor.Message.request("asset-db","query-asset-meta",s);expect(t).not.null,expect(t).to.have.all.keys(e)}),it("查询 assets 数据库里不存在的资源",async function(){const e=await Editor.Message.request("asset-db","query-asset-meta",s+"@xxx");expect(e).is.null}),invalidParams.forEach(e=>{it(`传入参数错误 - ${e.name}`,async function(){const s=await Editor.Message.request("asset-db","query-asset-meta",e.value);expect(s).is.null})})}),describe("query-assets",async function(){const e=await Editor.Message.request("asset-db","query-assets"),s=await Editor.Message.request("asset-db","query-assets",{pattern:"db://assets"}),t=await Editor.Message.request("asset-db","query-assets",{pattern:"db://internal"});it("查询所有资源",async function(){expect(e).not.null,expect(e.length).not.equal(0)}),it("查询 assets 数据库内的资源",async function(){expect(s).not.null,expect(s.length).not.equal(0),expect(s.length).not.equal(e.length)}),it("查询 internal 数据库内的资源",async function(){expect(t).not.null,expect(t.length).not.equal(e.length)}),invalidParams.forEach(s=>{it(`传入参数错误 - ${s.name}`,async function(){const t=await Editor.Message.request("asset-db","query-assets",s.value);expect(t.length).is.equal(e.length)})})})});