"use strict";const{expect:expect}=require("chai"),{join:join}=require("path");describe("测试 DB 中 Database 的 IPC 接口：",()=>{describe("------ 数据库",()=>{describe("refresh, query-ready ：刷新数据库",()=>{let e=!1;it("当前数据库已经准备就绪",async()=>{const t=await Editor.Message.request("asset-db","query-ready");e=!t,expect(t).to.be.true}),it("刷新数据库",async function(){if(this.timeout(2e4),e)throw new Error("数据库没有就绪，无法进行刷新测试");Editor.Message.request("asset-db","refresh");const t=await Editor.Message.request("asset-db","query-ready");return expect(t).to.be.false,new Promise((e,t)=>{return async function t(){return await Editor.Message.request("asset-db","query-ready")?e():await t()}()})})}),describe("query-db-info ：查询数据库信息",async()=>{it("传入错误的参数",async function(){const e=[{args:void 0,expect:null},{args:null,expect:null},{args:"",expect:null},{args:0,expect:null},{args:!1,expect:null},{args:!0,expect:null},{args:[],expect:null},{args:{},expect:null},{args:()=>{},expect:null},{args:"abc",expect:null},{args:123,expect:null}];for(const t of e){const e=await Editor.Message.request("asset-db","query-db-info",t.args);expect(e).to.equal(t.expect)}}),it("传入正确的参数",async()=>{const e=[{args:"assets",expect:{keys:["alwaysStat","binaryInterval","followSymlinks","ignoreFiles","ignoreRegular","interval","level","library","name","readonly","target","temp","usePolling","visible"],values:{alwaysStat:!0,binaryInterval:1e3,followSymlinks:!1,interval:500,library:join(Editor.Project.path,"library"),name:"assets",project:Editor.Project.path,readonly:!1,target:join(Editor.Project.path,"assets"),temp:join(Editor.Project.path,"temp/asset-db/assets"),usePolling:!1,visible:!0}}}];for(const t of e){const e=await Editor.Message.request("asset-db","query-db-info",t.args);expect(e).to.include.keys(t.expect.keys);for(const s of t.expect.keys)s in t.expect.values&&expect(e[s]).to.equal(t.expect.values[s])}})})})});