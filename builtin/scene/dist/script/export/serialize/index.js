"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.serializeSafe=serializeSafe,exports.serialize=serialize;const cc_1=require("cc"),DELIMETER=cc.Class.Attr.DELIMETER,debugInfo=[],nodeExcludeProps=["_parent","_children","_prefab","_components"],checkedObjectSet=new Set;function checkComponents(c,t=""){var a=c.components;if(Array.isArray(a))for(let e=a.length-1;0<=e;e--){var r=a[e];if(r){if(r.node!==c&&(r.node=c,debugInfo.push()),checkedObjectSet.has(r))return;checkedObjectSet.add(r),checkSerializableProperties(r,t+":"+r.name)}else a.splice(e,1)}else debugInfo.push(c.getPathInHierarchy()+"'s components is not array")}const baseTypeMap=new Map;function checkBaseType(e,c,t=""){if(cc.js.isChildClassOf(e.constructor,cc.ValueType)){var a=getDefaultMap(e.constructor);for(const r of c)typeof e[r]!=typeof a[r]&&debugInfo.push(`${t}|${r}'s value:${e[r]} is illegal,attr:`+a[r]);return!0}return!1}function getDefaultMap(e){let t=baseTypeMap.get(e);if(!t){t={},baseTypeMap.set(e,t);const a=e.__attrs__;e.__values__.forEach(e=>{var c=""+e+DELIMETER+"default";t[e]=a[c]})}return t}function checkSerializableProperties(e,a="",c){var t=e.constructor,c=c??t.__values__,r=getDefaultMap(t);for(const s of c){const i=e[s];var n=typeof i;if(i&&i.constructor&&i.constructor.__values__){if(checkedObjectSet.has(i))return;checkedObjectSet.add(i),checkSerializableProperties(i,a+"."+s)}else"object"==n?Object.keys(i).forEach(e=>{var c=i[e],t=c?c.constructor:void 0;t&&t.__values__&&(checkedObjectSet.has(c)||(checkedObjectSet.add(c),checkSerializableProperties(c,a+"."+e)))}):n!=typeof r[s]&&(debugInfo.push(`${a}.${s}'s value:${e[s]} is illegal,attr:`+r[s]),e[s]=r[s])}}function checkPrefabInfo(e){e=e._prefab;if(e){var c={},t=e.nestedPrefabInstanceRoots;if(t)for(let e=t.length-1;0<=e;e--){var a=t[e],r=a._prefab;r?.instance&&(c[r.instance.fileId]&&(debugInfo.push(a.getPathInHierarchy()+" prefabInstanceFileId is not unique"),r.instance.fileId=EditorExtends.UuidUtils.uuid()),c[r.instance.fileId]=!0)}}}function checkNode(c,t,e=""){var a=c.children;if(Array.isArray(a)){var r=e+"/"+c.name;if(!checkedObjectSet.has(c)){checkedObjectSet.add(c);for(let e=a.length-1;0<=e;e--){var n=a[e];!n||n.objFlags&cc_1.CCObject.Flags.HideInHierarchy?null==n&&a.splice(e,1):(n.parent!==c&&(debugInfo.push(r+`/${n.name} parent is illegal `+n.parent?.name),n.parent=c),checkNode(n,t,r))}}}else debugInfo.push(`${e}/${c.name} children is not an array`)}function checkScene(e){let c;e instanceof cc_1.SceneAsset?c=e.scene:e instanceof cc_1.Prefab&&(c=e.data),c&&(e=c.constructor.__values__.slice().filter(e=>!nodeExcludeProps.includes(e)),checkNode(c,e),checkPrefabInfo(c))}function serializeSafe(e,c){return cce.Utils.serialize(e,c)}function serialize(e,c){return cce.Utils.serialize(e,c)}