"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,u){void 0===u&&(u=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,u,n)}:function(e,t,r,u){void 0===u&&(u=r),e[u]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),utils_1=require("./utils"),asset_1=__importDefault(require("./asset")),dumpEncode=__importStar(require("./encode")),dumpDecode=__importStar(require("./decode")),{get:get,set:set}=require("lodash");class DumpUtil{dumpProperty(e,t){if(""===t)return this.dumpNode(e);const r=(0,utils_1.parsingPath)(t,e),u=((0,utils_1.parsingPath)(r.search,e),r.search?get(e,r.search):e),n=cc_1.CCClass.Attr.getClassAttrs(u.constructor);return dumpEncode.encodeObject(u,n)}dumpNode(e){return e?e instanceof cc_1.Scene?dumpEncode.encodeScene(e):dumpEncode.encodeNode(e):null}dumpComponent(e){return e?dumpEncode.encodeComponent(e):null}async restoreProperty(e,t,r){if(!/^__comps__\.\d+$/.test(t))return dumpDecode.decodePatch(t,r,e);if("object"==typeof r.value)for(const u in r.value)await dumpDecode.decodePatch(`${t}.${u}`,r.value[u],e)}resetProperty(e,t){return dumpDecode.resetProperty(e,t)}updatePropertyFromNull(e,t){return dumpDecode.updatePropertyFromNull(e,t)}async restoreNode(e,t){return t&&t.isScene?await dumpDecode.decodeScene(t,e):await dumpDecode.decodeNode(t,e)}parsingPath(e,t){return(0,utils_1.parsingPath)(e,t)}generatePath(e,t){}encodeObject(e,t,r=null,u,n){return dumpEncode.encodeObject(e,t,r,u,n)}getDefaultValue(e){if(!e)return null;let t=asset_1.default.getDefaultValue(e,null);if(!t){const r=cc_1.js.getClassByName(e);t=r?new r:null}return t}}exports.default=new DumpUtil;