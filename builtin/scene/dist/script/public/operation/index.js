"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OperationPriority=void 0;const cc_1=require("cc"),window_1=require("../../utils/window");let isBind=!1;const isWin32="win32"===process.platform;class ProportionalToScene extends cc.ResolutionPolicy.ContainerStrategy{apply(e,t){const i=e._frameSize.width,n=e._frameSize.height,s=cc.game.container.style,o=t.width,r=t.height,d=i/o,c=n/r;let a,l;d<c?(a=i,l=r*d):(a=o*c,l=n),a=i-2*Math.round((i-a)/2),l=n-2*Math.round((n-l)/2),this._setupContainer(e,a,l),s.margin="0"}}function bindEvent(e){if(!isBind){if(isBind=!0,isSceneNative){let t=(0,window_1.getMainWindowSize)();cc_1.view.on("canvas-resize",()=>{const i=(0,window_1.getMainWindowSize)();i.width===t.width&&i.height===t.height||(t=i,e.emit("resize",t))})}else cc_1.view.on("canvas-resize",()=>{e.emit("resize",{width:cc_1.game.canvas.width,height:cc_1.game.canvas.height})});if("function"==typeof window.matchMedia){const e=()=>{const t=window.devicePixelRatio;window.matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",()=>{window.dispatchEvent(new Event("resize")),e()},{once:!0})};e()}}}class Operation{constructor(){this._debug=!1,this._debugNode=null,this._events=new Map,bindEvent(this),window.addEventListener("load",()=>{bindEvent(this)})}requestPointerLock(){cce.Ipc.send("lock-pointer",!0)}exitPointerLock(){cce.Ipc.send("lock-pointer",!1)}changePointer(e){["-webkit-grab","-webkit-grabbing","zoom-in","zoom-out","n-resize","s-resize","e-resize","w-resize","ne-resize","ew-resize","nw-resize","ns-resize","se-resize","sw-resize","nesw-resize","nwse-resize","col-resize","row-resize","text","vertical-text","context-menu","copy","move","none","default","pointer","inherit","initial","alias","all-scroll","auto","cell","crosshair","no-drop","not-allowed","progress","unset","wait"].includes(e)||(e="default"),cce.Ipc.send("change-pointer",e)}get debug(){return this._debug}set debug(e){this._debug=e,this.updateDebugUI(e)}updateDebugUI(e){e?this._debugNode||(this._debugNode=document.createElement("div"),document.body.append(this._debugNode),this._debugNode.setAttribute("style","position: absolute; width: 5px; height: 5px;border-radius: 50%;background-color: red;")):this._debugNode&&(document.body.removeChild(this._debugNode),this._debugNode=null)}_emit(e,...t){const i=this._events.get(e);if(i)for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(...t);else{const{listener:e}=n;s=e(...t)}if(!1===s)return}}emit(e,...t){return this._emit(e,...t)}_emitMouseEvent(e,t){const i=this._events.get(e);if(!i)return;let n=isSceneNative?devicePixelRatio:cc.screen.devicePixelRatio;isSceneNative&&!isWin32&&(n=1),t.x*=n,t.y*=n,t.deltaX*=n,t.deltaY*=n,t.wheelDeltaX*=n,t.wheelDeltaY*=n,t.moveDeltaX*=n,t.moveDeltaY*=n,this._debug&&(this.updateDebugUI(this._debug),this._debugNode&&(this._debugNode.style.left=t.x/n-2+"px",this._debugNode.style.top=t.y/n-2+"px"));for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(t);else{const{listener:e}=n;s=e(t)}if(!1===s)return}}on(e,t,i){return this.addListener(e,t,i)}addListener(e,t,i){this._events.has(e)||this._events.set(e,[]);const n=this._events.get(e);if(i){let e=0;for(let t=0;t<n.length;t++){if(!n[t].priority){e=t;break}if(n[t].priority<i){e=t;break}e++}n.splice(e,0,{listener:t,priority:i})}else n.push(t);return this}removeListener(e,t){this._events.has(e)||this._events.set(e,[]);const i=this._events.get(e);for(let e=0;e<i.length;e++)i[e]===t&&i.splice(e--,1)}}var OperationPriority;exports.default=new Operation,function(e){e[e.Preview=999]="Preview",e[e.Gizmo=99]="Gizmo",e[e.Camera=98]="Camera"}(OperationPriority=exports.OperationPriority||(exports.OperationPriority={}));