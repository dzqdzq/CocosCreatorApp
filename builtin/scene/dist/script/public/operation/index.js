"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OperationPriority=void 0;const cc_1=require("cc"),index_1=__importDefault(require("../../3d/manager/ipc/index")),window_1=require("../../utils/window");let isBind=!1;const isWin32="win32"===process.platform;class ProportionalToScene extends cc.ResolutionPolicy.ContainerStrategy{apply(e,t){const i=e._frameSize.width,n=e._frameSize.height,s=cc.game.container.style,r=t.width,o=t.height,a=i/r,c=n/o;let l,d;a<c?(l=i,d=o*a):(l=r*c,d=n),l=i-2*Math.round((i-l)/2),d=n-2*Math.round((n-d)/2),this._setupContainer(e,l,d),s.margin="0"}}function bindEvent(e){if(!isBind){if(isBind=!0,isSceneNative){let t=(0,window_1.getMainWindowSize)();cc_1.view.on("canvas-resize",()=>{const i=(0,window_1.getMainWindowSize)();i.width===t.width&&i.height===t.height||(t=i,e.emit("resize",t))})}else cc_1.view.on("canvas-resize",()=>{e.emit("resize",{width:cc_1.game.canvas.width,height:cc_1.game.canvas.height})});if("function"==typeof window.matchMedia){const e=()=>{const t=window.devicePixelRatio;window.matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",()=>{window.dispatchEvent(new Event("resize")),e()},{once:!0})};e()}}}class Operation{constructor(){this._events=new Map,bindEvent(this),window.addEventListener("load",()=>{bindEvent(this)})}requestPointerLock(){index_1.default.send("lock-pointer",!0)}exitPointerLock(){index_1.default.send("lock-pointer",!1)}changePointer(e){["-webkit-grab","-webkit-grabbing","zoom-in","zoom-out","n-resize","s-resize","e-resize","w-resize","ne-resize","ew-resize","nw-resize","ns-resize","se-resize","sw-resize","nesw-resize","nwse-resize","col-resize","row-resize","text","vertical-text","context-menu","copy","move","none","default","pointer","inherit","initial","alias","all-scroll","auto","cell","crosshair","no-drop","not-allowed","progress","unset","wait"].includes(e)||(e="default"),index_1.default.send("change-pointer",e)}_emit(e,...t){const i=this._events.get(e);if(i)for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(...t);else{const{listener:e}=n;s=e(...t)}if(!1===s)return}}emit(e,...t){return this._emit(e,...t)}_emitMouseEvent(e,t){const i=this._events.get(e);if(!i)return;let n=isSceneNative?devicePixelRatio:cc.screen.devicePixelRatio;isSceneNative&&!isWin32&&(n=1),t.x*=n,t.y*=n,t.deltaX*=n,t.deltaY*=n,t.wheelDeltaX*=n,t.wheelDeltaY*=n,t.moveDeltaX*=n,t.moveDeltaY*=n;for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(t);else{const{listener:e}=n;s=e(t)}if(!1===s)return}}on(e,t,i){return this.addListener(e,t,i)}addListener(e,t,i){this._events.has(e)||this._events.set(e,[]);const n=this._events.get(e);if(i){let e=0;for(let t=0;t<n.length;t++){if(!n[t].priority){e=t;break}if(n[t].priority<i){e=t;break}e++}n.splice(e,0,{listener:t,priority:i})}else n.push(t);return this}removeListener(e,t){this._events.has(e)||this._events.set(e,[]);const i=this._events.get(e);for(let e=0;e<i.length;e++)i[e]===t&&i.splice(e--,1)}}var OperationPriority;exports.default=new Operation,function(e){e[e.Preview=999]="Preview",e[e.Gizmo=99]="Gizmo",e[e.Camera=98]="Camera"}(OperationPriority=exports.OperationPriority||(exports.OperationPriority={}));