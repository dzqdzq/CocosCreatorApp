"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const{EventEmitter:EventEmitter}=require("events"),webview_1=__importDefault(require("../ipc/webview"));let isBind=!1;class ProportionalToScene extends cc.ResolutionPolicy.ContainerStrategy{apply(e,t){const i=e._frameSize.width,n=e._frameSize.height,s=cc.game.container.style,r=t.width,o=t.height,a=i/r,l=n/o;let c,d;a<l?(c=i,d=o*a):(c=r*l,d=n),c=i-2*Math.round((i-c)/2),d=n-2*Math.round((n-d)/2),this._setupContainer(e,c,d),s.margin="0"}}function bindEvent(e){if(!isBind&&(isBind=!0,window.addEventListener("resize",()=>{"cc"in window&&e._emit("resize",{width:window.innerWidth,height:window.innerHeight})}),"function"==typeof window.matchMedia)){const e=()=>{const t=window.devicePixelRatio;window.matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",()=>{window.dispatchEvent(new Event("resize")),e()},{once:!0})};e()}}class Operation{constructor(){this._events=new Map,bindEvent(this),window.addEventListener("load",()=>{bindEvent(this)})}requestPointerLock(){webview_1.default.send("lock-pointer",!0)}exitPointerLock(){webview_1.default.send("lock-pointer",!1)}changePointer(e){["-webkit-grab","-webkit-grabbing","zoom-in","zoom-out","n-resize","s-resize","e-resize","w-resize","ne-resize","ew-resize","nw-resize","ns-resize","se-resize","sw-resize","nesw-resize","nwse-resize","col-resize","row-resize","text","vertical-text","context-menu","copy","move","none","default","pointer","inherit","initial","alias","all-scroll","auto","cell","crosshair","no-drop","not-allowed","progress","unset","wait"].includes(e)||(e="default"),webview_1.default.send("change-pointer",e)}_emit(e,...t){const i=this._events.get(e);if(i)for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(...t);else{const{listener:e}=n;s=e(...t)}if(!1===s)return}}_emitMouseEvent(e,t){const i=this._events.get(e);if(!i)return;const n=cc.screen.devicePixelRatio;t.x*=n,t.y*=n,t.deltaX*=n,t.deltaY*=n,t.wheelDeltaX*=n,t.wheelDeltaY*=n,t.moveDeltaX*=n,t.moveDeltaY*=n;for(let e=0;e<i.length;e++){const n=i[e];let s;if("function"==typeof n)s=n(t);else{const{listener:e}=n;s=e(t)}if(!1===s)return}}on(e,t,i){return this.addListener(e,t,i)}addListener(e,t,i){this._events.has(e)||this._events.set(e,[]);const n=this._events.get(e);if(i){let e=0,s=!1;for(let t=0;t<n.length&&!s;t++){if(!n[t].priority){e=t,s=!0;break}if(n[t].priority<i){e=t,s=!0;break}e++}n.splice(e,0,{listener:t,priority:i})}else n.push(t);return this}}exports.default=new Operation;