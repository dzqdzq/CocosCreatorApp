"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OperationPriority=void 0;const index_1=__importDefault(require("../../3d/manager/ipc/index"));let isBind=!1;const isWin32="win32"===process.platform;class ProportionalToScene extends cc.ResolutionPolicy.ContainerStrategy{apply(e,t){const i=e._frameSize.width,n=e._frameSize.height,r=cc.game.container.style,o=t.width,s=t.height,a=i/o,l=n/s;let d,c;a<l?(d=i,c=s*a):(d=o*l,c=n),d=i-2*Math.round((i-d)/2),c=n-2*Math.round((n-c)/2),this._setupContainer(e,d,c),r.margin="0"}}function bindEvent(e){if(!isBind&&(isBind=!0,window.addEventListener("resize",t=>{"cc"in window&&e._emit("resize",{width:window.innerWidth,height:window.innerHeight})}),"function"==typeof window.matchMedia)){const e=()=>{const t=window.devicePixelRatio;window.matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",()=>{window.dispatchEvent(new Event("resize")),e()},{once:!0})};e()}}class Operation{constructor(){this._events=new Map,bindEvent(this),window.addEventListener("load",()=>{bindEvent(this)})}requestPointerLock(){index_1.default.send("lock-pointer",!0)}exitPointerLock(){index_1.default.send("lock-pointer",!1)}changePointer(e){["-webkit-grab","-webkit-grabbing","zoom-in","zoom-out","n-resize","s-resize","e-resize","w-resize","ne-resize","ew-resize","nw-resize","ns-resize","se-resize","sw-resize","nesw-resize","nwse-resize","col-resize","row-resize","text","vertical-text","context-menu","copy","move","none","default","pointer","inherit","initial","alias","all-scroll","auto","cell","crosshair","no-drop","not-allowed","progress","unset","wait"].includes(e)||(e="default"),index_1.default.send("change-pointer",e)}_emit(e,...t){const i=this._events.get(e);if(i)for(let e=0;e<i.length;e++){const n=i[e];let r;if("function"==typeof n)r=n(...t);else{const{listener:e}=n;r=e(...t)}if(!1===r)return}}_emitMouseEvent(e,t){const i=this._events.get(e);if(!i)return;let n=devicePixelRatio;isSceneNative&&!isWin32&&(n=1),t.x*=n,t.y*=n,t.deltaX*=n,t.deltaY*=n,t.wheelDeltaX*=n,t.wheelDeltaY*=n,t.moveDeltaX*=n,t.moveDeltaY*=n;for(let e=0;e<i.length;e++){const n=i[e];let r;if("function"==typeof n)r=n(t);else{const{listener:e}=n;r=e(t)}if(!1===r)return}}on(e,t,i){return this.addListener(e,t,i)}addListener(e,t,i){this._events.has(e)||this._events.set(e,[]);const n=this._events.get(e);if(i){let e=0;for(let t=0;t<n.length;t++){if(!n[t].priority){e=t;break}if(n[t].priority<i){e=t;break}e++}n.splice(e,0,{listener:t,priority:i})}else n.push(t);return this}removeListener(e,t){this._events.has(e)||this._events.set(e,[]);const i=this._events.get(e);for(let e=0;e<i.length;e++)i[e]===t&&i.splice(e--,1)}}var OperationPriority;exports.default=new Operation,function(e){e[e.Preview=999]="Preview",e[e.Gizmo=99]="Gizmo",e[e.Camera=98]="Camera"}(OperationPriority=exports.OperationPriority||(exports.OperationPriority={}));