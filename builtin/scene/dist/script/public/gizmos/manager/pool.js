"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GizmoPool=void 0;const data_1=require("./data"),gizmo_defines_1=__importDefault(require("../gizmo-defines"));class GizmoPool{_transformPool={};_componentsPool={};_iconPool={};_persistentPool={};_getPool(o){var t={pool:{},typeDefs:{}};switch(o){case"component":t.pool=this._componentsPool,t.typeDefs=gizmo_defines_1.default.components;break;case"icon":t.pool=this._iconPool,t.typeDefs=gizmo_defines_1.default.iconGizmo;break;case"persistent":t.pool=this._persistentPool,t.typeDefs=gizmo_defines_1.default.persistentGizmo}return t}unmountGizmo(o){o.target&&(0,data_1.getGizmoProperty)("component",o.target)===o&&(0,data_1.setGizmoProperty)("component",o.target,null),o.target&&(0,data_1.getGizmoProperty)("icon",o.target)===o&&(0,data_1.setGizmoProperty)("icon",o.target,null),o.target&&(0,data_1.getGizmoProperty)("persistent",o.target)===o&&(0,data_1.setGizmoProperty)("persistent",o.target,null),o&&(o.target=null)}forEachInstanceList(o,t,e){o=this._getPool(o).pool,o=o[t];o&&o.forEach(e)}createGizmo(o,t){var{pool:o,typeDefs:e}=this._getPool(o);if(!o||!e)return null;e=e[t];let r=o[t];if((r=r||(o[t]=[]))&&r[0]&&r[0].constructor!==e&&(r.forEach(o=>{o.destroy()}),r.length=0),!e)return null;for(const s of r)if(!s.visible())return s;const s=new e(null);return r.push(s),s}destroyGizmo(s){this.unmountGizmo(s),s.destroy(),[this._transformPool,this._componentsPool,this._iconPool,this._persistentPool].forEach(function(o){for(const r in o){var t,e=o[r];e&&-1!==(t=e.indexOf(s))&&e.splice(t,1)}})}clearAllGizmos(){[this._transformPool,this._componentsPool,this._iconPool,this._persistentPool].forEach(o=>{for(const e in o){var t=o[e];t&&t.forEach(o=>{this.unmountGizmo(o),o.destroy()})}})}}exports.GizmoPool=GizmoPool;