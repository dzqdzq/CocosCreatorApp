"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),base_1=__importDefault(require("./base")),controller_utils_1=__importDefault(require("../utils/controller-utils")),controller_shape_1=__importDefault(require("../utils/controller-shape")),engine_1=__importDefault(require("../utils/engine")),MARGIN=50,LINE_3D_MAXIMUM_LENGTH=1e5,axis={x:{name:"x",start:new cc_1.Vec3(0,0,0),end:new cc_1.Vec3(0,0,0),color:cc_1.Color.RED},y:{name:"y",start:new cc_1.Vec3(0,0,0),end:new cc_1.Vec3(0,0,0),color:cc_1.Color.GREEN},z:{name:"z",start:new cc_1.Vec3(0,0,0),end:new cc_1.Vec3(0,0,0),color:cc_1.Color.BLUE}};class OriginAxisController extends base_1.default{static changeCenterAxisVisible(e,i){e&&e.setVisible(i.x_visible,i.y_visible,i.z_visible)}constructor(e,i){super(e),this.camera=null,this.xAxis=null,this.yAxis=null,this.zAxis=null,this.camera=i,this.initShape()}onCameraTransformChanged(){requestAnimationFrame(()=>{this.updateTransform()})}onShow(){this.camera&&this.camera.node.on("transform-changed",this.onCameraTransformChanged,this),this.updateTransform()}onHide(){this.camera&&this.camera.node.off("transform-changed",this.onCameraTransformChanged,this)}appEditorLayer(e){e&&(e.node.layer=cc_1.Layers.Enum.EDITOR|cc_1.Layers.Enum.IGNORE_RAYCAST)}initShape(){this.createShapeNode("Origin-Axis"),this.xAxis=controller_utils_1.default.createLine(this.shape,axis.x.start,axis.x.end,axis.x.color,{name:axis.x.name}),this.appEditorLayer(this.xAxis),this.yAxis=controller_utils_1.default.createLine(this.shape,axis.y.start,axis.y.end,axis.y.color,{name:axis.y.name}),this.appEditorLayer(this.yAxis),this.zAxis=controller_utils_1.default.createLine(this.shape,axis.z.start,axis.z.end,axis.z.color,{name:axis.z.name}),this.appEditorLayer(this.zAxis),this.show()}updateAxisLineTransform(){var e,i,s;this.camera&&(cce.Gizmo.is2D?(e=this.camera.node.worldPosition,s=this.camera.orthoHeight/window.innerHeight,i=(window.innerWidth+MARGIN)*s,s=(window.innerHeight+MARGIN)*s,axis.x.start.set(-i+e.x,0,0),axis.x.end.set(i+e.x,0,0),axis.y.start.set(0,-s+e.y,0),axis.y.end.set(0,s+e.y,0),axis.z.start.set(0,0,0),axis.z.end.set(0,0,0)):(axis.x.start.set(-LINE_3D_MAXIMUM_LENGTH,0,0),axis.x.end.set(LINE_3D_MAXIMUM_LENGTH,0,0),axis.y.start.set(0,-LINE_3D_MAXIMUM_LENGTH,0),axis.y.end.set(0,LINE_3D_MAXIMUM_LENGTH,0),axis.z.start.set(0,0,-LINE_3D_MAXIMUM_LENGTH),axis.z.end.set(0,0,LINE_3D_MAXIMUM_LENGTH)),this.updateLineTransform(this.xAxis,axis.x.start,axis.x.end),this.updateLineTransform(this.yAxis,axis.y.start,axis.y.end),this.updateLineTransform(this.zAxis,axis.z.start,axis.z.end),cce.Engine.repaintInEditMode())}updateLineTransform(e,i,s){e&&(i=controller_shape_1.default.calcLineData(i,s),engine_1.default.updatePositions(e,i.positions),engine_1.default.updateBoundingBox(e,i.minPos,i.maxPos))}onDimensionChanged(){super.onDimensionChanged(),this.updateTransform()}setColor(e){this.xAxis&&engine_1.default.setMeshColor(this.xAxis.node,e[0]),this.yAxis&&engine_1.default.setMeshColor(this.yAxis.node,e[1]),this.zAxis&&engine_1.default.setMeshColor(this.zAxis.node,e[2])}updateTransform(e){var i=this.xAxis&&this.xAxis.node.parent;i&&e&&i.setWorldPosition(e.worldPosition),this.updateAxisLineTransform()}setVisible(e,i,s){this.xAxis&&(this.xAxis.node.active=e),this.yAxis&&(this.yAxis.node.active=i),this.zAxis&&(this.zAxis.node.active=s),this.updateAxisLineTransform(),cce.Engine.repaintInEditMode()}}exports.default=OriginAxisController;