"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const controller_base_1=__importDefault(require("./controller-base")),controller_utils_1=__importDefault(require("../utils/controller-utils")),controller_shape_1=__importDefault(require("../utils/controller-shape")),cc_1=require("cc"),{AttributeName:AttributeName,getModel:getModel,updatePositions:updatePositions,updateIB:updateIB,updateVBAttr:updateVBAttr,setMeshColor:setMeshColor,setNodeOpacity:setNodeOpacity}=require("../../../utils/engine/index");class LinesController extends controller_base_1.default{constructor(e,t={}){super(e),this._linesNode=null,this._linesMR=null,this._dashed=!1,this.initShape(t)}initShape(e={}){var t;this.createShapeNode("LinesController"),this._dashed=null!==(t=e.dashed)&&void 0!==t&&t;const s=[new cc_1.Vec3,new cc_1.Vec3],i=controller_shape_1.default.calcLinesData(s,[0,1],!1);this._linesNode=controller_utils_1.default.createShapeByData(i,this._color,{unlit:!0,dashed:this._dashed}),this._linesNode.name="LinesNode",this._linesNode.parent=this.shape,this._linesMR=getModel(this._linesNode)}setColor(e){this._color=e,setMeshColor(this._linesNode,e)}setOpacity(e){setNodeOpacity(this._linesNode,e)}updateData(e,t){const s=controller_shape_1.default.calcLinesData(e,t,!1);if(this._dashed){const s=[];if(e.length>0&&t.length>0){s[0]=0;const i=e[t[0]];for(let l=1;l<t.length;l++){const o=e[t[l]];s[l]=cc_1.Vec3.distance(o,i)}}updateVBAttr(this._linesMR,"a_lineDistance",s)}updatePositions(this._linesMR,s.positions),updateIB(this._linesMR,s.indices)}clearData(){updatePositions(this._linesMR,[]),updateIB(this._linesMR,[])}}exports.default=LinesController;