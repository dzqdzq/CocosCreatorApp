"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const Utils=require("../../../../utils"),external_1=__importDefault(require("../../../../utils/external")),NodeUtils=external_1.default.NodeUtils,sphere_controller_1=__importDefault(require("../../controller/sphere-controller")),gizmo_base_1=__importDefault(require("../../gizmo-base")),cc_1=require("cc"),{create3DNode:create3DNode}=require("../../../../utils/engine/index"),MathUtil=external_1.default.EditorMath;class SphereLightComponentGizmo extends gizmo_base_1.default{constructor(){super(...arguments),this._lightGizmoColor=new cc_1.Color(255,255,50),this._lightCtrlHoverColor=new cc_1.Color(0,255,0),this._range=0,this._glowSize=.4,this._controller=null,this._sizeSphereCtrl=null,this._propPath=null}init(){this.createController(),this._isInited=!0}onShow(){this._controller.show(),this._sizeSphereCtrl.show(),this.updateController()}onHide(){this._controller.hide(),this._sizeSphereCtrl.hide()}createController(){const t=this.getGizmoRoot(),e=create3DNode("SphereLightGizmo");e.parent=t,this._controller=new sphere_controller_1.default(e),this._controller.setColor(this._lightGizmoColor),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this),this._controller.editable=!0,this._controller.hoverColor=this._lightCtrlHoverColor,this._sizeSphereCtrl=new sphere_controller_1.default(e),this._sizeSphereCtrl.editable=!1}onControllerMouseDown(){this._isInited&&null!==this.target&&(this._range=this.target.range,this._propPath=this.getCompPropPath("range"))}onControllerMouseMove(){this.updateDataFromController()}onControllerMouseUp(){this.onControlEnd(this._propPath)}updateDataFromController(){if(this._controller.updated){this.onControlUpdate(this._propPath);const t=this.node,e=this._controller.getDeltaRadius();let o=this._range+e;o=MathUtil.toPrecision(o,3),o=Math.abs(o),this.target.range=o,this.onComponentChanged(t)}}updateControllerTransform(){var t;if(!this._isInited||null===this.target)return;const e=this.node,o=NodeUtils.getWorldPosition3D(e);this._controller.setPosition(o),null===(t=this._sizeSphereCtrl)||void 0===t||t.setPosition(o)}updateControllerData(){var t;if(!this._isInited||null===this.target)return;this._controller.checkEdit();const e=this.target;this._controller.radius=e.range;const o=e.color.clone();if(e.useColorTemperature){const t=e._light.colorTemperatureRGB;o.r*=t.x,o.g*=t.y,o.b*=t.z}const r=cc.v4();r.x=e.luminance,r.y=this._glowSize,null===(t=this._sizeSphereCtrl)||void 0===t||t.setColor(o),this._sizeSphereCtrl.radius=e.size}updateController(){this.updateControllerTransform(),this.updateControllerData()}onTargetUpdate(){this.updateController()}onNodeChanged(){this.updateController()}}exports.default=SphereLightComponentGizmo;