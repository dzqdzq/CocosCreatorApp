"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),{createMesh:createMesh}=require("../../../utils/engine"),external_1=__importDefault(require("../../../utils/external")),controller_shape_1=__importDefault(require("./controller-shape")),controller_shape_collider_1=require("./controller-shape-collider"),NodeUtils=external_1.default.NodeUtils,{CullMode:CullMode,create3DNode:create3DNode,addMeshToNode:addMeshToNode,setMeshColor:setMeshColor,setNodeOpacity:setNodeOpacity}=require("../../../utils/engine"),EditorMath=external_1.default.EditorMath;var AxisName;!function(e){e.x="x",e.y="y",e.z="z",e.neg_x="neg_x",e.neg_y="neg_y",e.neg_z="neg_z"}(AxisName||(AxisName={}));class ControllerUtils{static arrow(e,t,a,c,r={}){const o=create3DNode("arrow");let l=5;void 0!==r.bodyBBSize&&null!==r.bodyBBSize&&(l=r.bodyBBSize);const n={noDepthTestForLines:!0};Object.assign(n,r);const s=controller_shape_1.default.calcLineData(new cc_1.Vec3(0,0,0),new cc_1.Vec3(0,a,0)),i=this.createShapeByData(s,c,n);if(i.name="ArrowLine",i.parent=o,setMeshColor(i,c),l>0){let e=controller_shape_1.default.calcCylinderData(l,l,a,n);const t=this.createShapeByData(e,c,n);t.name="ArrowBody",t.parent=o,setNodeOpacity(t,0),t.setPosition(new cc_1.Vec3(0,a/2,0));const r=t.addComponent(controller_shape_collider_1.ControllerShapeCollider);r.isDetectMesh=!0,r.isRender=!1}const h={cullMode:CullMode.BACK};Object.assign(h,r);let d=controller_shape_1.default.calcConeData(t,e);const _=this.createShapeByData(d,c,h);return _.parent=o,_.name="ArrowHead",_.setPosition(new cc_1.Vec3(0,a+e/2,0)),_.addComponent(controller_shape_collider_1.ControllerShapeCollider).isDetectMesh=!1,o}static quad(e,t,a,c=new cc_1.Vec3(0,0,1),r=cc_1.Color.RED,o={}){const l=controller_shape_1.default.calcQuadData(e,t,a,c),n=this.createShapeByData(l,r,o);return n.name="Quad",n}static borderPlane(e,t,a,c){const r=e/2,o=t/2,l=create3DNode("borderPlane"),n=controller_shape_1.default.calcQuadData(new cc_1.Vec3,e,t),s=this.createShapeByData(n,a,{unlit:!0});s.name="Plane",setNodeOpacity(s,c),s.parent=l,s.addComponent(controller_shape_collider_1.ControllerShapeCollider).isDetectMesh=!1;let i=(e,t,a)=>{const c=controller_shape_1.default.calcLineData(e,t),r=this.createShapeByData(c,a,{alpha:200,noDepthTestForLines:!0});return r.name="BorderLine",r.parent=l,r};return i(new cc_1.Vec3(0,t/2,0),new cc_1.Vec3(r,t/2,0),a),i(new cc_1.Vec3(r,o,0),new cc_1.Vec3(r,0,0),a),l}static circle(e,t,a,c){const r=controller_shape_1.default.calcCircleData(e,t,a),o=this.createShapeByData(r,c);return o.name="Circle",o}static torus(e,t,a,c){const r=controller_shape_1.default.torus(e,t,a),o={cullMode:CullMode.BACK},l=this.createShapeByData(r,c,o);l.name="Torus";const n=l.addComponent(controller_shape_collider_1.ControllerShapeCollider);return n.isDetectMesh=!0,n.isRender=!1,l}static cube(e,t,a,c,r={}){const o=controller_shape_1.default.calcCubeData(e,t,a),l={cullMode:CullMode.BACK};Object.assign(l,r);const n=this.createShapeByData(o,c,l);return n.name="Cube",n.addComponent(controller_shape_collider_1.ControllerShapeCollider).isDetectMesh=!1,n}static scaleSlider(e,t,a,c={}){const r=create3DNode("scaleSlider"),o=this.cube(e,e,e,a,c);o.name="ScaleSliderHead",o.parent=r,o.setPosition(0,t+e/2,0);const l={noDepthTestForLines:!0};Object.assign(l,c);const n=controller_shape_1.default.lineWithBoundingBox(t),s=this.createShapeByData(n,a,l);return s.name="ScaleSliderBody",s.parent=r,s.eulerAngles=new cc_1.Vec3(0,0,90),s.addComponent(controller_shape_collider_1.ControllerShapeCollider).isDetectMesh=!1,r}static getCameraDistanceFactor(e,t){const a=NodeUtils.getWorldPosition3D(t);return cc_1.Vec3.distance(e,a)}static lineTo(e,t,a=cc_1.Color.RED,c={}){const r=controller_shape_1.default.calcLineData(e,t),o=this.createShapeByData(r,a,c);return o.name="Line",o}static disc(e,t,a,c=cc_1.Color.RED,r={}){const o=controller_shape_1.default.calcDiscData(e,t,a),l=this.createShapeByData(o,c,r);return l.name="Disc",l}static sector(e,t,a,c,r,o=cc_1.Color.RED,l={}){const n=controller_shape_1.default.calcSectorData(e,t,a,c,r,60),s=this.createShapeByData(n,o,l);return s.name="Sector",s}static arc(e,t,a,c,r,o=cc_1.Color.RED,l={}){const n=controller_shape_1.default.calcArcData(e,t,a,c,r),s=this.createShapeByData(n,o,l);return s.name="Arc",s}static arcDirectionLine(e,t,a,c,r,o,l,n=cc_1.Color.RED){const s=controller_shape_1.default.arcDirectionLine(e,t,a,c,r,o,l),i=this.createShapeByData(s,n);return i.name="ArcDirectionLine",i}static lines(e,t,a=cc_1.Color.RED,c={}){const r=controller_shape_1.default.calcLinesData(e,t),o=this.createShapeByData(r,a,c);return o.name="Lines",o}static wireframeBox(e,t,a,c={}){const r=controller_shape_1.default.wireframeBox(e,t),o=this.createShapeByData(r,a,c);return o.name="WireFrameBox",o}static frustum(e,t,a,c,r,o,l,n={}){const s=controller_shape_1.default.calcFrustum(e,t,a,c,r,o,!0),i=this.createShapeByData(s,l,n);return i.name="Frustum",i}static rectangle(e,t,a,c,r={}){const o=controller_shape_1.default.calcRectangleData(e,t,a),l=this.createShapeByData(o,c,r);return l.name="Rectangle",l}static angle(e,t){const a=Math.sqrt(cc_1.Vec3.lengthSqr(e)*cc_1.Vec3.lengthSqr(t));if(a<EditorMath.EPSILON)return 0;const c=EditorMath.clamp(cc_1.Vec3.dot(e,t)/a,-1,1);return Math.acos(c)*EditorMath.R2D}static sphere(e,t,a,c={}){let r=controller_shape_1.default.calcSphereData(e,t,c);const o=this.createShapeByData(r,a,c);return o.name="SphereShape",o}static octahedron(e,t,a,c,r=.2,o,l={}){let n=controller_shape_1.default.calcOctahedronData(e,t,a,c,r);const s=this.createShapeByData(n,o,l);return s.name="OctahedronShape",s}static createShapeByData(e,t,a={}){const c=create3DNode(a.name);return addMeshToNode(c,createMesh(e,a),a),setMeshColor(c,t),c}}ControllerUtils.YELLOW=new cc_1.Color(255,255,0),ControllerUtils.AxisName=AxisName,ControllerUtils.axisDirectionMap={x:new cc_1.Vec3(1,0,0),y:new cc_1.Vec3(0,1,0),z:new cc_1.Vec3(0,0,1),neg_x:new cc_1.Vec3(-1,0,0),neg_y:new cc_1.Vec3(0,-1,0),neg_z:new cc_1.Vec3(0,0,-1)},exports.default=ControllerUtils;