"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const gizmo_base_1=__importDefault(require("../gizmo-base")),external_1=__importDefault(require("../../../utils/external")),cc_1=require("cc"),utils_1=__importDefault(require("../../../utils")),camera_1=__importDefault(require("../../../../../3d/manager/camera")),lod_controller_1=__importDefault(require("../controller/lod-controller")),lod_group_utils_1=require("cc/editor/lod-group-utils"),NodeUtils=external_1.default.NodeUtils,tempQuat_a=new cc_1.Quat;class LODGroupGizmo extends gizmo_base_1.default{init(){this.createController()}onEditorCameraMoved(){this.updateController()}onShow(){this._controller.show(),this.registerCameraMovedEvent(),this.updateController()}onHide(){this.unregisterCameraMoveEvent(),this._controller.hide()}createController(){const t=this.getGizmoRoot();this._controller=new lod_controller_1.default(t),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this)}onControllerMouseDown(){}onControllerMouseMove(){}onControllerMouseUp(){this.node&&utils_1.default.select(this.node.uuid)}updateControllerData(){if(this._isInitialized&&this.target&&this.target instanceof cc_1.LODGroup){const{x:t,y:e,z:o}=this.target.node.scale,r=Math.max(Math.abs(t),Math.abs(e),Math.abs(o)),l=this.target.objectSize;this._controller.show(),this._controller.updateSize(cc_1.Vec3.ZERO,cc.v2(r*l,r*l));const i=lod_group_utils_1.LODGroupEditorUtility.getVisibleLOD(this.target,camera_1.default.camera.camera);this._controller.setString(-1!==i?"LOD "+i:Editor.I18n.t("scene.lod.culled"))}}updateControllerTransform(){if(!this._isInitialized||null===this.target)return;const t=this.node,e=NodeUtils.getWorldPosition3D(t);this._controller.setPosition(e);const{rotation:o}=camera_1.default.getCurCameraInfo();tempQuat_a.set(o.x,o.y,o.z,o.w),this._controller.setRotation(tempQuat_a)}updateController(){this.updateControllerData(),this.updateControllerTransform(),cce.Engine.repaintInEditMode()}onTargetUpdate(){this.updateController()}onNodeChanged(){this.updateController()}}exports.default=LODGroupGizmo;