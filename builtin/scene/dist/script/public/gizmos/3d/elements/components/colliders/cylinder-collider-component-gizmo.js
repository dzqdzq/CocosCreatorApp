"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const external_1=__importDefault(require("../../../../utils/external")),NodeUtils=external_1.default.NodeUtils,cc_1=require("cc"),gizmo_base_1=__importDefault(require("../../gizmo-base")),cylinder_controller_1=__importDefault(require("../../controller/cylinder-controller")),EditorMath=external_1.default.EditorMath,tempQuat_a=new cc_1.Quat;class CylinderColliderComponentGizmo extends gizmo_base_1.default{constructor(){super(...arguments),this._maxScale=1,this._radius=0,this._height=0,this._controller=null,this._propPath=null}init(){this.createController(),this._isInited=!0}onShow(){this._controller.show(),this.updateControllerData()}onHide(){this._controller.hide()}createController(){const t=this.getGizmoRoot();this._controller=new cylinder_controller_1.default(t),this._controller.setColor(cc.Color.GREEN),this._controller.editable=!0,this._controller.hoverColor=cc.Color.YELLOW,this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this)}onControllerMouseDown(){if(!this._isInited||null==this.target)return;this._radius=this.target.radius,this._height=this.target.height;const t=NodeUtils.getWorldScale3D(this.node);this._maxScale=this.getMaxScale(t),this._propPath=this.getCompPropPath("size")}onControllerMouseMove(){this.updateDataFromController()}onControllerMouseUp(){this.onControlEnd(this._propPath)}updateDataFromController(){if(this._controller.updated){this.onControlUpdate(this._propPath);const t=this._controller.getDeltaRadius(),o=EditorMath.toPrecision(this._radius+t/this._maxScale,3);this.target.radius=o;const e=this._controller.getDeltaHeight(),r=EditorMath.toPrecision(this._height+e/this._maxScale,3);this.target.height=r;const i=this.node;this.onComponentChanged(i)}}updateControllerTransform(){this.updateControllerData()}updateControllerData(){if(this._isInited&&null!=this.target)if(this.target instanceof cc_1.CylinderCollider){const t=this.node;this._controller.show(),this._controller.checkEdit();const o=NodeUtils.getWorldScale3D(t),e=NodeUtils.getWorldPosition3D(t),r=tempQuat_a;NodeUtils.getWorldRotation3D(t,r);const i=Math.max(Math.abs(o.x),Math.abs(o.z));this._controller.setScale(new cc_1.Vec3(i,o.y,i)),this._controller.setPosition(e),this._controller.setRotation(r),this._controller.direction=this.target.direction,this._controller.updateSize(this.target.center,this.target.radius,this.target.height)}else this._controller.hide(),console.error("target is not a cc.CylinderCollider")}onTargetUpdate(){this.updateControllerData()}onNodeChanged(){this.updateControllerData()}getMaxScale(t){return Math.max(t.x,t.y,t.z)}}exports.default=CylinderColliderComponentGizmo;