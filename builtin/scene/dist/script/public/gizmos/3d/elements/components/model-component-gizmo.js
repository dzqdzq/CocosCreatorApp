"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),engine_1=__importDefault(require("../../../utils/engine")),external_1=__importDefault(require("../../../utils/external")),box_controller_1=__importDefault(require("../controller/box-controller")),gizmo_base_1=__importDefault(require("../gizmo-base")),light_probe_tetrahedron_controller_1=__importDefault(require("../controller/light-probe-tetrahedron-controller")),NodeUtils=external_1.default.NodeUtils,{getBoundingBox:getBoundingBox}=engine_1.default,tempQuat_a=new cc_1.Quat;class ModelComponentGizmo extends gizmo_base_1.default{constructor(){super(...arguments),this._controller=null,this.tetrahedronController=null}init(){this.createController(),this._isInitialized=!0,cce.Gizmo.registerLightProbeEditModeListener(this)}lightProbeInfoChanged(){var t;null===(t=this.tetrahedronController)||void 0===t||t.updateController()}onShow(){this._controller.show(),this.tetrahedronController.show(),this.updateControllerTransform()}onHide(){this._controller.hide(),this.tetrahedronController.hide()}createController(){const t=this.getGizmoRoot();this._controller=new box_controller_1.default(t),this._controller.setOpacity(150),this.tetrahedronController=new light_probe_tetrahedron_controller_1.default(t,this)}updateControllerTransform(){this.updateControllerData()}updateControllerData(){if(!this._isInitialized||null==this.target)return;const t=this.node,e=getBoundingBox(this.target);if(e){this._controller.show();const o=new cc_1.Vec3,r=NodeUtils.getWorldScale3D(t),l=NodeUtils.getWorldPosition3D(t),n=tempQuat_a;NodeUtils.getWorldRotation3D(t,n),this._controller.setScale(r),this._controller.setPosition(l),this._controller.setRotation(n),cc_1.Vec3.multiplyScalar(o,e.halfExtents,2);const i=cc.v3(e.center.x,e.center.y,e.center.z);this._controller.updateSize(i,o)}else this._controller.hide()}onTargetUpdate(){var t;this.updateControllerData(),null===(t=this.tetrahedronController)||void 0===t||t.updateController()}onNodeChanged(){var t;this.updateControllerData(),null===(t=this.tetrahedronController)||void 0===t||t.updateController()}}exports.default=ModelComponentGizmo;