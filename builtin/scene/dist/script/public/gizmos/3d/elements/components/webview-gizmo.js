"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const gizmo_base_1=__importDefault(require("../gizmo-base")),image_controller_1=__importDefault(require("../controller/image-controller")),rectangle_controller_1=__importDefault(require("../controller/rectangle-controller")),cc_1=require("cc"),external_1=__importDefault(require("../../../utils/external")),NodeUtils=external_1.default.NodeUtils,Utils=require("../../../utils"),tempQuat_a=new cc_1.Quat,imageSzie=cc_1.size(200,150);class WebviewGizmo extends gizmo_base_1.default{init(){this.createController()}onShow(){this._controller.show(),this._rectController.show(),this.updateController()}onHide(){this._controller.hide(),this._rectController.hide()}onDestroy(){this._rectController.hide()}createController(){this._controller=new image_controller_1.default(this.getGizmoRoot(),{texture:!0}),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this),this._rectController=new rectangle_controller_1.default(this.getGizmoRoot()),this._rectController.setColor(new cc.Color(0,153,255)),this._rectController.setOpacity(155)}onControllerMouseDown(){}onControllerMouseMove(){}onControllerMouseUp(){this.node&&Utils.select(this.node.uuid)}syncImageControllerData(){const t=this.node.getComponent(cc_1.UITransform);if(!t)return;let e=t.contentSize;this._controller.setTextureByUuid("b9f47df4-b2f0-4270-bd8a-07bb344a8253@6c48a"),this._controller.show();let o,r=1,l=1;imageSzie.width>e.width&&(r=e.width/imageSzie.width),imageSzie.height>e.height&&(l=e.height/imageSzie.height),o=r<l?r:l,this._controller.updateSize(cc.v3(),cc.v2(imageSzie.width*o,-imageSzie.height*o))}syncRectControllerData(){const t=this.node.getComponent(cc_1.UITransform);if(!t)return;let e=t.contentSize,o=t.anchorPoint,r=cc.v3();r.x=(.5-o.x)*e.width,r.y=(.5-o.y)*e.height,this._controller.show(),this._rectController.updateSize(r,cc.v2(e.width,e.height))}updateControllerData(){this._isInited&&this.target&&this.node&&(this.syncImageControllerData(),this.syncRectControllerData(),this.target.enabled?(this._controller.show(),this._rectController.show()):(this._controller.hide(),this._rectController.hide()))}updateControllerTransform(){if(!this._isInited||!this.target)return;let t=this.node,e=NodeUtils.getWorldPosition3D(t);const o=tempQuat_a;NodeUtils.getWorldRotation3D(t,o),this._controller.setPosition(e),this._controller.setRotation(o);let r=NodeUtils.getWorldScale3D(t);this._rectController.setPosition(e),this._rectController.setRotation(o),this._rectController.setScale(r)}updateController(){this.updateControllerData(),this.updateControllerTransform()}onTargetUpdate(){this.updateController()}onNodeChanged(){this.updateController()}}exports.default=WebviewGizmo;