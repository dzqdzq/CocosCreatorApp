"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0});const gizmo_base_1=__importDefault(require("../gizmo-base")),icon_controller_1=__importDefault(require("../controller/icon-controller")),external_1=__importDefault(require("../../../utils/external")),gizmo_config_1=__importDefault(require("../../../gizmo-config")),cc_1=require("cc"),utils_1=__importDefault(require("../../../utils")),NodeUtils=external_1.default.NodeUtils,tempQuat_a=new cc_1.Quat;class IconGizmoBase extends gizmo_base_1.default{constructor(){super(...arguments),this._controller=null,this._isIconGizmoVisible=!1,this.disableOnSelected=!1}init(){this.createController()}show(){this.checkVisible()&&super.show()}onShow(){var o;null===(o=this._controller)||void 0===o||o.show(),this.updateController()}onHide(){var o;null===(o=this._controller)||void 0===o||o.hide()}checkVisible(){return!(!this._isIconGizmoVisible||this._nodeSelected&&this.disableOnSelected||this.node.objFlags&cc.Object.Flags.LockedInEditor)}setIconGizmoVisible(o){this._isIconGizmoVisible=o,o?this.show():this.hide()}setIconGizmo3D(o){this._controller&&(this._controller.is3DIcon=o,o&&this._controller.updateSize(gizmo_config_1.default.iconGizmoSize))}setIconGizmoSize(o){var e;null===(e=this._controller)||void 0===e||e.updateSize(o)}createController(){const o=this.getGizmoRoot();this._controller=new icon_controller_1.default(o,{texture:!0}),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this),this._controller.is3DIcon=gizmo_config_1.default.isIconGizmo3D,this._controller.updateSize(gizmo_config_1.default.iconGizmoSize),this._isIconGizmoVisible||this._controller.hide()}onControllerMouseDown(){}onControllerMouseMove(){}onControllerMouseUp(){this.node&&utils_1.default.select(this.node.uuid)}updateController(){this.updateControllerTransform()}updateControllerTransform(){var o,e,t;if(!this._isInitialized||null===this.target)return;const i=this.node,l=NodeUtils.getWorldPosition3D(i),r=tempQuat_a;NodeUtils.getWorldRotation3D(i,r),null===(o=this._controller)||void 0===o||o.setPosition(l),null===(e=this._controller)||void 0===e||e.setRotation(r),null===(t=this._controller)||void 0===t||t.onEditorCameraMoved()}onTargetUpdate(){this.updateController()}onNodeChanged(o){this.updateController()}onNodeSelectionChanged(o){super.onNodeSelectionChanged(o),o&&this.disableOnSelected?this.hide():o||this.show()}}exports.default=IconGizmoBase;