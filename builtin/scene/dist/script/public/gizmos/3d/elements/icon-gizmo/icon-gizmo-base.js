"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0});const gizmo_base_1=__importDefault(require("../gizmo-base")),icon_controller_1=__importDefault(require("../controller/icon-controller")),external_1=__importDefault(require("../../../utils/external")),gizmo_config_1=__importDefault(require("../../../gizmo-config")),cc_1=require("cc"),NodeUtils=external_1.default.NodeUtils,Utils=require("../../../utils"),tempQuat_a=new cc_1.Quat;class IconGizmoBase extends gizmo_base_1.default{constructor(){super(...arguments),this._controller=null,this._isIconGizmoVisible=!1}init(){this.createController()}onShow(){var o;this.checkVisible()&&(null===(o=this._controller)||void 0===o||o.show()),this.updateController()}onHide(){var o;null===(o=this._controller)||void 0===o||o.hide()}checkVisible(){return!(!this._isIconGizmoVisible||this.node.objFlags&cc.Object.Flags.LockedInEditor)}setIconGizmoVisible(o){var t,e;this._isIconGizmoVisible=o,this.checkVisible()?(null===(t=this._controller)||void 0===t||t.show(),this.updateController()):null===(e=this._controller)||void 0===e||e.hide()}setIconGizmo3D(o){this._controller&&(this._controller.is3DIcon=o,o&&this._controller.updateSize(gizmo_config_1.default.iconGizmoSize))}setIconGizmoSize(o){var t;null===(t=this._controller)||void 0===t||t.updateSize(o)}createController(){const o=this.getGizmoRoot();this._controller=new icon_controller_1.default(o,{texture:!0}),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this),this._controller.is3DIcon=gizmo_config_1.default.isIconGizmo3D,this._controller.updateSize(gizmo_config_1.default.iconGizmoSize),this._isIconGizmoVisible||this._controller.hide()}onControllerMouseDown(){}onControllerMouseMove(){}onControllerMouseUp(){this.node&&Utils.select(this.node.uuid)}updateController(){this.updateControllerTransform()}updateControllerTransform(){var o,t;if(!this._isInited||null===this.target)return;const e=this.node,i=NodeUtils.getWorldPosition3D(e),l=tempQuat_a;NodeUtils.getWorldRotation3D(e,l),null===(o=this._controller)||void 0===o||o.setPosition(i),null===(t=this._controller)||void 0===t||t.setRotation(l)}onTargetUpdate(){this.updateController()}onNodeChanged(){this.updateController()}}exports.default=IconGizmoBase;