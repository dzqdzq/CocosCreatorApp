"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const editable_controller_1=__importDefault(require("./editable-controller")),cc_1=require("cc"),controller_shape_1=__importDefault(require("../utils/controller-shape")),controller_utils_1=__importDefault(require("../utils/controller-utils")),{AttributeName:AttributeName,setMeshColor:setMeshColor,getModel:getModel,updatePositions:updatePositions}=require("../../../utils/engine/index"),axisDirMap=controller_utils_1.default.axisDirectionMap,AxisName=controller_utils_1.default.AxisName,tempVec3=new cc_1.Vec3;class CircleController extends editable_controller_1.default{constructor(e){super(e),this._oriDir=new cc_1.Vec3(0,0,-1),this._center=new cc_1.Vec3,this._radius=100,this._arc=360,this._deltaRadius=0,this._circleNode=null,this._circleFromDir=new cc_1.Vec3(1,0,0),this._circleMR=null,this._mouseDeltaPos=new cc_1.Vec2,this._curDistScalar=0,this._controlDir=new cc_1.Vec3,this._editHandleKeys=[AxisName.x,AxisName.y,AxisName.neg_x,AxisName.neg_y],this.initShape()}get radius(){return this._radius}set radius(e){this.updateSize(this._center,e,this._arc)}setColor(e){setMeshColor(this._circleNode,e),this.setEditHandlesColor(e),this._color=e}_updateEditHandle(e){const t=this._handleDataMap[e].topNode,i=axisDirMap[e],s=new cc_1.Vec3;cc_1.Vec3.multiplyScalar(tempVec3,i,this._radius),s.add(tempVec3),cc_1.Vec3.multiply(s,s,this.getScale());const o=new cc_1.Vec3(s);o.add(this._center),t.setPosition(o)}initShape(){this.createShapeNode("CircleController");const e=controller_utils_1.default.arc(this._center,this._oriDir,this._circleFromDir,this._twoPI,this._radius,this._color);e.parent=this.shape,this._circleNode=e,this._circleMR=getModel(e),this.hide()}updateSize(e,t,i){this._center=e,this._radius=t,this._arc=i;const s=controller_shape_1.default.calcArcPoints(this._center,this._oriDir,this._circleFromDir,-this._arc*this._degreeToRadianFactor,this._radius);updatePositions(this._circleMR,s),this._edit&&this.updateEditHandles(),this.adjustEditHandlesSize()}onMouseDown(e){this._mouseDeltaPos=new cc_1.Vec2(0,0),this._curDistScalar=super.getDistScalar(),this._deltaRadius=0,this._controlDir=cc.v3(),this.onControllerMouseDown&&this.onControllerMouseDown(e)}onMouseMove(e){if(this._isMouseDown){this._mouseDeltaPos.x+=e.moveDeltaX,this._mouseDeltaPos.y+=e.moveDeltaY;const t=axisDirMap[e.handleName];this._controlDir=t;const i=this.getAlignAxisMoveDistance(this.localToWorldDir(t),this._mouseDeltaPos)*this._curDistScalar;this._deltaRadius=i,this.onControllerMouseMove&&this.onControllerMouseMove(e)}}onMouseUp(e){this.onControllerMouseUp&&this.onControllerMouseUp(e)}onMouseLeave(e){this.onMouseUp(e)}getDeltaRadius(){return this._deltaRadius}getControlDir(){return this._controlDir}}exports.default=CircleController;