"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const Utils=require("../../../../utils"),external_1=__importDefault(require("../../../../utils/external")),NodeUtils=external_1.default.NodeUtils,direction_light_controller_1=__importDefault(require("../../controller/direction-light-controller")),gizmo_base_1=__importDefault(require("../../gizmo-base")),cc_1=require("cc"),frustum_controller_1=__importDefault(require("../../controller/frustum-controller")),tempQuat=new cc_1.Quat;class DirectionalLightComponentGizmo extends gizmo_base_1.default{constructor(){super(...arguments),this._lightGizmoColor=new cc.Color(255,255,50),this._controller=null,this._frustumCtrl=null}init(){this.createController(),this._isInited=!0}onShow(){var t;this._controller.show(),null===(t=this._frustumCtrl)||void 0===t||t.show(),this.updateControllerData()}onHide(){var t;this._controller.hide(),null===(t=this._frustumCtrl)||void 0===t||t.hide()}createController(){const t=this.getGizmoRoot();this._controller=new direction_light_controller_1.default(t),this._controller.setColor(this._lightGizmoColor),this._frustumCtrl=new frustum_controller_1.default(t)}onControllerMouseDown(){this._isInited&&this.target}onControllerMouseMove(){this.updateDataFromController()}onControllerMouseUp(){}updateDataFromController(){if(this._controller.updated){const t=this.node;this.onComponentChanged(t)}}updateControllerTransform(){var t,o;const e=this.node,r=tempQuat;NodeUtils.getWorldRotation3D(e,r);const l=NodeUtils.getWorldPosition3D(e);this._controller.setPosition(l),this._controller.setRotation(r),null===(t=this._frustumCtrl)||void 0===t||t.setPosition(l),null===(o=this._frustumCtrl)||void 0===o||o.setRotation(r)}updateControllerData(){var t,o,e,r,l;if(!this._isInited||null===this.target)return;const i=null===(t=cc_1.director.getScene())||void 0===t?void 0:t.globals.shadows;i?i.enabled?(null===(o=this._frustumCtrl)||void 0===o||o.show(),null===(e=this._frustumCtrl)||void 0===e||e.updateSize(0,i.orthoSize,1,1,i.near,i.far,0)):null===(r=this._frustumCtrl)||void 0===r||r.hide():null===(l=this._frustumCtrl)||void 0===l||l.hide(),this.updateControllerTransform()}onTargetUpdate(){this.updateControllerData()}onNodeChanged(){this.updateControllerData()}}exports.default=DirectionalLightComponentGizmo;