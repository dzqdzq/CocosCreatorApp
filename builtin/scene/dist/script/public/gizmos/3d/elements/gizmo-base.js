"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const Utils=require("../../utils"),event_enum_1=require("../../../event-enum"),external_1=__importDefault(require("../../utils/external")),EditorCamera=external_1.default.EditorCamera;class GizmoBase{constructor(t){this._hovering=!1,this._selecting=!1,this._editing=!1,this._isInited=!1,this._hidden=!0,this._target=null,this._rootNode=null,this._isControlBegin=!1,this._recorded=!1,this.target=t}get target(){return this._target}set target(t){let e=this.nodes;this._target=t,(e=this.nodes)&&e.length>0?this.onTargetUpdate&&this.onTargetUpdate():this.hide()}layer(){return"scene"}getGizmoRoot(){return this._rootNode||(this._rootNode=Utils.getGizmoRoot()),this._rootNode}onControlBegin(t){this._isControlBegin=!0,this.recordChanges(),this.nodes.forEach(e=>{Utils.emitNodeMessage("gizmo-control-begin",e,{propPath:t}),Utils.broadcastMessage("scene:gizmo-control-begin",e.uuid,{propPath:t})})}onControlUpdate(t){this._isControlBegin||this.onControlBegin(t)}onControlEnd(t){this._isControlBegin=!1,this.commitChanges(),this.nodes.forEach(e=>{Utils.emitNodeMessage("gizmo-control-end",e,{propPath:t}),Utils.broadcastMessage("scene:gizmo-control-end",e.uuid,{propPath:t})})}recordChanges(){this._recorded||(Utils.recordChanges(this.nodes),this._recorded=!0)}commitChanges(){this._recorded=!1,Utils.commitChanges(this.nodes)}_checkLockStatus(){return this.node.objFlags&cc.Object.Flags.LockedInEditor}targetValid(){let t=this.target;return Array.isArray(t)&&(t=t[0]),t&&t.isValid}visible(){return!this._hidden}hide(){this._hidden||(this.onHide&&this.onHide(),this._hidden=!0)}destroy(){this.onDestroy&&this.onDestroy(),this.hide(),this._target=null}show(){this._hidden&&(this._isInited||(this.init&&this.init(),this._isInited=!0),this.onShow&&this.onShow(),this._hidden=!1)}update(t){this.onUpdate&&this.onUpdate(t)}get node(){let t=this.target;return Array.isArray(t)&&(t=t[0]),cc.Node.isNode(t)?t:t instanceof cc.Component?t.node:null}get nodes(){const t=[],e=this.target;if(Array.isArray(e))for(let i=0;i<e.length;++i){const o=e[i];cc.Node.isNode(o)?t.push(o):o instanceof cc.Component&&t.push(o.node)}else cc.Node.isNode(e)?t.push(e):e instanceof cc.Component&&t.push(e.node);return t}get topNodes(){return this.target.filter(t=>{let e=t.parent;for(;e;){if(-1!==this.target.indexOf(e))return!1;e=e.parent}return!0})}get selecting(){return this._selecting}set selecting(t){this._selecting=t}get editing(){return this._editing}set editing(t){this._editing=t}get hovering(){return this._hovering}set hovering(t){this._hovering=t}getCompPropPath(t){const e=this.node,i=this.target;if(e&&i){return"_components."+e._components.indexOf(i)+"."+t}return null}onComponentChanged(t){Utils.onNodeChanged(t,{type:event_enum_1.NodeEventType.COMPONENT_CHANGED})}onEditorCameraMoved(){}registerCameraMovedEvent(){EditorCamera.camera.node.on("transform-changed",this.onEditorCameraMoved,this)}unregisterCameraMoveEvent(){EditorCamera.camera.node.off("transform-changed",this.onEditorCameraMoved,this)}}exports.default=GizmoBase;