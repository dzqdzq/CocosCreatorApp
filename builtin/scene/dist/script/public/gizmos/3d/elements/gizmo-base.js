"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});let Utils=require("../../utils");const event_enum_1=require("../../../event-enum"),external_1=__importDefault(require("../../utils/external")),EditorCamera=external_1.default.EditorCamera;class GizmoBase{constructor(e){this._hovering=!1,this._selecting=!1,this._editing=!1,this._isInited=!1,this._hidden=!0,this._target=null,this._rootNode=null,this._isControlBegin=!1,this._recorded=!1,this.target=e}get target(){return this._target}set target(e){let t=this.nodes;this._target=e,(t=this.nodes)&&t.length>0?this.onTargetUpdate&&this.onTargetUpdate():this.hide()}layer(){return"scene"}getGizmoRoot(){return this._rootNode||(this._rootNode=Utils.getGizmoRoot()),this._rootNode}onControlBegin(e){this._isControlBegin=!0,this.recordChanges(),this.nodes.forEach(t=>{Utils.emitNodeMessage("gizmo-control-begin",t,{propPath:e}),Utils.broadcastMessage("scene:gizmo-control-begin",t.uuid,{propPath:e})})}onControlUpdate(e){this._isControlBegin||this.onControlBegin(e)}onControlEnd(e){this._isControlBegin=!1,this.commitChanges(),this.nodes.forEach(t=>{Utils.emitNodeMessage("gizmo-control-end",t,{propPath:e}),Utils.broadcastMessage("scene:gizmo-control-end",t.uuid,{propPath:e})})}recordChanges(){this._recorded||(Utils.recordChanges(this.nodes),this._recorded=!0)}commitChanges(){this._recorded=!1,Utils.commitChanges(this.nodes)}_checkLockStatus(){return this.node._objFlags&cc.Object.Flags.LockedInEditor}targetValid(){let e=this.target;return Array.isArray(e)&&(e=e[0]),e&&e.isValid}visible(){return!this._hidden}hide(){this._hidden||(this.onHide&&this.onHide(),this._hidden=!0)}destroy(){this.onDestroy&&this.onDestroy(),this.hide()}show(){this._hidden&&(this._isInited||(this.init&&this.init(),this._isInited=!0),this.onShow&&this.onShow(),this._hidden=!1)}update(){this.onUpdate&&this.onUpdate()}get node(){let e=this.target;return Array.isArray(e)&&(e=e[0]),cc.Node.isNode(e)?e:e instanceof cc.Component?e.node:null}get nodes(){let e=[],t=this.target;if(Array.isArray(t))for(let i=0;i<t.length;++i){let o=t[i];cc.Node.isNode(o)?e.push(o):o instanceof cc.Component&&e.push(o.node)}else cc.Node.isNode(t)?e.push(t):t instanceof cc.Component&&e.push(t.node);return e}get topNodes(){return this.target.filter(e=>{let t=e.parent;for(;t;){if(-1!==this.target.indexOf(t))return!1;t=t.parent}return!0})}get selecting(){return this._selecting}set selecting(e){this._selecting=e}get editing(){return this._editing}set editing(e){this._editing=e}get hovering(){return this._hovering}set hovering(e){this._hovering=e}getCompPropPath(e){let t=this.node,i=this.target;if(t&&i){return"_components."+t._components.indexOf(i)+"."+e}return null}onComponentChanged(e){Utils.onNodeChanged(e,{type:event_enum_1.NodeEventType.COMPONENT_CHANGED})}onEditorCameraMoved(){}registerCameraMovedEvent(){EditorCamera._camera.node.on("transform-changed",this.onEditorCameraMoved,this)}unregisterCameraMoveEvent(){EditorCamera._camera.node.off("transform-changed",this.onEditorCameraMoved,this)}}exports.default=GizmoBase;