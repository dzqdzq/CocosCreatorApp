"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),engine_1=__importDefault(require("../../utils/engine")),external_1=__importDefault(require("../../utils/external")),base_1=require("../base"),box_1=__importDefault(require("../../controller/box")),controller_light_probe_tetrahedron_1=__importDefault(require("../light-probe-group/controller-light-probe-tetrahedron")),manager_1=require("../light-probe-group/manager"),types_1=require("../light-probe-group/types"),NodeUtils=external_1.default.NodeUtils,getBoundingBox=engine_1.default["getBoundingBox"],tempQuat_a=new cc_1.Quat;class ModelComponentGizmo extends base_1.SelectGizmo{init(){this.createController(),this._isInitialized=!0,manager_1.eventEmitter.addListener(types_1.LightProbeManagerEvent.MODE_CHANGED,()=>{this.tetrahedronController.updateController()})}onShow(){this._controller.show(),this.tetrahedronController.show(),this.updateControllerTransform()}onHide(){this._controller.hide(),this.tetrahedronController.hide()}createController(){var e=this.getGizmoRoot();this._controller=new box_1.default(e),this.tetrahedronController=new controller_light_probe_tetrahedron_1.default(e,this)}updateControllerTransform(){this.updateControllerData()}updateControllerData(){var e,t,r,o,l,n;this._isInitialized&&null!=this.target&&(n=this.target.node,(e=getBoundingBox(this.target))?(this._controller.show(),t=new cc_1.Vec3,NodeUtils.hasComponentInSelfAndParent(n,["cc.UISkew"])?this._controller.setWorldMatrix(n.worldMatrix):(r=NodeUtils.getWorldScale3D(n),o=NodeUtils.getWorldPosition3D(n),l=tempQuat_a,NodeUtils.getWorldRotation3D(n,l),this._controller.setScale(r),this._controller.setPosition(o),this._controller.setRotation(l)),cc_1.Vec3.multiplyScalar(t,e.halfExtents,2),n=cc.v3(e.center.x,e.center.y,e.center.z),this._controller.updateSize(n,t)):this._controller.hide())}onTargetUpdate(){var e;this.updateControllerData(),null!=(e=this.tetrahedronController)&&e.updateController()}onNodeChanged(){var e;this.updateControllerData(),null!=(e=this.tetrahedronController)&&e.updateController()}}exports.default=ModelComponentGizmo;