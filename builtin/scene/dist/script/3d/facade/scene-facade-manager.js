"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneFacadeManager=void 0;const general_scene_facade_1=__importDefault(require("./general-scene-facade")),scene_facade_state_interface_1=require("./scene-facade-state-interface"),animation_scene_facade_1=__importDefault(require("./animation-scene-facade")),finite_state_machine_1=__importDefault(require("../utils/state-machine/finite-state-machine")),prefab_scene_facade_1=__importDefault(require("./prefab-scene-facade")),scene_facade_state_transition_1=require("./scene-facade-state-transition"),camera_1=__importDefault(require("../manager/camera")),node_1=__importDefault(require("../manager/node")),component_1=__importDefault(require("../manager/component")),gizmos_1=__importDefault(require("../manager/gizmos")),asset_1=__importDefault(require("../manager/asset")),prefab_1=__importDefault(require("../manager/prefab")),selection_1=__importDefault(require("../manager/selection")),mini_preview_1=__importDefault(require("../manager/mini-preview")),preview_1=__importDefault(require("../manager/preview")),plugin_1=__importDefault(require("../manager/plugin")),lightmap_1=__importDefault(require("../manager/lightmap")),material_preview_1=__importDefault(require("../manager/material-preview")),terrain_1=__importDefault(require("../manager/terrain")),engine_1=require("../manager/engine"),operation_1=__importDefault(require("../../public/operation")),shortcut_1=__importDefault(require("../manager/shortcut")),node_2=__importDefault(require("../../utils/node")),scene_1=__importDefault(require("../manager/scene")),gameview_1=__importDefault(require("../manager/gameview")),scripts_1=__importDefault(require("../manager/scripts")),effects_1=__importDefault(require("../manager/effects")),model_preview_1=__importDefault(require("../manager/model-preview")),mesh_preview_1=__importDefault(require("../manager/mesh-preview")),skeleton_preview_1=__importDefault(require("../manager/skeleton-preview")),scene_view_data_1=require("../manager/scene/scene-view-data");let reloadTimer=null;const defaultDesignResolution="__default_design__";class SceneFacadeManager{constructor(){this._generalSceneFacade=new general_scene_facade_1.default,this._animationSceneFacade=new animation_scene_facade_1.default,this._prefabSceneFacade=new prefab_scene_facade_1.default,this._sceneFacades=[]}init(){this.initManager(),this._generalSceneFacade.init(),this._prefabSceneFacade.init(),this._animationSceneFacade.init(),this._sceneFacades=[this._generalSceneFacade,this._prefabSceneFacade,this._animationSceneFacade],this._facadeFSM=new finite_state_machine_1.default(this._sceneFacades),this._facadeFSM.addTransition(this._generalSceneFacade,this._animationSceneFacade,"toAnimation",new scene_facade_state_transition_1.ToAnimationTransition(this._generalSceneFacade,this._animationSceneFacade)).addTransition(this._generalSceneFacade,this._prefabSceneFacade,"toPrefab",new scene_facade_state_transition_1.ToPrefabTransition(this._generalSceneFacade,this._prefabSceneFacade)).addTransition(this._animationSceneFacade,this._generalSceneFacade,"toGeneral",new scene_facade_state_transition_1.ToGeneralTransition(this._animationSceneFacade,this._generalSceneFacade)).addTransition(this._animationSceneFacade,this._prefabSceneFacade,"toPrefab",new scene_facade_state_transition_1.ToPrefabTransition(this._animationSceneFacade,this._prefabSceneFacade)).addTransition(this._prefabSceneFacade,this._generalSceneFacade,"toGeneral",new scene_facade_state_transition_1.ToGeneralTransition(this._prefabSceneFacade,this._generalSceneFacade)).addTransition(this._prefabSceneFacade,this._animationSceneFacade,"toAnimation",new scene_facade_state_transition_1.ToAnimationTransition(this._prefabSceneFacade,this._animationSceneFacade)),this._facadeFSM.Begin(this._generalSceneFacade),Editor.EditMode.enter(this._generalSceneFacade.modeName.toLocaleLowerCase()),this.updatePhysicsGroup(),this.initEventListener()}initManager(){const e=window.cce;e.Camera=camera_1.default,e.Scene=scene_1.default,e.Node=node_1.default,e.Script=scripts_1.default,e.Operation=operation_1.default,e.Gizmo=gizmos_1.default,e.Asset=asset_1.default,e.GameView=gameview_1.default,e.Prefab=prefab_1.default,e.Effect=effects_1.default,e.Selection=selection_1.default,e.Shortcut=shortcut_1.default,e.MiniPreview=mini_preview_1.default,e.Preview=preview_1.default,e.Component=component_1.default,e.Terrain=terrain_1.default,e.Plugin=plugin_1.default,e.Lightmap=lightmap_1.default,e.MaterialPreview=material_preview_1.default,e.Engine=engine_1.engineManager,e.NeedAnimState=engine_1.NeedAnimState,e.ModelPreview=model_preview_1.default,camera_1.default.init(),node_1.default.init(),gizmos_1.default.init(),asset_1.default.init(),prefab_1.default.init(),selection_1.default.init(),mini_preview_1.default.init(),preview_1.default.init(),plugin_1.default.init(),lightmap_1.default.init(),material_preview_1.default.init(),model_preview_1.default.init(),terrain_1.default.init(),mesh_preview_1.default.init(),skeleton_preview_1.default.init(),engine_1.engineManager.init()}initEventListener(){operation_1.default.on("mouseup",e=>{if(!e.leftButton)return;const t=node_2.default.getRaycastResultNodes(camera_1.default.getCamera(),e.x,e.y);if(t.length>0){let a=null;for(let e=0;e<t.length;e++){const r=t[e];if(!(r._objFlags&cc.Object.Flags.LockedInEditor)){a=r;break}}if(!a)return;const r=this.querySelection();if(e.ctrlKey||e.shiftKey||this.clearSelection(),e.ctrlKey)this.isSelectNode(a.uuid)?this.unselectNode(a.uuid):this.selectNode(a.uuid);else{const e=r[0];for(let r=0;r<t.length-1;r++)if(t[r]&&e===t[r].uuid){a=t[r+1];break}this.selectNode(a.uuid)}}else e.leftButton&&(e.ctrlKey||e.shiftKey||this.clearSelection())}),operation_1.default.on("resize",this.onResize.bind(this));const e={type:"",uuids:[]};let t=!1;shortcut_1.default.on("Copy",()=>{const t=this.querySelection();e.type="copy",e.uuids=this.copyNode(t)}),shortcut_1.default.on("Cut",()=>{e.type="cut",e.uuids=this.querySelection()}),shortcut_1.default.on("Duplicate",()=>{if(this.snapshot(),!t)try{t=!0;const e=this.querySelection(),a=this.duplicateNode(e)||[];this.clearSelection(),a.forEach(e=>{e&&this.selectNode(e)})}catch(e){console.error(e)}finally{t=!1}}),shortcut_1.default.on("Paste",async()=>{if(this.snapshot(),!t)try{const a=this.querySelection()[0];t=!0;const{type:r,uuids:n}=e;let i=[];cce.Selection.clear(),"cut"===r?(i=await this.setNodeParent({parent:a,uuids:n,keepWorldTransform:!0}),n.length=0):"copy"===r&&(i=await this.pasteNode({target:a,uuids:n,keepWorldTransform:!0})),i.forEach(e=>{e&&this.selectNode(e)})}catch(e){console.error(e)}finally{t=!1}}),shortcut_1.default.on("Delete",async()=>{if(this.snapshot(),!t)try{t=!0;const e=this.querySelection();await this.removeNode({uuid:e}),cce.Selection.clear()}catch(e){console.error(e)}finally{t=!1}}),scene_1.default.on("open",this.onSceneOpened.bind(this)),scene_1.default.on("close",this.onSceneClosed.bind(this)),scene_1.default.on("reload",this.onSceneReload.bind(this)),node_1.default.on("change",this.onNodeChanged.bind(this)),node_1.default.on("add",this.onNodeAdded.bind(this)),node_1.default.on("remove",this.onNodeRemoved.bind(this)),component_1.default.on("add-component",this.onComponentAdded.bind(this)),component_1.default.on("remove-component",this.onComponentRemoved.bind(this)),asset_1.default.on("asset-refresh",this.assetRefresh.bind(this)),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.onEngineUpdate.bind(this)),scripts_1.default.on(scripts_1.default.EXECUTION_FINISHED,()=>{scripts_1.default.suspend(Promise.resolve(this.softReloadScene()))})}async openScene(e){let t="cc.SceneAsset";if(e)try{const a=await cce.Ipc.send("query-asset-info",e);a?t=a.type:(console.warn(`Open the previous scene failed: ${e} can not be found.`),e="")}catch(t){console.warn(`Open the previous scene failed: ${e} can not be found.`),e=""}if("cc.Prefab"===t)this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Prefab?await this._facadeFSM.currentState.openScene(e):await this._facadeFSM.issueCommand("toPrefab",{uuid:e});else{if("cc.SceneAsset"!==t)return console.error(`can't open asset: ${e} in scene`),!1;for(;this._facadeFSM.currentState.modeName!==scene_facade_state_interface_1.SceneModeType.General;)if(!await this.closeScene())return!1;await this._facadeFSM.currentState.openScene(e)}return!0}async closeScene(){const e=this._facadeFSM.currentState;if(e.modeName===scene_facade_state_interface_1.SceneModeType.Animation){const t=e.fromState;if((null===t||void 0===t?void 0:t.modeName)===scene_facade_state_interface_1.SceneModeType.General)return await this._facadeFSM.issueCommand("toGeneral",{uuid:this._generalSceneFacade.queryCurrentSceneUuid()});if(t.modeName===scene_facade_state_interface_1.SceneModeType.Prefab)return await this._facadeFSM.issueCommand("toPrefab")}else{if(e.modeName===scene_facade_state_interface_1.SceneModeType.Prefab)return await this._facadeFSM.issueCommand("toGeneral",{uuid:this._generalSceneFacade.queryCurrentSceneUuid()});console.warn("Trying to close current edit scene in general edit mode is not allowed")}return!1}async clearAllMode(){for(;this._facadeFSM.currentState.modeName!==scene_facade_state_interface_1.SceneModeType.General;)if(!await this.closeScene())return!1;return await this._facadeFSM.currentState.closeScene()}async dumpAllScenes(){return this._sceneFacades.map(e=>e.dumpSceneState())}onSceneOpened(e){this.changeTargetResolution(defaultDesignResolution),this._facadeFSM.currentState.onSceneOpened&&this._facadeFSM.currentState.onSceneOpened(e)}onSceneReload(e){this._facadeFSM.currentState.onSceneReload&&this._facadeFSM.currentState.onSceneReload(e)}onSceneClosed(e){this._facadeFSM.currentState.onSceneClosed&&this._facadeFSM.currentState.onSceneClosed(e)}async restoreAllScenes(e){this._sceneFacades.forEach((t,a)=>{t.restoreSceneState(e[a])})}async saveScene(e){return await this._facadeFSM.currentState.saveScene(e)}async softReloadScene(e){return await this._facadeFSM.currentState.softReloadScene(e)}async reloadScene(){return await this._facadeFSM.currentState.reloadScene()}async queryNodeTree(e){return await this._facadeFSM.currentState.queryNodeTree(e)}async queryNodesByAssetUuid(e){return node_1.default.queryNodesByAssetUuid(e)}async querySceneSerializedData(){return await this._generalSceneFacade.querySceneSerializedData()}async querySceneDirty(){return await this._facadeFSM.currentState.querySceneDirty()}async queryComponents(){return await this._facadeFSM.currentState.queryComponents()}async queryComponentHasScript(e){return await this._facadeFSM.currentState.queryComponentHasScript(e)}async queryLayerBuiltin(){return await this._facadeFSM.currentState.queryLayerBuiltin()}queryMode(){return this._facadeFSM.currentState.queryMode()}queryCurrentSceneUuid(){return this._facadeFSM.currentState.queryCurrentSceneUuid()}onResize(e){this._facadeFSM.currentState.onResize&&this._facadeFSM.currentState.onResize(e)}async queryNodeDump(e){return await this._facadeFSM.currentState.queryNodeDump(e)}async setNodeProperty(e){return await this._facadeFSM.currentState.setNodeProperty(e)}async resetNode(e){return await this._facadeFSM.currentState.resetNode(e)}async resetNodeProperty(e){return await this._facadeFSM.currentState.resetNodeProperty(e)}setNodeAndChildrenLayer(e){return this._facadeFSM.currentState.setNodeAndChildrenLayer(e)}moveNodeArrayElement(e){return this._facadeFSM.currentState.moveNodeArrayElement(e)}removeNodeArrayElement(e){return this._facadeFSM.currentState.removeNodeArrayElement(e)}async generateNodeAvailableName(e,t){return await this._facadeFSM.currentState.generateNodeAvailableName(e,t)}copyNode(e){return this._facadeFSM.currentState.copyNode(e)}duplicateNode(e){return this._facadeFSM.currentState.duplicateNode(e)}async pasteNode(e){return await this._facadeFSM.currentState.pasteNode(e)}async setNodeParent(e){return await this._facadeFSM.currentState.setNodeParent(e)}async createNode(e){return await this._facadeFSM.currentState.createNode(e)}removeNode(e){this._facadeFSM.currentState.removeNode(e)}async changeNodeLock(e,t){return await this._facadeFSM.currentState.changeNodeLock(e,t)}async restorePrefab(e,t){return await this._facadeFSM.currentState.restorePrefab(e,t)}onNodeChanged(e,t){this._facadeFSM.currentState.onNodeChanged&&this._facadeFSM.currentState.onNodeChanged(e,t),this.changeTitle(!0)}onNodeAdded(e,t){this._facadeFSM.currentState.onNodeAdded&&this._facadeFSM.currentState.onNodeAdded(e,t),this.changeTitle(!0)}onNodeRemoved(e,t){this._facadeFSM.currentState.onNodeRemoved&&this._facadeFSM.currentState.onNodeRemoved(e,t),this.changeTitle(!0)}async queryComponent(e){return await this._facadeFSM.currentState.queryComponent(e)}async queryComponentFunctionOfNode(e){return await this._facadeFSM.currentState.queryComponentFunctionOfNode(e)}createComponent(e){this._facadeFSM.currentState.createComponent(e)}resetComponent(e){this._facadeFSM.currentState.resetComponent(e)}removeComponent(e){this._facadeFSM.currentState.removeComponent(e)}async executeComponentMethod(e){return await this._facadeFSM.currentState.executeComponentMethod(e)}async executeSceneScriptMethod(e){return await this._facadeFSM.currentState.executeSceneScriptMethod(e)}onComponentAdded(e){this._facadeFSM.currentState.onComponentAdded&&this._facadeFSM.currentState.onComponentAdded(e)}onComponentRemoved(e){this._facadeFSM.currentState.onComponentRemoved&&this._facadeFSM.currentState.onComponentRemoved(e)}snapshot(e){this._facadeFSM.currentState.snapshot(e)}abortSnapshot(){this._facadeFSM.currentState.abortSnapshot()}undo(){this._facadeFSM.currentState.undo()}redo(){this._facadeFSM.currentState.redo()}recordNode(e,t=!0){t&&this._facadeFSM.currentState.recordNode(e,t)}async changeTitle(e){clearTimeout(this.timeId),this.timeId=setTimeout(async()=>{this._facadeFSM.currentState.modeName!==scene_facade_state_interface_1.SceneModeType.General&&this._facadeFSM.currentState.modeName!==scene_facade_state_interface_1.SceneModeType.Prefab||(void 0===e&&(e=await this._facadeFSM.currentState.querySceneDirty()),cce.Ipc.send("change-title",this._facadeFSM.currentState.queryCurrentSceneUuid(),e))},200)}async queryAllEffects(){return this._facadeFSM.currentState.queryAllEffects()}async queryMaterial(e){return this._facadeFSM.currentState.queryMaterial(e)}async queryEffect(e){return this._facadeFSM.currentState.queryEffect(e)}async queryAllRenderPipelines(){return this._facadeFSM.currentState.queryAllRenderPipelines()}async previewRenderPipeline(e,t){return this._facadeFSM.currentState.previewRenderPipeline(e,t)}async queryRenderPipeline(e){return this._facadeFSM.currentState.queryRenderPipeline(e)}async queryAllRenderFlows(){return this._facadeFSM.currentState.queryAllRenderFlows()}async queryAllRenderStages(){return this._facadeFSM.currentState.queryAllRenderStages()}previewMaterial(e,t){this._facadeFSM.currentState.previewMaterial(e,t)}applyMaterial(e,t){this._facadeFSM.currentState.applyMaterial(e,t)}async changePhysicsMaterial(e){return await this._facadeFSM.currentState.changePhysicsMaterial(e)}async applyPhysicsMaterial(e){this._facadeFSM.currentState.applyPhysicsMaterial(e)}async changeRenderStage(e){return await this._facadeFSM.currentState.changeRenderStage(e)}async applyRenderStage(e){this._facadeFSM.currentState.applyRenderStage(e)}async changeRenderFlow(e){return this._facadeFSM.currentState.changeRenderFlow(e)}async applyRenderFlow(e){this._facadeFSM.currentState.applyRenderFlow(e)}async changeRenderTexture(e){return this._facadeFSM.currentState.changeRenderTexture(e)}async applyRenderTexture(e,t){this._facadeFSM.currentState.applyRenderTexture(e,t)}async selectRenderPipeline(e){return await this._facadeFSM.currentState.selectRenderPipeline(e)}async changeRenderPipeline(e){return await this._facadeFSM.currentState.changeRenderPipeline(e)}applyRenderPipeline(e,t){this._facadeFSM.currentState.applyRenderPipeline(e,t)}async selectRenderFlow(e,t){await this._facadeFSM.currentState.selectRenderFlow(e,t)}async selectRenderStage(e,t,a){return await this._facadeFSM.currentState.selectRenderStage(e,t,a)}queryPhysicsMaterial(e){return this._facadeFSM.currentState.queryPhysicsMaterial(e)}queryRenderStage(e){return this._facadeFSM.currentState.queryRenderStage(e)}queryRenderFlow(e){return this._facadeFSM.currentState.queryRenderFlow(e)}queryRenderTexture(e){return this._facadeFSM.currentState.queryRenderTexture(e)}async assetChange(e,t,a){if(e===this._generalSceneFacade.queryCurrentSceneUuid())if(this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.General)await this._facadeFSM.currentState.reloadScene();else{for(;this._facadeFSM.currentState.modeName!==scene_facade_state_interface_1.SceneModeType.General;)if(!await this.closeScene())return;await this._facadeFSM.currentState.reloadScene()}e===this._prefabSceneFacade.queryCurrentSceneUuid()&&this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Prefab&&await this._facadeFSM.currentState.reloadScene(),this._facadeFSM.currentState.assetChange(e,t,a)}assetDelete(e,t){this._facadeFSM.currentState.assetDelete(e,t)}assetRefresh(e){this._facadeFSM.currentState.assetRefresh(e),engine_1.engineManager.repaintInEditMode()}releaseAsset(e){asset_1.default.releaseAsset(e)}async queryGizmoToolName(){return await this._facadeFSM.currentState.queryGizmoToolName()}async queryGizmoPivot(){return await this._facadeFSM.currentState.queryGizmoPivot()}async queryGizmoCoordinate(){return await this._facadeFSM.currentState.queryGizmoCoordinate()}async queryIs2D(){return await this._facadeFSM.currentState.queryIs2D()}queryIsIconGizmo3D(){return this._facadeFSM.currentState.queryIsIconGizmo3D()}queryIconGizmoSize(){return this._facadeFSM.currentState.queryIconGizmoSize()}setTransformToolName(e){this._facadeFSM.currentState.setTransformToolName(e)}setPivot(e){this._facadeFSM.currentState.setPivot(e)}setCoordinate(e){this._facadeFSM.currentState.setCoordinate(e)}setIs2D(e){this._facadeFSM.currentState.setIs2D(e)}setIconGizmo3D(e){this._facadeFSM.currentState.setIconGizmo3D(e)}setIconGizmoSize(e){this._facadeFSM.currentState.setIconGizmoSize(e)}focus(e=null,t,a,r,n=!1){this._facadeFSM.currentState.focus(e,t,a,r,n)}alignNodeToSceneView(e){this._facadeFSM.currentState.alignNodeToSceneView(e)}queryIsGridVisible(){return this._facadeFSM.currentState.queryIsGridVisible()}setGridVisible(e){this._facadeFSM.currentState.setGridVisible(e)}alignWithView(){this._facadeFSM.currentState.alignWithView()}alignViewWithNode(){this._facadeFSM.currentState.alignViewWithNode()}setGridLineColor(e){this._facadeFSM.currentState.setGridLineColor(e)}getCameraProperty(){return this._facadeFSM.currentState.getCameraProperty()}setCameraProperty(e){this._facadeFSM.currentState.setCameraProperty(e)}getCameraWheelSpeed(){return this._facadeFSM.currentState.getCameraWheelSpeed()}setCameraWheelSpeed(e){this._facadeFSM.currentState.setCameraWheelSpeed(e)}getCameraWanderSpeed(){return this._facadeFSM.currentState.getCameraWanderSpeed()}setCameraWanderSpeed(e){this._facadeFSM.currentState.setCameraWanderSpeed(e)}zoomSceneViewUp(){this._facadeFSM.currentState.zoomSceneViewUp()}zoomSceneViewDown(){this._facadeFSM.currentState.zoomSceneViewDown()}resetSceneViewZoom(){this._facadeFSM.currentState.resetSceneViewZoom()}queryCurrentAnimationState(){return this._facadeFSM.currentState.queryCurrentAnimationState()}queryCurrentAnimationInfo(){return this._facadeFSM.currentState.queryCurrentAnimationInfo()}queryAnimationRootNode(e){return this._facadeFSM.currentState.queryAnimationRootNode(e)}queryAnimationRootInfo(e){return this._facadeFSM.currentState.queryAnimationRootInfo(e)}queryAnimationClip(e,t){return this._facadeFSM.currentState.queryAnimationClip(e,t)}queryAnimationProperties(e){return this._facadeFSM.currentState.queryAnimationProperties(e)}queryAnimationClipsInfo(e){return this._facadeFSM.currentState.queryAnimationClipsInfo(e)}queryAnimationClipCurrentTime(e){return this._facadeFSM.currentState.queryAnimationClipCurrentTime(e)}queryAnimationPropValueAtFrame(e,t,a,r){return this._facadeFSM.currentState.queryAnimationPropValueAtFrame(e,t,a,r)}async recordAnimation(e,t){if(t)this._facadeFSM.issueCommand("toAnimation",{uuid:e});else{const e=this._facadeFSM.currentState;!t&&e instanceof animation_scene_facade_1.default&&await this.closeScene()}return!0}async changeAnimationRootNode(e,t){return await this._facadeFSM.currentState.changeAnimationRootNode(e,t)}async setCurEditTime(e){return await this._facadeFSM.currentState.setCurEditTime(e)}async changeClipState(e,t){return await this._facadeFSM.currentState.changeClipState(e,t)}async setEditClip(e){return await this._facadeFSM.currentState.setEditClip(e)}async saveClip(){return await this._facadeFSM.currentState.saveClip()}async applyAnimationOperation(e){return await this._facadeFSM.currentState.applyAnimationOperation(e)}async executeLightmapMethod(e){return await this._facadeFSM.currentState.executeLightmapMethod(e)}setMaterialPreviewPrimitive(e){material_preview_1.default.setPrimitive(e)}setMaterialPreviewLightEnable(e){material_preview_1.default.setLightEnable(e)}onMaterialPreviewMouseDown(e){material_preview_1.default.onMouseDown(e)}onMaterialPreviewMouseMove(e){material_preview_1.default.onMouseMove(e)}onMaterialPreviewMouseUp(e){material_preview_1.default.onMouseUp(e)}hideMaterialPreview(){material_preview_1.default.hide()}executeMiniPreviewMethod(e){this._facadeFSM.currentState.executeMiniPreviewMethod(e)}handleMiniPreviewSelect(e){this._facadeFSM.currentState.handleMiniPreviewSelect(e)}queryMiniPreviewWindowList(){return this._facadeFSM.currentState.queryMiniPreviewWindowList()}getMiniPreviewInfo(){return this._facadeFSM.currentState.getMiniPreviewInfo()}queryPreviewWindowList(){return this._facadeFSM.currentState.queryPreviewWindowList()}reloadAfterScriptChanged(){cc.director.getScene()&&(clearTimeout(reloadTimer),reloadTimer=setTimeout(()=>{this.softReloadScene()},200))}async queryScriptName(e){return await this._facadeFSM.currentState.queryScriptName(e)}async loadScript(e){return await this._facadeFSM.currentState.loadScript(e)}async removeScript(e){return await this._facadeFSM.currentState.removeScript(e)}async scriptChange(e){return await this._facadeFSM.currentState.scriptChange(e)}async investigatePackerDriver(){return await scripts_1.default.investigatePackerDriver()}_selectNode(e){this._facadeFSM.currentState._selectNode(e)}_unselectNode(e){this._facadeFSM.currentState._unselectNode(e)}querySelection(){return this._facadeFSM.currentState.querySelection()}isSelectNode(e){return this._facadeFSM.currentState.isSelectNode(e)}selectNode(e){this._facadeFSM.currentState.selectNode(e)}unselectNode(e){this._facadeFSM.currentState.unselectNode(e)}clearSelection(){this._facadeFSM.currentState.clearSelection()}registerEffects(e){this._facadeFSM.currentState.registerEffects(e)}removeEffects(e){this._facadeFSM.currentState.removeEffects(e)}onRemoveTerrain(e,t){this._facadeFSM.currentState.onRemoveTerrain(e,t)}createPrefab(e,t){return this._facadeFSM.currentState.createPrefab(e,t)}getPrefabData(e){return this._facadeFSM.currentState.getPrefabData(e)}linkPrefab(e,t){return this._facadeFSM.currentState.linkPrefab(e,t)}unlinkPrefab(e,t){return this._facadeFSM.currentState.unlinkPrefab(e,t)}applyPrefab(e){return this._facadeFSM.currentState.applyPrefab(e)}distributeSelectionUI(e){this._facadeFSM.currentState.distributeSelectionUI(e)}alignSelectionUI(e){this._facadeFSM.currentState.alignSelectionUI(e)}queryParticlePlayInfo(e){return this._facadeFSM.currentState.queryParticlePlayInfo(e)}setParticlePlaySpeed(e,t){this._facadeFSM.currentState.setParticlePlaySpeed(e,t)}changeGameMode(e){this._facadeFSM.currentState.changeGameMode(e)}pauseGameView(e){this._facadeFSM.currentState.pauseGameView(e)}stepGameView(){this._facadeFSM.currentState.stepGameView()}platformGameView(e){this._facadeFSM.currentState.platformGameView(e)}setModelPreviewModel(e){model_preview_1.default.setModel(e)}onModelPreviewMouseDown(e){model_preview_1.default.onMouseDown(e)}onModelPreviewMouseMove(e){model_preview_1.default.onMouseMove(e)}onModelPreviewMouseUp(e){model_preview_1.default.onMouseUp(e)}hideModelPreview(){model_preview_1.default.hide()}setMeshPreviewMesh(e){mesh_preview_1.default.setMesh(e)}onMeshPreviewMouseDown(e){mesh_preview_1.default.onMouseDown(e)}onMeshPreviewMouseMove(e){mesh_preview_1.default.onMouseMove(e)}onMeshPreviewMouseUp(e){mesh_preview_1.default.onMouseUp(e)}hideMeshPreview(){mesh_preview_1.default.hide()}setSkeletonPreviewSkeleton(e){skeleton_preview_1.default.setSkeleton(e)}onSkeletonPreviewMouseDown(e){skeleton_preview_1.default.onMouseDown(e)}onSkeletonPreviewMouseMove(e){skeleton_preview_1.default.onMouseMove(e)}onSkeletonPreviewMouseUp(e){skeleton_preview_1.default.onMouseUp(e)}hideSkeletonPreview(){skeleton_preview_1.default.hide()}updatePhysicsGroup(){this._facadeFSM.currentState.updatePhysicsGroup()}onEngineUpdate(){this._facadeFSM.currentState.onEngineUpdate()}switchGraphicalTools(e){const t=document.querySelector(".captureMenuComponent"),a=document.querySelector(".resultViewComponent");if(e)if(t)t.parentElement.style.display="block",a&&(a.style.display="block");else{(new(require("spectorjs").Spector)).displayUI()}else t.parentElement.style.display="none",a&&(a.style.display="none")}async changeTargetResolution(e){if(e===defaultDesignResolution){const e=await Editor.Profile.getProject("project","general.designResolution");scene_view_data_1.sceneViewData.targetResolution={width:e.width,height:e.height}}else{const t=await Editor.Message.request("device","query");for(let a=0;a<t.length;a++){const r=t[a];r&&r.name===e&&(scene_view_data_1.sceneViewData.targetResolution={width:r.width,height:r.height})}}}regeneratePolygon2DPoints(e){this._facadeFSM.currentState.regeneratePolygon2DPoints(e)}async exportParticlePlist(e){return this._facadeFSM.currentState.exportParticlePlist(e)}}exports.SceneFacadeManager=SceneFacadeManager;