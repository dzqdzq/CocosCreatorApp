"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneFacadeManager=void 0;const scene_facade_state_interface_1=require("./scene-facade-state-interface"),animation_scene_facade_1=__importDefault(require("./animation-scene-facade")),scene_facade_fsm_1=require("./scene-facade-fsm"),camera_1=__importDefault(require("../manager/camera")),node_1=__importDefault(require("../manager/node")),component_1=__importDefault(require("../manager/component")),gizmos_1=__importDefault(require("../manager/gizmos")),asset_1=__importDefault(require("../manager/asset")),prefab_1=__importDefault(require("../manager/prefab")),selection_1=__importDefault(require("../manager/selection")),plugin_1=__importDefault(require("../manager/plugin")),terrain_1=__importDefault(require("../manager/terrain")),engine_1=require("../manager/engine"),operation_1=__importDefault(require("../../public/operation")),shortcut_1=__importDefault(require("../manager/shortcut")),cc_1=require("cc"),scene_1=__importDefault(require("../manager/scene")),preview_play_1=__importDefault(require("../manager/preview-play")),scripts_1=__importDefault(require("../manager/scripts")),effects_1=__importDefault(require("../manager/effects")),unit_test_1=require("../manager/unit-test"),scene_view_data_1=require("../manager/scene-view/scene-view-data"),animation_1=__importDefault(require("../manager/animation")),event_enum_1=require("../../../script/public/event-enum"),message_1=require("../manager/message"),scene_view_1=require("../manager/scene-view"),particle_1=__importDefault(require("../manager/particle")),encode_1=__importDefault(require("../../utils/dump/encode")),decode_1=__importDefault(require("../../utils/dump/decode")),utils_1=__importDefault(require("../../utils/dump/utils")),timer_util_1=require("../utils/timer-util"),lodash=__importStar(require("../../utils/misc")),index_1=__importDefault(require("../manager/thumbnail/index"));let reloadTimer=null;const defaultDesignResolution="__default_design__",cc=__importStar(require("cc")),preview_1=require("../manager/preview"),scene_cache_1=require("../manager/scene/scene-cache"),lod_1=__importDefault(require("../manager/lod"));let isOperating=!1;class SceneFacadeManager{constructor(){this._projectType="3d",this._highQuality=!1}async init(){await this.initManager(),this._facadeFSM=(0,scene_facade_fsm_1.createSceneFacadeFSM)(),this._facadeFSM.start(),this.updatePhysicsGroup(),this.initEventListener()}changeProjectMode(e){this._projectType=e}changeHighQuality(e){this._highQuality=e,cc_1.settings.overrideSettings("rendering","highQualityMode",!0)}async onNativeConfigChange(e){Editor.Metrics._trackEventWithTimer({category:"native-scene",id:"A100002",value:await Editor.Profile.getConfig("scene",e)?1:0}),Editor.Task.addNotice({title:Editor.I18n.t("scene.title"),type:"log",message:Editor.I18n.t("scene.contributions.preferences.scene.on_native_change")})}async initManager(){const e=window.cce;e.Camera=camera_1.default,e.Animation=animation_1.default,e.Scene=scene_1.default,e.Node=node_1.default,e.Script=scripts_1.default,e.Animation=animation_1.default,e.Operation=operation_1.default,e.Gizmo=gizmos_1.default,e.Asset=asset_1.default,e.PreviewPlay=preview_play_1.default,e.Prefab=prefab_1.default,e.Effect=effects_1.default,e.Selection=selection_1.default,e.Shortcut=shortcut_1.default,e.Preview=preview_1.previewMgr,e.Component=component_1.default,e.Terrain=terrain_1.default,e.Plugin=plugin_1.default,e.Engine=engine_1.engineManager,e.NeedAnimState=engine_1.NeedAnimState,e.ModelPreview=preview_1.previewMgr.modelPreview,e.MotionPreview=preview_1.previewMgr.motionPreview,e.TransitionPreview=preview_1.previewMgr.transitionPreview,e.ThumbnailManager=index_1.default,e.Dump={encode:encode_1.default,decode:decode_1.default,utils:utils_1.default},await effects_1.default.init(),camera_1.default.init(),node_1.default.init(),selection_1.default.init(),gizmos_1.default.init(),asset_1.default.init(),prefab_1.default.init(),preview_1.previewMgr.init(),plugin_1.default.init(),particle_1.default.init(),lod_1.default.init(),terrain_1.default.init(),scene_view_1.sceneViewManager.init(),scene_cache_1.sceneCacheManager.init(),index_1.default.init(),engine_1.engineManager.init()}initEventListener(){operation_1.default.on("resize",this.onResize.bind(this)),scene_1.default.on("open",this.onSceneOpened.bind(this)),scene_1.default.on("close",this.onSceneClosed.bind(this)),scene_1.default.on("reload",this.onSceneReload.bind(this)),scene_1.default.on("save",this.onSceneSaved.bind(this)),node_1.default.on("before-change",this.onNodeBeforeChanged.bind(this)),node_1.default.on("change",this.onNodeChanged.bind(this)),node_1.default.on("before-add",this.onBeforeNodeAdded.bind(this)),node_1.default.on("add",this.onAddNode.bind(this)),node_1.default.on("remove",this.onRemoveNode.bind(this)),node_1.default.on("added",this.onNodeAdded.bind(this)),node_1.default.on("removed",this.onNodeRemoved.bind(this)),component_1.default.on("add",this.onAddComponent.bind(this)),component_1.default.on("remove",this.onRemoveComponent.bind(this)),component_1.default.on("added",this.onComponentAdded.bind(this)),component_1.default.on("removed",this.onComponentRemoved.bind(this)),asset_1.default.on("asset-refresh",this.assetRefresh.bind(this)),engine_1.engineManager.on("onUpdate",this.onEngineUpdate.bind(this)),scripts_1.default.on(scripts_1.default.EXECUTION_FINISHED,()=>{scripts_1.default.suspend(Promise.resolve(this.softReloadScene()))})}quitEditorCommand(){return this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.General||(this._facadeFSM.closeScene(),!1)}async openScene(e){let t="cc.SceneAsset";if(e)try{const a=await cce.Ipc.request("query-asset-info",e);a?t=a.type:(console.warn(`Open the previous scene failed: ${e} can not be found.`),e="")}catch(t){console.warn(`Open the previous scene failed: ${e} can not be found.`),e=""}if("cc.Prefab"===t)try{this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Prefab?await this._facadeFSM.currentState.openScene(e):await this._facadeFSM.toPrefab({uuid:e})}catch(t){console.error("open prefab failed",e,t)}else{if("cc.SceneAsset"!==t)return console.error(`can't open asset: ${e} in scene`),!1;try{await this._facadeFSM.closeSceneToGeneral(),await this._facadeFSM.currentState.openScene(e)}catch(t){console.error("open scene failed",e,t)}}return this.resetLightProbeEditMode(),!0}clear(){timer_util_1.TimerUtil.clearTimerAndInterval()}async beforeClose(){const e=plugin_1.default.getScriptModuleMap(),t=Object.keys(e);for(let a=0;a<t.length;a++){const r=e[t[a]];let n=!0;if(r&&r.beforeClose&&(n=await r.beforeClose()),!n)return!1}return await this._facadeFSM.closeSceneToGeneral(),this.clear(),await this._facadeFSM.currentState.closeScene()}async closeScene(){return await this._facadeFSM.closeScene()}async dumpAllScenes(){return this._facadeFSM.dumpAllScenes()}onSceneOpened(e){this._facadeFSM.currentState.onSceneOpened&&this._facadeFSM.currentState.onSceneOpened(e),this.changeTitle()}onSceneReload(e){this._facadeFSM.currentState.onSceneReload&&this._facadeFSM.currentState.onSceneReload(e)}onSceneClosed(e){this._facadeFSM.currentState.onSceneClosed&&this._facadeFSM.currentState.onSceneClosed(e)}onSceneSaved(e){}async restoreAllScenes(e){this._facadeFSM.restoreAllScenes(e)}async saveScene(e=!1){const t=await this._facadeFSM.currentState.saveScene(e);return this.changeTitle(),t}async softReloadScene(e){return await this._facadeFSM.currentState.softReloadScene(e)}async reloadScene(){return await this._facadeFSM.currentState.reloadScene()}async queryNodeTree(e){return await this._facadeFSM.currentState.queryNodeTree(e)}async queryNodesByAssetUuid(e){return node_1.default.queryNodesByAssetUuid(e)}queryNodesMissAsset(){return node_1.default.queryNodesMissAsset()}async querySceneSerializedData(){return await this._facadeFSM.generalSceneFacade.querySceneSerializedData()}async querySceneDirty(){return await this._facadeFSM.currentState.querySceneDirty()}async queryClasses(e){return await this._facadeFSM.currentState.queryClasses(e)}async queryComponents(){return await this._facadeFSM.currentState.queryComponents()}async queryComponentHasScript(e){return await this._facadeFSM.currentState.queryComponentHasScript(e)}async queryLayerBuiltin(){return await this._facadeFSM.currentState.queryLayerBuiltin()}async querySortingLayerBuiltin(){return await this._facadeFSM.currentState.querySortingLayerBuiltin()}queryMode(){return this._facadeFSM.currentState.queryMode()}queryCurrentSceneUuid(){return this._facadeFSM.currentState.queryCurrentSceneUuid()}onResize(e){this._facadeFSM.currentState.onResize&&this._facadeFSM.currentState.onResize(e)}async queryNodeDump(e){const t=await this._facadeFSM.currentState.queryNodeDump(e);return"2d"===this._projectType&&t&&("position"in t&&(t.position.lock={z:{default:0,message:"i18n:scene.is3DValueWarn"}}),"rotation"in t&&(t.rotation.lock={x:{default:0,message:"i18n:scene.is3DValueWarn"},y:{default:0,message:"i18n:scene.is3DValueWarn"}}),"scale"in t&&(t.scale.lock={z:{default:1,message:"i18n:scene.is3DValueWarn"}})),t}async setNodeProperty(e){return await this._facadeFSM.currentState.setNodeProperty(e)}async resetNode(e){return await this._facadeFSM.currentState.resetNode(e)}async resetNodeProperty(e){return await this._facadeFSM.currentState.resetNodeProperty(e)}async previewSetNodeProperty(e){return await this._facadeFSM.currentState.previewSetNodeProperty(e)}async cancelPreviewSetNodeProperty(e){return await this._facadeFSM.currentState.cancelPreviewSetNodeProperty(e)}async updateNodePropertyFromNull(e){return await this._facadeFSM.currentState.updateNodePropertyFromNull(e)}setNodeAndChildrenLayer(e){return this._facadeFSM.currentState.setNodeAndChildrenLayer(e)}moveNodeArrayElement(e){return this._facadeFSM.currentState.moveNodeArrayElement(e)}removeNodeArrayElement(e){return this._facadeFSM.currentState.removeNodeArrayElement(e)}async generateNodeAvailableName(e,t){return await this._facadeFSM.currentState.generateNodeAvailableName(e,t)}selectAllNodes(){this._facadeFSM.currentState.selectAllNodes()}copyNode(e){e||(e=this.querySelection());const t={type:"copy",uuids:this._facadeFSM.currentState.copyNode(e),projectPath:Editor.Project.path};return Editor.Clipboard.write("nodes-info",t),t.uuids}duplicateNode(e){let t=[];try{if(isOperating)return t;if(isOperating=!0,this._facadeFSM.currentState.queryLightProbeEditMode())this.duplicateCurrentSelectedProbes();else{const a=!e;a&&(this.snapshot(),e=this.querySelection()),t=this._facadeFSM.currentState.duplicateNode(e)||[],this.clearSelection(),t.forEach(e=>{e&&this.selectNode(e)}),a&&this.snapshot()}}catch(e){console.error(e)}return isOperating=!1,t}duplicateCurrentSelectedProbes(){this._facadeFSM.currentState.duplicateCurrentSelectedProbes()}removeCurrentSelectedProbes(){this._facadeFSM.currentState.removeCurrentSelectedProbes()}lightProbeInfoChanged(){this._facadeFSM.currentState.lightProbeInfoChanged()}cutNode(e){e||(e=this.querySelection());const t={type:"cut",uuids:e,projectPath:Editor.Project.path};Editor.Clipboard.write("nodes-info",t)}async pasteNode(e){let t=[],a=!1;try{if(isOperating)return t;isOperating=!0;const r=!e;if(r){this.snapshot();const r=this.querySelection()[0],n=Editor.Clipboard.read("nodes-info");if(!n)return isOperating=!1,t;const{type:i,uuids:c}=n;if("cut"===i){let e=!1;if(c.every(t=>{if(r===t)return console.warn(Editor.I18n.t("scene.messages.cannot_cut_to_self")),e=!0,!1}),e)return isOperating=!1,t;t=await this.setNodeParent({parent:r,uuids:c,keepWorldTransform:!1}),a=!0,Editor.Clipboard.clear()}e={target:r,uuids:c,keepWorldTransform:!1}}t=a?t:await this._facadeFSM.currentState.pasteNode(e),r&&this.snapshot()}catch(e){console.error(e)}return cce.Selection.clear(),t.forEach(e=>{e&&this.selectNode(e)}),isOperating=!1,t}async setNodeParent(e){return await this._facadeFSM.currentState.setNodeParent(e)}async createNode(e){console.time("createNode");const t=await this._facadeFSM.currentState.createNode(e);return console.timeEnd("createNode"),t}removeNode(e){if(isOperating)return;if(this._facadeFSM.currentState.queryLightProbeEditMode())return void this._facadeFSM.currentState.removeCurrentSelectedProbes();isOperating=!0;const t=!e;if(t){this.snapshot(),e={uuid:this.querySelection()},cce.Selection.clear()}console.time("removeNode"),this._facadeFSM.currentState.removeNode(e),console.timeEnd("removeNode"),isOperating=!1,t&&this.snapshot()}async changeNodeLock(e,t,a){return await this._facadeFSM.currentState.changeNodeLock(e,t,a)}async restorePrefab(e,t){return await this._facadeFSM.currentState.restorePrefab(e,t)}onNodeBeforeChanged(e){}onNodeChanged(e,t){this._facadeFSM.currentState.onNodeChanged&&this._facadeFSM.currentState.onNodeChanged(e,t),t&&t.type===event_enum_1.NodeEventType.SIZE_CHANGED&&e.getComponent(cc_1.Canvas)&&scene_view_data_1.sceneViewData.targetDeviceName===defaultDesignResolution&&this.changeTargetResolution(defaultDesignResolution),message_1.messageManager.broadcastChangeNodeMsg(e.uuid)}onBeforeNodeAdded(e){}onAddNode(e){this._facadeFSM.currentState.onAddNode&&this._facadeFSM.currentState.onAddNode(e)}onRemoveNode(e){this._facadeFSM.currentState.onRemoveNode&&this._facadeFSM.currentState.onRemoveNode(e)}onNodeAdded(e,t={}){this._facadeFSM.currentState.onNodeAdded&&this._facadeFSM.currentState.onNodeAdded(e,t),message_1.messageManager.broadcast("scene:add-node",e.uuid)}onNodeRemoved(e,t={}){this._facadeFSM.currentState.onNodeRemoved&&this._facadeFSM.currentState.onNodeRemoved(e,t),message_1.messageManager.broadcast("scene:remove-node",e.uuid)}async queryComponent(e){return await this._facadeFSM.currentState.queryComponent(e)}async queryComponentFunctionOfNode(e){return await this._facadeFSM.currentState.queryComponentFunctionOfNode(e)}createComponent(e){this._facadeFSM.currentState.createComponent(e)}resetComponent(e){this._facadeFSM.currentState.resetComponent(e)}removeComponent(e){this._facadeFSM.currentState.removeComponent(e)}async executeComponentMethod(e){return await this._facadeFSM.currentState.executeComponentMethod(e)}async executeSceneScriptMethod(e){return await this._facadeFSM.currentState.executeSceneScriptMethod(e)}onAddComponent(e){this._facadeFSM.currentState.onAddComponent&&this._facadeFSM.currentState.onAddComponent(e)}onRemoveComponent(e){this._facadeFSM.currentState.onRemoveComponent&&this._facadeFSM.currentState.onRemoveComponent(e)}onComponentAdded(e,t={}){this._facadeFSM.currentState.onComponentAdded&&this._facadeFSM.currentState.onComponentAdded(e,t),message_1.messageManager.broadcast("scene:component-added",e.uuid)}onComponentRemoved(e,t={}){this._facadeFSM.currentState.onComponentRemoved&&this._facadeFSM.currentState.onComponentRemoved(e,t),message_1.messageManager.broadcast("scene:component-removed",e.uuid)}async snapshot(e){this._facadeFSM.currentState.snapshot(e),this.changeTitle()}async abortSnapshot(){this._facadeFSM.currentState.abortSnapshot(),this.changeTitle()}async undo(){await this._facadeFSM.currentState.undo(),this.changeTitle()}async redo(){await this._facadeFSM.currentState.redo(),this.changeTitle()}recordNode(e,t=!0){t&&this._facadeFSM.currentState.recordNode(e,t)}async changeTitle(){if(!isPreviewProcess&&(this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.General||this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Prefab)){const e=await this._facadeFSM.currentState.querySceneDirty();message_1.messageManager.IpcSend("change-title",this._facadeFSM.currentState.queryCurrentSceneUuid(),e)}}async queryAllEffects(){return this._facadeFSM.currentState.queryAllEffects()}async queryMaterial(e){return this._facadeFSM.currentState.queryMaterial(e)}async queryEffect(e){return this._facadeFSM.currentState.queryEffect(e)}async queryRenderPipeline(e){return this._facadeFSM.currentState.queryRenderPipeline(e)}previewMaterial(e,t,a){this._facadeFSM.currentState.previewMaterial(e,t,a)}applyMaterial(e,t){this._facadeFSM.currentState.applyMaterial(e,t)}async changePhysicsMaterial(e){return await this._facadeFSM.currentState.changePhysicsMaterial(e)}async applyPhysicsMaterial(e){await this._facadeFSM.currentState.applyPhysicsMaterial(e)}async changeAnimationGraphVariant(e){return await this._facadeFSM.currentState.changeAnimationGraphVariant(e)}async applyAnimationGraphVariant(e){await this._facadeFSM.currentState.applyAnimationGraphVariant(e)}async changeAnimationMask(e){return await this._facadeFSM.currentState.changeAnimationMask(e)}async applyAnimationMask(e){await this._facadeFSM.currentState.applyAnimationMask(e)}async applyRenderTexture(e,t){await this._facadeFSM.currentState.applyRenderTexture(e,t)}async changeRenderPipeline(e){return await this._facadeFSM.currentState.changeRenderPipeline(e)}async applyRenderPipeline(e,t){await this._facadeFSM.currentState.applyRenderPipeline(e,t)}queryPhysicsMaterial(e){return this._facadeFSM.currentState.queryPhysicsMaterial(e)}queryAnimationGraphVariant(e){return this._facadeFSM.currentState.queryAnimationGraphVariant(e)}queryAnimationMask(e){return this._facadeFSM.currentState.queryAnimationMask(e)}queryCreatableAssetTypes(){return this._facadeFSM.currentState.queryCreatableAssetTypes()}async assetChange(e,t,a){e===this._facadeFSM.generalSceneFacade.queryCurrentSceneUuid()&&(this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.General?await this._facadeFSM.currentState.reloadScene():(await this._facadeFSM.closeSceneToGeneral(),await this._facadeFSM.currentState.reloadScene())),e===this._facadeFSM.prefabSceneFacade.queryCurrentSceneUuid()&&this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Prefab&&await this._facadeFSM.currentState.reloadScene(),this._facadeFSM.currentState.assetChange(e,t,a),index_1.default.assetChange(e,t,a)}assetDelete(e,t){this._facadeFSM.currentState.assetDelete(e,t),index_1.default.assetDelete(e,t)}assetRefresh(e){this._facadeFSM.currentState.assetRefresh(e),engine_1.engineManager.repaintInEditMode()}releaseAsset(e){asset_1.default.releaseAsset(e)}async gizmoRefreshConfig(){return await this._facadeFSM.currentState.gizmoRefreshConfig()}async queryGizmoToolName(){return await this._facadeFSM.currentState.queryGizmoToolName()}async queryGizmoPivot(){return await this._facadeFSM.currentState.queryGizmoPivot()}async queryGizmoCoordinate(){return await this._facadeFSM.currentState.queryGizmoCoordinate()}async queryIs2D(){return await this._facadeFSM.currentState.queryIs2D()}queryIsIconGizmo3D(){return this._facadeFSM.currentState.queryIsIconGizmo3D()}queryIconGizmoSize(){return this._facadeFSM.currentState.queryIconGizmoSize()}updateInnerTetrahedron(){this._facadeFSM.currentState.updateInnerTetrahedron()}setTransformToolName(e){this._facadeFSM.currentState.setTransformToolName(e)}setPivot(e){this._facadeFSM.currentState.setPivot(e)}setCoordinate(e){this._facadeFSM.currentState.setCoordinate(e)}setIs2D(e){this._facadeFSM.currentState.setIs2D(e)}setIconGizmo3D(e){this._facadeFSM.currentState.setIconGizmo3D(e)}setIconGizmoSize(e){this._facadeFSM.currentState.setIconGizmoSize(e)}queryTransformSnapConfigs(){return gizmos_1.default.queryTransformSnapConfigs()}setTransformSnapConfigs(e,t){gizmos_1.default.setTransformSnapConfigs(e,t)}queryRectSnappingConfigs(){return gizmos_1.default.queryRectSnappingConfigs()}setRectSnappingConfigs(e,t){gizmos_1.default.setRectSnappingConfigs(e,t)}focus(e=null,t,a,r,n=!1){this._facadeFSM.currentState.focus(e,t,a,r,n)}alignNodeToSceneView(e){this._facadeFSM.currentState.alignNodeToSceneView(e)}queryIsGridVisible(){return this._facadeFSM.currentState.queryIsGridVisible()}setGridVisible(e){this._facadeFSM.currentState.setGridVisible(e)}alignWithView(){this._facadeFSM.currentState.alignWithView()}alignViewWithNode(){this._facadeFSM.currentState.alignViewWithNode()}setGridLineColor(e){this._facadeFSM.currentState.setGridLineColor(e)}getCameraProperty(){return this._facadeFSM.currentState.getCameraProperty()}setCameraProperty(e){this._facadeFSM.currentState.setCameraProperty(e)}getCameraWheelSpeed(){return this._facadeFSM.currentState.getCameraWheelSpeed()}setCameraWheelSpeed(e){this._facadeFSM.currentState.setCameraWheelSpeed(e)}getCameraWanderSpeed(){return this._facadeFSM.currentState.getCameraWanderSpeed()}setCameraWanderSpeed(e){this._facadeFSM.currentState.setCameraWanderSpeed(e)}setCameraEnableAcceleration(e){camera_1.default.setEnableAcceleration(e)}getCameraEnableAcceleration(){return camera_1.default.getEnableAcceleration()}zoomSceneViewUp(){this._facadeFSM.currentState.zoomSceneViewUp()}zoomSceneViewDown(){this._facadeFSM.currentState.zoomSceneViewDown()}resetSceneViewZoom(){this._facadeFSM.currentState.resetSceneViewZoom()}queryCurrentAnimationState(){return this._facadeFSM.currentState.queryCurrentAnimationState()}queryCurrentAnimationInfo(){return this._facadeFSM.currentState.queryCurrentAnimationInfo()}queryAnimationRootNode(e){return this._facadeFSM.currentState.queryAnimationRootNode(e)}queryAnimationRootInfo(e){return this._facadeFSM.currentState.queryAnimationRootInfo(e)}queryAnimationClipDump(e,t){return this._facadeFSM.currentState.queryAnimationClipDump(e,t)}queryAnimationProperties(e){return this._facadeFSM.currentState.queryAnimationProperties(e)}queryAnimationClipsInfo(e){return this._facadeFSM.currentState.queryAnimationClipsInfo(e)}queryAnimationClipCurrentTime(e){return this._facadeFSM.currentState.queryAnimationClipCurrentTime(e)}queryAnimationPropValueAtFrame(e,t,a,r){return this._facadeFSM.currentState.queryAnimationPropValueAtFrame(e,t,a,r)}async recordAnimation(e,t,a){if(t)this._facadeFSM.toAnimation({uuid:e,clipUuid:a});else{const e=this._facadeFSM.currentState;!t&&e instanceof animation_scene_facade_1.default&&await this._facadeFSM.closeScene()}return!0}async changeAnimationRootNode(e,t){return await this._facadeFSM.currentState.changeAnimationRootNode(e,t)}async setCurEditTime(e){return await this._facadeFSM.currentState.setCurEditTime(e)}async changeClipState(e,t){return await this._facadeFSM.currentState.changeClipState(e,t)}async setEditClip(e){return await this._facadeFSM.currentState.setEditClip(e)}async saveClip(){return await this._facadeFSM.currentState.saveClip()}async applyAnimationOperation(e){return await this._facadeFSM.currentState.applyAnimationOperation(e)}queryAnimationNodeEditInfo(e){return this._facadeFSM.currentState.queryAnimationNodeEditInfo(e)}queryEnumListWithPath(e){const t=lodash.get(cc,e);return t?cc_1.Enum.getList(t):null}reloadAfterScriptChanged(){cc.director.getScene()&&(clearTimeout(reloadTimer),reloadTimer=setTimeout(()=>{this.softReloadScene()},200))}async queryScriptName(e){return await this._facadeFSM.currentState.queryScriptName(e)}async queryScriptCid(e){return await this._facadeFSM.currentState.queryScriptCid(e)}async loadScript(e){return await this._facadeFSM.currentState.loadScript(e)}async removeScript(e){return await this._facadeFSM.currentState.removeScript(e)}async scriptChange(e){return await this._facadeFSM.currentState.scriptChange(e)}async investigatePackerDriver(){Editor.Metrics.trackTimeStart("[Metrics]import preject scripts");const e=await scripts_1.default.investigatePackerDriver();return Editor.Metrics.trackTimeEnd("[Metrics]import preject scripts",{output:!0}),e}_selectNode(e){this._facadeFSM.currentState._selectNode(e)}_unselectNode(e){this._facadeFSM.currentState._unselectNode(e)}querySelection(){return this._facadeFSM.currentState.querySelection()}isSelectNode(e){return this._facadeFSM.currentState.isSelectNode(e)}selectNode(e){this._facadeFSM.currentState.selectNode(e)}unselectNode(e){this._facadeFSM.currentState.unselectNode(e)}clearSelection(){this._facadeFSM.currentState.clearSelection()}registerEffects(e){this._facadeFSM.currentState.registerEffects(e)}removeEffects(e){this._facadeFSM.currentState.removeEffects(e)}updateEffect(e){this._facadeFSM.currentState.updateEffect(e)}onRemoveTerrain(e,t){this._facadeFSM.currentState.onRemoveTerrain(e,t)}createPrefab(e,t){return this._facadeFSM.currentState.createPrefab(e,t)}getPrefabData(e){return this._facadeFSM.currentState.getPrefabData(e)}linkPrefab(e,t){return this._facadeFSM.currentState.linkPrefab(e,t)}unlinkPrefab(e,t){return this._facadeFSM.currentState.unlinkPrefab(e,t)}async applyPrefab(e){return await this._facadeFSM.currentState.applyPrefab(e)}applyRemovedComponent(e,t){return prefab_1.default.applyRemovedComponent(e,t)}revertRemovedComponent(e,t){return prefab_1.default.revertRemovedComponent(e,t)}distributeSelectionUI(e){this._facadeFSM.currentState.distributeSelectionUI(e)}alignSelectionUI(e){this._facadeFSM.currentState.alignSelectionUI(e)}queryParticlePlayInfo(e){return this._facadeFSM.currentState.queryParticlePlayInfo(e)}setParticlePlaySpeed(e,t){this._facadeFSM.currentState.setParticlePlaySpeed(e,t)}playParticle(){this._facadeFSM.currentState.playParticle()}restartParticle(){this._facadeFSM.currentState.restartParticle()}pauseParticle(){this._facadeFSM.currentState.pauseParticle()}stopParticle(){this._facadeFSM.currentState.stopParticle()}applyCurrentCameraSize(e){return this._facadeFSM.currentState.applyCurrentCameraSize(e)}insertLOD(e,...t){this._facadeFSM.currentState.insertLOD(e,...t)}eraseLOD(e,...t){this._facadeFSM.currentState.eraseLOD(e,...t)}async changePreviewPlayState(e,t=""){await this._facadeFSM.closeSceneToGeneral(),e&&await this._facadeFSM.toPreview({sceneJson:t})}async callPreviewPlayMethod(e,...t){if(this._facadeFSM.currentState.modeName===scene_facade_state_interface_1.SceneModeType.Preview){const a=this._facadeFSM.currentState;return await a.callPreviewPlayMethod(e,...t)}}updatePhysicsGroup(){this._facadeFSM.currentState.updatePhysicsGroup()}onEngineUpdate(){this._facadeFSM.currentState.onEngineUpdate()}switchGraphicalTools(e){const t=document.querySelector(".captureMenuComponent"),a=document.querySelector(".resultViewComponent");if(e)if(t)t.parentElement&&(t.parentElement.style.display="block"),a&&(a.style.display="block");else{(new(require("spectorjs").Spector)).displayUI()}else(null===t||void 0===t?void 0:t.parentElement)&&(t.parentElement.style.display="none"),a&&(a.style.display="none")}async changeTargetResolution(e){if(e===defaultDesignResolution){const t=await Editor.Profile.getProject("project","general.designResolution");t&&(scene_view_data_1.sceneViewData.targetResolution={width:t.width,height:t.height},scene_view_data_1.sceneViewData.targetDeviceName=e)}else{const t=await Editor.Message.request("device","query");if(t)for(let a=0;a<t.length;a++){const r=t[a];r&&r.name===e&&(scene_view_data_1.sceneViewData.targetResolution={width:r.width,height:r.height},scene_view_data_1.sceneViewData.targetDeviceName=e)}}}regeneratePolygon2DPoints(e){this._facadeFSM.currentState.regeneratePolygon2DPoints(e)}async exportParticlePlist(e){return this._facadeFSM.currentState.exportParticlePlist(e)}async unitTest(e){return unit_test_1.unitTestMgr.test(this,e)}setSceneLightOn(e){scene_view_1.sceneViewManager.setSceneLightOn(e)}querySceneLightOn(){return scene_view_1.sceneViewManager.querySceneLightOn()}changeSceneViewVisible(e){scene_view_1.sceneViewManager.isVisible=e}async queryPreviewData(e,t){return await preview_1.previewMgr.queryPreviewData(e,t)}async callPreviewFunction(e,t,a){return await preview_1.previewMgr.callPreviewFunction(e,t,...a)}async queryThumbnail(e,t=[]){return await index_1.default.queryThumbnail(e,t)}getCurrentFacade(){return this._facadeFSM.currentState}async changeDebugOption(e,t){switch(e){case"single":cc.director.root.debugView.singleMode=t;break;case"composite":1e4===(null===t||void 0===t?void 0:t.key)?cc.director.root.debugView.enableAllCompositeMode(t.value):cc.director.root.debugView.enableCompositeMode(t.key,null===t||void 0===t?void 0:t.value);break;case"LIGHTING_WITH_BASE_COLOR":cc.director.root.debugView.lightingWithAlbedo=t;break;case"CSM_LAYER_COLORATION":cc.director.root.debugView.csmLayerColoration=t}cce.Engine.repaintInEditMode()}unregisterPreview(){preview_1.previewMgr.unregisterPreview()}registerPreview(){preview_1.previewMgr.registerPreview()}forceUpdatePlugin(){cce.Plugin.forceUpdatePlugin()}async syncAfterExitEditorPreview(){await this.gizmoRefreshConfig();const e=await Editor.Profile.getConfig("scene","camera.size");this.changeTargetResolution(e)}resetLightProbeEditMode(){this.toggleLightProbeEditMode(!1),this.toggleLightProbeBoundingBoxEditMode(!1),cce.Gizmo.lightProbeEditModeChanged(!1),cce.Gizmo.boundingBoxEditModeChanged(!1)}toggleLightProbeEditMode(e){return this._facadeFSM.currentState.toggleLightProbeEditMode(e)}queryLightProbeEditMode(){return this._facadeFSM.currentState.queryLightProbeEditMode()}toggleLightProbeBoundingBoxEditMode(e){return this._facadeFSM.currentState.toggleLightProbeBoundingBoxEditMode(e)}queryLightProbeBoundingBoxEditMode(){return this._facadeFSM.currentState.queryLightProbeBoundingBoxEditMode()}}exports.SceneFacadeManager=SceneFacadeManager;