"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GeneralSceneFacade=void 0;const scene_facade_state_interface_1=require("./scene-facade-state-interface"),scene_1=__importDefault(require("../manager/scene")),camera_1=__importDefault(require("../manager/camera")),node_1=__importDefault(require("../manager/node")),component_1=__importDefault(require("../manager/component")),asset_1=__importDefault(require("../manager/asset")),gizmos_1=__importDefault(require("../manager/gizmos")),animation_1=__importDefault(require("../manager/animation")),scripts_1=__importDefault(require("../manager/scripts")),preview_1=require("../manager/preview"),selection_1=__importDefault(require("../manager/selection")),effects_1=__importDefault(require("../manager/effects")),terrain_1=__importDefault(require("../manager/terrain")),general_scene_proxy_1=__importDefault(require("../manager/scene/proxy/general-scene-proxy")),prefab_1=__importDefault(require("../manager/prefab")),lod_1=__importDefault(require("../manager/lod")),engine_1=require("../manager/engine"),plugin_1=__importDefault(require("../manager/plugin")),ui_1=__importDefault(require("../manager/ui")),particle_1=__importDefault(require("../manager/particle")),physics_2d_1=__importDefault(require("../manager/physics-2d")),particle_2d_1=__importDefault(require("../manager/particle-2d")),message_1=require("../manager/message"),scene_view_1=require("../manager/scene-view"),time_1=__importDefault(require("../manager/engine/time")),index_1=require("../../export/undo/index"),doNotSupportFunc="don't support this function in current mode";let isOperating=!1;class GeneralSceneFacade{constructor(){this._sceneMgr=scene_1.default,this._cameraMgr=camera_1.default,this._nodeMgr=node_1.default,this._compMgr=component_1.default,this._assetMgr=asset_1.default,this._gizmoMgr=gizmos_1.default,this._materialPreviewMgr=preview_1.previewMgr.materialPreview,this._miniPreviewMgr=preview_1.previewMgr.miniPreview,this._scriptMgr=scripts_1.default,this._previewMgr=preview_1.previewMgr,this._animationMgr=animation_1.default,this._selectionMgr=selection_1.default,this._effectMgr=effects_1.default,this._terrainMgr=terrain_1.default,this._prefabMgr=prefab_1.default,this._engineMgr=engine_1.engineManager,this._pluginMgr=plugin_1.default,this._uiMgr=ui_1.default,this._particleMgr=particle_1.default,this._lodMgr=lod_1.default,this._modelPreviewMgr=preview_1.previewMgr.modelPreview,this._meshPreviewMgr=preview_1.previewMgr.meshPreview,this._physics2DMgr=physics_2d_1.default,this._particle2DMgr=particle_2d_1.default,this._recycleNode={},this._recycleComponent={},this._undoMgr=new index_1.SceneUndoManager,this.isHold=!1,this.modeName=scene_facade_state_interface_1.SceneModeType.General,this.closeSceneWhenExit=!1,this._sceneEventListener=[],this._lightProbeEditModeListener=[],this._lightProbeEditMode=!1,this._lightProbeBoundingBoxEditMode=!1}set lightProbeEditMode(e){e!==this._lightProbeEditMode&&(this._lightProbeEditMode=e,e&&(this.lightProbeBoundingBoxEditMode=!1),this.lightProbeEditModeChanged(e))}get lightProbeEditMode(){return this._lightProbeEditMode}set lightProbeBoundingBoxEditMode(e){e!==this._lightProbeBoundingBoxEditMode&&(this._lightProbeBoundingBoxEditMode=e,e&&(this.lightProbeEditMode=!1),this.boundingBoxEditModeChanged(e))}get lightProbeBoundingBoxEditMode(){return this._lightProbeBoundingBoxEditMode}init(){this.modeName=scene_facade_state_interface_1.SceneModeType.General,this._sceneProxy=new general_scene_proxy_1.default(this._sceneMgr,this),this._undoMgr.init(),this.initEventListener()}initEventListener(){this._sceneEventListener.push(this._nodeMgr),this._sceneEventListener.push(this._gizmoMgr),this._sceneEventListener.push(this._particleMgr),this._sceneEventListener.push(this._cameraMgr),this._sceneEventListener.push(this._prefabMgr),this._sceneEventListener.push(this._miniPreviewMgr),this._sceneEventListener.push(this._previewMgr.scenePreview),this._sceneEventListener.push(this._engineMgr),this._sceneEventListener.push(this._pluginMgr),this._sceneEventListener.push(this._assetMgr),this._sceneEventListener.push(scene_view_1.sceneViewManager),this._sceneEventListener.push(this._lodMgr),this.registerLightProbeEditModeListener(this._gizmoMgr)}registerLightProbeEditModeListener(e){this._lightProbeEditModeListener.push(e)}async enter(e){if(console.debug("enter general scene facade"),void 0!==e.uuid&&null!==e.uuid&&await this.openScene(e.uuid),this.fromState){this.snapshot(),await this.fromState.patchSceneState()?(this.snapshot(),cce.SceneFacadeManager.changeTitle()):this.abortSnapshot()}Editor.EditMode.enter(this.modeName.toLocaleLowerCase()),this._sceneProxy.sendModeChangeMsg(this.modeName)}resetUndo(){this._undoMgr.reset(),this._recycleComponent={},this._recycleNode={}}async exit(){this._sceneProxy.storeScenePrefabUUID(),console.debug("exit general scene facade")}setCloseSceneWhenExit(){this.closeSceneWhenExit=!0}async checkToClose(){return await this._sceneProxy.checkClose()}async closeSceneState(){return!this.closeSceneWhenExit||(this.closeSceneWhenExit=!1,await this._sceneProxy.close())}async stagingSceneState(){return this._stagingCameraInfo=this._cameraMgr.getCurCameraInfo(),await this._sceneProxy.staging()}fireCloseEvent(){this._sceneMgr.sendSceneCloseMsg(cc.director.getScene())}async openScene(e){var t,r,i,n;Editor.Metrics.trackTimeStart("[Metrics]general-scene-open");let a=!1;if(this.isHold&&e===this.queryCurrentSceneUuid()){await this._sceneProxy.restore();(null===(t=this.fromState)||void 0===t?void 0:t.modeName)===scene_facade_state_interface_1.SceneModeType.Prefab&&this._stagingCameraInfo&&this._cameraMgr.focus(null,null===(r=this._stagingCameraInfo)||void 0===r?void 0:r.position,null===(i=this._stagingCameraInfo)||void 0===i?void 0:i.rotation,null===(n=this._stagingCameraInfo)||void 0===n?void 0:n.viewCenter,!0),this.isHold=!1,a=!0}else if(a=await this._sceneProxy.open(e)){this._stagingCameraInfo=null;const t=await Editor.Profile.getConfig("scene",`camera-infos.${e}`);this._cameraMgr.focus(null,null===t||void 0===t?void 0:t.position,null===t||void 0===t?void 0:t.rotation,null===t||void 0===t?void 0:t.viewCenter)}return Editor.Metrics.trackTimeEnd("[Metrics]general-scene-open",{output:!0}),a}async closeScene(){if(await this._sceneProxy.checkClose()){const e=await this._sceneProxy.close();return this._sceneProxy.sendModeChangeMsg(scene_facade_state_interface_1.SceneModeType.Unset),e}return!1}async saveScene(e){return await this._sceneProxy.save(e)}dumpSceneState(){return this._sceneProxy.serialize()}async patchSceneState(){return await this._sceneProxy.patch()}async restoreSceneState(e){return await this._sceneProxy.restore(e)}async softReloadScene(e){const t=await this._sceneProxy.softReload(e);return this._sceneMgr.emit("soft-reload",t),t}async reloadScene(){return await this._sceneProxy.reload()}async queryNodeTree(e){return await this._sceneMgr.queryNodeTree(e)}async queryNodesByAssetUuid(e){}async querySceneSerializedData(){return await this._sceneProxy.serialize()}async querySceneDirty(){return this._undoMgr.isDirty()}async queryClasses(e){return await this._sceneMgr.queryClasses(e)}async queryComponents(){return await this._sceneMgr.queryComponents()}async queryComponentHasScript(e){return await this._sceneMgr.queryComponentHasScript(e)}async queryLayerBuiltin(){return await this._sceneMgr.queryLayerBuiltin()}async querySortingLayerBuiltin(){return await this._sceneMgr.querySortingLayerBuiltin()}queryMode(){return this.modeName}queryCurrentSceneUuid(){return this._sceneProxy.queryCurrentSceneUuid()}dispatchEvents(e,...t){this._sceneEventListener.forEach(r=>{r&&r[e]&&r[e].apply(r,t)})}onSceneOpened(e){this.dispatchEvents("onSceneOpened",e)}onSceneReload(e){this.dispatchEvents("onSceneReload",e)}onSceneClosed(e){this.dispatchEvents("onSceneClosed",e)}onResize(e){this.dispatchEvents("onResize",e)}queryRecycleNode(e){var t;return null!==(t=this._recycleNode[e])&&void 0!==t?t:null}queryRecycleComponent(e){var t;return null!==(t=this._recycleComponent[e])&&void 0!==t?t:null}async queryNodeDump(e){return await this._nodeMgr.queryDump(e)}async queryComponentFunctionOfNode(e){return await this._nodeMgr.queryComponentFunctionOfNode(e)}async previewSetNodeProperty(e){return await this._nodeMgr.previewSetNodeProperty(e.uuid,e.path,e.dump)}async cancelPreviewSetNodeProperty(e){return await this._nodeMgr.cancelPreviewSetNodeProperty(e.uuid,e.path)}async setNodeProperty(e){return await this._nodeMgr.setProperty(e.uuid,e.path,e.dump)}async resetNode(e){return await this._nodeMgr.resetNode(e)}async resetNodeProperty(e){return await this._nodeMgr.resetProperty(e.uuid,e.path)}async updateNodePropertyFromNull(e){return await this._nodeMgr.updatePropertyFromNull(e.uuid,e.path)}async setNodeAndChildrenLayer(e){return await this._nodeMgr.setNodeAndChildrenLayer(e.uuid,e.dump)}async moveNodeArrayElement(e){return!("children"===e.path&&!this._prefabMgr.canModifySibling(e.uuid,e.target,e.offset))&&this._nodeMgr.moveArrayElement(e.uuid,e.path,e.target,e.offset)}async removeNodeArrayElement(e){return this._nodeMgr.removeArrayElement(e.uuid,e.path,e.index)}async generateNodeAvailableName(e,t){return this._nodeMgr.generateAvailableName(e,t)}selectAllNodes(){this.lightProbeEditMode&&this._gizmoMgr.selectAllLightProbes()}copyNode(e){return this._nodeMgr.copyNode(e)}duplicateNode(e){let t=[];if(isOperating)return t;if(this.queryLightProbeEditMode())this.duplicateCurrentSelectedProbes();else{!e&&(e=this.querySelection());const r=[];(Array.isArray(e)?e:[e]).forEach(e=>{var t;const i=this._nodeMgr.query(e),n=this._nodeMgr.getNewNodeParent(null===(t=null===i||void 0===i?void 0:i.parent)||void 0===t?void 0:t.uuid);n&&!r.includes(n.uuid)&&r.push(n.uuid)});const i=this.beginRecording(r);t=this._nodeMgr.duplicateNode(e),this.endRecording(i),this.clearSelection(),t.forEach(e=>{e&&this.selectNode(e)})}return t}async pasteNode(e){let t=[],r=!1;if(isOperating)return t;if(this.queryLightProbeEditMode())this.duplicateCurrentSelectedProbes();else{if(!e){const i=this.querySelection()[0],n=Editor.Clipboard.read("nodes-info");if(!n)return t;const{type:a,uuids:s}=n;if("cut"===a){let e=!1;if(s.every(t=>{if(i===t)return console.warn(Editor.I18n.t("scene.messages.cannot_cut_to_self")),e=!0,!1}),e)return t;isOperating=!0;const n=this.beginRecording(i);t=await this.setNodeParent({parent:i,uuids:s,keepWorldTransform:!1}),this.endRecording(n),r=!0,Editor.Clipboard.clear()}e={target:i,uuids:s,keepWorldTransform:!1}}if(isOperating=!0,!r){let r=e.target;if(!e.pasteAsChild){const t=await this.queryNodeDump(e.target);t&&t.parent&&(r=t.parent.value.uuid)}const i=this.beginRecording(r);t=await this._nodeMgr.pasteNode(r,e.uuids,e.keepWorldTransform),this.endRecording(i)}cce.Selection.clear(),t.forEach(e=>{e&&this.selectNode(e)}),isOperating=!1}return t}async setNodeParent(e){const t=this._prefabMgr.filterChildOfPrefabAssetWhenSetParent(e.uuids);return!t||t.length<=0?t:this._nodeMgr.setParent(e.parent,t,e.keepWorldTransform)}async createNode(e){return(e=e||{}).nameIncrease&&(e.name=await this.generateNodeAvailableName(e.name||"Node",e.parent)),e.assetUuid?await this._nodeMgr.createNodeFromAsset(e.parent,e.assetUuid,e):this._nodeMgr.createNode(e.parent,e.name||"",null,e.keepWorldTransform)}async removeNode(e){if(isOperating)return;if(this.queryLightProbeEditMode())return void(e?console.warn(Editor.I18n.t("scene.contributions.messages.description.light_probe_delete_when_editing_probe")):this.removeCurrentSelectedProbes());if(!e){e={uuid:this.querySelection()},cce.Selection.clear()}const t=this._prefabMgr.filterChildOfPrefabAssetWhenRemoveNode(e.uuid),r=[];t.forEach(e=>{const t=this._nodeMgr.query(e),i=null===t||void 0===t?void 0:t.parent;i&&!r.includes(i.uuid)&&r.push(i.uuid)});const i=this._undoMgr.beginRecording(r);this._nodeMgr.removeNode(t,e.keepWorldTransform),this.endRecording(i)}async changeNodeLock(e,t,r){this._nodeMgr.changeNodeLock(e,t,r)}async restorePrefab(e,t){return await this._prefabMgr.revertPrefab(e)}onNodeBeforeChanged(e){this._undoMgr.updateDump([e.uuid],!1)}onNodeChanged(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onNodeChanged",e,t),this._prefabMgr.onNodeChangedInGeneralMode(e,t,this._sceneProxy.getRootNode()),!1!==t.record&&this.recordNode(e)}onAddNode(e){this.dispatchEvents("onAddNode",e),e.parent&&this.recordNode(e)}onRemoveNode(e){this.dispatchEvents("onRemoveNode",e),e.parent||this.recordNode(e)}onNodeAdded(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onNodeAdded",e,t),e.parent&&this.recordNode(e),this._recycleNode[e.uuid]&&delete this._recycleNode[e.uuid]}onNodeRemoved(e,t){t.modeName=this.modeName,this.dispatchEvents("onNodeRemoved",e,t),this._prefabMgr.checkToRemoveTargetOverride(e,this._sceneProxy.getRootNode()),Editor.Selection.unselect("node",e.uuid),e.parent||this.recordNode(e),this._recycleNode[e.uuid]=e}async queryComponent(e){return await this._compMgr.queryDump(e)}createComponent(e){this._nodeMgr.createComponent(e.uuid,e.component)}async resetComponent(e){this._nodeMgr.resetComponent(e)}async removeComponent(e){this._nodeMgr.removeComponent(e.uuid)}async executeComponentMethod(e){return await this._compMgr.executeComponentMethod(e.uuid,e.name,e.args)}async executeSceneScriptMethod(e){return await this._pluginMgr.executeSceneScript(e)}onAddComponent(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onAddComponent",e,t)}onRemoveComponent(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onRemoveComponent",e,t),this._prefabMgr.onRemoveComponentInGeneralMode(e,this._sceneProxy.getRootNode())}onComponentAdded(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onComponentAdded",e,t),this._recycleComponent[e.uuid]&&delete this._recycleComponent[e.uuid]}onComponentRemoved(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onComponentRemoved",e),this._prefabMgr.onComponentRemovedInGeneralMode(e,this._sceneProxy.getRootNode()),this._recycleComponent[e.uuid]=e}async snapshot(e){console.debug("snapshot is deprecated, please use beginRecording/endRecording instead"),this._undoMgr.snapshot(e)}abortSnapshot(){console.debug("abortSnapshot is deprecated, please use cancelRecording instead"),this._undoMgr.abort()}beginRecording(e,t){return this._undoMgr.beginRecording(e,t)}cancelRecording(e){return this._undoMgr.cancelRecording(e)}endRecording(e){const t=this._undoMgr.endRecording(e);return this.changeTitle(),t}async undo(){await this._undoMgr.undo()}async redo(){await this._undoMgr.redo()}recordNode(e,t=!0){t&&this._undoMgr.record(e.uuid)}async queryAllEffects(){return this._assetMgr.queryAllEffects()}async queryMaterial(e){return this._assetMgr.queryMaterial(e)}async queryEffect(e){return this._assetMgr.queryEffect(e)}async queryRenderPipeline(e){return this._assetMgr.queryRenderPipeline(e)}async changeRenderPipeline(e){return await this._assetMgr.changeRenderPipeline(e)}async applyRenderPipeline(e){await this._assetMgr.applyRenderPipeline(e)}async previewMaterial(e,t,r){await this._assetMgr.previewMaterial(e,t,r)}async applyMaterial(e,t){await this._assetMgr.applyMaterial(e,t)}async changePhysicsMaterial(e){return await this._assetMgr.changePhysicsMaterial(e)}async applyPhysicsMaterial(e){await this._assetMgr.applyPhysicsMaterial(e)}async changeAnimationGraphVariant(e){return await this._assetMgr.changeAnimationGraphVariant(e)}async applyAnimationGraphVariant(e){await this._assetMgr.applyAnimationGraphVariant(e)}async changeAnimationMask(e){return await this._assetMgr.changeAnimationMask(e)}async applyAnimationMask(e){await this._assetMgr.applyAnimationMask(e)}async applyRenderTexture(e,t){await this._assetMgr.applyRenderTexture(e,t)}queryPhysicsMaterial(e){return this._assetMgr.queryPhysicsMaterial(e)}queryAnimationGraphVariant(e){return this._assetMgr.queryAnimationGraphVariant(e)}queryAnimationMask(e){return this._assetMgr.queryAnimationMask(e)}queryCreatableAssetTypes(){return this._nodeMgr.creatableAssetTypes}async assetChange(e,t,r){this.dispatchEvents("onAssetChanged",e,t,r)}assetDelete(e,t){this.dispatchEvents("onAssetDeleted",e,t)}assetRefresh(e){this._animationMgr.onAssetRefreshed(e)}async gizmoRefreshConfig(){return this._gizmoMgr.initFromConfig()}async queryGizmoToolName(){return this._gizmoMgr.queryToolName()}async queryGizmoPivot(){return this._gizmoMgr.queryPivot()}async queryGizmoCoordinate(){return this._gizmoMgr.queryCoordinate()}async queryIs2D(){return this._gizmoMgr.queryIs2D()}queryIsIconGizmo3D(){return this._gizmoMgr.isIconGizmo3D()}queryIconGizmoSize(){return this._gizmoMgr.queryIconGizmoSize()}updateInnerTetrahedron(){this._gizmoMgr.updateLightProbeInnerTetrahedron()}async setTransformToolName(e){this.queryLightProbeEditMode()||this.queryLightProbeBoundingBoxEditMode()||(this.toggleLightProbeEditMode(!1),this.toggleLightProbeBoundingBoxEditMode(!1),await this._gizmoMgr.setTransformToolName(e))}async setPivot(e){await this._gizmoMgr.setPivot(e)}async setCoordinate(e){await this._gizmoMgr.setCoordinate(e)}async setIs2D(e){await this._gizmoMgr.setIs2D(e)}async setIconGizmo3D(e){await this._gizmoMgr.setIconGizmo3D(e)}async setIconGizmoSize(e){await this._gizmoMgr.setIconGizmoSize(e)}focus(e=null,t,r,i,n=!1){this._cameraMgr.focus(e,t,r,i,n)}alignNodeToSceneView(e){this._cameraMgr.alignNodeToSceneView(e)}queryIsGridVisible(){return this._cameraMgr.isGridVisible()}setGridVisible(e){this._cameraMgr.setGridVisible(e)}alignWithView(){const e=selection_1.default.query();e&&this._cameraMgr.alignNodeToSceneView(e)}alignViewWithNode(){const e=selection_1.default.query();e&&this._cameraMgr.alignSceneViewToNode(e)}setGridLineColor(e){this._cameraMgr.setGridLineColor(e)}getCameraProperty(){return this._cameraMgr.getCameraProperty()}setCameraProperty(e){this._cameraMgr.setCameraProperty(e)}getCameraWheelSpeed(){return this._cameraMgr.getWheelSpeed()}setCameraWheelSpeed(e){this._cameraMgr.setWheelSpeed(e)}getCameraWanderSpeed(){return this._cameraMgr.getWanderSpeed()}setCameraWanderSpeed(e){this._cameraMgr.setWanderSpeed(e)}zoomSceneViewUp(){this._cameraMgr.zoomUp()}zoomSceneViewDown(){this._cameraMgr.zoomDown()}resetSceneViewZoom(){this._cameraMgr.zoomReset()}toggleActiveSelectedNode(){const e=Editor.Selection.getSelected("node");for(const t of e){const e=this._nodeMgr.query(t);e&&(e.active=!e.active,cce.Node.emit("change",e))}}toggleActiveUnselectedNode(){const e=Editor.Selection.getSelected("node");e.map(e=>{var t;return null===(t=this._nodeMgr.query(e))||void 0===t?void 0:t.parent}).filter(Boolean);for(const t of e){const r=this._nodeMgr.query(t);if(r){if(!r.parent)return r.active=!r.active,void cce.Node.emit("change",r);r.parent.children.every(e=>e.uuid===r.uuid||e.active!==r.active)&&(r.active=!r.active,cce.Node.emit("change",r));for(const t of r.parent.children)e.includes(t.uuid)||t.active===r.active&&(t.active=!r.active,cce.Node.emit("change",t))}}}toggleActiveAllNodes(){const e=Editor.Selection.getSelected("node");for(const t of e){const r=this._nodeMgr.query(t);if(r){if(!r.parent)return r.active=!r.active,void cce.Node.emit("change",r);if(r.active=!r.active,r.parent)for(const t of r.parent.children)e.includes(t.uuid)||(t.active=r.active,cce.Node.emit("change",r))}}}queryCurrentAnimationState(){return console.debug(doNotSupportFunc,"queryCurrentAnimationState"),null}queryCurrentAnimationInfo(){return this._animationMgr.getEditAnimationInfo()}queryAnimationRootNode(e){return this._animationMgr.queryAnimationRoot(e)}queryAnimationRootInfo(e){return this._animationMgr.queryAnimationRootInfo(e)}queryAnimationClipDump(e,t){return this._animationMgr.queryAnimationClipDump(e,t)}queryAnimationProperties(e){return this._animationMgr.queryProperties(e)}queryAnimationClipsInfo(e){return this._animationMgr.queryAnimClipsInfo(e)}queryAnimationClipCurrentTime(e){return this._animationMgr.queryPlayingClipTime(e)}queryAnimationPropValueAtFrame(e,t,r,i){return console.debug(doNotSupportFunc,this.modeName,"queryAnimationPropValueAtFrame"),null}queryAuxCurveValueAtFrame(e,t,r){return console.debug(doNotSupportFunc,this.modeName,this.queryAuxCurveValueAtFrame.name),null}async recordAnimation(e,t,r){return this._animationMgr.curEditRootNodeUuid=e,r&&await this._animationMgr.setEditClip(r),!1}async changeAnimationRootNode(e,t){return await animation_1.default.changeAnimNode(e,t)}async setCurEditTime(e){return console.debug(doNotSupportFunc,this.modeName,"setCurEditTime"),!1}async changeClipState(e,t){return console.debug(doNotSupportFunc,this.modeName,"changeClipState"),!1}async setEditClip(e){return await animation_1.default.setEditClip(e)}async saveClip(){return console.debug(doNotSupportFunc,this.modeName,"saveClip"),!1}async applyAnimationOperation(e){return console.debug(doNotSupportFunc,this.modeName,"applyAnimationOperation"),{state:"failure",result:null}}queryAnimationNodeEditInfo(e){return animation_1.default.queryAnimationNodeEditInfo(e)}queryAuxiliaryCurves(e){return this._animationMgr.queryAuxiliaryCurves(e)}async queryScriptName(e){return await this._scriptMgr.queryScriptName(e)}async queryScriptCid(e){return await this._scriptMgr.queryScriptCid(e)}async loadScript(e){return this._scriptMgr.loadScript(e)}async removeScript(e){return this._scriptMgr.removeScript(e)}async scriptChange(e){return this._scriptMgr.scriptChange(e)}querySelection(){return this._selectionMgr.query()}isSelectNode(e){return this._selectionMgr.isSelect(e)}selectNode(e){this._selectionMgr.select(e)}unselectNode(e){this._selectionMgr.unselect(e)}clearSelection(){this._selectionMgr.clear()}registerEffects(e){this._effectMgr.registerEffects(e)}removeEffects(e){this._effectMgr.removeEffects(e)}updateEffect(e){this._effectMgr.updateEffect(e)}onRemoveTerrain(e,t){this._terrainMgr.onRemoveTerrain(e,t)}async createPrefab(e,t){return await this._prefabMgr.createPrefabAssetFromNode(e,t)}getPrefabData(e){const t=this._prefabMgr.generatePrefabDataFromNode(e);return t?t.prefabData:null}linkPrefab(e,t){return this._prefabMgr.linkNodeWithPrefabAsset(e,t)}unlinkPrefab(e,t){const r=this._prefabMgr.getUnlinkNodeUuids(e,t),i=this._undoMgr.beginRecording(r),n=this.doUnlinkPrefab(e,t);return n?this.endRecording(i):this.cancelRecording(i),n}doUnlinkPrefab(e,t){return this._prefabMgr.unWrapPrefabInstance(e,t)}async applyPrefab(e){return await this._prefabMgr.applyPrefab(e)}distributeSelectionUI(e){this._uiMgr.distributeSelection(e)}alignSelectionUI(e){this._uiMgr.alignSelection(e)}queryParticlePlayInfo(e){return this._particleMgr.queryPlayInfo(e)}setParticlePlaySpeed(e,t){this._particleMgr.setPlaySpeed(e,t)}playParticle(){this._particleMgr.play()}restartParticle(){this._particleMgr.restart()}pauseParticle(){this._particleMgr.pause()}stopParticle(){this._particleMgr.stop()}applyCurrentCameraSize(e){return this._lodMgr.applyCurrentCameraSize(e)}insertLOD(e,...t){this._lodMgr.insertLOD(e,...t)}eraseLOD(e,...t){this._lodMgr.eraseLOD(e,...t)}async updatePhysicsGroup(){const e={};for(const t in cc.internal.PhysicsGroup){const r=cc.internal.PhysicsGroup[t];e[r]=t}const t={};for(const e in cc.internal.PhysicsGroup2D){const r=cc.internal.PhysicsGroup2D[e];t[r]=e}const r={};(await Editor.Profile.getProject("project","physics.collisionGroups")||[]).forEach(i=>{const n=1<<i.index,a=e[n];a&&(delete cc.internal.PhysicsGroup[n],delete cc.internal.PhysicsGroup[a]);const s=t[n];s&&(delete cc.internal.PhysicsGroup2D[n],delete cc.internal.PhysicsGroup2D[s]),r[i.name]=n}),Object.assign(cc.internal.PhysicsGroup,r),cc.Enum.update(cc.internal.PhysicsGroup),Object.assign(cc.internal.PhysicsGroup2D,r),cc.Enum.update(cc.internal.PhysicsGroup2D)}onEngineUpdate(){this._cameraMgr.onUpdate(time_1.default.deltaTime),this._gizmoMgr.onUpdate(time_1.default.deltaTime)}regeneratePolygon2DPoints(e){this._physics2DMgr.resetPointsByUuid(e)}async exportParticlePlist(e){return await this._particle2DMgr.exportParticlePlist(e)}duplicateCurrentSelectedProbes(){this._gizmoMgr.duplicateCurrentSelectedProbes()}removeCurrentSelectedProbes(){this._gizmoMgr.removeCurrentSelectedProbes()}toggleLightProbeEditMode(e){return this.lightProbeEditMode=Boolean(e),this.lightProbeEditMode}queryLightProbeEditMode(){return this.lightProbeEditMode}toggleLightProbeBoundingBoxEditMode(e){return this.lightProbeBoundingBoxEditMode=Boolean(e),this.lightProbeBoundingBoxEditMode}queryLightProbeBoundingBoxEditMode(){return this.lightProbeBoundingBoxEditMode}lightProbeInfoChanged(){this._gizmoMgr.lightProbeInfoChanged()}lightProbeEditModeChanged(e){this._lightProbeEditModeListener.forEach(t=>{var r;return null===(r=t.lightProbeEditModeChanged)||void 0===r?void 0:r.call(t,e)}),Editor.Message.broadcast("scene:light-probe-edit-mode-changed",e)}boundingBoxEditModeChanged(e){this._lightProbeEditModeListener.forEach(t=>{var r;return null===(r=t.boundingBoxEditModeChanged)||void 0===r?void 0:r.call(t,e)}),Editor.Message.broadcast("scene:light-probe-bounding-box-edit-mode-changed",e)}async changeTitle(){if(!isPreviewProcess&&(this.modeName===scene_facade_state_interface_1.SceneModeType.General||this.modeName===scene_facade_state_interface_1.SceneModeType.Prefab)){const e=await this.querySceneDirty();message_1.messageManager.IpcSend("change-title",this.queryCurrentSceneUuid(),e)}}}exports.GeneralSceneFacade=GeneralSceneFacade,exports.default=GeneralSceneFacade;