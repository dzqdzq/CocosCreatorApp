"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const LFX_App_1=require("./backer/LFX_App"),editor_1=require("editor"),fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),Chroma=require("chroma-js");class Lightmap{constructor(){this.scene=null,this.renderScene=null}init(){this.lfxApp=new LFX_App_1.LFX_App,this.lfxApp.Baker.on("login",e=>{console.debug("lightMap output info: login",e),editor_1.Message.broadcast("scene:lightmap-start")}),this.lfxApp.Baker.on("log",e=>{console.debug("lightMap output info: log",e),editor_1.Message.broadcast("scene:lightmap-log",e)}),this.lfxApp.Baker.on("progress",e=>{console.debug("lightMap output info: progress",e),editor_1.Message.broadcast("scene:lightmap-progress",e)}),this.lfxApp.Baker.on("fineshed",e=>{console.debug("lightMap output info: fineshed",e),editor_1.Message.broadcast("scene:lightmap-finished")}),this.lfxApp.Baker.on("end",e=>{console.debug("lightMap output info: end",e),editor_1.Message.broadcast("scene:lightmap-end",e)}),this.lfxApp.Baker.on("cancel",e=>{console.debug("lightMap output info: cancel",e),editor_1.Message.broadcast("scene:lightmap-cancel",e)}),cce.Scene.on("open",this.onLoadScene.bind(this)),cce.Scene.on("reload",this.onLoadScene.bind(this))}onLoadScene(e){this.scene=e,this.renderScene=this.scene._renderScene}apply(e,t){fs_1.default.existsSync(e.path)||fs_1.default.mkdirSync(e.path),t&&(this.lfxApp.Baker.lfxpath=path_1.default.join(t,"../tools/lightmap-tools")),e.aoColor=Chroma(e.aoColor).rgb(),this.lfxApp.Init(e),this.bake()}clear(){LFX_App_1.LFX_App.Reset(this.scene)}bake(){this.lfxApp.Bake(this.scene)}cancel(){this.lfxApp.Cancel()}}exports.default=new Lightmap;