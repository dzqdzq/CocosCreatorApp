"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightManager=void 0;const cc_1=require("cc"),component_1=__importDefault(require("../component")),node_1=__importDefault(require("../../../utils/node")),scene_view_data_1=require("./scene-view-data");class LightManager{constructor(){this._lights=[]}onSceneOpened(e){this._lights=[];const t=component_1.default.queryAll();Object.keys(t).forEach(e=>{const n=t[e];n instanceof cc_1.LightComponent&&(node_1.default.isEditorNode(n.node)||(this.overrideLightCompFunc(n),this._lights.push(n)))})}onComponentAdded(e){e instanceof cc_1.LightComponent&&(node_1.default.isEditorNode(e.node)||(this.overrideLightCompFunc(e),this._lights.push(e)))}onComponentRemoved(e){if(e instanceof cc_1.LightComponent){const t=this._lights.indexOf(e);this._lights.splice(t,1)}}disableSceneLights(){this._lights.forEach(e=>{e.onDisable()})}enableSceneLights(){this._lights.forEach(e=>{e.enabled&&e.node.active&&e.onEnable()})}overrideLightCompFunc(e){if(e._hasOverrideOnEnable)return;const t=e.onEnable;e.onEnable=(()=>{scene_view_data_1.sceneViewData.isSceneLightOn&&t.apply(e)}),e._hasOverrideOnEnable=!0}}const lightManager=new LightManager;exports.lightManager=lightManager;