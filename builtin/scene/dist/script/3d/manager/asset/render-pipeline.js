"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const edit_component_asset_1=__importDefault(require("./edit-component-asset")),ElectronModule=require("@base/electron-module"),EditorExtends=ElectronModule.require("EditorExtends");class EditRenderPipeline extends edit_component_asset_1.default{constructor(){super(...arguments),this.changeTypes={_flows:{componentKey:"flow",optionalTypes:[]},_stages:{componentKey:"stage",optionalTypes:[]}}}queryComponents(e){return EditorExtends.Component.getMenus().map(t=>{const o=`hidden:render_${e}/`;return-1===t.menuPath.indexOf(o)?null:t.component?t.menuPath.replace(o,""):null}).filter(Boolean)}preview(){const e=cc.director.root.pipeline;e&&e._uuid===this.component.uuid&&(cc.director.root.setRenderPipeline(this.component),cce.Engine.repaintInEditMode())}modifyProp(e,t){if(e.name=t,!1!==e.visible&&e.value&&"object"==typeof e.value){const o=this.changeTypes[t];if(o){const e=this.queryComponents(o.componentKey);o.optionalTypes=e}e.isArray&&e.elementTypeData&&o&&(this.modifyProp(e.elementTypeData),e.elementTypeData.optionalTypes=o.optionalTypes);for(const t in e.value)"object"==typeof e.value[t]&&(this.modifyProp(e.value[t],t),e.isArray&&o&&(e.value[t].optionalTypes=o.optionalTypes))}}encodeComponent(e){const t=super.encodeComponent(e);return{name:"Pipeline",type:e.constructor.name,value:t,visible:!0,readonly:!1,optionalTypes:this.queryComponents("pipeline")}}async updateComponent(e){if(this.component.constructor.name!==e.type){const t=cc.js.getClassByName(e.type);if(t){const e=new t;this.cacheComponent(e)}}return await super.updateComponent(e.value)}}exports.default=new EditRenderPipeline;