"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const encode_1=__importDefault(require("../../../../utils/dump/encode")),dumpUtil=__importStar(require("../../../../utils/dump/utils"));class EditComponentAsset{constructor(){this.component=null}modifyProp(e,t){if(e.name=t,e.value&&"object"==typeof e.value)for(const t in e.value)"object"==typeof e.value[t]&&this.modifyProp(e.value[t],t)}encodeComponent(e){const t=e.constructor;if(!t.__props__)return null;const o={};return t.__props__.forEach(r=>{try{if(void 0===e[r])return;const n=cc.Class.attr(t,r);o[r]=encode_1.default.encodeObject(e[r],n,e),this.modifyProp(o[r],r)}catch(t){console.warn(`Component property dump failed:\n Component: ${e.constructor.name}\n Property: ${r}`),console.warn(t)}}),o}resetProperty(e){const t=e.constructor;t.__props__&&t.__props__.forEach(o=>{try{const r=cc.Class.attr(t,o);if(r&&cc.Class._isCCClass(r.ctor)&&null===e[o]&&(e[o]=new r.ctor),Array.isArray(e[o]))for(const t of e[o])this.resetProperty(t)}catch(e){console.warn(e)}})}cacheComponent(e){this.resetProperty(e),this.component=e}getComponent(){return this.component}updateComponent(e){return Object.keys(e).forEach(t=>{e[t].visible&&function e(t,o,r){if(null===o)return;if("object"!=typeof o)return"uuid"!==r||"uuid"in t?void(t[r]=o):void(t._uuid=o);if(!o.isArray&&void 0!==o.value)return void(null===o.value||"object"!=typeof o.value?t[r]=o.value:null===t[r]||"object"!=typeof t[r]?t[r]=o.value:Object.keys(o.value).forEach(n=>{e(t[r],o.value,n)}));if(o[r].isArray){const e=t[r],n=o[r].value,u=cc.Class.attr(t.constructor,r),c=e.length,i=n.length;if(i<c)e.splice(i,c-i);else for(let t=c;t<i;t++)e[t]=dumpUtil.ccClassAttrPropertyDefaultValue(u)}"object"==typeof o[r].value?null===t[r]||"object"!=typeof t[r]?t[r]=o[r].value:Object.keys(o[r].value).forEach(n=>{e(t[r],o[r].value[n],n)}):t[r]=o[r].value}(this.component,e,t)}),this.encodeComponent(this.component)}}exports.default=EditComponentAsset;