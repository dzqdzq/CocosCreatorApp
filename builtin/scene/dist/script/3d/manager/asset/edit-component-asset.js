"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const encode_1=__importDefault(require("../../../../utils/dump/encode")),dumpUtil=__importStar(require("../../../../utils/dump/utils")),asset_1=require("../../../utils/asset"),utils_1=__importDefault(require("./utils"));class EditComponentAsset{constructor(){this.component=null}modifyProp(e,t){if(e.name=t,e.value&&"object"==typeof e.value)for(const t in e.value)"object"==typeof e.value[t]&&this.modifyProp(e.value[t],t)}encodeComponent(e){const t=e.constructor;if(!t.__props__)return null;const o={};return t.__props__.forEach(n=>{try{if(void 0===e[n])return;const r=cc.Class.attr(t,n);o[n]=encode_1.default.encodeObject(e[n],r,e),this.modifyProp(o[n],n)}catch(t){console.warn(`Component property dump failed:\n Component: ${e.constructor.name}\n Property: ${n}`),console.warn(t)}}),o}cacheComponent(e){this.component=e}getComponent(){return this.component}async updateComponent(e){for(const o in e)e[o].visible&&await t(this.component,e,o);async function t(e,o,n){if(o){if("object"!=typeof o)return"uuid"===n&&"_uuid"in e?void(e._uuid=o):void(e[n]=o);if(o[n].isArray){const r=cc.Class.attr(e.constructor,n);if(Array.isArray(e[n])||(e[n]=dumpUtil.ccClassAttrPropertyDefaultValue(r)),Array.isArray(e[n])){const r=e[n].length,u=o[n].value.length;if(u>r)for(let i=r;i<u;i++)if(o[n].value[i].type){const r=cc.js.getClassByName(o[n].value[i].type);r?(e[n][i]=new r,await t(e[n],o[n].value,i.toString())):e[n][i]=utils_1.default.getDefaultValue(o[n].value[i].type)}else e[n][i]=null;else if(u<r)for(;e[n].length>u;)e[n].pop();else if(r){const t=e[n].slice();e[n]=[];for(let u=0;u<r;u++)void 0!==o[n].value[u]&&(e[n][u]=t[o[n].value[u].name])}for(let r=0;r<e[n].length;r++){if(o[n].value[r].type&&o[n].value[r].type!==e[n][r].constructor.name){const t=cc.js.getClassByName(o[n].value[r].type);t&&(e[n][r]=new t)}await t(e[n],o[n].value,r.toString())}}else delete e[n]}else if(null===o[n].value||"object"!=typeof o[n].value)e[n]=o[n].value;else{const r=Object.keys(o[n].value);for(const u of r)"uuid"===u?o[n].value[u]?(!e[n]||void 0!==e[n]._uuid&&e[n]._uuid!==o[n].value[u])&&(e[n]=await(0,asset_1.loadAssetUncached)(o[n].value.uuid)):e[n]=null:await t(e[n],o[n].value,u)}}}return this.encodeComponent(this.component)}}exports.default=EditComponentAsset;