"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setPositionInNode=exports.findCanvas=exports.setNodeEditorFlag=exports.screenPointToWorldPosition3D=exports.screenPointToWorldPosition2D=exports.adjustXY=void 0;const cc_1=require("cc"),window_1=require("../../../../../utils/window"),camera_1=__importDefault(require("../../../camera")),cmp=(e,o)=>e.distance-o.distance,ray=cc_1.geometry.Ray.create(),plane2D=cc_1.geometry.plane.create(0,0,1,0),plane3D=cc_1.geometry.plane.create(0,1,0,0),originPosition=new cc_1.Vec3,tempScenePoint=new cc_1.Vec3,tempPosition=new cc_1.Vec3,tempOffsetPosition=new cc_1.Vec3;function adjustXY(e,o){return{x:e,y:(0,window_1.getMainWindowSize)().height-o}}function screenPointToWorldPosition2D(e,o){camera_1.default.getCamera().screenPointToRay(ray,e,o);e=cc_1.geometry.intersect.rayPlane(ray,plane2D);return cc_1.Vec3.scaleAndAdd(tempPosition,ray.o,ray.d,e),tempPosition.z=0,tempPosition.clone()}function screenPointToWorldPosition3D(e,o,t,n){var i=camera_1.default.getCamera(),n=n&&n.getComponent(cc_1.MeshRenderer),n=n&&n.model&&n.model.worldBounds;if(n){var s=n.center,n=n.halfExtents,r=cc_1.geometry.AABB.create(s.x,s.y,s.z,n.x,n.y,n.z);if(i.screenPointToRay(ray,e,o),r=cc_1.geometry.intersect.rayAABB(ray,r)){cc_1.Vec3.scaleAndAdd(tempPosition,ray.o,ray.d,r);var r=.01,c=s.x-n.x-r,a=s.x+n.x+r,d=s.y-n.y-r,P=s.y+n.y+r,p=s.z-n.z-r,s=s.z+n.z+r;let e=t.worldScale.clone();n=t.getComponent(cc_1.MeshRenderer),r=n&&n.model&&n.model.worldBounds;n&&r&&(e=r.halfExtents.clone()),Math.abs(tempPosition.x-c)<1e-6?tempPosition.x=tempPosition.x-e.x:Math.abs(tempPosition.x-a)<1e-6?tempPosition.x=tempPosition.x+e.x:Math.abs(tempPosition.y-d)<1e-6?tempPosition.y=tempPosition.y-e.y:Math.abs(tempPosition.y-P)<1e-6?tempPosition.y=tempPosition.y+e.y:Math.abs(tempPosition.z-p)<1e-6?tempPosition.z=tempPosition.z-e.z:Math.abs(tempPosition.z-s)<1e-6&&(tempPosition.z=tempPosition.z+e.z)}}else i.screenPointToRay(ray,e,o),cc_1.Vec3.scaleAndAdd(tempPosition,ray.o,ray.d,20);return tempPosition.clone()}function setNodeEditorFlag(e){e&&(e.objFlags|=cc_1.CCObject.Flags.DontSave|cc_1.CCObject.Flags.HideInHierarchy)}function findCanvas(){var e=cc_1.director.getScene();if(e)for(const o of e.getComponentsInChildren(cc_1.Canvas))if(0===o.node.hideFlags)return o.node;return null}function setPositionInNode(e,o,t,n,i){i=i||findCanvas();for(const a of t){tempOffsetPosition.set(0,0,0);var s=a.position.clone(),r=a.getComponent(cc_1.UITransform),c=!!r?screenPointToWorldPosition2D(e,o):screenPointToWorldPosition3D(e,o,a,n);i&&r&&(tempOffsetPosition.x=i.worldPosition.x,tempOffsetPosition.y=i.worldPosition.y,tempOffsetPosition.z=i.worldPosition.z),cc_1.Vec3.subtract(s,c,tempOffsetPosition),a.position=s}}exports.adjustXY=adjustXY,exports.screenPointToWorldPosition2D=screenPointToWorldPosition2D,exports.screenPointToWorldPosition3D=screenPointToWorldPosition3D,exports.setNodeEditorFlag=setNodeEditorFlag,exports.findCanvas=findCanvas,exports.setPositionInNode=setPositionInNode;