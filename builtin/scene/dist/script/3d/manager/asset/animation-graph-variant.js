"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const edit_component_asset_1=__importDefault(require("./edit-component-asset")),animationApi=__importStar(require("cc/editor/new-gen-anim")),asset_1=require("../../../utils/asset");class EditAnimationGraphVariant extends edit_component_asset_1.default{constructor(){super(...arguments),this.overrides={},this.invalidEntries={}}resetOverrides(){if(this.overrides={},this.invalidEntries={},this.component.original)for(const e of animationApi.visitAnimationClips(this.component.original))e&&(this.overrides[e._uuid]="");const e=this.entryOverrides();for(const t in e)void 0===this.overrides[t]?this.invalidEntries[t]=e[t]:this.overrides[t]=e[t]}entryOverrides(){const e={};return[...this.component.clipOverrides].forEach(t=>{e[t.original._uuid]=t.substitution._uuid}),e}cacheComponent(e){super.cacheComponent(e),this.resetOverrides()}encodeComponent(){var e;return{graphUuid:null===(e=this.component.original)||void 0===e?void 0:e._uuid,clips:this.overrides,invalids:this.invalidEntries}}async updateComponent(e){var t;const i=null===(t=this.component.original)||void 0===t?void 0:t._uuid;if(e.graphUuid!==i)e.graphUuid?this.component.original=await(0,asset_1.loadAssetUncached)(e.graphUuid):this.component.original=null,this.resetOverrides();else for(const t in e.clips)this.overrides[t]=e.clips[t];return this.encodeComponent()}async applyComponent(){this.component.clipOverrides.clear();try{for(const e in this.overrides){if(!this.overrides[e])continue;const t=await(0,asset_1.loadAssetUncached)(e),i=await(0,asset_1.loadAssetUncached)(this.overrides[e]);this.component.clipOverrides.set(t,i)}}catch(e){return void console.error(e)}return this.getComponent()}}exports.default=new EditAnimationGraphVariant;