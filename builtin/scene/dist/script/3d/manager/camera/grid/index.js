"use strict";var __importDefault=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(exports,"__esModule",{value:!0});const linear_ticks_1=__importDefault(require("./linear-ticks")),math_1=__importDefault(require("../../../../utils/math"));function _snapPixel(i){return Math.floor(i)}function _uninterpolate(i,t){return t=(t-=i)||1/t,function(s){return(s-i)/t}}function _interpolate(i,t){return function(s){return i*(1-s)+t*s}}class Grid{constructor(i,t){this._canvasWidth=0,this._canvasHeight=0,this.hTicks=null,this.xAxisScale=1,this.xAxisOffset=1,this.xAnchor=.5,this.vTicks=null,this.yAxisScale=1,this.yAxisOffset=1,this.yAnchor=.5,this._xAnchorOffset=0,this._yAnchorOffset=0,this.pixelToValueH=null,this.valueToPixelH=null,this.pixelToValueV=null,this.valueToPixelV=null,this.xDirection=0,this.yDirection=0,this.xMinRange=null,this.xMaxRange=null,this.yMinRange=null,this.yMaxRange=null,this._canvasWidth=i,this._canvasHeight=t}setAnchor(i,t){this.xAnchor=math_1.default.clamp(i,-1,1),this.yAnchor=math_1.default.clamp(t,-1,1)}setScaleH(i,t,s){this.hTicks=(new linear_ticks_1.default).initTicks(i,t,s).spacing(10,80),this.xAxisScale=math_1.default.clamp(this.xAxisScale,this.hTicks.minValueScale,this.hTicks.maxValueScale),this.pixelToValueH=(i=>(i-this.xAxisOffset)/this.xAxisScale),this.valueToPixelH=(i=>i*this.xAxisScale+this.xAxisOffset)}setMappingH(i,t,s){this._xAnchorOffset=i/(t-i),this.xDirection=t-i>0?1:-1,this.pixelToValueH=(e=>{let a=this.xAxisOffset,h=this._canvasWidth/s,l=_uninterpolate(0,this._canvasWidth);return _interpolate(i*h,t*h)(l(e-a))/this.xAxisScale}),this.valueToPixelH=(e=>{let a=this.xAxisOffset,h=this._canvasWidth/s,l=_uninterpolate(i*h,t*h);return _interpolate(0,this._canvasWidth)(l(e*this.xAxisScale))+a})}setScaleV(i,t,s){this.vTicks=(new linear_ticks_1.default).initTicks(i,t,s).spacing(10,80),this.yAxisScale=math_1.default.clamp(this.yAxisScale,this.vTicks.minValueScale,this.vTicks.maxValueScale),this.pixelToValueV=(i=>(this._canvasHeight-i+this.yAxisOffset)/this.yAxisScale),this.valueToPixelV=(i=>-i*this.yAxisScale+this._canvasHeight+this.yAxisOffset)}setMappingV(i,t,s){this._yAnchorOffset=i/(t-i),this.yDirection=t-i>0?1:-1,this.pixelToValueV=(e=>{let a=this.yAxisOffset,h=this._canvasHeight/s,l=_uninterpolate(0,this._canvasHeight);return _interpolate(i*h,t*h)(l(e-a))/this.yAxisScale}),this.valueToPixelV=(e=>{let a=this.yAxisOffset,h=this._canvasHeight/s,l=_uninterpolate(i*h,t*h);return _interpolate(0,this._canvasHeight)(l(e*this.yAxisScale))+a})}pan(i,t){this.panX(i),this.panY(t)}panX(i){if(!this.valueToPixelH)return;let t,s,e=this.xAxisOffset+i;this.xAxisOffset=0,void 0!==this.xMinRange&&null!==this.xMinRange&&(t=this.valueToPixelH(this.xMinRange)),void 0!==this.xMaxRange&&null!==this.xMaxRange&&(s=this.valueToPixelH(this.xMaxRange),s=Math.max(0,s-this._canvasWidth)),this.xAxisOffset=e,void 0===t||void 0===s?void 0===t?void 0===s||(this.xAxisOffset=Math.max(this.xAxisOffset,-s)):this.xAxisOffset=Math.min(this.xAxisOffset,-t):this.xAxisOffset=math_1.default.clamp(this.xAxisOffset,-s,-t)}panY(i){if(!this.valueToPixelV)return;let t,s,e=this.yAxisOffset+i;this.yAxisOffset=0,void 0!==this.yMinRange&&null!==this.yMinRange&&(t=this.valueToPixelV(this.yMinRange)),void 0!==this.yMaxRange&&null!==this.yMaxRange&&(s=this.valueToPixelV(this.yMaxRange),s=Math.max(0,s-this._canvasHeight)),this.yAxisOffset=e,void 0===t||void 0===s?void 0===t?void 0===s||(this.yAxisOffset=Math.max(this.yAxisOffset,-s)):this.yAxisOffset=Math.min(this.yAxisOffset,-t):this.yAxisOffset=math_1.default.clamp(this.yAxisOffset,-s,-t)}xAxisScaleAt(i,t){let s=this.pixelToValueH(i);this.xAxisScale=math_1.default.clamp(t,this.hTicks.minValueScale,this.hTicks.maxValueScale);let e=this.valueToPixelH(s);this.pan(i-e,0)}yAxisScaleAt(i,t){let s=this.pixelToValueV(i);this.yAxisScale=math_1.default.clamp(t,this.vTicks.minValueScale,this.vTicks.maxValueScale);let e=this.valueToPixelV(s);this.pan(0,i-e)}xAxisSync(i,t){this.xAxisOffset=i,this.xAxisScale=t}yAxisSync(i,t){this.yAxisOffset=i,this.yAxisScale=t}resize(i,t){i&&t&&(0!==this._canvasWidth&&this.panX((i-this._canvasWidth)*(this.xAnchor+this._xAnchorOffset)),0!==this._canvasHeight&&this.panY((t-this._canvasHeight)*(this.yAnchor+this._yAnchorOffset)),this._canvasWidth=i,this._canvasHeight=t)}updateRange(){if(this.hTicks){let i=this.pixelToValueH(0),t=this.pixelToValueH(this._canvasWidth);this.hTicks.range(i,t,this._canvasWidth)}if(this.vTicks){let i=this.pixelToValueV(0),t=this.pixelToValueV(this._canvasHeight);this.vTicks.range(i,t,this._canvasHeight)}}}exports.default=Grid;