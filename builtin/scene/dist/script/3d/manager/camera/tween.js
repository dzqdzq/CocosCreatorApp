"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tweenNumber=exports.tweenRotation=exports.tweenPosition=void 0;const cc_1=require("cc"),animations=[],frame=1e3/60;let time=0;function step(t){0!==time&&0!==animations.length?setTimeout(()=>{const i=time;time=Date.now();for(let i=0;i<animations.length;){!1===animations[i]._step(t)?animations.splice(i,1):i++}step(time-i)}):stopAnim()}function startAnim(){0===time&&(time=Date.now(),step(frame))}function stopAnim(){time=0}class PositionAnimation{constructor(t,i,e){this.target=cc.v3(),this.func=null,this.start=new cc_1.Vec3,this.end=new cc_1.Vec3,this.travel=0,this.time=0,this.start=t,this.end=i,this.time=e}_step(t){this.travel+=t;const i=Math.min(this.travel/this.time,1);return cc.Vec3.lerp(this.target,this.start,this.end,i),this.func&&this.func(this.target),i<1}step(t){this.func=t}}class RotationAnimation{constructor(t,i,e){this.target=cc.quat(),this.func=null,this.start=new cc_1.Quat,this.end=new cc_1.Quat,this.travel=0,this.time=0,this.start=t,this.end=i,this.time=e}_step(t){this.travel+=t;const i=Math.min(this.travel/this.time,1);return cc_1.Quat.slerp(this.target,this.start,this.end,i),this.func&&this.func(this.target),i<1}step(t){this.func=t}}class NumberAnimation{constructor(t,i,e){this.target=0,this.func=null,this.start=0,this.end=0,this.travel=0,this.time=0,this.target=0,this.func=null,this.start=t,this.end=i,this.travel=0,this.time=e}_step(t){this.travel+=t;const i=Math.min(this.travel/this.time,1);return this.target=(1-i)*this.start+i*this.end,this.func&&this.func(this.target),i<1}step(t){this.func=t}}function tweenPosition(t,i,e=300){const s=new PositionAnimation(t,i,e);return animations.push(s),startAnim(),s}function tweenRotation(t,i,e){const s=new RotationAnimation(t,i,e);return animations.push(s),startAnim(),s}function tweenNumber(t,i,e){const s=new NumberAnimation(t,i,e);return animations.push(s),startAnim(),s}exports.tweenPosition=tweenPosition,exports.tweenRotation=tweenRotation,exports.tweenNumber=tweenNumber,exports.position=tweenPosition,exports.rotation=tweenRotation,exports.number=tweenNumber;