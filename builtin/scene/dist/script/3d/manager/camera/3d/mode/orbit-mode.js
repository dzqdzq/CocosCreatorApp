"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrbitMode=void 0;const mode_base_1=require("./mode-base"),vec3_1=require("../../../../../utils/math/vec3"),utils_1=require("../../utils"),quat_1=require("../../../../../utils/math/quat"),cc_1=require("cc");class OrbitMode extends mode_base_1.ModeBase{constructor(){super(...arguments),this._rotateSpeed=.006}async enter(){const e=this._cameraCtrl.node;e.getWorldPosition(this._curPos),e.getWorldRotation(this._curRot),this._cameraCtrl.view=vec3_1.MVec3.distance(this._curPos,this._cameraCtrl.sceneViewCenter),this._cameraCtrl.emit("camera-move-mode",utils_1.CameraMoveMode.ORBIT),cce.Engine.enterState(cce.NeedAnimState.CAMERA_ORBIT)}async exit(){cce.Engine.exitState(cce.NeedAnimState.CAMERA_ORBIT)}onMouseDown(e){return!1}onMouseMove(e){if(!e.leftButton)return!0;const t=e.moveDeltaX,r=e.moveDeltaY,c=this._curRot,o=cc.v3();quat_1.MQuat.rotateX(c,c,-r*this._rotateSpeed),quat_1.MQuat.rotateAround(c,c,cc_1.Vec3.UNIT_Y,-t*this._rotateSpeed),quat_1.MQuat.toEuler(o,c),quat_1.MQuat.fromEuler(c,o.x,o.y,0);const a=cc.v3(0,0,1);vec3_1.MVec3.transformQuat(a,a,c),vec3_1.MVec3.normalize(a,a),vec3_1.MVec3.multiplyScalar(a,a,this._cameraCtrl.viewDist),vec3_1.MVec3.add(this._curPos,this._cameraCtrl.sceneViewCenter,a),this._cameraCtrl.node.setWorldPosition(this._curPos);const s=cc.v3(0,1,0);return vec3_1.MVec3.transformQuat(s,s,c),vec3_1.MVec3.normalize(s,s),this._cameraCtrl.node.lookAt(this._cameraCtrl.sceneViewCenter,s),this._cameraCtrl.updateGrid(),!1}onMouseUp(e){return!1}}exports.OrbitMode=OrbitMode;