"use strict";var ModeCommand,__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraController3D=void 0,exports.smoothMouseWheelScale=smoothMouseWheelScale;const node_1=__importDefault(require("../../../../utils/node")),camera_controller_base_1=__importDefault(require("../camera-controller-base")),linear_ticks_1=__importDefault(require("../grid/linear-ticks")),tween_1=require("../tween"),utils_1=require("../utils"),cc_1=require("cc"),quat_1=require("../../../../utils/math/quat"),vec3_1=require("../../../../utils/math/vec3"),finite_state_machine_1=__importDefault(require("../../../utils/state-machine/finite-state-machine")),orbit_mode_1=require("./mode/orbit-mode"),pan_mode_1=require("./mode/pan-mode"),wander_mode_1=require("./mode/wander-mode"),idle_mode_1=require("./mode/idle-mode"),window_1=require("../../../../utils/window"),_lineColor=cc.color().fromHEX("#555555"),_lineEnd=1e6,ORTHO=cc_1.Camera.ProjectionType.ORTHO,PERSPECTIVE=cc_1.Camera.ProjectionType.PERSPECTIVE,tempVec3A=new cc_1.Vec3,tempQuatA=new cc_1.Quat;function smoothMouseWheelScale(e){return(0<e?1:-1)*(Math.pow(2,.02*Math.abs(e))-1)*10}!function(e){e.ToIdle="toIdle",e.ToPan="toPan",e.ToOrbit="toOrbit",e.ToWander="toWander"}(ModeCommand=ModeCommand||{});class CameraController3D extends camera_controller_base_1.default{v3a=new cc_1.Vec3;v3b=new cc_1.Vec3;v3c=new cc_1.Vec3;v3d=new cc_1.Vec3;_wheelSpeed=.01;_near=.1;_far=1e4;_orthoScale=.1;_minScalar=.1;homePos=cc.v3(50,50,50);homeRot=quat_1.MQuat.fromViewUp(new cc_1.Quat,vec3_1.MVec3.normalize(this.v3a,this.homePos));_sceneViewCenter=cc.v3();viewDist=20;forward=cc.v3(cc_1.Vec3.UNIT_Z);_curRot=new cc_1.Quat;_curEye=new cc_1.Vec3;_lineColor=cc.color().fromHEX("#555555");lastMouseWheelDeltaY=0;maxMouseWheelDeltaY=1e3;_modeFSM;_idleMode;_orbitMode;_panMode;_wanderMode;isMoving(){return this._modeFSM.currentState!==this._idleMode}view;hTicks;vTicks;shiftKey;altKey;mousePressing=!1;get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e}get sceneViewCenter(){return this._sceneViewCenter}set sceneViewCenter(e){this._sceneViewCenter.set(e)}get wanderSpeed(){return this._wanderMode.wanderSpeed}set wanderSpeed(e){this._wanderMode.wanderSpeed=e}get enableAcceleration(){return this._wanderMode.enableAcceleration}set enableAcceleration(e){this._wanderMode.enableAcceleration=e}showGrid(e){super.showGrid(e),this._originAxisHorizontalMeshComp.node.active=e,this._originAxisVerticalMeshComp.node.active=e}init(e){super.init(e),this._gridMeshComp=utils_1.CameraUtils.createGrid("internal/editor/grid"),this._gridMeshComp.node.active=!1,this._gridMeshComp.node.setWorldRotationFromEuler(90,0,0),this.initOriginAxis(),this._initMode(),this.reset(),this._initLinearTick()}initOriginAxis(){Editor.Profile.getConfig("scene","gizmos-infos").then(e=>{this._originAxisHorizontalMeshComp=utils_1.CameraUtils.createGrid("internal/editor/grid"),this._originAxisHorizontalMeshComp.node.setWorldRotationFromEuler(90,0,0),this._originAxisVerticalMeshComp=utils_1.CameraUtils.createGrid("internal/editor/grid"),this._originAxisVerticalMeshComp.node.setWorldRotationFromEuler(0,90,0),this.updateOriginAxisByConfig(e.originAxis3D,!1);Editor.Profile.__protected__.on("change",(e,t,i,o)=>{"packages/scene.json"===t&&"gizmos-infos.originAxis3D"===i&&(this.updateOriginAxisByConfig(o,!1),this.updateGrid())})})}updateOriginAxisByConfig(e,t=!0){this.originAxisX_Visible=e.x_visible,this.originAxisY_Visible=e.y_visible,this.originAxisZ_Visible=e.z_visible,this._originAxisHorizontalMeshComp.node.active=this.originAxisX_Visible||this.originAxisZ_Visible,this._originAxisVerticalMeshComp.node.active=this.originAxisY_Visible,t&&this.updateOriginAxis(),cce.Engine.repaintInEditMode()}getOriginAxisData(){var e=this.hTicks,t=this.vTicks,i=cc.v3(),o=(this.node.getPosition(i),i.y),o=5e3*(o/500)|0,s=-o+i.x,a=o+i.x,r=-o+i.z,o=o+i.z;return e.range(s,a,5e3),t.range(r,o,5e3),{startX:s,endX:a,startY:r,endY:o,cameraPos:i}}updateOriginAxisVertical(){var{startY:e,endY:t,cameraPos:i}=this.getOriginAxisData(),o=[],s=[],a=[];if(this.originAxisY_Visible){o.push(0,i.z),o.push(0,e),o.push(0,i.z),o.push(0,t);var r=this.originAxisY_Color;for(let e=0;e<4;e++)s.push(r.x,r.y,r.z,r.w);for(let e=0;e<o.length;e+=2)a.push(e/2);utils_1.CameraUtils.updateVBAttr(this._originAxisVerticalMeshComp,cc_1.gfx.AttributeName.ATTR_POSITION,o),utils_1.CameraUtils.updateVBAttr(this._originAxisVerticalMeshComp,cc_1.gfx.AttributeName.ATTR_COLOR,s),utils_1.CameraUtils.updateIB(this._originAxisVerticalMeshComp,a)}}updateOriginAxisHorizontal(){var{startY:e,endY:t,startX:i,endX:o,cameraPos:s}=this.getOriginAxisData(),a=[],r=[],n=[];if(this.originAxisX_Visible){a.push(0,s.z),a.push(0,e),a.push(0,s.z),a.push(0,t);var h=this.originAxisX_Color;for(let e=0;e<4;e++)r.push(h.x,h.y,h.z,h.w)}if(this.originAxisZ_Visible){a.push(s.x,0),a.push(i,0),a.push(s.x,0),a.push(o,0);var d=this.originAxisZ_Color;for(let e=0;e<4;e++)r.push(d.x,d.y,d.z,d.w)}if(0<a.length){for(let e=0;e<a.length;e+=2)n.push(e/2);utils_1.CameraUtils.updateVBAttr(this._originAxisHorizontalMeshComp,cc_1.gfx.AttributeName.ATTR_POSITION,a),utils_1.CameraUtils.updateVBAttr(this._originAxisHorizontalMeshComp,cc_1.gfx.AttributeName.ATTR_COLOR,r),utils_1.CameraUtils.updateIB(this._originAxisHorizontalMeshComp,n)}}updateOriginAxis(){this.updateOriginAxisHorizontal(),this.updateOriginAxisVertical()}_initMode(){this._idleMode=new idle_mode_1.IdleMode(this,utils_1.CameraMoveMode.IDLE),this._orbitMode=new orbit_mode_1.OrbitMode(this,utils_1.CameraMoveMode.ORBIT),this._panMode=new pan_mode_1.PanMode(this,utils_1.CameraMoveMode.PAN),this._wanderMode=new wander_mode_1.WanderMode(this,utils_1.CameraMoveMode.WANDER),this._modeFSM=new finite_state_machine_1.default([this._idleMode,this._orbitMode,this._panMode,this._wanderMode]),this._modeFSM.addTransition(this._idleMode,this._orbitMode,ModeCommand.ToOrbit).addTransition(this._idleMode,this._panMode,ModeCommand.ToPan).addTransition(this._idleMode,this._wanderMode,ModeCommand.ToWander).addTransition(this._orbitMode,this._idleMode,ModeCommand.ToIdle).addTransition(this._orbitMode,this._panMode,ModeCommand.ToPan).addTransition(this._orbitMode,this._wanderMode,ModeCommand.ToWander).addTransition(this._panMode,this._idleMode,ModeCommand.ToIdle).addTransition(this._panMode,this._orbitMode,ModeCommand.ToOrbit).addTransition(this._panMode,this._wanderMode,ModeCommand.ToWander).addTransition(this._wanderMode,this._idleMode,ModeCommand.ToIdle).addTransition(this._wanderMode,this._orbitMode,ModeCommand.ToOrbit).addTransition(this._wanderMode,this._panMode,ModeCommand.ToPan),this._modeFSM.Begin(this._idleMode)}_initLinearTick(){this.hTicks=(new linear_ticks_1.default).initTicks([5,2],1,1e4).spacing(15,80),this.vTicks=(new linear_ticks_1.default).initTicks([5,2],1,1e4).spacing(15,80)}set active(e){e?(this._camera.projection=1,this.node.setWorldPosition(this._curEye),this.node.setWorldRotation(this._curRot),this._camera.far=this.far,this._camera.near=this.near):(this.node.getWorldPosition(this._curEye),this.node.getWorldRotation(this._curRot)),this.showGrid(e)}changeMode(e){this._modeFSM.issueCommand(e);let t=utils_1.CameraMoveMode.IDLE;switch(e){case ModeCommand.ToIdle:t=utils_1.CameraMoveMode.IDLE;break;case ModeCommand.ToOrbit:t=utils_1.CameraMoveMode.ORBIT;break;case ModeCommand.ToPan:t=utils_1.CameraMoveMode.PAN;break;case ModeCommand.ToWander:t=utils_1.CameraMoveMode.WANDER}this.emit("mode",t)}reset(){this.node.setWorldPosition(this.homePos),this.node.setWorldRotation(this.homeRot),this.node.getWorldRotation(this._curRot),this.node.getWorldPosition(this._curEye),this.node.updateWorldTransform()}updateViewCenterByDist(e){this.node.getWorldPosition(this._curEye),this.node.getWorldRotation(this._curRot),vec3_1.MVec3.transformQuat(this.forward,cc_1.Vec3.UNIT_Z,this._curRot),vec3_1.MVec3.multiplyScalar(this.v3a,this.forward,e),vec3_1.MVec3.add(this.sceneViewCenter,this._curEye,this.v3a)}scale(e){let t=this.viewDist;var i;Math.abs(t)<this._minScalar&&(t=1),this.isOrtho()?(i=this._camera.orthoHeight,i+=e*this._wheelSpeed*t*this._orthoScale,this.setOrthoHeight(i)):(e=this.smoothScale(e),this.node.getWorldPosition(this._curEye),this.node.getWorldRotation(this._curRot),vec3_1.MVec3.transformQuat(this.forward,cc_1.Vec3.UNIT_Z,this._curRot),vec3_1.MVec3.multiplyScalar(this.v3a,this.forward,e*this._wheelSpeed*t),vec3_1.MVec3.add(this._curEye,this._curEye,this.v3a),node_1.default.makeVec3InRange(this._curEye,-1e12,1e12),this.viewDist=vec3_1.MVec3.distance(this._curEye,this.sceneViewCenter),this.node.setWorldPosition(this._curEye)),this.updateGrid(),cce.Engine.repaintInEditMode()}smoothScale(e){return smoothMouseWheelScale(e)}lastFocusNodeUUID=[];focusByNode(e,t=!0,i=!1){let o=cc_1.Vec3.ZERO;"center"!==cce.Gizmo.transformToolData.pivot&&(o=node_1.default.getWorldPosition3D(e[e.length-1]),!cce.SceneFacadeManager.queryLightProbeBoundingBoxEditMode())||(o=node_1.default.getCenterWorldPos3D(e));var s,a,r,e=node_1.default.getMaxRangeOfNodes(e);let n=this.viewDist;t||(this._camera.projection===PERSPECTIVE?(t=new cc_1.Vec3(0,0,1),a=Math.min(this._camera.camera.width,this._camera.camera.height)/2,r=new cc_1.Vec3(a,0,1),s=new cc_1.Vec3(0,0,0),this._camera?.screenToWorld(t,s),t=new cc_1.Vec3(0,0,0),this._camera?.screenToWorld(r,t),r=s.subtract(t).length(),n=Math.max(e/a*r,1.3*this.near),n=Math.min(n,.9*this.far)):this._camera.projection===ORTHO&&(s=this._camera.fov/180*Math.PI*this._camera.orthoHeight,n=e*s/this._camera.orthoHeight*13,t=this._camera.node.eulerAngles.x%360,t=90<Math.abs(t)?180-Math.abs(t):Math.abs(t),n/=Math.cos(t/180*Math.PI))),this.sceneViewCenter=o,this.node.getRotation(this._curRot),vec3_1.MVec3.transformQuat(this.forward,cc_1.Vec3.UNIT_Z,this._curRot),vec3_1.MVec3.multiplyScalar(this.v3c,this.forward,n),vec3_1.MVec3.add(this.v3d,o,this.v3c),this.isOrtho()&&(a=this.getDepthSize()*n,i?(this._camera.orthoHeight=a,cce.Gizmo.transformToolData.cameraOrthoHeight=a,cce.Engine.repaintInEditMode()):(0,tween_1.tweenNumber)(this._camera.orthoHeight,a,300).step(e=>{this._camera&&(this._camera.orthoHeight=e,cce.Gizmo.transformToolData.cameraOrthoHeight=e,cce.Engine.repaintInEditMode())})),i?(this.node.setPosition(this.v3d),this._curEye=this.v3d,this.viewDist=vec3_1.MVec3.distance(this.v3d,this.sceneViewCenter),this.updateGrid(),cce.Engine.repaintInEditMode()):(r=this.node.getPosition(),(0,tween_1.tweenPosition)(r,this.v3d,300).step(e=>{this.node.setPosition(e),this._curEye=e,this.viewDist=vec3_1.MVec3.distance(e,this.sceneViewCenter),this.updateGrid(),cce.Engine.repaintInEditMode()}))}focus(e=null,t,i){var o,s,a,r;this.camera_move_mode===utils_1.CameraMoveMode.IDLE&&this._camera?.camera&&(t?(o=this.node.getPosition(),s=this.node.getRotation(),{position:t,rotation:a,viewCenter:r}=t||{},t?(this._curEye.x=t.x||0,this._curEye.y=t.y||0,this._curEye.z=t.z||0):(this._curEye.x=this.homePos.x||0,this._curEye.y=this.homePos.y||0,this._curEye.z=this.homePos.z||0),a?(this._curRot.x=a.x||0,this._curRot.y=a.y||0,this._curRot.z=a.z||0,this._curRot.w=a.w||0):(this._curRot.x=this.homeRot.x||0,this._curRot.y=this.homeRot.y||0,this._curRot.z=this.homeRot.z||0,this._curRot.w=this.homeRot.w||0),this.sceneViewCenter=r||cc.v3(),this.viewDist=vec3_1.MVec3.distance(this._curEye,this.sceneViewCenter),i?(this.node.setPosition(this._curEye),this.node.setRotation(this._curRot),this.updateGrid(),cce.Engine.repaintInEditMode()):((0,tween_1.tweenPosition)(o,this._curEye,300).step(e=>{this.node.setPosition(e),this.updateGrid(),cce.Engine.repaintInEditMode()}),(0,tween_1.tweenRotation)(s,this._curRot,300).step(e=>{this.node.setRotation(e),this.updateGrid()}))):!e||e.length<=0||(t=e.map(e=>cce.Node.query(e)).filter(Boolean)).length<=0||this.focusByNode(t,!1,i))}focusByXY(e,t){var i;this.camera_move_mode===utils_1.CameraMoveMode.IDLE&&this._camera?.camera&&((i=new cc_1.Node).position.set(e),this.focusByNode([i],!0,t))}async alignNodeToSceneView(e){if(e&&0<e.length){var t=e.map(e=>cce.Node.query(e)).filter(Boolean),e=t.map(e=>e.uuid),e=await cce.SceneFacadeManager.beginRecording(e),i=t[0],o=i.getWorldRT(),s=(cc_1.Mat4.invert(o,o),i.getWorldRotation()),a=(quat_1.MQuat.invert(s,s),this.node.getWorldPosition()),r=this.node.getWorldRotation(),n=this.node.getWorldRT();if(i.setWorldPosition(a),i.setWorldRotation(r),this.alignCameraOrthoHeightToNode(i.getComponents(cc_1.Camera)),1<t.length)for(let e=1;e<t.length;e++){var h=t[e],d=h.getWorldPosition(),c=h.getWorldRotation();vec3_1.MVec3.transformMat4(d,d,o),quat_1.MQuat.multiply(c,s,c),vec3_1.MVec3.transformMat4(d,d,n),h.setWorldPosition(d),quat_1.MQuat.multiply(c,r,c),h.setWorldRotation(c),this.alignCameraOrthoHeightToNode(h.getComponents(cc_1.Camera))}cce.SceneFacadeManager.endRecording(e)}}alignCameraOrthoHeightToNode(e){1===e.length&&(e=e[0])&&e.projection===cc_1.Camera.ProjectionType.ORTHO&&(e.orthoHeight=cce.Camera.camera.orthoHeight)}alignSceneViewToNode(e){var t;e&&0<e.length&&(t=(e=e.map(e=>cce.Node.query(e)).filter(Boolean)[0]).getWorldPosition(),e=e.getWorldRotation(),this.node.setWorldPosition(t),this.node.setWorldRotation(e),cce.Engine.repaintInEditMode())}onMouseDBlDown(t){if(cce.SceneFacadeManager.queryIsViewMode()){var i=t.x,o=(0,window_1.getMainWindowSize)().height-t.y;let e=node_1.default.getRaycastResultsForSnap(cce.Camera.getCamera(),i,o);0<(e=e.filter(e=>!(e.node.hideFlags&=cc_1.CCObject.Flags.HideInHierarchy))).length&&this.focusByXY(e[0].hitPoint)}return this._modeFSM.currentState.onMouseDBlDown(t)}onMouseDown(e){this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.mousePressing=!0;var t=cce.SceneFacadeManager.queryIsViewMode();return e.middleButton||!e.rightButton&&t?this.changeMode(ModeCommand.ToPan):e.rightButton&&!e.leftButton?this.changeMode(ModeCommand.ToWander):e.leftButton&&this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.WANDER&&this.changeMode(ModeCommand.ToIdle),this._modeFSM.currentState.onMouseDown(e)}onMouseMove(e){return e.altKey?this._modeFSM.currentState.modeName!==utils_1.CameraMoveMode.ORBIT&&this.changeMode(ModeCommand.ToOrbit):this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.ORBIT&&this.changeMode(ModeCommand.ToIdle),this._modeFSM.currentState.onMouseMove(e)}onMouseUp(e){this.mousePressing=!1;var t=cce.SceneFacadeManager.queryIsViewMode();return e.middleButton||!e.rightButton&&t?this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.PAN&&this.changeMode(ModeCommand.ToIdle):e.rightButton&&this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.WANDER&&this.changeMode(ModeCommand.ToIdle),t&&this.changeMode(ModeCommand.ToIdle),this._modeFSM.currentState.onMouseUp(e)}onMouseWheel(t){if(this._modeFSM.currentState.modeName!==utils_1.CameraMoveMode.WANDER){let e=t.deltaY;Math.abs(e-this.lastMouseWheelDeltaY)>this.maxMouseWheelDeltaY&&(e=this.lastMouseWheelDeltaY+Math.sign(e)*this.maxMouseWheelDeltaY),this.scale(e*this._wheelBaseScale)}this._modeFSM.currentState.onMouseWheel(t)}onKeyDown(e){this.shiftKey=e.shiftKey,this.altKey=e.altKey,e.altKey&&this._modeFSM.currentState.modeName!==utils_1.CameraMoveMode.ORBIT&&this.changeMode(ModeCommand.ToOrbit)," "===e.key.toLowerCase()&&this.changeMode(ModeCommand.ToPan),this._modeFSM.currentState.onKeyDown(e)}onKeyUp(e){switch(this.shiftKey=e.shiftKey,this.altKey=e.altKey,e.altKey||this.mousePressing||this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.ORBIT&&this.changeMode(ModeCommand.ToIdle),e.key.toLowerCase()){case" ":this._modeFSM.currentState.modeName===utils_1.CameraMoveMode.PAN&&this.changeMode(ModeCommand.ToIdle);break;case"h":this.focus()}this._modeFSM.currentState.onKeyUp(e)}onUpdate(e){this._modeFSM.currentState.onUpdate(e)}_updateGridData(t,i,o,e=0){var s=this.hTicks,a=this.vTicks,r=cc.v3(),n=(this.node.getPosition(r),r.y),h=5e3*(n/500)|0,d=-h+r.x,c=h+r.x,_=-h+r.z,l=h+r.z,m=(s.range(d,c,5e3),a.range(_,l,5e3),o.clone());m.a=0;for(let e=s.minTickLevel;e<=s.maxTickLevel;++e){var u=s.tickRatios[e];if(0<u){var M=s.ticksAtLevel(e,!0);for(let e=0;e<M.length;++e){var g,p,C=M[e];this.originAxisX_Visible&&0===C||((g=o.clone()).a=200*u,p=Math.abs(C-r.x),g.a*=1-p/h,t.push(C,r.z),t.push(C,_),t.push(C,r.z),t.push(C,l),i.push(g.x,g.y,g.z,g.w),i.push(m.x,m.y,m.z,m.w),i.push(g.x,g.y,g.z,g.w),i.push(m.x,m.y,m.z,m.w))}}}for(let e=a.minTickLevel;e<=a.maxTickLevel;++e){var v=a.tickRatios[e];if(0<v){var w=a.ticksAtLevel(e,!0);for(let e=0;e<w.length;++e){var T,f,y=w[e];this.originAxisZ_Visible&&0===y||((T=o.clone()).a=200*v,f=Math.abs(y-r.z),T.a*=1-f/h,t.push(r.x,y),t.push(d,y),t.push(r.x,y),t.push(c,y),i.push(T.x,T.y,T.z,T.w),i.push(m.x,m.y,m.z,m.w),i.push(T.x,T.y,T.z,T.w),i.push(m.x,m.y,m.z,m.w))}}}}updateGrid(){var t=[],e=[],i=[];if(this._updateGridData(t,e,this._lineColor,_lineEnd),0<t.length){for(let e=0;e<t.length;e+=2)i.push(e/2);utils_1.CameraUtils.updateVBAttr(this._gridMeshComp,cc_1.gfx.AttributeName.ATTR_POSITION,t),utils_1.CameraUtils.updateVBAttr(this._gridMeshComp,cc_1.gfx.AttributeName.ATTR_COLOR,e),utils_1.CameraUtils.updateIB(this._gridMeshComp,i)}this.updateOriginAxis()}refresh(){this.updateGrid(),cce.Engine.repaintInEditMode()}rotateCameraToDir(e,t){var i=cc.v3(),o=cc.quat(),e=(this.node.getPosition(i),this.node.getRotation(o),quat_1.MQuat.rotationTo(this._curRot,cc_1.Vec3.UNIT_Z,e),cc.v3(0,0,0));t&&(e.z=this.viewDist,vec3_1.MVec3.transformQuat(e,e,this._curRot),vec3_1.MVec3.add(this._curEye,this.sceneViewCenter,e)),(0,tween_1.tweenPosition)(i,this._curEye,300).step(e=>{this.node.setPosition(e),this.updateGrid(),cce.Engine.repaintInEditMode()}),(0,tween_1.tweenRotation)(o,this._curRot,300).step(e=>{this.node.setRotation(e),this.updateGrid()})}getDepthSize(){var e=this._camera.fov;return Math.tan(e/2*Math.PI/180)}calcCameraPosInOrtho(){var e=this.getDepthSize(),e=this._camera.orthoHeight/e;return this.viewDist<e&&(this.viewDist=e),this.node.getWorldRotation(tempQuatA),vec3_1.MVec3.transformQuat(this.forward,cc_1.Vec3.UNIT_Z,tempQuatA),vec3_1.MVec3.normalize(this.forward,this.forward),vec3_1.MVec3.multiplyScalar(this.v3a,this.forward,this.viewDist),vec3_1.MVec3.add(this.v3b,this.sceneViewCenter,this.v3a),this.v3b}isOrtho(){return this._camera.projection===ORTHO}setOrthoHeight(e){this._camera.orthoHeight=e=e<0?.01:e,cce.Gizmo.transformToolData.cameraOrthoHeight=e}changeProjection(){var e;this.isOrtho()?(e=this.calcCameraPosInOrtho(),this.node.setWorldPosition(e),this._camera.projection=PERSPECTIVE,this.emit("projection-changed",PERSPECTIVE),this.updateGrid()):(this._camera.projection=ORTHO,e=this.getDepthSize()*this.viewDist,this.setOrthoHeight(e),this.emit("projection-changed",ORTHO))}onResize(){this.updateGrid(),cce.Engine.repaintInEditMode()}zoomUp(){this.scale(20)}zoomDown(){this.scale(-20)}}exports.CameraController3D=CameraController3D;