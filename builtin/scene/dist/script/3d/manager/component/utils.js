"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),physics_2d_1=__importDefault(require("../physics-2d"));function getBoundingBox(e){const t=e.getComponent(cc_1.MeshRenderer);return t&&t.mesh?{minPosition:t.mesh.minPosition,maxPosition:t.mesh.maxPosition}:{minPosition:cc_1.Vec3.ZERO,maxPosition:cc_1.Vec3.ZERO}}function getSize(e){const t=new cc_1.Vec3;return cc_1.Vec3.subtract(t,e.maxPosition,e.minPosition),t}function getCenter(e){const t=getSize(e),c=new cc_1.Vec3;return cc_1.Vec3.scaleAndAdd(c,e.minPosition,t,.5),c}function maxComponent(e){return Math.max(e.x,Math.max(e.y,e.z))}class ComponentUtils{constructor(){this.addComponentMap={SphereCollider(e,t){if(t._prefab)return;const c=getBoundingBox(t),n=getSize(c);cc_1.Vec3.strictEquals(n,cc_1.Vec3.ZERO)||(e.radius=maxComponent(n)/2,e.center=getCenter(c))},BoxCollider(e,t){if(t._prefab)return;const c=getBoundingBox(t),n=getSize(c);cc_1.Vec3.strictEquals(n,cc_1.Vec3.ZERO)||(n.x=0===n.x?.001:n.x,n.y=0===n.y?.001:n.y,n.z=0===n.z?.001:n.z,e.size=n,e.center=getCenter(c))},ConeCollider(e,t){if(t._prefab)return;const c=getBoundingBox(t),n=getSize(c);if(!cc_1.Vec3.strictEquals(n,cc_1.Vec3.ZERO)){const t=Math.max(n.x,n.z)/2,r=n.y;t>0&&(e.radius=t),r>0&&(e.height=r),e.center=getCenter(c)}},CylinderCollider(e,t){if(t._prefab)return;const c=getBoundingBox(t),n=getSize(c);if(!cc_1.Vec3.strictEquals(n,cc_1.Vec3.ZERO)){const t=Math.max(n.x,n.z)/2,r=n.y;t>0&&(e.radius=t),r>0&&(e.height=r),e.center=getCenter(c)}},CapsuleCollider(e,t){if(t._prefab)return;const c=getBoundingBox(t),n=getSize(c);if(!cc_1.Vec3.strictEquals(n,cc_1.Vec3.ZERO)){const t=Math.max(n.x,n.z)/2,r=n.y-2*t;t>0&&(e.radius=t,e.cylinderHeight=r>0?r:0),e.center=getCenter(c)}},MeshCollider(e,t){if(t._prefab)return;const c=t.getComponent(cc_1.MeshRenderer);c&&c.mesh&&(e.mesh=c.mesh)},TerrainCollider(e,t){if(t._prefab)return;const c=t.getComponent(cc_1.Terrain);c&&c._asset&&(e.terrain=c._asset)},BoxCollider2D(e,t){const c=e.getComponent(cc_1.UITransformComponent);if(!c)return;const n=c.contentSize;0!==n.width&&0!==n.height&&(e.size=cc.size(n),e.offset.x=(.5-c.anchorX)*n.width,e.offset.y=(.5-c.anchorY)*n.height)},CircleCollider2D(e,t){const c=e.getComponent(cc_1.UITransformComponent);if(!c)return;const n=c.contentSize,r=Math.max(n.width,n.height)/2;0!==r&&(e.radius=r)},PolygonCollider2D(e,t){physics_2d_1.default.resetPoints(e)},Camera(e,t){"2d"===cce.SceneFacadeManager._projectType&&(e.visibility=cc_1.Layers.makeMaskInclude([cc_1.Layers.Enum.UI_3D,cc_1.Layers.Enum.UI_2D]),e.projection=cc_1.Camera.ProjectionType.ORTHO,e.near=0,e.clearFlags=cc_1.Camera.ClearFlag.DEPTH_ONLY),"3d"===cce.SceneFacadeManager._projectType&&(e.visibility=cc_1.Layers.Enum.DEFAULT,e.projection=cc_1.Camera.ProjectionType.PERSPECTIVE,e.clearFlags=cc_1.Camera.ClearFlag.SKYBOX)}}}}exports.default=new ComponentUtils;