"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const animation_1=__importDefault(require("../animation")),undo_manager_base_1=__importDefault(require("./undo-manager-base")),snapshot_command_1=__importDefault(require("./snapshot-command"));class AnimationUndo extends undo_manager_base_1.default{constructor(){super(),this.nodeUuid="",this.clipUuid="",this.clipDump=null,this.hasChanged=!1}getUndoData(){return{nodeUuid:this.nodeUuid,clipUuid:this.clipUuid,clipDump:this.clipDump}}getRedoData(){return this.updateCache(),this.getUndoData()}updateCache(){this.clipDump=animation_1.default.dumpClip(this.nodeUuid,this.clipUuid)}snapshot(t){try{if(!t){const i=this.getUndoData(),a=this.getRedoData();if(JSON.stringify(i)===JSON.stringify(a))return!1;t=new AnimationUndoCommand(i,a),this.hasChanged=!1}if(!t)return!1;this.push(t)}catch(t){console.error(t)}}changed(){this.hasChanged=!0}async undo(){this.hasChanged&&this.snapshot(),await super.undo()}async redo(){this.hasChanged&&this.snapshot(),await super.redo()}reset(t,i){"string"==typeof t&&"string"==typeof i&&(this.nodeUuid=t,this.clipUuid=i,this.updateCache(),this.rebase())}}const animationUndo=new AnimationUndo;class AnimationUndoCommand extends snapshot_command_1.default{async excute(t){const{nodeUuid:i,clipUuid:a,clipDump:e}=t;try{await animation_1.default.restoreFromDump(i,a,e),animationUndo.updateCache()}catch(t){console.error(t)}}}exports.default=animationUndo;