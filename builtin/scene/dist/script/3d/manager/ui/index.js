"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UIManager=void 0;const selection_1=__importDefault(require("../../../public/selection")),node_1=__importDefault(require("../node")),node_2=__importDefault(require("../../../utils/node")),cc_1=require("cc"),vec3_1=require("../../../utils/math/vec3"),v3_a=new cc_1.Vec3;class UIManager{alignSelection(e){const n=selection_1.default.query();if(n.length<=1)return;let c=n.map(e=>node_1.default.query(e)).filter(Boolean),t=1e10,a=1e10,r=-1e10,o=-1e10;const d=(c=c.filter(e=>{let n=e.parent;for(;n;){if(-1!==c.indexOf(n))return!1;n=n.parent}return!0})).map(e=>{const n=node_2.default.getWorldBounds(e);return t=Math.min(t,n.x),a=Math.min(a,n.y),r=Math.max(r,n.xMax),o=Math.max(o,n.yMax),{node:e,bounds:n}}),s=new cc_1.Rect(t,a,r-t,o-a),u=c.map(e=>e.uuid),i=cce.SceneFacadeManager.beginRecording(u);d.forEach(n=>{const c=n.node;let t;switch(e){case"top":t=new cc_1.Vec3(0,s.yMax-n.bounds.yMax,0);break;case"v-center":t=new cc_1.Vec3(0,s.center.y-n.bounds.center.y,0);break;case"bottom":t=new cc_1.Vec3(0,s.y-n.bounds.y,0);break;case"left":t=new cc_1.Vec3(s.x-n.bounds.x,0,0);break;case"h-center":t=new cc_1.Vec3(s.center.x-n.bounds.center.x,0,0);break;case"right":t=new cc_1.Vec3(s.xMax-n.bounds.xMax,0,0);break;default:t=new cc_1.Vec3}const a=node_2.default.getWorldPosition(c);node_2.default.setWorldPosition(c,vec3_1.MVec3.add(v3_a,a,t))}),cce.SceneFacadeManager.endRecording(i)}distributeSelection(e){const n=selection_1.default.query();if(n.length<=1)return;let c=n.map(e=>node_1.default.query(e)).filter(Boolean);const t=(c=c.filter(e=>{let n=e.parent;for(;n;){if(-1!==c.indexOf(n))return!1;n=n.parent}return!0})).map(e=>{return{node:e,bounds:node_2.default.getWorldBounds(e)}});t.sort((n,c)=>{let t=1;switch(e){case"top":t=n.bounds.yMax-c.bounds.yMax;break;case"v-center":t=n.bounds.center.y-c.bounds.center.y;break;case"bottom":t=n.bounds.y-c.bounds.y;break;case"left":t=n.bounds.x-c.bounds.x;break;case"h-center":t=n.bounds.center.x-c.bounds.center.x;break;case"right":t=n.bounds.xMax-c.bounds.xMax}return t});const a=t.length-1,r=t[0].bounds,o=t[a].bounds,d=c.map(e=>e.uuid),s=cce.SceneFacadeManager.beginRecording(d);t.forEach((n,c)=>{const t=n.node,d=n.bounds;let s;switch(e){case"top":s=new cc_1.Vec3(0,r.yMax+(o.yMax-r.yMax)*c/a-d.yMax,0);break;case"v-center":s=new cc_1.Vec3(0,r.center.y+(o.center.y-r.center.y)*c/a-d.center.y,0);break;case"bottom":s=new cc_1.Vec3(0,r.y+(o.y-r.y)*c/a-d.y,0);break;case"left":s=new cc_1.Vec3(r.x+(o.x-r.x)*c/a-d.x,0,0);break;case"h-center":s=new cc_1.Vec3(r.center.x+(o.center.x-r.center.x)*c/a-d.center.x,0);break;case"right":s=new cc_1.Vec3(r.xMax+(o.xMax-r.xMax)*c/a-d.xMax,0,0);break;default:s=new cc_1.Vec3(0,0,0)}const u=node_2.default.getWorldPosition(t);node_2.default.setWorldPosition(t,vec3_1.MVec3.add(v3_a,u,s))}),cce.SceneFacadeManager.endRecording(s)}}exports.UIManager=UIManager,exports.default=new UIManager;