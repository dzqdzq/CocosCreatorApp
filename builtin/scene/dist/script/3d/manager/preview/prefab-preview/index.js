"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrefabPreview=void 0;const Interactive_preview_1=require("../Interactive-preview"),misc_1=require("../../../../utils/misc"),cc_1=require("cc"),node_1=__importDefault(require("../../../../utils/node"));class PrefabPreview extends Interactive_preview_1.InteractivePreview{constructor(){super(...arguments),this.canvasNode=null}createNodes(e){this.lightComp=new cc.Node("Prefab Preview Light").addComponent(cc_1.DirectionalLight),this.lightComp.node.setRotationFromEuler(-45,-45,0),this.lightComp.node.parent=e}async setPrefab(e){if(!e)return console.warn("Failed to instantiate prefab in Prefab preview, by uuid: "+e),null;this._modelNode&&this._modelNode.isValid&&(this._modelNode.destroy(),this._modelNode.parent=null),this.canvasNode&&this.canvasNode.isValid&&(this.canvasNode.destroy(),this.canvasNode.parent=null),cc_1.assetManager.assets.has(e)&&(cc_1.assetManager.releaseAsset(cc_1.assetManager.assets.get(e)),cc_1.assetManager.assets.remove(e));try{var t=await(0,misc_1.promisify)(cc_1.assetManager.loadAny)(e);this._modelNode=(0,cc_1.instantiate)(t),(0<this._modelNode.getComponentsInChildren(cc_1.UITransform).length?(this.canvasNode=new cc_1.Node("New Canvas"),this.canvasNode.addComponent(cc_1.Canvas),this.scene.addChild(this.canvasNode),this.canvasNode):this.scene).addChild(this._modelNode),this._modelNode.setPosition(0,0,0),this.cameraComp.enabled=!0,this.resetCamera(this._modelNode),this.perfectCameraView(node_1.default.getBoundaryOfMeshNodes([this.canvasNode||this._modelNode]))}catch(e){console.warn(e)}}resetCameraView(){this._modelNode&&(this.resetCamera(this._modelNode),this.perfectCameraView(node_1.default.getBoundaryOfMeshNodes([this.canvasNode||this._modelNode])))}}exports.PrefabPreview=PrefabPreview;