"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),index_1=__importDefault(require("./ipc/index")),message_1=require("./message");class EffectManager{constructor(){this._uuidSet=new Set}async init(){const e=(await index_1.default.request("query-effects")).map(e=>this.registerEffect(e));await Promise.all(e)}registerEffects(e){e.forEach(e=>{this.registerEffect(e)})}registerEffect(e){return new Promise(t=>{cc_1.assetManager.loadAny(e,(s,r)=>{if(s)return console.error(s),t();this._uuidSet.add(e),message_1.messageManager.broadcast("scene:effect-update",e),t()})})}removeEffect(e){return!!this._uuidSet.has(e)&&(cc_1.EffectAsset&&cc_1.EffectAsset.remove?(this._uuidSet.delete(e),cc_1.EffectAsset.remove(e),message_1.messageManager.broadcast("scene:effect-update",e),!0):(console.warn("cannot call method cc.EffectAsset.remove"),!1))}removeEffects(e){e.map(e=>{this.removeEffect(e)})}updateEffect(e){this.removeEffect(e),this.registerEffect(e)}}exports.default=new EffectManager;