"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),stateInfo_1=__importDefault(require("./stateInfo"));let resolutions={default:"Free Aspect",sixteenToTen:"16 : 10",sixteenToNine:"16 : 9",fiveToFour:"5 : 4",fourToThree:"4 : 3"},customs={};function checkBtn(e,t){-1!==e.target.className.indexOf("checked")?(e.target.className="",t&&t(!1)):(e.target.className="checked",t&&t(!0))}class CustomResolution{constructor(){this.currSize=new cc_1.Vec2(10,10),this.isRatio=!0,this.currLabel=null,this._document=null,this._centerDiv=null,this._delBtn=null,this._cancelBtn=null,this._okBtn=null,this._labelInput=null,this._widthInput=null,this._heightInput=null}_createButtons(e){let t=this,s=document.createElement("div");s.className="item btns";let i=document.createElement("button");this._delBtn=i,i.className="del",i.textContent="Delete",i.addEventListener("click",()=>{if(t._document.body.removeChild(t.resPanel),t.resPanel=null,customs[t.customResSelect.value]){let e=Object.keys(resolutions).length+Object.keys(customs).indexOf(t.customResSelect.value);toolbar.resolution.remove(e),delete customs[t.customResSelect.value],Editor.Profile.setConfig("scene","gameView.resolutions",customs,"global"),toolbar.resolution.value="default";const s=new Event("change");toolbar.resolution.dispatchEvent(s)}});let n=document.createElement("button");n.className="cancel",n.textContent="Cancel",n.addEventListener("click",()=>{t._document.body.removeChild(t.resPanel),t.resPanel=null,toolbar.cancelCustomResolution()}),this._cancelBtn=n,this._cancelBtn.style.marginLeft="30px";let l=document.createElement("button");l.className="ok",l.textContent="Ok",l.addEventListener("click",()=>{t._document.body.removeChild(t.resPanel),t.resPanel=null,null===t.currLabel&&(t.currLabel=`${t.currSize.x}${t._centerDiv.textContent}${t.currSize.y}`),toolbar.customResolution(this)}),this._okBtn=l,i.style.display="none",s.appendChild(i),s.appendChild(n),s.appendChild(l),e.appendChild(s)}_setResolutionValue(e,t=!1){let s=parseFloat(e.value);this.isRatio?s=s<=0?1:Math.ceil(s):s<10&&(s=10),e.value=`${s}`,t?this.currSize.x=s:this.currSize.y=s}_createSize(e){let t=this,s=document.createElement("div");s.className="item";let i=document.createElement("label");i.className="label",i.textContent="width & height";let n=document.createElement("div");n.className="sizeItem right";let l=document.createElement("input");l.type="number",l.min="10",l.value="10",l.className="width",l.addEventListener("change",()=>{t._setResolutionValue(l,!0)}),this._widthInput=l;let a=document.createElement("div");a.className="center",a.innerText=":",this._centerDiv=a;let o=document.createElement("input");o.type="number",o.min="10",o.value="10",o.className="height",o.addEventListener("change",()=>{t._setResolutionValue(o)}),this._heightInput=o,this.typeSelect.addEventListener("change",e=>{switch(e.target.value){case"fixed":a.innerText="x",t.isRatio=!1;break;case"ratio":a.innerText=":",t.isRatio=!0}}),n.appendChild(l),n.appendChild(a),n.appendChild(o),s.appendChild(i),s.appendChild(n),e.appendChild(s)}_createType(e){let t=document.createElement("div");t.className="item";let s=document.createElement("label");s.className="type",s.textContent="type";let i=document.createElement("select");i.className="typeSelect right",this.typeSelect=i;let n=document.createElement("option");n.value="ratio",n.textContent="AspectRatio";let l=document.createElement("option");l.textContent="FixedResolution",l.value="fixed",i.appendChild(n),i.appendChild(l),t.appendChild(s),t.appendChild(i),e.appendChild(t)}_createLabel(e){let t=this,s=document.createElement("div");s.className="item";let i=document.createElement("label");i.className="label",i.textContent="label";let n=document.createElement("input");n.type="text",n.className="inputLabel right",n.addEventListener("change",()=>{t.currLabel=n.value}),this._labelInput=n,s.appendChild(i),s.appendChild(n),e.appendChild(s)}_switchDelBtn(e){e?(this._delBtn.style.display="none",this._cancelBtn.style.marginLeft="30px"):(this._delBtn.style.display="inline",this._cancelBtn.style.marginLeft="0px")}_customList(e){let t=document.createElement("div");t.className="item";let s=document.createElement("label");s.className="custom",s.textContent="customs";let i=document.createElement("select");i.className="typeSelect right",this.customResSelect=i,i.addEventListener("change",e=>{if(""!==e.target.value){this._switchDelBtn(!1);let t=e.target.value;this._labelInput.value=t,customs[t][0]?(this._centerDiv.innerText=":",this.typeSelect.value="ratio"):(this._centerDiv.innerText="x",this.typeSelect.value="fixed"),this._widthInput.value=customs[t][1][0],this._heightInput.value=customs[t][1][1]}else this._switchDelBtn(!0)});let n=document.createElement("option");n.value="",n.textContent="NONE",i.appendChild(n);let l=Object.keys(customs);for(let e=0;e<l.length;e++){let t=document.createElement("option");t.value=l[e],t.textContent=l[e],i.appendChild(t)}t.appendChild(s),t.appendChild(i),e.appendChild(t)}create(e){this.currLabel=null,this.isRatio=!0,this._document=e;let t=e.createElement("div");this.resPanel=t,t.id="resPanel";let s=e.createElement("label");s.className="title",s.textContent="Resolution";let i=e.createElement("div");i.className="content",this._customList(i),this._createType(i),this._createLabel(i),this._createSize(i),this._createButtons(i),t.appendChild(s),t.appendChild(i),e.body.appendChild(t)}}class Toolbar{constructor(){this.height=28,this.btnHeight=25,this.currFps=60,this.isRotate=!1,this.currRatio=0,this.currRes=new cc_1.Vec2(0,0),this.currResLabel="default",this._document=null,this._resCustomEle=null}_createBar(){this._bar=document.createElement("div"),this._bar.id="gtoolbar"}get resolution(){return this._resolution}_selectRes(e){switch(this.currRes=new cc.Vec2(0,0),"custom"!==e.target.value&&(this.currResLabel=e.target.value),e.target.value){case"default":this.currRatio=0;break;case"sixteenToTen":this.currRatio=1.6;break;case"sixteenToNine":this.currRatio=16/9;break;case"fiveToFour":this.currRatio=5/4;break;case"fourToThree":this.currRatio=4/3;break;case"custom":return void(new CustomResolution).create(this._document);default:let t=customs[e.target.value];t[0]?this.currRatio=t[1][0]/t[1][1]:this.currRes=new cc_1.Vec2(t[1][0],t[1][1])}cc.gameView.setResolution(this.currRatio,this.isRotate,this.currRes)}customResolution(e){let t=e.currLabel,s=document.createElement("option");s.textContent=t;let i=!1;customs[t]&&(i=!0),customs[t]=[e.isRatio,[e.currSize.x,e.currSize.y]],Editor.Profile.setConfig("scene","gameView.resolutions",customs,"global"),i||this._resolution.insertBefore(s,this._resCustomEle),this._resolution.value=t,this.resolution.dispatchEvent(new Event("change"))}cancelCustomResolution(){this._resolution.value=this.currResLabel}_createResolution(){let e=document.createElement("div");e.className="item",this._resolution=document.createElement("select");for(let e in resolutions){let t=document.createElement("option");t.value=e,t.innerText=resolutions[e],this._resolution.appendChild(t)}let t=Object.keys(customs);for(let e=0;e<t.length;e++){let s=document.createElement("option");s.value=t[e],s.textContent=t[e],this._resolution.appendChild(s)}let s=document.createElement("option");s.value="custom",s.innerText="Custom",this._resCustomEle=s,this._resolution.addEventListener("change",this._selectRes.bind(this)),this._resolution.appendChild(s),e.appendChild(this._resolution),this._bar.appendChild(e)}_createRotate(){let e=document.createElement("div");e.className="item",this._rotate=document.createElement("button"),this._rotate.addEventListener("click",this._onRotate.bind(this)),this._rotate.id="btn-rotate",this._rotate.innerText="Rotate",e.appendChild(this._rotate),this._bar.appendChild(e)}_onShowFPS(e){checkBtn(e,e=>{e?(stateInfo_1.default.isShow=!0,stateInfo_1.default.show()):(stateInfo_1.default.isShow=!1,stateInfo_1.default.hide())})}_onRotate(e){let t=this;checkBtn(e,e=>{t.isRotate=!!e,cc.gameView.setResolution(t.currRatio,t.isRotate,t.currRes)})}_setFps(e){this.currFps=e.target.value,cc.gameView.setFps(this.currFps)}_createShowFps(){let e=document.createElement("div");e.className="item",this._state=document.createElement("button"),this._state.addEventListener("click",this._onShowFPS.bind(this)),this._state.id="show-fps",this._state.innerText="Show FPS",e.appendChild(this._state),this._bar.appendChild(e)}_createFps(){this._fps=document.createElement("div"),this._fps.className="item";let e=document.createElement("span");e.innerText="FPS:",this._fps.appendChild(e);let t=document.createElement("input");t.type="tel",t.value=`${this.currFps}`,cc.gameView.setFps(this.currFps),t.addEventListener("change",this._setFps.bind(this)),this._fps.appendChild(t),this._bar.appendChild(this._fps)}async createToolbar(e){this._document=e;let t=await Editor.Profile.getConfig("scene","gameView.resolutions");t&&(customs=t),this._createBar(),this._createShowFps(),this._createFps(),this._createResolution(),this._createRotate(),e.body.appendChild(this._bar)}}let toolbar=new Toolbar;exports.default=toolbar;