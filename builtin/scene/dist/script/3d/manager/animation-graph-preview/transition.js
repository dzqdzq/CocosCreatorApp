"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&("get"in r?e.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransitionPreview=void 0;const animationApi=__importStar(require("cc/editor/new-gen-anim")),base_1=require("./base");class TransitionPreview extends base_1.AnimationGraphPreviewBase{constructor(){super(...arguments),this.transition=null}hide(){super.hide(),this.transition=null}show(t,e,i){if(!i)return base_1.PreviewState.NO_ANIMATION_GRAPH;if(!this.hasModel())return base_1.PreviewState.NO_MODEL;if(!animationApi.isAnimationTransition(t))return base_1.PreviewState.ILLEGAL_TRANSITION;this.playState!==base_1.PlayState.STOP&&this.stop(),this.setVariables(i);const n=t=>!!t&&(!(t instanceof animationApi.ClipMotion)||!!t.clip);let r,a;{const i=[...extractMotionStatesAsPreviewSource(e,t.from)];if(0===i.length)return base_1.PreviewState.NO_TRANSITION_SOURCE_MOTION;const a=i[0];if(!a.motion||!n(a.motion))return base_1.PreviewState.NO_TRANSITION_SOURCE_MOTION;r=a.motion}{const i=[...extractMotionStatesAsPreviewDestination(e,t.to)];if(0===i.length)return base_1.PreviewState.NO_TRANSITION_DESTINATION_MOTION;const r=i[0];if(!r.motion||!n(r.motion))return base_1.PreviewState.NO_TRANSITION_DESTINATION_MOTION;a=r.motion}return this.previewer.setSourceMotion(r),this.previewer.setTargetMotion(a),this.transition=t,this.cameraComp.enabled=!0,this.setProp(),this.active=!0,base_1.PreviewState.NO_ERROR}setProp(){this.transition&&(this.previewer.setTransitionDuration(this.transition.duration),this.previewer.setRelativeTransitionDuration(this.transition.relativeDuration),this.previewer.setExitTimes(this.transition.exitCondition),this.previewer.setExitTimeEnabled(this.transition.exitConditionEnabled),this.previewer.setDestinationStart(this.transition.destinationStart),this.update())}createPreviewer(t){return new animationApi.TransitionPreviewer(t)}getLightName(){return"transition preview light"}getUpdateMessageName(){return"scene:update-transition-preview"}}function*extractMotionStatesAsPreviewSource(t,e){yield*function*t(e,i,n){if(n.has(i))return;n.add(i);if(i instanceof animationApi.MotionState)yield i;else if(i===e.exitState)for(const r of e.getIncomings(i))yield*t(e,r.from,n);else if(i===e.anyState)for(const i of e.states())yield*t(e,i,n);else i instanceof animationApi.SubStateMachine&&(yield*t(i.stateMachine,i.stateMachine.exitState,n))}(t,e,new Set)}function*extractMotionStatesAsPreviewDestination(t,e){yield*function*t(e,i,n){if(n.has(i))return;if(i instanceof animationApi.MotionState)yield i;else if(i===e.entryState)for(const r of e.getOutgoings(i))yield*t(e,r.to,n);else i instanceof animationApi.SubStateMachine&&(yield*t(i.stateMachine,i.stateMachine.entryState,n))}(t,e,new Set)}exports.TransitionPreview=TransitionPreview;