"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),plist=__importStar(require("plist")),fs_1=require("fs"),ElectronModule=require("@base/electron-module"),EditorExtends=ElectronModule.require("EditorExtends");class Particle2DManager{async exportParticlePlist(e){const t=EditorExtends.Component.getComponent(e);if(!t)return;let r=(await Editor.Dialog.save({title:"Save Particle",path:path_1.join(Editor.Project.path,"assets"),filters:[{name:"Particle",extensions:["plist"]}]})).filePath;if(!r)return;const a=path_1.join(Editor.Project.path,"assets");if(Editor.Utils.Path.contains(a,r))try{const e=t.file&&t.file._uuid||"db://internal/default_ui/atom.plist",i=await Editor.Message.request("asset-db","query-path",e),o=plist.parse(fs_1.readFileSync(i,"utf8")),n=this._applyPlistData(o,t),s="db://assets/"+path_1.relative(a,r);return await Editor.Message.request("asset-db","create-asset",s,plist.build(n),{overwrite:!0})}catch(e){return void console.error(e)}else await Editor.Dialog.warn(Editor.I18n.t("scene.messages.warning"),{detail:Editor.I18n.t("scene.messages.particle_system_2d.export_error"),buttons:[Editor.I18n.t("scene.messages.confirm")]})}_applyPlistData(e,t){e.maxParticles=t.totalParticles,e.angle=t.angle,e.angleVariance=t.angleVar,e.duration=t.duration,e.blendFuncSource=t.srcBlendFactor,e.blendFuncDestination=t.dstBlendFactor,e.startColorRed=t.startColor.r/255,e.startColorGreen=t.startColor.g/255,e.startColorBlue=t.startColor.b/255,e.startColorAlpha=t.startColor.a/255,e.startColorVarianceRed=t.startColorVar.r/255,e.startColorVarianceGreen=t.startColorVar.g/255,e.startColorVarianceBlue=t.startColorVar.b/255,e.startColorVarianceAlpha=t.startColorVar.a/255,e.finishColorRed=t.endColor.r/255,e.finishColorGreen=t.endColor.g/255,e.finishColorBlue=t.endColor.b/255,e.finishColorAlpha=t.endColor.a/255,e.finishColorVarianceRed=t.endColorVar.r/255,e.finishColorVarianceGreen=t.endColorVar.g/255,e.finishColorVarianceBlue=t.endColorVar.b/255,e.finishColorVarianceAlpha=t.endColorVar.a/255,e.startParticleSize=t.startSize,e.startParticleSizeVariance=t.startSizeVar,e.finishParticleSize=t.endSize,e.finishParticleSizeVariance=t.endSizeVar,e.positionType=t._positionType,e.sourcePositionVariancex=t.posVar.x,e.sourcePositionVariancey=t.posVar.y,e.rotationStart=t.startSpin,e.rotationStartVariance=t.startSpinVar,e.rotationEnd=t.endSpin,e.rotationEndVariance=t.endSpinVar,e.emitterType=t.emitterMode,e.gravityx=t.gravity.x,e.gravityy=t.gravity.y,e.speed=t.speed,e.speedVariance=t.speedVar,e.radialAcceleration=t.radialAccel,e.radialAccelVariance=t.radialAccelVar,e.tangentialAcceleration=t.tangentialAccel,e.tangentialAccelVariance=t.tangentialAccelVar,e.rotationIsDir=t.rotationIsDir,e.maxRadius=t.startRadius,e.maxRadiusVariance=t.startRadiusVar,e.minRadius=t.endRadius,e.minRadiusVariance=t.endRadiusVar,e.rotatePerSecond=t.rotatePerS,e.rotatePerSecondVariance=t.rotatePerSVar,e.particleLifespan=t.life,e.particleLifespanVariance=t.lifeVar,e.emissionRate=t.emissionRate;const r=t.spriteFrame;return r&&r._uuid&&(e.spriteFrameUuid=r._uuid,delete e.textureFileName,delete e.textureImageData),e}}exports.default=new Particle2DManager;