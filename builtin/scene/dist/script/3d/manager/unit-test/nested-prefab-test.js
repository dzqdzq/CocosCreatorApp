"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.nestedPrefabTest=void 0;const node_1=__importDefault(require("../node")),cc_1=require("cc");function getPrefabInfo(e){return e._prefab}const cubeAssetUUID="30da77a1-f02d-4ede-aa56-403452ee7fde",boxColliderClassName=cc_1.js.getClassName(cc_1.BoxCollider),testPrefabAssetUrl="db://assets/testPrefab.prefab",childPrefabAssetUrl="db://assets/childPrefab.prefab";class NestedPrefabTest{async test(e){var t;console.log("NestedPrefabTest-----------");let r=await e.createNode({name:"testPrefabRootNode"});if(!r)return!1;const s=await e.createPrefab(r,testPrefabAssetUrl);if(!s)return!1;await new Promise(e=>{setTimeout(function(){e()},1200)});let a=node_1.default.query(r);const n=getPrefabInfo(a);if(!(null===n||void 0===n?void 0:n.fileId))return!1;const o=null===(t=n.instance)||void 0===t?void 0:t.propertyOverrides;if(!o||4!==o.length)return console.error("property overrides doesn't match"),!1;e.openScene(s),await new Promise(e=>{setTimeout(function(){e()},500)});let i=cc_1.director.getScene();if(!i)return console.error("scene is null"),!1;let c=(a=i.children[0]).uuid;await e.createNode({name:"childCylinderNode",assetUuid:"ab3e16f9-671e-48a7-90b7-d0884d9cbb85",parent:c});const d=await e.createNode({name:"childNode",assetUuid:cubeAssetUUID,parent:c}),l=(await e.createNode({name:"CubeNode",assetUuid:cubeAssetUUID,parent:d}),await e.createPrefab(d,childPrefabAssetUrl));if(await new Promise(e=>{setTimeout(function(){e()},1200)}),await e.saveScene(),await e.openScene(l),await new Promise(e=>{setTimeout(function(){e()},500)}),await e.saveScene(),await e.openScene(s),await new Promise(e=>{setTimeout(function(){e()},500)}),!(i=cc_1.director.getScene()))return console.error("scene is null"),!1;c=(a=i.children[0]).uuid;let u=a.children[1];await e.createNode({name:"CubeNode2",assetUuid:cubeAssetUUID,parent:u.uuid});let f=u.children[0];return node_1.default.createComponent(f.uuid,boxColliderClassName),await e.saveScene(),await e.closeScene(),await e.openScene(s),await new Promise(e=>{setTimeout(function(){e()},500)}),(i=cc_1.director.getScene())?(c=(a=i.children[0]).uuid,2!==(u=a.children[1]).children.length?(console.error(`mounted child in nested prefab save failed. ${u.children.length}`),!1):(f=u.children[0]).getComponent(boxColliderClassName)?(await e.closeScene(),(i=cc_1.director.getScene())?(r=(a=i.children[0]).uuid,e.removeNode({uuid:r}),await Editor.Message.request("asset-db","delete-asset",testPrefabAssetUrl),await Editor.Message.request("asset-db","delete-asset",childPrefabAssetUrl),!0):(console.error("scene is null"),!1)):(console.error("mounted component in nested prefab save failed"),!1)):(console.error("scene is null"),!1)}}const nestedPrefabTest=new NestedPrefabTest;exports.nestedPrefabTest=nestedPrefabTest;