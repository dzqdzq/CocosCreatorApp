"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneSelection=void 0;const cc_1=require("cc"),selection_1=__importDefault(require("../../public/selection")),node_1=__importDefault(require("./node")),event_emitter_1=require("../../utils/event-emitter"),engine_1=require("./engine"),operation_1=__importDefault(require("./operation"));function checkToSetAnimState(e){const t=[];e.forEach(e=>{const o=node_1.default.query(e);o&&t.push(o)}),engine_1.engineManager.checkToSetAnimState(t)}class SceneSelection extends event_emitter_1.EventEmitter{constructor(){super(...arguments),this._hover=void 0,this._isMouseDown=!1}onMouseDown(e){return this._isMouseDown=!0,!0}onMouseUp(e){return this._isMouseDown=!1,!0}onKeyDown(e){return this._isMouseDown||e.keyCode!==cc_1.KeyCode.ESCAPE||this.clear(),!0}init(){selection_1.default.on("select",(e,t)=>{const o=node_1.default.query(e);o&&o._components&&(o.components.forEach(e=>{if(e&&e.onFocusInEditor)try{e.onFocusInEditor()}catch(e){console.error(e)}}),this.emit("select",e,t),checkToSetAnimState(selection_1.default.query()))}),selection_1.default.on("unselect",(e,t)=>{const o=node_1.default.query(e);if(!o||!o._components)return;o.components.forEach(e=>{if(e&&e.onLostFocusInEditor)try{e.onLostFocusInEditor()}catch(e){console.error(e)}}),this.emit("unselect",e,t);const n=selection_1.default.query(),c=n.indexOf(e);c>=0&&n.splice(c,1),checkToSetAnimState(n)}),operation_1.default.on("mousedown",this.onMouseDown.bind(this)),operation_1.default.on("mouseup",this.onMouseUp.bind(this)),operation_1.default.on("keydown",this.onKeyDown.bind(this)),cc_1.director.once(cc_1.Director.EVENT_AFTER_SCENE_LAUNCH,()=>{cc_1.director.once(cc_1.Director.EVENT_AFTER_UPDATE,()=>{Editor.Selection.getSelected("node").filter(cce.Node.query).forEach(this.select)})})}isSelect(e){return selection_1.default.isSelect(e)}query(){return selection_1.default.query()}select(e){selection_1.default.select(e)}unselect(e){selection_1.default.unselect(e)}clear(){selection_1.default.clear()}reset(){selection_1.default.clear()}notice(){selection_1.default.notice()}_select(e){selection_1.default._select(e)}_unselect(e){selection_1.default._unselect(e)}}exports.SceneSelection=SceneSelection,exports.default=new SceneSelection;