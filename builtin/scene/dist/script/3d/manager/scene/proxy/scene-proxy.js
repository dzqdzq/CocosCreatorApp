"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const node_1=__importDefault(require("../../node")),message_1=require("../../message");class SceneProxy{constructor(e,r){this.isOpen=!1,this._staging=null,this.rootUuid="",this._isSoftReloading=!1,this._needOneMoreReload=!1,this._PrefabUUIDMap=new Map,this._sceneMgr=e,this._sceneFacade=r}async open(e){return this.rootUuid=e,this.isOpen=!0,Promise.resolve(!0)}async checkClose(){return Promise.resolve(!0)}async close(){return this.isOpen=!1,Promise.resolve(!0)}async reload(){return Promise.resolve(!0)}async softReload(e=null){return Promise.resolve(!0)}async serialize(){return Promise.resolve(!0)}async queryDirty(){return Promise.resolve(!1)}async save(e){return Promise.resolve(!0)}async staging(){return Promise.resolve(!0)}async restore(e){return Promise.resolve(!0)}async patch(){return Promise.resolve(!0)}sendModeChangeMsg(e){this._sceneMgr.emit("mode-change",e),message_1.messageManager.broadcast("scene:change-mode",e)}queryCurrentSceneUuid(){return""}getRootNode(){return null}generatePrefabUUIDMap(e,r){if(!r)return;const t=e._prefab;let s=r;t&&(t.instance&&(s=new Map,r.set(t.instance.fileId,s)),s.set(t.fileId,e.uuid));for(let r=0;r<e.children.length;r++){const t=e.children[r];this.generatePrefabUUIDMap(t,s)}}storePrefabUUID(e){const r=new Map;for(let t=0;t<e.children.length;t++){const s=e.children[t];this.generatePrefabUUIDMap(s,r)}return r}applyPrefabUUID(e,r){if(!r)return;const t=e._prefab;let s=r;if(t&&(t.instance&&(s=r.get(t.instance.fileId)),s)){const r=s.get(t.fileId);node_1.default.changeNodeUUID(e.uuid,r)}for(let r=0;r<e.children.length;r++){const t=e.children[r];this.applyPrefabUUID(t,s)}}restorePrefabUUID(e,r){for(let t=0;t<e.children.length;t++){const s=e.children[t];this.applyPrefabUUID(s,r)}}storeScenePrefabUUID(){const e=cc.director.getScene();if(e){const r=this.storePrefabUUID(e);this._PrefabUUIDMap.set(e.uuid,r)}}restoreScenePrefabUUID(){const e=cc.director.getScene(),r=this._PrefabUUIDMap.get(e.uuid);r&&this.restorePrefabUUID(cc.director.getScene(),r)}}exports.default=SceneProxy;