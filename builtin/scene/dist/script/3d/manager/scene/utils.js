"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc");class SceneUtil{async loadSceneByUuid(e){return new Promise((t,r)=>{clearTimeout(this.timer),cc_1.assetManager.loadAny(e,{reloadAsset:!0},null,(n,i)=>{if(clearTimeout(this.timer),n)r(n);else if(i instanceof cc_1.SceneAsset){const e=i.scene;e._id=i._uuid,e._name=i._name;try{cc.director.runSceneImmediate(e),t()}catch(n){r(n)}}else r(new Error("The asset "+e+" is not a scene"))});const n=()=>setTimeout(async()=>{if(1===(await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1})).response)return r(new Error("Open scene timeout"));this.timer=n()},2e4);this.timer=n()})}async loadSceneByNode(e){return new Promise((t,r)=>{clearTimeout(this.timer);const n=()=>setTimeout(async()=>{if(1===(await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1})).response)return r(new Error("Open scene timeout"));this.timer=n()},2e4);this.timer=n();try{cc.director.runSceneImmediate(e),clearTimeout(this.timer),t()}catch(e){r(e)}})}async loadSceneByJson(e){return new Promise((t,r)=>{clearTimeout(this.timer),cc_1.assetManager.loadWithJson(e,{reloadAsset:!0},null,(e,n)=>{if(e)return clearTimeout(this.timer),r(e);try{cc.director.runSceneImmediate(n),clearTimeout(this.timer),t()}catch(e){r(e)}});const n=()=>setTimeout(async()=>{if(1===(await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1})).response)return r(new Error("Open scene timeout"));this.timer=n()},2e4);this.timer=n()})}async loadPrefab(e){return new Promise((t,r)=>{cc_1.assetManager.loadAny(e,(n,i)=>n?r(n):i instanceof cc.Prefab?void t(i):r("Open resources are not prefabricated! - "+e))})}async loadPrefabByJson(e){return new Promise((t,r)=>{cc_1.assetManager.loadWithJson(e,(e,n)=>e?r(e):n instanceof cc.Prefab?void t(n):r("Open json are not prefabricated! - "))})}unloadPrefab(e){cc_1.assetManager.releaseAsset(cc_1.assetManager.assets.get(e))}recursiveNode(e,t){t(e),e.children&&e.children.forEach(e=>this.recursiveNode(e,t))}}exports.default=new SceneUtil;