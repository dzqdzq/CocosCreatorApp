"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc");class SceneUtil{static Timeout=6e4;timer;async showWarnDialog(){var e=Editor.I18n.t("scene.messages.loadSceneTimeoutTips.message"),t=Editor.I18n.t("scene.messages.loadSceneTimeoutTips.waiting"),r=Editor.I18n.t("scene.messages.loadSceneTimeoutTips.interrupt");return Editor.Dialog.warn(e,{buttons:[t,r],default:0,cancel:1})}async loadSceneByUuid(a){return new Promise((s,i)=>{let n=!1;clearTimeout(this.timer),cc_1.assetManager.loadAny(a,null,(e,t)=>{if(clearTimeout(this.timer),n=!0,e)i(e);else if(t instanceof cc_1.SceneAsset){var r=t.scene;r._id=t._uuid,r._name=t._name;try{cc.director.runSceneImmediate(r),s(r)}catch(e){i(e)}}else i(new Error("The asset "+a+" is not a scene"))});const t=()=>setTimeout(async()=>{var e;if(!n)return 0!==(e=await this.showWarnDialog()).response&&n||(this.timer=t()),1===e.response?i(new Error("Open scene timeout")):void 0},SceneUtil.Timeout);this.timer=t()})}async loadSceneByNode(s){return new Promise((e,t)=>{clearTimeout(this.timer);const r=()=>setTimeout(async()=>{if(1===(await this.showWarnDialog()).response)return t(new Error("Open scene timeout"));this.timer=r()},SceneUtil.Timeout);this.timer=r();try{cc.director.runSceneImmediate(s),clearTimeout(this.timer),e()}catch(e){t(e)}})}async loadSceneByJson(e){return new Promise((r,s)=>{let i=!1;clearTimeout(this.timer),cc_1.assetManager.loadWithJson(e,null,(e,t)=>{if(clearTimeout(this.timer),i=!0,e)return s(e);try{cc.director.runSceneImmediate(t),r(t)}catch(e){s(e)}});const t=()=>setTimeout(async()=>{var e;if(!i)return 0!==(e=await this.showWarnDialog()).response&&i||(this.timer=t()),1===e.response?s(new Error("Open scene timeout")):void 0},SceneUtil.Timeout);this.timer=t()})}async loadPrefab(i){return new Promise((r,s)=>{cc_1.assetManager.loadAny(i,(e,t)=>e?s(e):t instanceof cc.Prefab?void r(t):s("Open resources are not prefabricated! - "+i))})}async loadPrefabByJson(e){return new Promise((r,s)=>{cc_1.assetManager.loadWithJson(e,(e,t)=>e?s(e):t instanceof cc.Prefab?void r(t):s("Open json are not prefabricated! - "))})}unloadPrefab(e){e=cc_1.assetManager.assets.get(e);e&&cc_1.assetManager.releaseAsset(e)}recursiveNode(e,t){t(e),e.children&&e.children.forEach(e=>this.recursiveNode(e,t))}}exports.default=new SceneUtil;