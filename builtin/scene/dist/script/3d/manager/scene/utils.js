"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc");class SceneUtil{async loadSceneByUuid(e){return new Promise((t,r)=>{let n=!1;clearTimeout(this.timer),cc_1.assetManager.loadAny(e,null,(i,s)=>{if(clearTimeout(this.timer),n=!0,i)r(i);else if(s instanceof cc_1.SceneAsset){const e=s.scene;e._id=s._uuid,e._name=s._name;try{cc.director.runSceneImmediate(e),t()}catch(i){r(i)}}else r(new Error("The asset "+e+" is not a scene"))});const i=()=>setTimeout(async()=>{if(n)return;const e=await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1});return 0!==e.response&&n||(this.timer=i()),1===e.response?r(new Error("Open scene timeout")):void 0},2e4);this.timer=i()})}async loadSceneByNode(e){return new Promise((t,r)=>{clearTimeout(this.timer);const n=()=>setTimeout(async()=>{if(1===(await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1})).response)return r(new Error("Open scene timeout"));this.timer=n()},2e4);this.timer=n();try{cc.director.runSceneImmediate(e),clearTimeout(this.timer),t()}catch(e){r(e)}})}async loadSceneByJson(e){return new Promise((t,r)=>{let n=!1;clearTimeout(this.timer),cc_1.assetManager.loadWithJson(e,null,(e,i)=>{if(clearTimeout(this.timer),n=!0,e)return r(e);try{cc.director.runSceneImmediate(i),t()}catch(e){r(e)}});const i=()=>setTimeout(async()=>{if(n)return;const e=await Editor.Dialog.warn("Open scene timeout. Do you want to wait?",{buttons:["waiting","interrupt"],default:1,cancel:1});return 0!==e.response&&n||(this.timer=i()),1===e.response?r(new Error("Open scene timeout")):void 0},2e4);this.timer=i()})}async loadPrefab(e){return new Promise((t,r)=>{cc_1.assetManager.loadAny(e,(n,i)=>n?r(n):i instanceof cc.Prefab?void t(i):r("Open resources are not prefabricated! - "+e))})}async loadPrefabByJson(e){return new Promise((t,r)=>{cc_1.assetManager.loadWithJson(e,(e,n)=>e?r(e):n instanceof cc.Prefab?void t(n):r("Open json are not prefabricated! - "))})}unloadPrefab(e){const t=cc_1.assetManager.assets.get(e);t&&cc_1.assetManager.releaseAsset(t)}recursiveNode(e,t){t(e),e.children&&e.children.forEach(e=>this.recursiveNode(e,t))}}exports.default=new SceneUtil;