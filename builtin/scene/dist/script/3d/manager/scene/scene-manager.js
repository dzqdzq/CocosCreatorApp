"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const ElectronModule=require("@base/electron-module"),EditorExtends=ElectronModule.require("EditorExtends"),EventEmitter_1=__importDefault(require("../../../public/EventEmitter")),utils_1=require("../../manager/prefab/utils"),message_1=require("../message");class SceneManager extends EventEmitter_1.default{constructor(){super(),this.rootNode=null,this.ignore=!1}queryNodeTree(e){const t=e=>{if(e.objFlags&cc.Object.Flags.HideInHierarchy)return null;const s=e.children.map(t).filter(Boolean),n=utils_1.prefabUtils.getPrefabStateInfo(e),r="Scene"===e.constructor.name;return{name:!e.name&&r?"Scene":e.name,active:e.active,locked:Boolean(e.objFlags&cc.Object.Flags.LockedInEditor),type:"cc."+e.constructor.name,uuid:e.uuid,children:s.length?s:[],prefab:n,parent:e.parent&&e.parent.uuid||"",isScene:r,readonly:!1,components:e.components.map(e=>({type:cc.js.getClassName(e.constructor),value:e.uuid,extends:cc.Class.getInheritanceChain(e.constructor).map(e=>cc.js.getClassName(e)).filter(Boolean)}))}};if(e){const s=cce.Node.query(e);return s?t(s):null}return cc.director._scene?t(cc.director._scene):null}queryClasses(e){const t=[];for(const s in cc.js._registeredClassNames)if(e){"string"==typeof e.extends&&(e.extends=[e.extends]);const n=cc.js._registeredClassNames[s];Array.isArray(e.extends)&&e.extends.some(t=>{const s=cc.js.getClassByName(t),r=cc.js.isChildClassOf(n,s);return e.excludeSelf?r&&s!==n:r})&&t.push({name:s})}else t.push({name:s});return t}queryComponents(){return EditorExtends.Component.getMenus().map(e=>{e.menuPath.indexOf("i18n:menu.custom_script");return{name:cc.js.getClassName(e.component),path:e.menuPath}})}queryComponentHasScript(e){return this.queryClasses().some(t=>t.name===e)}queryLayerBuiltin(){let e=Object.keys(cc.Layers.Enum).map((e,t)=>({name:e,value:cc.Layers.Enum[e]}));return e=e.filter(e=>0!==e.value&&4294967295!==e.value)}sendSceneOpenMsg(e,t,s){this.rootNode=s,this.emit("open",e),message_1.messageManager.broadcast("scene:ready",t),cce.Ipc.send("scene:ready")}}exports.default=SceneManager;