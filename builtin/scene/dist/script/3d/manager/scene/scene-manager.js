"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const EventEmitter_1=__importDefault(require("../../../public/EventEmitter")),cc_1=require("cc"),utils_1=require("../../manager/prefab/utils"),message_1=require("../message");class SceneManager extends EventEmitter_1.default{constructor(){super(),this.rootNode=null,this.ignore=!1}queryNodeTree(e){const t=e=>{if(e.objFlags&cc.Object.Flags.HideInHierarchy)return null;const s=e.children.map(t).filter(Boolean),r=utils_1.prefabUtils.getPrefabStateInfo(e),n="Scene"===e.constructor.name;return{name:!e.name&&n?"Scene":e.name,active:e.active,locked:Boolean(e.objFlags&cc.Object.Flags.LockedInEditor),type:"cc."+e.constructor.name,uuid:e.uuid,children:s.length?s:[],prefab:r,parent:e.parent&&e.parent.uuid||"",path:n?"/":e.getPathInHierarchy(),isScene:n,readonly:!1,components:e.components.map(e=>({type:cc.js.getClassName(e.constructor),value:e.uuid,extends:cc.Class.getInheritanceChain(e.constructor).map(e=>cc.js.getClassName(e)).filter(Boolean)}))}};if(e){const s=cce.Node.query(e);return s?t(s):null}const s=cc_1.director.getScene();return s?t(s):null}queryClasses(e){const t=[];for(const s in cc.js._registeredClassNames)if(e){"string"==typeof e.extends&&(e.extends=[e.extends]);const r=cc.js._registeredClassNames[s];Array.isArray(e.extends)&&e.extends.some(t=>{const s=cc.js.getClassByName(t),n=cc.js.isChildClassOf(r,s);return e.excludeSelf?n&&s!==r:n})&&t.push({name:s})}else t.push({name:s});return t}async queryComponents(){let e=EditorExtends.Component.getMenus();const t=await Editor.Profile.getProject("engine","modules.includeModules");return t&&!t.includes("3d")&&(e=e.filter(e=>"Effects/ParticleSystem"!==e.menuPath&&!(e.menuPath.startsWith("Light/")||e.menuPath.startsWith("Mesh/")||e.menuPath.startsWith("Physics/")))),e.map(e=>{const t=cc.js.getClassName(e.component),s=cc.js.getClassId(e.component);let r;return-1!==e.menuPath.indexOf("i18n:menu.custom_script")&&(r=e.component.prototype.__scriptUuid),{name:t,cid:s,path:e.menuPath,assetUuid:r}})}queryComponentHasScript(e){return this.queryClasses().some(t=>t.name===e)}queryLayerBuiltin(){let e=Object.keys(cc.Layers.Enum).map((e,t)=>({name:e,value:cc.Layers.Enum[e]}));return e=e.filter(e=>0!==e.value&&4294967295!==e.value)}querySortingLayerBuiltin(){return cc_1.SortingLayers.getBuiltinLayers()}sendSceneOpenMsg(e,t,s){this.rootNode=s,this.emit("open",e),message_1.messageManager.broadcast("scene:ready",t),cce.Ipc.send("scene:ready")}sendSceneCloseMsg(e){this.emit("close",e),message_1.messageManager.broadcast("scene:close"),cce.Ipc.send("scene:close")}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}emit(e,...t){return super.emit(e,...t)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}addListener(e,t){return super.addListener(e,t)}}exports.default=SceneManager;