"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadAny=loadAny,exports.createNodeByAsset=createNodeByAsset,exports.createShouldHideInHierarchyCanvasNode=createShouldHideInHierarchyCanvasNode;const cc_1=require("cc"),utils_1=require("./utils");async function loadAny(e){return new Promise((n,c)=>{cc_1.assetManager.assets.remove(e),cc_1.assetManager.loadAny(e,(e,a)=>{e?c(e):n(a)})})}async function createNodeByAsset(e){var{uuid:a,type:e,autoAdaptToCreate:n,canvasRequired:c}=e;let t,r,o=c;switch(e){case"cc.AnimationClip":t=await loadAny(a);var s=(r=new cc_1.Node(t.name)).addComponent(cc_1.Animation);s&&(s.defaultClip=t);break;case"cc.AudioClip":t=await loadAny(a);s=(r=new cc_1.Node(t.name)).addComponent(cc_1.AudioSource);s&&(s.clip=t);break;case"cc.BitmapFont":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;s=r.addComponent(cc_1.Label);s&&(s.font=t);break;case"cc.LabelAtlas":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;s=r.addComponent(cc_1.Label);s.font=t,s.fontSize=t.fontSize,t.fntConfig&&(i=t.fntConfig.commonHeight,s.lineHeight=i||s.lineHeight);break;case"cc.Mesh":t=await loadAny(a);var i=(r=new cc_1.Node(t.name)).addComponent(cc_1.MeshRenderer);i&&(i.mesh=t),await(0,utils_1.createNodeMetrics)(a);break;case"cc.ParticleAsset":o=!0,t=await loadAny(a);s=(r=new cc_1.Node(t.name)).addComponent(cc_1.ParticleSystem2D);s&&(s.file=t);break;case"cc.Prefab":t=await loadAny(a),r=cce.Prefab.createNodeFromPrefabAsset(t),await(0,utils_1.createNodeMetrics)(a),await(0,utils_1.createLODMetrics)(r),r&&0<r.getComponentsInChildren(cc_1.UITransform).length&&(o=0===r.getComponentsInChildren(cc_1.Canvas).length);break;case"cc.Script":i=await cce.Script.queryScriptName(a)||"",s=await cce.Script.queryScriptCid(a)||"";r=new cc_1.Node(i),s&&"MissingScript"!==s&&"cc.MissingScript"!==s&&r.addComponent(cc_1.js.getClassById(s));break;case"cc.SpriteFrame":{t=await loadAny(a);let e=!1;var i=await loadAny((e=n?!cce.Camera.is2D&&!(0,utils_1.getUICanvasNode)(cc_1.director.getScene()):e)?"279ed042-5a65-4efe-9afb-2fc23c61e15a":"9db8cd0b-cbe4-42e7-96a9-a239620c0a9d");i.name=t.name,(r=cc.instantiate(i)).name=t.name,e?(o=!1,(s=r.getComponent(cc_1.SpriteRenderer))&&(s.spriteFrame=t)):(o=!0,r.layer=cc_1.Layers.Enum.UI_2D,(i=r.getComponent(cc_1.Sprite))&&(i.spriteFrame=t,s=await Editor.Message.request("asset-db","query-asset-meta",a))&&(d=0!==s.userData.borderBottom&&0!==s.userData.borderLeft&&0!==s.userData.borderRight&&0!==s.userData.borderTop,s="none"===s.userData.trimType,d?i.type=cc_1.Sprite.Type.SLICED:s&&(i.trim=!1,i.sizeMode=cc_1.Sprite.SizeMode.RAW)))}break;case"cc.TTFFont":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;var d=r.addComponent(cc_1.Label);d&&(d.font=t);break;case"cc.TerrainAsset":t=await loadAny(a);s=(r=new cc_1.Node(t.name)).addComponent(cc_1.Terrain);s&&(s._asset=t);break;case"cc.TiledMapAsset":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;i=r.addComponent(cc_1.TiledMap);i&&(i.tmxAsset=t);break;case"cc.VideoClip":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;d=r.addComponent(cc_1.VideoPlayer);d&&(d.clip=t);break;case"dragonBones.DragonBonesAsset":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;s=r.addComponent(cc_1.dragonBones.ArmatureDisplay);s&&(s.dragonAsset=t);break;case"dragonBones.DragonBonesAtlasAsset":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;i=r.addComponent(cc_1.dragonBones.ArmatureDisplay);i&&(i.dragonAtlasAsset=t);break;case"sp.SkeletonData":o=!0,t=await loadAny(a),(r=new cc_1.Node(t.name)).layer=cc_1.Layers.Enum.UI_2D;d=r.addComponent(cc_1.sp.Skeleton);d&&(d.skeletonData=t);break;default:t=await loadAny(a),r=cc.instantiate(t)}return{node:r,canvasRequired:o}}const pendingCanvasPromises=new Map;async function createShouldHideInHierarchyCanvasNode(c){var e=c.getComponentsInChildren(cc_1.Canvas).find(e=>"should_hide_in_hierarchy"===e.node.name);if(e)return e.node;if(pendingCanvasPromises.has(c))return pendingCanvasPromises.get(c);e=(async()=>{let e="f773db21-62b8-4540-956a-29bacf5ddbf5";var a=await loadAny(e="2d"===cce.SceneFacadeManager._projectType?"4c33600e-9ca9-483b-b734-946008261697":e),a=(0,cc_1.instantiate)(a),n=(a.children.forEach(e=>{e.objFlags|=cc_1.CCObject.Flags.HideInHierarchy}),a._prefab=null,a.parent=c,a.name="should_hide_in_hierarchy",a.objFlags|=cc_1.CCObject.Flags.LockedInEditor,a.children[0]);return n&&(n.setParent=()=>{var e=Editor.I18n.t("scene.messages.setInternalCameraParent");console.error(e)}),a})();pendingCanvasPromises.set(c,e);try{return await e}finally{pendingCanvasPromises.delete(c)}}