"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.walkChild=walkChild,exports.walk=walk,exports.setLayer=setLayer,exports.getUICanvasNode=getUICanvasNode,exports.getUITransformParentNode=getUITransformParentNode,exports.hasOneKindOfComponent=hasOneKindOfComponent,exports.getNodeName=getNodeName,exports.visitNode=visitNode,exports.createNodeMetrics=createNodeMetrics,exports.createLODMetrics=createLODMetrics;const cc_1=require("cc");function walkChild(e,t){(t[e.uuid]=e).children&&e.children.forEach(e=>{exports.walkChild(e,t)})}function walk(e,t){exports.walkChild(e,t)}function setLayer(e,t,r){e.layer=t;for(const n of e.children)setLayer(n,t,r)}function getUICanvasNode(r,e=!0){if(r){if(hasOneKindOfComponent(r,cc_1.Canvas))return r;let t=cc_1.director.getScene();if("prefab"===cce.SceneFacadeManager.queryMode()&&e&&(e=cce.SceneFacadeManager._facadeFSM.prefabSceneFacade._sceneProxy,t=e.getRootNode()),r!==t){let e=r.parent;for(;e;){if(hasOneKindOfComponent(e,cc_1.Canvas))return r;if(e===t)break;e=e.parent}}var n=r.children.slice();for(let e=n.length-1;0<=e;e--){var a=n[e];if(hasOneKindOfComponent(a,cc_1.Canvas))return a}}return null}function getUITransformParentNode(r){if(r){if(hasOneKindOfComponent(r,cc_1.UITransformComponent))return r;let t=cc_1.director.getScene();var e=cce.SceneFacadeManager.queryMode();if("prefab"===e&&(e=cce.SceneFacadeManager._facadeFSM.prefabSceneFacade._sceneProxy,t=e.getRootNode()),r!==t){let e=r.parent;for(;e;){if(hasOneKindOfComponent(e,cc_1.UITransformComponent))return e;if(e===t)break;e=e.parent}}}return null}function hasOneKindOfComponent(t,r){if(t&&t.components)for(let e=0;e<t.components.length;e++)if(t.components[e]instanceof r)return!0;return!1}function getNodeName(e,t){if(t&&Array.isArray(t.children))for(var r=t.children.map(e=>e&&e.name||"");r.includes(e);)/(\d+)$/.test(e)?e=e.replace(/(\d+)$/,(e,t)=>{var r=parseInt(t,10);return(r+=1).toString().padStart(t.length,"0")}):e+="-001";return e}function visitNode(e,t,r=!1){r=t(e,!!r);if(!r){var n=e.children;for(let e=n.length-1;0<=e;--e)visitNode(n[e],t,!0)}}async function createNodeMetrics(e){if(e&&-1!==e.indexOf("@"))try{var[t,,]=e.split("@"),r=await Editor.Message.request("asset-db","query-asset-meta",t);r&&r.importer&&("fbx"===r.importer||"gltf"===r.importer)&&(r.userData&&r.userData.meshSimplify&&r.userData.meshSimplify.enable&&Editor.Metrics._trackEventWithTimer({category:"createNode",id:"A100010",value:1}),r.userData)&&r.userData.fbx&&r.userData.fbx.smartMaterialEnabled&&Editor.Metrics._trackEventWithTimer({category:"createNode",id:"A100011",value:1})}catch(e){console.debug(e)}}async function createLODMetrics(e){e&&e._components&&e.getComponent("cc.LODGroup")&&Editor.Metrics._trackEventWithTimer({category:"LOD",id:"A100001",value:1})}