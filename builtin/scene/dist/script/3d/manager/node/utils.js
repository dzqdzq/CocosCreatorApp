"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.visitNode=exports.getNodeName=exports.hasOneKindOfComponent=exports.getUITransformParentNode=exports.getUICanvasNode=exports.walk=exports.walkChild=void 0;const cc_1=require("cc");function walkChild(e,n){n[e.uuid]=e,e.children&&e.children.forEach(e=>{exports.walkChild(e,n)})}function walk(e,n){exports.walkChild(e,n)}function getUICanvasNode(e,n=!0){if(!e)return null;if(hasOneKindOfComponent(e,cc_1.Canvas))return e;let t=cc_1.director.getScene();if("prefab"===cce.SceneFacadeManager.queryMode()&&n){t=cce.SceneFacadeManager._facadeFSM.prefabSceneFacade._sceneProxy.getRootNode()}if(e!==t){let n=e.parent;for(;n;){if(hasOneKindOfComponent(n,cc_1.Canvas))return e;if(n===t)break;n=n.parent}}const r=e.children.slice();for(let e=r.length-1;e>=0;e--){const n=r[e];if(hasOneKindOfComponent(n,cc_1.Canvas))return n}return null}function getUITransformParentNode(e){if(!e)return null;if(hasOneKindOfComponent(e,cc_1.UITransformComponent))return e;let n=cc_1.director.getScene();if("prefab"===cce.SceneFacadeManager.queryMode()){n=cce.SceneFacadeManager._facadeFSM.prefabSceneFacade._sceneProxy.getRootNode()}if(e===n)return null;let t=e.parent;for(;t;){if(hasOneKindOfComponent(t,cc_1.UITransformComponent))return t;if(t===n)break;t=t.parent}return null}function hasOneKindOfComponent(e,n){if(e&&e.components)for(let t=0;t<e.components.length;t++)if(e.components[t]instanceof n)return!0;return!1}function getNodeName(e,n){if(!n||!Array.isArray(n.children))return e;const t=n.children.map(e=>e&&e.name||"");for(;t.includes(e);)/(\d+)$/.test(e)?e=e.replace(/(\d+)$/,(e,n)=>{let t=parseInt(n,10);return(t+=1).toString().padStart(n.length,"0")}):e+="-001";return e}function visitNode(e,n,t=!1){if(n(e,!!t))return;const r=e.children;for(let e=r.length-1;e>=0;--e)visitNode(r[e],n,!0)}exports.walkChild=walkChild,exports.walk=walk,exports.getUICanvasNode=getUICanvasNode,exports.getUITransformParentNode=getUITransformParentNode,exports.hasOneKindOfComponent=hasOneKindOfComponent,exports.getNodeName=getNodeName,exports.visitNode=visitNode;