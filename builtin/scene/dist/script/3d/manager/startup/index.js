"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var a=Object.getOwnPropertyDescriptor(n,t);a&&("get"in a?n.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,a)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(n,e,t);return __setModuleDefault(n,e),n},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),globalThis.DEBUG_TIME_COST=!0,DEBUG_TIME_COST&&console.time("Import Electron and EditorExtends"),DEBUG_TIME_COST&&console.timeEnd("Import Electron and EditorExtends"),DEBUG_TIME_COST&&console.time("Import files");const index_1=__importDefault(require("./engine/index")),scene_view_data_1=require("../scene-view/scene-view-data"),log_1=__importDefault(require("./log"));DEBUG_TIME_COST&&console.timeEnd("Import files");const LOCK={engine:!1,manager:!1,config:!1},layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;class StartupManager{async requireEngine(){if(LOCK.engine)return;LOCK.engine=!0,DEBUG_TIME_COST&&console.time("Require engine time");Date.now();Editor.Metrics.trackTimeStart("[Scene] Require engine code"),await index_1.default.requireEngine(),Editor.Metrics.trackTimeEnd("[Scene] Require engine code",{output:!1}),DEBUG_TIME_COST&&console.timeEnd("Require engine time")}async configEngine(e,n,t){LOCK.config||(LOCK.config=!0,window.cce.Utils={serialize:EditorExtends.serialize},DEBUG_TIME_COST&&console.time("Open engine time"),Editor.Metrics.trackTimeStart("[Scene] Open engine"),await index_1.default.openEngine(e),DEBUG_TIME_COST&&console.timeEnd("Open engine time"),Editor.Metrics.trackTimeEnd("[Scene] Open engine",{output:!0}),DEBUG_TIME_COST&&console.time("Configure engine time"),Editor.Metrics.trackTimeStart("[Scene] Configure engine"),await index_1.default.configureEngine(),Editor.Metrics.trackTimeEnd("[Scene] Configure engine",{output:!0}),DEBUG_TIME_COST&&console.timeEnd("Configure engine time"),this.initCustomLayer(t),cc.game.canvas.requestPointerLock=function(){},cc.game.canvas.exitPointerLock=function(){},cc.game.canvas.requestFullscreen=function(){})}async initEngine(e,n,t){await this.requireEngine(),await this.configEngine(e,n,t)}async initDesignResolution(e,n){e-=0,n-=0,isNaN(e)&&(e=cc.view._designResolutionSize.width),isNaN(n)&&(n=cc.view._designResolutionSize.height),cc.view.setDesignResolutionSize(e,n,cc.ResolutionPolicy.SHOW_ALL),"__default_design__"===scene_view_data_1.sceneViewData.targetDeviceName&&(scene_view_data_1.sceneViewData.targetResolution={width:e,height:n})}async initCustomLayer(e){if(e){for(let e=0;e<=19;e++)cc.Layers.deleteLayer(e);e.forEach(e=>{const n=layerMask.findIndex(n=>e.value===n);-1!==n&&cc.Layers.addLayer(e.name,n)})}}async initManager(e){if(LOCK.manager)return;LOCK.manager=!0,DEBUG_TIME_COST&&console.time("InitManager"),log_1.default.init();const n=window.cce;n.project=e.project;const t=new cc.Node("Editor Scene Foreground"),i=new cc.Node("Editor Scene Background");t.objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.HideInHierarchy,i.objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.HideInHierarchy,cc.director.addPersistRootNode(t),cc.director.addPersistRootNode(i),n.foregroundNode=t,n.backgroundNode=i;const{SceneFacadeManager:a}=await Promise.resolve().then(()=>__importStar(require("../../facade/scene-facade-manager"))),r=new a;n.SceneFacadeManager=r,await r.init();const{sceneCacheManager:c}=await Promise.resolve().then(()=>__importStar(require("../scene/scene-cache")));await c.init(),DEBUG_TIME_COST&&console.timeEnd("InitManager")}}exports.default=new StartupManager;