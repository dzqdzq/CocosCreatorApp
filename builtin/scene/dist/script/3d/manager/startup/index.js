"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const ElectronModule=require("@base/electron-module"),EditorExtends=ElectronModule.require("EditorExtends");window.EditorExtends=EditorExtends;const engine_1=__importDefault(require("./engine")),log_1=__importDefault(require("./log")),buffer_1=__importDefault(require("../preview/buffer")),scene_facade_manager_1=require("../../facade/scene-facade-manager"),index_1=__importDefault(require("../gameview/index")),LOCK={engine:!1,manager:!1};class StartupManager{async initEngine(e,n){if(e.renderPipeline=n,console.log("begin init"),LOCK.engine)return;LOCK.engine=!0,await engine_1.default.requireEngine(),console.log("require engine end");const i=ElectronModule.require("Serialize");window.cce.Utils={serialize:i.serialize},console.log("Serialize end"),await engine_1.default.configureStartup(),console.log("configureStartup end"),await engine_1.default.openEngine(e),console.log("openEngine end"),await engine_1.default.configureEngine(),console.log("configureEngine end")}async initDesignResolution(e,n){e-=0,n-=0,isNaN(e)&&(e=cc.view._originalDesignResolutionSize.width),isNaN(n)&&(n=cc.view._originalDesignResolutionSize.height),cc.view.setDesignResolutionSize(e,n,cc.ResolutionPolicy.SHOW_ALL)}async initManager(e){if(LOCK.manager)return;LOCK.manager=!0,log_1.default.init();const n=window.cce;n.project=e.project;const i=new cc.Node("Editor Scene Foreground"),r=new cc.Node("Editor Scene Background");i._objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.HideInHierarchy,r._objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.HideInHierarchy,cc.game.addPersistRootNode(i),cc.game.addPersistRootNode(r),n.foregroundNode=i,n.backgroundNode=r;try{await require("../effects").default.init()}catch(e){console.error(e)}n.GameView=index_1.default,n.PreviewBuffer=buffer_1.default;const o=new scene_facade_manager_1.SceneFacadeManager;n.SceneFacadeManager=o,o.init()}}exports.default=new StartupManager;