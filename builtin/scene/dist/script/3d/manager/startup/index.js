"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,i,t,n){void 0===n&&(n=t);var r=Object.getOwnPropertyDescriptor(i,t);r&&("get"in r?i.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(e,n,r)}:function(e,i,t,n){e[n=void 0===n?t:n]=i[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),__importStar=this&&this.__importStar||function(){var r=function(e){return(r=Object.getOwnPropertyNames||function(e){var i,t=[];for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t})(e)};return function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var t=r(e),n=0;n<t.length;n++)"default"!==t[n]&&__createBinding(i,e,t[n]);return __setModuleDefault(i,e),i}}(),__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),globalThis.DEBUG_TIME_COST=!0,DEBUG_TIME_COST&&console.time("Import files");const index_1=__importDefault(require("./engine/index")),scene_view_data_1=require("../scene-view/scene-view-data"),LOCK=(DEBUG_TIME_COST&&console.timeEnd("Import files"),{engine:!1,manager:!1,config:!1}),layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;class StartupManager{async requireEngine(){LOCK.engine||(LOCK.engine=!0,Date.now(),Editor.Metrics.trackTimeStart("[Scene] Require engine"),await index_1.default.requireEngine(),Editor.Metrics.trackTimeEnd("[Scene] Require engine",{output:!0}))}async configEngine(e,i,t,n){LOCK.config||(LOCK.config=!0,window.cce.Utils={serialize:EditorExtends.serialize,deserializeFull:EditorExtends.deserializeFull},Editor.Metrics.trackTimeStart("[Scene] Open engine"),await index_1.default.openEngine(e),Editor.Metrics.trackTimeEnd("[Scene] Open engine",{output:!0}),Editor.Metrics.trackTimeStart("[Scene] Configure engine"),await index_1.default.configureEngine(),Editor.Metrics.trackTimeEnd("[Scene] Configure engine",{output:!0}),this.initCustomLayer(t),this.initSortingLayer(n),cc.game.canvas.requestPointerLock=function(){},cc.game.canvas.exitPointerLock=function(){},cc.game.canvas.requestFullscreen=function(){})}async initEngine(e,i,t,n){await this.requireEngine(),await this.configEngine(e,i,t,n)}getDesignResolutionPolicy(e,i){return isPreviewProcess?i?e?cc.ResolutionPolicy.SHOW_ALL:cc.ResolutionPolicy.FIXED_HEIGHT:e?cc.ResolutionPolicy.FIXED_WIDTH:cc.ResolutionPolicy.NO_BORDER:cc.ResolutionPolicy.SHOW_ALL}async initDesignResolution(){var e=await Editor.Profile.getProject("project","general.designResolution");if(!e)throw new Error('Failed to initialize design resolution: Unable to get project configuration from "project.general.designResolution"');let i=Number(e.width),t=Number(e.height);var n=cc.view.getDesignResolutionSize(),n=(isNaN(i)&&(i=n.width),isNaN(t)&&(t=n.height),this.getDesignResolutionPolicy(e.fitWidth,e.fitHeight)),e=(cc.view.setDesignResolutionSize(i,t,n),"__default_design__"===scene_view_data_1.sceneViewData.targetDeviceName&&(scene_view_data_1.sceneViewData.targetResolution={width:i,height:t}),cc.director.getScene());e&&e.getComponentsInChildren("cc.Canvas").forEach(e=>{!e.node.getComponent("cc.Widget")&&e.node.active&&e.enabled&&e.fitDesignResolution_EDITOR&&e.fitDesignResolution_EDITOR()})}changeDesignResolution(e,i){e-=0,i-=0,isNaN(e)&&(e=cc.view._designResolutionSize.width),isNaN(i)&&(i=cc.view._designResolutionSize.height);var t=cc.view.getResolutionPolicy();cc.view.setDesignResolutionSize(e,i,t)}async initCustomLayer(e){if(e){for(let e=0;e<=19;e++)cc.Layers.deleteLayer(e);e.forEach(i=>{var e=layerMask.findIndex(e=>i.value===e);-1!==e&&cc.Layers.addLayer(i.name,e)})}}async initSortingLayer(e){Array.isArray(e)&&(cc.settings.overrideSettings("engine","sortingLayers",e),e=(await Promise.resolve().then(()=>__importStar(require("cc"))))["SortingLayers"],e.init())}async initManager(e){LOCK.manager||(LOCK.manager=!0,Editor.Metrics.trackTimeStart("[Scene] Init manager"),module.paths.push(AppModulePath),await require("./init-manager").initManager(),Editor.Metrics.trackTimeEnd("[Scene] Init manager",{output:!0}),cce.project=e.project)}}exports.default=new StartupManager;