"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const ipc_1=__importDefault(require("../ipc")),effects_1=__importDefault(require("../effects")),scripts_1=__importDefault(require("../scripts"));function addClass(e,t){(" "+e.className+" ").indexOf(" "+t+" ")>-1||(e.className&&(e.className+=" "),e.className+=t)}function findCanvas(e){let t,a,c,n,r;const i=e?e instanceof HTMLElement?e:document.querySelector(e)||document.querySelector("#"+e):null;return i&&"CANVAS"===i.tagName?(t=i.width,a=i.height,r=i,n=document.createElement("div"),r&&r.parentNode&&r.parentNode.insertBefore(n,r),n.setAttribute("id","Cocos3dGameContainer"),n.appendChild(r),c=n.parentNode===document.body?document.documentElement:n.parentNode,addClass(r,"gameCanvas"),r.setAttribute("width",t||"480"),r.setAttribute("height",a||"320"),r.setAttribute("tabindex","99"),{frame:c,container:n,canvas:r}):null}let cc;class EngineStartup{requireEngine(){try{cc=require("cc"),EditorExtends.start()}catch(e){throw console.log(`Load engine failed: ${e.message}`),e}}configureStartup(){cc.macro.ENABLE_TRANSPARENT_CANVAS=!1,cc.macro.ENABLE_WEBGL_ANTIALIAS=!0}async openEngine(e={}){const t=findCanvas("GameCanvas");if(!t)throw new Error(cc.getError(200));const a={showFPS:!1,debugMode:cc.DebugMode.WARN,frameRate:30,renderMode:2,registerSystemEvent:!1,jsList:[],noCache:!0,groupList:[],collisionMatrix:null,adapter:t,customJointTextureLayouts:[]};await cc.game.init(Object.assign(a,e));try{await scripts_1.default.init()}catch(e){console.error(e)}await cc.game.run();const c=document.body.getBoundingClientRect();cc.view.setCanvasSize(c.width,c.height)}configureEngine(){cc.view.enableRetina(!1),cc.game.canvas.setAttribute("tabindex",-1),cc.game.canvas.style.backgroundColor=""}async loadEffect(){const e=await ipc_1.default.send("query-effects");await Promise.all(e.map(e=>effects_1.default.registerEffect(e)))}async loadScript(){const e=await ipc_1.default.send("query-scripts");await Promise.all(e.map(e=>scripts_1.default.loadScript(e)))}}exports.default=new EngineStartup;