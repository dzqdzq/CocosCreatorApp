"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const ipc_1=__importDefault(require("../ipc")),effects_1=__importDefault(require("../effects")),scripts_1=__importDefault(require("../scripts"));function addClass(e,t){(" "+e.className+" ").indexOf(" "+t+" ")>-1||(e.className&&(e.className+=" "),e.className+=t)}function findCanvas(e){const t=e?e instanceof HTMLElement?e:document.querySelector(e)||document.querySelector("#"+e):null;if(!t||"CANVAS"!==t.tagName)return null;const a=t.width,n=t.height,r=t,i=document.createElement("div");r&&r.parentNode&&r.parentNode.insertBefore(i,r),i.setAttribute("id","Cocos3dGameContainer"),i.appendChild(r);const c=i.parentNode===document.body?document.documentElement:i.parentNode;return addClass(r,"gameCanvas"),r.setAttribute("width",a.toString()||"480"),r.setAttribute("height",n.toString()||"320"),r.setAttribute("tabindex","99"),{frame:c,container:i,canvas:r}}let cc;class EngineStartup{requireEngine(){try{cc=require("cc"),EditorExtends.start()}catch(e){throw console.log(`Load engine failed: ${e.message}`),e}}configureStartup(){cc.macro.ENABLE_TRANSPARENT_CANVAS=!1,cc.macro.ENABLE_WEBGL_ANTIALIAS=!0}async openEngine(e={}){const t=findCanvas("GameCanvas");if(!t)throw new Error(cc.getError(200));const a={showFPS:!1,debugMode:cc.DebugMode.WARN,frameRate:30,renderMode:2,jsList:[],noCache:!0,groupList:[],collisionMatrix:null,adapter:t,customJointTextureLayouts:[]};await cc.game.init(Object.assign(a,e));try{await scripts_1.default.init()}catch(e){console.error(e)}await Promise.resolve().then(()=>__importStar(require("./loader"))),await cc.game.run();const n=document.body.getBoundingClientRect();cc.view.setCanvasSize(n.width,n.height)}configureEngine(){cc.view.enableRetina(!1),cc.game.canvas.setAttribute("tabindex",-1),cc.game.canvas.style.backgroundColor=""}async loadEffect(){const e=await ipc_1.default.send("query-effects");await Promise.all(e.map(e=>effects_1.default.registerEffect(e)))}async loadScript(){const e=await ipc_1.default.send("query-scripts");await Promise.all(e.map(e=>scripts_1.default.loadScript(e)))}}exports.default=new EngineStartup;