"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const transition_1=require("./transition");class FiniteStateMachine{constructor(t){t.length<1&&console.error("A FiniteStateMachine needs at least 1 state"),this._transitions=new Map,this._states=t,t.forEach(t=>{this._transitions.set(t,new Map)})}addTransition(t,e,n,i){var s,r;return this._states.includes(t)?this._states.includes(e)?("function"==typeof i?null===(s=this._transitions.get(t))||void 0===s||s.set(n,new transition_1.DefaultStateTransition(t,e,i)):null===(r=this._transitions.get(t))||void 0===r||r.set(n,null!==i&&void 0!==i?i:new transition_1.DefaultStateTransition(t,e)),this):(console.error("unknown to state"),this):(console.error("unknown from state"),this)}Begin(t){return t?this._states.includes(t)?(this.currentState=t,this):(console.error("unknown first state"),this):this}async issueCommand(t,e={}){const n=this._transitions.get(this.currentState);if(null===n||void 0===n?void 0:n.has(t)){const i=n.get(t);if(!i)return!1;if(await i.testCondition(e))return await i.Complete(),await this.currentState.exit(),this.currentState=i.toState,await this.currentState.enter(e),!0}return!1}}exports.default=FiniteStateMachine;