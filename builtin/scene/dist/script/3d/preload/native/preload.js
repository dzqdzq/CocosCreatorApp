"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t);var n=Object.getOwnPropertyDescriptor(r,t);n&&("get"in n?r.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,i,n)}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.check=void 0,window.isSceneNative=!0,window.isPreviewProcess=!1,require("@editor/creator/dist/require");const ipc=__importStar(require("@base/electron-base-ipc")),{join:join}=require("path");function check(){ipc.sendSync("scene:check-ipc")?startup():setTimeout(()=>{window.location.reload()},1e3)}async function startup(){await require("editor/preload").init(),window.Editor=require("editor"),Editor.Metrics.trackTimeStart("scene:scene-view-startup");const e=require("../../manager/ipc/index").default,r=require("../../manager/startup").default,t=require("./native-scene").default;window.cce={Startup:r,Ipc:e,NativeScene:t},window.AppModulePath=join(Editor.App.path,"node_modules"),e.send("ready"),Editor.Message.send("process","register-process-info",process.pid,"webview:scene-native")}exports.check=check,check();let closeProgress=0;window.addEventListener("beforeunload",async e=>{const r=require("../../manager/ipc/index").default;if(1!==closeProgress)return cce.Scene&&cce.Scene.dump&&2!==closeProgress?(r.send("immediately-dump",cce.SceneFacadeManager.dumpAllScenes()),closeProgress=1,e.returnValue=!0,void(await cce.SceneFacadeManager.beforeClose()?(closeProgress=2,window.location.reload()):closeProgress=0)):void r.send("close");e.returnValue=!0});const electron=require("electron");electron.ipcRenderer.send("fire-web-contents");