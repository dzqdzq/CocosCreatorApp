"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;class EditorPreview{async start(){const e=await Editor.Message.request("engine","query-engine-info");this.engineInfo={typescript:e.typescript,native:e.native,project:Editor.Project.path},await this._startEngine(),await this._startEditor()}async _startEngine(){const e=await Editor.Profile.getProject("project","layer"),t=await Editor.Profile.getProject("project","sorting-layer")||{},i=await Editor.Profile.getProject("project","general.renderPipeline"),r=await Editor.Profile.getProject("project","general.designResolution"),a=t.layers||[];this.engineInfo.overrideSettings={engine:{customLayers:e.map(e=>{const t=layerMask.findIndex(t=>e.value===t);return{name:e.name,bit:t}}),sortingLayers:a}},await cce.Startup.configEngine(this.engineInfo,i,e,a),await cce.Startup.initDesignResolution(r.width,r.height),cc.game.restart=(()=>{cce.Ipc.clearQueue(),cce.Ipc.send("preview-restart")})}async _startEditor(){await cce.Startup.initManager(this.engineInfo);const e=await Editor.Profile.getProject("engine","modules.includeModules");e&&!e.includes("3d")&&cce.SceneFacadeManager.changeProjectMode("2d"),await cce.SceneFacadeManager.openScene("")}async _startPreview(){}}exports.default=new EditorPreview;