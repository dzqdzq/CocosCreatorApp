"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.check=void 0,window.isSceneNative=!0,window.isPreviewProcess=!0,require("@editor/creator/dist/require");const electronIPC=require("@base/electron-base-ipc"),ipc=require("../../manager/ipc/index").default,{join:join}=require("path"),fs=require("fs"),logger=require("../../manager/startup/log").default;function check(){electronIPC.sendSync("scene:check-ipc")?startup():setTimeout(()=>{window.location.reload()},1e3)}async function init(){try{await cce.Ipc.startup(),await cce.Startup.requireEngine(),logger.setLevel(4),console.info(Editor.I18n.t("scene.game_view.ready")),ipc.send("preview-ready")}catch(e){console.error(Editor.I18n.t("scene.game_view.failed")+":"+e),ipc.send("preview-failed")}}async function startup(){console.time("Preview startup"),await require("editor/preload").init(),window.Editor=require("editor");const e=require("../../manager/startup").default,r=require("./editor-preview").default,t=require("./native-scene").default;logger.changePrefix("Preview"),logger.setLevel(2),window.cce={Startup:e,Ipc:ipc,EditorPreview:r,NativeScene:t},window.AppModulePath=join(Editor.App.path,"node_modules"),window.__defineGetter__("localStorage",()=>{let e=Object.create(null);const r=join(Editor.Project.tmpDir,"scene/storage"),t=join(r,"data.json");if(fs.existsSync(r)||fs.mkdirSync(r),fs.existsSync(t)){const r=fs.readFileSync(t);r&&(e=JSON.parse(r))}const i=function(){try{const r=JSON.stringify(e);fs.writeFileSync(t,r)}catch(e){console.warn("save local storage failed:",e)}};return{getItem:r=>e[r],setItem(r,t){e[r]=t,i()},clear(){e=Object.create(null),i()},removeItem(r){delete e[r],i()}}}),init(),Editor.Message.send("process","register-process-info",process.pid,"webview:scene-preview")}exports.check=check,check();const closeProgress=0;window.addEventListener("beforeunload",async e=>{ipc.send("preview-close")});const electron=require("electron");electron.ipcRenderer.send("fire-web-contents");