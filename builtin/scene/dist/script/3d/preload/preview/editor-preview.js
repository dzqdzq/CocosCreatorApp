"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;class EditorPreview{async start(){this.engineInfo=(await Editor.Message.request("engine","query-engine-info")).typescript,await this._startEngine(),await this._startEditor()}async _startEngine(){const e=await Editor.Profile.getProject("project","layer"),t=await Editor.Profile.getProject("project","sorting-layer")||{},i=await Editor.Profile.getProject("project","general.renderPipeline"),a=await Editor.Profile.getProject("project","general.designResolution");this.engineInfo.customLayers=e.map(e=>{const t=layerMask.findIndex(t=>e.value===t);return{name:e.name,bit:t}}),this.engineInfo.sortingLayers=t.layers||[],await cce.Startup.configEngine(this.engineInfo,i,e,this.engineInfo.sortingLayers),await cce.Startup.initDesignResolution(a.width,a.height),cc.game.restart=(()=>{cce.Ipc.clearQueue(),cce.Ipc.send("preview-restart")})}async _startEditor(){await cce.Startup.initManager(Object.assign(this.engineInfo,{project:Editor.Project.path}));const e=await Editor.Profile.getProject("engine","modules.includeModules");e&&!e.includes("3d")&&cce.SceneFacadeManager.changeProjectMode("2d"),await cce.SceneFacadeManager.openScene("")}async _startPreview(){}}exports.default=new EditorPreview;