"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),ray=cc_1.geometry.Ray,aabb=cc_1.geometry.AABB,triangle=cc_1.geometry.Triangle,tempVec3_a=new cc_1.Vec3,ray_triangle=function(){const c=new cc_1.Vec3(0,0,0),e=new cc_1.Vec3(0,0,0),t=new cc_1.Vec3(0,0,0),a=new cc_1.Vec3(0,0,0),n=new cc_1.Vec3(0,0,0);return function(r,_,s=!1,o){cc_1.Vec3.subtract(c,_.b,_.a),cc_1.Vec3.subtract(e,_.c,_.a),cc_1.Vec3.cross(t,r.d,e);const V=cc_1.Vec3.dot(c,t);if(V<Number.EPSILON&&(!s||V>-Number.EPSILON))return 0;const m=1/V;cc_1.Vec3.subtract(a,r.o,_.a);const i=cc_1.Vec3.dot(a,t)*m;if(i<0||i>1)return 0;cc_1.Vec3.cross(n,a,c);const u=cc_1.Vec3.dot(r.d,n)*m;if(u<0||i+u>1)return 0;const d=cc_1.Vec3.dot(e,n)*m;return d<0?0:(cc_1.Vec3.scaleAndAdd(o,r.o,r.d,d),d)}}(),ray_aabb=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3;return function(t,a){const n=t.o,r=t.d,_=1/r.x,s=1/r.y,o=1/r.z;cc_1.Vec3.subtract(c,a.center,a.halfExtents),cc_1.Vec3.add(e,a.center,a.halfExtents);const V=(c.x-n.x)*_,m=(e.x-n.x)*_,i=(c.y-n.y)*s,u=(e.y-n.y)*s,d=(c.z-n.z)*o,h=(e.z-n.z)*o,M=Math.max(Math.max(Math.min(V,m),Math.min(i,u)),Math.min(d,h)),l=Math.min(Math.min(Math.max(V,m),Math.max(i,u)),Math.max(d,h));return l<0||M>l?0:M>0?M:l}}(),ray_segment=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3,t=new cc_1.Vec3,a=new cc_1.Vec3;return function(n,r,_,s=2,o){const V=s*s;cc_1.Vec3.add(tempVec3_a,r,_),cc_1.Vec3.multiplyScalar(c,tempVec3_a,.5),cc_1.Vec3.subtract(tempVec3_a,_,r),cc_1.Vec3.normalize(e,tempVec3_a),cc_1.Vec3.subtract(t,n.o,c);var m,i,u,d,h=.5*cc_1.Vec3.distance(r,_),M=-n.d.dot(e),l=t.dot(n.d),x=-t.dot(e),y=t.lengthSqr(),b=Math.abs(1-M*M);if(b>0)if(i=M*l-x,d=h*b,(m=M*x-l)>=0)if(i>=-d)if(i<=d){var f=1/b;u=(m*=f)*(m+M*(i*=f)+2*l)+i*(M*m+i+2*x)+y}else i=h,u=-(m=Math.max(0,-(M*i+l)))*m+i*(i+2*x)+y;else i=-h,u=-(m=Math.max(0,-(M*i+l)))*m+i*(i+2*x)+y;else i<=-d?u=-(m=Math.max(0,-(-M*h+l)))*m+(i=m>0?-h:Math.min(Math.max(-h,-x),h))*(i+2*x)+y:i<=d?(m=0,u=(i=Math.min(Math.max(-h,-x),h))*(i+2*x)+y):u=-(m=Math.max(0,-(M*h+l)))*m+(i=m>0?h:Math.min(Math.max(-h,-x),h))*(i+2*x)+y;else i=M>0?-h:h,u=-(m=Math.max(0,-(M*i+l)))*m+i*(i+2*x)+y;a&&cc_1.Vec3.scaleAndAdd(a,c,e,i),o&&o.set(a);let g=0;return u<V&&(g=cc_1.Vec3.distance(n.o,a)),g}}(),intersect={ray_triangle:ray_triangle,ray_aabb:ray_aabb,ray_segment:ray_segment};exports.default=intersect;