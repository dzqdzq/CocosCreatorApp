"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),tempVec3_a=new cc_1.Vec3,ray_triangle=function(){const c=new cc_1.Vec3(0,0,0),e=new cc_1.Vec3(0,0,0),t=new cc_1.Vec3(0,0,0),a=new cc_1.Vec3(0,0,0),n=new cc_1.Vec3(0,0,0);return function(r,_,s=!1,o){cc_1.Vec3.subtract(c,_.b,_.a),cc_1.Vec3.subtract(e,_.c,_.a),cc_1.Vec3.cross(t,r.d,e);const V=cc_1.Vec3.dot(c,t);if(V<Number.EPSILON&&(!s||V>-Number.EPSILON))return 0;const i=1/V;cc_1.Vec3.subtract(a,r.o,_.a);const m=cc_1.Vec3.dot(a,t)*i;if(m<0||m>1)return 0;cc_1.Vec3.cross(n,a,c);const u=cc_1.Vec3.dot(r.d,n)*i;if(u<0||m+u>1)return 0;const d=cc_1.Vec3.dot(e,n)*i;return d<0?0:(cc_1.Vec3.scaleAndAdd(o,r.o,r.d,d),d)}}(),ray_aabb=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3;return function(t,a){const n=t.o,r=t.d,_=1/r.x,s=1/r.y,o=1/r.z;cc_1.Vec3.subtract(c,a.center,a.halfExtents),cc_1.Vec3.add(e,a.center,a.halfExtents);const V=(c.x-n.x)*_,i=(e.x-n.x)*_,m=(c.y-n.y)*s,u=(e.y-n.y)*s,d=(c.z-n.z)*o,h=(e.z-n.z)*o,M=Math.max(Math.max(Math.min(V,i),Math.min(m,u)),Math.min(d,h)),x=Math.min(Math.min(Math.max(V,i),Math.max(m,u)),Math.max(d,h));return x<0||M>x?0:M>0?M:x}}(),ray_segment=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3,t=new cc_1.Vec3,a=new cc_1.Vec3;return function(n,r,_,s=2,o){const V=s*s;cc_1.Vec3.add(tempVec3_a,r,_),cc_1.Vec3.multiplyScalar(c,tempVec3_a,.5),cc_1.Vec3.subtract(tempVec3_a,_,r),cc_1.Vec3.normalize(e,tempVec3_a),cc_1.Vec3.subtract(t,n.o,c);var i,m,u,d,h=.5*cc_1.Vec3.distance(r,_),M=-n.d.dot(e),x=t.dot(n.d),l=-t.dot(e),b=t.lengthSqr(),f=Math.abs(1-M*M);if(f>0)if(m=M*x-l,d=h*f,(i=M*l-x)>=0)if(m>=-d)if(m<=d){var y=1/f;u=(i*=y)*(i+M*(m*=y)+2*x)+m*(M*i+m+2*l)+b}else m=h,u=-(i=Math.max(0,-(M*m+x)))*i+m*(m+2*l)+b;else m=-h,u=-(i=Math.max(0,-(M*m+x)))*i+m*(m+2*l)+b;else m<=-d?u=-(i=Math.max(0,-(-M*h+x)))*i+(m=i>0?-h:Math.min(Math.max(-h,-l),h))*(m+2*l)+b:m<=d?(i=0,u=(m=Math.min(Math.max(-h,-l),h))*(m+2*l)+b):u=-(i=Math.max(0,-(M*h+x)))*i+(m=i>0?h:Math.min(Math.max(-h,-l),h))*(m+2*l)+b;else m=M>0?-h:h,u=-(i=Math.max(0,-(M*m+x)))*i+m*(m+2*l)+b;a&&cc_1.Vec3.scaleAndAdd(a,c,e,m),o&&o.set(a);let w=0;return u<V&&(w=cc_1.Vec3.distance(n.o,a)),w}}(),intersect={ray_triangle:ray_triangle,ray_aabb:ray_aabb,ray_segment:ray_segment};exports.default=intersect;