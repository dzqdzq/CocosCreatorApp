"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),ray=cc_1.geometry.Ray,aabb=cc_1.geometry.AABB,triangle=cc_1.geometry.Triangle,tempVec3_a=new cc_1.Vec3,ray_triangle=function(){const c=new cc_1.Vec3(0,0,0),e=new cc_1.Vec3(0,0,0),t=new cc_1.Vec3(0,0,0),a=new cc_1.Vec3(0,0,0),n=new cc_1.Vec3(0,0,0);return function(r,_,s=!1,o){cc_1.Vec3.subtract(c,_.b,_.a),cc_1.Vec3.subtract(e,_.c,_.a),cc_1.Vec3.cross(t,r.d,e);const V=cc_1.Vec3.dot(c,t);if(V<Number.EPSILON&&(!s||V>-Number.EPSILON))return 0;const m=1/V;cc_1.Vec3.subtract(a,r.o,_.a);const i=cc_1.Vec3.dot(a,t)*m;if(i<0||i>1)return 0;cc_1.Vec3.cross(n,a,c);const u=cc_1.Vec3.dot(r.d,n)*m;if(u<0||i+u>1)return 0;const d=cc_1.Vec3.dot(e,n)*m;return d<0?0:(cc_1.Vec3.scaleAndAdd(o,r.o,r.d,d),d)}}(),ray_aabb=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3;return function(t,a){const n=t.o,r=t.d,_=1/r.x,s=1/r.y,o=1/r.z;cc_1.Vec3.subtract(c,a.center,a.halfExtents),cc_1.Vec3.add(e,a.center,a.halfExtents);const V=(c.x-n.x)*_,m=(e.x-n.x)*_,i=(c.y-n.y)*s,u=(e.y-n.y)*s,d=(c.z-n.z)*o,h=(e.z-n.z)*o,l=Math.max(Math.max(Math.min(V,m),Math.min(i,u)),Math.min(d,h)),M=Math.min(Math.min(Math.max(V,m),Math.max(i,u)),Math.max(d,h));return M<0||l>M?0:l>0?l:M}}(),ray_segment=function(){const c=new cc_1.Vec3,e=new cc_1.Vec3,t=new cc_1.Vec3,a=new cc_1.Vec3;return function(n,r,_,s=2,o){const V=s*s;cc_1.Vec3.add(tempVec3_a,r,_),cc_1.Vec3.multiplyScalar(c,tempVec3_a,.5),cc_1.Vec3.subtract(tempVec3_a,_,r),cc_1.Vec3.normalize(e,tempVec3_a),cc_1.Vec3.subtract(t,n.o,c);const m=.5*cc_1.Vec3.distance(r,_),i=-n.d.dot(e),u=t.dot(n.d),d=-t.dot(e),h=t.lengthSqr(),l=Math.abs(1-i*i);let M,x,y,b;if(l>0)if(x=i*u-d,b=m*l,(M=i*d-u)>=0)if(x>=-b)if(x<=b){const c=1/l;y=(M*=c)*(M+i*(x*=c)+2*u)+x*(i*M+x+2*d)+h}else x=m,y=-(M=Math.max(0,-(i*x+u)))*M+x*(x+2*d)+h;else x=-m,y=-(M=Math.max(0,-(i*x+u)))*M+x*(x+2*d)+h;else x<=-b?y=-(M=Math.max(0,-(-i*m+u)))*M+(x=M>0?-m:Math.min(Math.max(-m,-d),m))*(x+2*d)+h:x<=b?(M=0,y=(x=Math.min(Math.max(-m,-d),m))*(x+2*d)+h):y=-(M=Math.max(0,-(i*m+u)))*M+(x=M>0?m:Math.min(Math.max(-m,-d),m))*(x+2*d)+h;else x=i>0?-m:m,y=-(M=Math.max(0,-(i*x+u)))*M+x*(x+2*d)+h;a&&cc_1.Vec3.scaleAndAdd(a,c,e,x),o&&o.set(a);let f=0;return y<V&&(f=cc_1.Vec3.distance(n.o,a)),f}}(),intersect={ray_triangle:ray_triangle,ray_aabb:ray_aabb,ray_segment:ray_segment};exports.default=intersect;