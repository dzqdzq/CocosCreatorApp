"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.physics2DMgr=void 0;const sharp_1=__importDefault(require("sharp")),marching_squares_1=__importDefault(require("./marching-squares")),rdp_1=__importDefault(require("./rdp"));function pointEqual(t,e){return t.x===e.x&&t.y===e.y}class Physics2DManager{getContourPoints(t,e){return new Promise((r,i)=>{(0,sharp_1.default)(t).extract({left:e.left,top:e.top,width:e.width,height:e.height}).rotate(e.isRotated?90:0).raw().toBuffer((t,s)=>{if(t)return void i(t);let o=marching_squares_1.default.getBlobOutlinePoints(s,e.width,e.height,e.loop);(o=(0,rdp_1.default)(o,e.threshold)).length>0&&pointEqual(o[0],o[o.length-1])&&(o.length-=1),r(o)})})}}const physics2DMgr=new Physics2DManager;exports.physics2DMgr=physics2DMgr;