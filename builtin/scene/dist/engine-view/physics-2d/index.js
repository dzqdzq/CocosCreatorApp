"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.physics2DMgr=exports.Physics2DManager=void 0;const sharp_1=__importDefault(require("sharp")),marching_squares_1=__importDefault(require("./marching-squares")),rdp_1=__importDefault(require("./rdp"));function pointEqual(t,e){return t.x===e.x&&t.y===e.y}class Physics2DManager{getContourPoints(t,e){return new Promise((r,s)=>{(0,sharp_1.default)(t).extract({left:e.left,top:e.top,width:e.width,height:e.height}).rotate(e.isRotated?90:0).raw().toBuffer((t,i)=>{if(t)return void s(t);let a=marching_squares_1.default.getBlobOutlinePoints(i,e.width,e.height,e.loop);(a=(0,rdp_1.default)(a,e.threshold)).length>0&&pointEqual(a[0],a[a.length-1])&&(a.length-=1),r(a)})})}}exports.Physics2DManager=Physics2DManager;const physics2DMgr=new Physics2DManager;exports.physics2DMgr=physics2DMgr;