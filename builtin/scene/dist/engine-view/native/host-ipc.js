"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HostIpc=void 0;const utils_1=require("../../utils/ipc/utils"),Nativize=Editor.remote.Nativize;class HostIpc{constructor(){this._storage=new utils_1.DataStorage,this.idGenerator=0,this.isReady=!1,this.messageBuffer=[]}async send(e,...t){return new Promise((s,a)=>{const i=function(e,t){e?a(e):s(t)},r={message:e,arguments:t.map(utils_1.encodeArgs),callback:i,stack:""};if(!this.isReady){const e=this.idGenerator++;return this.messageBuffer.push({id:e,data:r})}Nativize.request({type:e,data:t}).then(e=>{i(null,null===e||void 0===e?void 0:e.data)})})}setReady(e){this.isReady=e,this.isReady&&this.messageBuffer.forEach(e=>{Nativize.request({type:e.data.message,data:e.data.arguments}).then(t=>{e.data.callback&&e.data.callback(null,null===t||void 0===t?void 0:t.data)})}),this.messageBuffer.length=0}}exports.HostIpc=HostIpc;