"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=exports.start=exports.stop=exports.status=void 0;const device_adapter_1=require("../utils/device-adapter");let leftButton=!1,middleButton=!1,rightButton=!1;const utils={createMouseEvent(e,t){const o=t.getBoundingClientRect(),a={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,x:e.pageX-o.x,y:e.pageY-o.y,clientX:e.clientX-o.x,clientY:e.clientY-o.y,deltaX:e.deltaX||0,deltaY:e.deltaY||0,wheelDeltaX:e.wheelDeltaX||0,wheelDeltaY:e.wheelDeltaY||0,moveDeltaX:e.movementX||0,moveDeltaY:e.movementY||0,movementX:e.movementX,movementY:e.movementY,leftButton:leftButton,middleButton:middleButton,rightButton:rightButton};if(device_adapter_1.DeviceAdapter.enable){const e=device_adapter_1.DeviceAdapter.deltaX,o=device_adapter_1.DeviceAdapter.deltaY;o>0?(a.y-=o,a.clientY-=o):(a.y+=t.scrollTop,a.clientY+=t.scrollTop),e>0?(a.x-=e,a.clientX-=e):(a.x+=t.scrollTop,a.clientX+=t.scrollLeft)}return a},createKeyboardEvent:e=>({ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,key:e.key,keyCode:e.keyCode,code:e.code}),createDragEvent(e,t){const{type:o,value:a,name:n,additional:u}=Editor.UI.DragArea.currentDragInfo||{},s=utils.createMouseEvent(e,t);s.name=n,s.type=o,s.value=a,s.values=[];let r=[];return Array.isArray(u)&&(s.values=u,r=s.values.map(e=>e.value)),a&&!r.includes(a)&&s.values.push({value:a,type:o,name:n}),s},createConfirmEvent:e=>({path:e.target.getAttribute("path"),value:e.target.value})};function stop(){exports.status="pause"}function start(){exports.status="ready"}function checkMouseButtonState(e,t){leftButton=0===e.button?t:leftButton,middleButton=1===e.button?t:middleButton,rightButton=2===e.button?t:rightButton}function init(e){e.addEventListener("mousedown",t=>{function o(t){0===t.movementX&&0===t.movementY||e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["mousemove",utils.createMouseEvent(t,e)],queue:!1,timeout:!0})}"pause"!==exports.status&&(document.body.style.pointerEvents="none",checkMouseButtonState(t,!0),e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["mousedown",utils.createMouseEvent(t,e)],queue:!1,timeout:!0}),document.addEventListener("mouseup",function t(a){var n;device_adapter_1.DeviceAdapter.enable&&(null===(n=e._preview)||void 0===n||n.focus()),document.body.style.pointerEvents="",e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["mouseup",utils.createMouseEvent(a,e)],queue:!1,timeout:!0}),checkMouseButtonState(a,!1),document.removeEventListener("mouseup",t),document.removeEventListener("mousemove",o)}),document.addEventListener("mousemove",o))}),e.addEventListener("mousemove",t=>{"pause"!==exports.status&&(0===t.movementX&&0===t.movementY||e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["mousemove",utils.createMouseEvent(t,e)],queue:!1,timeout:!0}))}),e.addEventListener("wheel",t=>{"pause"!==exports.status&&e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["mousewheel",utils.createMouseEvent(t,e)],queue:!1,timeout:!0})}),e.addEventListener("keydown",t=>{"pause"!==exports.status&&e.ipc.send("call-method",{module:"Operation",handler:"_emit",params:["keydown",utils.createKeyboardEvent(t)],queue:!1,timeout:!0})}),e.addEventListener("keyup",t=>{"pause"!==exports.status&&e.ipc.send("call-method",{module:"Operation",handler:"_emit",params:["keyup",utils.createKeyboardEvent(t)],queue:!1,timeout:!0})}),e.addEventListener("dragover",t=>{if("pause"===exports.status)return;const o=utils.createDragEvent(t,e);t.preventDefault(),e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["onDragOver",o],queue:!1,timeout:!0})}),e.addEventListener("drop",t=>{"pause"!==exports.status&&(t.preventDefault(),e.ipc.send("call-method",{module:"Operation",handler:"_emitMouseEvent",params:["onDrop",utils.createDragEvent(t,e)],queue:!1,timeout:!0}))})}exports.status="pause",exports.stop=stop,exports.start=start,exports.init=init;