"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,o,i){void 0===i&&(i=o);var n=Object.getOwnPropertyDescriptor(e,o);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,i,n)}:function(t,e,o,i){void 0===i&&(i=o),t[i]=e[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&__createBinding(e,t,o);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.isHidden=exports.update=exports.send=exports.unselect=exports.select=exports.unregister=exports.register=exports.get=void 0;const $window=document.createElement("div");function get(){return $window}$window.innerHTML='<header><span></span><ui-icon class="setting" value="setting"></ui-icon></header><section></section>',$window.hidden=!0,$window.classList.add("float-window"),$window.querySelector(".setting").addEventListener("mouseup",async t=>{const e=_optionCache[0];if(!e)return;const o=await Editor.Profile.getConfig("scene",`float-window.position.${e.type}.dock`);Editor.Menu.popup({x:t.pageX,y:t.pageY,menu:[{label:"Dock",checked:!!o,type:"checkbox",async click(){o?$window.removeAttribute("dock"):$window.setAttribute("dock",""),Editor.Profile.setConfig("scene",`float-window.position.${e.type}.dock`,!o,"local")}}]})}),$window.addEventListener("mousedown",t=>{t.stopPropagation()}),$window.querySelector("header").addEventListener("mousedown",t=>{t.stopPropagation();const e={width:$window.clientWidth,height:$window.clientHeight},o={width:$window.parentElement.clientWidth||0,height:$window.parentElement.clientHeight||0},i=t.pageX,n=t.pageY,d={top:$window.style.top?parseInt($window.style.top):NaN,left:$window.style.left?parseInt($window.style.left):NaN};function w(t,i){return t<0&&(t=0),i<0&&(i=0),i>o.width-e.width&&(i=o.width-e.width),t>o.height-e.height&&(t=o.height-e.height),{top:t,left:i}}isNaN(d.top)&&(d.top=$window.style.bottom?o.height-e.height-parseInt($window.style.bottom):0),isNaN(d.top)&&(d.top=0),isNaN(d.left)&&(d.left=$window.style.right?o.width-e.width-parseInt($window.style.right):0),isNaN(d.top)&&(d.left=0),d.left<0&&(d.left=0),d.top<0&&(d.top=0),$window.removeAttribute("left"),$window.removeAttribute("right"),$window.removeAttribute("top"),$window.removeAttribute("bottom");const r=function(t){const e=t.pageX-i,o=t.pageY-n,r=w(d.top+o,d.left+e);$window.style.top=`${r.top}px`,$window.style.left=`${r.left}px`,$window.style.right="",$window.style.bottom=""},s=function(t){const i=w($window.style.top?parseInt($window.style.top):0,$window.style.left?parseInt($window.style.left):0);i.top<o.height-(i.top+e.height)?i.left<o.width-(i.left+e.width)||($window.style.right=o.width-(i.left+e.width)+"px",$window.style.left=""):i.left<o.width-(i.left+e.width)?($window.style.bottom=o.height-(i.top+e.height)+"px",$window.style.top=""):($window.style.bottom=o.height-(i.top+e.height)+"px",$window.style.top="",$window.style.right=o.width-(i.left+e.width)+"px",$window.style.left=""),0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom"),document.removeEventListener("mousemove",r,!0),document.removeEventListener("mouseup",s,!0)};document.addEventListener("mousemove",r,!0),document.addEventListener("mouseup",s,!0)}),$window.addEventListener("mousemove",t=>{t.stopPropagation()}),$window.addEventListener("mouseup",t=>{t.stopPropagation()}),$window.addEventListener("wheel",t=>{t.stopPropagation()}),$window.addEventListener("keydown",t=>{t.stopPropagation()}),$window.addEventListener("keyup",t=>{t.stopPropagation()}),$window.addEventListener("dragover",t=>{t.stopPropagation()}),$window.addEventListener("drop",t=>{t.stopPropagation()}),exports.get=get;const map={};function register(t,e){map[t]=e}function unregister(t){delete map[t]}exports.register=register,exports.unregister=unregister;const _optionCache=[];async function select(t,e,o){const i=e.map(t=>{const e=[];for(const o in map)for(const i of map[o])i.type===t&&e.push(i);return e}).filter(t=>t.length>0);if(_optionCache.length>=1&&unselect(),!i[0]||0===i[0].length)return void unselect();const n=mergeFloatWindowOptions(i[0]);let d=n;"simple"===n.mode?$window.setAttribute("simple",""):($window.removeAttribute("simple"),d=await Editor.Profile.getConfig("scene",`float-window.position.${n.type}`)||n),$window.querySelector("header span").innerHTML=n.type,$window.querySelector("section").innerHTML=n.template,$window.style.width=`${n.width||200}px`,$window.style.height=`${n.height||200}px`,d.dock?$window.setAttribute("dock",""):$window.removeAttribute("dock");const w=n.height||200,r=n.width||200;if(void 0!==d.top&&null!==d.top){let t=d.top;t+w>$window.parentElement.clientHeight&&(t=Math.max($window.parentElement.clientHeight-w,0)),t<0&&(t=0),$window.style.top=`${t}px`,$window.style.bottom=""}else if(void 0!==d.bottom&&null!==d.bottom){let t=d.bottom;t+w>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-w),$window.style.bottom=`${t}px`,$window.style.top=""}else{let t=10;t+w>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-w),$window.style.bottom=`${t}px`,$window.style.top=""}if(void 0!==d.left&&null!==d.left){let t=d.left;t+r>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-r,0)),t<0&&(t=0),$window.style.left=`${t}px`,$window.style.right=""}else if(void 0!==d.right&&null!==d.right){let t=d.right;t+r>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-r,0)),$window.style.right=`${d.right}px`,$window.style.left=""}else{let t=10;t+r>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-r,0)),$window.style.right="10px",$window.style.left=""}_optionCache.push(n),$window.hidden=!1,0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom");try{n.ready($window,t,o)}catch(t){console.error(t)}}function unselect(){const t=_optionCache[0];for(;_optionCache.length;){const t=_optionCache.shift();try{t&&t.close()}catch(t){console.error(t)}}if($window.hidden=!0,!t)return;const e=parseInt($window.style.top||""),o=parseInt($window.style.bottom||""),i=parseInt($window.style.left||""),n=parseInt($window.style.right||""),d={dock:null!==$window.getAttribute("dock"),top:isNaN(e)?null:e,bottom:isNaN(o)?null:o,left:isNaN(i)?null:i,right:isNaN(n)?null:n};Editor.Profile.setConfig("scene",`float-window.position.${t.type}`,d,"local")}function send(t,...e){_optionCache.forEach(o=>{o.type===t&&o.send&&o.send(...e)})}function update(t,e,o){_optionCache.forEach(i=>{e.includes(i.type)&&i.update&&i.update(t,o)})}function isHidden(){return $window.hidden}function mergeFloatWindowOptions(t){const e=[],o=[],i=[],n=[],d={type:"",width:0,height:0,top:void 0,bottom:void 0,left:void 0,right:void 0,template:"",ready(...t){e.forEach(e=>{e(...t)})},close(...t){o.forEach(e=>{e(...t)})},update(...t){i.forEach(e=>{e(...t)})},send(...t){n.forEach(e=>{e(...t)})}};return t.forEach(t=>{d.type=t.type,d.width=Math.max(t.width,d.width),d.height=Math.max(t.height,d.height),void 0!==t.top&&(d.top=Math.max(t.top,d.top||0)),void 0!==t.bottom&&(d.bottom=Math.max(t.bottom,d.bottom||0)),void 0!==t.left&&(d.left=Math.max(t.left,d.left||0)),void 0!==t.right&&(d.right=Math.max(t.right,d.right||0)),d.template+=t.template,d.mode=d.mode||t.mode,t.ready&&e.push(t.ready),t.close&&o.push(t.close),t.update&&i.push(t.update),t.send&&n.push(t.send)}),d}exports.select=select,exports.unselect=unselect,exports.send=send,exports.update=update,exports.isHidden=isHidden,exports.default=__importStar(require("./float-window"));