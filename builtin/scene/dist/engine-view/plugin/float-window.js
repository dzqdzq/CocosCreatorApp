"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.update=exports.send=exports.unselect=exports.select=exports.unregister=exports.register=exports.get=void 0;const $window=document.createElement("div");function get(){return $window}$window.innerHTML='<header><span></span><ui-icon class="setting" value="setting"></ui-icon></header><section></section>',$window.hidden=!0,$window.classList.add("float-window"),$window.querySelector(".setting").addEventListener("mouseup",async t=>{const e=_optionCache[0];if(!e)return;const o=await Editor.Profile.getConfig("scene",`float-window.position.${e.type}.dock`);Editor.Menu.popup({x:t.pageX,y:t.pageY,menu:[{label:"Dock",checked:!!o,type:"checkbox",async click(){o?$window.removeAttribute("dock"):$window.setAttribute("dock",""),Editor.Profile.setConfig("scene",`float-window.position.${e.type}.dock`,!o,"local")}}]})}),$window.addEventListener("mousedown",t=>{t.stopPropagation()}),$window.querySelector("header").addEventListener("mousedown",t=>{t.stopPropagation();const e={width:$window.clientWidth,height:$window.clientHeight},o={width:$window.parentElement.clientWidth||0,height:$window.parentElement.clientHeight||0},i=t.pageX,n=t.pageY,w={top:$window.style.top?parseInt($window.style.top):NaN,left:$window.style.left?parseInt($window.style.left):NaN};function d(t,i){return t<0&&(t=0),i<0&&(i=0),i>o.width-e.width&&(i=o.width-e.width),t>o.height-e.height&&(t=o.height-e.height),{top:t,left:i}}isNaN(w.top)&&(w.top=$window.style.bottom?o.height-e.height-parseInt($window.style.bottom):0),isNaN(w.top)&&(w.top=0),isNaN(w.left)&&(w.left=$window.style.right?o.width-e.width-parseInt($window.style.right):0),isNaN(w.top)&&(w.left=0),w.left<0&&(w.left=0),w.top<0&&(w.top=0),$window.removeAttribute("left"),$window.removeAttribute("right"),$window.removeAttribute("top"),$window.removeAttribute("bottom");const s=function(t){const e=t.pageX-i,o=t.pageY-n,s=d(w.top+o,w.left+e);$window.style.top=`${s.top}px`,$window.style.left=`${s.left}px`,$window.style.right="",$window.style.bottom=""},r=function(t){const i=d($window.style.top?parseInt($window.style.top):0,$window.style.left?parseInt($window.style.left):0);i.top<o.height-(i.top+e.height)?i.left<o.width-(i.left+e.width)||($window.style.right=o.width-(i.left+e.width)+"px",$window.style.left=""):i.left<o.width-(i.left+e.width)?($window.style.bottom=o.height-(i.top+e.height)+"px",$window.style.top=""):($window.style.bottom=o.height-(i.top+e.height)+"px",$window.style.top="",$window.style.right=o.width-(i.left+e.width)+"px",$window.style.left=""),0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom"),document.removeEventListener("mousemove",s,!0),document.removeEventListener("mouseup",r,!0)};document.addEventListener("mousemove",s,!0),document.addEventListener("mouseup",r,!0)}),$window.addEventListener("mousemove",t=>{t.stopPropagation()}),$window.addEventListener("mouseup",t=>{t.stopPropagation()}),$window.addEventListener("wheel",t=>{t.stopPropagation()}),$window.addEventListener("keydown",t=>{t.stopPropagation()}),$window.addEventListener("keyup",t=>{t.stopPropagation()}),$window.addEventListener("dragover",t=>{t.stopPropagation()}),$window.addEventListener("drop",t=>{t.stopPropagation()}),exports.get=get;const map={};function register(t,e){map[t]=e}function unregister(t){delete map[t]}exports.register=register,exports.unregister=unregister;const _optionCache=[];async function select(t,e,o){const i=e.map(t=>{const e=[];for(const o in map)for(const i of map[o])i.type===t&&e.push(i);return e}).filter(t=>t.length>0);if(_optionCache.length>=1&&unselect(),!i[0]||0===i[0].length)return void unselect();const n=mergeFloatWindowOptions(i[0]);let w=n;"simple"===n.mode?$window.setAttribute("simple",""):($window.removeAttribute("simple"),w=await Editor.Profile.getConfig("scene",`float-window.position.${n.type}`)||n),$window.querySelector("header span").innerHTML=n.type,$window.querySelector("section").innerHTML=n.template,$window.style.width=`${n.width||200}px`,$window.style.height=`${n.height||200}px`,w.dock?$window.setAttribute("dock",""):$window.removeAttribute("dock");const d=n.height||200,s=n.width||200;if(void 0!==w.top&&null!==w.top){let t=w.top;t+d>$window.parentElement.clientHeight&&(t=Math.max($window.parentElement.clientHeight-d,0)),t<0&&(t=0),$window.style.top=`${t}px`,$window.style.bottom=""}else if(void 0!==w.bottom&&null!==w.bottom){let t=w.bottom;t+d>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-d),$window.style.bottom=`${t}px`,$window.style.top=""}else{let t=10;t+d>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-d),$window.style.bottom=`${t}px`,$window.style.top=""}if(void 0!==w.left&&null!==w.left){let t=w.left;t+s>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-s,0)),t<0&&(t=0),$window.style.left=`${t}px`,$window.style.right=""}else if(void 0!==w.right&&null!==w.right){let t=w.right;t+s>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-s,0)),$window.style.right=`${w.right}px`,$window.style.left=""}else{let t=10;t+s>$window.parentElement.clientWidth&&(t=Math.max($window.parentElement.clientWidth-s,0)),$window.style.right="10px",$window.style.left=""}_optionCache.push(n),$window.hidden=!1,0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom");try{n.ready($window,t,o)}catch(t){console.error(t)}}function unselect(){const t=_optionCache[0];for(;_optionCache.length;){const t=_optionCache.shift();try{t&&t.close()}catch(t){console.error(t)}}if($window.hidden=!0,!t)return;const e=parseInt($window.style.top||""),o=parseInt($window.style.bottom||""),i=parseInt($window.style.left||""),n=parseInt($window.style.right||""),w={dock:null!==$window.getAttribute("dock"),top:isNaN(e)?null:e,bottom:isNaN(o)?null:o,left:isNaN(i)?null:i,right:isNaN(n)?null:n};Editor.Profile.setConfig("scene",`float-window.position.${t.type}`,w,"local")}function send(t,...e){_optionCache.forEach(o=>{o.type===t&&o.send&&o.send(...e)})}function update(t,e,o){_optionCache.forEach(i=>{e.includes(i.type)&&i.update&&i.update(t,o)})}function mergeFloatWindowOptions(t){const e=[],o=[],i=[],n=[],w={type:"",width:0,height:0,top:void 0,bottom:void 0,left:void 0,right:void 0,template:"",ready(...t){e.forEach(e=>{e(...t)})},close(...t){o.forEach(e=>{e(...t)})},update(...t){i.forEach(e=>{e(...t)})},send(...t){n.forEach(e=>{e(...t)})}};return t.forEach(t=>{w.type=t.type,w.width=Math.max(t.width,w.width),w.height=Math.max(t.height,w.height),void 0!==t.top&&(w.top=Math.max(t.top,w.top||0)),void 0!==t.bottom&&(w.bottom=Math.max(t.bottom,w.bottom||0)),void 0!==t.left&&(w.left=Math.max(t.left,w.left||0)),void 0!==t.right&&(w.right=Math.max(t.right,w.right||0)),w.template+=t.template,w.mode=w.mode||t.mode,t.ready&&e.push(t.ready),t.close&&o.push(t.close),t.update&&i.push(t.update),t.send&&n.push(t.send)}),w}exports.select=select,exports.unselect=unselect,exports.send=send,exports.update=update,exports.default=module.exports;