"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,i,t,a){void 0===a&&(a=t);var n=Object.getOwnPropertyDescriptor(i,t);n&&("get"in n?i.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(e,a,n)}:function(e,i,t,a){void 0===a&&(a=t),e[a]=i[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(i,e,t);return __setModuleDefault(i,e),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ToolbarGameView=void 0;const Vue=require("vue/dist/vue.js"),data_1=require("./data"),plugin_1=require("./plugin"),ViewSelect=__importStar(require("../../../contributions/ui-kit/view-select/index")),template='\n    <div class="game-view-toolbar">\n          <div class="left">\n            <div class="item"> \n                <ui-button class="transparent" type="icon" @click="openDevTool">\n                    <ui-icon value="dev-tools"></ui-icon>\n                </ui-button>\n            </div>\n            <div class="item">\n                <span class="stats" :selected="gameViewData.stats" @click="handleOnStats">\n                    <ui-label value="Stats"></ui-label>\n                </span>\n            </div>\n            <div class="item fps">\n                <ui-label value="FPS"></ui-label>\n                <ui-num-input @change="handleOnFPS" step="1" min="1" :value="gameViewData.fps"></ui-num-input>\n            </div>\n        </div>\n        <div class="right">\n            <ui-prop class="item" tooltip="i18n:scene.camera_size.render_target_resolution">\n                <view-select\n                    :options="devicesList"\n                    :value="gameViewData.devicesInfo.name"\n                    @change="handleOnDevice"\n                >\n                </view-select>\n            </ui-prop>\n            <ui-prop class="item" :disabled="isNative" :tooltip="isNative ? \'i18n:scene.disable_in_native_tooltip\': undefined">\n                <ui-button class="rotate-wrap transparent" type="icon"\n                    @click="handleOnRotate"\n                    :selected="gameViewData.rotate"\n                    :disabled="isNative"\n                >\n                    <ui-icon value="rotate"></ui-icon>\n                </ui-button>\n            </ui-prop>\n            <ui-prop class="item scale" ref="scale" :disabled="isNative" :tooltip="isNative ? \'i18n:scene.disable_in_native_tooltip\': undefined">\n                <ui-button :disabled="isNative" class="transparent" type="icon"\n                    @click="onReduceButtonClick"\n                >\n                    <ui-icon value="reduce"></ui-icon>\n                </ui-button>\n                <ui-slider :disabled="isNative" step="1" hide-num-input\n                    :value="gameViewData.sliderValue"\n                    @change="handleOnScale"\n                ></ui-slider>\n                <ui-button :disabled="isNative" class="add transparent" type="icon"\n                    @click="onPlusButtonClick"\n                >\n                    <ui-icon value="add"></ui-icon>\n                </ui-button>\n                <ui-label :disabled="isNative"\n                    :value="gameViewData.scaleValue"\n                ></ui-label>\n                <ui-label value="%"></ui-label>\n            </ui-prop>\n            <ui-prop class="item" :disabled="isNative" :tooltip="isNative ? \'i18n:scene.disable_in_native_tooltip\' : undefined">\n                <ui-button class="fullscreen-wrap transparent" type="icon" :tooltip="isNative ? undefined : \'i18n:scene.game_view.full_screen_tips\'" \n                    :disabled="isNative"\n                    @click="handleOnFullScreen"\n                    :selected="gameViewData.fullScreen"\n                >\n                    <ui-icon value="fullscreen"></ui-icon>\n                </ui-button>\n            </ui-prop>\n        </div>\n    </div>\n';exports.ToolbarGameView=Vue.extend({name:"ToolbarGameView",components:{plugin:plugin_1.ToolbarPlguin,"view-select":ViewSelect},props:{isNative:{type:Boolean,default:!1},visible:{type:Boolean,default:!1}},data:()=>({devicesList:[],gameViewData:(0,data_1.getDefaultGameViewData)()}),mounted(){this.queryDevices(),this.initGameView(),Editor.Message.addBroadcastListener("device:devices-changed",this.onDevicesChanged),Editor.Message.addBroadcastListener("i18n:change",this.onI18nChange)},beforeDestroy(){Editor.Message.removeBroadcastListener("device:devices-changed",this.onDevicesChanged),Editor.Message.removeBroadcastListener("i18n:change",this.onI18nChange)},methods:{openDevTool(){Editor.Message.send("scene","open-preview-devtools")},async requestStyleChange(){const e=this.isNative?"editor-preview-change-style-native":"editor-preview-change-style-web",i=await Editor.Message.request("scene",e);if(null==i)throw new Error(`Invalid style changed return value:${i}, please ensure GameView is activated`);return i},async initGameView(){const e=await Editor.Profile.getConfig("scene","game-view");this.gameViewData=Object.assign({},this.gameViewData,e),this.isNative&&(this.gameViewData.scaleValue=100,this.gameViewData.sliderValue=50,this.gameViewData.fullScreen=!1)},async queryDevices(){const e=await Editor.Message.request("device","query"),i=await Editor.Message.request("project","query-design-resolution");this.devicesList=[];const t=e.map(e=>({label:`${e.name} (${e.width}x${e.height})`,name:e.name,width:e.width,height:e.height})),a=[{label:`${Editor.I18n.t("scene.game_view.free_aspect")}`,type:"free",name:"i18n:scene.game_view.free_aspect"},{label:"16:9",type:"ratio",width:16,height:9,name:"16:9"},{label:"16:10",type:"ratio",width:16,height:10,name:"16:10"}];this.isNative||a.push({label:`${Editor.I18n.t("scene.game_view.design_resolution")} (${i.width}x${i.height})`,type:"design",width:null===i||void 0===i?void 0:i.width,height:null===i||void 0===i?void 0:i.height,name:"i18n:scene.game_view.design_resolution"},{name:"__separator__"},...t,{name:"__separator__"},{label:Editor.I18n.t("scene.game_view.edit"),type:"edit",name:"i18n:scene.game_view.edit"}),this.devicesList=a},async handleOnStats(e){const i=!this.gameViewData.stats;this.gameViewData.stats=i,await Editor.Profile.setConfig("scene","game-view.stats",i),Editor.Message.send("scene","editor-preview-change-config")},async handleOnFPS(e){const i=e.target.value;this.gameViewData.fps=e.target.value,await Editor.Profile.setConfig("scene","game-view.fps",i),Editor.Message.send("scene","editor-preview-change-config")},async handleOnRotate(e){const i=!this.gameViewData.rotate;this.gameViewData.rotate=i,await Editor.Profile.setConfig("scene","game-view.rotate",i),this.requestStyleChange()},async handleOnFullScreen(e){const i=!this.gameViewData.fullScreen;this.gameViewData.fullScreen=i,await Editor.Profile.setConfig("scene","game-view.fullScreen",Boolean(i));const t=await this.requestStyleChange();i&&this.scaleToSlider(t.scale)},async handleOnScale(e){const i=e.target;this.isSliderValueSave(i.value)&&(this.solveScale(i.value),this.gameViewData.fullScreen&&(this.gameViewData.fullScreen=!1,await Editor.Profile.setConfig("scene","game-view.fullScreen",!1)),this.requestStyleChange())},scaleToSlider(e){let i=0;e>=100?i=50+50*(e-100)/300:e>10&&(i=50*(e-10)/90);const t=parseInt(String(i),10),a=parseInt(String(e),10);this.$set(this.gameViewData,"scaleValue",a),this.$set(this.gameViewData,"sliderValue",t),Editor.Profile.setConfig("scene","game-view.scaleValue",a),Editor.Profile.setConfig("scene","game-view.sliderValue",t)},solveScale(e){let i;e<50&&(i=10+e/50*90),50===e&&(i=100),e>50&&(i=100+(e-50)/50*300),this.gameViewData.sliderValue=e,this.gameViewData.scaleValue=parseInt(String(i),10),Editor.Profile.setConfig("scene","game-view.scaleValue",parseInt(String(i),10)),Editor.Profile.setConfig("scene","game-view.sliderValue",e)},onReduceButtonClick(e){const i=this.gameViewData.sliderValue-1;this.isSliderValueSave(i)&&(this.gameViewData.sliderValue=i,this.solveScale(i),this.requestStyleChange())},onPlusButtonClick(e){const i=this.gameViewData.sliderValue+1;this.isSliderValueSave(i)&&(this.gameViewData.sliderValue=i,this.solveScale(i),this.requestStyleChange())},isSliderValueSave:e=>e>=0&&e<=100,async handleOnDevice(e){if("i18n:scene.game_view.edit"===e)return void Editor.Message.request("preferences","open-settings","device");const i=this.devicesList.filter(i=>i.name===e)[0],t={name:e,type:(null===i||void 0===i?void 0:i.type)||"device",width:(null===i||void 0===i?void 0:i.width)||0,height:(null===i||void 0===i?void 0:i.height)||0};if(this.gameViewData.devicesInfo=t,await Editor.Profile.setConfig("scene","game-view.devicesInfo",t),this.visible){const e=await this.requestStyleChange();this.gameViewData.fullScreen&&this.scaleToSlider(e.scale)}},async onDevicesChanged(){this.queryDevices();const e=await Editor.Message.request("device","query");"i18n:scene.game_view.design_resolution"===this.gameViewData.devicesInfo.name||e.find(e=>e.name===this.gameViewData.devicesInfo.name)||this.handleOnDevice("i18n:scene.game_view.design_resolution")},onI18nChange(){this.queryDevices()}},template:template});