"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.update=exports.unregister=exports.register=exports.init=void 0;const Vue=require("vue/dist/vue");let vm=null;function init(e){vm=new Vue({el:e,components:{plugin:{props:["option"],template:'<div v-html="option.template"></div>',mounted(){const e=this,t={$:{}};e.option.__vm__=t,e.option.$&&Object.keys(e.option.$).forEach(i=>{const s=e.option.$[i];t.$[i]=e.$el.querySelector(s)}),e.option.methods&&Object.keys(e.option.methods).forEach(i=>{t[i]=e.option.methods[i]}),e.option.ready&&e.option.ready.call(t,vm.$el)}},"view-select":require("../../contributions/ui-kit/view-select/index")},data:{left:[],right:[],devicesList:[],gameViewData:{devicesInfo:{name:"i18n:scene.game_view.design_resolution",width:0,height:0,type:"design"},showGameView:!1,scaleValue:100,sliderValue:50,scaleMin:10,scaleMax:400,rotate:!1,fullScreen:!1,fps:60,stats:!1}},async mounted(){this.queryDevices(),this.initGameView()},methods:{async initGameView(){const e=await Editor.Profile.getConfig("scene","game-view");this.gameViewData=Object.assign({},this.gameViewData,e)},async queryDevices(){const e=await Editor.Message.request("device","query"),t=await Editor.Profile.getProject("project","general.designResolution");this.devicesList=[];const i=e.map(e=>({label:`${e.name} (${e.width}x${e.height})`,name:e.name,width:e.width,height:e.height})),s=[{label:`${Editor.I18n.t("scene.game_view.free_aspect")}`,type:"free",name:"i18n:scene.game_view.free_aspect"},{label:"16:9",type:"ratio",width:16,height:9,name:"16:9"},{label:"16:10",type:"ratio",width:16,height:10,name:"16:10"},{label:`${Editor.I18n.t("scene.game_view.design_resolution")} (${t.width}x${t.height})`,type:"design",width:null===t||void 0===t?void 0:t.width,height:null===t||void 0===t?void 0:t.height,name:"i18n:scene.game_view.design_resolution"},{name:"__separator__"},...i,{name:"__separator__"},{label:Editor.I18n.t("scene.game_view.edit"),type:"edit",name:"i18n:scene.game_view.edit"}];this.devicesList=s},handleOnStats(e){const t=!this.gameViewData.stats;this.gameViewData.stats=t,Editor.Profile.setConfig("scene","game-view.stats",t),Editor.Message.request("scene","preview-play-change-config")},handleOnFPS(e){const t=e.target.value;this.gameViewData.fps=e.target.value,Editor.Profile.setConfig("scene","game-view.fps",t),Editor.Message.request("scene","preview-play-change-config")},handleOnRotate(e){const t=!this.gameViewData.rotate;this.gameViewData.rotate=t,Editor.Profile.setConfig("scene","game-view.rotate",t),Editor.Message.request("scene","preview-play-change-style")},async handleOnFullScreen(e){const t=!this.gameViewData.fullScreen;this.gameViewData.fullScreen=t,Editor.Profile.setConfig("scene","game-view.fullScreen",Boolean(t));const i=await Editor.Message.request("scene","preview-play-change-style");t&&this.scaleToSlider(i.scale)},handleOnScale(e){const t=e.target;this.isSliderValueSave(t.value)&&(this.solveScale(t.value),this.gameViewData.fullScreen&&(this.gameViewData.fullScreen=!1,Editor.Profile.setConfig("scene","game-view.fullScreen",!1)),Editor.Message.request("scene","preview-play-change-style"))},scaleToSlider(e){let t=0;e>=100?t=50+50*(e-100)/300:e>10&&(t=50*(e-10)/90);const i=parseInt(t,10),s=parseInt(e,10);this.$set(this.gameViewData,"scaleValue",s),this.$set(this.gameViewData,"sliderValue",i),Editor.Profile.setConfig("scene","game-view.scaleValue",s),Editor.Profile.setConfig("scene","game-view.sliderValue",i)},solveScale(e){let t;e<50&&(t=10+e/50*90),50===e&&(t=100),e>50&&(t=100+(e-50)/50*300),this.gameViewData.sliderValue=e,this.gameViewData.scaleValue=parseInt(t,10),Editor.Profile.setConfig("scene","game-view.scaleValue",parseInt(t,10)),Editor.Profile.setConfig("scene","game-view.sliderValue",e)},onReduceButtonClick(e){const t=this.gameViewData.sliderValue-1;this.isSliderValueSave(t)&&(this.gameViewData.sliderValue=t,this.solveScale(t),Editor.Message.request("scene","preview-play-change-style"))},onPlusButtonClick(e){const t=this.gameViewData.sliderValue+1;this.isSliderValueSave(t)&&(this.gameViewData.sliderValue=t,this.solveScale(t),Editor.Message.request("scene","preview-play-change-style"))},isSliderValueSave:e=>e>=0&&e<=100,async handleOnDevice(e){if("i18n:scene.game_view.edit"===e)return void Editor.Message.request("preferences","open-settings","device");const t=this.devicesList.filter(t=>t.name===e)[0],i={name:e,type:(null===t||void 0===t?void 0:t.type)||"device",width:(null===t||void 0===t?void 0:t.width)||0,height:(null===t||void 0===t?void 0:t.height)||0};this.gameViewData.devicesInfo=i,Editor.Profile.setConfig("scene","game-view.devicesInfo",i),Editor.Message.request("scene","preview-play-change-style");const s=await Editor.Message.request("scene","preview-play-change-style");this.gameViewData.fullScreen&&this.scaleToSlider(s.scale)}}}),this.__broadcast=(async()=>{vm.queryDevices();const e=await Editor.Message.request("device","query");if("i18n:scene.game_view.design_resolution"!==vm.gameViewData.devicesInfo.name&&!e.find(e=>e.name===vm.gameViewData.devicesInfo.name)){vm.gameViewData.devicesInfo.name="i18n:scene.game_view.design_resolution",Editor.Message.request("scene","preview-play-change-style");const e=await Editor.Message.request("scene","preview-play-change-style");this.gameViewData.fullScreen&&this.scaleToSlider(e.scale)}}),Editor.Message.addBroadcastListener("device:devices-changed",this.__broadcast),Editor.Message.addBroadcastListener("i18n:change",()=>{vm.queryDevices()})}exports.init=init;const map={};function register(e,t){map[e]=t,t.forEach(e=>{"left"===e.position?vm.left.push(e):"right"===e.position&&vm.right.push(e)})}function unregister(e){const t=map[e];t&&(t.forEach(e=>{const t=vm.left.indexOf(e),i=vm.right.indexOf(e);-1!==t&&vm.left.splice(t,1),-1!==i&&vm.right.splice(i,1),e.close.call(e.__vm__)}),delete map[e])}exports.register=register,exports.unregister=unregister;const _optionCache=[];async function update(e,t,i){for(const s in map){map[s].forEach(s=>{s.update&&s.update.call(s.__vm__,e,t,i)})}}exports.update=update,exports.default=module.exports;