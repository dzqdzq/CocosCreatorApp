"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DumpElementBase=void 0;const electron_1=require("electron"),utils_1=require("./utils");class DumpElementBase{constructor(){this.$parentElement=null,this.$label=null,this.labelContextMenuEventBind=this.labelContextMenuEvent.bind(this)}mount(e){var t;e&&(e.shadowRoot&&this.style&&(t=e.shadowRoot.querySelector("#custom-style"))&&t.innerHTML!==this.style&&(t.innerHTML=this.style),e.innerHTML=this.template,this.$parentElement=e,this.$label=e.querySelector("ui-label"),this.mounted(e))}setLabel(e){var t,l,n;this.$label&&(t=(0,utils_1.getNameByDump)(e),this.$label.value=t,l=e.tooltip?e.tooltip.trim():"")&&(n=(n=(0,utils_1.getDocsURL)(e))?`
                <ui-link value='${n}'>
                    <ui-label value="${e.name||t}"></ui-label>
                </ui-link>`.trim():`<ui-label value="${e.name||t}"></ui-label>`,this.$label.setAttribute("tooltip",`
                <div style='margin-bottom: 10px'><ui-label style="font-weight:bold;" value="i18n:ENGINE.common.attribute.title"></ui-label>${n}</div><ui-label value="${l}"></ui-label>`.trim()))}pastePropertyValue(e){if(e)try{var t=JSON.parse(electron_1.clipboard.readText()),{type:l,value:n}=t;l&&void 0!==n&&this.$parentElement&&this.$parentElement.dump&&this.parseAndSetData(n,this.$parentElement.dump,t)&&(this.$parentElement.dispatch("change"),this.$parentElement.dispatch("confirm"))}catch(e){console.warn("paste error:",e)}}labelContextMenuEvent(e){if(e.stopPropagation(),e.preventDefault(),this.$parentElement){const t=electron_1.clipboard.readText();e=(0,utils_1.validatePasteEnable)(this.$parentElement.dump,t);Editor.Menu.popup({menu:[{label:Editor.I18n.t("scene.property_contextmenu.copy_property_path"),click:()=>{var e;this.$parentElement&&this.$parentElement.dump&&(e=(e=this.$parentElement.dump).path||e.name,electron_1.clipboard.writeText(e||""))}},{type:"separator"},{label:Editor.I18n.t("scene.property_contextmenu.copy_property_value"),click:()=>{var e,t,l,n;this.$parentElement&&({type:e="",value:n,enumList:t,bitmaskList:l}=this.$parentElement.dump,n={type:e,value:n},"Enum"===e&&(n.enumList=t),"BitMask"===e&&(n.bitmaskList=l),electron_1.clipboard.writeText(JSON.stringify(n)))}},{label:Editor.I18n.t("scene.property_contextmenu.paste_property_value"),enabled:e,click:()=>this.pastePropertyValue(t)}]})}}parseAndSetData(e,t,l){return!1}ready(){this.$label&&this.$label.addEventListener("contextmenu",this.labelContextMenuEventBind)}update(e){this.setLabel(e)}close(){this.$parentElement=null}isEventMethod(e){return"function"==typeof e}get listeners(){return this._listeners.reduce((e,t)=>{var l=this[t];return this.isEventMethod(l)&&(e[t.toString()]=l.bind(this)),e},{})}}exports.DumpElementBase=DumpElementBase;