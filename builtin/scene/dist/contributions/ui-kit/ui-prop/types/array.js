"use strict";function update(e){const t=this;t._dump=e;const r=t.$this;r.setAttribute("no-label","");const n=t.$this.renderInfo.panel;let a="root",o=r.parentElement;for(;o;){if(o.hasAttribute("cache-expand")){a=o.getAttribute("cache-expand")||"";break}o=o.parentElement}const i=`${a}-${`${e.name}-array-joint-${e.type}`}`,l=(i.match(new RegExp("(-array-joint-)","g"))||[]).length||1;t.$.container.setAttribute("cache-expand",i);const p=t.$.label;n.setLabel(e,p);const d=e.value,s=t.$.num;if(s.value=d.length,e.values&&e.values.length>1)return s.invalid=!0,void(t.$.content.innerHTML='\n        <ui-prop style="color: var(--color-default-fill-weakest);">\n            <ui-label slot="content" value="i18n:scene.ui_prop.array_not_support_multiple"></ui-label>\n        </ui-prop>\n        ');s.invalid&&(t.$.content.innerHTML=""),s.invalid=!1,n.setReadonly(e,s),t.$.readonly.style.display=e.readonly?"block":"none";const u=t.$.content,c=Array.from(u.children);for(;c.length>d.length;){const e=c.pop();e&&u.removeChild(e)}for(let r=0;r<d.length;r++){let a=c[r];if(!a){(a=document.createElement("div")).setAttribute("style","display: flex; padding: 0 0 0 12px; position: relative; border-top: 2px solid transparent; border-bottom: 2px solid transparent;"),a.addEventListener("dragover",e=>{e.preventDefault();const n=t._dump.path||`${t._dump.type}-${t._dump.name}`,a=r,o=Editor.UI.__protected__.DragItem._dump_array_;if(!o||n!==o.path)return;if(n===o.path&&a===o.index)return;const i=e.currentTarget,l=i.getBoundingClientRect(),p=l.height/2;e.clientY-l.top<=p?(i.style.borderTopColor="var(--color-focus-fill-weaker)",i.style.borderBottomColor="transparent"):l.bottom-e.clientY<=p&&(i.style.borderTopColor="transparent",i.style.borderBottomColor="var(--color-focus-fill-weaker)")}),a.addEventListener("dragleave",e=>{const t=e.currentTarget;t.style.borderTopColor="transparent",t.style.borderBottomColor="transparent"}),a.addEventListener("drop",e=>{var r,n;const a=e.currentTarget;if(a.style.borderTopColor="transparent",a.style.borderBottomColor="transparent",Editor.UI.__protected__.DragItem._dump_array_=null,""===(null===(r=e.dataTransfer)||void 0===r?void 0:r.getData("_dump_array_drag_index_")))return;if(!a.parentElement)return;e.stopPropagation();const o=Array.from(a.parentElement.children),i=a.getBoundingClientRect();let l=o.indexOf(a);const p=i.height/2;e.clientY-i.top<=p||i.bottom-e.clientY<=p&&(l+=1);const d=Number(null===(n=e.dataTransfer)||void 0===n?void 0:n.getData("_dump_array_drag_index_"));if(l>d){const e=t._dump.value[d];t._dump.value.splice(d,1),t._dump.value.splice(l-1,0,e)}else if(l<d){const e=t._dump.value[d];t._dump.value.splice(d,1),t._dump.value.splice(l,0,e)}t.$this.render(),t.$this.dispatch("change"),t.$this.dispatch("confirm")});const o=document.createElement("span");o.setAttribute("style","width: 6px; position: absolute; left: 0; top: 0; bottom: 0; cursor: move; background: linear-gradient(45deg, var(--color-default-border-weaker) 25%, var(--color-normal-fill) 0, var(--color-normal-fill) 50%, var(--color-default-border-weaker) 0, var(--color-default-border-weaker) 75%, var(--color-normal-fill) 0); background-size: 6px 6px;"),o.setAttribute("title","Drag to sort"),o.setAttribute("draggable","true"),n.setReadonly(e,o),a.appendChild(o),o.addEventListener("dragstart",n=>{e.readonly||(n.stopPropagation(),n.dataTransfer.setData("_dump_array_drag_index_",r.toString()),Editor.UI.__protected__.DragItem._dump_array_={path:t._dump.path||`${t._dump.type}-${t._dump.name}`,index:r})});const i=document.createElement("ui-prop");i.setAttribute("style",`flex: 1; --left-width: calc(100% - var(--ui-prop-content-width) + var(--ui-prop-margin-right) * ${l});margin-top:0;`),a.appendChild(i);const p=document.createElement("div");p.setAttribute("style","position: relative; width: 16px; padding-left: 4px;");const d=document.createElement("ui-icon");d.setAttribute("value","del"),d.setAttribute("color",""),d.setAttribute("style","position: absolute; top: 50%; transform: translateY(-50%); cursor: pointer;"),p.appendChild(d),n.setReadonly(e,d),a.appendChild(p),d.addEventListener("click",r=>{if(e.readonly)return;const n=r.currentTarget.parentElement.parentElement,a=Array.from(n.parentElement.children).indexOf(n);t._dump.value.splice(a,1),t.$this.dispatch("change"),t.$this.dispatch("confirm"),t.$this.render()}),u.appendChild(a)}a.children[1].setAttribute("type","dump"),a.children[1].setAttribute("array-index",r.toString()),a.children[1].setAttribute("array-type",t._dump.type),a.children[1].render(d[r])}n.setReadonly(e,u)}function ready(){const e=this,t=e.$this;e.hovingTimer=null,e.$.num.addEventListener("change",e=>{e.stopPropagation(),e.preventDefault()}),e.$.num.addEventListener("confirm",t=>{const r=e.$.num.value;if(Array.isArray(e._dump.value)||(e._dump.value=[]),e._dump.elementTypeData)for(;e._dump.value.length<r;){const t=JSON.parse(JSON.stringify(e._dump.elementTypeData));t.name=e._dump.value.length.toString(),e._dump.value.push(t)}else for(;e._dump.value.length<r;)e._dump.value.push(null);e._dump.value.length=r,r>0&&!e.$.container.expand&&setTimeout(()=>{e.$.container.expand||(e.$.container.expand=!0)},500),update.call(e,e._dump),e.$this.dispatch("change"),e.$this.dispatch("confirm")}),e.$this.addEventListener("dragover",r=>{if(r.preventDefault(),!e._dump||!e._dump.type)return;const n=Editor.UI.__protected__.DragArea.currentDragInfo;let a=n?n.type:null;-1!==r.dataTransfer.types.indexOf("Files")&&(a="file");const o=[];let i={};try{i=JSON.parse(JSON.stringify(Editor.UI.__protected__.DragArea.currentDragInfo))}catch(e){console.error(e)}const{additional:l}=i;l&&l.forEach(t=>{t.type===e._dump.type&&o.push(t.value)}),o.length&&(clearTimeout(t.hovingTimer),t.setAttribute("hoving",""),r.stopPropagation())}),t.addEventListener("dragleave",r=>{clearTimeout(e.hovingTimer),e.hovingTimer=setTimeout(()=>{t.removeAttribute("hoving")},200)}),t.addEventListener("drop",r=>{if(!t.hasAttribute("hoving"))return;if(!e._dump||!e._dump.type)return;r.stopPropagation(),r.preventDefault();const n=[];let a={};try{a=JSON.parse(JSON.stringify(Editor.UI.__protected__.DragArea.currentDragInfo))}catch(e){console.error(e)}const{additional:o}=a;if(o&&o.forEach(t=>{t.type===e._dump.type&&n.push(t.value)}),!n.length)return;const i=n.length+e._dump.value.length;e.$.num.value=i,e.$.content.setAttribute("expand",""),n.forEach(t=>{const r=JSON.parse(JSON.stringify(e._dump.elementTypeData));r.name=e._dump.value.length.toString(),r.value.uuid=t,e._dump.value.push(r)}),e.$this.dispatch("change"),e.$this.dispatch("confirm")}),t.addEventListener("drop",()=>{clearTimeout(e.hovingTimer),e.hovingTimer=setTimeout(()=>{t.removeAttribute("hoving")},200)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.style=exports.template=void 0,exports.template='\n<ui-section no-border>\n    <div slot="header" class="prop-name">\n        <ui-label style="flex: 1; white-space: nowrap;"></ui-label>\n        <ui-icon style="display: none; font-size: 10px;" value="lock"></ui-icon>\n    </div>\n    <ui-num-input slot="header" class="prop-content" step="1" min="0" preci="0"></ui-num-input>\n    <div class="content" style="--ui-prop-margin-left: 4px; margin-left: var(--ui-prop-margin-left);padding-top:2px;"></div>\n</ui-section>\n',exports.style="\n:host { margin-left: 0; }\n",exports.$={container:"ui-section",label:"ui-label",readonly:"ui-icon",num:"ui-num-input",content:".content"},exports.update=update,exports.ready=ready;