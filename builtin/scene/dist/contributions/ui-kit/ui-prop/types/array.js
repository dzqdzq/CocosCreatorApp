"use strict";function update(e){const t=this;t._dump=e;const r=t.$this;let n="root",a=r.parentElement;for(;a;){if(a.hasAttribute("cache-expand")){n=a.getAttribute("cache-expand");break}a=a.parentElement}const o=e.path||`${e.name}:${e.type}`;t.$.container.setAttribute("cache-expand",`${n}-${o}`);const i=t.$.label;r.setLabel(i,e),r.setAttribute("no-label","");const l=e.value,d=t.$.num;if(d.value=l.length,e.values&&e.values.length>1)return d.invalid=!0,void(t.$.content.innerHTML='<div style="padding-left: 10px;">Arrays do not support multiple selections</div>');d.invalid&&(t.$.content.innerHTML=""),d.invalid=!1,r.setReadonly(e,d);const s=t.$.content,p=Array.from(s.children);for(;p.length>l.length;){const e=p.pop();e&&s.removeChild(e)}for(let n=0;n<l.length;n++){let a=p[n];if(!a){(a=p[n]=p[n]=document.createElement("div")).setAttribute("style","display: flex; padding: 0 6px 0 14px; position: relative; border-top: 2px solid transparent; border-bottom: 2px solid transparent;"),a.addEventListener("dragover",e=>{e.preventDefault();const r=t._dump.path||`${t._dump.type}-${t._dump.name}`,a=n,o=Editor.UI.DragItem._dump_array_;if(!o||r!==o.path)return;if(r===o.path&&a===o.index)return;const i=e.currentTarget,l=i.getBoundingClientRect(),d=l.height/2;e.clientY-l.top<=d?(i.style.borderTopColor="var(--color-focus-fill-weaker)",i.style.borderBottomColor="transparent"):l.bottom-e.clientY<=d&&(i.style.borderTopColor="transparent",i.style.borderBottomColor="var(--color-focus-fill-weaker)")}),a.addEventListener("dragleave",e=>{const t=e.currentTarget;t.style.borderTopColor="transparent",t.style.borderBottomColor="transparent"}),a.addEventListener("drop",e=>{var r;e.stopPropagation();const n=e.currentTarget,a=Array.from(n.parentElement.children),o=n.getBoundingClientRect();let i=a.indexOf(n);const l=o.height/2;e.clientY-o.top<=l||o.bottom-e.clientY<=l&&(i+=1);const d=Number(null===(r=e.dataTransfer)||void 0===r?void 0:r.getData("_dump_array_drag_index_"));if(i>d){const e=t._dump.value[d];t._dump.value.splice(d,1),t._dump.value.splice(i-1,0,e),t.$this.dispatch("change"),t.$this.dispatch("confirm")}else if(i<d){const e=t._dump.value[d];t._dump.value.splice(d,1),t._dump.value.splice(i,0,e),t.$this.dispatch("change"),t.$this.dispatch("confirm")}n.style.borderTopColor="transparent",n.style.borderBottomColor="transparent"});const o=document.createElement("span");o.setAttribute("style","width: 6px; position: absolute; left: 0; top: 5px; bottom: 0; cursor: move; background: linear-gradient(45deg, var(--color-normal-border) 25%, var(--color-normal-fill) 0, var(--color-normal-fill) 50%, var(--color-normal-border) 0, var(--color-normal-border) 75%, var(--color-normal-fill) 0); background-size: 6px 6px;"),o.setAttribute("draggable","true"),r.setReadonly(e,o),a.appendChild(o),o.addEventListener("dragstart",r=>{e.readonly||(r.stopPropagation(),r.dataTransfer.setData("_dump_array_drag_index_",n.toString()),Editor.UI.DragItem._dump_array_={path:t._dump.path||`${t._dump.type}-${t._dump.name}`,index:n})});const i=document.createElement("ui-prop");i.setAttribute("style","flex: 1;"),a.appendChild(i);const l=document.createElement("div");l.setAttribute("style","position: relative; width: 1em; padding-left: 4px;");const d=document.createElement("ui-icon");d.setAttribute("value","del"),d.setAttribute("color",""),d.setAttribute("style","position: absolute; bottom: calc(50% - 14px); cursor: pointer;"),l.appendChild(d),r.setReadonly(e,d),a.appendChild(l),l.addEventListener("click",r=>{if(e.readonly)return;const n=r.target.parentElement.parentElement,a=Array.from(n.parentElement.children).indexOf(n);t._dump.value.splice(a,1),t.$this.dispatch("change"),t.$this.dispatch("confirm"),t.$this.render()}),s.appendChild(a)}a.children[1].setAttribute("type","dump"),a.children[1].setAttribute("array-index",n.toString()),a.children[1].render(l[n])}r.setReadonly(e,t.$.content)}function ready(){const e=this,t=e.$this;e.hovingTimer=null,e.$.num.addEventListener("change",e=>{e.stopPropagation(),e.preventDefault()}),e.$.num.addEventListener("confirm",t=>{const r=e.$.num.value;if(Array.isArray(e._dump.value)||(e._dump.value=[]),e._dump.elementTypeData)for(;e._dump.value.length<r;){const t=JSON.parse(JSON.stringify(e._dump.elementTypeData));t.name=e._dump.value.length.toString(),e._dump.value.push(t)}else for(;e._dump.value.length<r;)e._dump.value.push(null);e._dump.value.length=r,update.call(e,e._dump),e.$this.dispatch("change"),e.$this.dispatch("confirm")}),e.$this.addEventListener("dragover",r=>{if(r.preventDefault(),!e._dump||!e._dump.type)return;const n=[e._dump.type],a=Editor.UI.DragArea.currentDragInfo;let o=a?a.type:null;-1!==r.dataTransfer.types.indexOf("Files")&&(o="file");let i=n&&-1!==n.indexOf(o);!i&&a&&Array.isArray(a.extends)&&(i=a.extends.some(e=>n&&-1!==n.indexOf(e))),i&&(clearTimeout(t.hovingTimer),t.setAttribute("hoving",""),r.stopPropagation())}),t.addEventListener("dragleave",r=>{clearTimeout(e.hovingTimer),e.hovingTimer=setTimeout(()=>{t.removeAttribute("hoving")},200)}),t.addEventListener("drop",r=>{if(!t.hasAttribute("hoving"))return;if(!e._dump||!e._dump.type)return;r.stopPropagation(),r.preventDefault();const n=[],{additional:a,value:o}=JSON.parse(JSON.stringify(Editor.UI.DragArea.currentDragInfo))||{};if(a&&a.forEach(t=>{t.type===e._dump.type&&n.push(t.value)}),o&&!n.includes(o)&&n.push(o),!n.length)return;const i=n.length+e._dump.value.length;e.$.num.value=i,e.$.content.setAttribute("expand",""),n.forEach(t=>{const r=JSON.parse(JSON.stringify(e._dump.elementTypeData));r.name=e._dump.value.length.toString(),r.value.uuid=t,e._dump.value.push(r)}),e.$this.dispatch("change"),e.$this.dispatch("confirm")}),t.addEventListener("drop",()=>{clearTimeout(e.hovingTimer),e.hovingTimer=setTimeout(()=>{t.removeAttribute("hoving")},200)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=void 0,exports.template='\n<ui-section no-border>\n    <ui-label slot="header" class="prop-name"></ui-label>\n    <ui-num-input slot="header" class="prop-content" step="1" min="0"></ui-num-input>\n    <div class="content"></div>\n</ui-section>\n',exports.$={container:"ui-section",label:"ui-label",num:"ui-num-input",content:".content"},exports.update=update,exports.ready=ready;