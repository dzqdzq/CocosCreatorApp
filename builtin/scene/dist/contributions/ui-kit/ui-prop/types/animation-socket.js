"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=require("../../utils"),dum_element_base_1=require("../dum-element-base");class AnimationSocket extends dum_element_base_1.DumpElementBase{constructor(){super(...arguments),this.type=["cc.SkeletalAnimation.Socket","sp.Skeleton.SpineSocket","dragonBones.ArmatureDisplay.DragonBoneSocket"],this.$pathSelect=null,this.$node=null,this.selectClickEventBind=this.selectClickEvent.bind(this),this._listeners=["change"],this.template=`
        <!--<ui-label slot="label"></ui-label> -->
        <ui-prop>
            <ui-label slot="label">Path</ui-label>
            <ui-input readonly class="select-path" slot="content" local="path"></ui-input>
        </ui-prop>
        <ui-prop dump="cc.Asset" style="margin-top: 4px;">
            <ui-label slot="label">Target</ui-label>
            <ui-node droppable="cc.Node" slot="content" local="target"></ui-node>
        </ui-prop>
    `,this.style=""}parseAndSetData(t,e){return e.value.path.value=t.path.value,e.value.target.value={uuid:t.target.value.uuid},"values"in e&&(e.values.forEach(e=>{e.path.value=t.path.value}),e.values.forEach(e=>{e.target.value={uuid:t.target.value.uuid}})),!0}change(e,t){if(e.target){var a=e.target.getAttribute("local");const l=e.target.value;switch(a){case"path":t.value.path.value=l,"values"in t&&t.values.forEach(e=>{e.path.value=l});break;case"target":t.value.target.value={uuid:l},"values"in t&&t.values.forEach(e=>{e.target.value={uuid:l}})}}}findComponent(){if(this.$parentElement){let e=this.$parentElement;do{var t=(e=e.parentElement||e.getRootNode().host).dump;if(e&&t&&Array.isArray(t.extends)&&-1!==t.extends.indexOf("cc.Component"))break}while(e);return e}}async refreshSocketPathList(){var e=this.findComponent(),e=e?e.dump:null;if(e&&e.value.uuid){e=e.value.uuid.value,e=await Editor.Message.request((0,utils_1.getMessageProtocolScene)(this.$parentElement),"execute-component-method",{uuid:e,name:"querySockets",args:[]});if(e)return e.map(e=>({name:e}))}return[]}async selectClickEvent(e){var t=await this.refreshSocketPathList();const a=this;a.$pathSelect&&Editor.Panel.__protected__.openKit("ui-kit.searcher",{elem:a.$pathSelect,params:[{type:"string",list:t}],listeners:{async confirm(e){e&&(a.$pathSelect.value=e.value,a.$pathSelect.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0})))}}})}mounted(e){this.$pathSelect=e.querySelector(".select-path"),this.$node=e.querySelector("ui-node")}ready(){super.ready(),this.$pathSelect&&this.$pathSelect.addEventListener("click",this.selectClickEventBind)}update(e){this.refreshSocketPathList(),this.$pathSelect&&this.$node&&(this.$pathSelect.value!==e.value.path.value&&(this.$pathSelect.value=e.value.path.value),this.$node.value!==e.value.target.value.uuid)&&(this.$node.value=e.value.target.value.uuid)}close(){super.close(),this.$pathSelect&&this.$pathSelect.removeEventListener("click",this.selectClickEventBind)}}exports.default=AnimationSocket;