"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const dum_element_base_1=require("../dum-element-base"),defaultConfigValue={xRange:[0,1],yRange:[0,1],precisionX:4,precisionY:4,showPreWrapMode:!0,showPostWrapMode:!0,type:"hermit",negative:!1},ChangeToCurveRange="change-to-curve-range";class RealCurve extends dum_element_base_1.DumpElementBase{type=["cc.RealCurve","cc.AnimationCurve"];$curve=null;curveChangeEventBind=this.curveChangeEvent.bind(this);_listeners=[];template=`
        <ui-label slot="label"></ui-label>
        <ui-curve slot="content"></ui-curve>
    `;style=`
        :host .content::slotted(ui-curve) {
            height: 20px;
            border: var(--color-normal-border) 1px solid;
            box-sizing: border-box;
            background: var(--color-normal-fill-emphasis);
            cursor: pointer;
        }
    `;parseAndSetData(e,t){e=JSON.parse(JSON.stringify(e));return t.value=e,!0}changeDumpValueToCurveValue(e){e.radian&&(e.multiplier=1===e.multiplier?180:e.multiplier);let t=[];return{keys:t=Array.isArray(e.keyFrames)?e.keyFrames.map(e=>({inTangent:e.inTangent,outTangent:e.inTangent,point:{x:e.time,y:e.value},interpMode:e.interpMode,tangentWeightMode:e.tangentWeightMode,outTangentWeight:e.outTangentWeight,inTangentWeight:e.inTangentWeight})):t,postWrapMode:e.postExtrap,preWrapMode:e.preExtrap,multiplier:e.multiplier}}changeCurveValueToDumpValue(e){e.radian&&(e.multiplier=e.multiplier||1);let t=[];return Array.isArray(e.keys)&&(t=e.keys.map(e=>({inTangent:e.inTangent,outTangent:e.inTangent,time:e.point.x,value:e.point.y,interpMode:e.interpMode,tangentWeightMode:e.tangentWeightMode,outTangentWeight:e.outTangentWeight,inTangentWeight:e.inTangentWeight}))),{postExtrap:e.postWrapMode,preExtrap:e.preWrapMode,keyFrames:t,multiplier:e.multiplier}}curveChangeEvent(e){e.stopPropagation(),e.preventDefault();var t=this.$parentElement.dump,e=e.target.value;t&&e&&this.$parentElement&&(e.keys.sort((e,t)=>e.point.x-t.point.x),t.value=this.changeCurveValueToDumpValue(e),this.$parentElement.hasAttribute(ChangeToCurveRange)?this.$parentElement.dispatch(ChangeToCurveRange,{detail:{value:e,path:t.path,type:t.type}}):this.$parentElement.dispatch("change"))}mounted(e){this.$curve=e.querySelector("ui-curve")}ready(){super.ready(),this.$curve&&this.$curve.addEventListener("change",this.curveChangeEventBind)}update(t){if(super.update(t),this.$curve&&this.$parentElement){var n=JSON.parse(JSON.stringify(defaultConfigValue));let e=!1;this.$parentElement.hasAttribute(ChangeToCurveRange)?(n.yRange=[t.value.min??-1,t.value.max??1],void 0!==t.value.min&&null!==t.value.min||(e=!0)):(n.yRange=[t.min??-1,t.max??1],void 0!==t.min&&null!==t.min||(e=!0)),n.negative=!(0<=n.yRange[0]&&!1===e),this.$curve._config=n,this.$curve.setAttribute("label",t.displayName||t.name||""),this.$curve.value=this.changeDumpValueToCurveValue(t.value)}}close(){super.close(),this.$curve&&this.$curve.removeEventListener("change",this.curveChangeEventBind)}}exports.default=RealCurve;