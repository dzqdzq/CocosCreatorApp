"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const dum_element_base_1=require("../dum-element-base"),modeTransformMap={"0 -> 3":["constant","constantMin"],"3 -> 0":["constantMin","constant"],"1 -> 2":["spline","splineMin"],"2 -> 1":["splineMin","spline"]},ChangeToCurveRange="change-to-curve-range";class CurveRange extends dum_element_base_1.DumpElementBase{type=["cc.CurveRange"];$section=null;$icon=null;_listeners=[];template=`
        <ui-label slot="label"></ui-label>
        <section slot="content" style="--ui-prop-label-width-min: 90px;"></section>
        <ui-icon value="arrow-triangle" slot="content" style="flex: none;"></ui-icon>
    `;style="";parseAndSetData(e,a){var e=JSON.parse(JSON.stringify(e)),{constant:a,constantMax:n,constantMin:t,spline:i,splineMin:l,splineMax:s,mode:u}=a.value;return a.value=e.constant.value,n.value=e.constantMax.value,t.value=e.constantMin.value,u.value=e.mode.value,i.value={...e.spline.value,keyFrames:e.spline.value.keyFrames.map(e=>e)},l.value={...e.splineMin.value,keyFrames:e.splineMin.value.keyFrames.map(e=>e)},s.value={...e.splineMax.value,keyFrames:e.splineMax.value.keyFrames.map(e=>e)},!0}updateProps(a){if(this.$section&&this.$icon)if(a.values&&a.values.some(e=>e.mode.value!==a.value.mode.value))this.$section.innerHTML="Cannot edit different types";else{var e={min:a.min,max:a.max,radian:a.radian,multiplier:a.value.multiplier.value},n={multiplier:a.value.multiplier.value,min:a.min??Number.NEGATIVE_INFINITY,max:a.max??Number.POSITIVE_INFINITY,radian:a.radian},t=Array.from(this.$section.children);switch(t.length||(this.$section.innerHTML=""),a.value.mode.value){case 0:Object.assign(a.value.constant,n),this.renderPropData(a.value.constant,t[0],!1),t[1]&&this.$section.removeChild(t[1]);break;case 1:Object.assign(a.value.spline.value||{},e,{multiplier:a.value.multiplier.value,type:"curve"});var i=this.renderPropData(a.value.spline,t[0],!1);this.bindEventListener(i,a.value.spline.path),t[1]&&this.$section.removeChild(t[1]);break;case 2:Object.assign(a.value.splineMin.value||{},e),Object.assign(a.value.splineMax.value||{},e);var i=this.renderPropData(a.value.splineMin,t[0],!0),l=this.renderPropData(a.value.splineMax,t[1],!0);l&&(l.style.marginTop="4px"),this.bindEventListener(i,a.value.splineMin.path),this.bindEventListener(l,a.value.splineMax.path);break;case 3:Object.assign(a.value.constantMin,n),Object.assign(a.value.constantMax,n),this.renderPropData(a.value.constantMin,t[0],!0);i=this.renderPropData(a.value.constantMax,t[1],!0);i&&(i.style.marginTop="4px")}}}renderPropData(e,a,n){if(this.$section)return a||((a=document.createElement("ui-prop")).setAttribute("type","dump"),a.setAttribute(ChangeToCurveRange,""),this.$section.appendChild(a)),n?a.removeAttribute("no-label"):a.setAttribute("no-label",""),a.render(e),a}bindEventListener(e,a){e&&this.$parentElement&&!e.__bind&&(e.addEventListener(ChangeToCurveRange,e=>{if(this.$parentElement){const n=this.$parentElement.dump;var a=e.detail["value"];n.value.multiplier.value=a.multiplier,n.values&&n.values.forEach((e,a)=>{0!==a&&(n.values[a]=JSON.parse(JSON.stringify(n.value)))}),e.stopPropagation(),e.preventDefault(),this.$parentElement.dispatch("change")}}),e.__bind=!0)}mounted(e){this.$section=e.querySelector("section"),this.$icon=e.querySelector("ui-icon")}ready(){super.ready(),this.$icon&&this.$parentElement&&this.$icon.addEventListener("click",()=>{if(this.$parentElement){const t=this.$parentElement.dump;if(t){const i=this;Editor.Menu.popup({menu:t.value.mode.enumList.map(n=>({label:n.name,type:"radio",enabled:!t.readonly,checked:n.value===t.value.mode.value,click(){const a=modeTransformMap[t.value.mode.value+" -> "+n.value];t.value.mode.value=n.value,a&&(t.value[a[1]].value=t.value[a[0]].value),"values"in t&&(t.values.forEach(e=>{e.mode.value=n.value,a&&(e[a[1]].value=e[a[0]].value)}),t.value.mode.values=t.value.mode.values.map(e=>n.value)),i.$icon&&(i.$icon.dump=t.value.mode),i.updateProps(t);var e=new Event("change-dump",{bubbles:!0,cancelable:!0});a&&i.$section&&Array.from(i.$section.querySelectorAll("ui-prop"))[0].dispatchEvent(e),i.$icon&&i.$icon.dispatchEvent(e)}}))})}}})}update(e){super.update(e),this.updateProps(e)}}exports.default=CurveRange;