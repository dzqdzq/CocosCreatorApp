"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const dum_element_base_1=require("../dum-element-base"),modeTransformMap={"0 -> 3":["constant","constantMin"],"3 -> 0":["constantMin","constant"],"1 -> 2":["spline","splineMin"],"2 -> 1":["splineMin","spline"]},ChangeToCurveRange="change-to-curve-range";class CurveRange extends dum_element_base_1.DumpElementBase{constructor(){super(...arguments),this.type=["cc.CurveRange"],this.$section=null,this.$icon=null,this._listeners=[],this.template=`
        <ui-label slot="label"></ui-label>
        <section slot="content" style="--ui-prop-label-width-min: 90px;"></section>
        <ui-icon value="arrow-triangle" slot="content" style="flex: none;"></ui-icon>
    `,this.style=""}parseAndSetData(e,a){var e=JSON.parse(JSON.stringify(e)),{constant:a,constantMax:t,constantMin:n,spline:i,splineMin:s,splineMax:l,mode:u}=a.value;return a.value=e.constant.value,t.value=e.constantMax.value,n.value=e.constantMin.value,u.value=e.mode.value,i.value=Object.assign(Object.assign({},e.spline.value),{keyFrames:e.spline.value.keyFrames.map(e=>e)}),s.value=Object.assign(Object.assign({},e.splineMin.value),{keyFrames:e.splineMin.value.keyFrames.map(e=>e)}),l.value=Object.assign(Object.assign({},e.splineMax.value),{keyFrames:e.splineMax.value.keyFrames.map(e=>e)}),!0}updateProps(a){var e;if(this.$section&&this.$icon)if(a.values&&a.values.some(e=>e.mode.value!==a.value.mode.value))this.$section.innerHTML="Cannot edit different types";else{var t={min:a.min,max:a.max,radian:a.radian,multiplier:a.value.multiplier.value},n={multiplier:a.value.multiplier.value,min:null!=(e=a.min)?e:Number.NEGATIVE_INFINITY,max:null!=(e=a.max)?e:Number.POSITIVE_INFINITY,radian:a.radian},i=Array.from(this.$section.children);switch(i.length||(this.$section.innerHTML=""),a.value.mode.value){case 0:Object.assign(a.value.constant,n),this.renderPropData(a.value.constant,i[0],!1),i[1]&&this.$section.removeChild(i[1]);break;case 1:Object.assign(a.value.spline.value||{},t,{multiplier:a.value.multiplier.value,type:"curve"});var s=this.renderPropData(a.value.spline,i[0],!1);this.bindEventListener(s,a.value.spline.path),i[1]&&this.$section.removeChild(i[1]);break;case 2:Object.assign(a.value.splineMin.value||{},t),Object.assign(a.value.splineMax.value||{},t);var s=this.renderPropData(a.value.splineMin,i[0],!0),l=this.renderPropData(a.value.splineMax,i[1],!0);l&&(l.style.marginTop="4px"),this.bindEventListener(s,a.value.splineMin.path),this.bindEventListener(l,a.value.splineMax.path);break;case 3:Object.assign(a.value.constantMin,n),Object.assign(a.value.constantMax,n),this.renderPropData(a.value.constantMin,i[0],!0);s=this.renderPropData(a.value.constantMax,i[1],!0);s&&(s.style.marginTop="4px")}}}renderPropData(e,a,t){if(this.$section)return a||((a=document.createElement("ui-prop")).setAttribute("type","dump"),a.setAttribute(ChangeToCurveRange,""),this.$section.appendChild(a)),t?a.removeAttribute("no-label"):a.setAttribute("no-label",""),a.render(e),a}bindEventListener(e,a){e&&this.$parentElement&&!e.__bind&&(e.addEventListener(ChangeToCurveRange,e=>{if(this.$parentElement){const t=this.$parentElement.dump;var a=e.detail["value"];t.value.multiplier.value=a.multiplier,t.values&&t.values.forEach((e,a)=>{0!==a&&(t.values[a]=JSON.parse(JSON.stringify(t.value)))}),e.stopPropagation(),e.preventDefault(),this.$parentElement.dispatch("change")}}),e.__bind=!0)}mounted(e){this.$section=e.querySelector("section"),this.$icon=e.querySelector("ui-icon")}ready(){super.ready(),this.$icon&&this.$parentElement&&this.$icon.addEventListener("click",()=>{if(this.$parentElement){const n=this.$parentElement.dump;if(n){const i=this;Editor.Menu.popup({menu:n.value.mode.enumList.map(t=>({label:t.name,type:"radio",enabled:!n.readonly,checked:t.value===n.value.mode.value,click(){const a=modeTransformMap[n.value.mode.value+" -> "+t.value];n.value.mode.value=t.value,a&&(n.value[a[1]].value=n.value[a[0]].value),"values"in n&&(n.values.forEach(e=>{e.mode.value=t.value,a&&(e[a[1]].value=e[a[0]].value)}),n.value.mode.values=n.value.mode.values.map(e=>t.value)),i.$icon&&(i.$icon.dump=n.value.mode),i.updateProps(n);var e=new Event("change-dump",{bubbles:!0,cancelable:!0});a&&i.$section&&Array.from(i.$section.querySelectorAll("ui-prop"))[0].dispatchEvent(e),i.$icon&&i.$icon.dispatchEvent(e)}}))})}}})}update(e){super.update(e),this.updateProps(e)}}exports.default=CurveRange;