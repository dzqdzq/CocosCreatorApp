"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(n,t);i&&("get"in i?n.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,i)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(n,e,t);return __setModuleDefault(n,e),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.close=exports.ready=exports.methods=exports.$=exports.template=void 0;const utils_1=require("./utils"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;const vueTemplate='\n<div class="camera-size" v-show="show" >\n    <view-select tooltip="i18n:scene.camera_size.render_target_resolution"\n        :options="options"\n        :value="outputDevice"\n        @change="onChange"\n    >\n    </view-select>\n\n    <div\n        :class="{\'device-rotate\': true, selected: deviceRotate}"\n        @click="handleOnRotate"\n    >\n        <ui-icon value="rotate"></ui-icon>\n    </div>\n</div>\n',SceneCameraSizeVM=Vue.extend({name:"SceneCameraSizeVM",components:{"view-select":require("../../../../ui-kit/view-select/index")},data:()=>({options:[],outputDevice:"__default_design__",show:!0,deviceRotate:!1}),methods:{async refresh(){var e;const n=await Editor.Message.request("device","query")||[],t=await Editor.Profile.getProject("project","general.designResolution")||{},o=await Editor.Profile.getConfig("scene","camera.size")||"__default_design__",i=null!==(e=await Editor.Profile.getConfig("scene","camera.size_rotate"))&&void 0!==e&&e;this.outputDevice=o,this.deviceRotate=i;const r=n.map(e=>({label:`${e.name} (${e.width}x${e.height})`,name:e.name}));this.options=[{label:`${Editor.I18n.t("scene.game_view.design_resolution")} (${t.width}x${t.height})`,name:"__default_design__"},{name:"__separator__"},...r,{name:"__separator__"},{label:Editor.I18n.t("scene.game_view.edit"),name:"edit..."}]},async onChange(e){"edit..."!==e?(this.outputDevice=e||"__default_design__",await Editor.Profile.setConfig("scene","camera.size",this.outputDevice),Editor.Message.send("scene","change-target-resolution")):Editor.Message.send("preferences","open-settings","device")},async handleOnRotate(){this.deviceRotate=!this.deviceRotate,await Editor.Profile.setConfig("scene","camera.size_rotate",this.deviceRotate),Editor.Message.send("scene","change-target-resolution")}},template:vueTemplate});async function ready(){close(),panel=this,null===vm||void 0===vm||vm.$destroy(),(vm=new SceneCameraSizeVM).$mount(panel.$.container),Editor.Profile.__protected__.on("change",panel.generalDesignResolutionChanged),Editor.Message.__protected__.addBroadcastListener("device:devices-changed",panel.deviceChanged),Editor.Message.__protected__.addBroadcastListener("scene:dimension-changed",panel.dimensionChanged),Editor.Message.__protected__.addBroadcastListener("scene:ready",panel.sceneReady),Editor.Message.__protected__.addBroadcastListener("i18n:change",vm.refresh),vm&&await vm.refresh(),panel&&await panel.sceneReady()}function close(){panel&&(Editor.Profile.__protected__.removeListener("change",panel.generalDesignResolutionChanged),Editor.Message.__protected__.removeBroadcastListener("device:devices-changed",panel.deviceChanged),Editor.Message.__protected__.removeBroadcastListener("device:dimension-changed",panel.dimensionChanged),Editor.Message.__protected__.removeBroadcastListener("scene:ready",panel.sceneReady)),vm&&Editor.Message.__protected__.removeBroadcastListener("i18n:change",vm.refresh),null===vm||void 0===vm||vm.$destroy(),vm=null,panel=null}exports.template='\n<style>\n    .view-select-container {\n        user-select: none;\n        box-sizing: border-box;\n        border-radius: calc(var(--size-normal-radius) * 2px);\n        display: flex;\n        align-items: center;\n        position: relative;\n        cursor: pointer;\n        background-color: rgba(5, 5, 5, 0.68);\n        width: 100%;\n        height: 24px;\n        box-shadow: inset 0 0 0 calc(var(--size-normal-border) * 1px) var(--color-default-border-normal);\n        outline: none;\n        text-align: left;\n    }\n\n    .view-select-container .view-select {\n        display: flex;\n        padding-left: 6px;\n        padding-right: 20px;\n        width: 100%;\n        box-sizing: border-box;\n        outline: none;\n    }\n\n    .view-select #placeholder {\n        position: absolute;\n        left: 0;\n        top: 50%;\n        transform: translate(-4px, -50%);\n        padding: 0 2em 0 0.8em;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        pointer-events: none;\n    }\n\n    .view-select .arrow-triangle {\n        display: block;\n        position: absolute;\n        right: 0;\n        top: 50%;\n        transform: translate(-4px, -50%);\n        font-size: 12px;\n        pointer-events: none;\n        outline: none;\n    }\n\n    .view-select .label {\n        overflow: hidden;\n    }\n\n    .view-select .label > span {\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        display: block;\n    }\n\n    .view-select-container .options {\n        background-color: var(--color-normal-fill);\n        position: absolute;\n        will-change: top, left;\n        transform-origin: center top 0px;\n        bottom: 28px;\n        right: 10px;\n        /* 场景容器高度 - 预览的高度 - 工具栏高度30 - 自己的高度30 - 20空隙 */ \n        max-height: calc(var(--scene-height) - var(--float-window-height) - 30px - 30px - 20px);\n        max-width: 396px;\n        overflow: auto;\n        padding: 5px 0;\n        box-sizing: border-box;\n        border-radius: calc(var(--size-normal-radius) * 2px);\n        z-index: 99;\n    }\n\n    .options ul {\n        width: 100%;\n        list-style: none;\n        display: flex;\n        flex-direction: column;\n        padding: 0;\n        margin: 0;\n    }\n\n    .options ul > li {\n        margin: 0;\n        padding-left: 8px;\n        clear: both;\n        font-size: inherit;\n        list-style: none;\n        cursor: pointer;\n        transition: background 0.2s ease-in-out;\n        height: 24px;\n        line-height: 24px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        box-sizing: border-box;\n    }\n\n    .view-select-container .view-select:hover {\n        color: var(--color-focus-contrast-emphasis);\n    }\n\n    .options ul > li:hover {\n        background: var(--color-hover-fill);\n    }\n\n    .options ul > .selected {\n        background-color: var(--color-info-fill-important);\n        color: var(--color-info-contrast-important);\n    }\n\n    .options ul > .separator {\n        font-size: 0px;\n        height: 1px;\n        width: calc(100% - 8px);\n        overflow: hidden;\n        background-color: var(--color-default-border-weakest);\n        pointer-events: none;\n        margin: 4px 0;\n        align-self: center;\n    }\n\n    .options ul .no_options {\n        display: inline-block;\n        min-width: 98px;\n        pointer-events: none;\n    }\n\n    .view-select-container[focused] {\n        border-color: var(--color-focus-border);\n    }\n    .view-select-container[disabled] {\n        cursor: not-allowed;\n        opacity: 0.4;\n        pointer-events: none;\n    }\n    .view-select-container[readonly] {\n        pointer-events: none;\n    }\n    .view-select-container[hidden] {\n        display: none;\n    }\n\n    .camera-size {\n        --color-normal-fill-weaker: var(--color-default-fill-emphasis);\n        display: flex;\n        align-items: center;\n    }\n    .camera-size .device-rotate {\n        margin-left: 4px;\n        width: 24px;\n        height:24px;\n        display:flex;\n        justify-content: center;\n        align-items: center;\n        border-radius:calc(var(--size-normal-radius) * 2px);\n        cursor:pointer;\n        flex-shrink: 0;\n        background-color: rgba(5, 5, 5, 0.68);\n        color: var(--ui-button-color-base);\n    }\n    .camera-size .device-rotate.selected {\n        background-color: var(--color-info-fill-important);\n        color: var(--color-info-contrast-important);\n    }\n</style>\n\n<div class="camera-size"></div>\n',exports.$={container:".camera-size"},exports.methods={async deviceChanged(){vm&&(await vm.refresh(),vm&&"__default_design__"!==vm.outputDevice&&!vm.options.find(e=>e.name===vm.outputDevice)&&vm.onChange("__default_design__"))},generalDesignResolutionChanged(e,n,t,o){"project"===e&&n.includes("project")&&t.includes("general.designResolution")&&panel&&panel.deviceChanged()},dimensionChanged(e){vm&&(vm.show=!e)},async sceneReady(){if(!vm)return;const e=(0,utils_1.getParentRecursive)(vm.$el,e=>e instanceof HTMLElement&&"ENGINE-VIEW"===e.tagName);if(e){const n=await e.callSceneMethod("queryIs2D");vm&&(vm.show=!n)}}},exports.ready=ready,exports.close=close,exports.default=__importStar(require("./camera-size"));