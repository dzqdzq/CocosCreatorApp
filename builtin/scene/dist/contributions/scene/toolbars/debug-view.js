"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.methods=exports.$=exports.template=exports.position=exports.DebugViewCompositeType=exports.DebugViewSingleType=void 0;const Vue=require("vue/dist/vue");let panel=void 0,vm=void 0;var DebugViewSingleType,DebugViewCompositeType;function ready(e){(panel=this).menuName="debug-view";const i=e.nextElementSibling;vm=new Vue({el:panel.$.container,data:()=>({is2D:!1,showMenu:!1,selectText:"i18n:scene.debug_view.shaded",children:[{label:"i18n:scene.debug_view.base_shading",el:"ui-label",group:"radio",value:"SHADED",children:[{label:"i18n:scene.debug_view.shaded",el:"ui-radio",value:"SHADED"}]},{label:"i18n:scene.debug_view.rendering_debug_options",el:"ui-label",nextPanel:!0,children:[{label:"i18n:scene.debug_view.lighting_with_base_color",el:"ui-checkbox",value:!0,type:"LIGHTING_WITH_BASE_COLOR"},{label:"i18n:scene.debug_view.CSM_layer_coloration",el:"ui-checkbox",value:!1,type:"CSM_LAYER_COLORATION"},{label:"i18n:scene.debug_view.rendering_single_option",el:"ui-label",group:"radio",value:"NONE",children:[{label:"i18n:scene.debug_view.disable_all_single_options",el:"ui-radio",value:"NONE",type:"single"},{label:"i18n:scene.debug_view.model_info",el:"ui-label"},{label:"i18n:scene.debug_view.vertex_colors",el:"ui-radio",value:"VERTEX_COLOR",type:"single"},{label:"i18n:scene.debug_view.world_normal",el:"ui-radio",value:"VERTEX_NORMAL",type:"single"},{label:"i18n:scene.debug_view.world_tangent",el:"ui-radio",value:"VERTEX_TANGENT",type:"single"},{label:"i18n:scene.debug_view.world_position",el:"ui-radio",value:"WORLD_POS",type:"single"},{label:"i18n:scene.debug_view.mirrored_normal",el:"ui-radio",value:"VERTEX_MIRROR",type:"single"},{label:"i18n:scene.debug_view.front_face_coloration",el:"ui-radio",value:"FACE_SIDE",type:"single"},{label:"i18n:scene.debug_view.UV0",el:"ui-radio",value:"UV0",type:"single"},{label:"i18n:scene.debug_view.UV1",el:"ui-radio",value:"UV1",type:"single"},{label:"i18n:scene.debug_view.light_map_uv",el:"ui-radio",value:"UV_LIGHTMAP",type:"single"},{label:"i18n:scene.debug_view.projection_depth_z",el:"ui-radio",value:"PROJ_DEPTH",type:"single"},{label:"i18n:scene.debug_view.liner_depth_w",el:"ui-radio",value:"LINEAR_DEPTH",type:"single"},{label:"i18n:scene.debug_view.material_info",el:"ui-label"},{label:"i18n:scene.debug_view.world_space_pixel_normals",el:"ui-radio",value:"FRAGMENT_NORMAL",type:"single"},{label:"i18n:scene.debug_view.world_space_pixel_tangents",el:"ui-radio",value:"FRAGMENT_TANGENT",type:"single"},{label:"i18n:scene.debug_view.world_space_pixel_binormals",el:"ui-radio",value:"FRAGMENT_BINORMAL",type:"single"},{label:"i18n:scene.debug_view.base_color",el:"ui-radio",value:"BASE_COLOR",type:"single"},{label:"i18n:scene.debug_view.diffues_color",el:"ui-radio",value:"DIFFUSE_COLOR",type:"single"},{label:"i18n:scene.debug_view.specular_color",el:"ui-radio",value:"SPECULAR_COLOR",type:"single"},{label:"i18n:scene.debug_view.opacity",el:"ui-radio",value:"TRANSPARENCY",type:"single"},{label:"i18n:scene.debug_view.metallic",el:"ui-radio",value:"METALLIC",type:"single"},{label:"i18n:scene.debug_view.roughness",el:"ui-radio",value:"ROUGHNESS",type:"single"},{label:"i18n:scene.debug_view.specular_intencity",el:"ui-radio",value:"SPECULAR_INTENSITY",type:"single"},{label:"i18n:scene.debug_view.lighting_info",el:"ui-label"},{label:"i18n:scene.debug_view.direct_diffuse",el:"ui-radio",value:"DIRECT_DIFFUSE",type:"single"},{label:"i18n:scene.debug_view.direct_specular",el:"ui-radio",value:"DIRECT_SPECULAR",type:"single"},{label:"i18n:scene.debug_view.direct_lighting",el:"ui-radio",value:"DIRECT_ALL",type:"single"},{label:"i18n:scene.debug_view.ambient_diffuse",el:"ui-radio",value:"ENV_DIFFUSE",type:"single"},{label:"i18n:scene.debug_view.ambient_specular",el:"ui-radio",value:"ENV_SPECULAR",type:"single"},{label:"i18n:scene.debug_view.ambient_lighting",el:"ui-radio",value:"ENV_ALL",type:"single"},{label:"i18n:scene.debug_view.emissive",el:"ui-radio",value:"EMISSIVE",type:"single"},{label:"i18n:scene.debug_view.light_map",el:"ui-radio",value:"LIGHT_MAP",type:"single"},{label:"i18n:scene.debug_view.shadows",el:"ui-radio",value:"SHADOW",type:"single"},{label:"i18n:scene.debug_view.ambient_occlusion",el:"ui-radio",value:"AO",type:"single"},{label:"i18n:scene.debug_view.misc_info",el:"ui-label"},{label:"i18n:scene.debug_view.fog_factor",el:"ui-radio",value:"FOG",type:"single"}]},{label:"i18n:scene.debug_view.rendering_composite_options",el:"ui-label",group:"checkbox",children:[{label:"i18n:scene.debug_view.enable_all_composite_options",el:"ui-checkbox",value:!0,type:"composite",key:"ALL"},{label:"i18n:scene.debug_view.lighting",el:"ui-label"},{label:"i18n:scene.debug_view.direct_diffuse",el:"ui-checkbox",value:!0,type:"composite",key:"DIRECT_DIFFUSE"},{label:"i18n:scene.debug_view.direct_specular",el:"ui-checkbox",value:!0,type:"composite",key:"DIRECT_SPECULAR"},{label:"i18n:scene.debug_view.ambient_diffuse",el:"ui-checkbox",value:!0,type:"composite",key:"ENV_DIFFUSE"},{label:"i18n:scene.debug_view.ambient_specular",el:"ui-checkbox",value:!0,type:"composite",key:"ENV_SPECULAR"},{label:"i18n:scene.debug_view.emissive",el:"ui-checkbox",value:!0,type:"composite",key:"EMISSIVE"},{label:"i18n:scene.debug_view.light_map",el:"ui-checkbox",value:!0,type:"composite",key:"LIGHT_MAP"},{label:"i18n:scene.debug_view.shadows",el:"ui-checkbox",value:!0,type:"composite",key:"SHADOW"},{label:"i18n:scene.debug_view.ambient_occlusion",el:"ui-checkbox",value:!0,type:"composite",key:"AO"},{label:"i18n:scene.debug_view.misc_info",el:"ui-label"},{label:"i18n:scene.debug_view.normalMap",el:"ui-checkbox",value:!0,type:"composite",key:"NORMAL_MAP"},{label:"i18n:scene.debug_view.fog_factor",el:"ui-checkbox",value:!0,type:"composite",key:"FOG"},{label:"i18n:scene.debug_view.tone_mapping",el:"ui-checkbox",value:!0,type:"composite",key:"TONE_MAPPING"},{label:"i18n:scene.debug_view.cammacorrection",el:"ui-checkbox",value:!0,type:"composite",key:"GAMMA_CORRECTION"}]}]}]}),watch:{showMenu(e){this.$refs.component.show=e}},methods:{toolbarMenu(){Editor.Message.broadcast("scene:toolbar-menu-active","debug-view")},changeSelectText:function(e){vm.selectText=e},getFitHeight:()=>i.getBoundingClientRect().height-70}}),Editor.Message.addBroadcastListener("scene:ready",panel.sceneReady),Editor.Message.addBroadcastListener("scene:dimension-changed",panel.dimensionChanged),Editor.Message.addBroadcastListener("scene:toolbar-menu-active",panel.toolbarMenuActive),panel.sceneReady()}function close(){Editor.Message.removeBroadcastListener("scene:ready",panel.sceneReady),Editor.Message.removeBroadcastListener("scene:dimension-changed",panel.dimensionChanged),Editor.Message.removeBroadcastListener("scene:toolbar-menu-active",panel.toolbarMenuActive)}!function(e){e[e.NONE=0]="NONE",e[e.VERTEX_COLOR=1]="VERTEX_COLOR",e[e.VERTEX_NORMAL=2]="VERTEX_NORMAL",e[e.VERTEX_TANGENT=3]="VERTEX_TANGENT",e[e.WORLD_POS=4]="WORLD_POS",e[e.VERTEX_MIRROR=5]="VERTEX_MIRROR",e[e.FACE_SIDE=6]="FACE_SIDE",e[e.UV0=7]="UV0",e[e.UV1=8]="UV1",e[e.UV_LIGHTMAP=9]="UV_LIGHTMAP",e[e.PROJ_DEPTH=10]="PROJ_DEPTH",e[e.LINEAR_DEPTH=11]="LINEAR_DEPTH",e[e.FRAGMENT_NORMAL=12]="FRAGMENT_NORMAL",e[e.FRAGMENT_TANGENT=13]="FRAGMENT_TANGENT",e[e.FRAGMENT_BINORMAL=14]="FRAGMENT_BINORMAL",e[e.BASE_COLOR=15]="BASE_COLOR",e[e.DIFFUSE_COLOR=16]="DIFFUSE_COLOR",e[e.SPECULAR_COLOR=17]="SPECULAR_COLOR",e[e.TRANSPARENCY=18]="TRANSPARENCY",e[e.METALLIC=19]="METALLIC",e[e.ROUGHNESS=20]="ROUGHNESS",e[e.SPECULAR_INTENSITY=21]="SPECULAR_INTENSITY",e[e.DIRECT_DIFFUSE=22]="DIRECT_DIFFUSE",e[e.DIRECT_SPECULAR=23]="DIRECT_SPECULAR",e[e.DIRECT_ALL=24]="DIRECT_ALL",e[e.ENV_DIFFUSE=25]="ENV_DIFFUSE",e[e.ENV_SPECULAR=26]="ENV_SPECULAR",e[e.ENV_ALL=27]="ENV_ALL",e[e.EMISSIVE=28]="EMISSIVE",e[e.LIGHT_MAP=29]="LIGHT_MAP",e[e.SHADOW=30]="SHADOW",e[e.AO=31]="AO",e[e.FOG=32]="FOG"}(DebugViewSingleType=exports.DebugViewSingleType||(exports.DebugViewSingleType={})),function(e){e[e.DIRECT_DIFFUSE=0]="DIRECT_DIFFUSE",e[e.DIRECT_SPECULAR=1]="DIRECT_SPECULAR",e[e.ENV_DIFFUSE=2]="ENV_DIFFUSE",e[e.ENV_SPECULAR=3]="ENV_SPECULAR",e[e.EMISSIVE=4]="EMISSIVE",e[e.LIGHT_MAP=5]="LIGHT_MAP",e[e.SHADOW=6]="SHADOW",e[e.AO=7]="AO",e[e.NORMAL_MAP=8]="NORMAL_MAP",e[e.FOG=9]="FOG",e[e.TONE_MAPPING=10]="TONE_MAPPING",e[e.GAMMA_CORRECTION=11]="GAMMA_CORRECTION",e[e.MAX_BIT_COUNT=12]="MAX_BIT_COUNT",e[e.ALL=1e4]="ALL"}(DebugViewCompositeType=exports.DebugViewCompositeType||(exports.DebugViewCompositeType={})),Vue.component("DebugViewComponent",{props:{children:{type:Array,default:function(){return[]}},tickShow:{type:Boolean,default:!1}},data:()=>({show:!1,showChildren:!1,disabledAllSingleOps:!0}),watch:{show(e){const i=this;i.$el.style.display=e?"block":" none",e?i.$el.classList.contains("inner")&&(i.$el.style.height=`${vm.getFitHeight()}px`):i.$children.forEach(i=>{i.show=e})},tickShow(e){const i=this;i.showTimeId=setTimeout(()=>{i.show=e},100)}},methods:{mouseEnter(){clearTimeout(this.showTimeId)},nextTitleMouseEnter(e){e.stopPropagation(),clearTimeout(this.showTimeId),this.showChildren=!0},nextTitleMouseLeave(e){e.stopPropagation(),this.showChildren=!1},radioGroupChange(e){const i=this,l=e.target,n=e.currentTarget;if(!l||!n)return;n.value=l.value;let a=n.dataset.label;const o=i.$parent.$el.querySelector(".shaded");a.startsWith("i18n:")||(a=n.value),i.checkBaseShaded()?(a="i18n:scene.debug_view.shaded",o.checked=!0):o.checked=!1,i.$root.changeSelectText(a)},radioChange(e,i){const l=this,n=e.target;if(!n)return;const a=n.getAttribute("type");if(!a)return;const o=n.value,t=DebugViewSingleType[o];Editor.Message.send("scene","debug-view",{type:a,value:t}),"single"===a&&"NONE"===o?(l.disabledAllSingleOps=!0,l.allChecked("composite","ALL",!0)):l.disabledAllSingleOps=!1,l.$el.querySelector(".rendering-single-group").setAttribute("data-label",i.label)},checkboxChange(e){const i=this,l=e.target;if(!l)return;const n=l.getAttribute("type");if(!n)return;if("composite"===n){const e=l.getAttribute("key");if(!e)return;const a=l.value;if("ALL"===e)i.allChecked(n,e,a);else{const l={key:DebugViewCompositeType[e],value:a};Editor.Message.send("scene","debug-view",{type:n,value:l});const o=i.$el.querySelector(".checkbox-group"),t=i.checkCompositeAllChecked(o);o.querySelector(".check_all_composite").value=t}}else{const e=l.value;Editor.Message.send("scene","debug-view",{type:n,value:e})}const a=i.$parent.$el.querySelector(".shaded");let o="i18n:scene.debug_view.rendering_composite_options";i.checkBaseShaded()?(o="i18n:scene.debug_view.shaded",a.checked=!0):a.checked=!1,i.$root.changeSelectText(o)},checkCompositeAllChecked(e){for(const i of e.childNodes)if(i&&"UI-CHECKBOX"===i.tagName&&!i.classList.contains("check_all_composite")&&!i.value)return!1;return!0},checkBaseShaded(){const e=this,i=e.$el.querySelector(".lighting-with-base-color"),l=e.$el.querySelector(".csm-layer-coloration"),n=e.$el.querySelector(".rendering-single-group"),a=e.$el.querySelector(".check_all_composite");return i.value&&!l.value&&"NONE"===n.value&&a.value},allChecked(e,i,l){const n={key:DebugViewCompositeType[i],value:l};Editor.Message.send("scene","debug-view",{type:e,value:n}),this.$el.querySelector(".checkbox-group").childNodes.forEach(e=>{e&&"UI-CHECKBOX"===e.tagName&&(e.value=l)})},renderElement(e,i){const l=this;switch(e.el){case"ui-checkbox":return i(e.el,{class:{column:!0,check_all_composite:"composite"===e.type&&"ALL"===e.key,"lighting-with-base-color":"LIGHTING_WITH_BASE_COLOR"===e.type,"csm-layer-coloration":"CSM_LAYER_COLORATION"===e.type},attrs:{type:e.type,value:e.value,key:e.key,disabled:"LIGHTING_WITH_BASE_COLOR"!==e.type&&!l.disabledAllSingleOps},on:{change:l.checkboxChange}},[i("ui-label",{attrs:{value:e.label}})]);case"ui-radio":return i(e.el,{class:{column:!0,shaded:"SHADED"===e.value},attrs:{type:e.type,value:e.value,disabled:"SHADED"===e.value},on:{change:i=>{l.radioChange(i,e)}}},[i("ui-label",{attrs:{value:e.label}})]);case"ui-label":return i(e.el,{class:"column label",attrs:{value:e.label}})}},renderPanel(e,i){return[i("div",{class:"title next",on:{mouseenter:this.nextTitleMouseEnter,mouseleave:this.nextTitleMouseLeave}},[i(e.el,{attrs:{value:e.label}}),i("ui-icon",{attrs:{value:"arrow-right"}})]),i("debug-view-component",{props:{children:e.children,tickShow:this.showChildren},class:"inner"})]},renderGroup(e,i){const l=this,n=[];switch(n.push(i(e.el,{class:"title",attrs:{value:e.label}})),e.group){case"radio":n.push(i("ui-radio-group",{class:{group:!0,"radio-group":!0,"rendering-single-group":"radio"===e.group&&"NONE"===e.value},attrs:{"default-value":e.value},on:{change:e=>{l.radioGroupChange(e)}}},e.children.map(e=>l.renderElement(e,i))));break;case"checkbox":n.push(i("div",{class:"group checkbox-group"},e.children.map(e=>l.renderElement(e,i))))}return n},renderChildren(e,i){const l=this;return e.nextPanel?l.renderPanel(e,i):e.group?l.renderGroup(e,i):[l.renderElement(e,i)]}},render(e){const i=this;return e("div",{class:"panel",on:{mouseenter:i.mouseEnter,click:e=>{e.stopPropagation()}}},i.children.map(l=>e("div",{class:"list"},i.renderChildren(l,e))))}}),exports.position="right",exports.template='\n    <style>\n        .debug-view {\n            position: relative;\n            background-color: var(--color-default-fill-emphasis);\n            box-shadow: inset 0 0 0 calc(var(--size-normal-border) * 1px) var(--color-default-border-normal);\n            margin-right: 8px;\n            border-radius: calc(var(--size-normal-radius) * 2px);\n            cursor: pointer;\n            padding: 0px 6px;\n            white-space: nowrap;\n        }\n\n         .debug-view > .select-icon {\n            margin-left: 12px;\n         }\n\n         .debug-view:hover > .select-text,\n         .debug-view:hover > .select-icon {\n             color: var(--color-focus-contrast-emphasis);\n         }\n         \n         .debug-view .panel {\n            position: absolute;\n            display: none;\n            white-space: nowrap;\n            background-color: var(--color-normal-fill);\n            border-radius: calc(var(--size-normal-radius) * 2px);\n            border: 1px solid var(--color-normal-fill-weakest);\n         }\n\n         .debug-view .panel.wrap {\n            top: 30px;\n            right: 0;\n            z-index: 2;\n         }\n\n         .debug-view .panel.inner {\n            top: -40px;\n            right: -190px;\n            width: 210px;\n            z-index: 3;\n            overflow: auto;\n         }\n\n        .debug-view .list {\n            position: relative;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .debug-view .list .group {\n            flex: 1;\n        }\n        \n        .debug-view .list .column {\n            display: block;\n            height: 24px;\n            padding-left: 10px;\n        }\n\n        .debug-view .title {\n            display: flex;\n            padding-left: 8px;\n            color: var(--color-normal-contrast-emphasis);\n            background-color: var(--color-normal-fill-emphasis);\n            cursor: auto;\n        }\n\n        .debug-view .title.next {\n            cursor: pointer;\n        }\n\n        .debug-view .title.next:hover {\n            color: var(--color-normal-contrast);\n             background-color: var(--color-hover-fill);\n        }\n\n        .debug-view .title.next > ui-label {\n            flex: 1;\n        }\n\n        .debug-view .title.next > ui-icon {\n            font-size: 9px;\n            margin-left: 6px;\n            margin-right: 6px;\n        }\n           \n        .debug-view .label {\n            color: var(--color-normal-contrast-emphasis);\n            padding-left: 8px;\n\n        }\n\n        .debug-view .panel.wrap .list:first-child .title {\n            border-top-left-radius: calc(var(--size-normal-radius) * 2px);\n            border-top-right-radius: calc(var(--size-normal-radius) * 2px);\n        }\n\n        .debug-view .panel.wrap .list:last-child .title {\n            border-bottom-left-radius: calc(var(--size-normal-radius) * 2px);\n            border-bottom-right-radius: calc(var(--size-normal-radius) * 2px);\n        }\n\n        .debug-view .panel.inner .list .title {\n            border-radius: 0!important;\n        }\n    </style>\n    <div class="debug-view"\n        v-show="!is2D"\n        @click.stop="toolbarMenu"\n    >\n        <ui-label class="select-text" \n            :value="selectText"\n        ></ui-label>\n        <ui-icon class="select-icon" value="arrow-triangle"></ui-icon>\n        \n        <debug-view-component class="wrap" ref="component"\n            :children="children"\n        ></debug-view-component>\n    </div>\n',exports.$={container:".debug-view"},exports.methods={dimensionChanged(e){vm.is2D=e},async sceneReady(){const e=await Editor.Message.request("scene","query-is2D");panel.dimensionChanged(e)},toolbarMenuActive(e){e!==panel.menuName||vm.showMenu?vm.showMenu&&(vm.showMenu=!1):vm.showMenu=!0}},exports.ready=ready,exports.close=close,exports.default=module.exports;