"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.methods=exports.update=exports.ready=exports.$=exports.template=exports.position=void 0;const Vue=require("vue/dist/vue"),vm=null;async function ready(t){this.pivot="center",this.coordinate="global",Editor.Message.addBroadcastListener("scene:ready",async()=>{const t=await Editor.Message.request("scene","query-gizmo-tool-name");this.updateGizmoTool(t);const n=await Editor.Message.request("scene","query-gizmo-pivot");this.updateGizmoPivot(n);const i=await Editor.Message.request("scene","query-gizmo-coordinate");this.updateGizmoCoordinate(i)}),Editor.Message.addBroadcastListener("scene:gizmo-tool-changed",t=>{this.updateGizmoTool(t)}),Editor.Message.addBroadcastListener("scene:gizmo-pivot-changed",t=>{this.updateGizmoPivot(t)}),Editor.Message.addBroadcastListener("scene:gizmo-coordinate-changed",t=>{this.updateGizmoCoordinate(t)}),["position","rotation","scale","rect"].forEach(t=>{this.$[t].addEventListener("click",()=>{Editor.Message.send("scene","change-gizmo-tool",t)})}),this.$.pivot.addEventListener("click",()=>{"pivot"===this.pivot?(this.pivot="center",this.$.pivot.setAttribute("tooltip","i18n:scene.tooltips.centerTip"),this.$.pivotIcon.setAttribute("value","center")):(this.pivot="pivot",this.$.pivot.setAttribute("tooltip","i18n:scene.tooltips.pivotTip"),this.$.pivotIcon.setAttribute("value","anchor")),Editor.Message.send("scene","change-gizmo-pivot",this.pivot)}),this.$.coordinate.addEventListener("click",()=>{"local"===this.coordinate?(this.coordinate="global",this.$.coordinate.setAttribute("tooltip","i18n:scene.tooltips.global_gizmo"),this.$.coordinateIcon.setAttribute("value","coordinates-world")):(this.coordinate="local",this.$.coordinate.setAttribute("tooltip","i18n:scene.tooltips.local_gizmo"),this.$.coordinateIcon.setAttribute("value","coordinates-local")),Editor.Message.send("scene","change-gizmo-coordinate",this.coordinate)}),this.initConfiguration(),document.body.addEventListener("keydown",async t=>{const n=function t(n){return n&&n.shadowRoot?t(n.shadowRoot.activeElement):n}(document.activeElement);if(!n||"INPUT"!==n.tagName)if(t.ctrlKey||t.metaKey||t.alyKey||t.shiftKey)switch(t.key){case"f":case"F":if(t.ctrlKey&&t.shiftKey){const t=Editor.Selection.getSelected("node");t&&t.length&&Editor.Message.send("scene","align-node-to-scene-view",t)}}else switch(t.key){case"w":case"W":Editor.Message.send("scene","change-gizmo-tool","position");break;case"e":case"E":Editor.Message.send("scene","change-gizmo-tool","rotation");break;case"r":case"R":Editor.Message.send("scene","change-gizmo-tool","scale");break;case"t":case"T":Editor.Message.send("scene","change-gizmo-tool","rect");break;case"f":case"F":const n=Editor.Selection.getSelected("node");n&&n.length&&Editor.Message.send("scene","focus-camera",n);break;case"2":this.changeViewDimension()}})}async function update(t){}async function close(){}exports.position="left",exports.template='\n<div class="old-scene-toolbar">\n    <div class="scene-gizmo-buttons">\n        <ui-button type="icon" class="position transparent" tooltip="i18n:scene.tooltips.translate_gizmo">\n            <ui-icon value="move"></ui-icon>\n        </ui-button>\n        <ui-button type="icon" class="rotation transparent" tooltip="i18n:scene.tooltips.rotate_gizmo">\n            <ui-icon value="whirl"></ui-icon>\n        </ui-button>\n        <ui-button type="icon" class="scale transparent" tooltip="i18n:scene.tooltips.scale_gizmo">\n             <ui-icon value="shrink"></ui-icon>\n        </ui-button>\n        <ui-button type="icon" class="rect transparent" tooltip="i18n:scene.tooltips.rect_gizmo">\n             <ui-icon value="rectangle"></ui-icon>\n        </ui-button>\n        <ui-button type="icon" class="config transparent" tooltip="i18n:scene.increment_snap.title">\n            <ui-icon value="magnet"></ui-icon>\n        </ui-button>\n    <div class="configuration" tabindex="1">\n        <div class="title">\n            <ui-label value="i18n:scene.increment_snap.title"></ui-label>\n        </div>\n        <div class="column-wrap">\n            <ui-prop class="column">\n                <ui-button type="icon" class="transparent translate-button" slot="label" tooltip="i18n:scene.increment_snap.enable_translate">\n                     <ui-icon value="move"></ui-icon>\n                </ui-button>\n                <div class="translate" slot="content">\n                    <div class="part">\n                        <ui-num-input class="x-input" label="X" step="0.1" min="0"></ui-num-input>\n                    </div>\n                    <div class="part">\n                        <ui-num-input class="y-input" label="Y" step="0.1" min="0"></ui-num-input>\n                    </div>\n                    <div class="part">\n                        <ui-num-input class="z-input" label="Z" step="0.1" min="0"></ui-num-input>\n                    </div>\n                    <div class="together">\n                        <ui-icon class="together-button" value="link" tooltip="i18n:scene.increment_snap.xyz_together"></ui-icon>\n                    </div>\n                </div>\n            </ui-prop>\n            <ui-prop class="column">\n                <ui-button type="icon" class="transparent rotate-button" slot="label" tooltip="i18n:scene.increment_snap.enable_rotate">\n                    <ui-icon value="whirl"></ui-icon>\n                </ui-button>\n                <ui-num-input class="rotate-input" slot="content" step="0.1" min="0"></ui-num-input>\n            </ui-prop>\n            <ui-prop class="column">\n            <ui-button type="icon" class="transparent scale-button" slot="label" tooltip="i18n:scene.increment_snap.enable_scale">\n                <ui-icon value="shrink"></ui-icon>\n            </ui-button>\n            <ui-num-input class="scale-input" slot="content" step="0.1" min="0"></ui-num-input>\n        </ui-prop>\n        </div>\n        <div class="title">\n            <ui-label value="i18n:scene.rect_tool_snap.title"></ui-label>\n        </div>\n        <div class="column-wrap">\n            <ui-prop class="column" style="--left-width: 60%;">\n                <ui-label slot="label" value="i18n:scene.rect_tool_snap.enable_snap"></ui-label>\n                <ui-checkbox \n                    slot="content"\n                    class="rect-tool-snap-enable"\n                    tooltip="i18n:scene.rect_tool_snap.enable_snap"\n                ></ui-checkbox>\n            </ui-prop>\n            <ui-prop class="column" style="--left-width: 60%;">\n                <ui-label slot="label" value="i18n:scene.rect_tool_snap.threshold"></ui-label>\n                <ui-num-input slot="content" class="threshold-input" slot="content" step="0.1" min="0"></ui-num-input>\n            </ui-prop>\n        </div>\n    </div></div>\n    <div class="scene-gizmo-buttons scene-gizmo-location">\n        <ui-button type="icon" class="pivot transparent" tooltip="i18n:scene.tooltips.pivotTip">\n            <ui-icon value="anchor"></ui-icon>\n        </ui-button>\n        <ui-button type="icon" class="coordinate transparent" tooltip="i18n:scene.tooltips.local_gizmo">\n             <ui-icon value="coordinates-local"></ui-icon>\n        </ui-button>\n    </div>\n</div>\n<style>\n.old-scene-toolbar {\n    display: flex;\n    white-space: nowrap;\n}\n\n.old-scene-toolbar[hidden] {\n    display: none;\n}\n\n.scene-gizmo-buttons {\n    border-radius: calc(var(--size-normal-radius) * 2px);\n    border: inset 1px solid var(--color-default-fill-weaker);\n    height: calc(var(--size-normal-line) * 1px);\n    overflow: hidden;\n    display: flex;\n    background-color: var(--color-default-fill-emphasis);\n    box-shadow: inset 0 0 0 calc(var(--size-normal-border) * 1px) var(--color-default-border-normal);\n}\n\n.scene-gizmo-buttons > ui-button {\n    cursor: pointer;\n    user-select: none;\n    border-radius: 0;\n    padding: 0;\n    width: calc(var(--size-normal-line) * 1px);\n}\n\n.scene-gizmo-buttons > ui-button[active] {\n    background: var(--color-focus-fill-important);\n    color: var(--color-focus-contrast-emphasis);\n}\n\n.scene-gizmo-buttons .configuration {\n    display: none;\n    font-size: 12px;\n    text-align: left;\n    padding: 10px;\n    margin: 0;\n    position: absolute;\n    z-index: 99;\n    left: 80px;\n    top: 30px;\n    width: 227px;\n    background: var(--color-normal-fill);\n    overflow: hidden;\n    border-radius: calc(var(--size-normal-radius) * 1px);\n}\n\n.scene-gizmo-buttons .configuration[active] {\n    display: block;\n}\n\n.scene-gizmo-buttons .configuration > .title {\n    color: var(--color-normal-contrast-emphasis)\n}\n\n.scene-gizmo-buttons .configuration > .title:not(:first-child) {\n    margin-top: 10px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap {\n    padding-left: 15px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column {\n    margin-top: 5px;\n    --left-width: 30px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > ui-button {\n    display: flex;\n    justify-content: center;\n    width: 24px;\n    height: 22px;\n    cursor: pointer;\n    font-size: 12px;\n    user-select: none;\n    color: var(--color-normal-contrast);\n    border: none;\n    border-radius: calc(var(--size-normal-radius) * 1px);\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > ui-button[active] {\n    background: var(--color-focus-fill-important);\n    color: var(--color-focus-contrast-important);\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > ui-button > svg {\n    width: 12px;\n    height: 12px;\n    padding-top: 5px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate {\n    display: flex;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate > .part {\n    text-align: center;\n    padding-right: 5px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column-wrap > .column > .translate > .part > ui-num-input {\n    width: 47px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate > .together {\n    padding-left: 5px;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate > .together > ui-icon {\n    cursor: pointer;\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate > .together > ui-icon[active] {\n    color: var(--color-focus-contrast-weaker);\n}\n\n.scene-gizmo-buttons .configuration > .column-wrap > .column > .translate > .together > ui-icon:hover {\n    color: var(--color-focus-contrast-weakest);\n}\n\n.scene-gizmo-location {\n    display: flex;\n    margin-left: 8px;\n}\n\nui-icon {\n    color: var(--color-contrast-emphasis);\n}\n\n@media all and (max-width: 880px) {\n    .scene-gizmo-location {\n        display: none;\n    }\n}\n\n</style>\n',exports.$={sceneToolbar:".old-scene-toolbar",position:".position",rotation:".rotation",scale:".scale",rect:".rect",config:".config",configuration:".configuration",translateButton:".translate-button",rotateButton:".rotate-button",scaleButton:".scale-button",xInput:".x-input",yInput:".y-input",zInput:".z-input",togetherButton:".together-button",rotateInput:".rotate-input",scaleInput:".scale-input",rectToolSnapEnable:".rect-tool-snap-enable",rectToolSnapThresholdInput:".threshold-input",pivot:".pivot",pivotIcon:".pivot > ui-icon",coordinate:".coordinate",coordinateIcon:".coordinate > ui-icon"},exports.ready=ready,exports.update=update,exports.methods={updateGizmoTool(t){["position","rotation","scale","rect"].forEach(n=>{n===t?this.$[n].setAttribute("active",""):this.$[n].removeAttribute("active")})},updateGizmoPivot(t){this.pivot=t},updateGizmoCoordinate(t){this.coordinate=t},changeViewDimension(){!0===this.is2D?this.is2D=!1:this.is2D=!0,Editor.Message.send("scene","change-is2D",this.is2D),Editor.Profile.setConfig("scene","gizmos-infos.is2D",this.is2D)},initConfiguration(){this.$.config.addEventListener("click",t=>{t.stopPropagation(),this.$.config.getAttribute("active")?this.hideConfiguration():this.showConfiguration(),Editor.Message.broadcast("scene:toolbar-menu-active","increment")}),Editor.Message.addBroadcastListener("scene:toolbar-menu-active",t=>{"increment"!==t&&this.hideConfiguration()}),this.$.configuration.addEventListener("click",t=>{t.stopPropagation()}),document.addEventListener("click",t=>{this.hideConfiguration()}),this.$.togetherButton.addEventListener("click",()=>{this.$.togetherButton.toggleAttribute("active"),this.$.yInput.toggleAttribute("disabled"),this.$.zInput.toggleAttribute("disabled"),this.$.togetherButton.hasAttribute("active")&&this.setConfigurationPositionYZSameAsX()}),this.$.configuration.addEventListener("mouseenter",()=>{clearTimeout(this.hideConfigurationTimeId)}),this.$.translateButton.addEventListener("click",async()=>{this.submitConfiguration("isPositionSnapEnabled",!this.$.translateButton.hasAttribute("active"))}),this.$.xInput.addEventListener("change",t=>{this.configData.position.x=t.target.value,this.$.togetherButton.hasAttribute("active")?this.setConfigurationPositionYZSameAsX():this.submitConfiguration("position",this.configData.position)}),this.$.yInput.addEventListener("change",t=>{this.configData.position.y=t.target.value,this.submitConfiguration("position",this.configData.position)}),this.$.zInput.addEventListener("change",t=>{this.configData.position.z=t.target.value,this.submitConfiguration("position",this.configData.position)}),this.$.rotateButton.addEventListener("click",()=>{this.submitConfiguration("isRotationSnapEnabled",!this.$.rotateButton.hasAttribute("active"))}),this.$.rotateInput.addEventListener("change",t=>{this.submitConfiguration("rotation",t.target.value)}),this.$.scaleButton.addEventListener("click",()=>{this.submitConfiguration("isScaleSnapEnabled",!this.$.scaleButton.hasAttribute("active"))}),this.$.scaleInput.addEventListener("change",t=>{this.submitConfiguration("scale",t.target.value)}),this.$.rectToolSnapEnable.addEventListener("change",async t=>{await Editor.Message.request("scene","set-rect-snapping-configs","enableSnapping",t.target.value)}),this.$.rectToolSnapThresholdInput.addEventListener("change",async t=>{await Editor.Message.request("scene","set-rect-snapping-configs","snapThreshold",t.target.value)})},async showConfiguration(){clearTimeout(this.hideConfigurationTimeId),this.$.configuration.setAttribute("active",""),await this.refreshConfiguration(),this.checkConfigurationPosition()},hideConfiguration(){clearTimeout(this.hideConfigurationTimeId),this.hideConfigurationTimeId=setTimeout(()=>{this.$.configuration.removeAttribute("active")},200)},async refreshConfiguration(){this.configData=await Editor.Message.request("scene","query-transform-snap-configs"),this.configData&&(this.$.xInput.setAttribute("value",this.configData.position.x),this.$.yInput.setAttribute("value",this.configData.position.y),this.$.zInput.setAttribute("value",this.configData.position.z),this.$.rotateInput.setAttribute("value",this.configData.rotation),this.$.scaleInput.setAttribute("value",this.configData.scale),this.rectToolConfigData=await Editor.Message.request("scene","query-rect-snapping-configs"),this.$.rectToolSnapEnable.setAttribute("value",this.rectToolConfigData.enableSnapping),this.$.rectToolSnapThresholdInput.setAttribute("value",this.rectToolConfigData.snapThreshold),this.checkConfigurationEnable())},checkConfigurationEnable(){const t={translateButton:"isPositionSnapEnabled",rotateButton:"isRotationSnapEnabled",scaleButton:"isScaleSnapEnabled"};for(const n in t){const i=t[n];this.configData[i]?this.$[n].setAttribute("active",""):this.$[n].removeAttribute("active")}},checkConfigurationPosition(){this.configData.position.x===this.configData.position.y&&this.configData.position.x===this.configData.position.z?(this.$.togetherButton.setAttribute("active",""),this.$.yInput.setAttribute("disabled",""),this.$.zInput.setAttribute("disabled","")):(this.$.togetherButton.removeAttribute("active"),this.$.yInput.removeAttribute("disabled"),this.$.zInput.removeAttribute("disabled"))},setConfigurationPositionYZSameAsX(){this.configData.position.z=this.configData.position.y=this.configData.position.x,this.$.yInput.setAttribute("value",this.configData.position.y),this.$.zInput.setAttribute("value",this.configData.position.z),this.submitConfiguration("position",this.configData.position)},async submitConfiguration(t,n){await Editor.Message.send("scene","set-transform-snap-configs",t,n),this.refreshConfiguration()}},exports.close=close,exports.default=module.exports;