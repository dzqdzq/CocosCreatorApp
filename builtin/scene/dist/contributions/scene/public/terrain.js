"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.changePaint=exports.changeSculpt=exports.changeSculptMode=exports.changeInfo=exports.removeLayer=exports.changeLayer=exports.setLayer=exports.setPaintBrush=exports.setSculptBrush=exports.createLayer=exports.changeMode=exports.getLayers=exports.close=exports.save=exports.select=exports.init=exports.off=exports.on=exports.layerDatas=exports.currentLayer=exports.paint=exports.paint_brush=exports.sculpt_brush=exports.sculpt=exports.info=exports.component=exports.uuid=exports.mode=exports.ToolMode=void 0;const DefaultLayerUuid="52ef29ed-bd92-4e94-ab2f-0ebc91bf3a60@6c48a",events_1=require("events");var ToolMode;!function(e){e[e.SELECT=0]="SELECT",e[e.SCULPTUP=1]="SCULPTUP",e[e.SCULPTDOWN=2]="SCULPTDOWN",e[e.SMOOTH=3]="SMOOTH",e[e.PAINT=4]="PAINT"}(ToolMode=exports.ToolMode||(exports.ToolMode={})),exports.mode=ToolMode.SELECT,exports.uuid="",exports.component=null,exports.info=null,exports.sculpt=null,exports.sculpt_brush=null,exports.paint_brush=null,exports.paint=null,exports.currentLayer=-1;let isSculptChange=!1,isPaintChange=!1,$scene=null;const eventEmitter=new events_1.EventEmitter;function on(e,t){eventEmitter.on(e,t)}function off(e,t){eventEmitter.removeListener(e,t)}async function init(e){$scene=e}function generateMethodParams(e,t,o){return{uuid:e,name:t,args:o}}async function select(e){e&&exports.uuid;if(e&&(exports.uuid=e),!exports.uuid)return;exports.component=await $scene.callSceneMethod("queryComponent",[exports.uuid]),eventEmitter.emit("component-changed",exports.component),exports.layerDatas=await getLayers(),eventEmitter.emit("apply-layers",exports.layerDatas),exports.info=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.queryTerrainInfo")]),eventEmitter.emit("info-changed",exports.info),exports.sculpt=await Editor.Profile.getConfig("scene",`${exports.uuid}.sculpt`),isSculptChange=!1,exports.sculpt?await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setBrushOfMode",[1,exports.sculpt])]):exports.sculpt=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.queryBrushOfMode",[1])]),eventEmitter.emit("sculpt-changed",exports.sculpt),isSculptChange=!0,exports.paint=await Editor.Profile.getConfig("scene",`${exports.uuid}.paint`),isPaintChange=!1,exports.paint?await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setBrushOfMode",[2,exports.paint])]):exports.paint=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.queryBrushOfMode",[2])]),eventEmitter.emit("paint-changed",exports.paint),isPaintChange=!0,exports.sculpt_brush=await Editor.Profile.getConfig("scene",`${exports.uuid}.sculpt_brush`),exports.sculpt_brush&&eventEmitter.emit("sculpt-brush-changed",exports.sculpt_brush),exports.paint_brush=await Editor.Profile.getConfig("scene",`${exports.uuid}.paint_brush`),exports.paint_brush&&eventEmitter.emit("paint-brush-changed",exports.paint_brush);const t=await Editor.Profile.getConfig("scene",`${exports.uuid}.layer`);t?eventEmitter.emit("layer_change",t):eventEmitter.emit("layer_change",0)}async function save(){exports.sculpt&&Editor.Profile.setConfig("scene",`${exports.uuid}.sculpt`,{radius:exports.sculpt.radius,strength:exports.sculpt.strength}),exports.paint&&Editor.Profile.setConfig("scene",`${exports.uuid}.paint`,{radius:exports.paint.radius,strength:exports.paint.strength,falloff:exports.paint.falloff})}async function close(){save()}async function getLayers(){return await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.getLayers",[])])}function changeMode(e){switch(e){case ToolMode.SELECT:case ToolMode.SCULPTUP:$scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setCurrentEditMode",[e,!1,!1])]);break;case ToolMode.SCULPTDOWN:$scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setCurrentEditMode",[e-1,!0,!1])]);break;case ToolMode.SMOOTH:$scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setCurrentEditMode",[e-2,!1,!0])]);break;case ToolMode.PAINT:$scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setCurrentEditMode",[e-2,!1,!1])])}exports.mode=e,eventEmitter.emit("mode-changed",exports.mode)}async function createLayer(e){void 0===e&&(e=DefaultLayerUuid);const t=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.addLayerByUuid",[e])]);return exports.layerDatas=await getLayers(),eventEmitter.emit("apply-layers",exports.layerDatas),t}async function setSculptBrush(e){const t=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setSculptBrush",[e])]);return await Editor.Profile.setConfig("scene",`${exports.uuid}.sculpt_brush`,e),t}async function setPaintBrush(e){const t=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setPaintBrush",[e])]);return await Editor.Profile.setConfig("scene",`${exports.uuid}.paint_brush`,e),t}async function setLayer(e,t,o){const r=exports.layerDatas[e];if(-1===e)return;if(void 0===t&&(t=r?r.detailMap:DefaultLayerUuid),void 0===o){let e=1,t=.1,s=.1,n=null;r&&(e=r.tileSize,t=r.metallic,s=r.roughness,n=r.normalMap?r.normalMap:null),o={tileSize:e,metallic:t,roughness:s,normalMap:n}}const s=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setLayerValue",[e,t,o])]);return exports.layerDatas=await getLayers(),eventEmitter.emit("apply-layers",exports.layerDatas),s}async function changeLayer(e){if(e>=0&&e!==exports.currentLayer){return exports.currentLayer=e,Editor.Profile.setConfig("scene",`${exports.uuid}.layer`,e),await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setCurrentEditLayer",[e])])}}async function removeLayer(e){await Editor.Profile.getConfig("scene",`${exports.uuid}.layer`)===e&&Editor.Profile.removeConfig("scene",`${exports.uuid}.layer`);const t=await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.removeLayerByIndex",[e])]);return exports.layerDatas=await getLayers(),eventEmitter.emit("apply-layers",exports.layerDatas),t}async function changeInfo(e){let t=exports.info;for(let o in e)t.hasOwnProperty(o)&&(t[o]=e[o]);return await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.changeTerrainInfo",[exports.info])])}async function changeSculptMode(e){changeMode(e)}async function changeSculpt(e,t){if(!exports.sculpt||!isSculptChange)return;let o=exports.sculpt;const r=e.split("."),s=r.pop();return s?(r.length&&r.forEach(e=>{o&&(o=o[e])}),o[s]=t,save(),await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setBrushOfMode",[1,exports.sculpt])])):void 0}async function changePaint(e,t){if(!exports.paint||!isPaintChange)return;let o=exports.paint;const r=e.split("."),s=r.pop();return s?(r.length&&r.forEach(e=>{o&&(o=o[e])}),o[s]=t,save(),await $scene.callSceneMethod("executeComponentMethod",[generateMethodParams(exports.uuid,"gizmo.setBrushOfMode",[2,exports.paint])])):void 0}exports.on=on,exports.off=off,exports.init=init,exports.select=select,exports.save=save,exports.close=close,exports.getLayers=getLayers,exports.changeMode=changeMode,exports.createLayer=createLayer,exports.setSculptBrush=setSculptBrush,exports.setPaintBrush=setPaintBrush,exports.setLayer=setLayer,exports.changeLayer=changeLayer,exports.removeLayer=removeLayer,exports.changeInfo=changeInfo,exports.changeSculptMode=changeSculptMode,exports.changeSculpt=changeSculpt,exports.changePaint=changePaint,exports.default=module.exports;