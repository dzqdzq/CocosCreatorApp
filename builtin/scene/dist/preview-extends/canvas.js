"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const electron_base_ipc_1=require("@base/electron-base-ipc");class GlPreview{constructor(t,e){this.gl=null,this.canvas=null,this.initialized=!1,this._registerName=t,this._name=e,this._lastData=null}async init(t){t||(t={width:100,height:100}),(0,electron_base_ipc_1.sendToChannel)(this._registerName,this._name,{index:t.index,width:t.width,height:t.height}),this.initialized=!0}queryPreviewData(t){return t||(t={width:100,height:100}),new Promise((e,a)=>{(0,electron_base_ipc_1.sendToChannel)(this._registerName,this._name,{index:t.index,width:t.width,height:t.height}).option({original:!0}).callback((t,a)=>{t?(console.warn("queryPreviewData Failed",this._name,t),e(null)):e(a)})})}resizeGL(t,e){var a;if(t=Math.floor(t),e=Math.floor(e),this.canvas){let i=!1;this.canvas.width!==t&&(this.canvas.width=t,i=!0),this.canvas.height!==e&&(this.canvas.height=e,i=!0),i&&null!==this._lastData&&(null===(a=this.gl)||void 0===a||a.putImageData(this._lastData,0,0))}}drawGL(t,e,a){var i;e=Math.floor(e),a=Math.floor(a),this.canvas&&(this._lastData=new ImageData(new Uint8ClampedArray(t.buffer),e,a),null===(i=this.gl)||void 0===i||i.putImageData(this._lastData,0,0))}initGL(t,e={}){t&&(t.style.transform="scale(1, -1)",this.canvas=t,this.gl=t.getContext("2d"))}destroyGL(){}setScale(t){this.canvas&&(this.canvas.style.transform=`scale(${t}, ${-t})`)}}exports.default=GlPreview;