"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScenePanelManager=void 0;const panel_constant_1=require("./panel-constant"),ipc_1=require("./native/ipc");class PanelManager{constructor(){this._previewPanel=null,this.onSceneMessage={"scene:ready":()=>{var e;this._scenePanel.onSceneReady(),null===(e=this._previewPanel)||void 0===e||e.onSceneReady()}}}get scene(){return this._scenePanel}set scene(e){e.nativeWindowPanel?(this._scenePanel=e.nativeWindowPanel,ipc_1.PanelIpc.setEngineView(e.$.scene)):console.error("PanelManager register failed:without nativeWindowPanel")}get preview(){return this._previewPanel}set preview(e){e.nativeWindowPanel?this._previewPanel=e.nativeWindowPanel:console.error("PanelManager register failed:without nativeWindowPanel")}init(e){e&&(Editor.Message.__protected__.addBroadcastListener("scene:editor-preview-set-play",async(e,n)=>{var a;e===panel_constant_1.EditorPreviewState.Changing?(this._scenePanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),null===(a=this._previewPanel)||void 0===a||a.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel&&(this._previewPanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.enableInput(!1))):await this.onPreviewStop(n)}),ipc_1.PanelIpc.on("onBrowserToPanel",this.onBrowserToPanel.bind(this)),ipc_1.PanelIpc.on("onSceneToPanel",this.onSceneToPanel.bind(this)))}getPanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async switchNativeWindows(e){await ipc_1.PanelIpc.requestToBrowser("switchWindows",e)}resize(e,n){var a;null===(a=this.getNativePanel(e))||void 0===a||a.resize(n)}show(e){var n;null===(n=this.getNativePanel(e))||void 0===n||n.show()}hide(e){var n;null===(n=this.getNativePanel(e))||void 0===n||n.hide()}close(e){var n;null===(n=this.getNativePanel(e))||void 0===n||n.close()}getNativePanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async onBrowserToPanel(e){var n;const{panel:a,method:i,args:t,callback:r}=e;r(await(null===(n=this.getNativePanel(a))||void 0===n?void 0:n.onBrowserPanel(i,...t)))}async onSceneToPanel(e,...n){const a=this.onSceneMessage[e];a&&a.call(this,...n)}async onPreviewStop(e=!1){await this.switchNativeWindows(e),this._scenePanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._scenePanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal,this._previewPanel&&(this._previewPanel.enableInput(!0),this._previewPanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal)}}const ScenePanelManager=new PanelManager;exports.ScenePanelManager=ScenePanelManager;