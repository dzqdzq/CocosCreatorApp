"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScenePanelManager=void 0;const panel_constant_1=require("./panel-constant"),ipc_1=require("./native/ipc");class PanelManager{_scenePanel;_previewPanel=null;constructor(){}get scene(){return this._scenePanel}set scene(e){e.nativeWindowPanel?(this._scenePanel=e.nativeWindowPanel,ipc_1.PanelIpc.setEngineView(e.$.scene)):console.error("PanelManager register failed:without nativeWindowPanel")}get preview(){return this._previewPanel}set preview(e){e.nativeWindowPanel?this._previewPanel=e.nativeWindowPanel:console.error("PanelManager register failed:without nativeWindowPanel")}init(e){e&&(Editor.Message.__protected__.addBroadcastListener("scene:editor-preview-set-play",async(e,n)=>{e===panel_constant_1.EditorPreviewState.Changing?(this._scenePanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel?.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel&&(this._previewPanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.enableInput(!1))):await this.onPreviewStop(n)}),ipc_1.PanelIpc.on("onBrowserToPanel",this.onBrowserToPanel.bind(this)),ipc_1.PanelIpc.on("onSceneToPanel",this.onSceneToPanel.bind(this)))}getPanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async switchNativeWindows(e){await ipc_1.PanelIpc.requestToBrowser("switchWindows",e)}resize(e,n){this.getNativePanel(e)?.resize(n)}show(e){this.getNativePanel(e)?.show()}hide(e){this.getNativePanel(e)?.hide()}close(e){this.getNativePanel(e)?.close()}getNativePanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async onBrowserToPanel(e){var{panel:e,method:n,args:a,callback:i}=e;i(await this.getNativePanel(e)?.onBrowserPanel(n,...a))}async onSceneToPanel(e,...n){e=this.onSceneMessage[e];e&&e.call(this,...n)}onSceneMessage={"scene:ready":()=>{this._scenePanel.onSceneReady(),this._previewPanel?.onSceneReady()}};async onPreviewStop(e=!1){await this.switchNativeWindows(e),this._scenePanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._scenePanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal,this._previewPanel&&(this._previewPanel.enableInput(!0),this._previewPanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal)}}const ScenePanelManager=new PanelManager;exports.ScenePanelManager=ScenePanelManager;