"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.listeners=exports.fonts=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),message_1=require("./message"),scene_web_view_1=require("../engine-view/views/scene-web-view"),scene_native_view_1=require("../engine-view/views/scene-native-view"),device_adapter_1=require("../utils/device-adapter"),ipc=require("@base/electron-base-ipc");let panel=null;function attach(e){if(e.invalid)return;if(!e.info.contributions||!e.info.contributions.scene)return;const n=e.info.contributions.scene;try{if(n.custom){const t=Editor.Module.requireFile((0,path_1.join)(e.path,n.custom));t.floatWindows&&panel.$.scene.attachFloatWindow(e.name,t.floatWindows),t.toolbars&&panel.$.scene.attachToolbar(e.name,t.toolbars),t.infobars&&panel.$.scene.attachInfobar(e.name,t.infobars)}}catch(e){console.log(e)}}function detach(e){panel.$.scene.detachFloatWindow(e.name),panel.$.scene.detachToolbar(e.name),panel.$.scene.detachInfobar(e.name)}async function ready(){if(panel=this,!window.customElements.get("engine-view")){!1?window.customElements.define("engine-view",scene_native_view_1.NativeView):window.customElements.define("engine-view",scene_web_view_1.SceneView)}(0,message_1.init)(panel),await panel.$.scene.init(),Editor.Package.getPackages({enable:!0}).forEach(attach),Editor.Package.on("enable",attach),Editor.Package.on("disable",detach),await panel.$.scene.callSceneMethod("changeSceneViewVisible",[!panel.hidden]),document.addEventListener("click",()=>{Editor.Message.broadcast("scene:toolbar-menu-active","")})}async function beforeClose(){if(!panel.$.scene)return!0;const e=await panel.$.scene.callSceneMethod("beforeClose",[],!0,!1);return await Editor.Message.request("scene","save-scene-cache-to-file"),e}async function close(){Editor.Package.removeListener("enable",attach),Editor.Package.removeListener("disable",detach)}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../dist/index.css"),"utf8"),exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static","/template/index.html"),"utf8"),exports.$={loading:".loading",content:".content",scene:".scene",gizmos:".gizmos",uiTools:".ui-tools"},exports.fonts=[{name:"scene"}],exports.listeners={resize(){if(!panel)return;const e=JSON.parse(JSON.stringify(panel.$.scene.getBoundingClientRect()));e.width=panel.$.scene.clientWidth,e.height=panel.$.scene.clientHeight,ipc.send("editor-lib-windows:scene-resize",e),device_adapter_1.DeviceAdapter.reset(e.width,e.height),exports.methods["preview-play-change-style"]()},show(){panel.$.scene.callSceneMethod("changeSceneViewVisible",[!0])},hide(){panel.$.scene.callSceneMethod("changeSceneViewVisible",[!1])}},exports.methods=(0,message_1.apply)(),exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;