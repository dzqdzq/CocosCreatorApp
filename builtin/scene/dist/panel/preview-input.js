"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unregisterInput=exports.registerInput=void 0;const device_adapter_1=require("../script/utils/device-adapter");let leftButton=!1,middleButton=!1,rightButton=!1;const isWin32="win32"===process.platform,utils={createMouseEvent(e,t){const n=t.getBoundingClientRect(),o=isWin32?devicePixelRatio:1/devicePixelRatio,i={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,x:(e.pageX-n.x)*o,y:(e.pageY-n.y)*o,clientX:(e.clientX-n.x)*o,clientY:(e.clientY-n.y)*o,deltaX:e.deltaX||0,deltaY:e.deltaY||0,wheelDeltaX:e.wheelDeltaX||0,wheelDeltaY:e.wheelDeltaY||0,moveDeltaX:e.movementX||0,moveDeltaY:e.movementY||0,movementX:e.movementX,movementY:e.movementY,leftButton:leftButton,middleButton:middleButton,rightButton:rightButton,button:e.button,buttons:e.buttons};if(device_adapter_1.NativeAdapter.enable){const e=device_adapter_1.NativeAdapter.deltaX,n=device_adapter_1.NativeAdapter.deltaY;n>0?(i.y-=n,i.clientY-=n):(i.y+=t.scrollTop,i.clientY+=t.scrollTop),e>0?(i.x-=e,i.clientX-=e):(i.x+=t.scrollTop,i.clientX+=t.scrollLeft)}return i},createKeyboardEvent:e=>({ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,key:e.key,keyCode:e.keyCode,code:e.code}),createDragEvent(e,t){const{type:n,value:o,name:i,additional:s}=Editor.UI.DragArea.currentDragInfo||{},r=utils.createMouseEvent(e,t);r.name=i,r.type=n,r.value=o,r.values=[];let u=[];return Array.isArray(s)&&(r.values=s,u=r.values.map(e=>e.value)),o&&!u.includes(o)&&r.values.push({value:o,type:n,name:i}),r},createConfirmEvent:e=>({path:e.target.getAttribute("path"),value:e.target.value}),sendToScene(e,t){Editor.Message.send("scene","native-scene",!0,"handleInput",e,t)}};let previewPanel=null;function checkMouseButtonState(e,t){leftButton=0===e.button?t:leftButton,middleButton=1===e.button?t:middleButton,rightButton=2===e.button?t:rightButton}function registerInput(e){previewPanel=e,e.addEventListener("mousedown",t=>{function n(t){0===t.movementX&&0===t.movementY||utils.sendToScene("mouse-move",utils.createMouseEvent(t,e))}e.isPreviewing&&(document.body.style.pointerEvents="none",checkMouseButtonState(t,!0),utils.sendToScene("mouse-down",utils.createMouseEvent(t,e)),document.addEventListener("mouseup",function t(o){var i;device_adapter_1.NativeAdapter.enable&&(null===(i=e._preview)||void 0===i||i.focus()),document.body.style.pointerEvents="",utils.sendToScene("mouse-up",utils.createMouseEvent(o,e)),checkMouseButtonState(o,!1),document.removeEventListener("mouseup",t),document.removeEventListener("mousemove",n)}),document.addEventListener("mousemove",n))}),e.addEventListener("mousemove",t=>{e.isPreviewing&&(0===t.movementX&&0===t.movementY||utils.sendToScene("mouse-move",utils.createMouseEvent(t,e)))}),e.addEventListener("wheel",t=>{e.isPreviewing&&utils.sendToScene("mouse-wheel",utils.createMouseEvent(t,e))}),e.addEventListener("keydown",t=>{e.isPreviewing&&utils.sendToScene("keydown",utils.createKeyboardEvent(t))}),e.addEventListener("keyup",t=>{e.isPreviewing&&utils.sendToScene("keyup",utils.createKeyboardEvent(t))})}function unregisterInput(e){e.removeEventListener("mousedown"),e.removeEventListener("mousemove"),e.removeEventListener("wheel"),e.removeEventListener("keydown"),e.removeEventListener("keyup")}exports.registerInput=registerInput,exports.unregisterInput=unregisterInput;