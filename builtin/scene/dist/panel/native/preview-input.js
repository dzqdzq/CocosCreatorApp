"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unregisterInput=exports.registerInput=exports.enableInput=void 0;const device_adapter_1=require("../../script/utils/device-adapter"),ipc_1=require("./ipc");let leftButton=!1,middleButton=!1,rightButton=!1;const isWin32="win32"===process.platform;let previewElement=null,previewPanel=null;const utils={createMouseEvent(e,t){const n=t.getBoundingClientRect(),o=isWin32?devicePixelRatio:1/devicePixelRatio,u={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,x:(e.pageX-n.x)*o,y:(e.pageY-n.y)*o,clientX:(e.clientX-n.x)*o,clientY:(e.clientY-n.y)*o,deltaX:e.deltaX||0,deltaY:e.deltaY||0,wheelDeltaX:e.wheelDeltaX||0,wheelDeltaY:e.wheelDeltaY||0,moveDeltaX:e.movementX||0,moveDeltaY:e.movementY||0,movementX:e.movementX,movementY:e.movementY,leftButton:leftButton,middleButton:middleButton,rightButton:rightButton,button:e.button,buttons:e.buttons};if(device_adapter_1.NativeAdapter.enable){const e=device_adapter_1.NativeAdapter.offsetX,n=device_adapter_1.NativeAdapter.offsetY;n>0?(u.y-=n,u.clientY-=n):(u.y+=t.scrollTop,u.clientY+=t.scrollTop),e>0?(u.x-=e,u.clientX-=e):(u.x+=t.scrollTop,u.clientX+=t.scrollLeft)}return u},createKeyboardEvent:e=>({ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,key:e.key,keyCode:e.keyCode,code:e.code}),createDragEvent(e,t){const{type:n,value:o,name:u,additional:i}=Editor.UI.__protected__.DragArea.currentDragInfo||{},r=utils.createMouseEvent(e,t);r.name=u,r.type=n,r.value=o,r.values=[];let l=[];return Array.isArray(i)&&(r.values=i,l=r.values.map(e=>e.value)),o&&!l.includes(o)&&r.values.push({value:o,type:n,name:u}),r},createConfirmEvent:e=>({path:e.target.getAttribute("path"),value:e.target.value}),sendToScene(e,t){previewPanel&&ipc_1.PanelIpc.sendToScene("handleInput",e,t)}};function checkMouseButtonState(e,t){leftButton=0===e.button?t:leftButton,middleButton=1===e.button?t:middleButton,rightButton=2===e.button?t:rightButton}let inputEnabled=!1;function enableInput(e){inputEnabled=e}function registerInput(e,t){previewElement=e,previewPanel=t,e.addEventListener("mousedown",t=>{function n(t){0===t.movementX&&0===t.movementY||utils.sendToScene("mouse-move",utils.createMouseEvent(t,e))}inputEnabled&&(document.body.style.pointerEvents="none",checkMouseButtonState(t,!0),utils.sendToScene("mouse-down",utils.createMouseEvent(t,e)),document.addEventListener("mouseup",function t(o){var u;device_adapter_1.NativeAdapter.enable&&(null===(u=e._preview)||void 0===u||u.focus()),document.body.style.pointerEvents="",utils.sendToScene("mouse-up",utils.createMouseEvent(o,e)),checkMouseButtonState(o,!1),document.removeEventListener("mouseup",t),document.removeEventListener("mousemove",n)}),document.addEventListener("mousemove",n))}),e.addEventListener("mousemove",t=>{inputEnabled&&(0===t.movementX&&0===t.movementY||utils.sendToScene("mouse-move",utils.createMouseEvent(t,e)))}),e.addEventListener("wheel",t=>{inputEnabled&&utils.sendToScene("mouse-wheel",utils.createMouseEvent(t,e))}),e.addEventListener("keydown",e=>{inputEnabled&&utils.sendToScene("keydown",utils.createKeyboardEvent(e))}),e.addEventListener("keyup",e=>{inputEnabled&&utils.sendToScene("keyup",utils.createKeyboardEvent(e))})}function unregisterInput(e){e.removeEventListener("mousedown"),e.removeEventListener("mousemove"),e.removeEventListener("wheel"),e.removeEventListener("keydown"),e.removeEventListener("keyup")}exports.enableInput=enableInput,exports.registerInput=registerInput,exports.unregisterInput=unregisterInput;