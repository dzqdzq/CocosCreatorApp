"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NativeManager=void 0;const native_window_browser_1=require("./window/native-window-browser"),electron_1=require("electron"),ipc_1=require("./ipc"),panel_constant_1=require("../../panel/panel-constant");class NativeManager{constructor(){this._mainWindow={},this._panelToWindow={},this._sceneReady=!1,this._previewReady=!1,this._isPreview=!1,this.initEvent()}onEngineReady(n){n?this._previewReady=!0:this._sceneReady=!0,this.forEachWindow(e=>{e.initWindows(n)})}onEngineClose(n){n?this._previewReady=!1:this._sceneReady=!1,this.forEachWindow(e=>{e.releaseWindows(n)})}onPanelReady(n,e,i){if(!this._mainWindow[n]){const e=electron_1.BrowserWindow.fromId(n);if(e){const i=new native_window_browser_1.NativeWindowBrowser(e);this._mainWindow[n]=i}}const s=this._mainWindow[n];s.onPanelReady(e,i),this._panelToWindow[e]=s,this._sceneReady&&s.initWindows(),this._previewReady&&s.initWindows(!0)}async onPanelResize(n,e,i){const s=this._mainWindow[n];s&&await s.onPanelResize(e,i)}onPanelBeforeClose(n,e){const i=this._mainWindow[n];i&&i.onPanelClose(e),e===panel_constant_1.PanelName.Scene&&(this._previewReady=!1,this._sceneReady=!1)}onPanelClose(n,e){const i=this._mainWindow[n];i&&i.onPanelClose(e),e===panel_constant_1.PanelName.Scene&&(this._previewReady=!1,this._sceneReady=!1)}async onPanelShow(n,e){const i=this._mainWindow[n];i&&await i.onPanelShow(e)}async onPanelHide(n,e){const i=this._mainWindow[n];i&&await i.onPanelHide(e)}async forEachWindow(n){const e=Object.values(this._mainWindow);for(let i=0;i<e.length;i++){const s=e[i];await n(s)}}initEvent(){ipc_1.b2sIpc.bind(),ipc_1.b2sIpc.on("onEngineReady",this.onEngineReady.bind(this)),ipc_1.b2sIpc.on("onEngineClose",this.onEngineClose.bind(this))}onSceneReady(){const n=this._panelToWindow[panel_constant_1.PanelName.Preview];n&&n.showCameraOnPreviewPanel(),this.forEachWindow(n=>{n.setPanelBackgroundVisible(!1)})}async switchWindows(n){this._isPreview=n;const e=Object.values(this._mainWindow);for(let i=0;i<e.length;i++){const s=e[i];await s.switchWindows(n)}}}const instance=new NativeManager;exports.NativeManager=instance;