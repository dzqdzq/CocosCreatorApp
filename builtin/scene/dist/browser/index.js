"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&("get"in r?n.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){e[a=void 0===a?t:a]=n[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),__importStar=this&&this.__importStar||function(){var r=function(e){return(r=Object.getOwnPropertyNames||function(e){var n,t=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=r(e),a=0;a<t.length;a++)"default"!==t[a]&&__createBinding(n,e,t[a]);return __setModuleDefault(n,e),n}}(),__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=void 0,exports.load=load,exports.unload=unload;const multi_scene_1=require("./multi-scene"),ElectronModule=require("@base/electron-module"),path_1=require("path"),scene_cache_1=require("./scene-cache"),env_1=__importDefault(require("../script/utils/env"));let nativeManager;const electron=require("electron");async function load(){await env_1.default.useNativeScene()&&(nativeManager=require("./native/index").NativeManager);const t={import:require("./protocol/import"),"project-temp":require("./protocol/project-temp")};ElectronModule.register("PreviewExtends",(0,path_1.join)(__dirname,"../preview-extends/index")),Object.keys(t).forEach(e=>{var n=t[e];require("electron").protocol[n.type](e,n.handler)});try{await scene_cache_1.sceneCacheManager.init()}catch(e){console.error(e)}(await Promise.resolve().then(()=>__importStar(require("@base/electron-base-ipc")))).on("scene:check-ipc",e=>!0),(0,multi_scene_1.addMultiSceneListener)()}async function unload(){await scene_cache_1.sceneCacheManager.save()}electron.ipcMain.on("fire-web-contents",e=>{e.sender.on("new-window",(e,n,t,a,r,c)=>{e.preventDefault(),Object.assign(r,{autoHideMenuBar:!0});r=new electron.BrowserWindow(r);e.newGuest=r})}),exports.methods={open(){Editor.Panel.open("scene")},async queryLatestCache(e){try{return await scene_cache_1.sceneCacheManager.queryLatestCache(e)}catch(e){console.error(e)}},async clearSceneCache(e){try{return await scene_cache_1.sceneCacheManager.clearSceneCache(e)}catch(e){console.error(e)}},async saveSceneCacheToFile(){try{return await scene_cache_1.sceneCacheManager.save()}catch(e){console.error(e)}},updateCacheConfig(){scene_cache_1.sceneCacheManager.updateConfig()},onSceneReady(e){scene_cache_1.sceneCacheManager.onSceneReady(e),nativeManager?.onSceneReady()},onSceneClosed(){scene_cache_1.sceneCacheManager.onSceneClosed()},async panelToBrowser(e,...n){if(nativeManager[e])return await nativeManager[e].call(nativeManager,...n);console.warn("nativeManager does not has "+e)}};