"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const ElectronModule=require("@base/electron-module"),path_1=require("path"),scene_cache_1=require("./scene-cache"),env_1=__importDefault(require("../script/utils/env"));let Nativize=null;const electron=require("electron");async function load(){await env_1.default.useNativeScene()&&(Nativize=require((0,path_1.join)(Editor.App.path,"nativize/dist")).Nativize);const e={import:require("./protocol/import"),"project-temp":require("./protocol/project-temp")};ElectronModule.register("PreviewExtends",(0,path_1.join)(__dirname,"../preview-extends/index")),Object.keys(e).forEach(t=>{const n=e[t];require("electron").protocol[n.type](t,n.handler)});try{await scene_cache_1.sceneCacheManager.init()}catch(e){console.error(e)}(await Promise.resolve().then(()=>__importStar(require("@base/electron-base-ipc")))).on("scene:check-ipc",e=>!0)}async function unload(){await scene_cache_1.sceneCacheManager.save()}electron.ipcMain.on("fire-web-contents",e=>{e.sender.on("new-window",(e,t,n,a,r,c)=>{e.preventDefault(),Object.assign(r,{autoHideMenuBar:!0});const i=new electron.BrowserWindow(r);e.newGuest=i})}),exports.methods={open(){Editor.Panel.open("scene")},async queryLatestCache(e){try{return await scene_cache_1.sceneCacheManager.queryLatestCache(e)}catch(e){console.error(e)}},async clearSceneCache(e){try{return await scene_cache_1.sceneCacheManager.clearSceneCache(e)}catch(e){console.error(e)}},async saveSceneCacheToFile(){try{return await scene_cache_1.sceneCacheManager.save()}catch(e){console.error(e)}},updateCacheConfig(){scene_cache_1.sceneCacheManager.updateConfig()},onSceneReady(e){scene_cache_1.sceneCacheManager.onSceneReady(e)},onSceneClosed(){scene_cache_1.sceneCacheManager.onSceneClosed()},async createNativeWindow(e,t,n,a=!1){if(Nativize)return await Nativize.createWindow(e,t,n,a)},async resizeNativeWindow(e,t){Nativize&&Nativize.resizeWindow(t,e)},onPreviewPanelReady(){if(Nativize)return Nativize.onPreviewPanelReady()},onPreviewPanelStop(){},async setPreviewWindowVisible(e){await Nativize.switchWindows(e)}},exports.load=load,exports.unload=unload;