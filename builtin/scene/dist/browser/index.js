"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const ElectronModule=require("@base/electron-module"),path_1=require("path"),scene_cache_1=require("./scene-cache"),env_1=__importDefault(require("../script/utils/env"));let Nativize=null;const electron=require("electron");async function load(){await env_1.default.useNativeScene()&&(Nativize=require((0,path_1.join)(Editor.App.path,"nativize/dist")).Nativize);const e={import:require("./protocol/import"),"project-temp":require("./protocol/project-temp")};ElectronModule.register("PreviewExtends",(0,path_1.join)(__dirname,"../preview-extends/index")),Object.keys(e).forEach(a=>{const n=e[a];require("electron").protocol[n.type](a,n.handler)});try{await scene_cache_1.sceneCacheManager.init()}catch(e){console.error(e)}require("@base/electron-base-ipc").on("scene:check-ipc",e=>!0)}async function unload(){await scene_cache_1.sceneCacheManager.save()}electron.ipcMain.on("fire-web-contents",e=>{e.sender.on("new-window",(e,a,n,c,t,r)=>{e.preventDefault(),Object.assign(t,{autoHideMenuBar:!0});const o=new electron.BrowserWindow(t);e.newGuest=o})}),exports.methods={open(){Editor.Panel.open("scene")},async queryLatestCache(e){try{return await scene_cache_1.sceneCacheManager.queryLatestCache(e)}catch(e){console.error(e)}},async clearSceneCache(e){try{return await scene_cache_1.sceneCacheManager.clearSceneCache(e)}catch(e){console.error(e)}},async saveSceneCacheToFile(){try{return await scene_cache_1.sceneCacheManager.save()}catch(e){console.error(e)}},updateCacheConfig(){scene_cache_1.sceneCacheManager.updateConfig()},onSceneReady(e){scene_cache_1.sceneCacheManager.onSceneReady(e)},onSceneClosed(){scene_cache_1.sceneCacheManager.onSceneClosed()},async createNativeWindow(e,a,n,c=!1){if(Nativize)return await Nativize.createWindow(e,a,n,c)},async resizeNativeWindow(e,a){Nativize&&Nativize.resizeWindow(a,e)},onPreviewPanelReady(){if(Nativize)return Nativize.onPreviewPanelReady()},async setPreviewWindowVisible(e){await Nativize.switchWindows(e)}},exports.load=load,exports.unload=unload;