"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const BroadcaseMap={editor:{},project:{}};async function load(){Editor.Package.getPackages().forEach(exports.methods.attach),Editor.Package.on("register",exports.methods.attach),Editor.Profile.on("change",exports.methods.profileChanged),Editor.Profile.on("save",exports.methods.profileSaved)}function unload(){Editor.Package.removeListener("register",exports.methods.attach),Editor.Profile.removeListener("change",exports.methods.profileChanged),Editor.Profile.removeListener("save",exports.methods.profileSaved)}exports.methods={attach(e){if(!e.invalid)try{if(e.name,e.info,!e.info.contributions||!e.info.contributions.profile)return;const o=e.info.contributions.profile;if(o.editor)for(let a in o.editor){const r=o.editor[a];if(Editor.Profile.setConfig(e.name,a,r.default,"default"),r.message){(BroadcaseMap.editor[`packages/${e.name}.json`]=BroadcaseMap.editor[`packages/${e.name}.json`]||{})[a]=[e.name,r.message]}}if(o.project)for(let a in o.project){const r=o.project[a];if(Editor.Profile.setProject(e.name,a,r.default,"default"),r.message&&r.message){(BroadcaseMap.project[`packages/${e.name}.json`]=BroadcaseMap.project[`packages/${e.name}.json`]||{})[a]=[e.name,r.message]}}}catch(o){console.error(Editor.I18n.t("preferences.warn_info.register_failed")+": "+e.name),console.error(o)}},profileChanged(e,o,a,r){"local"===e||"global"===e?BroadcaseMap.editor[o]&&BroadcaseMap.editor[o][a]&&Editor.Message.send(...BroadcaseMap.editor[o][a],a,r):"project"===e&&BroadcaseMap.project[o]&&BroadcaseMap.project[o][a]&&Editor.Message.send(...BroadcaseMap.project[o][a],a,r)},profileSaved(e){}},exports.load=load,exports.unload=unload;