"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const BroadcaseMap={editor:{},project:{}};async function load(){Editor.Package.getPackages().forEach(exports.methods.attach),Editor.Package.__protected__.on("register",exports.methods.attach),Editor.Profile.__protected__.on("change",exports.methods.profileChanged),Editor.Profile.__protected__.on("save",exports.methods.profileSaved)}function unload(){Editor.Package.__protected__.removeListener("register",exports.methods.attach),Editor.Profile.__protected__.removeListener("change",exports.methods.profileChanged),Editor.Profile.__protected__.removeListener("save",exports.methods.profileSaved)}exports.methods={attach(e){if(!e.invalid)try{if(e.name,e.info,!e.info.contributions||!e.info.contributions.profile)return;const o=e.info.contributions.profile;if(o.editor)for(const a in o.editor){const t=o.editor[a];if(Editor.Profile.setConfig(e.name,a,t.default,"default"),t.message){(BroadcaseMap.editor[`packages/${e.name}.json`]=BroadcaseMap.editor[`packages/${e.name}.json`]||{})[a]=[e.name,t.message]}}if(o.project)for(const a in o.project){const t=o.project[a];if(Editor.Profile.setProject(e.name,a,t.default,"default"),t.message&&t.message){(BroadcaseMap.project[`packages/${e.name}.json`]=BroadcaseMap.project[`packages/${e.name}.json`]||{})[a]=[e.name,t.message]}}}catch(o){console.error(Editor.I18n.t("preferences.warn_info.register_failed")+": "+e.name),console.error(o)}},profileChanged(e,o,a,t){if("local"===e||"global"===e){if(BroadcaseMap.editor[o]&&BroadcaseMap.editor[o][a])try{const[e,r]=BroadcaseMap.editor[o][a],s=Editor.Package.getPackages({name:e,enable:!0});s&&s.length?Editor.Message.send(e,r,a,t):console.log(`Profile changed: ${e} (${a}: ${t})`)}catch(e){console.warn(e)}}else if("project"===e&&BroadcaseMap.project[o]&&BroadcaseMap.project[o][a])try{const[e,r]=BroadcaseMap.project[o][a],s=Editor.Package.getPackages({name:e,enable:!0});s&&s.length?Editor.Message.send(e,r,a,t):console.log(`Profile changed: ${e} (${a}: ${t})`)}catch(e){console.warn(e)}},profileSaved(e){}},exports.load=load,exports.unload=unload;