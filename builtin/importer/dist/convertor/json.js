"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))(function(i,a){function n(t){try{c(s.next(t))}catch(t){a(t)}}function o(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(n,o)}c((s=s.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.JSONImporter=void 0;const base_1=require("../common/base");class JSONImporter extends base_1.ImporterBase{constructor(){super(...arguments),this.type="base"}import(){return __awaiter(this,void 0,void 0,function*(){return(yield this.validateSpine())?(this._3dMeta.ver="1.2.3",this._3dMeta.importer="spine-data"):this.validateDragonBones()?(this._3dMeta.ver="1.0.0",this._3dMeta.importer="dragonbones"):this.validateDragonBonesAtlasAsset()?(this._3dMeta.ver="1.0.0",this._3dMeta.importer="dragonbones-atlas"):(this._3dMeta.ver="1.0.0",this._3dMeta.importer="json"),!0})}validateDragonBonesAtlasAsset(){return __awaiter(this,void 0,void 0,function*(){let t;const e=this.readFileSync(this.sourceFsPath);try{e&&(t=JSON.parse(e))}catch(t){return!1}return"string"==typeof t.imagePath&&Array.isArray(t.SubTexture)})}validateDragonBones(){return __awaiter(this,void 0,void 0,function*(){let t;if(this.sourceFsPath.endsWith(".json")){const e=this.readFileSync(this.sourceFsPath);try{e&&(t=JSON.parse(e))}catch(t){return!1}}else{const e=this.readFileSync(this.sourceFsPath);try{t=dragonBones.BinaryDataParser.getInstance().parseDragonBonesData(e.buffer)}catch(t){return!1}}return Array.isArray(t.armature)||!!t.armatures})}validateSpine(){return __awaiter(this,void 0,void 0,function*(){if(this.sourceFsPath.endsWith(".skel"))return!0;let t;const e=this.readFileSync(this.sourceFsPath);if(e){const r=e.slice(0,30);if(r.indexOf("slots")>0||r.indexOf("skins")>0||r.indexOf("events")>0||r.indexOf("animations")>0||r.indexOf("bones")>0||r.indexOf("skeleton")>0||r.indexOf('"ik"')>0){try{t=JSON.parse(e)}catch(t){return!1}return Array.isArray(t.bones)}}return!1})}}exports.JSONImporter=JSONImporter;