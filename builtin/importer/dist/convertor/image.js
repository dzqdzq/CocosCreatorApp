"use strict";var __awaiter=this&&this.__awaiter||function(e,t,a,s){return new(a||(a=Promise))(function(i,r){function u(e){try{n(s.next(e))}catch(e){r(e)}}function o(e){try{n(s.throw(e))}catch(e){r(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(u,o)}n((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageImporter=void 0;const base_1=require("../common/base"),utlis_1=require("../common/utlis");class ImageImporter extends base_1.ImporterBase{constructor(){super(...arguments),this.type="image"}import(){return __awaiter(this,void 0,void 0,function*(){if(!this._2dMeta)return!0;this._3dMeta.ver="1.0.13",this._3dMeta.importer="image";const e=this._3dMeta.userData;if("sprite"===this._2dMeta.type){e.type="sprite-frame";const t=this.createNewMeta();t.importer="texture";const a=base_1.ImporterBase.getNameByID("texture"),s=this._2dMeta.filterMode;t.userData.minfilter="point"===s?"nearest":"linear",t.userData.magfilter="point"===s?"nearest":"linear";const i=this._2dMeta.wrapMode;t.userData.wrapModeS=t.userData.wrapModeT="clamp"===i?"clamp-to-edge":i;let r="none";this._2dMeta.genMipmaps&&(r="bilinear"===s||"point"===s?"nearest":"linear"),t.userData.mipfilter=r,this._3dMeta.subMetas[a]=t;const u=this.createNewMeta(),o=this._2dMeta.subMetas[this.pathInfo.name];for(const e in o)"ver"!==e&&"uuid"!==e&&"subMetas"!==e&&"rawTextureUuid"!==e&&(u.userData[e]=o[e]);u.importer="sprite-frame",u.userData.imageUuidOrDatabaseUri=`${this._3dMeta.uuid}@${a}`;const n=base_1.ImporterBase.getNameByID("spriteFrame");this._3dMeta.subMetas[n]=u}else e.type="raw";const t=yield this.migratePlatformSettings(this._2dMeta.platformSettings);if(t&&(e.compressSettings=t),this._3dMeta.userData=e,"sprite"===this._2dMeta.type)for(const e in this._2dMeta.subMetas){const t=this._2dMeta.subMetas[e];t&&utlis_1.importSubAssets.set(t.uuid,{baseUuid:this._2dMeta.uuid,uuid:`${this._2dMeta.uuid}@${base_1.ImporterBase.getNameByID("spriteFrame")}`})}else"raw"===this._2dMeta.type&&utlis_1.importSubAssets.set(this._2dMeta.uuid,{baseUuid:this._2dMeta.uuid,uuid:`${this._2dMeta.uuid}@${base_1.ImporterBase.getNameByID("texture")}`});return!0})}}exports.ImageImporter=ImageImporter;