"use strict";var __awaiter=this&&this.__awaiter||function(e,r,i,t){return new(i||(i=Promise))(function(o,c){function l(e){try{a(t.next(e))}catch(e){c(e)}}function n(e){try{a(t.throw(e))}catch(e){c(e)}}function a(e){var r;e.done?o(e.value):(r=e.value,r instanceof i?r:new i(function(e){e(r)})).then(l,n)}a((t=t.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MigrateManager=void 0;const Animation_1=require("./Animation"),AnimationClip_1=require("./AnimationClip"),Asset_1=require("./Asset"),AudioClip_1=require("./AudioClip"),AudioSource_1=require("./AudioSource"),ArmatureDisplay_1=require("./ArmatureDisplay"),BaseNode_1=require("./BaseNode"),Billboard_1=require("./Billboard"),BitmapFont_1=require("./BitmapFont"),BlockInputEvents_1=require("./BlockInputEvents"),BoxCollider_1=require("./BoxCollider"),BoxCollider2D_1=require("./BoxCollider2D"),BufferAsset_1=require("./BufferAsset"),Button_1=require("./Button"),Camera_1=require("./Camera"),Canvas_1=require("./Canvas"),CapsuleCollider_1=require("./CapsuleCollider"),CircleCollider2D_1=require("./CircleCollider2D"),Collider_1=require("./Collider"),Collider2D_1=require("./Collider2D"),CompPrefabInfo_1=require("./CompPrefabInfo"),CompactValueTypeArray_1=require("./CompactValueTypeArray"),Component_1=require("./Component"),ComponentModifier_1=require("./ComponentModifier"),ConeCollider_1=require("./ConeCollider"),ConstantForce_1=require("./ConstantForce"),Constraint_1=require("./Constraint"),CubicSplineNumberValue_1=require("./CubicSplineNumberValue"),CubicSplineValueClass_1=require("./CubicSplineValueClass"),CurveRange_1=require("./CurveRange"),CurveValueAdapter_1=require("./CurveValueAdapter"),CylinderCollider_1=require("./CylinderCollider"),DirectionalLight_1=require("./DirectionalLight"),DistanceJoint2D_1=require("./DistanceJoint2D"),EditBox_1=require("./EditBox"),EffectAsset_1=require("./EffectAsset"),EventHandler_1=require("./EventHandler"),FixedJoint2D_1=require("./FixedJoint2D"),Font_1=require("./Font"),ForwardFlow_1=require("./ForwardFlow"),ForwardPipeline_1=require("./ForwardPipeline"),ForwardStage_1=require("./ForwardStage"),Graphics_1=require("./Graphics"),HierachyModifier_1=require("./HierachyModifier"),HingeConstraint_1=require("./HingeConstraint"),HingeJoint2D_1=require("./HingeJoint2D"),ImageAsset_1=require("./ImageAsset"),JavaScript_1=require("./JavaScript"),Joint2D_1=require("./Joint2D"),JsonAsset_1=require("./JsonAsset"),Label_1=require("./Label"),LabelAtlas_1=require("./LabelAtlas"),LabelOutline_1=require("./LabelOutline"),LabelShadow_1=require("./LabelShadow"),Layout_1=require("./Layout"),Light_1=require("./Light"),Line_1=require("./Line"),Mask_1=require("./Mask"),Material_1=require("./Material"),Mesh_1=require("./Mesh"),MeshCollider_1=require("./MeshCollider"),MeshRenderer_1=require("./MeshRenderer"),ModelLightmapSettings_1=require("./ModelLightmapSettings"),MissingScript_1=require("./MissingScript"),MotionStreak_1=require("./MotionStreak"),MouseJoint2D_1=require("./MouseJoint2D"),Node_1=require("./Node"),PageView_1=require("./PageView"),PageViewIndicator_1=require("./PageViewIndicator"),ParticleAsset_1=require("./ParticleAsset"),ParticleSystem_1=require("./ParticleSystem"),ParticleSystem2D_1=require("./ParticleSystem2D"),PhysicsMaterial_1=require("./PhysicsMaterial"),PlaneCollider_1=require("./PlaneCollider"),PointToPointConstraint_1=require("./PointToPointConstraint"),PolygonCollider2D_1=require("./PolygonCollider2D"),Prefab_1=require("./Prefab"),PrefabInfo_1=require("./PrefabInfo"),Primitive_1=require("./Primitive"),PrivateNode_1=require("./PrivateNode"),ProgressBar_1=require("./ProgressBar"),RawAsset_1=require("./RawAsset"),RelativeJoint2D_1=require("./RelativeJoint2D"),RenderFlow_1=require("./RenderFlow"),RenderPipeline_1=require("./RenderPipeline"),RenderStage_1=require("./RenderStage"),RenderTexture_1=require("./RenderTexture"),RenderableComponent_1=require("./RenderableComponent"),RichText_1=require("./RichText"),RigidBody_1=require("./RigidBody"),RigidBody2D_1=require("./RigidBody2D"),SafeArea_1=require("./SafeArea"),Scene_1=require("./Scene"),SceneAsset_1=require("./SceneAsset"),Script_1=require("./Script"),ScrollBar_1=require("./ScrollBar"),ScrollView_1=require("./ScrollView"),ShadowFlow_1=require("./ShadowFlow"),ShadowStage_1=require("./ShadowStage"),SimplexCollider_1=require("./SimplexCollider"),Skeleton_1=require("./Skeleton"),SkeletalAnimation_1=require("./SkeletalAnimation"),SkinnedMeshBatchRenderer_1=require("./SkinnedMeshBatchRenderer"),SkinnedMeshRenderer_1=require("./SkinnedMeshRenderer"),SkinnedMeshUnit_1=require("./SkinnedMeshUnit"),Slider_1=require("./Slider"),SliderJoint2D_1=require("./SliderJoint2D"),SphereCollider_1=require("./SphereCollider"),SphereLight_1=require("./SphereLight"),SpotLight_1=require("./SpotLight"),SpringJoint2D_1=require("./SpringJoint2D"),Sprite_1=require("./Sprite"),SpriteAtlas_1=require("./SpriteAtlas"),SpriteFrame_1=require("./SpriteFrame"),SubContextView_1=require("./SubContextView"),TTFFont_1=require("./TTFFont"),TextAsset_1=require("./TextAsset"),Texture2D_1=require("./Texture2D"),TextureCube_1=require("./TextureCube"),TiledLayer_1=require("./TiledLayer"),TiledMap_1=require("./TiledMap"),TiledMapAsset_1=require("./TiledMapAsset"),TiledObjectGroup_1=require("./TiledObjectGroup"),TiledTile_1=require("./TiledTile"),TiledUserNodeData_1=require("./TiledUserNodeData"),Toggle_1=require("./Toggle"),ToggleContainer_1=require("./ToggleContainer"),TypeScript_1=require("./TypeScript"),UIComponent_1=require("./UIComponent"),UICoordinateTracker_1=require("./UICoordinateTracker"),UIMeshRenderer_1=require("./UIMeshRenderer"),UIOpacity_1=require("./UIOpacity"),UIRenderable_1=require("./UIRenderable"),UIReorderComponent_1=require("./UIReorderComponent"),UIStaticBatch_1=require("./UIStaticBatch"),UITransform_1=require("./UITransform"),UniformCurveValueAdapter_1=require("./UniformCurveValueAdapter"),VideoClip_1=require("./VideoClip"),VideoPlayer_1=require("./VideoPlayer"),ViewGroup_1=require("./ViewGroup"),WebView_1=require("./WebView"),WheelJoint2D_1=require("./WheelJoint2D"),Widget_1=require("./Widget"),AnimationCurve_1=require("./AnimationCurve"),Keyframe_1=require("./Keyframe"),AlphaKey_1=require("./AlphaKey"),Gradient_1=require("./Gradient"),GradientRange_1=require("./GradientRange"),Burst_1=require("./Burst"),ShapeModule_1=require("./ShapeModule"),ColorOvertimeModule_1=require("./ColorOvertimeModule"),SizeOvertimeModule_1=require("./SizeOvertimeModule"),VelocityOvertimeModule_1=require("./VelocityOvertimeModule"),ForceOvertimeModule_1=require("./ForceOvertimeModule"),LimitVelocityOvertimeModule_1=require("./LimitVelocityOvertimeModule"),RotationOvertimeModule_1=require("./RotationOvertimeModule"),TextureAnimationModule_1=require("./TextureAnimationModule"),ColorKey_1=require("./ColorKey"),TrailModule_1=require("./TrailModule"),base_1=require("../common/base"),SpSkeleton_1=require("./SpSkeleton"),StudioComponent_1=require("./StudioComponent"),StudioWidget_1=require("./StudioWidget"),utlis_1=require("../common/utlis"),CCCLASS_LIST={"cc.Animation":Animation_1.Animation,"cc.AnimationClip":AnimationClip_1.AnimationClip,"cc.AnimationCurve":AnimationCurve_1.AnimationCurve,"cc.Asset":Asset_1.Asset,"cc.AlphaKey":AlphaKey_1.AlphaKey,"cc.AudioClip":AudioClip_1.AudioClip,"cc.AudioSource":AudioSource_1.AudioSource,"cc.Burst":Burst_1.Burst,"cc.Button":Button_1.Button,"cc.BaseNode":BaseNode_1.BaseNode,"cc.Billboard":Billboard_1.Billboard,"cc.BitmapFont":BitmapFont_1.BitmapFont,"cc.BoxCollider2D":BoxCollider2D_1.BoxCollider2D,"cc.BlockInputEvents":BlockInputEvents_1.BlockInputEvents,"cc.BufferAsset":BufferAsset_1.BufferAsset,"cc.BoxCollider":BoxCollider_1.BoxCollider,"cc.ColorKey":ColorKey_1.ColorKey,"cc.Camera":Camera_1.Camera,"cc.Canvas":Canvas_1.Canvas,"cc.CapsuleCollider":CapsuleCollider_1.CapsuleCollider,"cc.CircleCollider2D":CircleCollider2D_1.CircleCollider2D,"cc.Collider":Collider_1.Collider,"cc.Collider2D":Collider2D_1.Collider2D,"cc.CompPrefabInfo":CompPrefabInfo_1.CompPrefabInfo,"cc.CompactValueTypeArray":CompactValueTypeArray_1.CompactValueTypeArray,"cc.Component":Component_1.Component,"cc.ComponentModifier":ComponentModifier_1.ComponentModifier,"cc.ConeCollider":ConeCollider_1.ConeCollider,"cc.ConstantForce":ConstantForce_1.ConstantForce,"cc.Constraint":Constraint_1.Constraint,"cc.CubicSplineNumberValue":CubicSplineNumberValue_1.CubicSplineNumberValue,"cc.CubicSplineValueClass":CubicSplineValueClass_1.CubicSplineValueClass,"cc.CurveRange":CurveRange_1.CurveRange,"cc.CurveValueAdapter":CurveValueAdapter_1.CurveValueAdapter,"cc.CylinderCollider":CylinderCollider_1.CylinderCollider,"cc.ColorOvertimeModule":ColorOvertimeModule_1.ColorOvertimeModule,"cc.DirectionalLight":DirectionalLight_1.DirectionalLight,"cc.DistanceJoint2D":DistanceJoint2D_1.DistanceJoint2D,"cc.EditBox":EditBox_1.EditBox,"cc.EffectAsset":EffectAsset_1.EffectAsset,"cc.EventHandler":EventHandler_1.EventHandler,"cc.FixedJoint2D":FixedJoint2D_1.FixedJoint2D,"cc.Font":Font_1.Font,"cc.ForwardFlow":ForwardFlow_1.ForwardFlow,"cc.ForwardPipeline":ForwardPipeline_1.ForwardPipeline,"cc.ForwardStage":ForwardStage_1.ForwardStage,"cc.ForceOvertimeModule":ForceOvertimeModule_1.ForceOvertimeModule,"cc.Graphics":Graphics_1.Graphics,"cc.Gradient":Gradient_1.Gradient,"cc.GradientRange":GradientRange_1.GradientRange,"cc.HierachyModifier":HierachyModifier_1.HierachyModifier,"cc.HingeConstraint":HingeConstraint_1.HingeConstraint,"cc.HingeJoint2D":HingeJoint2D_1.HingeJoint2D,"cc.ImageAsset":ImageAsset_1.ImageAsset,"cc.JavaScript":JavaScript_1.JavaScript,"cc.Joint2D":Joint2D_1.Joint2D,"cc.JsonAsset":JsonAsset_1.JsonAsset,"cc.Keyframe":Keyframe_1.Keyframe,"cc.Label":Label_1.Label,"cc.LabelAtlas":LabelAtlas_1.LabelAtlas,"cc.LabelOutline":LabelOutline_1.LabelOutline,"cc.LabelShadow":LabelShadow_1.LabelShadow,"cc.Layout":Layout_1.Layout,"cc.Light":Light_1.Light,"cc.Line":Line_1.Line,"cc.LimitVelocityOvertimeModule":LimitVelocityOvertimeModule_1.LimitVelocityOvertimeModule,"cc.Mask":Mask_1.Mask,"cc.Material":Material_1.Material,"cc.Mesh":Mesh_1.Mesh,"cc.MeshCollider":MeshCollider_1.MeshCollider,"cc.MeshRenderer":MeshRenderer_1.MeshRenderer,"cc.ModelLightmapSettings":ModelLightmapSettings_1.ModelLightmapSettings,"cc.MissingScript":MissingScript_1.MissingScript,"cc.MotionStreak":MotionStreak_1.MotionStreak,"cc.MouseJoint2D":MouseJoint2D_1.MouseJoint2D,"cc.Node":Node_1.Node,"cc.PageView":PageView_1.PageView,"cc.PageViewIndicator":PageViewIndicator_1.PageViewIndicator,"cc.ParticleAsset":ParticleAsset_1.ParticleAsset,"cc.ParticleSystem":ParticleSystem_1.ParticleSystem,"cc.ParticleSystem2D":ParticleSystem2D_1.ParticleSystem2D,"cc.PhysicsMaterial":PhysicsMaterial_1.PhysicsMaterial,"cc.PlaneCollider":PlaneCollider_1.PlaneCollider,"cc.PointToPointConstraint":PointToPointConstraint_1.PointToPointConstraint,"cc.PolygonCollider2D":PolygonCollider2D_1.PolygonCollider2D,"cc.Prefab":Prefab_1.Prefab,"cc.PrefabInfo":PrefabInfo_1.PrefabInfo,"cc.Primitive":Primitive_1.Primitive,"cc.PrivateNode":PrivateNode_1.PrivateNode,"cc.ProgressBar":ProgressBar_1.ProgressBar,"cc.RawAsset":RawAsset_1.RawAsset,"cc.RenderFlow":RenderFlow_1.RenderFlow,"cc.RenderStage":RenderStage_1.RenderStage,"cc.RichText":RichText_1.RichText,"cc.RigidBody":RigidBody_1.RigidBody,"cc.RigidBody2D":RigidBody2D_1.RigidBody2D,"cc.RenderTexture":RenderTexture_1.RenderTexture,"cc.RenderPipeline":RenderPipeline_1.RenderPipeline,"cc.RelativeJoint2D":RelativeJoint2D_1.RelativeJoint2D,"cc.RenderableComponent":RenderableComponent_1.RenderableComponent,"cc.RotationOvertimeModule":RotationOvertimeModule_1.RotationOvertimeModule,"cc.ShapeModule":ShapeModule_1.ShapeModule,"cc.SafeArea":SafeArea_1.SafeArea,"cc.Scene":Scene_1.Scene,"cc.SceneAsset":SceneAsset_1.SceneAsset,"cc.Script":Script_1.Script,"cc.Scrollbar":ScrollBar_1.Scrollbar,"cc.ScrollView":ScrollView_1.ScrollView,"cc.ShadowFlow":ShadowFlow_1.ShadowFlow,"cc.ShadowStage":ShadowStage_1.ShadowStage,"cc.SimplexCollider":SimplexCollider_1.SimplexCollider,"cc.Skeleton":Skeleton_1.Skeleton,"cc.SkeletalAnimation":SkeletalAnimation_1.SkeletalAnimation,"cc.SkinnedMeshBatchRenderer":SkinnedMeshBatchRenderer_1.SkinnedMeshBatchRenderer,"cc.SkinnedMeshRenderer":SkinnedMeshRenderer_1.SkinnedMeshRenderer,"cc.SkinnedMeshUnit":SkinnedMeshUnit_1.SkinnedMeshUnit,"cc.Slider":Slider_1.Slider,"cc.SliderJoint2D":SliderJoint2D_1.SliderJoint2D,"cc.SphereCollider":SphereCollider_1.SphereCollider,"cc.SphereLight":SphereLight_1.SphereLight,"cc.SpotLight":SpotLight_1.SpotLight,"cc.SpringJoint2D":SpringJoint2D_1.SpringJoint2D,"cc.Sprite":Sprite_1.Sprite,"cc.SpriteAtlas":SpriteAtlas_1.SpriteAtlas,"cc.SpriteFrame":SpriteFrame_1.SpriteFrame,"cc.SubContextView":SubContextView_1.SubContextView,"cc.SizeOvertimeModule":SizeOvertimeModule_1.SizeOvertimeModule,"cc.TTFFont":TTFFont_1.TTFFont,"cc.TextAsset":TextAsset_1.TextAsset,"cc.Texture2D":Texture2D_1.Texture2D,"cc.TextureCube":TextureCube_1.TextureCube,"cc.TiledLayer":TiledLayer_1.TiledLayer,"cc.TiledMap":TiledMap_1.TiledMap,"cc.TiledMapAsset":TiledMapAsset_1.TiledMapAsset,"cc.TiledObjectGroup":TiledObjectGroup_1.TiledObjectGroup,"cc.TiledTile":TiledTile_1.TiledTile,"cc.TiledUserNodeData":TiledUserNodeData_1.TiledUserNodeData,"cc.Toggle":Toggle_1.Toggle,"cc.ToggleContainer":ToggleContainer_1.ToggleContainer,"cc.TypeScript":TypeScript_1.TypeScript,"cc.TextureAnimationModule":TextureAnimationModule_1.TextureAnimationModule,"cc.TrailModule":TrailModule_1.TrailModule,"cc.UIComponent":UIComponent_1.UIComponent,"cc.UICoordinateTracker":UICoordinateTracker_1.UICoordinateTracker,"cc.UIMeshRenderer":UIMeshRenderer_1.UIMeshRenderer,"cc.UIOpacity":UIOpacity_1.UIOpacity,"cc.UIRenderable":UIRenderable_1.UIRenderable,"cc.UIReorderComponent":UIReorderComponent_1.UIReorderComponent,"cc.UIStaticBatch":UIStaticBatch_1.UIStaticBatch,"cc.UITransform":UITransform_1.UITransform,"cc.UniformCurveValueAdapter":UniformCurveValueAdapter_1.UniformCurveValueAdapter,"cc.VideoClip":VideoClip_1.VideoClip,"cc.VideoPlayer":VideoPlayer_1.VideoPlayer,"cc.ViewGroup":ViewGroup_1.ViewGroup,"cc.VelocityOvertimeModule":VelocityOvertimeModule_1.VelocityOvertimeModule,"cc.WebView":WebView_1.WebView,"cc.WheelJoint2D":WheelJoint2D_1.WheelJoint2D,"cc.Widget":Widget_1.Widget,"dragonBones.ArmatureDisplay":ArmatureDisplay_1.ArmatureDisplay,"sp.Skeleton":SpSkeleton_1.Sp_Skeleton,"cc.StudioComponent":StudioComponent_1.StudioComponent,"cc.StudioWidget":StudioWidget_1.StudioWidget},RENAME_COMPONENT={"cc.BoxCollider3D":"cc.BoxCollider","cc.BoxCollider":"cc.BoxCollider2D","cc.PhysicsBoxCollider":"cc.BoxCollider2D","cc.CircleCollider":"cc.CircleCollider2D","cc.PhysicsCircleCollider":"cc.CircleCollider2D","cc.Collider":"cc.Collider2D","cc.PhysicsCollider":"cc.Collider2D","cc.PhysicsChainCollider":"cc.Collider2D","cc.Collider3D":"cc.Collider","cc.DistanceJoint":"cc.DistanceJoint2D","cc.ClickEvent":"cc.EventHandler","cc.MouseJoint":"cc.MouseJoint2D","cc.WheelJoint":"cc.WheelJoint2D","cc.PolygonCollider":"cc.PolygonCollider2D","cc.PhysicsPolygonCollider":"cc.PolygonCollider2D","cc.ParticleSystem":"cc.ParticleSystem2D","cc.ParticleSystem3D":"cc.ParticleSystem","cc.Joint":"cc.Joint2D","cc.RigidBody":"cc.RigidBody2D","cc.RigidBody3D":"cc.RigidBody","cc.SphereCollider3D":"cc.SphereCollider","cc.RenderComponent":"cc.UIRenderable","cc.SkeletonAnimation":"cc.SkeletalAnimation"};class MigrateManager{static migrate(e,r,i){return __awaiter(this,void 0,void 0,function*(){const t=r[e];let o=t.__type__||t[0].__type__;if("cc.Light"===o)switch(t._type){case 0:o="cc.DirectionalLight";break;case 1:o="cc.PointLight";break;case 2:o="cc.SpotLight"}const c=RENAME_COMPONENT[o];c&&(o=c);const l=CCCLASS_LIST[o];if(l)return yield l.apply(e,r,i);{o.startsWith("cc.")&&(MigrateManager.logs.includes(o)||MigrateManager.logs.push(o));let c={};for(const e in t){let i=t[e];i&&i.__uuid__?i.__uuid__=yield base_1.ImporterBase.getUuid(i.__uuid__):"_srcBlendFactor"!==e&&"_dstBlendFactor"!==e||(i=utlis_1.getBlendFactor2DTo3D(i),c._color||(c._color=utlis_1.getColor(r[t.node.__id__]))),c[e]=i}let l=JSON.stringify(c,void 0,2);const n=l.match(/(?<=__uuid__": ")(.*)(?=")/g)||[];for(let e of n){const r=e;e=yield base_1.ImporterBase.getUuid(e),l=l.replace(r,e)}return c=JSON.parse(l),i.splice(e,1,c),c}})}}exports.MigrateManager=MigrateManager,MigrateManager.logs=[];