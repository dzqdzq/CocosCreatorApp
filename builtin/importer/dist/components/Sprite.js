"use strict";var __awaiter=this&&this.__awaiter||function(e,t,_,r){return new(_||(_=Promise))(function(i,a){function s(e){try{n(r.next(e))}catch(e){a(e)}}function l(e){try{n(r.throw(e))}catch(e){a(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof _?t:new _(function(e){e(t)})).then(s,l)}n((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sprite=exports.SPRITE=void 0;const base_1=require("../common/base"),path_1=require("path"),utlis_1=require("../common/utlis");exports.SPRITE={__type__:"cc.Sprite",_name:"",_objFlags:0,node:null,_enabled:!0,__prefab:null,_customMaterial:null,_visFlags:0,_srcBlendFactor:2,_dstBlendFactor:4,_color:{__type__:"cc.Color",r:255,g:255,b:255,a:255},_spriteFrame:null,_type:0,_fillType:0,_sizeMode:1,_fillCenter:{__type__:"cc.Vec2",x:0,y:0},_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_useGrayscale:!1,_atlas:null};class Sprite{static create(){return JSON.parse(JSON.stringify(exports.SPRITE))}static getAtlasSpriteFrame(e,t){const _=utlis_1.importProjectAssets.get(e);if(!_||!_.meta||!_.meta.subMetas)return null;const r=_.meta.subMetas;for(const _ in r){if(r[_].uuid===t)return`${e}@${base_1.ImporterBase.getNameByID(path_1.basename(_,path_1.extname(_)))}`}return null}static migrate(e,t,_){return __awaiter(this,void 0,void 0,function*(){const _=t[e],r=JSON.parse(JSON.stringify(exports.SPRITE));for(const e in _){const i=_[e];if("__type__"!==e&&void 0!==i&&null!==i)if("node"===e)r.node=i,utlis_1.setColor(r,i.__id__,t);else if("_spriteFrame"===e){let e=i.__uuid__;(e=_._atlas&&e?Sprite.getAtlasSpriteFrame(_._atlas.__uuid__,e):yield base_1.ImporterBase.getUuid(i.__uuid__,"spriteFrame"))&&(r._spriteFrame={__uuid__:e})}else if("_atlas"===e)r._atlas={__uuid__:yield base_1.ImporterBase.getUuid(i.__uuid__)};else if("_materials"===e){let e=i[0];e&&(e={__uuid__:yield base_1.ImporterBase.getUuid(e.__uuid__)},r._customMaterial=e)}else"_dstBlendFactor"===e?r._dstBlendFactor=utlis_1.getBlendFactor2DTo3D(i):"_srcBlendFactor"===e?r._srcBlendFactor=utlis_1.getBlendFactor2DTo3D(i):r[e]=i}return r})}static apply(e,t,_){return __awaiter(this,void 0,void 0,function*(){const r=yield Sprite.migrate(e,t,_);return _.splice(e,1,r),r})}}exports.Sprite=Sprite;