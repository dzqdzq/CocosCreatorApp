"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path");module.paths.push(path_1.join(Editor.App.path,"node_modules"));const cc_1=require("cc"),fs_1=require("fs"),HideInHierarchy=cc_1.CCObject.Flags.HideInHierarchy,DontSave=cc_1.CCObject.Flags.DontSave,NAME="Reference-Image";exports.methods={async getTargets(){let e=cc_1.find(`Editor Scene Background/${NAME}-Canvas`);e||((e=new cc_1.Node(`${NAME}-Canvas`)).addComponent(cc_1.Canvas),e.parent=cc_1.find("Editor Scene Background"),e.hideFlags|=DontSave|HideInHierarchy);let t=e.getChildByName(NAME);t||((t=new cc_1.Node(NAME)).parent=e,t.hideFlags|=DontSave|HideInHierarchy),t.active=await Editor.Profile.getConfig("reference-image","show");let n=t.getComponent(cc_1.Sprite)||t.addComponent(cc_1.Sprite);const a=n.color.clone();return a.a=await Editor.Profile.getConfig("reference-image","opacity")||100,n.color=a,cce.Engine.repaintInEditMode(),{node:t,sprite:n}},async moveX(e){const{node:t}=await this.getTargets(),n=t.position;n.x=e,t.position=n,cce.Engine.repaintInEditMode()},async moveY(e){const{node:t}=await this.getTargets(),n=t.position;n.y=e,t.position=n,cce.Engine.repaintInEditMode()},async setOpacity(e){const{sprite:t}=await this.getTargets(),n=t.color;n.a=e,t.color=n,cce.Engine.repaintInEditMode()},async switchImages(e){const{sprite:t}=await this.getTargets();let n=fs_1.readFileSync(e);n=new Buffer(n).toString("base64");let a=new Image;a.src="data:png;base64,"+n,a.onload=(()=>{t.spriteFrame=cc_1.SpriteFrame.createWithImage(a),cce.Engine.repaintInEditMode()})},async resetImage(){const{sprite:e}=await this.getTargets();e.spriteFrame=null,cce.Engine.repaintInEditMode()},async setImageVisible(e){const{node:t}=await this.getTargets();t.active=e,e&&Editor.Panel.open("reference-image"),cce.Engine.repaintInEditMode()}};