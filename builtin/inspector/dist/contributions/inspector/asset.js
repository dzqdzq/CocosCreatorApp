"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.update=exports.methods=exports.$=exports.template=exports.style=exports.listeners=void 0;const showImage=["cc.ImageAsset","cc.SpriteFrame","cc.Texture2D"];exports.listeners={},exports.style='\n:host {\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n:host > .container { \n    display: flex;\n    flex: 1;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n:host > .container[whole] { \n    max-height: 100%;\n}\n:host > .container > .header { \n    display: flex;\n    flex: 1;\n}\n:host > .container > .header > .icon {\n    width: 20px;\n    font-size: 14px;\n    cursor: pointer;\n}\n:host > .container > .header > .image { \n    width: 20px;\n    height: 24px;\n    cursor: pointer;\n}\n:host > .container > .header > .icon:hover,\n:host > .container > .header > .image:hover {\n    opacity: 0.8;\n}\n:host > .container > .header > .name { \n    flex: 1;\n    padding-left: 5px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n}\n:host > .container > .header > .lock { \n    display: none;\n    font-size: 12px;\n    color: var(--color-focus-contrast-normal);\n    margin-left: 4px;\n    margin-right: 12px;\n    cursor: auto;\n}\n:host > .container > .header > ui-button { \n    display: none;\n    padding: 0 6px; \n    height: 22px;\n    margin-left: 6px;\n    margin-right: 6px;\n}\n:host > .container > .header[dirty] > ui-button {\n    display: inline-block;\n}\n:host > .container > .content {\n    display: flex;\n    padding-top: 5px;\n    flex: 1;\n    flex-direction: column;\n}\n:host > .container > .content > section {\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n:host > .container > .content > .content-section {\n    flex: 1;\n    overflow: auto;\n}\n:host > .container > .content > section > ui-panel {\n    display: flex;\n    flex-direction: column;\n}\n:host > .container > .content > section > ui-panel:only-child {\n    flex: 1;\n}\n\n:host > .container > .content > .content-footer {\n    margin-top: 10px;\n}\n\n:host([sub-type="material"]) > .container > .content,\n:host([sub-type="gltf-material"]) > .container > .content {\n    padding-top: 0;\n}\n\n:host([sub-type="material"]) > .container > .content > .content-header,\n:host([sub-type="gltf-material"]) > .container > .content > .content-header {\n    position: sticky;\n    left: 0;\n    top: 0;\n    z-index: 1;\n}\n\n',exports.template='\n<ui-section whole class="container">\n    <header class="header" slot="header">\n        <ui-icon class="icon" color tooltip="i18n:inspector.locate_asset"></ui-icon>\n        <ui-image class="image" tooltip="i18n:inspector.locate_asset"></ui-image>\n        <span class="name"></span>\n        <ui-button class="save tiny green transparent" tooltip="i18n:inspector.asset.save">\n            <ui-icon value="check"></ui-icon>\n        </ui-button>\n        <ui-button class="reset tiny red transparent" tooltip="i18n:inspector.asset.reset">\n            <ui-icon value="reset"></ui-icon>\n        </ui-button>\n        <ui-icon class="lock" value="lock" tooltip="i18n:inspector.asset.prohibitEditInternalAsset"></ui-icon>\n    </header>\n    <section class="content">\n        <section class="content-header"></section>\n        <section class="content-section"></section>\n        <section class="content-footer"></section>\n    </section>\n</ui-section>\n',exports.$={container:".container",header:".header",content:".content",lock:".lock",icon:".icon",image:".image",name:".name",save:".save",reset:".reset",contentHeader:".content-header",contentSection:".content-section",contentFooter:".content-footer"};const Elements={panel:{ready(){const e=this;let t;e.__assetChanged__=(n=>{Array.isArray(e.uuidList)&&e.uuidList.includes(n)&&(window.cancelAnimationFrame(t),t=window.requestAnimationFrame(async()=>{await e.reset()}))}),Editor.Message.addBroadcastListener("asset-db:asset-change",e.__assetChanged__)},async update(){const e=this;let t=[];try{t=await Promise.all(e.uuidList.map(e=>Editor.Message.request("asset-db","query-asset-info",e)))}catch(e){console.error(e)}if(t=t.filter(Boolean),e.asset=t[0],e.assetList=[],e.uuidList=[],e.type="unknown",e.asset){const n=e.asset.importer;t.forEach(t=>{if(t.importer===n){if(e.uuidList.length>0&&t.readonly)return;e.uuidList.push(t.uuid),e.assetList.push(t)}})}if(e.asset?(e.$.container.style.display="flex",e.type=e.asset.importer,e.assetList.some(t=>t.importer!==e.type)&&(e.type="unknown")):e.$.container.style.display="none",e.$this.setAttribute("sub-type",e.type),"unknown"===e.type)return e.metaList=[],e.metaListOrigin=[],!1;try{e.metaList=await Promise.all(e.uuidList.map(e=>Editor.Message.request("asset-db","query-asset-meta",e)))}catch(t){console.error(t),e.metaList=[]}e.metaList=e.metaList.filter(Boolean),e.metaListOrigin=e.metaList.map(e=>JSON.stringify(e))},close(){Editor.Message.removeBroadcastListener("asset-db:asset-change",this.__assetChanged__)}},header:{ready(){const e=this;e.$.save.addEventListener("click",t=>{t.stopPropagation(),e.save()}),e.$.reset.addEventListener("click",t=>{t.stopPropagation(),e.reset()}),e.$.icon.addEventListener("click",t=>{t.stopPropagation(),e.uuidList.forEach(e=>{Editor.Message.request("assets","ui-kit:touch-asset",e)})})},update(){const e=this;e.$.name.innerHTML=1===e.assetList.length?e.asset.name:`${e.assetList.length} selections`,e.$.lock.style.display=e.asset.readonly?"inline-block":"none",showImage.includes(e.asset.type)?(e.$.image.value=e.asset.uuid,e.$.header.prepend(e.$.image),e.$.icon.remove()):(e.$.icon.value=e.asset.importer,e.$.header.prepend(e.$.icon),e.$.image.value="",e.$.image.remove())},async isDirty(){const e=this;await e.isDirty()?e.$.header.setAttribute("dirty",""):e.$.header.removeAttribute("dirty")}},content:{ready(){this.contentRenders={}},update(){const e=this;e.contentRenders={header:{list:[],contentRender:e.$.contentHeader},section:{list:e.renderMap.section.unknown,contentRender:e.$.contentSection},footer:{list:[],contentRender:e.$.contentFooter}};for(const t in e.renderMap)e.renderMap[t]&&e.renderMap[t][e.type]&&(e.contentRenders[t].list=e.renderMap[t][e.type]);for(const t in e.contentRenders){const{list:n,contentRender:s}=e.contentRenders[t];s.__panels__=Array.from(s.children);let o=0;for(;o<n.length;o++){const t=n[o];s.__panels__[o]||(s.__panels__[o]=document.createElement("ui-panel"),s.__panels__[o].addEventListener("change",()=>{Elements.header.isDirty.call(e)}),s.appendChild(s.__panels__[o]),s.__panels__[o]=s.__panels__[o]),s.__panels__[o].setAttribute("src",t)}for(;o<s.__panels__.length;o++)s.removeChild(s.__panels__[o]);s.__panels__=Array.from(s.children),Array.prototype.forEach.call(s.__panels__,t=>{t.injectionStyle("ui-prop { margin-top: 5px; }"),t.update(e.assetList,e.metaList)})}}}};async function update(e,t){const n=this;n.uuidList=e||[],n.renderMap=t;for(const e in Elements){const t=Elements[e];t.update&&await t.update.call(n)}}function ready(){const e=this;for(const t in Elements){const n=Elements[t];n.ready&&n.ready.call(e)}}async function beforeClose(){const e=this;if(e.isDialoging)return!1;for(const t in e.contentRenders){const{contentRender:n}=e.contentRenders[t];if(Array.isArray(n.__panels__))for(let e=0;e<n.__panels__.length;e++){if(!await n.__panels__[e].canClose())return!1}}if(!await e.isDirty())return!0;let t=2;if(await Editor.Profile.getConfig("inspector","asset.auto_save"))t=1;else{e.isDialoging=!0;const n=Editor.I18n.t("inspector.check_is_saved.assetMessage").replace("${assetName}",e.asset.name);t=(await Editor.Dialog.warn(n,{buttons:[Editor.I18n.t("inspector.check_is_saved.abort"),Editor.I18n.t("inspector.check_is_saved.save"),"Cancel"],default:1,cancel:2})).response,e.isDialoging=!1}return 0===t?(e.$.header.removeAttribute("dirty"),!0):1===t&&(await e.save(),!0)}async function close(){const e=this;for(const t in Elements){const n=Elements[t];n.close&&n.close.call(e)}}exports.methods={async isDirty(){const e=this;let t=!1;if(e.metaList&&(t=e.metaList.some((t,n)=>e.metaListOrigin[n]!==JSON.stringify(t))))return t;for(const n in e.contentRenders){const{contentRender:s}=e.contentRenders[n];if(Array.isArray(s.__panels__))for(let e=0;e<s.__panels__.length;e++)if(t=await s.__panels__[e].callMethod("isDirty"))return t}return t},async save(){const e=this,t=[];for(const n in e.contentRenders){const{contentRender:s}=e.contentRenders[n];if(Array.isArray(s.__panels__))for(let e=0;e<s.__panels__.length;e++)t.push(s.__panels__[e].callMethod("canApply"))}if(!!(await Promise.all(t)).some(e=>!1===e))return;let n=!0;for(const t in e.contentRenders){const{contentRender:s}=e.contentRenders[t];if(Array.isArray(s.__panels__))for(let e=0;e<s.__panels__.length;e++){const t=await s.__panels__[e].callMethod("apply");if(!1===t)return;1==t&&(n=!1)}}e.$.header.removeAttribute("dirty"),!1!==n&&e.uuidList.forEach((t,n)=>{const s=JSON.stringify(e.metaList[n]);s!==e.metaListOrigin[n]&&(e.metaListOrigin[n]=s,Editor.Message.request("asset-db","save-asset-meta",t,s))})},async reset(){const e=this;e.$.header.removeAttribute("dirty");for(const t in e.contentRenders){const{contentRender:n}=e.contentRenders[t];for(let e=0;e<n.__panels__.length;e++)await n.__panels__[e].callMethod("reset")}e.$this.update(e.uuidList,e.renderMap)}},exports.update=update,exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;