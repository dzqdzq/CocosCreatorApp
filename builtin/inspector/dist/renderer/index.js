"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeClose=exports.ready=exports.listeners=exports.methods=exports.$=exports.fonts=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),vm_1=require("./vm"),manager_1=require("../curve-editor/manager"),manager_2=require("../gradient-editor/manager"),manager_3=require("../sprite-editor/manager");async function ready(){const e=this.vm=await vm_1.init(this.$.content);this._waitDeleteUuids=[],this.openUuid="";const t=Editor.Selection.getLastSelectedType(),s=Editor.Selection.getSelected(t);e.item.type=t,e.item.uuids=s,await Editor.Message.request("asset-db","query-ready")&&(e.state.db="ready"),await Editor.Message.request("scene","query-is-ready")&&(e.state.scene="ready"),await exports.methods.unstaging()}async function beforeClose(){this.vm&&await exports.methods.staging()}exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../dist/index.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static","/template/index.html"),"utf8"),exports.fonts=[{name:"inspector"}],exports.$={content:".content"},exports.methods={async staging(){this.vm&&Editor.Message.send("inspector","staging",{expands:vm_1.expands,scrolls:vm_1.scrolls})},async unstaging(){const e=await Editor.Message.request("inspector","unstaging");e&&(Object.assign(vm_1.expands,e.expands),Object.assign(vm_1.scrolls,e.scrolls))},sceneReady(e){const t=this,s=t.vm;s&&(t.openUuid!==e&&(t.openUuid=e,"node"===s.item.node&&(s.item.uuid=""),s.rebase()),s.state.scene="ready",s.$refs.node&&s.$refs.node.refresh())},sceneClose(){},dbReady(){const e=this.vm;e&&(e.state.db="ready")},dbClose(){const e=this.vm;e&&(e.state.db="close")},selected(e,t){const s=this.vm;if(!s)return;clearTimeout(this._unselectTimer),this._waitDeleteUuids=[];const i=Editor.Selection.getSelected(e);s.lock||(s.item.type=e,s.item.uuids=Array.from(i),s.record(e,i))},unselected(e,t){const s=this.vm;s&&(s.lock||s.item.type===e&&(clearTimeout(this._unselectTimer),this._waitDeleteUuids.push(t),this._unselectTimer=setTimeout(()=>{for(;this._waitDeleteUuids.length;){const e=this._waitDeleteUuids.pop(),t=s.item.uuids.indexOf(e);-1!==t&&s.item.uuids.splice(t,1),0===s.item.uuids.length&&(s.item.type="",s.item.uuids=[])}},200)))},async animationTimeChange(){const e=this.vm;e.$refs.node&&e.$refs.node.refresh()},async nodeChanged(){const e=this.vm;e.$refs.node&&e.$refs.node.refresh()},async assetChanged(e){const t=this.vm;t.sureitem.uuids.includes(e)&&t.$refs.asset&&t.$refs.asset.refresh(!0)},async effectUpdated(e){},async projectSettingChange(e){"layers"===e&&await this.nodeChanged()},gradientState(e){manager_2.changeGradintState(e)},gradientChanged(e){manager_2.changeGrandintData(e)},curveState(e){manager_1.changeCurveState(e)},curveChanged(e){manager_1.changeCurveData(e)},spriteState(e){manager_3.changeSpriteState(e)},spriteChanged(e){manager_3.changeSpriteData(e)},openSubInspector(e,t){if(!e)return;const s=this.vm;if("node"!==s.sureitem.type)return;if(s.sureitem.uuids[0]+"-mark-vue-uid-"+s._uid!==t)return;let i=s.materialUuids[e]||0;i++,s.$set(s.materialUuids,e,i)},closeSubInspector(e,t){if(!e)return;const s=this.vm;if("node"!==s.sureitem.type){for(const e in s.materialUuids)s.$set(s.materialUuids,e,0);return}if(s.sureitem.uuids[0]+"-mark-vue-uid-"+s._uid!==t)return;let i=s.materialUuids[e]||1;i--,s.$set(s.materialUuids,e,i)}},exports.listeners={resize(){const e=this.vm;e&&e.resize()},show(){const e=this.vm;e&&e.resize()}},exports.ready=ready,exports.beforeClose=beforeClose;