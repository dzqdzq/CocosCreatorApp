"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.data=exports.watch=exports.methods=exports.components=exports.props=exports.template=void 0;const manager_1=require("../../../../curve-editor/manager");function data(){return{style:{background:"linear-gradient(to right, #fff 0%,#fff 100%)"}}}function mounted(){const e=this;e.refresh(),e.observer=new IntersectionObserver(n=>{n.forEach(n=>{0!==n.intersectionRatio&&e.refresh()})},{root:e.$root.$el,rootMargin:"0px",threshold:.1}),e.observer.observe(e.$el)}function destroyed(){manager_1.close(this),this.observer.unobserve(this.$el)}exports.template='\n<div class="ins-curve-range">\n\n    <template\n        v-if="dump"\n    >\n        <div class="prop-name"\n            v-if="name"\n        >\n            <ui-label\n                :tooltip="title"\n            >{{name}}</ui-label>\n            <ui-icon value="lock"\n                v-if="readonly || dump.readonly"\n            ></ui-icon>\n        </div>\n        <ins-resize-line></ins-resize-line>\n        <template\n            v-if="dumps && dumps.length > 1"\n        >\n            <div class="prop-content">\n                Unable to merge operations\n            </div>\n        </template>\n\n        <template\n            v-else\n        >\n            <div class="prop-content">\n\n                <template\n                    v-if="dump"\n                >\n                    <template\n                        v-if="dump.value.mode.value == 0"\n                    >\n                        <ins-prop auto="true"\n                            :dump="dump.value.constant"\n                            :readonly="readonly || dump.readonly"\n                            :radian="dump.radian"\n                        ></ins-prop>\n                    </template>\n\n                    <div class="ins-prop"\n                        v-else-if="dump.value.mode.value == 2"\n                        :disabled="readonly || dump.readonly"\n                    >\n                        <div class="ins-curve"\n                            :disabled="readonly || dump.readonly"\n                            @click.right="reset(\'dump.value.curveMin\', 2)"\n                        >\n                            <canvas ref="thumbMin"\n                                @click="showEditor(\'curveMin\')"\n                            ></canvas>\n                        </div>\n                        <div class="ins-curve"\n                            :disabled="readonly || dump.readonly"\n                            @click.right="reset(\'curveMax\', 2)"\n                        >\n                            <canvas ref="thumbMax"\n                                @click="showEditor(\'curveMax\')"\n                            ></canvas>\n                        </div>\n                    </div>\n\n                    <div class="ins-prop"\n                        :disabled="readonly || dump.readonly"\n                        v-else-if="dump.value.mode.value == 3"\n                    >\n                        <ins-prop auto="true"\n                            :readonly="readonly || dump.readonly"\n                            :dump="dump.value.constantMin"\n                            :radian="dump.radian"\n                        ></ins-prop>\n                        <ins-prop auto="true"\n                            :readonly="readonly || dump.readonly"\n                            :dump="dump.value.constantMax"\n                            :radian="dump.radian"\n                        ></ins-prop>\n                    </div>\n\n                    <template\n                        v-else\n                    >\n                        <div class="ins-curve"\n                            :disabled="readonly || dump.readonly"\n                            @click.right="reset(\'dump.value.curve\', 1)"\n                        >\n                            <canvas ref="thumb"\n                                @click="showEditor(\'curve\')"\n                            ></canvas>\n                        </div>\n                    </template>\n\n                    <div class="button">\n                        <ui-icon value="arrow-triangle"\n                            @click="_onChangeMode($event)"\n                        ></ui-icon>\n                    </div>\n                </template>\n            </div>\n        </template>\n    </template>\n</div>\n',exports.props=["title","name","dump","dumps","readonly"],exports.components={"ins-prop":require("./ins-prop"),"ins-resize-line":require("./ins-resize-line")},exports.methods={apply(e){const n=this;n.dump.value[e.key].value.keyFrames=e.keyFrames,n.dump.value[e.key].value.preWrapMode=e.preWrapMode,n.dump.value[e.key].value.postWrapMode=e.postWrapMode,n.dump.value.multiplier.value=e.multiplier,this.emitChange(),this.emitConfirm(),process.nextTick(()=>{n.refresh()})},emitChange(){const e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),this.$el.dispatchEvent(e)},emitConfirm(){const e=document.createEvent("HTMLEvents");e.initEvent("confirm",!0,!0),this.$el.dispatchEvent(e)},refresh(){const e=this;if(!e.dump.value)return;let n=!1;if(-1===e.dump.min&&(n=!0),1===e.dump.value.mode.value){const t=this.getThumbCtx("thumb");t&&manager_1.drawCurve(e.dump.value.curve.value.keyFrames,t,n)}else if(2===e.dump.value.mode.value){const t=this.getThumbCtx("thumbMin");t&&manager_1.drawCurve(e.dump.value.curveMin.value.keyFrames,t,n);const a=this.getThumbCtx("thumbMax");a&&manager_1.drawCurve(e.dump.value.curveMax.value.keyFrames,a,n)}},getThumbCtx(e){if(!this.$refs[e])return console.warn(`${e} is not exist!`),null;if(0===this.$refs[e].getBoundingClientRect().height)return null;const n=this.$refs[e].getContext("2d");return n.canvas.width=n.canvas.offsetWidth,n.canvas.height=n.canvas.offsetHeight,n.strokeStyle="red",n},showEditor(e){if(this.readonly||this.dump.readonly)return;let n=!1;-1===this.dump.min&&(n=!0),manager_1.open({value:this.dump.value[e].value,key:e,multiplier:this.dump.value.multiplier.value,negative:n,radian:this.dump.radian,path:this.dump.path,name:this.dump.name},this)},reset(e,n){const t=this;t.dump.value[e].default&&this.apply(Object.assign(Object.assign({},t.dump.value[e].default),{key:e,multiplier:t.dump.value.multiplier.default})),manager_1.update(Object.assign(Object.assign({},t.dump.value[e].default),{key:e,multiplier:t.dump.value.multiplier.default}),t)},_onChangeMode(e){const n=this,{left:t,top:a}=e.target.getBoundingClientRect(),r=Math.round(t+5),i=Math.round(a+25);Editor.Menu.popup({x:r,y:i,menu:n.dump.value.mode.enumList.map(e=>({label:e.name,type:"radio",checked:e.value===n.dump.value.mode.value,click(){n.dump.value.mode.value=e.value,n.$root.$emit("set-property",n.dump.value.mode)}}))})}},exports.watch={dump(){const e=this;process.nextTick(()=>{e.refresh()})}},exports.data=data,exports.mounted=mounted,exports.destroyed=destroyed;