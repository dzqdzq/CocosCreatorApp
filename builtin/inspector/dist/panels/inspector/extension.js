"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.end=exports.start=exports.queryRendererMap=exports.queryType=exports.detach=exports.attach=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");let started=!1;const typeCache={},cacheManager={header:{},section:{},footer:{}};function attachCache(e,t,a){for(let n in e){let r=e[n];if("string"==typeof r)try{r=require(path_1.join(a,r))}catch(e){console.warn(Editor.I18n.t("inspector.extension.register_invalid")),console.warn(e)}else for(let e in r){const t=path_1.join(a,r[e]);r[e]=t}for(let e in r){const a=r[e];fs_extra_1.existsSync(a)||fs_extra_1.existsSync(a.replace(/\.js$/,".ccc"))?(t[n]=t[n]||{},t[n][e]=t[n][e]||[],-1===t[n][e].indexOf(a)&&t[n][e].push(a)):console.warn(Editor.I18n.t("inspector.extension.invalid",{file:a}))}}}function detachCache(e,t,a){for(let n in e){let r=e[n];if("string"==typeof r)r=require(path_1.join(a,r));else for(let e in r)r[e]=path_1.join(a,r[e]);for(let e in r){const a=r[e];if(!fs_extra_1.existsSync(a)&&!fs_extra_1.existsSync(a.replace(/\.js$/,".ccc"))){console.warn(Editor.I18n.t("inspector.extension.invalid",{file:a}));continue}if(!t[n]||!t[n][e])continue;const c=t[n][e].indexOf(a);-1!==c&&t[n][e].splice(c,1)}}}function attach(e){if(!e.info.contributions||!e.info.contributions.inspector)return;const t=e.info.contributions.inspector;for(let a in t.type){const n=path_1.join(e.path,t.type[a]);fs_extra_1.existsSync(n)||fs_extra_1.existsSync(n.replace(/\.js$/,".ccc"))?typeCache[a]=n:console.warn(Editor.I18n.t("inspector.extension.invalid",{file:n}))}attachCache(t.header,cacheManager.header,e.path),attachCache(t.section,cacheManager.section,e.path),attachCache(t.footer,cacheManager.footer,e.path)}function detach(e){if(!e.info.contributions||!e.info.contributions.inspector)return;const t=e.info.contributions.inspector;for(let t in typeCache)Editor.Utils.Path.contains(e.path,typeCache[t])&&delete typeCache[t];detachCache(t.header,cacheManager.header,e.path),detachCache(t.section,cacheManager.section,e.path),detachCache(t.footer,cacheManager.footer,e.path)}function queryType(e){return typeCache[e]}function queryRendererMap(e,t){const a={header:cacheManager.header[e],section:cacheManager.section[e],footer:cacheManager.footer[e]};return t?{[t]:a[t]}:a}function start(){if(started)return;started=!0,Editor.Package.getPackages({enable:!0}).forEach(attach),Editor.Package.on("enable",attach),Editor.Package.on("disable",detach)}function end(){}exports.attach=attach,exports.detach=detach,exports.queryType=queryType,exports.queryRendererMap=queryRendererMap,exports.start=start,exports.end=end;