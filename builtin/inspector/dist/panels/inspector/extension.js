"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.end=exports.start=exports.queryRendererMap=exports.queryType=exports.detach=exports.attach=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");let started=!1;const typeCache={},cacheManager={header:{},section:{},footer:{}};function attachCache(e,t,n){for(const a in e){const c=e[a];for(const e in c){const t=path_1.isAbsolute(c[e])?c[e]:path_1.join(n,c[e]);c[e]=t}for(const e in c){const n=c[e];fs_extra_1.existsSync(n)||fs_extra_1.existsSync(n.replace(/\.js$/,".ccc"))?(t[a]=t[a]||{},t[a][e]=t[a][e]||[],-1===t[a][e].indexOf(n)&&t[a][e].push(n)):console.warn(Editor.I18n.t("inspector.extension.invalid",{file:n}))}}}function detachCache(e,t,n){for(const a in e){const c=e[a];for(const e in c)c[e]=path_1.join(n,c[e]);for(const e in c){const n=c[e];if(!fs_extra_1.existsSync(n)&&!fs_extra_1.existsSync(n.replace(/\.js$/,".ccc"))){console.warn(Editor.I18n.t("inspector.extension.invalid",{file:n}));continue}if(!t[a]||!t[a][e])continue;const o=t[a][e].indexOf(n);-1!==o&&t[a][e].splice(o,1)}}}function attach(e){if(!e.info.contributions||!e.info.contributions.inspector)return;const t=e.info.contributions.inspector;for(const n in t.type){const a=path_1.join(e.path,t.type[n]);fs_extra_1.existsSync(a)||fs_extra_1.existsSync(a.replace(/\.js$/,".ccc"))?typeCache[n]=a:console.warn(Editor.I18n.t("inspector.extension.invalid",{file:a}))}attachCache(t.header,cacheManager.header,e.path),attachCache(t.section,cacheManager.section,e.path),attachCache(t.footer,cacheManager.footer,e.path)}function detach(e){if(!e.info.contributions||!e.info.contributions.inspector)return;const t=e.info.contributions.inspector;for(const t in typeCache)Editor.Utils.Path.contains(e.path,typeCache[t])&&delete typeCache[t];detachCache(t.header,cacheManager.header,e.path),detachCache(t.section,cacheManager.section,e.path),detachCache(t.footer,cacheManager.footer,e.path)}function queryType(e){return typeCache[e]}function queryRendererMap(e,t){const n={header:cacheManager.header[e]||{},section:cacheManager.section[e]||{},footer:cacheManager.footer[e]||{}};return t?{[t]:n[t]}:n}function start(){if(started)return;started=!0,Editor.Package.getPackages({enable:!0}).forEach(attach),Editor.Package.on("enable",attach),Editor.Package.on("disable",detach)}function end(){}exports.attach=attach,exports.detach=detach,exports.queryType=queryType,exports.queryRendererMap=queryRendererMap,exports.start=start,exports.end=end;