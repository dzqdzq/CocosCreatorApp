"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),plugin_1=require("./plugin"),layout_counter_1=require("../contributions/joint/layout-counter");async function load(){await plugin_1.pluginManager.init()}function unload(){plugin_1.pluginManager.destroy()}(()=>{const e=(0,path_1.join)(Editor.Project.path,"./settings",Editor.App.version,"./packages/project-setting.json");if((0,fs_extra_1.existsSync)(e))try{const t=require(e);Editor.Profile.setProject("project","",t)}catch(e){console.log(e)}})(),exports.methods={async openSettings(e,t,...r){await Editor.Panel.has("project.settings")?(Editor.Message.send("project","change-settings-tab",e,t,...r),Editor.Panel.open("project.settings")):Editor.Panel.open("project.settings",e,t,...r)},openJoint(){console.warn('`Editor.Message.send("project", "open-joint")` is deprecated, Please use `Editor.Message.send("project", "open-settings", "project", "joint")`'),exports.methods.openSettings("project","joint")},calcJointLayouts:layout_counter_1.calcJointLayouts,changeScriptConfig(){Editor.Task.addNotice({title:"Project Script",message:Editor.I18n.t("project.scripts.config_changed_info")}),Editor.Message.broadcast("project:script-config-changed")},async changeDesignResolution(e,t){const r=await Editor.Profile.getProject("project","general.designResolution");Editor.Message.broadcast("project:change-design-resolution",r)},queryDesignResolution:async()=>Editor.Profile.getProject("project","general.designResolution"),async changeCustomLayer(){const e=await Editor.Profile.getProject("project","layer");Editor.Message.broadcast("project:change-custom-layer",e)},async changeSortingLayer(){const e=await Editor.Profile.getProject("project","sorting-layer")||{};Editor.Message.broadcast("project:change-sorting-layer",e.layers)},queryProjectData:()=>plugin_1.pluginManager.configs,queryConfig:async(e,t,r)=>plugin_1.pluginManager.hasRegisterPackages.has(e)?await Editor.Profile.getProject(e,t,r):null,async importConfig(){const e=await Editor.Dialog.select({title:Editor.I18n.t("project.menu.importConfig"),type:"file",multi:!1,filters:[{name:"JSON",extensions:["json"]}]});if(e.filePaths&&e.filePaths[0])try{let t;t=(0,fs_extra_1.readJSONSync)(e.filePaths[0]),await plugin_1.pluginManager.handleImportConfigs(t),console.log("Import project config success!Please refresh panel.")}catch(e){console.error("Import project config failed!",e)}},async exportConfig(){const e=await plugin_1.pluginManager.handleExportConfigs(),t=await Editor.Dialog.save({title:Editor.I18n.t("project.menu.exportConfig"),path:(0,path_1.join)(Editor.Project.path,"project-configs.json"),filters:[{name:"JSON",extensions:["json"]}]});if(t.filePath)try{(0,fs_extra_1.outputFileSync)(t.filePath,JSON.stringify(e,null,2)),console.log(`project config has export in {link[${t.filePath}](${t.filePath})}`)}catch(e){console.error("Export project config failed!",e)}},async changeHighQuality(){const e=await Editor.Profile.getProject("project","high-quality");Editor.Message.broadcast("project:change-high-quality",e);const t=(0,path_1.join)(Editor.Project.path,"./.creator/default-meta.json");let r={};(0,fs_extra_1.existsSync)(t)&&(r=await(0,fs_extra_1.readJSON)(t)),e?(r.texture||(r.texture={}),r["erp-texture-cube"]||(r["erp-texture-cube"]={}),"linear"===r.texture.minfilter&&"linear"===r.texture.magfilter&&"nearest"===r.texture.mipfilter&&"linear"===r["erp-texture-cube"].minfilter&&"linear"===r["erp-texture-cube"].magfilter&&"nearest"===r["erp-texture-cube"].mipfilter||console.warn("The default meta data of texture has been modified.\n  PORJECT://.creator/default-meta.json"),r.texture.minfilter="linear",r.texture.magfilter="linear",r.texture.mipfilter="nearest",r["erp-texture-cube"].minfilter="linear",r["erp-texture-cube"].magfilter="linear",r["erp-texture-cube"].mipfilter="nearest"):((r.texture&&(r.texture.minfilter||r.texture.magfilter||r.texture.mipfilter)||r["erp-texture-cube"]&&(r["erp-texture-cube"].minfilter||r["erp-texture-cube"].magfilter||r["erp-texture-cube"].mipfilter))&&console.warn("The default meta data of texture has been modified.\n  PORJECT://.creator/default-meta.json"),r.texture&&(delete r.texture.minfilter,delete r.texture.magfilter,delete r.texture.mipfilter),r["erp-texture-cube"]&&(delete r["erp-texture-cube"].minfilter,delete r["erp-texture-cube"].magfilter,delete r["erp-texture-cube"].mipfilter)),(0,fs_extra_1.outputJSONSync)(t,r,{spaces:2}),Editor.Message.send("asset-db","refresh-default-user-data-config")}},exports.load=load,exports.unload=unload;