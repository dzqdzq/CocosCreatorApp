"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.methods=exports.template=exports.$=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue");function ready(){const e=this.$.main,r=new Vue({el:e,data:{layers:[],increaseId:0,dragging:!1},mounted(){this.refresh()},methods:{async refresh(){const e=await Editor.Profile.getProject("project","sorting-layer");if(e&&Array.isArray(e.layers))r.increaseId=e.increaseId,r.layers=e.layers;else{const e=await Editor.Message.request("scene","query-sorting-layer-builtin");r.layers=e,r.increaseId=0}r.layers.sort((e,r)=>e.value-r.value),r.layers.forEach(e=>{e.id>r.increaseId&&(r.increaseId=Math.floor(e.id)+1)})},add(){let e=1;r.layers.forEach(r=>{const a=r.name.match(/Sorting Layer (\d+)$/);if(Array.isArray(a)){const r=Number(a[1]);e<=r&&(e=r+1)}}),r.increaseId++,r.layers.push({id:r.increaseId,name:`Sorting Layer ${e}`,value:r.layers.length}),r.save()},remove(e){const a=r.layers[e];a&&0!==a.value&&(r.layers.splice(e,1),r.save())},rename(e,a){const t=e.target.value.trim();t&&(r.layers[a].name=t,r.save())},async save(){let e=this.layers.findIndex(e=>0===e.value);if(-1===e)return void console.error("Sorting Layers configuration data is lack of Default layer.");e=0-e;const r=this.layers.map(r=>{const a={id:r.id,name:r.name,value:e};return e++,a});await Editor.Profile.setProject("project","sorting-layer",{layers:r,increaseId:this.increaseId}),Editor.Message.broadcast("project:setting-change","sorting-layer"),this.refresh()},dragReset(){r.dragging&&(r.dragging=!1)},dragStart(e,a){e.stopPropagation(),r.dragging=!0,e.dataTransfer.setData("_sorting_layer_drag_data_",a)},dragOver(e){if(e.preventDefault(),!r.dragging)return;const a=e.currentTarget,t=a.getBoundingClientRect(),n=t.height/2;e.clientY-t.top<=n?a.setAttribute("drag-over","top"):t.bottom-e.clientY<=n&&a.setAttribute("drag-over","bottom")},dragLeave(e){e.currentTarget.removeAttribute("drag-over")},drop(e,a){if(e.dataTransfer){const t=e.dataTransfer.getData("_sorting_layer_drag_data_");if(!t)return;if(!r.dragging)return;r.dragging=!1;const n=Number(t),o=e.currentTarget,i=o.getAttribute("drag-over");if(o.removeAttribute("drag-over"),0===a-n)return;"top"===i||"bottom"===i&&(a+=1);const s=r.layers[n];a>n?(r.layers.splice(n,1),r.layers.splice(a-1,0,s)):a<n&&(r.layers.splice(n,1),r.layers.splice(a,0,s)),r.save()}}}})}exports.style="\n.main > .header { \n    margin-bottom: 1em;\n}\n.main > .footer { \n    text-align: center;\n}\n.main > .footer .add { \n    width: 36%; \n    margin-top: 25px;\n}\n.main > .list { }\n.main > .list .per {\n    position: relative;\n    display: flex;\n    padding: 4px 0;\n}\n.main > .list .per[drag-over]::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    background-color: var(--color-info-fill-weakest);\n}\n.main > .list .per[drag-over='top']::before {\n    top: -1px;\n}\n.main > .list .per[drag-over='bottom']::before {\n    bottom: -1px;\n}\n.main > .list .per > .drag {\n    width: 6px;\n    margin: 2px 6px 2px 0;\n    cursor: move;\n    background: linear-gradient(45deg, var(--color-active-fill-normal) 25%, var(--color-normal-fill) 0, var(--color-normal-fill) 50%, var(--color-active-fill-normal) 0, var(--color-active-fill-normal) 75%, var(--color-normal-fill) 0);\n    background-size: 6px 6px;\n}\n.main > .list .per > .drag:hover {\n    background: linear-gradient(45deg, var(--color-info-fill-weakest) 25%, var(--color-normal-fill) 0, var(--color-normal-fill) 50%, var(--color-info-fill-weakest) 0, var(--color-info-fill-weakest) 75%, var(--color-normal-fill) 0);\n    background-size: 6px 6px;\n}\n.main > .list .per > .layer {\n    flex: 1;\n}\n.main > .list .per > .layer > .icon {\n    flex: none;\n    margin-left: 10px;\n}\n.main > .list .per > .layer[readonly] .name {\n    opacity: 0.55;\n}\n",exports.$={main:".main"},exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/project-sorting-layer.html"),"utf8"),exports.methods={},exports.ready=ready;