"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.importConfig=exports.exportConfig=exports.ready=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/project-physics.html"),"utf8"),ProjectPhysicsVM=Vue.extend({name:"ProjectPhysicsVM",data:()=>({collisionMatrix:{0:1},groups:[],reverseGroups:[],state:"",stateIndex:0,error:""}),mounted(){this.refresh()},methods:{t:t=>Editor.I18n.t(t),async refresh(){const t=await Editor.Profile.getProject("project","physics.collisionGroups")||[];this.groups=t.concat([{index:0,name:"DEFAULT"}]).sort((t,e)=>t.index-e.index),this.reverseGroups=this.groups.slice().reverse();const e=await Editor.Profile.getProject("project","physics.collisionMatrix");e&&(this.collisionMatrix=e)},checked(t,e){const i=this.collisionMatrix[e.toString()];return void 0!==i&&!!(i&1<<t)},onChanged(t){const e=t.currentTarget,i=e.getAttribute("y"),s=1<<Number(i);if(!i)return;let r=this.collisionMatrix[i];Array.from(e.getElementsByTagName("ui-checkbox")).forEach(t=>{const e=t.checked,i=t.getAttribute("x"),o=1<<Number(i);let n=this.collisionMatrix[i];e?(r|=o,n|=s):(r&=~o,n&=~s),this.$set(this.collisionMatrix,i,n)}),this.$set(this.collisionMatrix,i,r),Editor.Profile.setProject("project","physics.collisionMatrix",this.collisionMatrix)},startEdit(t){const e=t.path.find(t=>"TR"===t.tagName);e&&(this.stateIndex=Number(e.getAttribute("y")),this.state="edit",this.$nextTick(()=>{e.after(this.$refs.errorRow)}))},cancelEdit(){this.state="",this.error=""},async saveEdit(t){const e=t.path.find(t=>"TR"===t.tagName);if(!e)return;const i=e.getElementsByClassName("name")[0].value;let s=!0;if(this.groups.forEach(t=>{i&&i!==t.name||(s=!1)}),!s)return void(this.error=this.t("project.physics.edit.error"));this.groups.forEach(t=>{t.index===this.stateIndex&&(t.name=i)});const r=this.groups.filter(t=>t.index>0).sort((t,e)=>t.index-e.index);await Editor.Profile.setProject("project","physics.collisionGroups",r),this.cancelAdd(),this.refresh(),Editor.Message.send("scene","project:update-physics-group")},startAdd(){this.state="add",this.$nextTick(()=>{const t=this.$refs.addRow;t&&t.after(this.$refs.errorRow)})},cancelAdd(){this.state="",this.error=""},async saveAdd(){const t=this.$refs.addIndex,e=this.$refs.addName;if(!t||!e)return;const i=t.value,s=e.value.trim();let r=!0;if(this.groups.forEach(t=>{(i<=0||i>=32||i===t.index)&&(r=!1),s&&s!==t.name||(r=!1)}),!r)return void(this.error=this.t("project.physics.add.error"));const o=this.groups.concat([{index:i,name:s}]).filter(t=>t.index>0).sort((t,e)=>t.index-e.index);await Editor.Profile.setProject("project","physics.collisionGroups",o),this.cancelAdd(),this.refresh(),Editor.Message.send("scene","project:update-physics-group")},async deleteIndex(t){let e=null,i=null;for(let s=0;s<this.groups.length;s++){const r=this.groups[s];if(r.index===t){e=r,i=s;break}}if(!e||!i)return;const s=this.t("project.physics.delete.warn").replace("${index}",e.index).replace("${name}",e.name);if(1===(await Editor.Dialog.warn(s,{title:this.t("project.delete"),buttons:[this.t("project.delete"),this.t("project.cancel")]})).response)return;delete this.groups[i];const r=this.groups.filter(t=>t.index>0).sort((t,e)=>t.index-e.index);Editor.Profile.setProject("project","physics.collisionGroups",r),this.refresh()},addIndexValue(){let t=-1;for(const e of this.groups)e.index>t&&(t=e.index);return t+1}},template:vueTemplate});function ready(){var t;null===(t=this.vm)||void 0===t||t.$destroy(),this.vm=new ProjectPhysicsVM,this.vm.$mount(this.$.container)}async function exportConfig(){const t={};return t["physics.collisionMatrix"]=await Editor.Message.request("project","query-config","project","physics.collisionMatrix")||{},t["physics.collisionGroups"]=await Editor.Message.request("project","query-config","project","physics.collisionGroups")||[],t}async function importConfig(t){t["physics.collisionMatrix"]&&await Editor.Message.request("project","set-config","project","physics.collisionMatrix",t["physics.collisionMatrix"]),t["physics.collisionGroups"]&&await Editor.Message.request("project","set-config","project","physics.collisionGroups",t["physics.collisionGroups"])}function close(){var t;null===(t=this.vm)||void 0===t||t.$destroy(),this.vm=null}exports.style='\n.config { display: grid; }\n.config >.table { width: 100%; }\n.config >.table .td { text-align: center; }\n\n.config >.table .td.mini { width: 40px; }\n.config >.table .td.name { width: 130px; }\n.config >.table .td.operation { width: 80px; text-align: left; }\n\n.config >.table .td .input { vertical-align: inherit; width: 100%; }\n.config >.table .td.error { text-align: left; color: var(--color-danger-fill-weaker); }\n.config >.table .td ui-button[type="icon"] { margin: 0 2px; }\n.config >.table .gray { color: var(--color-normal-contrast-emphasis); }\n.config >.table .td.first { text-align: left; }\n.config >.table .td.first .add { width: 200px; margin: 10px 0; }\n.config >.table .td.first .add > .icon { margin-right: 8px; }\n.config .transform { writing-mode: tb; }\n',exports.template='<div class="container"></div>',exports.$={container:".container"},exports.ready=ready,exports.exportConfig=exportConfig,exports.importConfig=importConfig,exports.close=close;