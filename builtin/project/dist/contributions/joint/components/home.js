"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProjectJointHomeVM=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static/contributions/joint/index.html"),"utf8");exports.ProjectJointHomeVM=Vue.extend({name:"ProjectJointHomeVM",components:{layout:require("./layout")},data:()=>({joint:null,layouts:[],timeId:null,info:"Valid on all devices",blocks:[],renameIndex:-1,animation:0,size:0,pixels:0,doc:Editor.Utils.Url.getDocUrl("animation/joint-texture-layout.html")}),watch:{layouts:{deep:!0,handler(){this.save()}},blocks(){const t=this;t.animation=0,t.size=0,t.pixels=0,t.blocks.forEach(e=>{t.pixels+=e.pixels}),t.size=12*Math.ceil(Math.sqrt(t.pixels)/12)},size(t){const e=this;e.joint&&(e.joint.textureLength=t,e.info=t<1024?"Valid on all devices":t<2048?"May exceeds max texture size limit on devices with no float texture support":"May exceeds max texture size limit on many mobile devices")}},async mounted(){this.layouts=await Editor.Profile.getProject("project","custom_joint_texture_layouts")||[],this.joint=this.layouts[0]},methods:{getName(t){return this.layouts[t].name||`Texture - ${t}`},async removeLayout(t){const e=this,o=e.layouts[t];if(!o)return;let i=Editor.I18n.t("project.joint.removeTextureWarn");i=i.replace("${name}",e.getName(t)),1!==(await Editor.Dialog.warn(i,{buttons:["Yes","Cancel"],default:0,cancel:1,title:Editor.I18n.t("project.remove")})).response&&(o===e.joint&&(e.joint=null),e.layouts.splice(t,1))},renameStart(t){const e=this;e.renameIndex!==t&&(e.renameIndex=t,e.$nextTick(()=>{const o=e.$refs.renameInput;if(!o)return;const i=o[t];i&&(i.value=e.getName(t),i.focus())}))},renameConfirm(t){const e=t.target.value,o=this.layouts[this.renameIndex];this.renameIndex=-1,e&&o.name!==e&&(o.name=e)},removeContent(t){const e=this;e.joint&&e.joint.contents.splice(t,1)},addLayout(){const t=`Texture - ${this.layouts.length}`;this.layouts.push({name:t,textureLength:0,contents:[]})},addContent(){this.joint&&this.joint.contents.push({skeleton:"",clips:[]})},save(){const t=this;null===t.timeId&&(t.timeId=setTimeout(()=>{t.timeId=null,Editor.Profile.setProject("project","custom_joint_texture_layouts",JSON.parse(JSON.stringify(t.layouts)))},400))}},template:template});