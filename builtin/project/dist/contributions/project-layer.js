"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.importConfig=exports.exportConfig=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/general-layer.html"),"utf8"),ProjectLayerVM=Vue.extend({name:"ProjectLayerVM",data:()=>({layers:[],userLayers:[],builtinLayers:[]}),mounted(){this.refresh()},methods:{async refresh(){try{this.builtinLayers=await Editor.Message.request("scene","query-layer-builtin")}catch(e){console.error(e),this.builtinLayers=[]}let e=await Editor.Profile.getProject("project","layer");e&&Array.isArray(e)||(e=[]),this.userLayers=e,e.length>20&&(this.userLayers=e.splice(0,20),Editor.Profile.setProject("project","layer",this.userLayers));const t=this.userLayers.concat(this.builtinLayers),r=[];for(let e=0;e<32;e++){const s=1<<e;let i=t.find(e=>e.value===s);i||(i={name:"",value:s}),i.label=e>=20?`Builtin Layer ${e}`:`User Layer ${e}`,r[e]=i}this.layers=r,this.layers.sort((e,t)=>e.index-t.index)},async _onSettingsConfirm(e,t){if(t>=20)return;const r=e.target,s=r.value.trim(),i=1<<t,o=this.userLayers.find(e=>e.value===i);if(!s&&!o)return;if(s&&this.layers.find(e=>e.name===s))return requestAnimationFrame(()=>{r.value=this.layers[t].name}),void console.warn(Editor.I18n.t("project.layers.warnInvalidName1",{name:s}));const a=parseInt(s);if("number"==typeof a&&!isNaN(a))for(let e=0;e<32;e++)if(a===1<<e)return requestAnimationFrame(()=>{r.value=this.layers[t].name}),void console.warn(Editor.I18n.t("project.layers.warnInvalidName2",{name:a}));if(s)o?o.name=s:this.userLayers.push({name:s,value:i});else{const e=this.userLayers.findIndex(e=>e.value===i);this.userLayers.splice(e,1)}const n=this.userLayers.map(e=>({name:e.name,value:e.value}));await Editor.Profile.setProject("project","layer",n),await this.refresh(),Editor.Message.broadcast("project:setting-change","layers")}},template:vueTemplate});async function exportConfig(){const e={};return e.layer=await Editor.Message.request("project","query-config","project","layer")||[],e}async function importConfig(e){e.layer&&await Editor.Message.request("project","set-config","project","layer",e.layer)}function ready(){var e;null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=new ProjectLayerVM,this.vm.$mount(this.$.container)}function close(){var e;null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=null}exports.style="\n.layer > .info { margin-bottom: 1em; }\n.content > ui-prop { margin-bottom: 4px; padding-left: 24px; }\n.content > ui-prop > ui-input { flex: 1; }\n.content > ui-prop { --left-width: 40%; padding: 2px 0; }\n.layer { height: 100%; padding-bottom: 40px; box-sizing: border-box;display: flex; flex-direction: column;}\n.content { overflow: auto; flex:1; }\n",exports.template='<div class="container"></div>',exports.$={container:".container"},exports.exportConfig=exportConfig,exports.importConfig=importConfig,exports.ready=ready,exports.close=close;