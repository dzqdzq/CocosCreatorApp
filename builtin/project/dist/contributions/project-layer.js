"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.importConfig=exports.exportConfig=exports.methods=exports.template=exports.$=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");exports.style="\n.layer > .info { margin-bottom: 1em; }\n.layer > ui-prop { margin-bottom: 4px; padding-left: 24px; }\n.layer > ui-prop > ui-input { flex: 1; }\n",exports.$={layer:".layer"},exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/general-layer.html"),"utf8");const component={data:{layers:[],userLayers:[],builtinLayers:[]},methods:{async refresh(){const e=this;try{e.builtinLayers=await Editor.Message.request("scene","query-layer-builtin")}catch(r){console.error(r),e.builtinLayers=[]}let r=await Editor.Profile.getProject("project","layer");r&&Array.isArray(r)||(r=[]),e.userLayers=r,r.length>20&&(e.userLayers=r.splice(0,20),Editor.Profile.setProject("project","layer",e.userLayers));const t=e.userLayers.concat(e.builtinLayers),a=[];for(let e=0;e<32;e++){const r=1<<e;let s=t.find(e=>e.value===r);s||(s={name:"",value:r}),s.label=e>=20?`Builtin Layer ${e}`:`User Layer ${e}`,a[e]=s}e.layers=a,e.layers.sort((e,r)=>e.index-r.index)},async _onSettingsConfirm(e,r){const t=this;if(r>=20)return;const a=e.target,s=a.value.trim(),o=1<<r,n=t.userLayers.find(e=>e.value===o);if(!s&&!n)return;if(s&&t.layers.find(e=>e.name===s))return requestAnimationFrame(()=>{a.value=t.layers[r].name}),void console.warn(Editor.I18n.t("project.layers.warnInvalidName1",{name:s}));const i=parseInt(s);if("number"==typeof i&&!isNaN(i))for(let e=0;e<32;e++)if(i===1<<e)return requestAnimationFrame(()=>{a.value=t.layers[r].name}),void console.warn(Editor.I18n.t("project.layers.warnInvalidName2",{name:i}));if(s)n?n.name=s:t.userLayers.push({name:s,value:o});else{const e=t.userLayers.findIndex(e=>e.value===o);t.userLayers.splice(e,1)}const l=t.userLayers.map(e=>({name:e.name,value:e.value}));await Editor.Profile.setProject("project","layer",l),await this.refresh(),Editor.Message.broadcast("project:setting-change","layers")}}};async function exportConfig(){const e={};return e.layer=await Editor.Message.request("project","query-config","project","layer")||[],e}async function importConfig(e){e.layer&&await Editor.Message.request("project","set-config","project","layer",e.layer)}function ready(){component.el=this.$.layer,new Vue(component).refresh()}exports.methods={},exports.exportConfig=exportConfig,exports.importConfig=importConfig,exports.ready=ready;