"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.importConfig=exports.exportConfig=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js");let panel=null,vm=null;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/project-general.html"),"utf8"),ProjectGeneralVM=Vue.extend({name:"ProjectGeneralVM",data:()=>({renderPipeline:null,renderPipelines:[],defaultScene:""}),async mounted(){const e=await Editor.Profile.getProject("project","general.renderPipeline");this.renderPipeline=e;const t=await Editor.Profile.getProject("scene","current-scene");this.defaultScene=t;const r=await Editor.Package.getPackages({name:"asset-db",enable:!0});r&&r[0]||await new Promise(e=>{setTimeout(e,1e4)});const n=await Editor.Profile.getConfig("engine","deferred_pipeline");let i=await Editor.Message.request("asset-db","query-assets",{pattern:"db://**/*.rpp"});if(Array.isArray(i)||(i=[]),!n&&(i=i.filter(e=>"5d45ba66-829a-46d3-948e-2ed3fa7ee421"!==e.uuid),"5d45ba66-829a-46d3-948e-2ed3fa7ee421"===this.renderPipeline)){await Editor.Profile.removeProject("project","general.renderPipeline","project");const e=await Editor.Profile.getProject("project","general.renderPipeline");this.renderPipeline=e}const o=await Promise.all(i.map(e=>new Promise(t=>{Editor.Message.request("asset-db","query-asset-meta",e.uuid).then(t).catch(()=>{t(null)})})));this.renderPipelines=i.map((e,t)=>{const r=o[t];return{uuid:e.uuid,name:e.name,contributed:r&&r.userData&&r.userData.contributed?r.userData.contributed:""}})},methods:{renderPipelineChanged(e){Editor.Profile.setProject("project","general.renderPipeline",e.target.value)},defaultSceneChanged(e){Editor.Profile.setProject("scene","current-scene",e.target.value)}},template:vueTemplate});async function exportConfig(){const e={};return e["general.renderPipeline"]=await Editor.Message.request("project","query-config","project","general.renderPipeline")||"",e}async function importConfig(e){e["general.renderPipeline"]&&await Editor.Message.request("project","set-config","project","general.renderPipeline",e["general.renderPipeline"])}function ready(){panel=this,null===vm||void 0===vm||vm.$destroy(),(vm=new ProjectGeneralVM).$mount(panel.$.container)}function close(){null===vm||void 0===vm||vm.$destroy(),vm=null,panel=null}exports.style="\n.general > ui-prop { --left-width: 40%; padding: 2px 0; }\n",exports.template='<div class="container"></div>',exports.$={container:".container"},exports.exportConfig=exportConfig,exports.importConfig=importConfig,exports.ready=ready,exports.close=close;