"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProjectSettingsHomeVM=void 0;const fs_1=require("fs"),path_1=require("path"),lodash_1=require("lodash"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/settings/index.html"),"utf8");exports.ProjectSettingsHomeVM=Vue.extend({name:"ProjectSettingsHomeVM",data:()=>({tab:"project",subTab:"general",configs:{},args:[],dbReady:!1}),computed:{alignCustomPanelFollowContent(){return!!((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"content"])&&Object.keys((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"content"])).length>0)},hasSlider(){return!!this.configs&&!!Object.keys(this.configs).length},hasContent(){const{configs:t,tab:e,subTab:s}=this;return t&&t[e]&&t[e].tabs[s]&&(t[e].tabs[s].content||t[e].tabs[s].custom)}},watch:{subTab(){this.handleCustomConfig()},dbReady(t){t&&this.handleCustomConfig()}},async mounted(){await Promise.all([this.refreshPackagesConfigs(),this._queryDbStatus()]),Editor.Message.__protected__.addBroadcastListener("project:packages-changed",this.refreshPackagesConfigs)},beforeDestroy(){Editor.Message.__protected__.removeBroadcastListener("project:packages-changed",this.refreshPackagesConfigs)},methods:{changeTab(t,e){this.tab=t,this.subTab=e},getRenderText:(t,e)=>(t.attributes=t.attributes||{},t.attributes.path=e,JSON.stringify(t)),t:t=>"string"!=typeof t?"":(t=t.replace("i18n:",""),Editor.I18n.t(t)||t),popup(t,e,s){this.tab&&Editor.Menu.popup({x:t,y:e,menu:[{label:Editor.I18n.t("project.menu.copyConfigKey"),click:()=>{const t=`'${this.tab}', '${s}'`;Editor.Clipboard.write("text",t)}},{label:Editor.I18n.t("project.menu.copyTabKey"),click:()=>{const t=`'${this.tab}', '${this.subTab}'`;Editor.Clipboard.write("text",t)}}]})},async refreshPackagesConfigs(){this.configs=await Editor.Message.request("project","query-project-configs"),this.configs&&this.configs[this.tab]&&this.configs[this.tab].tabs[this.subTab]||(this.tab="project",this.subTab="general")},handleCustomConfig(){if((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"custom"])){const t=Editor.Module.__protected__.requireFile((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"custom"])),e=document.createElement("ui-panel"),s={};t&&(Object.keys(t).forEach(e=>{s[e]=t[e]}),t.ready&&(s.ready=(()=>(e.ready=!0,t.ready.call(e.panelObject,...this.args))))),e.config=s,this.$nextTick(()=>{const t=this.$refs[`${this.tab}-${this.subTab}`];t&&(t.innerHTML="",t.appendChild(e))})}},async _queryDbStatus(){await Editor.Message.request("asset-db","query-ready")&&(this.dbReady=!0)}},template:template});