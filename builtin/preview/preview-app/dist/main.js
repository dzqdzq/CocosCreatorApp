System.register([],function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};t&&t.id;return e("main",function(e,s){var o;return n(this,void 0,void 0,function(){var n,i,a,c,u,l,d,m,h,f,g,p,v,w,y,E,b,S,L,x;return r(this,function(_){switch(_.label){case 0:return[4,System.import("cc")];case 1:if((n=_.sent()).macro.ENABLE_WEBGL_ANTIALIAS=!0,s.settings.macros)for(i in s.settings.macros)n.macro[i]=s.settings.macros[i];if(window.CC_WECHATGAME=!1,a={importBase:"assets/general/import",nativeBase:"assets/general/native"},k=document.querySelector("#GameDiv"),A=document.querySelector("#Cocos3dGameContainer"),(M=document.querySelector("#GameCanvas")).setAttribute("tabindex","99"),!(c={frame:k,container:A,canvas:M}))throw new Error(n.getError(200));u=null!==(o=n.DebugMode[e.debugMode])&&void 0!==o?o:n.DebugMode.INFO,l={id:e.gameCanvas,showFPS:e.showFps,debugMode:u,frameRate:e.frameRate,groupList:s.settings.groupList,collisionMatrix:s.settings.collisionMatrix,adapter:c,renderPipeline:s.settings.renderPipeline,assetOptions:a,customJointTextureLayouts:s.settings.customJointTextureLayouts||[],physics:s.settings.physics,exactFitScreen:!1},e.isFullscreen()&&(l.exactFitScreen=!0),d=(s.settings.jsList||[]).map(function(e){return"/plugins/"+e}),m=function(t){return r(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n,r){var s;function o(e){e.filename===t&&(s=e.error)}window.addEventListener("error",o);var i=document.createElement("script");i.charset="utf-8",i.async=!0,i.crossOrigin="anonymous",i.addEventListener("error",function(){window.removeEventListener("error",o);var n=Error("Error loading "+t);e.showError(n.message),n.stack&&e.showError(n.stack),console.error(n),r(n)}),i.addEventListener("load",function(){window.removeEventListener("error",o),document.head.removeChild(i),s?r(s):n()}),i.src=t.replace("#","%23"),document.head.appendChild(i)})];case 1:return n.sent(),[2]}})},h=0,f=d,_.label=2;case 2:return h<f.length?(g=f[h],[5,m(g)]):[3,5];case 3:_.sent(),_.label=4;case 4:return h++,[3,2];case 5:return[4,n.game.init(l)];case 6:_.sent();try{s.settings.customLayers&&s.settings.customLayers.forEach(function(e){n.Layers.addLayer(e.name,e.bit)})}catch(e){console.warn(e)}return[4,t.import("./init-loader.js")];case 7:return _.sent(),[4,t.import("cce:/internal/x/prerequisite-imports")];case 8:_.sent(),p=n.AssetManager.BuiltinBundleName,v=p.RESOURCES,w=p.MAIN,y=s.settings.hasResourcesBundle?[v,w]:[w],E=function(t){return r(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,s){n.assetManager.loadBundle(t,function(t){t?(e.showError(t.message),t.stack&&e.showError(t.stack),console.error(t),s(t)):r()})})];case 1:return r.sent(),[2]}})},b=0,S=y,_.label=9;case 9:return b<S.length?(L=S[b],[5,E(L)]):[3,12];case 10:_.sent(),_.label=11;case 11:return b++,[3,9];case 12:return[4,(C=s.settings.launchScene,new Promise(function(e,t){var n=new XMLHttpRequest;n.responseType="text",n.addEventListener("load",function(){200===n.status&&e(JSON.parse(n.response))}),n.open("GET","scene/"+C+".json",!0),n.send()}))];case 13:return x=_.sent(),[4,n.game.run(function(){n.game.canvas.setAttribute("tabindex",-1),n.game.canvas.style.backgroundColor="",n.director.once(n.Director.EVENT_AFTER_SCENE_LAUNCH,function(){e.hideSplash(),function(e){var t=e.director.getScene();if(t&&0!==t.children.length){if(t.children.length>1)return!1;var n=t.children[0];return!(n.children.length>0||n._components.length>1||n._components.length>0&&!(n._components[0]instanceof e.Canvas))}return!0}(n)&&e.hintEmptyScene()}),n.view.resizeWithBrowserSize(!0);var t=s.settings.designResolution,r=t.width,o=t.height,i=t.policy;n.view.setDesignResolutionSize(Number(r),Number(o),i||n.ResolutionPolicy.FIXED_HEIGHT),n.game.pause(),n.assetManager.loadWithJson(x,{assetId:s.settings.launchScene},function(t,n){var r=100*t/n*.6;e.reportLoadProgress(r)},function(t,r){if(t)return e.showError(t.message),t.stack&&e.showError(t.stack),void n.error(t.stack);var s=r.scene;s._name=r._name,n.director.runSceneImmediate(s,function(){n.game.resume()})})})];case 14:return _.sent(),[4,new Promise(function(e){setTimeout(e,100)})];case 15:return _.sent(),[2]}var C,k,A,M})})}),{setters:[],execute:function(){}}});