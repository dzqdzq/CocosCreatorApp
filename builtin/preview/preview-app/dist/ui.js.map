{"version":3,"file":"ui.js","sourceRoot":"","sources":["../src/ui.ts"],"names":[],"mappings":"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","sourcesContent":["import { globals } from './app-globals.js';\nimport { bootstrap } from './index.js';\n\nexport class Ui {\n    constructor(options: Ui.Options) {\n        this._devices = options.devices;\n        this._emit = options.emit;\n        this._checkMobile();\n\n        this._query = document.querySelector.bind(document);\n        this._canvas = this._queryChecked('#GameCanvas');\n        this._toolbar = this._queryChecked('.toolbar');\n        this._footer = this._queryChecked('.footer');\n        this._select = this._queryChecked('#opts-device');\n        this._optsDebugMode = this._queryChecked('#opts-debug-mode');\n        this._rotateButton = this._queryChecked('#btn-rotate');\n        this._pauseButton = this._queryChecked('#btn-pause');\n        this._stepButton = this._queryChecked('#btn-step');\n        this._stepLengthWrap = this._queryChecked('#step-length');\n        this._stepLength = this._stepLengthWrap.querySelector('input')!;\n        this._showFpsButton = this._queryChecked('#btn-show-fps');\n        this._setFpsInput = this._queryChecked('#input-set-fps');\n        this._progressBar = this._queryChecked('#splash .progress-bar span');\n\n        // ??\n        // select 标签的初始化\n        this._select.value = this._select.getAttribute('value')!;\n        this._optsDebugMode.value = this._optsDebugMode.getAttribute('value')!;\n        this._rotated = (this._rotateButton.className === 'checked');\n    }\n\n    get gameCanvas() {\n        return this._canvas;\n    }\n\n    get showFps() {\n        return this._showFpsButton.className === 'checked';\n    }\n\n    get isShowError() {\n        return this.debugMode !== 'NONE';\n    }\n\n    get debugMode() {\n        return this._optsDebugMode.value;\n    }\n\n    get frameRate() {\n        return parseInt(this._setFpsInput.value, 10);\n    }\n\n    private _errorMsg = '';\n\n    /**\n     * Get layout size and show loading.\n     */\n    public showLoading(flag?: boolean) {\n        if (globals.error) {\n            return;\n        }\n\n        if (!this._splash) {\n            const LOGO_IMG_L_W = 416;\n            const LOGO_IMG_L_H = 87;\n            const LOGO_SIZE = 0.4;\n\n            let { width: widthInCssPixels, height: heightInCssPixels } = this._getEmulatedScreenSize();\n            this._splash = this._queryChecked<HTMLElement>('#splash');\n            const gameContainer = this._queryChecked<HTMLElement>('#GameDiv');\n            widthInCssPixels = Math.min(widthInCssPixels, screen.width);\n            heightInCssPixels = Math.min(heightInCssPixels, screen.height);\n            this._splash.style.width = `${widthInCssPixels}px`;\n            this._splash.style.height = `${heightInCssPixels}px`;\n            this._splash.style.display = '';\n            this._progressBar.style.width = '0%';\n            let marginTop;\n            if (this._splash.style.width < this._splash.style.height) {\n                this._splash.style.backgroundImage = `url(\"./../splash_portrait.png\")`;\n                this._splash.style.backgroundSize = '30%';\n                marginTop = (heightInCssPixels - widthInCssPixels * (1 - LOGO_SIZE)) / 2;\n            } else {\n                const logoDisplayH = widthInCssPixels * LOGO_SIZE / LOGO_IMG_L_W * LOGO_IMG_L_H;\n                marginTop = logoDisplayH / 2 * 1.47;\n            }\n            this._progressBar.parentElement!.style.marginTop = marginTop + 'px';\n            if (gameContainer) {\n                gameContainer.style.visibility = 'visible';\n            }\n        } else {\n            if (flag) {\n                this._splash.style.display = '';\n            } else {\n                this._splash.style.display = 'none';\n            }\n        }\n    }\n\n    public setWindowSize(cc: any) {\n        const dpr = window.devicePixelRatio;\n        if (!this.isFullscreen()) {\n            const sizeInCssPixels = this._getEmulatedScreenSize();\n            cc.screen.windowSize = new cc.Size(sizeInCssPixels.width * dpr, sizeInCssPixels.height * dpr);\n        }\n    }\n\n    private _updateToolBarVisibility() {\n        if (this.isFullscreen()) {\n            toggleElementClass(this._toolbar, 'hide', true);\n            toggleElementClass(this._footer, 'hide', true);\n        } else {\n            toggleElementClass(this._toolbar, 'hide', false);\n            toggleElementClass(this._footer, 'hide', false);\n        }\n    }\n\n    /**\n     * @param message 显示加载错误\n     */\n    public showError(message: string) {\n        this._queryChecked<HTMLElement>('#error .error-main').innerText += message;\n        message = '[Preview]' + message;\n        this._emit('preview error', message);\n        this._errorMsg = message;\n        if (!this.isShowError) {\n            return;\n        }\n        this._queryChecked<HTMLElement>('#splash').style.display = 'none';\n        this._queryChecked<HTMLElement>('#error').style.display = 'block';\n    }\n\n    public hideSplash() {\n        if (this._splash) {\n            this._splash.style.display = 'none';\n        }\n    }\n\n    public hintEmptyScene() {\n        this._queryChecked<HTMLElement>('#bulletin').style.display = 'block';\n        this._queryChecked<HTMLElement>('#sceneIsEmpty').style.display = 'block';\n    }\n\n    public bindEngine(cc: any) {\n        window.addEventListener('resize', () => {\n            this._updateToolBarVisibility();\n        });\n        this._rotateButton.addEventListener('click', () => {\n            this._rotated = !this._rotated;\n            toggleElementClass(this._rotateButton, 'checked');\n            this.setWindowSize(cc);\n            window.dispatchEvent(new Event('orientationchange'));\n            this._emit('changeOption', 'rotate', this._rotated);\n        });\n\n        this._select.addEventListener('change', (event) => {\n            this.setWindowSize(cc);\n            window.dispatchEvent(new Event('resize'));\n            // @ts-ignore\n            this._emit('changeOption', 'device', event.target.value);\n        });\n\n        // init show fps, true by default\n        this._showFpsButton.addEventListener('click', () => {\n            const show = !(cc.isDisplayStats());\n            cc.setDisplayStats(show);\n            toggleElementClass(this._showFpsButton, 'checked');\n            this._emit('changeOption', 'showFps', show);\n        });\n\n        // init pause button\n        this._pauseButton.addEventListener('click', () => {\n            const shouldPause = !cc.game.isPaused();\n            if (shouldPause) {\n                cc.game.pause();\n            } else {\n                cc.game.resume();\n            }\n            toggleElementClass(this._pauseButton, 'checked');\n            toggleElementClass(this._stepButton, 'show');\n            this._stepLength.value = cc.game.frameTime;\n            toggleElementClass(this._stepLengthWrap, 'show');\n        });\n\n        // Debug mode.\n        this._optsDebugMode.addEventListener('change', (event) => {\n            // @ts-ignore\n            const value = event!.target!.value;\n            const debugMode = cc.DebugMode[value] ?? cc.DebugMode.INFO;\n            if (debugMode === cc.DebugMode.NONE || !this._errorMsg) {\n                this._queryChecked<HTMLElement>('#error').style.display = 'none';\n            } else {\n                this._queryChecked<HTMLElement>('#error').style.display = 'block';\n            }\n            // @ts-ignore\n            window.cc.debug._resetDebugSetting(debugMode);\n            this._emit('changeOption', 'debugMode', value);\n        });\n\n        // Set FPS.\n        this._setFpsInput.addEventListener('change', (event) => {\n            let fps = parseInt(this._setFpsInput.value, 10);\n            if (isNaN(fps)) {\n                fps = 60;\n                this._setFpsInput.value = fps.toString();\n            }\n            cc.game.setFrameRate(fps);\n        });\n\n        // Set step length.\n        this._stepLength.addEventListener('change', (event: any) => {\n            const stepLen = parseInt(event.target.value, 10);\n            if (isNaN(stepLen)) {\n                event.target.value = cc.game.frameTime;\n                return;\n            }\n            cc.game.frameTime = stepLen;\n        });\n\n        // When click step button, game is stepped.\n        this._stepButton.addEventListener('click', () => {\n            cc.game.step();\n        });\n        // enable toolbar\n        toggleElementClass(this._toolbar, 'disabled', false);\n\n        // 初始化引擎\n        this.setWindowSize(cc);\n        this._updateToolBarVisibility();\n        this.showLoading();\n    }\n\n    /**\n     * @param progress 进度值，[0, 100]\n     */\n    public reportLoadProgress(progress: number) {\n        this._progressBar.style.width = progress.toFixed(2) + '%';\n    }\n\n    private _queryChecked<E extends Element = Element>(selectors: string): E {\n        const element = this._query<E>(selectors);\n        if (!element) {\n            throw new Error(`UI element ${selectors} doesn't exist.`);\n        } else {\n            return element;\n        }\n    }\n\n    /**\n     * 获取当前设备 size\n     */\n    public getRotatedCurrentSize() {\n        // 当前分辨率为非自定义\n        const width = this._devices[this._select.value] && this._devices[this._select.value].width || 960;\n        const height = this._devices[this._select.value] && this._devices[this._select.value].height || 640;\n        return this._rotated ? { height: width, width: height } : { width, height };\n    }\n\n    /**\n     * Get emulated screen size.\n     * Return the size in css pixels.\n     */\n    private _getEmulatedScreenSize() {\n        if (this.isFullscreen()) {\n            const { width, height } = screen;\n            return this._rotated ? { height: width, width: height } : { width, height };\n        }\n        return this.getRotatedCurrentSize();\n    }\n\n    public isFullscreen() {\n        if (this._isMobile) {\n            return true;\n        }\n        return !!document.fullscreenElement;\n    }\n\n    private _checkMobile() {\n        // @ts-ignore\n        const nav = navigator.userAgent || navigator.vendor || window.opera;\n        if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(nav) ||\n            /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(nav.substr(0, 4))) {\n            this._isMobile = true;\n        }\n        else {\n            this._isMobile = false;\n        }\n    }\n\n    private _query: Query;\n    private _toolbar: HTMLElement;\n    private _canvas: HTMLCanvasElement;\n    private _footer: HTMLElement;\n    private _select: HTMLSelectElement;\n    private _optsDebugMode: HTMLSelectElement;\n    private _rotateButton: HTMLButtonElement;\n    private _pauseButton: HTMLButtonElement;\n    private _stepButton: HTMLButtonElement;\n    private _stepLengthWrap: HTMLDivElement;\n    private _stepLength: HTMLInputElement;\n    private _showFpsButton: HTMLButtonElement;\n    private _setFpsInput: HTMLInputElement;\n    private _progressBar: HTMLElement;\n    private _splash?: HTMLElement;\n    private _gameContainer?: HTMLElement;\n    private _rotated: boolean;\n    private _devices: Ui.Options['devices'];\n    private _emit: Ui.Options['emit'];\n    private _isMobile: boolean = false;\n}\n\nexport declare namespace Ui {\n    export interface Options {\n        devices: bootstrap.Options['devices'];\n        emit(event: string, ...args: any[]): void;\n    }\n}\n\ntype Query = {\n    <K extends keyof HTMLElementTagNameMap>(selectors: K): HTMLElementTagNameMap[K] | null;\n    <K extends keyof SVGElementTagNameMap>(selectors: K): SVGElementTagNameMap[K] | null;\n    <E extends Element = Element>(selectors: string): E | null;\n};\n\nfunction toggleElementClass(element: HTMLElement, className: string, add?: boolean) {\n    const isAdd = add === undefined ? !element.classList.contains(className) : add;\n    if (isAdd) {\n        element.classList.add(className);\n    } else {\n        element.classList.remove(className);\n    }\n}\n"]}