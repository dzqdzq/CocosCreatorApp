const{basename:basename,join:join,extname:extname}=require("path"),{copyFileSync:copyFileSync,ensureDir:ensureDir,outputFileSync:outputFileSync}=require("fs-extra"),{EventEmitter:EventEmitter}=require("events"),TEMP_PATH=join(Editor.Project.path,"temp"),DB_PROTOCOL_HEADER="db://";async function getEnginInfo(){return await Editor.Message.request("engine","query-engine-info")}function getRightUrl(e){if(!e.startsWith(DB_PROTOCOL_HEADER))return console.error("unknown path to build: "+e),e;let t=e.slice(DB_PROTOCOL_HEADER.length);return t||(console.error("unknown mount to build: "+e),null)}async function writScripts(){const e=await Editor.Message.request("asset-db","query-assets",{ccType:"cc.Script"});let t=join(TEMP_PATH,"/quick-scripts");ensureDir(join(t,"assets"));for(let n=0;n<e.length;n++){let r=e[n],i=getRightUrl(r.source),s=extname(i),o=basename(i,s),a=basename(r.library[".js"]).replace(r.uuid,o),u=basename(r.library[".js.map"]).replace(r.uuid,o),c=getModules(i);outputFileSync(join(t,"assets",a),c),copyFileSync(r.library[".js.map"],join(t,"assets",u))}return t}module.exports={getEnginInfo:getEnginInfo,writScripts:writScripts};