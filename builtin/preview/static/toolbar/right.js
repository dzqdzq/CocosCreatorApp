"use strict";const qrcode=require("qrcode");let previewIp="",previewPort="";exports.style="\n:host {\n    display: flex;\n}\n\n.preview-server {\n    margin: 0 5px;\n}\n\n.preview-server > div {\n    font-size: 13px;\n    color: var(--color-normal-contrast);\n}\n\n.preview-server > div > svg {\n    width: 12px;\n}\n\n.preview-server > div > div {\n    display: flex;\n    position: absolute;\n    background: white;\n    z-index: 999;\n    top: 30px;\n    flex-direction: column;\n    padding: 3px;\n    border-radius: calc(var(--size-normal-radius) * 1px);\n    opacity: 0;\n    transition: opacity 0.2s;\n    pointer-events: none;\n}\n\n.preview-server > div > div[active] {\n    opacity: 1;\n    pointer-events: all;\n}\n\n.preview-server > div > div > canvas {\n    width: 120px;\n    height: 120px;\n    margin: 5px;\n}\n\n.preview-server ui-label {\n    color: var(--color-normal-fill);\n}\n\n@media all and (max-width: 860px) {\n    .preview-server > div > .address {\n        display: none;\n    }\n}\n",exports.template='\n<div class="preview-server">\n    <div class="content">\n        <span class="address"></span>\n        <ui-icon value="qr-code"></ui-icon>\n        <div class="qr">\n            <canvas class="canvas"></canvas>\n            <ui-label value="i18n:preview.scan"></ui-label>\n        </div>\n    </div>\n</div>\n',exports.$={content:".content",address:".address",number:".number",canvas:".canvas",qr:".qr"},exports.methods={updateAddress(){this.address=`${previewIp}:${previewPort}`,this.$.address.innerHTML=this.address,qrcode.toCanvas(this.$.canvas,`http://${this.address}/`,{errorCorrectionLevel:"H",maskPattern:2,margin:1,width:120,height:120})},async updateIp(){previewPort=await Editor.Message.request("server","query-port"),previewIp=await Editor.Message.request("preview","get-preview-ip"),this.updateAddress()}},exports.ready=async function(){this.number=0,await this.updateIp(),this.$.content.addEventListener("mouseenter",async()=>{await this.updateIp(),this.$.qr.setAttribute("active","")}),this.$.content.addEventListener("mouseleave",()=>{this.$.qr.removeAttribute("active")}),Editor.Message.addBroadcastListener("preview:port-change",e=>{previewPort=e,this.updateAddress()}),Editor.Message.addBroadcastListener("preview:ip-change",e=>{previewIp=e,this.updateAddress()})};