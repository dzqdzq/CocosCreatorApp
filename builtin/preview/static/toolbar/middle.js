"use strict";const i18n=require("@base/electron-i18n"),Vue=require("vue/dist/vue"),{basename:basename}=require("path");let vm=null;exports.style="\n:host {\n    display: flex;\n}\n\n.preview-info {\n    display: flex;\n    border-radius: 3px;\n    border: 1px solid var(--color-normal-border);\n}\n\n.preview-info > ui-button {\n    border-radius: 0;\n}\n\n.preview-info .platform {\n    position: relative;\n    overflow: visible;\n    width: 40px;\n    height: 24px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-top-left-radius: 3px;\n    border-top-right-radius: 0;\n    border-bottom-left-radius: 3px;\n    border-bottom-right-radius: 0;\n    border-right: 1px solid var(--color-normal-border);\n}\n\n.preview-info .platform .browser {\n    font-size: 15px;\n    margin-right: 10px;\n}\n\n.preview-info ul {\n    padding: 0;\n    margin: 0;\n    position: absolute;\n    z-index: 99;\n    left: -2px;\n    top: 23px;\n    width: 110px;\n    background: var(--color-normal-fill);\n    overflow: hidden;\n    border-top-right-radius: 3px;\n    border-bottom-right-radius: 3px;\n    border-bottom-left-radius: 3px;\n}\n\n.preview-info ul > li {\n    list-style: none;\n    width: 100%;\n    padding: 0 9px;\n    text-align: left;\n    box-sizing: border-box;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    cursor: pointer;\n}\n\n.preview-info ul > li:hover {\n    background: var(--color-hover-fill);\n}\n\n.preview-info ul > li:active {\n    background: var(--color-default-fill-emphasis);\n}\n\n.preview-info ul > li > ui-icon {\n    font-size: 15px;\n}\n\n.preview-info .play,\n.preview-info .pause,\n.preview-info .step {\n    border-right: 1px solid var(--color-normal-border);\n}\n\n.preview-info .play[active=true],\n.preview-info .pause[active=true],\n.preview-info .step[active=true] {\n    background: var(--color-active-fill);\n    color: var(--color-active-contrast);\n}\n\n.preview-info .scene {\n    position: relative;\n    overflow: visible;\n    width: 110px;\n    height: 24px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    text-align: left;\n    padding-left: 8px;\n    border-right: 1px solid var(--color-normal-border);\n    border-radius: 0;\n    transition: none;\n}\n.preview-info .scene ui-label {\n    display: inline-block;\n    width: 85px;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    vertical-align: middle;\n}\n.preview-info .reload ui-icon {\n    width: 20px;\n    cursor: pointer;\n}\n\n.preview-info .scene > ul {\n    width: 240px;\n    max-height: 150px;\n    overflow: auto;\n}\n\n.preview-info .scene > ul > li {\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    cursor: pointer;\n    padding-top: 4px;\n    padding-bottom: 4px;\n    line-height: 18px;\n}\n\n.preview-info .scene > ul > li:first-child {\n    border-bottom: 1px solid var(--color-hover-fill-weaker);\n}\n\n.preview-info .scene > ul > li[active] {\n    color: var(--color-active-contrast);\n}\n\n.preview-info .scene-url {\n    font-size: 11px;\n    line-height: 14px;\n    color: var(--color-normal-contrast-emphasis);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    direction: rtl;\n}\n\n.preview-info .arrow-triangle {\n    position: absolute;\n    top: 0;\n    right: 8px;\n    font-size: 12px;\n}\n\n.preview-info .sub-triangle-icon {\n    position: absolute;\n    bottom: 0;\n    right: 6px;\n    font-size: 10px;\n    line-height: 16px;\n}\n\n.preview-info .reload {\n    padding-left: 5px;\n    padding-right: 5px;\n    border-top-left-radius: 0;\n    border-top-right-radius: 3px;\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: 3px;\n}\n",exports.template='\n<div class="preview-info">\n    <ui-button class="platform transparent" \n        @click="showPlatformList"\n        @mouseleave="hidePlatformList"\n    >\n        <ui-icon class="browser"\n        :value="platformsIcon[currPlatform]"\n        ></ui-icon>\n        <ui-icon value="arrow-triangle" class="sub-triangle-icon"></ui-icon>\n        <ul v-show="isShowPlatformsList">\n            <li v-for="platform in platforms" @click.stop="changePlatform(platform)">\n                <ui-icon \n                    :value="platformsIcon[platform]"\n                ></ui-icon>\n                <ui-label \n                    :value="\'i18n:preview.\'+platform"\n                ></ui-label>\n            </li>\n        </ul>\n    </ui-button>\n    <ui-button class="play transparent" tooltip="i18n:preview.play"\n        :active="currPlatform===\'gameView\' && gameView.isPlay"\n        @click="play()"\n    >\n        <ui-icon value="play"></ui-icon>\n    </ui-button>\n    <ui-button class="pause transparent" tooltip="i18n:preview.pause"\n        v-if="currPlatform===\'gameView\'"\n        :active="currPlatform===\'gameView\' && gameView.isPaused"\n        @click="gameViewPause()"\n    >\n        <ui-icon value="pause"></ui-icon>\n    </ui-button>\n    <ui-button class="step transparent" tooltip="i18n:preview.step"\n        v-if="currPlatform===\'gameView\'" \n        @click="gameViewStep()"\n    >\n        <ui-icon value="next-play"></ui-icon>\n    </ui-button>\n    <ui-button class="scene transparent" \n        @click="showSelectList" \n        @mouseleave="hideSelectList"\n    >\n        <ui-label\n            :value="curSelectScene.name===\'\'?\'i18n:preview.current_scene\':curSelectScene.name"\n        ></ui-label>\n        <ui-icon value="arrow-triangle" class="arrow-triangle"></ui-icon>\n        <ul class="scene_list" \n            v-show="isShowSceneList"\n        >\n            <li \n                :title="curSceneUrl" \n                :active="curSelectScene.name===\'\'"\n                @click.stop="_onSettingsChanged(\'current_scene\', \'general.start_scene\', {name: \'\'})"\n            >\n                <ui-label value="i18n:preview.current_scene"></ui-label>\n            </li>\n             \n            <li v-for="scene in scenes"\n                :value="scene.uuid"\n                :title="scene.url"\n                :active="curSelectScene.url===scene.url"\n                @click.stop="_onSettingsChanged(scene.uuid, \'general.start_scene\', scene)"\n            >\n                <div class="scene-name">{{scene.name}}</div>\n                <div class="scene-url">{{scene.url}}</div>\n            </li>\n        </ul>\n    </ui-button>\n    <ui-button class="reload transparent" tooltip="i18n:preview.refresh_device"\n        v-if="currPlatform!==\'simulator\'"\n        @click="reload"\n    >\n        <ui-icon value="reset"></ui-icon>\n    </ui-button>\n</div>\n';const collator=new Intl.Collator("en",{numeric:!0,sensitivity:"base"});exports.$={platform:".platform",play:".play",reload:".reload",preview_info:".preview-info"},exports.ready=function(){window.xxx=vm=new Vue({el:this.$.preview_info,data:{scenes:[],platforms:["browser","simulator"],platformsIcon:{browser:"sphere",gameView:"video",simulator:"mini-game"},gameView:{isPlay:!1,isPaused:!1,isStep:!1},currPlatform:"browser",isloading:!1,isShowSceneList:!1,isShowPlatformsList:!1,curSelectScene:{},curSceneUrl:null},methods:{_onSettingsChanged(e,n,i){this.curSelectScene=i,Editor.Profile.setConfig("preview",n,e,"local"),vm.isShowSceneList=!1},async play(){let e=!1;"gameView"===this.currPlatform&&(this.gameView.isPlay=!this.gameView.isPlay,this.gameView.isPaused&&(await Editor.Message.send("preview","pause-terminal",!1),this.gameView.isPaused=!1),e=this.gameView.isPlay),Editor.Message.send("preview","open-terminal",e)},async gameViewPause(){this.gameView.isPlay&&("gameView"===this.currPlatform&&(this.gameView.isPaused=!this.gameView.isPaused),this.gameView.isStep&&(this.gameView.isStep=!1,this.gameView.isPaused=!0),await Editor.Message.send("preview","pause-terminal",this.gameView.isPaused))},async gameViewStep(){this.gameView.isPlay?(this.gameView.isStep=!0,await this.gameViewPause(),Editor.Message.send("preview","step-terminal")):this.gameView.isStep=!1},reload(){Editor.Message.send("preview","reload-terminal")},changePlatform(e){this.currPlatform=e,Editor.Message.send("preview","change-platform",e),vm.isShowPlatformsList=!1},showSelectList(){vm._refreshScenes(),vm.isShowSceneList=!0},showPlatformList(){vm.isShowPlatformsList=!0},hideSelectList(){vm.isShowSceneList=!1},hidePlatformList(){vm.isShowPlatformsList=!1},async _refreshScenes(){const e=this,n=await Editor.Message.request("asset-db","query-assets",{type:"scene"}),i=await Editor.Message.request("scene","query-current-scene");if(!n)return;const r=await Editor.Profile.getConfig("preview","general.start_scene"),t=n.find(e=>e.uuid===r);t&&(this.curSelectScene={name:this.splitName(t.name),uuid:t.uuid,url:t.url}),e.scenes=n.map(n=>(n.uuid===i&&(e.curSceneUrl=n.url),{uuid:n.uuid,name:this.splitName(basename(n.source)),url:n.url})).sort((e,n)=>collator.compare(e.name,n.name))},splitName(e){if(!e)return"";let n=e.split(".");return n.splice(n.length-1,1),n.length>1?n.join("."):n[0]}},mounted(){this.curSelectScene={name:""},this._refreshScenes(),Editor.Message.addBroadcastListener("scene:gameview-stop",()=>{this.gameView={isPlay:!1,isPaused:!1,isStep:!1}})}})};