"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=void 0,exports.load=load,exports.unload=unload;const Profile=require("@base/electron-profile");let hasOnProfileChange=!1;function load(){}function unload(){}exports.methods={async open(e){e&&await Editor.Message.request("scene","execute-scene-script",{name:"animation-graph",method:"edit",args:[e]}),await Editor.Panel.has("scene")&&!await Editor.Task.__protected__.hasSyncTask()?Editor.Panel.openBeside("scene","animation-graph"):Editor.Panel.open("animation-graph")},async dialogWarn(){return(await Editor.Dialog.warn(Editor.I18n.t("animation-graph.warningCaption"),{title:Editor.I18n.t("animation-graph.warning"),detail:Editor.I18n.t("animation-graph.warningDetail"),default:0,cancel:2,buttons:[Editor.I18n.t("animation-graph.save"),Editor.I18n.t("animation-graph.abort"),Editor.I18n.t("animation-graph.cancel")]})).response},async profileBindWatchWhenSceneReady(){if(!hasOnProfileChange){const r=Profile.load("global://packages/animation-graph.json"),s="animation-graph.pose-expr";Profile.on("change",async(e,a,n,o)=>{var i,t;["global","project"].includes(e)&&["packages/animation-graph.json","packages/engine.json"].includes(a)&&(i=(t=await Editor.Profile.getProject("engine","modules")).globalConfigKey,t=t.configs[i].cache,"global"!==e||"packages/animation-graph.json"!==a||n!==s||!0!==o||await exports.methods.profileCheckConfigIsLegal(t,r.get(s))||0===await exports.methods.profileDialogWarn(Editor.I18n.t("animation-graph.configEngineWarn"))&&(await exports.methods.profileEnsureEngineIsLegal(),Editor.Message.broadcast("project:engine-modules-changed")),"project"!==e||"packages/engine.json"!==a||n!=="modules.configs."+i&&"modules.globalConfigKey"!==n||await exports.methods.profileCheckConfigIsLegal(t,r.get(s))||0===await exports.methods.profileDialogWarn(Editor.I18n.t("animation-graph.configPreferencesWarn"))&&(await exports.methods.profileEnsureEngineIsLegal(),r.set(s,!0),r.save(),Editor.Message.broadcast("preferences:packages-changed")))}),hasOnProfileChange=!0}},async profileCheckConfigIsLegal(e,a){return!(a&&!1===e["procedural-animation"]._value||a&&!1===e.marionette._value||!a&&!0===e["procedural-animation"]._value)},async profileEnsureEngineIsLegal(){var a=await Editor.Profile.getProject("engine","modules"),n=a.globalConfigKey,{cache:a,includeModules:o}=a.configs[n];if(a&&Array.isArray(o)){let e=!1;return o.includes("marionette")||(o.push("marionette"),e=!0),o.includes("procedural-animation")||(o.push("procedural-animation"),e=!0),a.marionette._value||(a.marionette._value=!0,e=!0),a["procedural-animation"]._value||(a["procedural-animation"]._value=!0,e=!0),e&&(await Editor.Profile.setProject("engine",`modules.configs.${n}.cache`,a),await Editor.Profile.setProject("engine",`modules.configs.${n}.includeModules`,o.sort()),Editor.Message.broadcast("engine:engine-modules-global-config-changed",o.sort()),Editor.Message.broadcast("project:engine-modules-changed")),!0}},async profileDialogWarn(e){return(await Editor.Dialog.warn(Editor.I18n.t("animation-graph.configInvalidTitle"),{title:Editor.I18n.t("animation-graph.warning"),detail:e,default:0,cancel:1,buttons:[Editor.I18n.t("animation-graph.ok"),Editor.I18n.t("animation-graph.cancel")]})).response}};