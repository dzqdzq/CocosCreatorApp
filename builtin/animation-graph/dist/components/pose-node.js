"use strict";function data(){return{collapse:!1,twinkle:""}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.computed=exports.components=exports.data=exports.props=exports.template=void 0,exports.template='\n    <div class="state" type="PoseNode"\n        :style="style"\n        :twinkle="twinkle"\n        :collapse="collapse"\n        :inline="isInline"\n        :pose-input="isPoseInput"\n        :pose-output="isPoseOutput"\n        :is-parent="isParent"\n        @mousedown="mouseDown($event)"\n        @dblclick="crumb"\n    >\n        <div class="name" ref="name">\n            <div class="avatar inputs" ref="inputs-avatar"></div>\n            <div class="avatar outputs" ref="outputs-avatar"></div>\n            <ui-icon class="collapse" value="arrow-right"\n                v-if="!isInline"\n                @click="toggleCollapse"\n                @dblclick.stop\n            ></ui-icon>\n            <ui-label class="label"\n                :value="dump.name"\n            ></ui-label>\n            <ui-icon class="insert" value="add"\n                v-if="canInsertInput"\n                @click.stop="showInputsMenu()"\n                @dblclick.stop\n            ></ui-icon>\n            <ui-icon class="icon" value="arrow-triangle-sharp"\n                v-if="isParent"\n            ></ui-icon>\n        </div>\n        <pose-node-outputs ref="outputs"\n            :dump="dump"\n        ></pose-node-outputs>\n        <pose-node-inputs ref="inputs"\n            :dump="dump"\n        ></pose-node-inputs>\n    </div>\n',exports.props=["dump"],exports.data=data,exports.components={"pose-node-outputs":require("./pose-node-outputs"),"pose-node-inputs":require("./pose-node-inputs")},exports.computed={style(){var t;const e=this,o=Math.ceil(e.dump.top),n=Math.ceil(e.dump.left);let s=e.isRootOutputNode?"#CD3A58":"#227f9b";return(null===(t=e.dump.appearance)||void 0===t?void 0:t.themeColor)&&(s=e.dump.appearance.themeColor),{top:`${o}px`,left:`${n}px`,"--theme-color":s,"--background-color":`${s}80`,"--border-color":`${s}`}},canNotCopy(){return this.$root.queryData.cannotRemoveStateType.includes(this.dump.type)},isRootOutputNode(){return this.dump.id===this.$root.queryData.view.poseExpr.rootOutputNode},isParent(){return this.dump.enterable},isInline(){var t;let e=!!(null===(t=this.dump.appearance)||void 0===t?void 0:t.inline);return(this.dump.inputs.length>1||this.dump.outputs.length>1)&&(e=!1),e},isPoseInput(){return 1===this.dump.inputs.length&&5===this.dump.inputs[0].type},isPoseOutput(){return 1===this.dump.outputs.length&&5===this.dump.outputs[0].type},canInsertInput(){return this.dump.inputInsertInfos&&Object.keys(this.dump.inputInsertInfos).length}},exports.watch={dump(){this.refresh()}},exports.methods={refresh(){this.collapse=!!this.dump.editorData.collapse,this.setPosition()},resize(){this.setPosition()},setPosition(){const t=this;t.dump.width=t.$el.offsetWidth,t.dump.height=t.$el.offsetHeight;const e=t.$parent.getPosition({width:t.dump.width,height:t.dump.height,centerX:t.dump.editorData.centerX,centerY:t.dump.editorData.centerY});t.dump.top=e.top,t.dump.left=e.left},mouseDown(t){const e=this;function o(t){if(!e.mouseDownPoint||"right"===e.mouseDownPoint.button)return;t.stopPropagation(),t.preventDefault();const{clientX:o,clientY:n,left:s,top:i}=e.mouseDownPoint,p=t.clientX-o,u=t.clientY-n;if(Math.abs(p)<4&&Math.abs(u)<4)return;e.mouseDownPoint.hasMoved=!0;const r=e.$parent.$parent.graph;e.dump.left=s+p/r.scale,e.dump.top=i+u/r.scale}e.mouseDownPoint={$element:t.target,hasMoved:!1,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,button:0===t.button?"left":"right",left:e.dump.left,top:e.dump.top},"right"===e.mouseDownPoint.button&&t.stopPropagation(),document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){e.mouseDownPoint&&"right"===e.mouseDownPoint.button?e.mouseDownPoint.hasMoved||e.contextMenu(e.mouseDownPoint.$element):e.mouseDownPoint.hasMoved?e.$root.movePoseNode(e.dump.id,e.getCenterXY()):e.$parent.select(e.dump),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t),e.mouseDownPoint=null})},contextMenu(t){const e=this;if(e.dump.id===e.$parent.graph.rootOutputNode)return;const o=[];e.canNotCopy||o.push({label:Editor.I18n.t("animation-graph.pose.node.copy"),click(){e.$root.copyPoseNode(e.dump.id)}},{label:Editor.I18n.t("animation-graph.pose.node.duplicate"),click(){e.$root.duplicatePoseNode(e.dump.id)}},{type:"separator"}),o.push({label:Editor.I18n.t("animation-graph.pose.node.removeThis"),click(){e.$root.removePoseNode(e.dump.id)}}),o.length&&Editor.Menu.popup({menu:o})},getCenter(){const t=this.$el.offsetWidth,e=this.$el.offsetHeight;return{left:this.dump.left+t/2,top:this.dump.top+e/2}},getPointCenter(t,e){const o=this,n=o.$el.getBoundingClientRect(),s=t?"outputs":"inputs";let i=o.$refs[s].$refs["point-"+e][0];o.$el.hasAttribute("collapse")&&(i=o.$refs[`${s}-avatar`]);const p=o.$parent.$parent.graph,u=i.getBoundingClientRect(),r=u.width/2,d=u.height/2,a=o.dump.left+(u.left-n.left)/p.scale,l=o.dump.top+(u.top-n.top)/p.scale;return{left:a+r/p.scale,top:l+d/p.scale,clientX:u.left+r,clientY:u.top+d}},getCenterXY(){const t=this;return t.$parent.getCenterXY({width:t.dump.width,height:t.dump.height,left:t.dump.left,top:t.dump.top})},addShadowLine(t,e){e[(t?1:3)-1]=this.dump.id,this.$parent.addShadowLine(t,e)},crumb(){this.dump.enterable&&this.$parent.crumbPoseNode(this.dump.id)},toggleCollapse(){this.$root.toggleCollapsePoseNode(this.dump.id,!this.collapse)},showInputsMenu(){const t=this,e=t.dump.inputInsertInfos,o=[];for(const n in e){const s=e[n];o.push({label:s.displayName,click(){t.$root.addPoseNodeInput(t.dump.id,n)}})}Editor.Menu.popup({menu:o})}},exports.mounted=mounted;