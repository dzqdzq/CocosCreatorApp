"use strict";function data(){return{clipAssetType:"cc.AnimationClip",isSubgraph:!1,graphData:{},graph:{scale:1,top:0,left:0,centerX:0,centerY:0,type:"state"},mouseDownPoint:null}}function mounted(){const e=this;e.$el.hasAttribute("machine-thumbnail")||(e.observer=new window.ResizeObserver(()=>{e.resize()}),e.observer.observe(e.$el),e.resize())}function destroyed(){this.observer&&this.observer.unobserve(this.$el)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.methods=exports.watch=exports.computed=exports.data=exports.components=exports.template=void 0,exports.template='\n    <ui-drag-area class="layer"\n        :droppable="clipAssetType"\n        @mousedown="mouseDown($event)"\n        @wheel="wheel($event)"\n        @drop="drop($event)"\n    >\n        <grid class="grid" ref="grid"\n            v-if="!isSubgraph"\n        ></grid>\n        <transition name="component-fade" mode="out-in"\n            v-on:before-enter="beforeEnter"\n            v-on:before-leave="beforeLeave"\n        >\n            <component class="graph" ref="component"\n                :is="graph.type"\n                :type="graph.type"\n                :style="graphStyle"\n                :graph="graphData"\n            ></component>\n        </transition>\n    </ui-drag-area>\n',exports.components={grid:require("./grid"),state:require("./state"),motion:require("./motion")},exports.data=data,exports.computed={graphStyle(){return{top:`${Math.ceil(this.graph.top)}px`,left:`${Math.ceil(this.graph.left)}px`,transform:`scale(${this.graph.scale})`}}},exports.watch={"graph.scale"(){this.moveViewport()},"graph.top"(){this.moveViewport()},"graph.left"(){this.moveViewport()},"graph.centerX"(){const e=this;e.$refs.component&&e.$refs.component.resize()},"graph.centerY"(){const e=this;e.$refs.component&&e.$refs.component.resize()}},exports.methods={beforeEnter(){this.$refs.grid.$el.classList.remove("animationOut"),this.$refs.grid.$el.classList.add("animationIn")},beforeLeave(){this.$refs.grid.$el.classList.remove("animationIn"),this.$refs.grid.$el.classList.add("animationOut")},refresh(e,t,r){const n=this;n.isSubgraph=!!r,n.graph.type=e,!n.isSubgraph&&t.editorData&&t.editorData.viewport&&Object.assign(n.graph,t.editorData.viewport),n.graphData=t},resize(){this.graph.centerX=this.$el.offsetWidth/2,this.graph.centerY=this.$el.offsetHeight/2},clear(){this.graphData={}},viewport(){this.isSubgraph||(this.graph.scale=1,this.graph.top=0,this.graph.left=0)},moveViewport(){const e=this;e.isSubgraph||(window.cancelAnimationFrame(e.viewportAnimationId),e.viewportAnimationId=window.requestAnimationFrame(()=>{Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"viewport",args:[{scale:e.graph.scale,top:e.graph.top,left:e.graph.left}]})}))},select(e){this.$refs.component.select(e)},wheel(e){const t=this;e.stopPropagation(),e.preventDefault();const r=0-e.deltaY/5e3,n=t.graph.scale,o=t.graph.scale+r;if(o<.1||o>2)return;if(!t.$refs.component)return;t.graph.scale=o;const s=t.$refs.component.$el.getBoundingClientRect();t.graph.top-=(e.clientY-(s.y+s.height/2))*r/n,t.graph.left-=(e.clientX-(s.x+s.width/2))*r/n},mouseDown(e){const t=this;if(!t.$refs.component)return;const r=t.$el.getBoundingClientRect(),n=t.$refs.component.$el.getBoundingClientRect(),o=r.width+(e.clientX-n.x-n.width)/t.graph.scale,s=r.height+(e.clientY-n.y-n.height)/t.graph.scale;function i(e){if(!t.mouseDownPoint||"right"!==t.mouseDownPoint.button)return;e.stopPropagation(),e.preventDefault();const{clientX:r,clientY:n,gridStartX:o,gridStartY:s,graphLeft:i,graphTop:a}=t.mouseDownPoint,p=e.clientX-r,h=e.clientY-n;0===p&&0===h||(t.mouseDownPoint.hasMoved=!0,t.$refs.grid.startX=o+p,t.$refs.grid.startY=s+h,t.$refs.grid.render(),t.graph.left=i+p,t.graph.top=a+h)}t.mouseDownPoint={hasMoved:!1,clientX:e.clientX,clientY:e.clientY,offsetX:o,offsetY:s,button:0===e.button?"left":"right",gridStartX:t.$refs.grid.startX,gridStartY:t.$refs.grid.startY,graphLeft:t.graph.left,graphTop:t.graph.top},document.addEventListener("mousemove",i),document.addEventListener("mouseup",function e(r){t.mouseDownPoint&&"right"===t.mouseDownPoint.button&&(t.mouseDownPoint.hasMoved||t.contextMenu(t.mouseDownPoint)),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e),t.mouseDownPoint=null})},contextMenu(e){this.$refs.component.contextMenu(e)},drop(e){const t=this;t.$el.click();const r=[],{additional:n,type:o,value:s}=JSON.parse(JSON.stringify(Editor.UI.DragArea.currentDragInfo))||{};if(n&&n.forEach(e=>{e.type===t.clipAssetType&&r.push(e.value)}),o===t.clipAssetType&&s&&!r.includes(s)&&r.push(s),!r.length)return;if(!t.$refs.component)return;const i=t.$el.getBoundingClientRect(),a=t.$refs.component.$el.getBoundingClientRect();let p=i.width+(e.clientX-a.x-a.width)/t.graph.scale,h=i.height+(e.clientY-a.y-a.height)/t.graph.scale;for(let n=0;n<r.length;n++){const o=r[n];p+=32,h+=32,t.$refs.component.drop(e,{offsetX:p,offsetY:h,uuid:o})}},getCenterXY(e){return{centerX:e.left+e.width/2-this.graph.centerX,centerY:e.top+e.height/2-this.graph.centerY}},getPosition(e){const t=e.centerX-e.width/2+this.graph.centerX;return{top:e.centerY-e.height/2+this.graph.centerY,left:t}}},exports.mounted=mounted,exports.destroyed=destroyed;