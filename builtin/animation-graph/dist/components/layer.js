"use strict";function data(){return{clipAssetType:"cc.AnimationClip",isSubgraph:!1,graphData:{},graph:{scale:1,top:0,left:0,centerX:0,centerY:0,type:"state"},mouseDownPoint:null}}function mounted(){const e=this;e.observer=new window.ResizeObserver(()=>{e.resize()}),e.observer.observe(e.$el),e.viewport()}function destroyed(){this.observer&&this.observer.unobserve(this.$el)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.methods=exports.watch=exports.computed=exports.data=exports.components=exports.template=void 0,exports.template='\n    <ui-drag-area class="layer"\n        :droppable="clipAssetType"\n        @mousedown="mouseDown($event)"\n        @wheel="wheel($event)"\n        @keydown="keyDown($event)"\n        @drop="drop($event)"\n    >\n        <grid class="grid" ref="grid"\n            v-if="!isSubgraph"\n        ></grid>\n        <transition name="component-fade" mode="out-in"\n            v-on:before-enter="beforeEnter"\n            v-on:before-leave="beforeLeave"\n        >\n            <component class="graph" ref="component"\n                :is="graph.type"\n                :type="graph.type"\n                :style="graphStyle"\n                :graph="graphData"\n            ></component>\n        </transition>\n    </ui-drag-area>\n',exports.components={grid:require("./grid"),state:require("./state"),motion:require("./motion")},exports.data=data,exports.computed={graphStyle(){const e=this;return{top:"string"==typeof e.graph.top?e.graph.top:`${e.graph.top}px`,left:"string"==typeof e.graph.left?e.graph.left:`${e.graph.left}px`,transform:`scale(${e.graph.scale})`}}},exports.watch={"graph.scale"(){this.moveViewport()},"graph.top"(){this.moveViewport()},"graph.left"(){this.moveViewport()},graphData(){const e=this;window.requestAnimationFrame(()=>{e.resize()})}},exports.methods={beforeEnter(){this.$refs.grid.$el.classList.remove("animationOut"),this.$refs.grid.$el.classList.add("animationIn")},beforeLeave(){this.$refs.grid.$el.classList.remove("animationIn"),this.$refs.grid.$el.classList.add("animationOut")},refresh(e,t,n){const o=this;o.isSubgraph=!!n,o.graph.type=e,o.graphData=t,!o.isSubgraph&&t.editorData&&Object.assign(o.graph,t.editorData.viewport)},reset(){this.graphData={}},thumbnail(){const e=this;if(!e.isSubgraph||!e.$refs.component)return;const t=[],n=[],o={},r={};for(const s in e.$refs.component.nodes){const i=e.$refs.component.nodes[s];t.push(i.left),n.push(i.top),(void 0===o[i.left]||o[i.left]<i.width)&&(o[i.left]=i.width),(void 0===r[i.top]||r[i.top]<i.height)&&(r[i.top]=i.height)}const s=Math.min(...t),i=Math.max(...t),a=Math.min(...n),p=Math.max(...n),h=Math.abs(i-s)+o[i],c=Math.abs(p-a)+r[p],g=h<50&&c<26?.5:.3,l=h*g,d=c*g,u=d<26?(26-d)/2:0-a*e.graph.scale,f=0-s*g;e.graph.scale=g,e.graph.top=u,e.graph.left=f-4,e.graph.width=h,e.graph.height=c,e.$el.style.width=`${l+4}px`,e.$el.style.height=`${d+4}px`,e.$parent.setPosition()},resize(){const e=this;if(!e.$refs.component)return;const t=e.$el.getBoundingClientRect();e.graph.centerX=t.width/2,e.graph.centerY=t.height/2,e.$refs.component.resize(),window.cancelAnimationFrame(e.animationId),e.animationId=window.requestAnimationFrame(()=>{e.thumbnail()})},viewport(){const e=this;e.isSubgraph||(e.graph.scale=1,e.graph.top=0,e.graph.left=0,e.resize())},moveViewport(){this.isSubgraph||Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"viewport",args:[{scale:this.graph.scale,top:this.graph.top,left:this.graph.left}]})},select(e){this.$refs.component.select(e)},unselect(){this.$refs.component.unselect()},keyDown(e){e.code},wheel(e){const t=this;e.stopPropagation(),e.preventDefault();const n=0-e.deltaY/5e3,o=t.graph.scale,r=t.graph.scale+n;if(r<.1||r>2)return;if(!t.$refs.component)return;t.graph.scale=r;const s=t.$refs.component.$el.getBoundingClientRect();t.graph.top-=(e.clientY-(s.y+s.height/2))*n/o,t.graph.left-=(e.clientX-(s.x+s.width/2))*n/o},mouseDown(e){const t=this;if(e.stopPropagation(),e.preventDefault(),!t.$refs.component)return;const n=t.$el.getBoundingClientRect(),o=t.$refs.component.$el.getBoundingClientRect(),r=n.width+(e.clientX-o.x-o.width)/t.graph.scale,s=n.height+(e.clientY-o.y-o.height)/t.graph.scale;function i(e){if(!t.mouseDownPoint||"right"!==t.mouseDownPoint.button)return;e.stopPropagation(),e.preventDefault();const{clientX:n,clientY:o,gridStartX:r,gridStartY:s,graphLeft:i,graphTop:a}=t.mouseDownPoint,p=e.clientX-n,h=e.clientY-o;0===p&&0===h||(t.mouseDownPoint.hasMoved=!0,t.$refs.grid.startX=r+p,t.$refs.grid.startY=s+h,t.$refs.grid.render(),t.graph.left=i+p,t.graph.top=a+h)}t.mouseDownPoint={hasMoved:!1,clientX:e.clientX,clientY:e.clientY,offsetX:r,offsetY:s,button:0===e.button?"left":"right",gridStartX:t.$refs.grid.startX,gridStartY:t.$refs.grid.startY,graphLeft:t.graph.left,graphTop:t.graph.top},document.addEventListener("mousemove",i),document.addEventListener("mouseup",function e(n){t.mouseDownPoint&&"right"===t.mouseDownPoint.button?t.mouseDownPoint.hasMoved||t.contextMenu(t.mouseDownPoint):t.unselect(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e),t.mouseDownPoint=null})},contextMenu(e){this.$refs.component.contextMenu(e)},drop(e){const t=this;e.preventDefault(),e.stopPropagation();const n=[],{additional:o,type:r,value:s}=JSON.parse(JSON.stringify(Editor.UI.DragArea.currentDragInfo))||{};if(o&&o.forEach(e=>{e.type===t.clipAssetType&&n.push(e.value)}),r===t.clipAssetType&&s&&!n.includes(s)&&n.push(s),!n.length)return;if(!t.$refs.component)return;const i=t.$el.getBoundingClientRect(),a=t.$refs.component.$el.getBoundingClientRect();let p=i.width+(e.clientX-a.x-a.width)/t.graph.scale,h=i.height+(e.clientY-a.y-a.height)/t.graph.scale;for(let o=0;o<n.length;o++){const r=n[o];p+=40*o,h+=40*o,t.$refs.component.drop(e,{offsetX:p,offsetY:h,uuid:r})}},getCenterXY(e){return{centerX:e.left+e.width/2-this.graph.centerX,centerY:e.top+e.height/2-this.graph.centerY}},getPosition(e){const t=e.centerX-e.width/2+this.graph.centerX;return{top:e.centerY-e.height/2+this.graph.centerY,left:t}}},exports.mounted=mounted,exports.destroyed=destroyed;