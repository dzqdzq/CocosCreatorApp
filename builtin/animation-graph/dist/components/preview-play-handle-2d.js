"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.methods=exports.data=exports.computed=exports.watch=exports.props=exports.template=void 0;const Config={pointerRadius:5};function data(){return{pointers:[],threshold:{x:0,y:0,left:0,top:0},X:{min:0,max:0,total:0,dialPx:0},Y:{min:0,max:0,total:0,dialPx:0}}}function mounted(){this.init()}async function destroyed(){this.close()}exports.template='\n<div class="handle-2d">\n    <div class="pointers" ref="pointers"\n        @mousemove="mouseMoveThreshold($event)"\n    >\n\n        <div class="pointer"\n            v-for="(pointer, pointerIndex) in pointers" \n            :key="\'preview-play-handle-2d-pointer-\' + pointerIndex"\n            :style="{left: pointer.left+\'px\', top: pointer.top+\'px\', \'--weight\':pointer.weight }"\n            @mousedown.stop="mouseDownPointer($event, pointer, pointerIndex)"\n        ></div>\n        <div class="threshold"\n            :style="{left: threshold.left+\'px\', top: threshold.top+\'px\'}"\n        ></div>\n    </div>\n    <div class="threshold-text">{{threshold.x.toFixed(3)}}, {{threshold.y.toFixed(3)}}</div>\n    <ui-num-input class="threshold-y threshold-input" label="Y"\n        :value="Y.radius"\n        @confirm="changeRadius($event, \'Y\')"\n    ></ui-num-input>\n\n    <ui-num-input class="threshold-x threshold-input" label="X"\n        :value="X.radius"\n        @confirm="changeRadius($event, \'X\')"\n    ></ui-num-input>\n</div>\n',exports.props=[],exports.watch={"$root.queryData.view.motion"(){this.refresh()}},exports.computed={motion(){return this.$root.viewMotion()}},exports.data=data,exports.methods={init(){const t=this;t.initEnv(),t.initThreshold(),t.resizeObserver=new window.ResizeObserver(()=>{t.refresh()}),t.resizeObserver.observe(t.$el)},initEnv(){const t=this,{clientWidth:e,clientHeight:o}=t.$refs.pointers,i=t.motion.min[0],n=t.motion.max[0];let s=Math.max(Math.abs(i),Math.abs(n));t.motion.editorData.threshold&&(s=t.motion.editorData.threshold.radiusX),s||(s=1.5);const r=2*s;t.X={min:0-s,max:s,radius:s,total:r,dialPx:e/r};const h=t.motion.min[1],a=t.motion.max[1];let d=Math.max(Math.abs(h),Math.abs(a));t.motion.editorData.threshold&&(d=t.motion.editorData.threshold.radiusY),d||(d=1.5);const l=2*d;t.Y={min:0-d,max:d,radius:d,total:l,dialPx:o/l}},initThreshold(){const t=this,e=t.X.total/2+t.X.min,o=t.Y.total/2+t.Y.min;t.threshold.x=e,t.threshold.y=o},close(){this.resizeObserver&&this.resizeObserver.unobserve(this.$el)},refresh(){const t=this,e=[];t.initEnv(),t.motion.children.forEach(o=>{const i=t.getPointerPosition(o.threshold);e.push(i)});const o=t.getPointerPosition({x:t.threshold.x,y:t.threshold.y});t.threshold.left=o.left,t.threshold.top=o.top,t.pointers=e,t.refreshWeight()},async refreshWeight(){const t=this,e=await t.$parent.queryBlend2DThresholdsWeights({x:t.threshold.x,y:t.threshold.y});Array.isArray(e)&&e.forEach((e,o)=>{t.$set(t.pointers[o],"weight",e)})},getPointerPosition(t){return{left:(t.x-this.X.min)*this.X.dialPx-Config.pointerRadius,top:(this.Y.max-t.y)*this.Y.dialPx-Config.pointerRadius}},getPointerThreshold(t){return{x:(t.left+Config.pointerRadius)/this.X.dialPx+this.X.min,y:this.Y.max-(t.top+Config.pointerRadius)/this.Y.dialPx}},mouseDownPointer(t,e,o){const i=this,n=0-Config.pointerRadius,s=i.$refs.pointers.clientWidth-Config.pointerRadius,r=0-Config.pointerRadius,h=i.$refs.pointers.clientHeight-Config.pointerRadius;function a(t){if(!i.mouseDownPoint)return;t.stopPropagation(),t.preventDefault();const{clientX:a,clientY:d,left:l,top:u}=i.mouseDownPoint,p=t.clientX-a,m=t.clientY-d;if(0===p&&0===m)return;i.mouseDownPoint.hasMoved=!0;let c=l+p;c<n?c=n:c>s&&(c=s);let v=u+m;v<r?v=r:v>h&&(v=h);const x={left:c,top:v};Object.assign(e,x);const f=i.getPointerThreshold(x);Object.assign(i.motion.children[o].threshold,f)}i.mouseDownPoint=Object.assign({hasMoved:!1,clientX:t.clientX,clientY:t.clientY,pointerIndex:o},e),document.addEventListener("mousemove",a),document.addEventListener("mouseup",function t(){if(i.mouseDownPoint.hasMoved){const{pointerIndex:t}=i.mouseDownPoint,e=i.motion.children[t].threshold;i.$root.changeMotionThreshold2D(i.$root.queryData.view.motionLevel,t,e)}document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",t),i.mouseDownPoint=null})},mouseMoveThreshold(t){const e=this,o=t.currentTarget;if(!t.ctrlKey)return void o.removeAttribute("ctrl");if(o.setAttribute("ctrl",""),e.mouseDownPoint)return;const i={left:t.offsetX-Config.pointerRadius,top:t.offsetY-Config.pointerRadius},n=e.getPointerThreshold(i);Object.assign(e.threshold,i,n),e.$parent.updatePreviewBlendVariable([{name:e.motion.value[0].variable,value:e.threshold.x},{name:e.motion.value[1].variable,value:e.threshold.y}]),e.refreshWeight()},changeRadius(t,e){const o=t.target;o&&(this[e].radius=o.value,this.$parent.updateMotionEditDataThreshold({radiusX:this.X.radius,radiusY:this.Y.radius}))}},exports.mounted=mounted,exports.destroyed=destroyed;