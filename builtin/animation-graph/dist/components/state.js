"use strict";function data(){return{operating:!1,nodes:{},lines:{},lineHeight:16,mouseDownPoint:null}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.components=exports.template=void 0,exports.template='\n<section\n    :operating="operating"\n>\n    <state-node\n        v-for="(dump,id) in nodes" \n        :key="id"\n        :ref="id"\n        :type="dump.type"\n        :active="dump.index===$root.queryData.view.stateIndex"\n        :dump="dump"\n    ></state-node>\n    <state-line\n        v-for="(dump,id) in lines" \n        :key="id"\n        :ref="id"\n        :dump="dump"\n        :active="dump.index===$root.queryData.view.transitionIndex"\n    ></state-line>\n    <div class="line shadow" ref="shadowLine"\n        v-show="operating"\n    >\n        <ui-icon class="triangle" value="arrow-triangle-sharp" ref="triangle"></ui-icon>\n    </div>\n</section>\n',exports.components={"state-node":require("./state-node"),"state-line":require("./state-line")},exports.props=["graph"],exports.data=data,exports.watch={graph(){this.refresh()}},exports.methods={refresh(){const e=this;if(e.nodes={},e.graph&&e.graph.states)for(const t of e.graph.states)this.mergeNode(t);if(e.lines={},e.graph&&e.graph.transitions)for(const t of e.graph.transitions)this.mergeLine(t)},resize(){const e=this;for(const t in e.$refs)Array.isArray(e.$refs[t])&&e.$refs[t].forEach(e=>{e.resize&&e.resize()})},select(e){const t=this;t.$children.forEach(n=>{n.dump.id===e.id&&t.$root.select(e)})},unselect(){this.$root.select({type:""})},mergeNode(e){const t=this.$parent.graph,n=`state-${e.index}`;this.$set(this.nodes,n,Object.assign({id:n,top:t.centerY,left:t.centerX},e))},mergeLine(e){const t=this,n=`state-${e.from.index}`,o=`state-${e.to.index}`,i=`${n}_to_${o}`,r=`${o}_to_${n}`;t.lines[i]?t.lines[i].siblings.push(e.index):t.$set(t.lines,i,Object.assign({id:i,reverseId:r,fromStateId:n,toStateId:o,siblings:[]},e))},addLine(e,t){Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"addTransition",args:[e,t]})},addShadowLine(e){const t=this;t.operating=!0;const n=t.$refs[e][0],o=n.dump.index,i=n.getCenter();t.$refs.shadowLine.style.top=`${i.top-t.lineHeight/2}px`,t.$refs.shadowLine.style.left=`${i.left}px`;const r=n.$el.getBoundingClientRect();function s(e){if(!t.operating)return;e.stopPropagation(),e.preventDefault();const{clientX:n,clientY:o}=e,i=(n-t.mouseDownPoint.clientX)/t.mouseDownPoint.scale,r=(o-t.mouseDownPoint.clientY)/t.mouseDownPoint.scale,s=Math.sqrt(i**2+r**2),a=Math.atan2(r,i)*(180/Math.PI);t.$refs.shadowLine.style.width=`${s}px`,t.$refs.shadowLine.style.transform=`rotate(${a}deg)`}t.mouseDownPoint={clientX:r.x+r.width/2,clientY:r.y+r.height/2,scale:t.$parent.graph.scale},t.$parent.$el.addEventListener("mousemove",s),t.$parent.$el.addEventListener("mouseup",function e(n){if(0!==n.button)return;t.$parent.$el.removeEventListener("mousemove",s),t.$parent.$el.removeEventListener("mouseup",e),t.operating=!1,t.mouseDownPoint=null,t.$refs.shadowLine.style.width=0;const{clientX:i,clientY:r}=n;setTimeout(()=>{let e=t.$el.getRootNode().elementFromPoint(i,r);for(;e;){if(e.classList.contains("state")){if(!e.__vue__||!e.__vue__.dump)return;const n=e.__vue__.dump.index;return void t.addLine(o,n)}e=e.parentElement}})})},contextMenu(e){const t=this,n=t.$root.queryData.envType,o=[{label:Editor.I18n.t("animation-graph.state.addAnim"),click(){t.$root.addState({motion:{type:n.ClipMotion},editorData:t.getCenterXY({width:80,height:30,left:e.offsetX,top:e.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add1D"),click(){t.$root.addState({motion:{type:n.AnimationBlend1D},editorData:t.getCenterXY({width:70,height:30,left:e.offsetX,top:e.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add2D"),click(){t.$root.addState({motion:{type:n.AnimationBlend2D},editorData:t.getCenterXY({width:70,height:30,left:e.offsetX,top:e.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.addSubStateMachine"),click(){t.$root.addState({subStateMachine:{},editorData:t.getCenterXY({width:130,height:30,left:e.offsetX,top:e.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.bestViewport"),click(){t.$parent.viewport()}}];let i=-1;for(let e=t.$root.queryData.view.crumbs.length;e--;)if(t.$root.queryData.view.crumbs[e].type===t.$root.queryData.envType.SubStateMachine){i=e-1;break}i>=0&&o.push({type:"separator"},{label:Editor.I18n.t("animation-graph.crumbs.back"),click(){t.$root.crumbView(i)}}),Editor.Menu.popup({menu:o})},drop(e,t){const n=this.$root.queryData.envType;this.$root.addState({motion:{type:n.ClipMotion,uuid:t.uuid},editorData:this.getCenterXY({width:50,height:30,left:t.offsetX,top:t.offsetY})})},getCenterXY(e){return this.$parent.getCenterXY(e)},getPosition(e){return this.$parent.getPosition(e)}},exports.mounted=mounted;