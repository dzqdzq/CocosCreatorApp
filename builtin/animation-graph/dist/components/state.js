"use strict";function data(){return{addingLine:!1,nodes:{},lines:{},lineHeight:16,minStateWidth:35,minStateHeight:21,mouseDownPoint:null}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.components=exports.template=void 0,exports.template='\n<section\n    :adding-line="addingLine"\n>\n    <state-node\n        v-for="(dump,id) in nodes" \n        :key="id"\n        :ref="id"\n        :type="dump.type"\n        :active="dump.index===$root.queryData.view.stateIndex"\n        :dump="dump"\n    ></state-node>\n    <state-line\n        v-for="(dump,id) in lines" \n        :key="id"\n        :ref="id"\n        :dump="dump"\n        :active="dump.indexes.includes($root.queryData.view.transitionIndex)"\n    ></state-line>\n    <div class="line shadow" ref="shadowLine"\n        v-show="addingLine"\n    >\n        <ui-icon class="triangle" value="arrow-triangle-sharp" ref="triangle"></ui-icon>\n    </div>\n</section>\n',exports.components={"state-node":require("./state-node"),"state-line":require("./state-line")},exports.props=["graph"],exports.data=data,exports.watch={graph(){this.refresh()}},exports.methods={refresh(){const t=this;if(t.nodes={},t.graph&&t.graph.states)for(const e of t.graph.states)this.mergeNode(e);if(t.lines={},t.graph&&t.graph.transitions)for(const e of t.graph.transitions)this.mergeLine(e)},resize(){const t=this;for(const e in t.$refs)Array.isArray(t.$refs[e])&&t.$refs[e].forEach(t=>{t.resize&&t.resize()})},select(t){const e=this;e.$children.forEach(n=>{n.dump.id===t.id&&e.$root.select(t)})},mergeNode(t){const e=this.$parent.graph,n=this.$root.generateStateId(t.editorData.id);this.$set(this.nodes,n,Object.assign({id:n,top:e.centerY,left:e.centerX},t))},mergeLine(t){const e=this,n=e.graph.states[t.from.index],i=e.graph.states[t.to.index],o=e.$root.generateStateId(n.editorData.id),a=e.$root.generateStateId(i.editorData.id),r=`${o}_to_${a}`,s=`${a}_to_${o}`;if(e.lines[r])return e.lines[r].siblings.push(t.index),void e.lines[r].indexes.push(t.index);e.$set(e.lines,r,Object.assign({id:r,reverseId:s,fromStateId:o,toStateId:a,siblings:[],indexes:[t.index]},t))},addLine(t,e){Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"addTransition",args:[t,e]})},addShadowLine(t){const e=this;e.addingLine=!0;const n=e.$refs[t][0],i=n.dump.index,o=n.getCenter();e.$refs.shadowLine.style.top=`${o.top-e.lineHeight/2}px`,e.$refs.shadowLine.style.left=`${o.left}px`;const a=n.$el.getBoundingClientRect();function r(t){if(!e.addingLine)return;t.stopPropagation(),t.preventDefault();const{clientX:n,clientY:i}=t,o=(n-e.mouseDownPoint.clientX)/e.mouseDownPoint.scale,a=(i-e.mouseDownPoint.clientY)/e.mouseDownPoint.scale,r=Math.sqrt(o**2+a**2),s=Math.atan2(a,o)*(180/Math.PI);e.$refs.shadowLine.style.width=`${r}px`,e.$refs.shadowLine.style.transform=`rotate(${s}deg)`}e.mouseDownPoint={clientX:a.x+a.width/2,clientY:a.y+a.height/2,scale:e.$parent.graph.scale},e.$parent.$el.addEventListener("mousemove",r),e.$parent.$el.addEventListener("mouseup",function t(n){if(0!==n.button)return;e.$parent.$el.removeEventListener("mousemove",r),e.$parent.$el.removeEventListener("mouseup",t),setTimeout(()=>{e.addingLine=!1}),e.mouseDownPoint=null,e.$refs.shadowLine.style.width=0;const{clientX:o,clientY:a}=n;let s=e.$el.getRootNode().elementFromPoint(o,a);for(;s;){if(s.classList.contains("state")){if(!s.__vue__||!s.__vue__.dump)return;const t=s.__vue__.dump.index;return void e.addLine(i,t)}s=s.parentElement}})},crumbState(t){this.addingLine||this.$root.crumbState(t)},contextMenu(t){const e=this,n=e.$root.queryData.envType,i=[{label:Editor.I18n.t("animation-graph.state.paste"),enabled:e.$root.queryData.canPasteState,click(){const n=e.getCenterXY({width:1,height:1,left:t.offsetX,top:t.offsetY});e.$root.pasteState(!1,n)}},{label:Editor.I18n.t("animation-graph.state.pasteWithTransition"),enabled:e.$root.queryData.canPasteStateWithTransition,click(){const n=e.getCenterXY({width:1,height:1,left:t.offsetX,top:t.offsetY});e.$root.pasteState(!0,n)}},{type:"separator"},{label:Editor.I18n.t("animation-graph.state.addAnim"),click(){e.$root.addState({type:n.MotionState,motion:{type:n.ClipMotion},editorData:e.getCenterXY({width:80,height:30,left:t.offsetX,top:t.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add1D"),click(){e.$root.addState({type:n.MotionState,motion:{type:n.AnimationBlend1D},editorData:e.getCenterXY({width:70,height:30,left:t.offsetX,top:t.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add2D"),click(){e.$root.addState({type:n.MotionState,motion:{type:n.AnimationBlend2D},editorData:e.getCenterXY({width:70,height:30,left:t.offsetX,top:t.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.addSubStateMachine"),click(){e.$root.addState({type:n.SubStateMachine,subStateMachine:{},editorData:e.getCenterXY({width:130,height:30,left:t.offsetX,top:t.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.addEmpty"),click(){e.$root.addState({type:n.EmptyState,editorData:e.getCenterXY({width:80,height:30,left:t.offsetX,top:t.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.bestViewport"),click(){e.$parent.bestViewport()}}];let o=-1;for(let t=e.$root.queryData.view.crumbs.length-1;t>=0;t--)if(e.$root.queryData.view.crumbs[t].type===e.$root.queryData.envType.SubStateMachine){o=t-1;break}o>=0&&i.push({type:"separator"},{label:Editor.I18n.t("animation-graph.crumbs.back"),click(){e.$root.crumbView(o)}}),Editor.Menu.popup({menu:i})},drop(t,e){const n=this.$root.queryData.envType;this.$root.addState({type:n.MotionState,motion:{type:n.ClipMotion,uuid:e.uuid},editorData:this.getCenterXY({width:50,height:30,left:e.offsetX,top:e.offsetY})})},getCenterXY(t){return this.$parent.getCenterXY(t)},getPosition(t){return this.$parent.getPosition(t)}},exports.mounted=mounted;