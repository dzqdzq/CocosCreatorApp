"use strict";function data(){return{operating:!1,nodes:{},lines:{},lineHeight:16,minStateWidth:35,minStateHeight:21,mouseDownPoint:null}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.components=exports.template=void 0,exports.template='\n<section\n    :operating="operating"\n>\n    <state-node\n        v-for="(dump,id) in nodes" \n        :key="$root.queryData.assetInfo.uuid + \'-\' + id"\n        :ref="id"\n        :type="dump.type"\n        :active="dump.index===$root.queryData.view.stateIndex && !$parent.isSubgraph"\n        :dump="dump"\n    ></state-node>\n    <state-line\n        v-for="(dump,id) in lines" \n        :key="$root.queryData.assetInfo.uuid + \'-\' + id"\n        :ref="id"\n        :dump="dump"\n        :active="dump.index===$root.queryData.view.transitionIndex && !$parent.isSubgraph"\n    ></state-line>\n    <div class="line shadow" ref="shadowLine"\n        v-show="operating"\n    >\n        <ui-icon class="triangle" value="arrow-triangle-sharp" ref="triangle"></ui-icon>\n    </div>\n</section>\n',exports.components={"state-node":require("./state-node"),"state-line":require("./state-line")},exports.props=["graph"],exports.data=data,exports.watch={graph(){this.refresh()}},exports.methods={refresh(){const t=this;if(t.nodes={},t.graph&&t.graph.states)for(const e of t.graph.states)this.mergeNode(e);t.$nextTick(()=>{if(t.lines={},t.graph&&t.graph.transitions)for(const e of t.graph.transitions)this.mergeLine(e)})},resize(){const t=this;for(const e in t.$refs)Array.isArray(t.$refs[e])&&t.$refs[e].forEach(t=>{t.resize&&t.resize()})},select(t){const e=this;e.$children.forEach(n=>{n.dump.id===t.id&&e.$root.select(t)})},mergeNode(t){const e=this.$parent.graph,n=t.editorData.id;this.$set(this.nodes,n,Object.assign({id:n,top:e.centerY,left:e.centerX},t))},mergeLine(t){const e=this,n=e.graph.states[t.from.index],o=e.graph.states[t.to.index],i=n.editorData.id,a=o.editorData.id,r=`${i}_to_${a}`,s=`${a}_to_${i}`;e.lines[r]?e.lines[r].siblings.push(t.index):e.$set(e.lines,r,Object.assign({id:r,reverseId:s,fromStateId:i,toStateId:a,siblings:[]},t))},addLine(t,e){Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"addTransition",args:[t,e]})},addShadowLine(t){const e=this;e.operating=!0;const n=e.$refs[t][0],o=n.dump.index,i=n.getCenter();e.$refs.shadowLine.style.top=`${i.top-e.lineHeight/2}px`,e.$refs.shadowLine.style.left=`${i.left}px`;const a=n.$el.getBoundingClientRect();function r(t){if(!e.operating)return;t.stopPropagation(),t.preventDefault();const{clientX:n,clientY:o}=t,i=(n-e.mouseDownPoint.clientX)/e.mouseDownPoint.scale,a=(o-e.mouseDownPoint.clientY)/e.mouseDownPoint.scale,r=Math.sqrt(i**2+a**2),s=Math.atan2(a,i)*(180/Math.PI);e.$refs.shadowLine.style.width=`${r}px`,e.$refs.shadowLine.style.transform=`rotate(${s}deg)`}e.mouseDownPoint={clientX:a.x+a.width/2,clientY:a.y+a.height/2,scale:e.$parent.graph.scale},e.$parent.$el.addEventListener("mousemove",r),e.$parent.$el.addEventListener("mouseup",function t(n){if(0!==n.button)return;e.$parent.$el.removeEventListener("mousemove",r),e.$parent.$el.removeEventListener("mouseup",t),e.operating=!1,e.mouseDownPoint=null,e.$refs.shadowLine.style.width=0;const{clientX:i,clientY:a}=n;setTimeout(()=>{let t=e.$el.getRootNode().elementFromPoint(i,a);for(;t;){if(t.classList.contains("state")){if(!t.__vue__||!t.__vue__.dump)return;const n=t.__vue__.dump.index;return void e.addLine(o,n)}t=t.parentElement}})})},contextMenu(t){const e=this,n=e.$root.queryData.envType,o=[{label:Editor.I18n.t("animation-graph.state.addAnim"),click(){e.$root.addState({motion:{type:n.ClipMotion},editorData:e.getCenterXY({width:80,height:30,left:t.offsetX,top:t.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add1D"),click(){e.$root.addState({motion:{type:n.AnimationBlend1D},editorData:e.getCenterXY({width:70,height:30,left:t.offsetX,top:t.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add2D"),click(){e.$root.addState({motion:{type:n.AnimationBlend2D},editorData:e.getCenterXY({width:70,height:30,left:t.offsetX,top:t.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.addSubStateMachine"),click(){e.$root.addState({subStateMachine:{},editorData:e.getCenterXY({width:130,height:30,left:t.offsetX,top:t.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.state.addEmpty"),click(){e.$root.addState({type:n.EmptyState,editorData:e.getCenterXY({width:80,height:30,left:t.offsetX,top:t.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.bestViewport"),click(){e.$parent.bestViewport()}}];let i=-1;for(let t=e.$root.queryData.view.crumbs.length-1;t>=0;t--)if(e.$root.queryData.view.crumbs[t].type===e.$root.queryData.envType.SubStateMachine){i=t-1;break}i>=0&&o.push({type:"separator"},{label:Editor.I18n.t("animation-graph.crumbs.back"),click(){e.$root.crumbView(i)}}),Editor.Menu.popup({menu:o})},drop(t,e){const n=this.$root.queryData.envType;this.$root.addState({motion:{type:n.ClipMotion,uuid:e.uuid},editorData:this.getCenterXY({width:50,height:30,left:e.offsetX,top:e.offsetY})})},getCenterXY(t){return this.$parent.getCenterXY(t)},getPosition(t){return this.$parent.getPosition(t)}},exports.mounted=mounted;