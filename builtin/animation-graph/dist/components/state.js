"use strict";function data(){return{addingLine:!1,nodes:{},lines:{},lineHeight:16,minStateWidth:35,minStateHeight:21,mouseDownPoint:null}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.components=exports.template=void 0,exports.template='\n<section\n    :adding-line="addingLine"\n>\n    <state-node\n        v-for="(dump,id) in nodes" \n        :key="$root.queryData.assetInfo.uuid + \'-\' + id"\n        :ref="id"\n        :type="dump.type"\n        :active="dump.index===$root.queryData.view.stateIndex"\n        :dump="dump"\n    ></state-node>\n    <state-line\n        v-for="(dump,id) in lines" \n        :key="$root.queryData.assetInfo.uuid + \'-\' + id"\n        :ref="id"\n        :dump="dump"\n        :active="dump.indexes.includes($root.queryData.view.transitionIndex)"\n    ></state-line>\n    <div class="line shadow" ref="shadowLine"\n        v-show="addingLine"\n    >\n        <ui-icon class="triangle" value="arrow-triangle-sharp" ref="triangle"></ui-icon>\n    </div>\n</section>\n',exports.components={"state-node":require("./state-node"),"state-line":require("./state-line")},exports.props=["graph"],exports.data=data,exports.watch={graph(){this.refresh()}},exports.methods={refresh(){const e=this;if(e.nodes={},e.graph&&e.graph.states)for(const t of e.graph.states)this.mergeNode(t);if(e.lines={},e.graph&&e.graph.transitions)for(const t of e.graph.transitions)this.mergeLine(t)},resize(){const e=this;for(const t in e.$refs)Array.isArray(e.$refs[t])&&e.$refs[t].forEach(e=>{e.resize&&e.resize()})},select(e){const t=this;t.$children.forEach(n=>{n.dump.id===e.id&&t.$root.select(e)})},mergeNode(e){const t=this.$parent.graph,n=e.editorData.id;this.$set(this.nodes,n,Object.assign({id:n,top:t.centerY,left:t.centerX},e))},mergeLine(e){const t=this,n=t.graph.states[e.from.index],i=t.graph.states[e.to.index],o=n.editorData.id,a=i.editorData.id,s=`${o}_to_${a}`,r=`${a}_to_${o}`;if(t.lines[s])return t.lines[s].siblings.push(e.index),void t.lines[s].indexes.push(e.index);t.$set(t.lines,s,Object.assign({id:s,reverseId:r,fromStateId:o,toStateId:a,siblings:[],indexes:[e.index]},e))},addLine(e,t){Editor.Message.send("scene","execute-scene-script",{name:"animation-graph",method:"addTransition",args:[e,t]})},addShadowLine(e){const t=this;t.addingLine=!0;const n=t.$refs[e][0],i=n.dump.index,o=n.getCenter();t.$refs.shadowLine.style.top=`${o.top-t.lineHeight/2}px`,t.$refs.shadowLine.style.left=`${o.left}px`;const a=n.$el.getBoundingClientRect();function s(e){if(!t.addingLine)return;e.stopPropagation(),e.preventDefault();const{clientX:n,clientY:i}=e,o=(n-t.mouseDownPoint.clientX)/t.mouseDownPoint.scale,a=(i-t.mouseDownPoint.clientY)/t.mouseDownPoint.scale,s=Math.sqrt(o**2+a**2),r=Math.atan2(a,o)*(180/Math.PI);t.$refs.shadowLine.style.width=`${s}px`,t.$refs.shadowLine.style.transform=`rotate(${r}deg)`}t.mouseDownPoint={clientX:a.x+a.width/2,clientY:a.y+a.height/2,scale:t.$parent.graph.scale},t.$parent.$el.addEventListener("mousemove",s),t.$parent.$el.addEventListener("mouseup",function e(n){if(0!==n.button)return;t.$parent.$el.removeEventListener("mousemove",s),t.$parent.$el.removeEventListener("mouseup",e),setTimeout(()=>{t.addingLine=!1}),t.mouseDownPoint=null,t.$refs.shadowLine.style.width=0;const{clientX:o,clientY:a}=n;let r=t.$el.getRootNode().elementFromPoint(o,a);for(;r;){if(r.classList.contains("state")){if(!r.__vue__||!r.__vue__.dump)return;const e=r.__vue__.dump.index;return void t.addLine(i,e)}r=r.parentElement}})},crumbState(e){this.addingLine||this.$root.crumbState(e)},contextMenu(e){const t=this,n=t.$root.queryData.envType,i=[{label:Editor.I18n.t("animation-graph.state.addAnim"),click(){t.$root.addState({motion:{type:n.ClipMotion},editorData:t.getCenterXY({width:80,height:30,left:e.offsetX,top:e.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add1D"),click(){t.$root.addState({motion:{type:n.AnimationBlend1D},editorData:t.getCenterXY({width:70,height:30,left:e.offsetX,top:e.offsetY})})}},{label:Editor.I18n.t("animation-graph.state.add2D"),click(){t.$root.addState({motion:{type:n.AnimationBlend2D},editorData:t.getCenterXY({width:70,height:30,left:e.offsetX,top:e.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.addSubStateMachine"),click(){t.$root.addState({subStateMachine:{},editorData:t.getCenterXY({width:130,height:30,left:e.offsetX,top:e.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.state.addEmpty"),click(){t.$root.addState({type:n.EmptyState,editorData:t.getCenterXY({width:80,height:30,left:e.offsetX,top:e.offsetY})})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.bestViewport"),click(){t.$parent.bestViewport()}}];let o=-1;for(let e=t.$root.queryData.view.crumbs.length-1;e>=0;e--)if(t.$root.queryData.view.crumbs[e].type===t.$root.queryData.envType.SubStateMachine){o=e-1;break}o>=0&&i.push({type:"separator"},{label:Editor.I18n.t("animation-graph.crumbs.back"),click(){t.$root.crumbView(o)}}),Editor.Menu.popup({menu:i})},drop(e,t){const n=this.$root.queryData.envType;this.$root.addState({motion:{type:n.ClipMotion,uuid:t.uuid},editorData:this.getCenterXY({width:50,height:30,left:t.offsetX,top:t.offsetY})})},getCenterXY(e){return this.$parent.getCenterXY(e)},getPosition(e){return this.$parent.getPosition(e)}},exports.mounted=mounted;