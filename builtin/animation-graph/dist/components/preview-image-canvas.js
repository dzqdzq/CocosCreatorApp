"use strict";function data(){return{isDirty:!1}}async function mounted(){this.init()}async function destroyed(){cancelAnimationFrame(this.animationId),this.close()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.destroyed=exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.template=void 0,exports.template='\n<ui-drag-area class="image" droppable="cc.Asset"\n    @drop="drop($event)"\n>\n    <canvas class="canvas" ref="canvas"\n        @mousedown="mousedown($event)"\n    ></canvas>\n    <div class="drag-tip"\n        :active="state===$root.queryData.previewState.NO_MODEL"\n    >\n        <ui-label value="i18n:animation-graph.preview.NO_MODEL"></ui-label>\n    </div>\n</ui-drag-area>\n',exports.props=["config","play","state"],exports.data=data,exports.watch={state(){const e=this;if(e.state!==e.$root.queryData.previewState.NO_ERROR){const t=e.$refs.canvas,i=t.clientWidth,n=t.clientHeight;i&&n&&e.glPreview.drawGL({buffer:new Uint8Array(i*n*4),width:i,height:n})}}},exports.methods={async init(){const e=this,t=Editor._Module.require("PreviewExtends").default;e.glPreview=new t(e.config.GLPreview.name,e.config.GLPreview.method),await e.glPreview.init({width:e.$el.clientWidth,height:e.$el.clientHeight}),e.resizeObserver=new window.ResizeObserver(()=>{e.isDirty=!0}),e.resizeObserver.observe(e.$el),e.refresh()},close(){this.resizeObserver&&this.resizeObserver.unobserve(this.$el)},async callPreviewFunction(e,...t){return await Editor.Message.request("scene","call-preview-function",this.config.GLPreview.name,e,...t)},async refresh(){const e=this;if(e.isDirty){try{const t=e.$refs.canvas,i=e.$el,n=i.clientWidth,r=i.clientHeight;t.width===n&&t.height===r||(t.width=n,t.height=r,await e.glPreview.initGL(t,{width:n,height:r}),await e.glPreview.resizeGL(n,r));const s=await e.glPreview.queryPreviewData({width:t.width,height:t.height});e.glPreview.drawGL(s)}catch(e){console.warn(e)}e.isDirty=!1}cancelAnimationFrame(e.animationId),e.animationId=requestAnimationFrame(()=>{e.refresh()})},drop(){const e=[],{additional:t,value:i}=JSON.parse(JSON.stringify(Editor.UI.__protected__.DragArea.currentDragInfo))||{};t&&t.forEach(t=>{"cc.Prefab"===t.type&&e.push(t.value)}),i&&!e.includes(i)&&e.push(i),e.length&&this.$parent.setModel(e[0])},async mousedown(e){const t=this;async function i(e){await t.callPreviewFunction("onMouseMove",{movementX:e.movementX,movementY:e.movementY}),t.isDirty=!0}await t.callPreviewFunction("onMouseDown",{x:e.x,y:e.y}),document.addEventListener("mousemove",i),document.addEventListener("mouseup",async function e(n){await t.callPreviewFunction("onMouseUp",{x:n.x,y:n.y}),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e),t.isDirty=!1}),t.isDirty=!0}},exports.mounted=mounted,exports.destroyed=destroyed;