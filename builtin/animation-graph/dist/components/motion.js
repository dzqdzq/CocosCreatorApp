"use strict";function data(){return{operating:!1,nodes:{},lines:{}}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.data=exports.props=exports.components=exports.template=void 0,exports.template='\n    <section\n        :operating="operating"\n    >\n        <motion-node\n            v-for="(dump,id) in nodes" \n            :key="id"\n            :ref="id"\n            :type="dump.type"\n            :active="dump.level.join(\'\')===$root.queryData.view.motionLevel.join(\'\')"\n            :dump="dump"\n        ></motion-node>\n        <svg>\n            <path\n                v-for="(dump,id) in lines" \n                :key="id"\n                :ref="id"\n                :d="getLinePath(dump)"\n            ></path>\n        </svg>\n    </section>\n',exports.components={"motion-node":require("./motion-node")},exports.props=["graph"],exports.data=data,exports.watch={graph(){this.refresh()}},exports.methods={refresh(){const t=this;t.nodes={},t.lines={},t.graph&&this.mergeNode(t.graph)},resize(){const t=this;for(const e in t.$refs)Array.isArray(t.$refs[e])&&t.$refs[e].forEach(t=>{t.resize&&t.resize()})},select(t){const e=this;e.$children.forEach(o=>{o.dump.id===t.id&&e.$root.select(t)})},unselect(){this.$root.select({type:""})},mergeNode(t){const e=this,o=e.$parent.graph,n=`state-${t.level.join("-")}`;if(e.$set(e.nodes,n,Object.assign({id:n,top:o.centerY,left:o.centerX},t)),t.children)for(const o of t.children){const i=e.mergeNode(o);e.mergeLine(n,i,t.level.length-1)}return n},mergeLine(t,e,o){const n=`${t}_to_${e}`;this.$set(this.lines,n,{id:n,fromStateId:t,toStateId:e,level:o})},getLinePath(t){const{fromStateId:e,toStateId:o}=t,n=this.nodes[e],i=this.nodes[o],r=n.left+n.width/2+4,s=n.top+n.height/2;if(isNaN(r)||isNaN(s))return"";const a=i.left+i.width/2+4,d=i.top+i.height/2;if(isNaN(a)||isNaN(d))return"";let p="M"+r+" "+s+" ";return p=p+("C"+r+" "+(s+d)/2+","+a+" "+(s+d)/2+",")+a+" "+d},contextMenu(t){const e=this,o=e.$root.queryData.envType,n=e.nodes["state-0"],i=e.getCenterXY({width:n.width,height:n.height/2,left:t.offsetX,top:t.offsetY});Editor.Menu.popup({menu:[{label:Editor.I18n.t("animation-graph.motion.addAnim"),click(){e.$root.addMotionToMotion(n.level,{type:o.ClipMotion,editorData:i})}},{label:Editor.I18n.t("animation-graph.motion.add1D"),click(){e.$root.addMotionToMotion(n.level,{type:o.AnimationBlend1D,editorData:i})}},{label:Editor.I18n.t("animation-graph.motion.add2D"),click(){e.$root.addMotionToMotion(n.level,{type:o.AnimationBlend2D,editorData:i})}},{type:"separator"},{label:Editor.I18n.t("animation-graph.layer.bestViewport"),click(){e.$parent.viewport()}},{type:"separator"},{label:Editor.I18n.t("animation-graph.crumbs.back"),click(){const t=e.$root.queryData.view.crumbs.length-2;e.$root.crumbView(t)}}]})},drop(t,e){const o=this.$root.queryData.envType,n=this.nodes["state-0"],i=this.getCenterXY({width:n.width,height:n.height/2,left:e.offsetX,top:e.offsetY});this.$root.addMotionToMotion(n.level,{type:o.ClipMotion,uuid:e.uuid,editorData:i})},getCenterXY(t){return this.$parent.getCenterXY(t)},getPosition(t){return this.$parent.getPosition(t)}},exports.mounted=mounted;