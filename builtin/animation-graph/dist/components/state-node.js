"use strict";function data(){return{}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.computed=exports.data=exports.components=exports.props=exports.template=void 0,exports.template='\n    <div class="state"\n        :style="style"\n        :subtype="subType"\n        @mousedown="mouseDown($event)"\n        @dblclick="dblclick($event)"\n    >\n        <div class="name" ref="name">\n            <ui-label class="label"\n                :value="dump.name"\n            ></ui-label>\n            <ui-icon class="icon" value="arrow-right-bold"\n                v-if="isSubStateMachine || isBlendMotion"\n            ></ui-icon>\n        </div>\n        <layer ref="layer" machine-thumbnail\n            v-if="dump.type===\'SubStateMachine\'"\n        ></layer>\n    </div>\n',exports.props=["dump"],exports.components={layer:require("./layer")},exports.data=data,exports.computed={style(){return{top:`${Math.ceil(this.dump.top)}px`,left:`${Math.ceil(this.dump.left)}px`}},isSubStateMachine(){return this.dump.type===this.$root.queryData.envType.SubStateMachine},isBlendMotion(){const t=this;return t.dump.type===t.$root.queryData.envType.MotionState&&t.dump.props.motion&&t.$root.queryData.animationBlendType.includes(t.dump.props.motion.type)},inSubStateMachine(){var t,e;let n=!1;return(null===(e=null===(t=this.$parent)||void 0===t?void 0:t.$parent)||void 0===e?void 0:e.isSubgraph)&&(n=!0),n},subType(){var t,e;return null===(e=null===(t=this.dump.props)||void 0===t?void 0:t.motion)||void 0===e?void 0:e.type}},exports.watch={dump(){this.refresh()},"dump.left"(){const t=this;t.inSubStateMachine&&t.$parent.$parent.$parent.thumbnail()},"dump.top"(){const t=this;t.inSubStateMachine&&t.$parent.$parent.$parent.thumbnail()}},exports.methods={refresh(){const t=this;if(t.$refs.layer){let e=0,n=t.$refs.layer.$el.parentElement;for(;n;)n.hasAttribute("machine-thumbnail")&&e++,n=n.parentElement;e<3?t.$refs.layer.refresh("state",t.dump.stateMachine,!0):t.$refs.layer.$el.style.display="none"}window.requestAnimationFrame(()=>{t.setPosition()})},resize(){this.setPosition()},setPosition(){const t=this;t.dump.width=t.$el.offsetWidth,t.dump.height=t.$el.offsetHeight;const e=t.$parent.getPosition({width:t.dump.width,height:t.dump.height,centerX:t.dump.editorData.centerX,centerY:t.dump.editorData.centerY});t.dump.top=e.top,t.dump.left=e.left},thumbnail(){const t=this;window.cancelAnimationFrame(t.thumbnailAnimationId),t.thumbnailAnimationId=window.requestAnimationFrame(()=>{if(!t.$refs.layer||!t.$refs.layer.$refs.component)return;const e=t.$refs.layer,n=t.$refs.name,o=e.$refs.component.nodes,i=e.graph,a=[],s=[],r={},p={};for(const e in o){const n=o[e];a.push(n.left),s.push(n.top),(void 0===r[n.left]||r[n.left]<n.width)&&(r[n.left]=n.width||t.$parent.minStateWidth),(void 0===p[n.top]||p[n.top]<n.height)&&(p[n.top]=n.height||t.$parent.minStateHeight)}const u=Math.min(...a),d=Math.max(...a),m=Math.min(...s),l=Math.max(...s),h=Math.abs(d-u)+r[d],c=Math.abs(l-m)+p[l],f=Math.ceil(.3*h),$=Math.ceil(.3*c);e.$el.style.width=`${f}px`,e.$el.style.height=`${$}px`,n.style.width=`${f+16}px`,i.scale=.3,i.top=0-.3*m,i.left=0-.3*u,i.width=h,i.height=c,i.centerX=f/2,i.centerY=$/2,t.setPosition()})},mouseDown(t){const e=this;function n(t){if(!e.mouseDownPoint||"right"===e.mouseDownPoint.button)return;t.stopPropagation(),t.preventDefault();const{clientX:n,clientY:o,left:i,top:a}=e.mouseDownPoint,s=t.clientX-n,r=t.clientY-o;if(0===s&&0===r)return;e.mouseDownPoint.hasMoved=!0;const p=e.$parent.$parent.graph;e.dump.left=i+s/p.scale,e.dump.top=a+r/p.scale}t.stopPropagation(),t.preventDefault(),e.mouseDownPoint={$element:t.target,hasMoved:!1,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,button:0===t.button?"left":"right",left:e.dump.left,top:e.dump.top},document.addEventListener("mousemove",n),document.addEventListener("mouseup",function t(){e.mouseDownPoint&&"right"===e.mouseDownPoint.button?e.mouseDownPoint.hasMoved||e.contextMenu(e.mouseDownPoint.$element):e.mouseDownPoint.hasMoved?e.$root.moveState(e.dump.index,{editorData:e.getCenterXY()}):e.$parent.select(e.dump),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",t),e.mouseDownPoint=null})},dblclick(){this.$root.crumbState(this.dump.index)},contextMenu(t){const e=this,n=[];(e.isSubStateMachine||e.isBlendMotion)&&(n.push({label:Editor.I18n.t("animation-graph.crumbs.edit"),click(){e.$parent.select(e.dump),e.$root.crumbState(e.dump.index)}}),n.push({type:"separator"})),"exitState"!==e.dump.type&&(n.push({label:Editor.I18n.t("animation-graph.transition.add"),click(){e.$parent.addShadowLine(e.dump.id)}}),n.push({type:"separator"})),e.$root.queryData.cannotRemoveStateType.includes(e.dump.type)||(n.push({label:Editor.I18n.t("animation-graph.component.add"),click(){e.$root.addComponent(e.dump.index,t)}}),n.push({type:"separator"})),e.$root.queryData.cannotRemoveStateType.includes(e.dump.type)||n.push({label:Editor.I18n.t("animation-graph.state.remove"),click(){e.$root.removeState(e.dump.index)}}),Editor.Menu.popup({menu:n})},getCenter(){const t=this.$el.offsetWidth,e=this.$el.offsetHeight;return{left:this.dump.left+t/2,top:this.dump.top+e/2}},getCenterXY(){const t=this;return t.$parent.getCenterXY({width:t.dump.width,height:t.dump.height,left:t.dump.left,top:t.dump.top})}},exports.mounted=mounted;