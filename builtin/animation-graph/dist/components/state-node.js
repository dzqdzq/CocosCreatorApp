"use strict";function data(){return{twinkle:""}}function mounted(){this.refresh()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.computed=exports.data=exports.props=exports.template=void 0,exports.template='\n    <div class="state"\n        :style="style"\n        :twinkle="twinkle"\n        :subtype="subType"\n        @mousedown="mouseDown($event)"\n        @dblclick="crumb"\n    >\n        <div class="name" ref="name">\n            <ui-icon class="image" value="pose"\n                v-if="isPoseExpr"\n            ></ui-icon>\n            <ui-label class="label"\n                :value="dump.name"\n            ></ui-label>\n            <ui-icon class="icon" value="arrow-triangle-sharp"\n                v-if="isParent"\n            ></ui-icon>\n        </div>\n        <div class="starter"\n            @mousedown.left.stop="mouseDownStarter($event)"\n        >\n            <ui-icon class="icon" value="add"></ui-icon>\n        </div>\n    </div>\n',exports.props=["dump"],exports.data=data,exports.computed={style(){return{top:`${Math.ceil(this.dump.top)}px`,left:`${Math.ceil(this.dump.left)}px`}},isParent(){return this.isSubStateMachine||this.isBlendMotion||this.isPoseExpr},isSubStateMachine(){return this.dump.type===this.$root.queryData.envType.SubStateMachine},isBlendMotion(){const t=this;return t.dump.type===t.$root.queryData.envType.MotionState&&t.dump.props.motion&&t.$root.queryData.animationBlendType.includes(t.dump.props.motion.type)},isPoseExpr(){return this.dump.type===this.$root.queryData.envType.PoseExprState},canNotAddComponent(){return this.$root.stateCanNotAddComponent(this.dump.type)},canNotRemove(){return this.$root.stateCanNotRemove(this.dump.type)},canNotCopy(){return this.$root.stateCanNotCopy(this.dump.type)},subType(){var t,e;return null===(e=null===(t=this.dump.props)||void 0===t?void 0:t.motion)||void 0===e?void 0:e.type}},exports.watch={dump(){this.refresh()}},exports.methods={refresh(){const t=this;window.requestAnimationFrame(()=>{t.setPosition()})},resize(){this.setPosition()},setPosition(){const t=this;t.dump.width=t.$el.offsetWidth,t.dump.height=t.$el.offsetHeight;const e=t.$parent.getPosition({width:t.dump.width,height:t.dump.height,centerX:t.dump.editorData.centerX,centerY:t.dump.editorData.centerY});t.dump.top=e.top,t.dump.left=e.left},mouseDown(t){const e=this;function o(t){if(!e.mouseDownPoint||"right"===e.mouseDownPoint.button)return;t.stopPropagation(),t.preventDefault();const{clientX:o,clientY:n,left:i,top:s}=e.mouseDownPoint,a=t.clientX-o,p=t.clientY-n;if(Math.abs(a)<4&&Math.abs(p)<4)return;e.mouseDownPoint.hasMoved=!0;const r=e.$parent.$parent.graph;e.dump.left=i+a/r.scale,e.dump.top=s+p/r.scale}e.mouseDownPoint={$element:t.target,hasMoved:!1,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,button:0===t.button?"left":"right",left:e.dump.left,top:e.dump.top},"right"===e.mouseDownPoint.button&&t.stopPropagation(),document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){e.mouseDownPoint&&"right"===e.mouseDownPoint.button?e.mouseDownPoint.hasMoved||e.contextMenu(e.mouseDownPoint.$element):e.mouseDownPoint.hasMoved?e.$root.moveState(e.dump.index,{editorData:e.getCenterXY()}):e.$parent.select(e.dump),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t),e.mouseDownPoint=null})},mouseDownStarter(t){this.$parent.addShadowLine(this.dump.id)},crumb(){this.$parent.crumbState(this.dump.index)},contextMenu(t){const e=this,o=[];e.canNotCopy||o.push({label:Editor.I18n.t("animation-graph.state.copy"),click(){e.$root.copyState(e.dump.index)}},{label:Editor.I18n.t("animation-graph.state.duplicate"),click(){e.$root.duplicateState(e.dump.index)}},{type:"separator"}),e.isParent&&(o.push({label:Editor.I18n.t("animation-graph.crumbs.edit"),click(){e.$parent.select(e.dump),e.$root.crumbState(e.dump.index)}}),o.push({type:"separator"})),e.isBlendMotion&&(o.push({label:Editor.I18n.t("animation-graph.state.turnMotionStateIntoSubStateMachine"),click(){e.$root.turnMotionStateIntoSubStateMachine(e.dump.index)}}),o.push({type:"separator"})),"ExitState"!==e.dump.type&&(o.push({label:Editor.I18n.t("animation-graph.transition.add"),click(){e.$parent.addShadowLine(e.dump.id)}}),o.push({type:"separator"})),e.canNotAddComponent||(o.push({label:Editor.I18n.t("animation-graph.component.add"),click(){e.$root.addComponent(e.dump.index,t)}}),o.push({type:"separator"})),e.canNotRemove||o.push({label:Editor.I18n.t("animation-graph.state.remove"),click(){e.$root.removeState(e.dump.index)}}),Editor.Menu.popup({menu:o})},getCenter(){const t=this.$el.offsetWidth,e=this.$el.offsetHeight;return{left:this.dump.left+t/2,top:this.dump.top+e/2}},getCenterXY(){const t=this;return t.$parent.getCenterXY({width:t.dump.width,height:t.dump.height,left:t.dump.left,top:t.dump.top})}},exports.mounted=mounted;