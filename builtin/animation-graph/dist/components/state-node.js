"use strict";function data(){return{}}function mounted(){this.resize()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.watch=exports.computed=exports.data=exports.components=exports.props=exports.template=void 0,exports.template='\n    <div class="state"\n        :style="style"\n        :subtype="subType"\n        @mousedown="mouseDown($event)"\n        @dblclick="dblclick($event)"\n    >\n        <div class="name">\n            <ui-label ref="name" class="label"\n                :value="dump.name"\n            ></ui-label>\n            <ui-icon class="icon" value="arrow-right-bold"\n                v-if="hasSubContent"\n            ></ui-icon>\n        </div>\n        <layer ref="layer" sub-state-machine\n            v-if="dump.type===\'SubStateMachine\'"\n        ></layer>\n    </div>\n',exports.props=["dump"],exports.components={layer:require("./layer")},exports.data=data,exports.computed={style(){return{top:`${this.dump.top}px`,left:`${this.dump.left}px`}},hasSubContent(){const t=this,e=t.dump.type===t.$root.queryData.envType.SubStateMachine,o=t.dump.type===t.$root.queryData.envType.MotionState&&t.dump.props.motion&&t.$root.queryData.animationBlendType.includes(t.dump.props.motion.type);return e||o},subType(){var t,e;return null===(e=null===(t=this.dump.props)||void 0===t?void 0:t.motion)||void 0===e?void 0:e.type}},exports.watch={dump(){const t=this;t.$nextTick(()=>{t.resize()})}},exports.methods={resize(){const t=this;if(window.requestAnimationFrame(()=>{t.setPosition()}),t.$refs.layer){let e=0,o=t.$refs.layer.$el.parentElement;for(;o;)o.hasAttribute("sub-state-machine")&&e++,o=o.parentElement;e<3?t.$refs.layer.refresh("state",t.dump.stateMachine,!0):t.$refs.layer.$el.style.display="none"}},mouseDown(t){const e=this;function o(t){if(!e.mouseDownPoint||"right"===e.mouseDownPoint.button)return;t.stopPropagation(),t.preventDefault();const{clientX:o,clientY:n,left:s,top:i}=e.mouseDownPoint,p=t.clientX-o,r=t.clientY-n;if(0===p&&0===r)return;e.mouseDownPoint.hasMoved=!0;const a=e.$parent.$parent.graph;e.dump.left=s+p/a.scale,e.dump.top=i+r/a.scale}t.stopPropagation(),t.preventDefault(),e.mouseDownPoint={$element:t.target,hasMoved:!1,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,button:0===t.button?"left":"right",left:e.dump.left,top:e.dump.top},document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){e.mouseDownPoint&&"right"===e.mouseDownPoint.button?e.mouseDownPoint.hasMoved||e.contextMenu(e.mouseDownPoint.$element):e.mouseDownPoint.hasMoved?e.$root.moveState(e.dump.index,{editorData:e.getCenterXY()}):e.$parent.select(e.dump),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t),e.mouseDownPoint=null})},dblclick(){this.$root.crumbState(this.dump.index)},contextMenu(t){const e=this,o=[];e.hasSubContent&&(o.push({label:Editor.I18n.t("animation-graph.crumbs.edit"),click(){e.$parent.select(e.dump),e.$root.crumbState(e.dump.index)}}),o.push({type:"separator"})),"exitState"!==e.dump.type&&(o.push({label:Editor.I18n.t("animation-graph.transition.add"),click(){e.$parent.addShadowLine(e.dump.id)}}),o.push({type:"separator"})),e.$root.queryData.cannotRemoveStateType.includes(e.dump.type)||(o.push({label:Editor.I18n.t("animation-graph.component.add"),click(){e.$root.addComponent(e.dump.index,t)}}),o.push({type:"separator"})),e.$root.queryData.cannotRemoveStateType.includes(e.dump.type)||o.push({label:Editor.I18n.t("animation-graph.state.remove"),click(){e.$root.removeState(e.dump.index)}}),Editor.Menu.popup({menu:o})},getCenter(){const t=this.$el.offsetWidth,e=this.$el.offsetHeight;return{left:this.dump.left+t/2,top:this.dump.top+e/2}},setPosition(){const t=this;t.dump.width=t.$el.offsetWidth,t.dump.height=t.$el.offsetHeight;const e=t.$parent.getPosition({width:t.dump.width,height:t.dump.height,centerX:t.dump.editorData.centerX,centerY:t.dump.editorData.centerY});t.dump.top=e.top,t.dump.left=e.left},getCenterXY(){const t=this;return t.$parent.getCenterXY({width:t.dump.width,height:t.dump.height,left:t.dump.left,top:t.dump.top})}},exports.mounted=mounted;