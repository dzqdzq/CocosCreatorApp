"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extension=exports.config=exports.act=exports.$=void 0;const path_1=require("path");exports.$={panel:null,searchInput:null,toggleExpandIcon:null,viewBox:null,tree:null},exports.act={selects:[],twinkles:{},twinkleQueue:[]},exports.config={protocol:"db://",assetHeight:20,iconWidth:7,iconWidthMinus:8,nodeLeft:7,assetTypes(){return this.buildinTypes.concat(this.extendDrop.types)},buildinTypes:[],extendMenu:{packages:{},show(e,t){const s=[],n=this.packages;let i;t&&(i={displayName:t.displayName,extends:t.extends,importer:t.importer,isDirectory:t.isDirectory,instantiation:t.instantiation,imported:t.imported,invalid:t.invalid,name:t.name,file:t.file,redirect:t.redirect,readonly:t.readonly,type:t.type,url:t.url,uuid:t.uuid});for(const t in n){const o=n[t];if(!o)continue;const r=o[e];if(!r||!o.methods[r])continue;const a=o.methods[r](i);Array.isArray(a)&&a.length&&(s.push({type:"separator"}),s.push(...a))}return s},attach(e,t){exports.config.extendMenu.packages[e]=t},detach(e){delete exports.config.extendMenu.packages[e]}},extendDrop:{types:[],callbacks:{},attach(e,t){t.forEach(t=>{const s=t.type;s&&!this.types.includes(s)&&(this.types.push(s),this.callbacks[s]||(this.callbacks[s]={}),this.callbacks[s][e]=((s,n)=>{Editor.Message.send(e,t.message,s,n)}))})},detach(e,t){t.forEach(t=>{const s=t.type;s&&this.types.includes(s)&&(this.types=this.types.filter(e=>e!==s),this.callbacks[s]&&delete this.callbacks[s][e])})}},async update(){this.buildinTypes=await Editor.Message.request("asset-db","query-all-asset-types")}},exports.extension={attach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions.assets)try{const t=e.info.contributions.assets;if(Array.isArray(t.drop)&&exports.config.extendDrop.attach(e.name,t.drop),t.menu&&"string"==typeof t.menu.methods){const s=path_1.join(e.path,t.menu.methods);delete require.cache[s];const n=s.replace(/^\w\:/,e=>e.toLocaleUpperCase());delete require.cache[n],t.menu.methods=require(s),exports.config.extendMenu.attach(e.name,t.menu)}exports.$.tree.update()}catch(e){console.error(e)}},detach(e){if(!e.invalid&&e.info.contributions&&e.info.contributions.assets)try{const t=e.info.contributions.assets;Array.isArray(t.drop)&&exports.config.extendDrop.detach(e.name,t.drop),t.menu&&exports.config.extendMenu.detach(e.name),exports.$.tree.update()}catch(e){console.error(e)}}};