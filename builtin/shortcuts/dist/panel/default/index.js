"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),fs_extra_1=require("fs-extra"),utils_1=require("../../utils"),Vue=require("vue/dist/vue.js");let vm;Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./index.css"),"utf8"),exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../../static","./default/index.html"),"utf8"),exports.$={content:".content"},exports.methods={changeTab(t,e){vm&&(vm.active=t,vm.map[vm.active][e]&&(vm.msg=vm.map[vm.active][e]))}},exports.ready=async function(t=""){const e=this,s=require("../../../static/keyboard/qwerty.json");(vm=new Vue({el:e.$.content,data:{map:{},active:t,msg:null,left:s.left,right:s.right,editInfo:{},checkEditInfoTimer:null,dirty:!0,editFlag:{hasHandle:!1}},methods:{t:t=>Editor.I18n.t(`shortcuts.${t}`),async update(){const t=await Editor.Message.request("shortcuts","query-packages-shortcut-list"),e=this;e.map=t,e.active||(e.active=Object.keys(t)[0])},async startEditShortcuts(t,e){const s=this;if(clearTimeout(s.checkEditInfoTimer),await s._changeShortcuts(),e.missing){return void(1===await s.checkShouldRemove()&&s.clearShortcuts(null,e.key))}const i=t.currentTarget;i&&i.focus(),s.editInfo={key:e.key,shortcut:null,searches:[],conflict:!1,when:e.when,showSearches:!1}},checkShouldRemove:async()=>(await Editor.Dialog.info(Editor.I18n.t("shortcuts.invalid_shortcut.message"),{title:Editor.I18n.t("shortcuts.invalid_shortcut.title"),buttons:[Editor.I18n.t("shortcuts.invalid_shortcut.cancel"),Editor.I18n.t("shortcuts.invalid_shortcut.remove")],default:-1,cancel:-1})).response,async changeShortcuts(t){const e=this;e.editFlag.hasHandle||(e.checkEditInfoTimer=setTimeout(()=>{e._changeShortcuts()},300))},async _changeShortcuts(){const t=this;if(!await t.checkEditShortcutChanged())return void(t.editInfo={});const e=t.map[t.active][t.editInfo.key];e?vm.editInfo.searches&&(vm.editInfo.searches=[],vm.editInfo.conflict)?vm.editInfo={}:(await Editor.Message.request("shortcuts","change-shortcut",e,t.editInfo.shortcut)&&(e.rawShortcut=e.shortcut,e.shortcut=t.editInfo.shortcut),t.editInfo={},vm.dirty=!0):t.editInfo={}},checkEditShortcutChanged(){if(!this.editInfo||!this.editInfo.key||null===this.editInfo.shortcut)return!1;const t=this.editInfo.key,e=this.map[this.active][t];return!(!e||e.shortcut===this.editInfo.shortcut)},async resetShortcuts(t,e){this.editFlag.hasHandle=!0,clearTimeout(this.checkEditInfoTimer);const s=this.map[this.active][e],i=await Editor.Message.request("shortcuts","reset-shortcut",s);s.shortcut=i||s.rawShortcut,this.dirty=!0,this.editInfo={},this.editFlag.hasHandle=!1},async clearShortcuts(t,e){const s=this;s.editFlag.hasHandle=!0;const i=s.map[s.active][e];await Editor.Message.request("shortcuts","change-shortcut",i,"")&&(i.shortcut="",s.editInfo={},vm.dirty=!0),s.editFlag.hasHandle=!1},async checkApplyShortcut(){const t=this;if(await t.checkEditShortcutChanged()){(await Editor.Dialog.info(Editor.I18n.t("shortcuts.tips.is_apply"),{buttons:["cancel","save"],default:0})).response&&t.changeShortcuts()}},async onItemClick(t,e){const s=this;s.msg=s.map[s.active][e],s.editInfo&&s.editInfo.key!==e&&await s.checkApplyShortcut()},async onEditKeyDown(t){clearTimeout(vm.checkEditInfoTimer),t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),vm.editFlag.hasHandle=!1;const s=vm.editInfo;s.shortcut=utils_1.handleEventKey(t),await vm.updateShortCutList();const i=e.shortcutList[vm.editInfo.shortcut]||[];s.searches=i.filter(t=>t.key!==s.key),s.conflict=!!s.searches.find(t=>t.when===vm.editInfo.when)},async jumpToItem(t,e){clearTimeout(vm.checkEditInfoTimer),await vm._changeShortcuts(),vm.editFlag.hasHandle=!0,vm.active=e.pkgName,vm.map[vm.active][e.key]&&(vm.msg=vm.map[vm.active][e.key]),vm.editFlag.hasHandle=!1},async updateShortCutList(){vm.dirty&&(e.shortcutList=await Editor.Message.request("shortcuts","query-shortcut-map"),vm.dirty=!1)},getEditInfoState(t){return t&&t.searches&&t.searches.length?this.editInfo.conflict?"error":"warn":""}}})).update()},exports.beforeClose=function(){},exports.close=async function(){};