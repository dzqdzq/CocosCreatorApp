"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=void 0;const utils_1=require("./utils");let shortcutMap={};function keyDownHandle(e){const t=(0,utils_1.handleEventKey)(e);if(!t)return;const o=e.path[0];switch(t){case"ctrl+z":case"cmd+z":if("INPUT"===o.tagName||"TEXTAREA"===o.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.undo())}break;case"shift+ctrl+z":case"shift+cmd+z":if("INPUT"===o.tagName||"TEXTAREA"===o.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.redo())}break;case"ctrl+x":case"cmd+x":if((window.getSelection()||"").toString()){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.cut())}break;case"ctrl+c":case"cmd+c":if((window.getSelection()||"").toString()){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.copy())}break;case"ctrl+v":case"cmd+v":if("INPUT"===o.tagName||"TEXTAREA"===o.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.paste())}break;case"ctrl+a":case"cmd+a":if("INPUT"===o.tagName||"TEXTAREA"===o.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return void(t&&t.webContents.selectAll())}}if("INPUT"===o.tagName||"TEXTAREA"===o.tagName)return;const r=shortcutMap[t];if(Array.isArray(r)&&0!==r.length)for(const t of r)if(t.when){if(Editor.Utils.Parse.checkWhen(t.when)){e.preventDefault(),Editor.Message.send(t.pkgName,t.message,...t.params||[]);continue}}else e.preventDefault(),Editor.Message.send(t.pkgName,t.message,...t.params||[])}async function updateShortMap(){shortcutMap=await Editor.Message.request("shortcuts","query-shortcut-map")}async function load(){await updateShortMap(),Editor.Message.addBroadcastListener("shortcuts:change",updateShortMap),document.addEventListener("keydown",keyDownHandle)}function unload(){Editor.Message.removeBroadcastListener("shortcuts:change",updateShortMap),document.removeEventListener("keydown",keyDownHandle)}exports.load=load,exports.unload=unload;