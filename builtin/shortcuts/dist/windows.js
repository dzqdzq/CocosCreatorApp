"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=void 0;const utils_1=require("./utils");let shortcutMap={};const isWin="win32"===process.platform,isMac="darwin"===process.platform;function keyDownHandle(e){const t=(0,utils_1.handleEventKey)(e);if(!t)return;function r(){if("INPUT"===c.tagName||"TEXTAREA"===c.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.undo(),!0}}function n(){if("INPUT"===c.tagName||"TEXTAREA"===c.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.redo(),!0}}function o(){if((window.getSelection()||"").toString()){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.cut(),!0}}function a(){if((window.getSelection()||"").toString()){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.copy(),!0}}function s(){if("INPUT"===c.tagName||"TEXTAREA"===c.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.paste(),!0}}function i(){if("INPUT"===c.tagName||"TEXTAREA"===c.tagName){e.preventDefault();const t=require("@electron/remote").BrowserWindow.getFocusedWindow();return t&&t.webContents.selectAll(),!0}}const c=e.path[0];switch(t){case"ctrl+z":if(isWin&&r())return;break;case"cmd+z":if(isMac&&r())return;break;case"shift+ctrl+z":if(isWin&&n())return;break;case"shift+cmd+z":if(isMac&&n())return;break;case"ctrl+x":if(isWin&&o())return;break;case"cmd+x":if(isMac&&o())return;break;case"ctrl+c":if(isWin&&a())return;break;case"cmd+c":if(isMac&&a())return;break;case"ctrl+v":if(isWin&&s())return;break;case"cmd+v":if(isMac&&s())return;break;case"ctrl+a":if(isWin&&i())return;break;case"cmd+a":if(isMac&&i())return}if("INPUT"===c.tagName||"TEXTAREA"===c.tagName)return;const u=shortcutMap[t];if(Array.isArray(u)&&0!==u.length)for(const t of u)if(t.when){if(Editor.Utils.Parse.checkWhen(t.when)){e.preventDefault(),Editor.Message.send(t.pkgName,t.message,...t.params||[]);continue}}else e.preventDefault(),Editor.Message.send(t.pkgName,t.message,...t.params||[])}async function updateShortMap(){shortcutMap=await Editor.Message.request("shortcuts","query-shortcut-map")}async function load(){await updateShortMap(),Editor.Message.__protected__.addBroadcastListener("shortcuts:change",updateShortMap),document.addEventListener("keydown",keyDownHandle)}function unload(){Editor.Message.__protected__.removeBroadcastListener("shortcuts:change",updateShortMap),document.removeEventListener("keydown",keyDownHandle)}exports.load=load,exports.unload=unload;