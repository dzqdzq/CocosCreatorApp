"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const metrics_observer_base_1=require("./metrics-observer-base"),request_1=require("./request"),log_1=require("../libs/log"),TrackingID="UA-60734607-3";function sendData(e,t=!1){const o=Date.now();t&&log_1.logMgr.collectToFile(`send analytics: ${o}`,e),(0,request_1.sendHttpRequest)({method:"POST",host:"www.google-analytics.com",path:"/collect",protocol:"https",data:e},s=>{s?t&&log_1.logMgr.collectToFile(`send analytics fail: ${o}`,s):t&&log_1.logMgr.collectToFile(`send analytics done: ${o}`,e)})}class GoogleMetricsObserver extends metrics_observer_base_1.MetricsObserverBase{constructor(){super(),this._trackID=TrackingID}trackEvent(e,t){if(e.sendToCocosAnalyticsOnly||e.sendToNewCocosAnalyticsOnly)return;if(!t.cid)return void console.debug("Metrics: no valid client ID");if(!e.category||!e.action)return void console.debug("Metrics: no valid info");const o={v:1,tid:this._trackID,cid:t.cid,uid:t.uid,t:"event",ec:e.category,ea:e.action};e.label&&(o.el=e.label),e.value&&(o.ev=e.value),t.debug&&console.debug("send trackEvent analytics ---\x3e",JSON.stringify(o)),sendData(o,t.debug)}trackException(e,t){if(!t.cid)return void console.debug("Metrics: no valid client ID");const o={v:1,tid:this._trackID,cid:t.cid,uid:t.uid,t:"exception",exd:e.code+"-"+e.message,exf:0};t.debug&&console.debug("send trackException analytics ---\x3e",JSON.stringify(o)),sendData(o,t.debug)}sendAppInfo(e){const t={v:1,tid:this._trackID,cid:e.cid,uid:e.uid,t:"screenView",an:"CocosCreator",aid:"com.cocos.creator",av:Editor.App.version,cd:"Home",sc:"start",sr:e.resolution||"unknown",cd1:e.scaleFactor||"1",ul:Editor.I18n.getLanguage()||"unknown",ua:Editor.App.userAgent};e.debug&&console.debug("send sendAppInfo analytics ---\x3e",JSON.stringify(t)),sendData(t,e.debug)}close(e){}}module.exports=new GoogleMetricsObserver;