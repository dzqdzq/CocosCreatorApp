"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),fs_1=require("fs"),fs_extra_1=require("fs-extra"),list=exports.list=[],outputList=exports.outputList=[];let updateFn,lineHeight,animationId,collapse=!0,filterType="",filterText="",filterRegex=!1,isShowDate=!1;const logPath=path_1.join(Editor.Project.path,"local","logs","project.log");exports.logPath=logPath,exports.setUpdateFn=(t=>{updateFn=t}),exports.setLineHeight=(t=>{lineHeight=exports.lineHeight=t,exports.update()}),exports.addItems=(t=>{t.forEach(t=>{saveLog(t),exports.addItem(t)})}),exports.addItem=(t=>{const e={},s=t.message.toString().split("\n").filter(t=>""!==t.trim());e.type=t.type,t.stack&&"string"==typeof t.stack?(e.stack=t.stack.split(/(\r\n|\r|\n)/).filter(t=>/^[^\n|\r]+$/.test(t)),e.stack.shift()):e.stack=[],e.rows=s.length+e.stack.length,e.title=s[0]||"",e.content=s.splice(1),e.fold=!0,e.count=1,e.time=t.time,list.push(e),exports.update()}),exports.setCollapse=(t=>{collapse=t,exports.update()}),exports.setFilterType=(t=>{filterType="all"===t?"":t,exports.update()}),exports.setFilterText=(t=>{filterText=t,exports.update()}),exports.setFilterRegex=(t=>{filterRegex=t,exports.update()}),exports.showDate=(t=>{isShowDate=t,exports.update()}),exports.clear=(()=>{list.length=0,exports.update()});let updateLocker=!1;function saveLog(t){if(!t)return;fs_1.existsSync(logPath)||fs_extra_1.outputFileSync(logPath,"","utf-8");const e=`${timetrans(t.time)}-${t.type}: ${t.message}\n`;fs_1.appendFile(logPath,e,()=>{})}function timetrans(t){const e=new Date(t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}exports.update=(()=>{updateLocker||(updateLocker=!0,window.cancelAnimationFrame(animationId),animationId=requestAnimationFrame(()=>{let t=filterText,e=0;if(outputList.length=0,filterRegex)try{t=new RegExp(t)}catch(e){t=/.*/}list.filter(e=>{const s=!!e.title,o=!filterType||e.type===filterType,i=filterRegex?t.test(e.title):-1!==e.title.indexOf(t);return e.date=isShowDate?timetrans(e.time):null,s&&o&&i}).forEach(t=>{const s=outputList[outputList.length-1],o=s&&s.title===t.title&&s.type===t.type&&s.content.join("\n")===t.content.join("\n")&&s.stack.join("\n")===t.stack.join("\n");collapse&&o?s.count+=1:(t.count=1,t.translateY=e,outputList.push(t),e+=t.fold?lineHeight:t.rows*(lineHeight-2)+14)}),"function"==typeof updateFn&&updateFn(),updateLocker=!1}))});