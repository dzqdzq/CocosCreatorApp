"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=require("fs"),path_1=require("path"),utlis_1=require("../common/utlis");exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../css/index.css"),"utf8");const{I18n:I18n,Message:Message}=Editor;exports.listeners={resize(){this.$.tree.render(!0)}},exports.template='\n    <header>\n        <h1>\n            <ui-label value="i18n:package-asset.import.title"></ui-label>\n        </h1>\n        <ui-progress></ui-progress>\n    </header>\n    <section>\n        <ui-tree></ui-tree>\n        \n        <div class="loading">\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    </section>\n        \n    <footer>\n        <ui-button class="import">\n            <ui-label value="i18n:package-asset.import.button"></ui-label>\n        </ui-button>\n    </footer>\n',exports.$={tree:"ui-tree",select:".select",progress:"ui-progress",btnImport:".import",loading:".loading"};let _state=0;exports.methods={setState(t,s=0,e=""){switch(_state=t,t){case utlis_1.STATE.WAIT:this.$.progress.value=0,this.$.progress.message=I18n.t("package-asset.import.message.wait");break;case utlis_1.STATE.IDLE:this.$.progress.value=0,this.$.progress.message=I18n.t("package-asset.import.message.idle",{total:this.total});break;case utlis_1.STATE.LOADING:this.$.progress.message=Editor.I18n.t("package-asset.import.message.loading",{name:e,current:s.toString(),total:this.total}),this.$.progress.value=s/this.total*100}},async scanAssets(t){this.setState(utlis_1.STATE.WAIT),this.zipAssets=await utlis_1.getImportAssets(t);const s=await utlis_1.analyticalContent(this.zipAssets);this.$.loading.style.display="none",this.$.tree.tree=s,this.updateTotal()},updateTotal(){this.list=[];const t=s=>{s.forEach(s=>{if(s.detail.checked){if(!s.detail.legal)return;let e=s.detail.asset.name;e.endsWith("/")&&(e=e.substring(e.length-1,0)),this.zipAssets[e+".meta"]?(this.list.push(s.detail.asset),this.list.push(this.zipAssets[e+".meta"]),t(s.children)):console.warn(`Asset is not exported by Creator: ${e}`)}})};t(this.$.tree.tree),this.total=this.list.length/2,this.setState(utlis_1.STATE.IDLE),this.total>0?this.$.btnImport.removeAttribute("disabled"):this.$.btnImport.setAttribute("disabled","")},async importAssets(){this.updateTotal(),this.$.btnImport.setAttribute("disabled",""),await utlis_1.doImportAssets(this.list,(t,s)=>{this.setState(utlis_1.STATE.LOADING,s,t)}),this.$.btnImport.removeAttribute("disabled"),Editor.Panel.close("package-asset.import")}},exports.ready=async function(t){utlis_1.initTemplate(this),Message.addBroadcastListener("i18n:change",()=>{this.setState(_state)}),this.$.btnImport.addEventListener("confirm",async()=>{await this.importAssets()}),await this.scanAssets(t)},exports.beforeClose=utlis_1.beforeClose,exports.close=utlis_1.close;