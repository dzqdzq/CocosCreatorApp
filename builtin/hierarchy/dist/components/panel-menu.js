"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.popupContextMenu=exports.popupSearchMenu=exports.popupPanelMenu=exports.popupCreateMenu=void 0;const electron_1=require("electron"),panelData=__importStar(require("./panel-data")),utils=__importStar(require("./utils"));function prependCancelSearchMenu(e){return utils.isSearching()&&e.unshift({label:Editor.I18n.t("hierarchy.menu.cancelSearch"),click(){panelData.$.panel.clearSearch()}},{type:"separator"}),e}function createMenu(e){return[{template:"create-node",enabled:utils.enableContextMenu(),click:t=>(e(t.params[0]),!1)}]}async function popupCreateMenu(){utils.enableContextMenu()&&Editor.Menu.popup({menu:createMenu(e=>{panelData.$.tree.addTo(e)})})}function createPanelMenu(){return[{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:utils.enableContextMenu(),submenu:createMenu(e=>{panelData.$.tree.addTo(e)})},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.isNoneCopyOrCut()&&utils.enableContextMenu(),click(){panelData.$.tree.paste()}}]}async function popupPanelMenu(){const e=createPanelMenu();prependCancelSearchMenu(e),Editor.Menu.popup({menu:e})}function createSearchMenu(){const{searchType:e}=panelData.$.panel;return[{label:Editor.I18n.t("hierarchy.menu.searchName"),type:"radio",checked:"name"===e,click(){panelData.$.panel.searchType="name"}},{label:Editor.I18n.t("hierarchy.menu.searchUuid"),type:"radio",checked:"uuid"===e,click(){panelData.$.panel.searchType="uuid"}},{label:Editor.I18n.t("hierarchy.menu.searchPath"),type:"radio",checked:"path"===e,click(){panelData.$.panel.searchType="path"}},{label:Editor.I18n.t("hierarchy.menu.searchComponent"),type:"radio",checked:"component"===e,click(){panelData.$.panel.searchType="component"}},{label:Editor.I18n.t("hierarchy.menu.searchAsset"),type:"radio",checked:"asset"===e,click(){panelData.$.panel.searchType="asset"}}]}async function popupSearchMenu(){Editor.Menu.popup({menu:createSearchMenu()})}function createConsoleMenu(e){return[{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.showUuid"),click(){electron_1.clipboard.writeText(e.uuid),console.info("UUID ",Editor.I18n.t("hierarchy.menu.doneCopied")," ",e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.showPath"),click(){electron_1.clipboard.writeText(e.path),console.info("PATH ",Editor.I18n.t("hierarchy.menu.doneCopied")," ",e.path)}}]}function createEditPrefab(e){return!(e.prefab&&e.prefab.state&&3!==e.prefab.state)||e.prefab.assetUuid.includes("@")||e.prefab.assetUuid===panelData.act.assetUuid?[]:[{label:Editor.I18n.t("hierarchy.menu.edit_prefab"),enabled:e.prefab&&e.prefab.assetUuid,click(){Editor.Message.request("asset-db","open-asset",e.prefab.assetUuid)}},{type:"separator"}]}function createLocateAsset(e){return e.isScene||!e.prefab||e.prefab.state?[{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.locateAsset"),enabled:utils.isExistedAsset(),click(){e.isScene?Editor.Message.send("assets","twinkle",panelData.act.assetUuid):e.prefab&&e.prefab.state&&Editor.Message.send("assets","twinkle",e.prefab.assetUuid)}}]:[]}function createSceneMenu(e){return[{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:!utils.canNotCreateNode(e)&&utils.enableContextMenu(),submenu:createMenu(t=>{t.parent=e.uuid,panelData.$.tree.addTo(t)})},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.canNotPasteNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.paste(e.uuid)}},...createLocateAsset(e),...createConsoleMenu(e)]}function createNodeMenu(e){return[...createEditPrefab(e),{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:!utils.canNotCreateNode(e)&&utils.enableContextMenu(),submenu:createMenu(t=>{t.parent=e.uuid,panelData.$.tree.addTo(t)})},{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.copy"),accelerator:"CmdOrCtrl+C",enabled:!utils.canNotCopyNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.copy(e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.duplicate"),accelerator:"CmdOrCtrl+D",enabled:!utils.canNotCopyNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.duplicate(e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.cut"),accelerator:"CmdOrCtrl+X",enabled:!utils.canNotCutNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.cut(e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.canNotPasteNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.paste(e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.rename"),accelerator:"Enter",enabled:!utils.canNotRename(e)&&utils.enableContextMenu(),click(){panelData.$.tree.renameUuid=e.uuid}},...createLocateAsset(e),{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.selectAll"),accelerator:"CmdOrCtrl+A",click(){panelData.$.tree.selectAll(e.uuid)}},{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.delete"),accelerator:"Delete",enabled:!utils.canNotDeleteNode(e)&&utils.enableContextMenu(),click(){panelData.$.tree.delete(e.uuid)}},...createConsoleMenu(e)]}async function popupContextMenu(e){const t=e.isScene||e.isPrefabRoot?createSceneMenu(e):createNodeMenu(e);prependCancelSearchMenu(t),Editor.Menu.popup({menu:t})}exports.popupCreateMenu=popupCreateMenu,exports.popupPanelMenu=popupPanelMenu,exports.popupSearchMenu=popupSearchMenu,exports.popupContextMenu=popupContextMenu;