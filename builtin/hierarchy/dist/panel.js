"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.listeners=exports.methods=exports.$=exports.fonts=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),electron_1=require("electron"),panel_data_1=require("./components/panel-data"),panel_menu_1=require("./components/panel-menu"),utils=__importStar(require("./components/utils")),Vue=require("vue/dist/vue.js");let panel,vm;async function ready(){(vm=new Vue({el:(panel=this).$.content,components:{tree:require("./components/tree")},data:{sceneReady:!1,state:"",assetType:"",assetUuid:"",animationUuid:"",isOperating:!1,isRefreshing:!1,droppableTypes:["cc.Node"],allExpand:null,viewWidth:0,viewHeight:0,treeHeight:0,dropBox:{},searchValue:"",searchType:"name"},watch:{searchValue(){panel_data_1.vueElement.tree.search(),vm.$nextTick(()=>{!vm.searchValue&&utils.scrollIntoView(panel_data_1.vueElement.tree.intoView)})},searchType(){panel_data_1.vueElement.tree.search()},animationUuid(){vm.refresh(!0)}},computed:{searchPlaceholder(){let e=this.searchType;return"name"===e&&(e="name or uuid"),"component"===e&&(e="component name"),"asset"===e&&(e="asset uuid"),`i18n:hierarchy.menu.searchPlaceholder ${e}`},searchTypeTip(){const e=this.searchType.toLocaleUpperCase().substr(0,1)+this.searchType.substr(1);return this.t(`menu.search${e}`)}},mounted(){panel_data_1.vueElement.panel=this,panel_data_1.vueElement.searchInput=this.$refs.searchInput,panel_data_1.vueElement.toggleExpandIcon=this.$refs.toggleExpandIcon,panel_data_1.vueElement.viewBox=this.$refs.viewBox,panel_data_1.vueElement.tree=this.$refs.tree,this.$refs.viewBox.addEventListener("scroll",e=>{vm.treeHeight>vm.viewHeight&&vm.treeHeight<vm.viewHeight+e.target.scrollTop?panel_data_1.vueElement.tree.scrollTop=vm.treeHeight-vm.viewHeight:panel_data_1.vueElement.tree.scrollTop=e.target.scrollTop},!1),this.resize()},methods:{t:e=>Editor.I18n.t(`hierarchy.${e}`),async refresh(e=!1){try{vm.sceneReady=!1,await panel_data_1.configData.update(),panel_data_1.vueElement.tree.update(),await panel_data_1.vueElement.tree.refresh(e)}catch(e){console.error(e)}finally{vm.sceneReady=!0}},async animationStart(e){await vm.refresh(!0),vm.animationUuid=e},animationEnd(){vm.animationUuid=""},allToggle(){panel_data_1.vueElement.tree.allToggle()},searchChange(){vm.searchValue=panel_data_1.vueElement.searchInput.value.trim()},searchArrowDown(e){e.target.blur(),panel_data_1.vueElement.tree.ipcSelectFirstChild()},popupCreateMenu:panel_menu_1.popupCreateMenu,popupSearchMenu:panel_menu_1.popupSearchMenu,popupPanelMenu:panel_menu_1.popupPanelMenu,resize(){vm&&(vm.viewWidth=panel.clientWidth,vm.viewHeight=panel_data_1.vueElement.viewBox.offsetHeight,panel_data_1.vueElement.tree.filterNodes())},focusWindow(){electron_1.remote.getCurrentWindow().focus()}}})).sceneReady=await Editor.Message.request("scene","query-is-ready"),vm.sceneReady&&(await exports.methods.unstaging(),await vm.refresh(),panel_data_1.vueElement.tree.resetSelected()),new IntersectionObserver(e=>{e.forEach(e=>{0!==e.intersectionRatio&&vm.resize()})},{root:vm.$el,rootMargin:"0px",threshold:.1}).observe(panel_data_1.vueElement.viewBox),Editor.Package.getPackages({enable:!0}).forEach(panel_data_1.attach),Editor.Package.on("enable",panel_data_1.attach),Editor.Package.on("disable",panel_data_1.detach)}async function beforeClose(){vm&&await exports.methods.staging()}async function close(){vm&&(vm.dbReady=!1),Editor.Package.removeListener("enable",panel_data_1.attach),Editor.Package.removeListener("disable",panel_data_1.detach)}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_1.readFileSync(path_1.join(__dirname,"../dist/index.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../static","/template/index.html"),"utf8"),exports.fonts=[{name:"hierarchy"}],exports.$={content:".hierarchy"},exports.methods={async staging(){if(!vm||!vm.sceneReady)return;const e=panel_data_1.vueElement.tree.getExpandLevels();await Editor.Message.request("hierarchy","staging",{assetUuid:vm.assetUuid,animationUuid:vm.animationUuid,expandLevels:e})},async unstaging(){const{expandLevels:e,animationUuid:t,assetUuid:a}=await Editor.Message.request("hierarchy","unstaging",vm.assetUuid);if(Array.isArray(e)&&vm.$set(panel_data_1.vueElement.tree.folds,"expandLevels",e),a&&(vm.assetUuid=a),t){const e=await Editor.Message.request("scene","query-scene-mode");vm.animationUuid="animation"===e?t:""}},find(){panel_data_1.vueElement.searchInput.focus()},copy(){panel_data_1.vueElement.tree.copy()},paste(){panel_data_1.vueElement.tree.paste()},cut(){panel_data_1.vueElement.tree.cut()},duplicate(){panel_data_1.vueElement.tree.duplicate()},delete(){panel_data_1.vueElement.tree.delete()},up(){panel_data_1.vueElement.tree.upDownLeftRight("up")},down(){panel_data_1.vueElement.tree.upDownLeftRight("down")},left(){panel_data_1.vueElement.tree.upDownLeftRight("left")},right(){panel_data_1.vueElement.tree.upDownLeftRight("right")},shiftUp(){panel_data_1.vueElement.tree.shiftUpDown("up")},shiftDown(){panel_data_1.vueElement.tree.shiftUpDown("down")},rename(){panel_data_1.vueElement.tree.keyboardRename()},selectAll(){panel_data_1.vueElement.tree.selectAll()},selectClear(){panel_data_1.vueElement.tree.selectClear()},async ready(e){const t=vm.assetUuid!==e;t&&(vm.assetUuid=e,panel_data_1.vueElement.tree.clear()),await exports.methods.unstaging(),await vm.refresh(t),panel_data_1.vueElement.tree.resetSelected()},async close(){await exports.methods.staging()},async animationStart(e){vm&&vm.sceneReady&&(await exports.methods.staging(),vm.animationStart(e))},animationEnd(){vm&&vm.sceneReady&&vm.animationEnd()},changed(e){vm&&vm.sceneReady&&panel_data_1.vueElement.tree.changed(e)},added(e){vm&&vm.sceneReady&&panel_data_1.vueElement.tree.added(e)},deleted(e){vm&&vm.sceneReady&&panel_data_1.vueElement.tree.deleted(e)},selected(e,t){vm&&vm.sceneReady&&"node"===e&&panel_data_1.vueElement.tree.selected(t)},unselected(e,t){vm&&vm.sceneReady&&"node"===e&&panel_data_1.vueElement.tree.unselected(t)},twinkle(e){utils.scrollIntoView(e),utils.twinkle.add(e,"shake")}},exports.listeners={resize(){vm&&vm.resize()},show(){vm&&vm.resize()}},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;