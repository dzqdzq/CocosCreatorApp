const{expect:expect}=require("chai"),{checkBuildOptions:checkBuildOptions}=require("./../dist/config/platforms-options.js"),{join:join,relative:relative}=require("path");describe("构建数据验证测试",()=>{let e;before(async()=>{const t=await Editor.Message.request("asset-db","query-assets",{type:"scene"});if(!t||0===t.length){const t="db://internal/default_file_content/scene",s=await Editor.Message.request("asset-db","query-path",t);e="db://assets/newScene.scene",await Editor.Message.request("asset-db","import-asset",s,e,{overwrite:!0})}}),describe("name 名称验证测试",()=>{it("名称不能为空",async()=>{const e=await checkBuildOptions("name","");expect(e.error).to.not.equal("")}),it("名称不能带有中文",async()=>{const e=await checkBuildOptions("name","测试名字");expect(e.error).not.to.equal("")})}),describe("outputName 名称验证测试",()=>{it("名称不能为空",async()=>{const e=await checkBuildOptions("outputName","");expect(e.error).to.not.equal("")}),it("名称不能带有中文",async()=>{const e=await checkBuildOptions("outputName","测试名字");expect(e.error).not.to.equal("")})}),describe("platform 验证测试",()=>{it("不支持的构建平台 newPlatform",async()=>{const e=await checkBuildOptions("platform","newPlatform");expect(e.error).to.not.equal(""),expect(e.newValue).to.be.null})}),describe("startScene 验证测试",()=>{it("startScene 52fbcf09 不存在",async()=>{const e=await checkBuildOptions("startScene","52fbcf09");expect(e.error).to.not.equal(""),expect(e.newValue).to.be.null})}),describe("scenes 验证测试",()=>{it("场景数据不能为空",async()=>{const e=await checkBuildOptions("scenes",[]);expect(e.error).to.not.equal(""),expect(e.newValue).to.be.null}),it("场景数据混入不存在的资源要被剔除，剔除后的场景数据为空要报错",async()=>{const e=await checkBuildOptions("scenes",[{uuid:"ahisbfbj",url:"ad://asset/njjdks.scene"}]);expect(e.error).to.not.equal(""),expect(e.newValue).to.be.null}),it("场景数据混入不存在的资源要被剔除",async()=>{const e=(await Editor.Message.request("asset-db","query-assets",{type:"scene"})).map(e=>({url:e.url,uuid:e.uuid}));e.push({uuid:"jkjdishdj",url:"db://assets/jjidji.scene"});const t=await checkBuildOptions("scenes",e);expect(t.error).to.not.equal(""),expect(t.newValue.length).to.be.equal(e.length-1)})}),describe("buildPath 路径验证测试",()=>{const e={platform:"wechatgame"};it("路径不能包含空格",async()=>{const t=await checkBuildOptions("buildPath","/build test",e);expect(t.error).to.not.equal("")}),it("路径不能带有中文",async()=>{const t=await checkBuildOptions("buildPath","/测试路径",e);expect(t.error).not.to.equal("")}),it("路径检查后需要改为相对于项目的路径",async()=>{const t=join(Editor.Project.path,"./build"),s=await checkBuildOptions("buildPath",t,e);expect(s.error).to.equal(""),expect(s.newValue).to.equal(relative(Editor.Project.path,t))})}),after(()=>{e&&Editor.Message.send("asset-db","delete-asset",e)})});