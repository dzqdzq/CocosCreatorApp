import{setBaseUrl}from"./base-url.js";import{setImportMap}from"./import-map.js";import{systemJSPrototype}from"systemjs-source/system-core.js";export default function({pathname:t="/",importMap:e,importMapUrl:n,defaultHandler:r,handlers:o}){if(setBaseUrl(`no-schema:${t}`),setImportMap(e,`no-schema:/${n}`),r&&hookInstantiationOverSchema("no-schema:",wrapHandler(r)),o)for(const t of Object.keys(o))hookInstantiationOverSchema(t,wrapHandler(o[t]))};function isThenable(t){return Boolean(t&&"function"==typeof t.then)}function wrapHandler(t){return function(e){const n=this;let r;try{r=t(e)}catch(t){return Promise.reject(t)}return isThenable(r)?new Promise(t=>r.then(()=>{t(n.getRegister())})):n.getRegister()}}function hookInstantiationOverSchema(t,e){const n=systemJSPrototype.instantiate;systemJSPrototype.instantiate=function(r,o){const s=r.substr(0,t.length)===t?r.substr(t.length):null;return null===s?n.call(this,r,o):e.call(this,s,o)}}