"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),LIBRARY_NAME="library";async function handle(e,s,t){for(const e of s.bundles)console.group(`Handle bundle ${e.name}`),await Promise.all(e.assetsWithoutRedirect.map(s=>{if(s.length<=15)return Promise.resolve();const r=t.getAssetInfo(s);return copyAssetFile(path_1.join(e.dest,e.nativeBase),r)})),console.debug(`Asset Bundle(${e.name}) handle assets: ${e.assets.length}`),console.groupEnd()}function copyAssetFile(e,s){return Promise.all(Object.keys(s.library).map(t=>{if(".json"===t)return Promise.resolve();const r=s.library[t],o=path_1.relative(path_1.join(Editor.Project.path,LIBRARY_NAME),r);if(!fs_extra_1.existsSync(r))return console.error(Editor.I18n.t("builder.error.missing_import_files",{path:`{link(${r})}`,url:`{asset(${s.url})}`})),Promise.resolve();const n=path_1.join(path_1.join(e,o));return fs_extra_1.existsSync(n)?Promise.resolve():fs_extra_1.copy(r,n)}))}exports.title="i18n:tasks.build_asset",exports.handle=handle;