"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,r,a){void 0===a&&(a=r),Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,a){void 0===a&&(a=r),t[a]=e[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&__createBinding(e,t,r);return __setModuleDefault(e,t),e},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.outputImportMap=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),babel=__importStar(require("@babel/core")),preset_env_1=__importDefault(require("@babel/preset-env"));async function outputImportMap(t,e,r,a){const{content:o,extension:i}=await transformImportMap(t,r),n=path_1.default.join(e,`import-map${i}`);a.paths.importMap=n,await fs_extra_1.default.ensureDir(path_1.default.dirname(n)),await fs_extra_1.default.writeFile(n,o,{encoding:"utf8"})}async function transformImportMap(t,e){var r;const{importMapFormat:a}=e.buildScriptParam;let o,i=JSON.stringify(t,void 0,e.debug?2:0);if(void 0===a)o=".json";else{o=".js";const t=`export default ${i}`;i=null===(r=await babel.transformAsync(t,{presets:[[preset_env_1.default,{modules:"esm"!==a&&a}]]}))||void 0===r?void 0:r.code}return{extension:o,content:i}}exports.outputImportMap=outputImportMap;