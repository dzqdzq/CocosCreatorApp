"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,a){void 0===a&&(a=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,a,r)}:function(e,t,i,a){void 0===a&&(a=i),e[a]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildEngineCommand=void 0;const ccBuild=__importStar(require("@cocos/build-engine")),build_engine_1=require("@cocos/build-engine"),path_1=require("path"),fs_extra_1=require("fs-extra"),defaultOptions={engine:"",platform:"HTML5",moduleFormat:{preset:"web"},compress:!0,split:!1,ammoJsWasm:"js",assetURLFormat:"runtime-resolved",noDeprecatedFeatures:!1,engineName:"cocos-js",sourceMaps:!1,features:[],loose:!1,mode:"BUILD",flags:{DEBUG:!1,UI_GPU_DRIVEN:!1},name:"cocos-js"};async function buildEngineCommand(e){const t=Object.assign({},defaultOptions,e||{}),{features:i,out:a}=t;await(0,fs_extra_1.remove)(a),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(a));const r=await ccBuild.build(t);if(t.split){const a=await build_engine_1.StatsQuery.create(t.engine),n=await ccBuild.build.transform(a.evaluateIndexModuleSource(a.getUnitsOfFeatures(i)),ccBuild.ModuleOption.system),s=(0,path_1.join)(e.out,"cc.js");await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(s)),await(0,fs_extra_1.writeFile)(s,n.code,"utf8"),r.exports.cc="cc.js"}await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(t.metaFile)),await(0,fs_extra_1.writeJSON)(t.metaFile,r,{spaces:2})}exports.buildEngineCommand=buildEngineCommand;