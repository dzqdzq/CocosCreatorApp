"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const fs_extra_1=require("fs-extra");exports.title="i18n:tasks.settings.cache";const layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;async function handle(e,r,t){const s=r.settings;s.debug=e.debug,s.designResolution=e.appTemplateData.resolution,s.platform=e.platform||s.platform,s.server=e.appTemplateData.server,s.customLayers=e.customLayers.map(e=>{const r=layerMask.findIndex(r=>e.value===r);return{name:e.name,bit:r}}),s.customLayers.sort((e,r)=>e.bit-r.bit);const a=await Editor.Profile.getProject("project","general.renderPipeline","default");s.renderPipeline=e.renderPipeline===a?"":e.renderPipeline,s.CocosEngine=Editor.App.version;const o={url:Editor.App.icon,displayRatio:.4,totalTime:3e3,effect:"",clearColor:{x:.88,y:.88,z:.88,w:1},displayWatermark:!0};let n=await Editor.Profile.getProject("builder","splash-setting");if(e.replaceSplashScreen&&n)try{n=Object.assign({},o,n),s.splashScreen=formatSplashScreen(n)}catch(e){console.error(e),console.error(Editor.I18n.t("builder.error.missingSplashTips",{splashScreen:JSON.stringify(n)})),s.splashScreen=formatSplashScreen(o)}else s.splashScreen=formatSplashScreen(o);for(const t of r.bundles)t.config.debug=e.debug}function formatSplashScreen(e){const r=Editor.UI.File.resolveToRaw(e.url);return e.base64src=`data:image/png;base64,${fs_extra_1.readFileSync(r).toString("base64")}`,delete e.url,e}exports.handle=handle;