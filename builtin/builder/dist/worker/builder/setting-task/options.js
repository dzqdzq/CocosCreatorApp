"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const fs_extra_1=require("fs-extra");exports.title="i18n:tasks.settings.cache";const layerMask=[];for(let e=0;e<=19;e++)layerMask[e]=1<<e;async function handle(e,r,t){const a=r.settings;a.debug=e.debug,a.designResolution=e.appTemplateData.resolution,a.platform=e.platform||a.platform,a.server=e.appTemplateData.server,a.customLayers=e.customLayers.map(e=>{const r=layerMask.findIndex(r=>e.value===r);return{name:e.name,bit:r}});const s=await Editor.Profile.getProject("project","general.renderPipeline","default");a.renderPipeline=e.renderPipeline===s?"":e.renderPipeline,a.CocosEngine=Editor.App.version;const n={url:Editor.App.icon,displayRatio:.4,totalTime:3e3,effect:"",clearColor:{x:.88,y:.88,z:.88,w:1},displayWatermark:!0};let o=await Editor.Profile.getProject("builder","splash-setting");if(e.replaceSplashScreen&&o)try{o=Object.assign({},n,o),a.splashScreen=formatSplashScreen(o)}catch(e){console.error(e),a.splashScreen=formatSplashScreen(n)}else a.splashScreen=formatSplashScreen(n);for(const t of r.bundles)t.config.debug=e.debug}function formatSplashScreen(e){const r=Editor.UI.File.resolveToRaw(e.url);return e.base64src=`data:image/png;base64,${fs_extra_1.readFileSync(r).toString("base64")}`,delete e.url,e}exports.handle=handle;