"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAssetPathInfo=getAssetPathInfo,exports.getJsonPath=getJsonPath,exports.getImportPathInfo=getImportPathInfo,exports.resolveImportPath=resolveImportPath,exports.resolveNativePath=resolveNativePath,exports.getRawAssetPaths=getRawAssetPaths;const path_1=require("path"),asset_library_1=require("../../manager/asset-library"),utils_1=require("../../utils"),cconb_1=require("../../utils/cconb");function getAssetPathInfo(t,e){var s;return e.containsAsset(t,!0)&&(s=getImportPathInfo(t,e),t=getRawAssetPaths(t,e),s||t.length)?(e={},s&&Object.assign(e,s),t.length&&(e.raw=t),e):null}function getJsonPath(t,e){return getImportPathInfo(t,e)?.json||""}function getImportPathInfo(e,t){var s,r;return t.containsAsset(e)&&(s=asset_library_1.buildAssetLibrary.getAsset(e))&&(s=getImportExtName(s))?(t=resolveImportPath((r=t.groups.find(t=>t.uuids.includes(e)))?r.name:e,t,s),r?{import:t,[s.replace(".","")]:t,groupIndex:r.uuids.indexOf(e)}:{import:t,[s.replace(".","")]:t}):null}function resolveImportPath(t,e,s){return(0,utils_1.getResImportPath)(e.dest,t+(e.assetVer.import[t]?"."+e.assetVer.import[t]:""),s)}function resolveNativePath(t,e,s){var r=(0,path_1.basename)(t,e),r=s.assetVer.native[r],t=t.replace((0,utils_1.getLibraryDir)(t),(0,path_1.join)(s.dest,Build.NATIVE_HEADER));return r?t.replace(e,"."+r+e):t}function getImportExtName(t){return(0,cconb_1.hasCCONFormatAssetInLibrary)(t)?".bin":t.meta.files.includes(".json")?".json":""}function getRawAssetPaths(e,s){if(!s.containsAsset(e,!0))return[];const r=asset_library_1.buildAssetLibrary.getAsset(e);if(!r)return console.error(`Can't get assetInfo of uuid {asset(${e})}`),[];const a=getImportExtName(r);var t=r.meta.files.filter(t=>t!==a),n=asset_library_1.buildAssetLibrary.getAssetProperty(r,"type");if("cc.Script"===n)return[s.scriptDest];if("cc.ImageAsset"===n&&s.compressRes[e]){const p=s.assetVer.native[e];return s.compressRes[e].map(t=>t.replace(e,p?e+"."+p:""))}if(["cc.ImageAsset","cc.SpriteFrame","cc.SpriteAtlas"].includes(n)){var o=(s.atlasRes.assetsToImage[e]?[s.atlasRes.assetsToImage[e]]:s.atlasRes.atlasToImages[e])||[];if(o.length){var i=[];for(const u of o)if(u&&s.containsAsset(u)){const c=s.assetVer.native[u];s.compressRes[u]?i.push(...s.compressRes[u].map(t=>{var e=(0,utils_1.getUuidFromPath)(t);return t.replace(e,c?e+"."+c:"")})):i.push((0,utils_1.getResRawAssetsPath)(s.dest,u,c?`.${c}.png`:".png"))}return i}}return"cc.TTFFont"===n&&s.assetVer.native[e]?t.map(t=>(0,utils_1.getResRawAssetsPath)(s.dest,`${e}.${s.assetVer.native[e]}/`,t)):t.length?t.map(t=>resolveNativePath(r.library+t,t,s)):[]}