"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRawAssetPaths=exports.resolveNativePath=exports.resolveImportPath=exports.getJsonPathInfo=exports.getJsonPath=exports.getAssetPathInfo=void 0;const path_1=require("path"),asset_library_1=require("../../manager/asset-library"),utils_1=require("../../utils");function getAssetPathInfo(t,e){if(!e.containsAsset(t,!0))return null;const s=getJsonPathInfo(t,e),r=getRawAssetPaths(t,e);if(!s&&!r.length)return null;const o={};return s&&(o.json=s.json,s.groupIndex&&(o.groupIndex=s.groupIndex)),r&&(o.raw=r),o}function getJsonPath(t,e){var s;return(null===(s=getJsonPathInfo(t,e))||void 0===s?void 0:s.json)||""}function getJsonPathInfo(t,e){if(!e.containsAsset(t))return null;const s=asset_library_1.buildAssetLibrary.getAssetInfo(t);if(s&&!Object.keys(s.library).includes(".json"))return null;const r=e.groups.find(e=>e.uuids.includes(t));return r?{json:resolveImportPath(r.name,e),groupIndex:r.uuids.indexOf(t)}:{json:resolveImportPath(t,e)}}function resolveImportPath(t,e){return(0,utils_1.getResImportPath)(e.dest,t+(e.assetVer.import[t]?"."+e.assetVer.import[t]:""))}function resolveNativePath(t,e,s){const r=(0,path_1.basename)(t,e),o=s.assetVer.native[r],n=t.replace((0,path_1.join)(Editor.Project.path,Build.LIBRARY_NAME),(0,path_1.join)(s.dest,Build.NATIVE_HEADER));return o?n.replace(e,`.${o}${e}`):n}function getRawAssetPaths(t,e){if(!e.containsAsset(t,!0))return[];const s=asset_library_1.buildAssetLibrary.getAssetInfo(t);if(!s)return console.error(`Can't get assetInfo of uuid {asset(${t})}`),[];const r=Object.keys(s.library).filter(t=>".json"!==t);if("cc.Script"===s.type)return[e.scriptDest];if("cc.ImageAsset"===s.type&&e.compressRes[t])return e.compressRes[t];if(["cc.ImageAsset","cc.SpriteFrame","cc.SpriteAtlas"].includes(s.type)){const s=(e.atlasRes.assetsToImage[t]?[e.atlasRes.assetsToImage[t]]:e.atlasRes.atlasToImages[t])||[];if(s.length){const t=[];for(const r of s){if(!r)continue;if(e.compressRes[r]){t.push(...e.compressRes[r]);continue}const s=e.assetVer.native[r];t.push((0,utils_1.getResRawAssetsPath)(e.dest,r,s?`.${s}.png`:".png"))}return t}}return"cc.TTFFont"===s.type&&e.assetVer.native[t]?r.map(s=>(0,utils_1.getResRawAssetsPath)(e.dest,`${t}.${e.assetVer.native[t]}/`,s)):r.map(t=>resolveNativePath(s.library[t],t,e))}exports.getAssetPathInfo=getAssetPathInfo,exports.getJsonPath=getJsonPath,exports.getJsonPathInfo=getJsonPathInfo,exports.resolveImportPath=resolveImportPath,exports.resolveNativePath=resolveNativePath,exports.getRawAssetPaths=getRawAssetPaths;