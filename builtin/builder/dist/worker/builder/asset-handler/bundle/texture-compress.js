"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bundleDataTask=bundleDataTask,exports.bundleOutputTask=bundleOutputTask;const fs_extra_1=require("fs-extra"),path_1=require("path"),asset_library_1=require("../../manager/asset-library");function bundleDataTask(a,t){a.assetsWithoutRedirect.forEach(s=>{var s=asset_library_1.buildAssetLibrary.getAsset(s),e=t.addTaskWithAssetInfo(s);e&&(a.compressTask[s.uuid]=e)}),console.debug(`init image compress task ${Object.keys(a.compressTask).length} in bundle `+a.name)}async function bundleOutputTask(i,e){await Promise.all(Object.keys(i.compressTask).map(async t=>{const r=i.compressTask[t];if(r.dest&&r.dest.length){const n=[];i.compressRes[t]=[],await Promise.all(r.dest.map(async(s,e)=>{var a;(0,fs_extra_1.existsSync)(s)&&(a=(0,path_1.join)(i.dest,i.nativeBase,t.substr(0,2),(0,path_1.basename)(s)),await(0,fs_extra_1.copy)(s,a),n.push(r.suffix[e]),i.compressRes[t].push(a))}));var s=await e.getInstance(t);s._exportedExts=n.sort(),e.addInstance(s)}else delete i.compressTask[t]}))}