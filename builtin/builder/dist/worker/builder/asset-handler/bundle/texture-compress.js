"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bundleOutputTask=exports.bundleDataTask=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),asset_library_1=require("../../manager/asset-library");function bundleDataTask(s,e){s.assetsWithoutRedirect.forEach(t=>{const a=asset_library_1.buildAssetLibrary.getAssetInfo(t),r=e.addTaskWithAssetInfo(a);r&&(s.compressTask[a.uuid]=r)}),console.debug(`init image compress task ${Object.keys(s.compressTask).length} in bundle ${s.name}`)}async function bundleOutputTask(s,e){await Promise.all(Object.keys(s.compressTask).map(async t=>{const a=s.compressTask[t];if(!a.dest||!a.dest.length)return void delete s.compressTask[t];Editor.Utils.Path.contains(s.dest,a.src)&&await(0,fs_extra_1.remove)(a.src);const r=[];await Promise.all(a.dest.map(async(e,n)=>{if(!(0,fs_extra_1.existsSync)(e))return;const i=(0,path_1.join)(s.dest,s.nativeBase,t.substr(0,2),(0,path_1.basename)(e));await(0,fs_extra_1.copy)(e,i),r.push(a.suffix[n])}));const n=await e.getInstance(t);n._exportedExts=r.sort(),e.addInstance(n)}))}exports.bundleDataTask=bundleDataTask,exports.bundleOutputTask=bundleOutputTask;