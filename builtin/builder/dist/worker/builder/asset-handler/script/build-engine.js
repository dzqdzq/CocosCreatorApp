"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildSeparateEngine=void 0,exports.buildEngineCommand=buildEngineCommand;const ccbuild_1=require("@cocos/ccbuild"),path_1=require("path"),fs_extra_1=require("fs-extra"),defaultOptions={engine:"",out:"",platform:"INVALID_PLATFORM",moduleFormat:"system",compress:!0,split:!1,nativeCodeBundleMode:"both",assetURLFormat:"runtime-resolved",noDeprecatedFeatures:!1,sourceMap:!1,features:[],loose:!1,mode:"BUILD",flags:{DEBUG:!1},metaFile:"",mangleProperties:!1,inlineEnum:!0};async function buildEngineCommand(e){var t,a=Object.assign({},defaultOptions,e||{}),{features:i,out:n}=a,n=(await(0,fs_extra_1.remove)(n),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(n)),console.debug("start build engine with options: "+JSON.stringify(a)),await(0,ccbuild_1.buildEngine)(a)),i=(a.split&&(t=await ccbuild_1.StatsQuery.create(a.engine),t=await ccbuild_1.buildEngine.transform(t.evaluateIndexModuleSource(t.getUnitsOfFeatures(i)),"system"),i=(0,path_1.join)(e.out,"cc.js"),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(i)),await(0,fs_extra_1.writeFile)(i,t.code,"utf8"),n.exports.cc="cc.js"),n);0!==e.mangleConfigJsonMtime&&(i.mangleConfigJsonMtime=e.mangleConfigJsonMtime),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(a.metaFile)),await(0,fs_extra_1.writeJSON)(a.metaFile,i,{spaces:2})}var separate_engine_1=require("./separate-engine");Object.defineProperty(exports,"buildSeparateEngine",{enumerable:!0,get:function(){return separate_engine_1.buildSeparateEngine}});