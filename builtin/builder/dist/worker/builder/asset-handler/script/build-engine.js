"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildEngineCommand=void 0;const ccbuild_1=require("@cocos/ccbuild"),path_1=require("path"),fs_extra_1=require("fs-extra"),defaultOptions={engine:"",platform:"HTML5",moduleFormat:{preset:"web"},compress:!0,split:!1,ammoJsWasm:"js",assetURLFormat:"runtime-resolved",noDeprecatedFeatures:!1,engineName:"cocos-js",sourceMaps:!1,features:[],loose:!1,mode:"BUILD",flags:{DEBUG:!1},name:"cocos-js"};async function buildEngineCommand(e){const t=Object.assign({},defaultOptions,e||{}),{features:a,out:s}=t;await(0,fs_extra_1.remove)(s),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(s));const i=await(0,ccbuild_1.buildEngine)(t);if(t.split){const s=await ccbuild_1.StatsQuery.create(t.engine),r=await ccbuild_1.buildEngine.transform(s.evaluateIndexModuleSource(s.getUnitsOfFeatures(a)),"system"),n=(0,path_1.join)(e.out,"cc.js");await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(n)),await(0,fs_extra_1.writeFile)(n,r.code,"utf8"),i.exports.cc="cc.js"}await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(t.metaFile)),await(0,fs_extra_1.writeJSON)(t.metaFile,i,{spaces:2})}exports.buildEngineCommand=buildEngineCommand;