"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.splitGroups=splitGroups,exports.walk=walk,exports.hasGroups=hasGroups;const asset_library_1=require("../manager/asset-library"),_=require("lodash");function splitGroups(r,e=!1){if(r.length<2)return r;var s=[r[0]];e:for(let e=1;e<r.length;e++){let t=r[e];var n=s.length;for(let r=0;r<n;r++){let e=s[r];var i=_.intersection(e,t),u=e.length,a=t.length,l=i.length;if(0!==l)if(l===u){if(u===a)continue e;t=_.difference(t,i)}else{if(l===a){u!==a&&(e=_.difference(e,i),s[r]=e,s.push(i));continue e}t=_.difference(t,i),e=_.difference(e,i),s[r]=e,s.push(i)}}s.push(t)}if(e){var e=_.flatten(s),t=_.uniq(e);if(t.length<e.length)return console.warn("Internal error: SizeMinimized.transformGroups: res not unique, transform canceled"),r;e=_.flatten(r);if(0<_.difference(e,t).length)return console.warn("Internal error: SizeMinimized.transformGroups: not have the same members, transform canceled"),r}return s}async function walk(e,i){const u=[],a=new Set,l=e;return await async function r(t){if(a.add(t.uuid),!i.getRedirect(t.uuid)&&!u.includes(t.uuid)){t.meta.files.includes(".json")&&u.push(t.uuid);var s=(await asset_library_1.buildAssetLibrary.getDependUuids(t.uuid)||[]).filter(e=>{return!!(e=asset_library_1.buildAssetLibrary.getAsset(e))&&((e=asset_library_1.buildAssetLibrary.getAssetProperty(e,"type"))?"cc.Texture2D"!==e&&cc.js.getClassByName(e):void 0)});for(let e=0;e<s.length;e++){var n=s[e];a.has(n)?n!==t.uuid&&n!==l.uuid||console.debug(`[json-group] check self or raw asset, skip. ${n} depended by ${t.uuid} has checked in raw asset ${l.uuid}/bundle(${i.name})}`):await r(asset_library_1.buildAssetLibrary.getAsset(n))}}}(e),!u||u.length<1?e.meta.files.includes(".json")?[e.uuid]:[]:(!u.includes(e.uuid)&&e.meta.files.includes(".json")&&u.push(e.uuid),[...new Set(u)])}function hasGroups(r,t){for(let e=0;e<t.length;e++){var s=t[e];for(let e=0;e<s.length;e++)if(s[e]===r)return!0}return!1}