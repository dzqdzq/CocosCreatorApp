"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.name=exports.title=void 0;const bundle_utils_1=require("../../../../share/bundle-utils"),utils_1=require("./utils");async function handle(e,s,o){let t=0;for(const e of s.bundles)if(e.compressionType!==bundle_utils_1.BundleCompressionTypes.NONE)if(e.compressionType===bundle_utils_1.BundleCompressionTypes.MERGE_ALL_JSON)e.addGroup("NORMAL",e.assetsWithoutRedirect),t++;else{const s={},n=[],r=e.scenes.concat(e.rootAssets);for(const t of r){if(e.getRedirect(t))continue;const r=o.getAssetInfo(t),u=await utils_1.walk(r,o,e);u.length<=1||(n.push(...u),s[t]=u)}Object.keys(s).forEach(e=>{const o=s[e];o&&JSON.parse(JSON.stringify(o)).forEach(o=>{e!==o&&s[o]&&(console.debug(`remove group uuid ${o}`),delete s[o])})}),Object.values(s).forEach((s,o)=>{s.length<=1||(e.addGroup("NORMAL",s),t++)})}console.debug(`Number of json group: ${t}`)}function handleBundleGroup(e,s){e.scenes.concat(e.rootAssets)}exports.title="i18n:builder.tasks.sort_json",exports.name="data-task/json",exports.handle=handle;