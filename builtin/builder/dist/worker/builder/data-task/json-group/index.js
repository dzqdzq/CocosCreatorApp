"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.name=exports.title=void 0;const bundle_utils_1=require("../../../../share/bundle-utils"),utils_1=require("./utils");async function handle(e,s,t){let o=0;for(const e of s.bundles)if(e.compressionType!==bundle_utils_1.BundleCompressionTypes.NONE)if(e.compressionType===bundle_utils_1.BundleCompressionTypes.MERGE_ALL_JSON)e.addGroup("NORMAL",e.assetsWithoutRedirect),o++;else{const s={},n=[],r=e.scenes.concat(e.rootAssets);for(const o of r){if(e.getRedirect(o))continue;const r=t.getAssetInfo(o);let l=await utils_1.walk(r,t,e);l.length<=1||((l=l.filter(e=>!n.includes(e))).length<=1||(n.push(...l),s[o]=l))}Object.keys(s).forEach(e=>{const t=s[e];t&&JSON.parse(JSON.stringify(t)).forEach(t=>{e!==t&&s[t]&&(console.debug(`remove group uuid ${t}`),delete s[t])})}),Object.values(s).forEach((s,t)=>{s.length<=1||(e.addGroup("NORMAL",s),o++)})}console.debug(`Number of json group: ${o}`)}exports.title="i18n:builder.tasks.sort_json",exports.name="data-task/json",exports.handle=handle;