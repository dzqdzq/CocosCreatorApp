"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.name=exports.title=void 0;const bundle_utils_1=require("../../../../share/bundle-utils"),utils_1=require("./utils");async function handle(e,s,o){let t=0;for(const e of s.bundles)if(e.compressionType!==bundle_utils_1.BundleCompressionTypes.NONE)if(e.compressionType===bundle_utils_1.BundleCompressionTypes.MERGE_ALL_JSON)e.addGroup("NORMAL",e.assetsWithoutRedirect),console.debug(`Number of json group with bundle(${e.name}): ${e.groups.length}`),t++;else{console.debug(`Start sort the json group of bundle(${e.name})...`);const s={},n=[],u=e.scenes.concat(e.rootAssets);for(const t of u){if(e.getRedirect(t))continue;const u=o.getAssetInfo(t);let r=await(0,utils_1.walk)(u,o,e);r.length<=1||((r=r.filter(e=>!n.includes(e))).length<=1||(n.push(...r),s[t]=r))}Object.keys(s).forEach(e=>{const o=s[e];o&&JSON.parse(JSON.stringify(o)).forEach(o=>{e!==o&&s[o]&&(console.debug(`remove group uuid ${o}`),delete s[o])})}),Object.values(s).forEach((s,o)=>{s.length<=1||(e.addGroup("NORMAL",s),t++)}),console.debug(`Number of json group with bundle(${e.name}) ${e.groups.length}`)}console.debug(`Number of json group: ${t}`)}exports.title="i18n:builder.tasks.sort_json",exports.name="data-task/json",exports.handle=handle;