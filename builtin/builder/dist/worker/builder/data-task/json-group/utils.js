"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasGroups=exports.walk=exports.splitGroups=void 0;const _=require("lodash");function splitGroups(e,t=!1){if(e.length<2)return e;const n=[e[0]];e:for(let t=1;t<e.length;t++){let r=e[t];const s=n.length;for(let e=0;e<s;e++){let t=n[e];const s=_.intersection(t,r),i=t.length,u=r.length,o=s.length;if(0!==o)if(o===i){if(i===u)continue e;r=_.difference(r,s)}else{if(o===u){i!==u&&(t=_.difference(t,s),n[e]=t,n.push(s));continue e}r=_.difference(r,s),t=_.difference(t,s),n[e]=t,n.push(s)}}n.push(r)}if(t){const t=_.flatten(n),r=_.uniq(t);if(r.length<t.length)return console.warn("Internal error: SizeMinimized.transformGroups: res not unique, transform canceled"),e;{const t=_.flatten(e);if(_.difference(t,r).length>0)return console.warn("Internal error: SizeMinimized.transformGroups: not have the same members, transform canceled"),e}}return n}async function walk(e,t,n){const r=[],s=new Set,i=e;return await async function e(u){if(s.add(u.uuid),n.getRedirect(u.uuid))return;if(r.includes(u.uuid))return;u.library[".json"]&&r.push(u.uuid);const o=(await t.getDependUuids(u.uuid)||[]).filter(e=>{const n=t.getAssetInfo(e);return!(!n||!n.type)&&"cc.Texture2D"!==n.type&&cc.js.getClassByName(n.type)});for(let r=0;r<o.length;r++){const l=o[r];if(s.has(l)){if(l===u.uuid||l===i.uuid){console.debug(`[json-group] check self or raw asset, skip. ${l} depended by ${u.uuid} has checked in raw asset ${i.uuid}/bundle(${n.name})}`);continue}}else await e(t.getAssetInfo(l))}}(e),!r||r.length<1?e.library[".json"]?[e.uuid]:[]:(!r.includes(e.uuid)&&e.library[".json"]&&r.push(e.uuid),[...new Set(r)])}function hasGroups(e,t){for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++)if(r[t]===e)return!0}return!1}exports.splitGroups=splitGroups,exports.walk=walk,exports.hasGroups=hasGroups;