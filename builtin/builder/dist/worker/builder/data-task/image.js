"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.name=exports.title=void 0;const path_1=require("path"),bundle_utils_1=require("../../../share/bundle-utils");async function handle(e,s,t){let a=0;async function o(e,o){const n=e.uuid,{userData:{compressSettings:r,hasAlpha:i}}=await t.getMeta(n);if(!r||!r.useCompressTexture)return;const p=path_1.extname(e.source),u=e.library[p]||e.library[".png"];if(!u)return void console.warn(`Image asset does not exist: ${e.source}`);const l=path_1.basename(u);s.imageTaskMap[n]?(s.imageTaskMap[n].dest.push(path_1.join(n.substr(0,2),l)),s.imageTaskMap[n].bundleNames.push(o.name)):s.imageTaskMap[n]={src:u,dest:[path_1.join(n.substr(0,2),l)],presetId:r.presetId,hasAlpha:i,bundleNames:[o.name]},a++}const n={};for(const e of s.bundles){path_1.join(e.dest,e.nativeBase);const s=[];for(const a of e.assetsWithoutRedirect){n[a]=!0;const r=t.getAssetInfo(a);"image"===r.importer&&(s.push(a),await o(r,e))}e.compressionType!==bundle_utils_1.BundleCompressionTypes.NONE&&e.compressionType!==bundle_utils_1.BundleCompressionTypes.MERGE_ALL_JSON&&(s.length>1&&(s.sort((e,s)=>e.localeCompare(s,"en",{numeric:!0})),s.forEach(s=>{e.removeFromGroups(s)}),e.addGroup("IMAGE",s)))}console.debug(`Number of image-compress task: ${a}`)}exports.title="i18n:tasks.sort_image",exports.name="data-task/image",exports.handle=handle;