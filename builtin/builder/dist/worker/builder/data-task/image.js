"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.name=exports.title=void 0;const path_1=require("path");async function handle(e,t,s){if(!e.compressTexture)return console.debug("未开启图片压缩");let a=0;async function o(e,o){const r=s.getAssetInfo(e);if("image"!==r.importer)return;const{userData:{compressSettings:n,hasAlpha:i}}=await s.getMeta(e);if(!n||!n.useCompressTexture)return;const p=path_1.join(o,e.substr(0,2)),c=path_1.extname(r.source),u=r.library[c]||r.library[".png"];if(!u)return void console.warn(`Image asset does not exist: ${r.source}`);const d=path_1.basename(u);t.imageTaskMap[e]?t.imageTaskMap[e].dest.push(path_1.join(p,d)):t.imageTaskMap[e]={src:u,dest:[path_1.join(p,d)],presetId:n.presetId,hasAlpha:i},a++}const r={};for(const e of t.bundles){const t=path_1.join(e.dest,e.nativeBase);for(const s of e.assetsWithoutRedirect)r[s]=!0,await o(s,t)}console.debug(`Number of image-compress task: ${a}`)}exports.title="i18n:tasks.sort_image",exports.name="data-task/image",exports.handle=handle;