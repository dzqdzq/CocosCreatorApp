"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),babel=__importStar(require("@babel/core")),preset_env_1=__importDefault(require("@babel/preset-env"));async function handle(e,t){await outputImportMap(t.importMap,e,t)}async function outputImportMap(e,t,r){const{content:a}=await transformImportMap(e,t),i=r.paths.importMap;await fs_extra_1.default.ensureDir(path_1.default.dirname(i)),await fs_extra_1.default.writeFile(i,a,{encoding:"utf8"})}async function transformImportMap(e,t){var r;const{importMapFormat:a}=t.buildScriptParam;let i,n=JSON.stringify(e,void 0,t.debug?2:0);if(void 0===a)i=".json";else{i=".js";const e=`export default ${n}`;n=null===(r=await babel.transformAsync(e,{presets:[[preset_env_1.default,{modules:"esm"!==a&&a}]]}))||void 0===r?void 0:r.code}return{extension:i,content:n}}exports.title="i18n:builder.tasks.build_import_map",exports.handle=handle;