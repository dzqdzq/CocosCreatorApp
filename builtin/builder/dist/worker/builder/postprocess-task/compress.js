"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const EditorExtends=require("@base/electron-module").require("EditorExtends"),compressUuid=EditorExtends.UuidUtils.compressUuid;async function handle(s,e,t){if(!s.debug){for(const s of e.bundles){const e=s.config,t=o(e),n=e.paths,r=e.paths={},c=e.types=[];for(const s in n){const e=n[s],o=t[s];let i=c.indexOf(e[1]);-1===i&&(i=c.length,c.push(e[1])),e[1]=i,r[o]=e}const i=e.scenes;for(const s in i){const e=t[i[s]];i[s]=Number(e)}for(const s in e.extensionMap){const o=e.extensionMap[s];for(let s=0;s<o.length;++s){const e=t[o[s]];o[s]=e}}const u=e.packs;for(const s in u){const e=u[s];for(let s=0;s<e.length;++s){const o=t[e[s]];e[s]=o}}const d=e.versions;for(const s of Object.values(d))for(let e=0;e<s.length;e+=2){const o=t[s[e]];s[e]=Number(o)}const f=e.redirect;for(let s=0;s<f.length;s+=2){const e=t[f[s]];f[s]=Number(e)}}s.debug||(e.settings.renderPipeline=compressUuid(e.settings.renderPipeline,!0))}function o(s){const e={},t={};function o(s){const o=(e[s]||0)+1;e[s]=o,s in t||(t[s]=s)}const n=s.paths;for(const s in n)o(s);const r=s.scenes;for(const s in r)o(r[s]);for(const e in s.extensionMap)s.extensionMap[e].forEach(o);const c=s.packs,i=Object.keys(c).sort();for(const s of i)c[s].forEach(o);const u=s.versions;for(const s of Object.values(u))for(let e=0;e<s.length;e+=2)o(s[e]);const d=s.redirect;for(let s=0;s<d.length;s+=2)o(d[s]);return s.uuids.sort((s,t)=>e[t]-e[s]),s.uuids.forEach((s,e)=>t[s]=String(e)),s.uuids=s.uuids.map(s=>compressUuid(s,!0)),t}}exports.title="i18n:tasks.postprocess.compress",exports.handle=handle;