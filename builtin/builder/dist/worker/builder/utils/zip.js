"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compressDirs=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),global_1=require("../../global"),JsZip=require("jszip");async function compressDirs(e,r,s){await new Promise(t=>{const o=new JsZip,i=[],a=(0,path_1.parse)(global_1.BuildGlobalInfo.BUNDLE_ZIP_NAME).name;e.forEach(e=>{getFilesInDirectory(i,e)});const n={date:new Date("2021.06.21 06:00:00Z"),createFolders:!1};i.forEach(e=>{const s=(0,path_1.relative)(r,e);let t=(0,path_1.join)(a,s);t=t.replace(/\\/g,"/"),o.file(t,(0,fs_extra_1.readFileSync)(e),n)}),o.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}).then(r=>{(0,fs_extra_1.writeFileSync)(s,r),e.forEach(e=>{(0,fs_extra_1.removeSync)(e)}),t()})})}function getFilesInDirectory(e,r){(0,fs_extra_1.readdirSync)(r).forEach(s=>{const t=(0,path_1.join)(r,s);(0,fs_extra_1.statSync)(t).isDirectory()?getFilesInDirectory(e,t):e.push(t)})}exports.compressDirs=compressDirs;