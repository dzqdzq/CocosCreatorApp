"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,s,e,i){void 0===i&&(i=e),Object.defineProperty(t,i,{enumerable:!0,get:function(){return s[e]}})}:function(t,s,e,i){void 0===i&&(i=e),t[i]=s[e]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,s){Object.defineProperty(t,"default",{enumerable:!0,value:s})}:function(t,s){t.default=s}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var s={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&__createBinding(s,t,e);return __setModuleDefault(s,t),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.taskManager=void 0;const Editor=__importStar(require("editor"));class TaskManager{constructor(){this._optionsDebug=!1,this._internalDebug=!1,this.tasks={dataTasks:["data-task/load-script","data-task/bundle","data-task/asset","data-task/script","data-task/image","data-task/json-group","data-task/texture"],buildTasks:["build-task/script/index","build-task/pac","build-task/image/index","build-task/asset","build-task/json","build-task/zip","build-task/suffix"],settingTasks:["setting-task/init","setting-task/macro","setting-task/options","setting-task/joint-texture-layout","setting-task/joint-physics","setting-task/script","setting-task/scene","setting-task/group","setting-task/md5"],postprocessTasks:["postprocess-task/compress","postprocess-task/save-config","postprocess-task/save-settings","postprocess-task/template"]},this.pluginTasks={onBeforeBuild:"onBeforeBuild",onBeforeInit:"onBeforeInit",onAfterInit:"onAfterInit",onBeforeBuildAssets:"onBeforeBuildAssets",onAfterBuildAssets:"onAfterBuildAssets",onBeforeCompressSettings:"onBeforeCompressSettings",onAfterCompressSettings:"onAfterCompressSettings",onAfterBuild:"onAfterBuild"},this.cacheConfig={engine:!0,settings:!1},this.taskWeight={dataTasks:.2,buildTasks:.4,settingTasks:.05,postprocessTasks:.05,pluginTasks:.3},this.debugTaskConfig={dataTasks:{},settingTasks:{},buildTasks:{}}}get debug(){return this._optionsDebug||this._internalDebug}async init(){this.debugTaskConfig.settingTasks["setting-task/cache"]=!1,this._optionsDebug=!1;const t=await Editor.Profile.getConfig("builder","debug-tools.config");t&&t.config&&Object.assign(this.debugTaskConfig,t.config),t&&t.cacheConfig&&Object.assign(this.cacheConfig,t.cacheConfig)}getTaskHandle(t,s){if(this.debug){const s=this.debugTaskConfig[t],e=[];return this.tasks[t].forEach(t=>{!1!==s[t]&&e.push(require(`./${t}`))}),e}return s&&"dataTasks"===t?["data-task/bundle","data-task/asset","data-task/script"].map(t=>require(`./${t}`)):this.tasks[t].map(t=>require(`./${t}`))}setDebugConfig(t,s,e){this.debugTaskConfig[t]&&s&&(this.debugTaskConfig[t][s]=e)}setRecompileTask(t){if(!t||!t.enable||this._internalDebug)return;this._optionsDebug=!0;const{generateAssets:s,generateScripts:e,generateEngineByCache:i}=t;this.cacheConfig.engine=i,this.setDebugConfig("dataTasks","data-task/script",e),this.setDebugConfig("buildTasks","build-task/script",e),this.setDebugConfig("settingTasks","setting-task/script",e),this.tasks.buildTasks.forEach(t=>{["build-task/script"].includes(t)||exports.taskManager.setDebugConfig("buildTasks",`${t}`,s)}),this.setDebugConfig("settingTasks","setting-task/scene",s),this.setDebugConfig("settingTasks","setting-task/group",s),this.setDebugConfig("settingTasks","setting-task/md5",s),this.setDebugConfig("settingTasks","setting-task/cache",!e||!s)}}exports.taskManager=new TaskManager;