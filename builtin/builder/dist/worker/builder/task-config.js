"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.taskManager=void 0;const global_1=require("../../share/global");class TaskManager{get debug(){return this._optionsDebug||global_1.BuildGlobalInfo.debugMode}_optionsDebug=!1;tasks={dataTasks:["data-task/asset","data-task/script"],buildTasks:["build-task/script","build-task/asset"],md5Tasks:["postprocess-task/suffix"],settingTasks:["setting-task/asset","setting-task/script","setting-task/options"],postprocessTasks:["postprocess-task/template"]};pluginTasks={onBeforeBuild:"onBeforeBuild",onBeforeInit:"onBeforeInit",onAfterInit:"onAfterInit",onBeforeBuildAssets:"onBeforeBuildAssets",onAfterBuildAssets:"onAfterBuildAssets",onBeforeCompressSettings:"onBeforeCompressSettings",onAfterCompressSettings:"onAfterCompressSettings",onAfterBuild:"onAfterBuild",onBeforeCopyBuildTemplate:"onBeforeCopyBuildTemplate",onAfterCopyBuildTemplate:"onAfterCopyBuildTemplate",onError:"onError"};cacheConfig={engine:!0,settings:!1};taskWeight={dataTasks:.1,buildTasks:.1,md5Tasks:.1,settingTasks:.05,postprocessTasks:.05,pluginTasks:.2,bundleTask:.3};debugTaskConfig={dataTasks:{},settingTasks:{},buildTasks:{}};async init(){this.debugTaskConfig.settingTasks["setting-task/cache"]=!1,this._optionsDebug=!1;var s=await Editor.Profile.getConfig("builder","debug-tools.config");s&&s.config&&Object.assign(this.debugTaskConfig,s.config),s&&s.cacheConfig&&Object.assign(this.cacheConfig,s.cacheConfig)}getTaskHandle(s){if(this.debug){const e=this.debugTaskConfig[s],t=[];return this.tasks[s].forEach(s=>{!1!==e[s]&&t.push(require("./"+s))}),t}return this.tasks[s].map(s=>require("./tasks/"+s))}getTaskHandleFromNames(s){return s.map(s=>require("./tasks/"+s))}setDebugConfig(s,e,t){this.debugTaskConfig[s]&&e&&(this.debugTaskConfig[s][e]=t)}setRecompileTask(s){if(s&&s.enable&&!global_1.BuildGlobalInfo.debugMode){this._optionsDebug=!0;const{generateAssets:e,generateScripts:t,generateEngineByCache:i}=s;this.cacheConfig.engine=i,this.setDebugConfig("dataTasks","data-task/script",t),this.setDebugConfig("buildTasks","build-task/script",t),this.setDebugConfig("settingTasks","setting-task/script",t),this.tasks.buildTasks.forEach(s=>{["build-task/script"].includes(s)||exports.taskManager.setDebugConfig("buildTasks",""+s,e)}),this.setDebugConfig("settingTasks","setting-task/scene",e),this.setDebugConfig("settingTasks","setting-task/group",e),this.setDebugConfig("settingTasks","setting-task/md5",e),this.setDebugConfig("settingTasks","setting-task/cache",!t||!e)}}}exports.taskManager=new TaskManager;