"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.taskManager=void 0;class TaskManager{constructor(){this._optionsDebug=!1,this.tasks={dataTasks:["data-task/load-script","data-task/bundle","data-task/asset","data-task/script","data-task/image","data-task/json-group","data-task/texture","data-task/import-map"],buildTasks:["build-task/pac","build-task/image/index","build-task/assets/index","build-task/json","build-task/zip","build-task/script/index"],md5Tasks:["build-task/suffix"],settingTasks:["setting-task/init","setting-task/macro","setting-task/options","setting-task/joint-texture-layout","setting-task/joint-physics","setting-task/script","setting-task/scene","setting-task/group","setting-task/md5"],postprocessTasks:["postprocess-task/import-map","postprocess-task/compress","postprocess-task/save-config","postprocess-task/save-settings","postprocess-task/template"]},this.pluginTasks={onBeforeBuild:"onBeforeBuild",onBeforeInit:"onBeforeInit",onAfterInit:"onAfterInit",onBeforeBuildAssets:"onBeforeBuildAssets",onAfterBuildAssets:"onAfterBuildAssets",onBeforeCompressSettings:"onBeforeCompressSettings",onAfterCompressSettings:"onAfterCompressSettings",onAfterBuild:"onAfterBuild",onError:"onError"},this.cacheConfig={engine:!0,settings:!1},this.taskWeight={dataTasks:.1,buildTasks:.4,md5Tasks:.1,settingTasks:.05,postprocessTasks:.05,pluginTasks:.2},this.debugTaskConfig={dataTasks:{},settingTasks:{},buildTasks:{}}}get debug(){return this._optionsDebug||Build.debugMode}async init(){this.debugTaskConfig.settingTasks["setting-task/cache"]=!1,this._optionsDebug=!1;const s=await Editor.Profile.getConfig("builder","debug-tools.config");s&&s.config&&Object.assign(this.debugTaskConfig,s.config),s&&s.cacheConfig&&Object.assign(this.cacheConfig,s.cacheConfig)}getTaskHandle(s,t){if(this.debug){const t=this.debugTaskConfig[s],e=[];return this.tasks[s].forEach(s=>{!1!==t[s]&&e.push(require(`./${s}`))}),e}return t&&"dataTasks"===s?["data-task/bundle","data-task/asset","data-task/script"].map(s=>require(`./${s}`)):this.tasks[s].map(s=>require(`./${s}`))}setDebugConfig(s,t,e){this.debugTaskConfig[s]&&t&&(this.debugTaskConfig[s][t]=e)}setRecompileTask(s){if(!s||!s.enable||Build.debugMode)return;this._optionsDebug=!0;const{generateAssets:t,generateScripts:e,generateEngineByCache:a}=s;this.cacheConfig.engine=a,this.setDebugConfig("dataTasks","data-task/script",e),this.setDebugConfig("buildTasks","build-task/script",e),this.setDebugConfig("settingTasks","setting-task/script",e),this.tasks.buildTasks.forEach(s=>{["build-task/script"].includes(s)||exports.taskManager.setDebugConfig("buildTasks",`${s}`,t)}),this.setDebugConfig("settingTasks","setting-task/scene",t),this.setDebugConfig("settingTasks","setting-task/group",t),this.setDebugConfig("settingTasks","setting-task/md5",t),this.setDebugConfig("settingTasks","setting-task/cache",!e||!t)}}exports.taskManager=new TaskManager;