"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle=exports.title=void 0;const bundle_utils_1=require("../../../../share/bundle-utils"),asset_library_1=require("../../manager/asset-library"),utils_1=require("../../utils"),layerMask=(exports.title="i18n:builder.tasks.settings.options",[]);for(let e=0;e<=19;e++)layerMask[e]=1<<e;async function handle(e,s,t){var n=this.bundleManager.bundles.filter(e=>e.output);for(const l of n)l.name===bundle_utils_1.BuiltinBundleName.RESOURCES?s.settings.assets.preloadBundles.push({bundle:bundle_utils_1.BuiltinBundleName.RESOURCES}):l.name===bundle_utils_1.BuiltinBundleName.START_SCENE?s.settings.assets.preloadBundles.push({bundle:bundle_utils_1.BuiltinBundleName.START_SCENE}):l.name===bundle_utils_1.BuiltinBundleName.MAIN&&s.settings.assets.preloadBundles.push({bundle:bundle_utils_1.BuiltinBundleName.MAIN}),l.isRemote&&s.settings.assets.remoteBundles.push(l.name),l.isSubpackage&&s.settings.assets.subpackages.push(l.name);if(!e.preview){var i=asset_library_1.buildAssetLibrary.getAsset(e.startScene);if(!i)throw new Error(Editor.I18n.t("builder.error.invalidStartScene"));e.startScene=i.url}e.debug||(s.settings.rendering.renderPipeline=(0,utils_1.compressUuid)(s.settings.rendering.renderPipeline,!0)),s.settings.assets.projectBundles=n.map(e=>e.name),s.settings.engine.builtinAssets=Array.from(this.bundleManager.bundleMap[bundle_utils_1.BuiltinBundleName.INTERNAL]._rootAssets)}exports.handle=handle;