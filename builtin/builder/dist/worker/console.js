"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.newConsole=exports.rawConsole=exports.NewConsole=void 0;const fs_1=require("fs"),fs_extra_1=require("fs-extra"),path_1=require("path"),editor_1=require("editor"),index_1=require("./builder/utils/index"),utils_1=require("../share/utils"),logger=require("@base/electron-logger"),logLevelMap={error:1,warn:2,log:3,debug:4};class NewConsole{constructor(){this.command=!1,this.id="default",this.logDest=path_1.join(NewConsole.logDest,"normal.log")}static async updateLogLevel(e){((e=e||await editor_1.Profile.getConfig("builder","log.level"))||Object.values(logLevelMap).includes(Number(e)))&&logger.setLevel(Number(e))}record(e,o){this.id=e,this.logDest=path_1.join(NewConsole.logDest,`${o+utils_1.changeToLocalTime(e).replace(":","-")}.log`),fs_1.existsSync(this.logDest)||fs_extra_1.outputFileSync(this.logDest,"")}stopRecord(){this.id=""}log(...e){exports.rawConsole.log(...e),this&&this.saveLog("log",e[0])}error(...e){exports.rawConsole.error(...e),this&&this.saveLog("error",e[0])}warn(...e){exports.rawConsole.warn(...e),this&&this.saveLog("warn",e[0])}debug(...e){exports.rawConsole.log(...e),this&&this.saveLog("debug",e)}async saveLog(e,o){if(!this.id||!o||!fs_1.existsSync(this.logDest))return;let s="";try{Array.isArray(o)?o.forEach(e=>{s+=`${JSON.stringify(e)}`}):s+=JSON.stringify(o)}catch(e){}const r=`${index_1.getCurrentTime()}-${e}: ${s}\r\n`;fs_extra_1.appendFile(this.logDest,r),this.command&&Worker.Ipc.send("build-worker:stdout",e,s)}}exports.NewConsole=NewConsole,NewConsole.logDest=path_1.join(Editor.Project.path,"temp","builder","log"),exports.rawConsole=console,exports.newConsole=new NewConsole,exports.newConsole.__proto__.__proto__=exports.rawConsole,window.console=exports.newConsole;