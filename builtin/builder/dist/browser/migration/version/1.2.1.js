"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrationOptions_1_2_1=exports.migratePackagesOption=exports.migrateProfile_1_2_1=void 0;const lodash=require("lodash");async function migrateProfile_1_2_1(){const e=await Editor.Profile.getConfig("builder","","local");if(!e)return;const o=e.BuildTaskManager&&e.BuildTaskManager.queue;Array.isArray(o)&&0!==o.length&&(o.forEach(e=>{const o=e.options;if(o[o.platform])return console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!"),lodash.set(o,`packages.${o.platform}`,o[o.platform]),void delete o[o.platform]}),await Editor.Profile.setConfig("builder","",e,"local"))}async function migratePackagesOption(e){if(e.packages||!e.platform)return;if(e[e.platform])return console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!"),lodash.set(e,`packages.${e.platform}`,e[e.platform]),void delete e[e.platform];const o=await Editor.Profile.getConfig("builder",`${e.platform}`,"default");if(o){console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!");for(let i of Object.keys(o)){const a=o[i];Object.keys(a).forEach(o=>{o in e&&(lodash.set(e,`packages.${i}.${o}`,e[o]),delete e[o])})}}else console.warn(`Platform(${e.platform}) does not register default options! `)}function migrationHuaweiOptions(e,o){Object.keys(e).forEach(e=>{e in o&&(lodash.set(o,`packages.huawei-mini-game.${e}`,o[e]),delete o[e])})}async function migrationOptions_1_2_1(e,o,i){"huawei-quick-game"===i&&(i="huawei-mini-game",o="huawei-mini-game");const a=await Editor.Profile.getConfig("builder","BuildTaskManager.queue","local");if(Array.isArray(a)){for(const t of a){if("huawei-mini-game"===t.options.platform&&"huawei-mini-game"===i){migrationHuaweiOptions(e,t.options);continue}if(t.options.platform!==i)continue;lodash.get(t.options,`packages.${o}`)||await migratePackagesOption(t.options)}await Editor.Profile.setConfig("builder","BuildTaskManager.queue",a,"local")}const t=await Editor.Profile.getConfig("builder",`${i}`,"local");if(t&&!t[i]){const a={};a[o]={};for(const i of Object.keys(e))t[i]&&(a[o][i]=t[i]);await Editor.Profile.setConfig("builder",`${i}`,a,"local")}await Editor.Profile.setConfig("builder",`version.${i}`,"1.2.1","local")}exports.migrateProfile_1_2_1=migrateProfile_1_2_1,exports.migratePackagesOption=migratePackagesOption,exports.migrationOptions_1_2_1=migrationOptions_1_2_1;