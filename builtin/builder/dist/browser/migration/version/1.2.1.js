"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrationOptions_1_2_1=exports.migratePackagesOption=exports.migrateProfile_1_2_1=void 0;const lodash=require("lodash");async function migrateProfile_1_2_1(){const o=await Editor.Profile.getConfig("builder","","local");if(!o)return;const e=o.BuildTaskManager&&o.BuildTaskManager.queue;Array.isArray(e)&&0!==e.length&&(e.forEach(o=>{const e=o.options;if(e[e.platform])return console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!"),lodash.set(e,`packages.${e.platform}`,e[e.platform]),void delete e[e.platform]}),await Editor.Profile.setConfig("builder","",o,"local"))}async function migratePackagesOption(o){if(o.packages||!o.platform)return;if(o[o.platform])return console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!"),lodash.set(o,`packages.${o.platform}`,o[o.platform]),void delete o[o.platform];const e=await Editor.Profile.getConfig("builder",`${o.platform}`,"default");if(e){console.warn("The format of build options has changed, we has migrate your build options, but it still may cause some unexpected errors, please recompile or update your build options!");for(const i of Object.keys(e)){const a=e[i];Object.keys(a).forEach(e=>{e in o&&(lodash.set(o,`packages.${i}.${e}`,o[e]),delete o[e])})}}else console.warn(`Platform(${o.platform}) does not register default options! `)}function migrationHuaweiOptions(o,e){Object.keys(o).forEach(o=>{o in e&&(lodash.set(e,`packages.huawei-mini-game.${o}`,e[o]),delete e[o])})}async function migrationOptions_1_2_1(o,e,i){"huawei-quick-game"===i&&(i="huawei-mini-game",e="huawei-mini-game");const a=await Editor.Profile.getConfig("builder","BuildTaskManager.queue","local");if(Array.isArray(a)){for(const t of a){if("huawei-mini-game"===t.options.platform&&"huawei-mini-game"===i){migrationHuaweiOptions(o,t.options);continue}if(t.options.platform!==i)continue;lodash.get(t.options,`packages.${e}`)||await migratePackagesOption(t.options)}await Editor.Profile.setConfig("builder","BuildTaskManager.queue",a,"local")}const t=await Editor.Profile.getConfig("builder",`${i}`,"local");if(t&&!t[i]){const a={};a[e]={};for(const i of Object.keys(o))t[i]&&(a[e][i]=t[i]);await Editor.Profile.setConfig("builder",`${i}`,a,"local")}await Editor.Profile.setConfig("builder",`version.${i}`,"1.2.1","local")}exports.migrateProfile_1_2_1=migrateProfile_1_2_1,exports.migratePackagesOption=migratePackagesOption,exports.migrationOptions_1_2_1=migrationOptions_1_2_1;