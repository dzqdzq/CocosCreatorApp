"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateGenMipmaps=exports.migrateProject=exports.migrateLocal=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../utils");async function migrateLocal(t){if(t.BuildTaskManager&&t.BuildTaskManager.taskMap)for(const e of Object.keys(t.BuildTaskManager.taskMap)){const s=t.BuildTaskManager.taskMap[e];if(s.options.packages){for(const t of Object.keys(s.options.packages))await Editor.Profile.setConfig(t,`builder.taskOptionsMap.${s.id}`,s.options.packages[t],"local"),await Editor.Profile.setConfig(t,"builder.__version__","1.3.4","local");delete s.options.packages}}}async function migrateProject(t){migrateGenMipmaps(t),await migrateSplashSetting(t)}async function migrateGenMipmaps(t){const e=await Editor.Project.__protected__.getLastEditorVersion();e&&(0,utils_1.compareVersion)("3.7.0",e)&&(t.textureCompressConfig&&"boolean"==typeof t.textureCompressConfig.genMipmaps||(t.textureCompressConfig||(t.textureCompressConfig={}),t.textureCompressConfig.genMipmaps=!1))}async function migrateSplashSetting(t){if(!t["splash-setting"])return;const e=t["splash-setting"].url;if(e&&(0,path_1.isAbsolute)(t["splash-setting"].url)&&(0,fs_extra_1.existsSync)(e)){if(e.includes("app.asar"))return void delete t["splash-setting"].url;const s=(0,path_1.join)(Editor.Project.path,"settings","splash"+(0,path_1.extname)(e));await(0,fs_extra_1.copy)(e,s,{overwrite:!0}),t["splash-setting"].url=Editor.UI.__protected__.File.resolveToUrl(s,"project")}delete t["splash-setting"].displayWatermark,t["splash-setting"].watermarkLocation="default",t["splash-setting"].displayRatio&&(t["splash-setting"].displayRatio=Editor.Utils.Math.clamp(t["splash-setting"].displayRatio,.5,1.5))}exports.migrateLocal=migrateLocal,exports.migrateProject=migrateProject,exports.migrateGenMipmaps=migrateGenMipmaps;