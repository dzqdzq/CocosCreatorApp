"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.clearAllCache=exports.clearEngineCache=exports.clearProjectAssetsCache=exports.openDocs=exports.openPanelDevTools=exports.openWorkerDevTool=void 0;const electron_1=require("electron"),fs_extra_1=require("fs-extra"),globby_1=__importDefault(require("globby")),path_1=require("path"),common_variables_1=require("../share/common-variables"),worker_1=require("./worker"),BUILD_ASSET_CACHE_VERSION="1.0.1";function openWorkerDevTool(){worker_1.workerManager.debug(!0)}function openPanelDevTools(){Editor.Panel._openDevTools("builder")}function openDocs(){electron_1.shell.openExternal(Editor.Utils.Url.getDocUrl("editor/publish/build-panel.html"))}function clearProjectBuilderCache(e){return new Promise((r,o)=>{!function e(r){try{let c=[];(0,fs_extra_1.existsSync)(r)?(c=(0,fs_extra_1.readdirSync)(r)).forEach(o=>{const c=(0,path_1.join)(r,o);(0,fs_extra_1.statSync)(c).isDirectory()?e(c):".log"!==(0,path_1.extname)(c)&&(0,fs_extra_1.removeSync)(c)}):(0,fs_extra_1.mkdirsSync)(r)}catch(e){o(e)}}(e),r()})}async function clearProjectAssetsCache(){const e=await(0,globby_1.default)((0,path_1.join)(Editor.Project.tmpDir,`asset-db/*/*/*/build${BUILD_ASSET_CACHE_VERSION}`),{onlyDirectories:!0});Promise.all(e.map(e=>(0,fs_extra_1.emptyDir)(e))).then(()=>{clearProjectBuilderCache(common_variables_1.LOCAL_CACHE_DIR).then(()=>{console.log(Editor.I18n.t("builder.clear_cache.clear_cache_success",{position:Editor.I18n.t("builder.clear_cache.clear_assets_cache")}))})}).catch(e=>{console.error(e)})}function clearEngineCache(){(0,fs_extra_1.emptyDir)(common_variables_1.GLOBAL_CACHE_DIR).catch(e=>{console.error(e)}).then(()=>{console.log(Editor.I18n.t("builder.clear_cache.clear_cache_success",{position:Editor.I18n.t("builder.clear_cache.clear_engine_cache")})+`: {link(${common_variables_1.GLOBAL_CACHE_DIR})}`)})}async function clearAllCache(){await clearProjectAssetsCache(),await clearEngineCache()}exports.openWorkerDevTool=openWorkerDevTool,exports.openPanelDevTools=openPanelDevTools,exports.openDocs=openDocs,exports.clearProjectAssetsCache=clearProjectAssetsCache,exports.clearEngineCache=clearEngineCache,exports.clearAllCache=clearAllCache;