"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t);var n=Object.getOwnPropertyDescriptor(r,t);n&&("get"in n?r.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,n)}:function(e,r,t,o){e[o=void 0===o?t:o]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(){var n=function(e){return(n=Object.getOwnPropertyNames||function(e){var r,t=[];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t=n(e),o=0;o<t.length;o++)"default"!==t[o]&&__createBinding(r,e,t[o]);return __setModuleDefault(r,e),r}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.compareNumeric=compareNumeric,exports.compareUUID=compareNumeric,exports.getPreviewUrl=getPreviewUrl,exports.getOptionsDefault=getOptionsDefault,exports.checkCompressOptions=checkCompressOptions,exports.warnModuleFallBack=warnModuleFallBack,exports.transTimeToNumber=transTimeToNumber,exports.getTaskLogDest=getTaskLogDest,exports.getCurrentTime=getCurrentTime,exports.changeToLocalTime=changeToLocalTime,exports.checkHasError=checkHasError,exports.getParamsFromCommand=getParamsFromCommand,exports.checkConfigDefault=checkConfigDefault,exports.defaultsDeep=defaultsDeep,exports.defaultMerge=defaultMerge,exports.Metric=Metric,exports.transI18nName=transI18nName,exports.requestModule=requestModule,exports.formatMSTime=formatMSTime,exports.resolveToRaw=resolveToRaw;const path_1=require("path"),textureCompressConfig=__importStar(require("../share/texture-compress"));function compareNumeric(e,r){return e.localeCompare(r,"en",{numeric:!0})}async function getPreviewUrl(){var e=await Editor.Message.request("server","query-port");return`http://${await Editor.Message.request("preview","get-preview-ip")}:${e}/build`}function getOptionsDefault(r){const t={};return Object.keys(r).forEach(e=>{t[e]=r[e].default}),t}function checkCompressOptions(e){if(!e||"object"!=typeof e||Array.isArray(e))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.require_object")),!1;var r=Object.keys(textureCompressConfig.configGroups);for(const n of Object.keys(e)){var t=e[n];if(!t||"object"!=typeof t)return console.error(Editor.I18n.t("builder.project.texture_compress.tips.xx_require_object",{name:n+`(${t})`})),!1;if(!t.name)return console.error(Editor.I18n.t("builder.project.texture_compress.tips.require_name")),!1;if(!t.options||"object"!=typeof t.options||Array.isArray(t))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.xx_require_object",{name:"options"})),!1;for(const a of Object.keys(t.options)){if(!r.includes(a))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.platform_err",{name:"options",supportPlatforms:r.toString()})),!1;var o=t.options[a];for(const i of Object.keys(o));}}return!0}async function warnModuleFallBack(o,e){var r;if(Object.keys(o).length)return r=Object.keys(o).reduce((e,r,t)=>1===t?changeFallbackStr(e)+(", "+changeFallbackStr(r,o[r])):e+(", "+changeFallbackStr(r,o[r]))),console.warn(Editor.I18n.t("builder.warn.engineModulesFallBackTip",{platform:e,fallbackMsg:r}))}function changeFallbackStr(e,r){return r?e+" -> "+r:e+"Ã—"}function transTimeToNumber(e){var r=(e=(0,path_1.basename)(e,".log")).match(/-(\d+)$/);return(r?((e=Array.from(e))[r.index]=":",new Date(e.join(""))):new Date).getTime()}function getTaskLogDest(e,r){return Editor.UI.__protected__.File.resolveToUrl((0,path_1.join)(Editor.Project.tmpDir,"builder","log",e+changeToLocalTime(r,5).replace(/:/g,"-")+".log"),"project")}function getCurrentTime(){return changeToLocalTime(Date.now())}function changeToLocalTime(e,r=8){e=new Date(Number(e));return e.toLocaleDateString().replace(/\//g,"-")+" "+e.toTimeString().slice(0,r)}function checkHasError(e){if(e)if("object"!=typeof e||Array.isArray(e)){if("string"==typeof e)return!0}else for(const r of Object.keys(e))if(checkHasError(e[r]))return!0;return!1}function getParamsFromCommand(e){return(e=e&&e.match(/\$\{([^${}]*)}/g))?e.map(e=>e.replace("${","").replace("}","")):[]}function checkConfigDefault(t){return t?(void 0!==t.default&&null!==t.default||("array"===t.type&&Array.isArray(t.itemConfigs)&&(t.default=[],t.itemConfigs.forEach((e,r)=>{t.default[r]=checkConfigDefault(e)})),"object"===t.type&&"object"==typeof t.itemConfigs&&(t.default={},Object.keys(t.itemConfigs).forEach(e=>{t.default[e]=checkConfigDefault(t.itemConfigs[e])}))),t.default):null}function defaultsDeep(t,o){return null==t||Array.isArray(t)||Object.keys(o).forEach(e=>{var r=o[e];"object"==typeof r&&!Array.isArray(r)&&r?(t[e]||(t[e]={}),defaultsDeep(t[e],r)):void 0!==t[e]&&null!==t[e]||(t[e]=r)}),t}function defaultMerge(e,...r){for(const t of r)if(t&&"object"==typeof t)for(const o in t)!(o in e)||"object"!=typeof t[o]||Array.isArray(t[o])?e[o]=t[o]:e[o]=defaultMerge(e[o],t[o]);return e}function Metric(e){e&&Editor.Metrics._trackEventWithTimer({category:"buildSystem",id:e,value:1})}function transI18nName(e){return"string"!=typeof e?"":e.startsWith("i18n:")&&(e=e.replace("i18n:",""),Editor.I18n.t(e)||console.debug(e+" is not defined in i18n"),Editor.I18n.t(e))||e}async function requestModule(e,r,...t){try{return"function"==typeof e?await e[r](...t):e[r]}catch(e){return console.debug(e),null}}function formatMSTime(e){var r=e/1e3;let t="";var o=Math.floor(r/60/60),n=(o&&(t=o+" h"),Math.floor(r/60)%60),r=(n&&(t+=` ${n} min`),Math.floor(r)%60),e=(r&&(t+=` ${r} s`),e-1e3*(60*o*60+60*n+r));return e&&!t&&(t+=` ${e} ms`),t.trimStart()}function resolveToRaw(e,r){return(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(r,e)}