"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDefaultOptions=exports.checkProjectSetting=exports.checkBundleCompressionSetting=exports.checkBuildCommonOptions=exports.canOverwritePlugins=exports.builtinPlugins=exports.platformPlugins=exports.PLATFORMS=void 0;const path_1=require("path"),Editor=__importStar(require("editor")),utils_1=require("./utils"),bundle_utils_1=require("./bundle-utils");exports.PLATFORMS=["android","huawei-agc","ios","windows","mac","alipay-mini-game","bytedance-mini-game","oppo-mini-game","huawei-quick-game","cocos-play","vivo-mini-game","xiaomi-quick-game","baidu-mini-game","wechatgame","link-sure","qtt","web-desktop","web-mobile","cocos-runtime"],exports.platformPlugins=["native",...exports.PLATFORMS],exports.builtinPlugins=[...exports.platformPlugins,"cocos-service"],exports.canOverwritePlugins=["cocos-service"];const nameRegex=/^[a-zA-Z0-9_-]*$/;async function checkBuildCommonOptions(e,r,t){"string"==typeof r&&(r=r.replace(/(^\s*)|(\s*$)/g,""));const i={error:"",newValue:r};if(!e)return i;switch(e){case"platform":exports.builtinPlugins.includes(r)||(i.error=`Invalid platform(${r})!`,i.newValue=null);break;case"outputName":if(!r){i.error=`outputName(${r}) ${T("error.can_not_empty")}!`;break}nameRegex.test(r)||(i.error="outputName is not legal.",i.newValue=null);break;case"name":if(!r){i.error=`Game name ${T("error.can_not_empty")}`,i.newValue=null;break}break;case"buildPath":if(!t||!t.platform)return i;if(!r){i.error=`BuildPath ${T("error.can_not_empty")}`,i.newValue="./build";break}const n=utils_1.getBuildDist(r);if(-1!==n.indexOf(" ")){i.error=`${T("error.build_error")}, ${T("error.build_path_contains_space")}`,i.newValue=null;break}i.newValue=path_1.relative(Editor.Project.path,n);break;case"includeModules":if(!Array.isArray(r)){i.error=` includeModules(${r}) is invaild!`,i.newValue=await Editor.Profile.getProject("engine","modules.includeModules");break}r.push("base","gfx-webgl"),r=Array.from(new Set(r));break;case"scenes":if(!Array.isArray(r)||0===r.length){i.error=` scene(${r}) is invaild!`,i.newValue=null;break}i.newValue=[];for(const e of r){await Editor.Message.request("asset-db","query-asset-info",e.uuid)?i.newValue.push(e):i.error=` scene(${e.uuid}) does not exist in library!`}0===i.newValue.length&&(i.error=` scene(${JSON.stringify(r)}) is invaild!`,i.newValue=null);break;case"startScene":await Editor.Message.request("asset-db","query-asset-info",r)||(i.newValue=null,i.error=` startScene(${r}) does not exist in library!`);break;case"mainBundleIsRemote":r&&t.mainBundleCompressionType===bundle_utils_1.BundleCompressionTypes.SUBPACKAGE?(i.newValue=!1,i.error=" bundle can not be remote when compression type is subpackage!"):r||t.mainBundleCompressionType!==bundle_utils_1.BundleCompressionTypes.ZIP||(i.newValue=!0,i.error=" bundle must be remote when compression type is zip!")}return i}function checkBundleCompressionSetting(e,r){const t={error:"",newValue:e};return r&&-1===r.indexOf(e)&&(t.newValue=bundle_utils_1.BundleCompressionTypes.MERGE_DEP,t.error=` compression type(${e}) is invalid for this platform!`),t}async function checkProjectSetting(e,r=!1){e.includeModules&&r||(e.includeModules=await Editor.Profile.getProject("engine","modules.includeModules")||[]),e.designResolution&&r||(e.designResolution=await Editor.Profile.getProject("project","general.designResolution")),e.renderPipeline&&r||(e.renderPipeline=await Editor.Profile.getProject("project","general.renderPipeline")),e.physicsConfig&&r||(e.physicsConfig=await Editor.Profile.getProject("project","physics"))}function T(e){return Editor.I18n.t(`builder.${e}`)}async function getDefaultOptions(){const e=await Editor.Profile.getConfig("builder","common"),r=await Editor.Message.request("asset-db","query-assets",{type:"scene"});return r&&(e.scenes=r.map(e=>({url:e.url,uuid:e.uuid}))),e.startScene=e.scenes[0].uuid,e.packages={},JSON.parse(JSON.stringify(e))}exports.checkBuildCommonOptions=checkBuildCommonOptions,exports.checkBundleCompressionSetting=checkBundleCompressionSetting,exports.checkProjectSetting=checkProjectSetting,exports.getDefaultOptions=getDefaultOptions;