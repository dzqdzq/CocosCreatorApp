"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getInvalidRemote=exports.checkRemoteDisabled=exports.transformPlatformSettings=exports.DefaultBundleConfig=exports.genBundleRenderConfig=exports.BundlePlatformTypes=exports.BundlecompressionTypeMap=exports.getBundleDefaultName=exports.BuiltinBundleName=exports.BundleCompressionTypes=void 0;const path_1=require("path"),lodash=require("lodash");var BundleCompressionTypes,BuiltinBundleName;function getBundleDefaultName(e){return(0,path_1.basename)(e.file).replace(/[^a-zA-Z0-9_-]/g,"_")}function genBundleRenderConfig(e,s){const n={};return Object.keys(s).forEach(o=>{const t=e[o];if(t.platformName=s[o],!n[t.platformType])return void(n[t.platformType]={platformConfigs:{[o]:t},platformTypeInfo:exports.BundlePlatformTypes[t.platformType],maxOptionList:t.supportOptions});n[t.platformType].platformConfigs[o]=t;const i=n[t.platformType].maxOptionList;i.compressionType=Array.from(new Set(i.compressionType.concat(t.supportOptions.compressionType)));const p=n[t.platformType].minOptionList||JSON.parse(JSON.stringify(n[t.platformType].maxOptionList)),r=[];i.compressionType.forEach(e=>{t.supportOptions.compressionType.includes(e)&&p.compressionType.includes(e)&&r.push(e)}),r.length!==i.compressionType.length&&(n[t.platformType].minOptionList={compressionType:r})}),n}function transformPlatformSettings(e,s){const n={};return Object.keys(s).forEach(o=>{const t=getValidOption(o,e,s);t.isRemote=getInvalidRemote(t.compressionType,t.isRemote),t.compressionType=t.compressionType||BundleCompressionTypes.MERGE_DEP,n[o]=t}),n}function getValidOption(e,s,n){var o;const t=s.configMode||("miniGame"===n[e].platformType?"fallback":"auto");if("fallback"===t&&s.fallbackOptions)return Object.assign(Object.assign({},s.preferredOptions),{compressionType:s.fallbackOptions.compressionType,isRemote:null!==(o=s.fallbackOptions.isRemote)&&void 0!==o&&o});if(s.overwriteSettings&&s.overwriteSettings[e])return s.overwriteSettings[e];const i=n[e].supportOptions.compressionType;return"overwrite"!==t||s.overwriteSettings&&s.overwriteSettings[e]?s.preferredOptions&&i.includes(s.preferredOptions.compressionType)?s.preferredOptions:s.fallbackOptions?Object.assign(Object.assign({},s.preferredOptions),{compressionType:s.fallbackOptions.compressionType}):Object.assign({},s.preferredOptions):{compressionType:BundleCompressionTypes.MERGE_DEP,isRemote:!1}}function checkRemoteDisabled(e){return e===BundleCompressionTypes.SUBPACKAGE||e===BundleCompressionTypes.ZIP}function getInvalidRemote(e,s){return e!==BundleCompressionTypes.SUBPACKAGE&&(e===BundleCompressionTypes.ZIP||null!==s&&void 0!==s&&s)}!function(e){e.NONE="none",e.MERGE_DEP="merge_dep",e.MERGE_ALL_JSON="merge_all_json",e.SUBPACKAGE="subpackage",e.ZIP="zip"}(BundleCompressionTypes=exports.BundleCompressionTypes||(exports.BundleCompressionTypes={})),function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene",e.INTERNAL="internal"}(BuiltinBundleName=exports.BuiltinBundleName||(exports.BuiltinBundleName={})),exports.getBundleDefaultName=getBundleDefaultName,exports.BundlecompressionTypeMap={[BundleCompressionTypes.NONE]:"i18n:builder.asset_bundle.none",[BundleCompressionTypes.SUBPACKAGE]:"i18n:builder.asset_bundle.subpackage",[BundleCompressionTypes.MERGE_DEP]:"i18n:builder.asset_bundle.merge_dep",[BundleCompressionTypes.MERGE_ALL_JSON]:"i18n:builder.asset_bundle.merge_all_json",[BundleCompressionTypes.ZIP]:"i18n:builder.asset_bundle.zip"},exports.BundlePlatformTypes={native:{icon:"mobile",displayName:"i18n:builder.asset_bundle.native"},web:{icon:"html5",displayName:"i18n:builder.asset_bundle.web"},miniGame:{icon:"mini-game",displayName:"i18n:builder.asset_bundle.minigame"}},exports.genBundleRenderConfig=genBundleRenderConfig,exports.DefaultBundleConfig={displayName:"i18n:builder.asset_bundle.defaultConfig",configs:{native:{preferredOptions:{isRemote:!1,compressionType:"merge_dep"}},web:{preferredOptions:{isRemote:!1,compressionType:"merge_dep"},fallbackOptions:{compressionType:"merge_dep"}},miniGame:{fallbackOptions:{isRemote:!1,compressionType:"merge_dep"},configMode:"fallback"}}},exports.transformPlatformSettings=transformPlatformSettings,exports.checkRemoteDisabled=checkRemoteDisabled,exports.getInvalidRemote=getInvalidRemote;