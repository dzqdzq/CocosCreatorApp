"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),fs_extra_1=require("fs-extra"),preview_container_1=require("./preview-container");let vm,panel=null;const Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const LOGO_DIR=(0,path_1.join)(Editor.Project.path,"settings");async function ready(){vm=new Vue({el:(panel=this).$.splash,components:{PreviewContainer:preview_container_1.PreviewContainer},data:{imgDragState:"",settings:{},loadingImage:!1,defaultSettings:null,watermarkLocationConfig:[{label:Editor.I18n.t("builder.splashSetting.default"),value:"default"},{label:joindWatermarkPosLabel("top","left"),value:"topLeft"},{label:joindWatermarkPosLabel("top","center"),value:"topCenter"},{label:joindWatermarkPosLabel("top","right"),value:"topRight"},{label:joindWatermarkPosLabel("bottom","left"),value:"bottomLeft"},{label:joindWatermarkPosLabel("bottom","center"),value:"bottomCenter"},{label:joindWatermarkPosLabel("bottom","right"),value:"bottomRight"}],checkCustomSplashInfo:{enable:!1,complete:!1,form:""},previewContainer:{width:1920,height:1080},showMask:!1},computed:{displayRatio(){return this.settings.displayRatio?(100*this.settings.displayRatio).toFixed():100}},async mounted(){await this.initData()},methods:{async onConfirm(t){const e=t.target.getAttribute("name");if(!e)return;let s=t.target.value;const a=this;if("image"===e)return a.updateLogoSrc(s);"displayRatio"===e&&s&&(s/=100),a.saveSettings(e,s)},async reset(){Object.assign(this.settings,this.defaultSettings),this.handleLogoSrc(this.settings.url),await Editor.Profile.setProject("builder","splash-setting",this.defaultSettings)},async selectImage(){const t=(await Editor.Dialog.select({type:"file",multi:!1,filters:[{extensions:["png","jpg","jpeg"],name:"Image"}]})).filePaths[0];if(!t)return;await this.updateLogoSrc(t)},async updateLogoSrc(t){let e;if((0,fs_1.existsSync)(t))e=t;else{const s=await Editor.Message.request("asset-db","query-asset-info",t);if(!s)return void console.error(`Can't get asset info(${t}) from uuid`);e=s.file}const s=(0,path_1.join)(LOGO_DIR,"splash"+(0,path_1.extname)(e));await(0,fs_extra_1.copy)(e,s,{overwrite:!0}),t=Editor.UI.File.resolveToUrl(s,"project"),await this.saveSettings("url",t),this.handleLogoSrc(t)},handleLogoSrc(t){t&&this.$set(this.settings,"imageSrc",Editor.UI.File.resolveToRaw(t)+`?timestamp=${Date.now()}`)},async saveSettings(t,e){this.$set(this.settings,t,e),await Editor.Profile.setProject("builder",`splash-setting.${t}`,e)},async initData(){const t=this;try{const e=await Editor.Message.request("information","query-information","customSplash");e&&(t.checkCustomSplashInfo=e),t.checkCustomSplashInfo.enable&&!t.checkCustomSplashInfo.complete&&(t.showMask=!0)}catch(t){console.debug(t)}t.defaultSettings=await Editor.Profile.getProject("builder","splash-setting","default"),t.settings=await Editor.Profile.getProject("builder","splash-setting"),t.handleLogoSrc(t.settings.url)},async enableCustomSplash(){const t=this;try{"resolve"===(await Editor.Message.request("information","information-dialog","customSplash")).action&&(t.showMask=!1),console.warn(Editor.I18n.t("builder.splashSetting.enableCustomSplashFailed"))}catch(t){console.debug(t)}}}})}function joindWatermarkPosLabel(t,e){return`${Editor.I18n.t(`builder.splashSetting.watermarkLocationConfig.${t}`)} - ${Editor.I18n.t(`builder.splashSetting.watermarkLocationConfig.${e}`)}`}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/splash-setting.css"),"utf8"),exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/contributions/splash-setting.html"),"utf8"),exports.$={splash:"#splashSetting"},exports.methods={},exports.ready=ready;