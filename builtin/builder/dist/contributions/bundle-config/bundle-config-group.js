"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&("get"in i?e.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,i)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&__createBinding(e,t,r);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeDestroy=exports.created=exports.methods=exports.computed=exports.data=exports.components=exports.props=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),bundle_utils_1=require("../../share/bundle-utils"),ConfigItem=__importStar(require("./bundle-config-item")),PlatformGroup=__importStar(require("./platform-config-group")),DefaultBundleConfigItem={isRemote:!1,compressionType:"merge_dep"};exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/contributions/bundle-config-group.html"),"utf8"),exports.props=["renderConfig","customConfig","readonly"],exports.components={"config-item":ConfigItem,"platform-group":PlatformGroup};const data=function(){return{platformTypes:bundle_utils_1.BundlePlatformTypes,currentPlatform:Object.keys(bundle_utils_1.BundlePlatformTypes)[0],compressRenderList:Object.freeze(bundle_utils_1.BundlecompressionTypeMap),selectPlatform:[],updateSettings:-1,platformRenderMap:{},restPlatformList:[]}};function created(){const t=this.clearSelect.bind(this);this.clearSelectBind=t,document.addEventListener("click",this.clearSelectBind)}function beforeDestroy(){document.removeEventListener("click",this.clearSelectBind)}exports.data=data,exports.computed={resetUniDisabledState(){if(this.readonly)return!0;const t=this.customConfig[this.currentPlatform].overwriteSettings||{};let e=this.customConfig[this.currentPlatform].fallbackOptions;return!e&&0===Object.keys(t).length||(e=Object.assign(Object.assign({},DefaultBundleConfigItem),e||{}),Object.keys(t).length?Object.values(t).every(t=>t.isRemote===e.isRemote&&t.compressionType===e.compressionType):DefaultBundleConfigItem.isRemote===e.isRemote&&DefaultBundleConfigItem.compressionType===e.compressionType)},resetDisabledState(){if(this.readonly)return!0;const t=this.customConfig[this.currentPlatform].overwriteSettings||{};return 0===Object.keys(t).length||Object.values(t).every(t=>!(void 0!==t.isRemote&&t.isRemote!==DefaultBundleConfigItem.isRemote||t.compressionType&&t.compressionType!==DefaultBundleConfigItem.compressionType))},resetAllDisabledState(){if(this.readonly)return!0;let t=this.customConfig[this.currentPlatform].fallbackOptions;return!t||0===Object.keys(t).length||(t=Object.assign(Object.assign({},DefaultBundleConfigItem),t||{})).isRemote===DefaultBundleConfigItem.isRemote&&t.compressionType===DefaultBundleConfigItem.compressionType}},exports.methods={getRenderList(t,e){return this.renderConfig[this.currentPlatform].platformConfigs[t]?[{label:this.renderConfig[this.currentPlatform].platformConfigs[t].platformName,value:t},...e]:e},changePlatform(t){this.currentPlatform=t,this.selectPlatform=[],this.$emit("changeplatform",t)},getRestPlatformList(){const t=this;if(!t.customConfig[t.currentPlatform])return[];const e=t.customConfig[t.currentPlatform].overwriteSettings;let r=[];return(r=e&&Object.keys(e).length?Object.keys(t.renderConfig[t.currentPlatform].platformConfigs).filter(t=>!e[t]):Object.keys(t.renderConfig[t.currentPlatform].platformConfigs)).map(e=>({label:t.renderConfig[t.currentPlatform].platformConfigs[e].platformName,value:e}))},onOverwriteSettingsReset(t){const e=this.customConfig[this.currentPlatform].fallbackOptions;if(!e||t)return this.customConfig[this.currentPlatform].overwriteSettings={},void this.onConfigChange();const r=this.customConfig[this.currentPlatform].overwriteSettings||{};Object.keys(this.renderConfig[this.currentPlatform].platformConfigs).forEach(t=>{r[t]=JSON.parse(JSON.stringify(e))}),this.$set(this.customConfig[this.currentPlatform],"overwriteSettings",Object.assign({},r)),this.onConfigChange()},onFallbackOptionsReset(){this.$set(this.customConfig[this.currentPlatform],"fallbackOptions",{}),this.onConfigChange()},onChangeConfigMode(t,e){const r=t&&"fallback"===e||!t&&"overwrite"===e?"fallback":"overwrite";this.$set(this.customConfig[this.currentPlatform],"configMode",r),this.onConfigChange()},onBundleConfigChange(t,e,r){const o=this.customConfig[this.currentPlatform][r]||{};o[t]=e,this.$set(this.customConfig[this.currentPlatform],r,Object.assign({},o)),this.onConfigChange()},onPlatformSettingsChange(t,e){const r=this.customConfig[this.currentPlatform].overwriteSettings||{};r[t]=e,this.$set(this.customConfig[this.currentPlatform],"overwriteSettings",Object.assign({},r)),this.onConfigChange()},deletePlatformOverwrite(){const t=this.customConfig[this.currentPlatform].overwriteSettings;if(t){if(this.selectPlatform.length)this.selectPlatform.forEach(e=>{delete t[e]});else{const e=Object.keys(t)[Object.keys(t).length-1];delete t[e]}this.$set(this.customConfig[this.currentPlatform],"overwriteSettings",Object.assign({},t)),this.updatePlatformRenderMap(),this.onConfigChange()}},addPlatformOverwriteMenu(t){const e=this.customConfig[this.currentPlatform].overwriteSettings||{},r=Object.keys(this.renderConfig[this.currentPlatform].platformConfigs).map(t=>{return{label:this.renderConfig[this.currentPlatform].platformConfigs[t].platformName,enabled:!e[t],click:()=>{this.addPlatformOverwrite(t)}}});Editor.Menu.popup({x:t.x,y:t.y,menu:r})},addPlatformOverwrite(t){const e=this.customConfig[this.currentPlatform].overwriteSettings||{};e[t]=JSON.parse(JSON.stringify(DefaultBundleConfigItem)),this.$set(this.customConfig[this.currentPlatform],"overwriteSettings",Object.assign({},e)),this.updatePlatformRenderMap(),this.onConfigChange()},changeOverWritePlatform(t,e){const r=this.customConfig[this.currentPlatform].overwriteSettings||{},o=r[e],i=this.renderConfig[this.currentPlatform].platformConfigs[t].supportOptions;i.compressionType.includes(o.compressionType)||(o.compressionType=i.compressionType[0]),r[t]=o,delete r[e],this.updatePlatformRenderMap(),this.onConfigChange()},isRemoteLocked:t=>(0,bundle_utils_1.checkRemoteDisabled)(t),updatePlatformRenderMap(){const t=this.customConfig[this.currentPlatform].overwriteSettings;if(!t||!Object.keys(t).length)return void(this.platformRenderMap={});const e=this.getRestPlatformList();Object.keys(t).forEach(t=>{this.$set(this.platformRenderMap,t,this.getRenderList(t,e))})},onConfigChange(){this.updateSettings=-this.updateSettings,this.$emit("update",this.customConfig)},clearSelect(){this.selectPlatform=[]}},exports.created=created,exports.beforeDestroy=beforeDestroy;