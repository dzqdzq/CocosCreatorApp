"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.searchAssets=exports.encodeAsset=exports.queryAssetsByOptions=void 0;const message_1=require("./../worker/message");exports.methods={async queryAllAssets(){var e;const s=await Manager.Utils.queryAssets(),t=[];for(let r=0;r<s.length;r++){const n=s[r];n.isDirectory||"database"===n.importer||(n.mtime=null===(e=Manager.AssetWorker.assets.infoManager.map[n.file])||void 0===e?void 0:e.time,t.push(n))}return t},async queryAssetInfo(e){var s;const t=await Manager.Utils.queryAssetInfo(e);return t&&(t.mtime=null===(s=Manager.AssetWorker.assets.infoManager.map[t.file])||void 0===s?void 0:s.time),t},queryAssetsByOptions:queryAssetsByOptions,initWorkerMessage:message_1.init};const minimatch=require("minimatch");function queryAssetsByOptions(e){const s=[];for(const t in Manager.AssetWorker){if(!(t in Manager.AssetWorker))continue;const r=Manager.AssetWorker[t];if("string"==typeof e.pattern&&!e.pattern.startsWith(`db://${t}`))continue;const n=searchAssets(Array.from(r.uuid2asset.values()),e);s.push(...n.map(e=>encodeAsset(r,e)))}return s}function encodeAsset(e,s){var t,r;const n=Manager.Utils.encodeAsset(e,s);if(s._parent){const r=Manager.Utils.encodeAsset(e,s._parent);n.fatherInfo={source:r.source,library:r.library,uuid:r.uuid},n.mtime=null===(t=Manager.AssetWorker.assets.infoManager.map[s._parent.source])||void 0===t?void 0:t.time}else n.mtime=null===(r=Manager.AssetWorker.assets.infoManager.map[s.source])||void 0===r?void 0:r.time;return n.userData=s.meta.userData,n}function searchAssets(e,s){let t=[];return t=t.concat(e),s.deep&&e.forEach(e=>{e.subAssets&&Object.keys(e.subAssets).length&&t.push(...Object.values(e.subAssets))}),t.filter(e=>!(s.pattern&&"string"==typeof s.pattern&&!minimatch(e.url,s.pattern))&&(!s.importer||"string"!=typeof s.importer||e.meta.importer===s.importer))}exports.queryAssetsByOptions=queryAssetsByOptions,exports.encodeAsset=encodeAsset,exports.searchAssets=searchAssets;