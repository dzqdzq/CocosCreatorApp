"use strict";const fs_extra_1=require("fs-extra"),path_1=require("path"),packages={load(){},methods:{async create(e){if(!e.template.path)return console.warn(Editor.I18n.t("extension.create_package.no_path_warning").replace("${info.template.name}",e.template.name)),{success:!1};try{const t=e.dist,a=e.template.path;await Editor.Utils.File.copy(a,t),await Editor.Message.request("utils","export-dts",t,!1);const s="\n/// <reference path=\"./packages/builder/@types/public/global.d.ts\"/>\nexport * from './packages/builder/@types/public';",r=(0,path_1.join)(t,"@types/index.d.ts");(0,fs_extra_1.outputFileSync)(r,(0,fs_extra_1.readFileSync)(r,"utf8")+s);const n=(0,path_1.join)(t,"package.json");if(!(0,fs_extra_1.existsSync)(n))return{success:!1};const i=JSON.parse((0,fs_extra_1.readFileSync)(n,{encoding:"utf-8"})),o={name:e.name,title:i.title?i.title.replace(i.name,e.name):e.name,package_version:2,version:"1.0.0",author:e.author,description:i.description?i.description.replace(i.name,e.name):""};return Object.assign(i,o),(0,fs_extra_1.writeJsonSync)(n,i,{spaces:4}),[(0,path_1.join)(t,"source","hooks.ts"),(0,path_1.join)(t,"dist","hooks.js"),(0,path_1.join)(t,"source","builder.ts"),(0,path_1.join)(t,"dist","builder.js")].forEach(t=>{let a=(0,fs_extra_1.readFileSync)(t,{encoding:"utf-8"});a=a.replace("const PACKAGE_NAME = 'cocos-build-template';",`const PACKAGE_NAME = '${e.name}';`),(0,fs_extra_1.outputFileSync)(t,a)}),{fileDisplayedToFolder:n,success:!0}}catch(e){return{success:!1,error:e instanceof Error?e:void 0}}}}};module.exports=packages;