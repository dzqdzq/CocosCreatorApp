"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.update=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),electron_1=require("electron"),path_1=require("path"),bundle_utils_1=require("../../../share/bundle-utils"),Vue=require("vue/dist/vue.js");function update(e,n,...t){const l=this;l.vm||(l.vm=new Vue({el:l.$.root,data:{infos:[],metas:[],info:{},meta:{},curPlatform:"web-desktop",platformFeatures:{},platforms:[],defaultValue:{isBundle:!1,bundleName:"",priority:1,compressionType:"merge_dep"}},computed:{_isResources(){return this.infos.some(e=>"db://assets/resources"===e.url)},_isBundle(){var e,n;return null===(n=null===(e=this.meta)||void 0===e?void 0:e.userData)||void 0===n?void 0:n.isBundle},_priority(){var e,n;return null===(n=null===(e=this.meta)||void 0===e?void 0:e.userData)||void 0===n?void 0:n.priority},_isRemoteLocked(){const e=this;return e.metas.some(n=>{var t;const l=null===(t=n.userData)||void 0===t?void 0:t.compressionType[e.curPlatform];return l===bundle_utils_1.BundleCompressionTypes.SUBPACKAGE||l===bundle_utils_1.BundleCompressionTypes.ZIP})},compressionTypes(){const e=this;return e.platformFeatures[e.curPlatform]?e.platformFeatures[e.curPlatform].supportedCompressionTypes:[]}},methods:{async refresh(){const e=this;e.platformFeatures=await Editor.Message.request("builder","query-bundle-config");const n=await Editor.Message.request("builder","query-platform-config");e.platforms=n.order.filter(n=>!!e.platformFeatures[n])},t:e=>Editor.I18n.t(`builder.asset_bundle.${e}`),platformName:e=>0===e.indexOf("i18n")?Editor.I18n.t(e.substr(5)):e,_onOpenDirectory(e,n){electron_1.shell.openPath(n.file)},_onPropertyChanged(e,n){const t=this;let s=e.target.value;s===t.defaultValue[n]&&(s=void 0),t.metas.forEach(e=>{t.$set(e.userData,n,s)}),l.dispatch("change"),l.dispatch("snapshot")},_platformSettingsChanged(e,n){const t=this;let s=e.target.value;(s===t.defaultValue[n]||"isRemoteBundle"===n&&!1===s)&&(s=void 0),t.metas.forEach(e=>{t.$set(e.userData[n],t.curPlatform,s)}),"compressionType"===n&&(e.target.value===bundle_utils_1.BundleCompressionTypes.SUBPACKAGE?t.metas.forEach(e=>{t.$set(e.userData.isRemoteBundle,t.curPlatform,!1)}):e.target.value===bundle_utils_1.BundleCompressionTypes.ZIP&&t.metas.forEach(e=>{t.$set(e.userData.isRemoteBundle,t.curPlatform,!0)})),l.dispatch("change"),l.dispatch("snapshot")},getDefaultValue(){return(0,bundle_utils_1.getBundleDefaultName)(this.infos[0])},openDocs(){electron_1.shell.openExternal(Editor.Utils.Url.getDocUrl("asset/dynamic-load-resources.html"))},openBundleDocs(){electron_1.shell.openExternal(Editor.Utils.Url.getDocUrl("asset/bundle.html"))},async apply(){const e=this;if(!e._isBundle)return;const n=e.metas[0].userData.bundleName||e.getDefaultValue();if(!/^[a-zA-Z0-9_-]+$/.test(n))return console.error(`Invalid bundle name(${n}), only numbers, letters, minus sign and underscores can be included in the bundle name.`),!1;const{MAIN:t,START_SCENE:l,RESOURCES:s,INTERNAL:o}=bundle_utils_1.BuiltinBundleName;function i(e,n){return new RegExp(`^${e}$`,"i").test(n)}if(i(s,n)&&!e._isResources||[t,l,o].find(e=>i(e,n)))return console.error(Editor.I18n.t("builder.asset_bundle.duplicate_reserved_keyword_message",{name:n})),!1;const a=await Editor.Message.request("asset-db","query-assets",{isBundle:!0});for(const t of a){if(t.url===e.infos[0].url)continue;if(i(t.meta.userData.bundleName||(0,path_1.basename)(t.url),n))return console.error(Editor.I18n.t("builder.asset_bundle.duplicate_name_message",{name:n,url:t.url})),!1;if(Editor.Utils.Path.contains(t.url,e.infos[0].url))return console.error(Editor.I18n.t("builder.asset_bundle.nest_bundle",{url:t.url})),!1;if(Editor.Utils.Path.contains(e.infos[0].url,t.url))return console.error(Editor.I18n.t("builder.asset_bundle.nest_bundle",{url:t.url})),!1}},invalid(e){const n=this;return n.metas.some(t=>t.userData[e]!==n.meta.userData[e])},invalidCompressionType(){const e=this;return e.metas.some(n=>n.userData.compressionType[e.curPlatform]!==e.meta.userData.compressionType[e.curPlatform])},invalidIsRemoteBundle(){const e=this;return e.metas.some(n=>n.userData.isRemoteBundle[e.curPlatform]!==e.meta.userData.isRemoteBundle[e.curPlatform])}}})),l.vm.infos=e,l.vm.metas=n,l.vm.info=e[0],l.vm.meta=n[0],l.vm.refresh()}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./style.css"),"utf8"),exports.template='\n<section class="asset-directory">\n    <div class="path"\n        v-for="info in infos"\n    >\n        <div class="name">\n            <span>{{info.source}}</span>\n        </div>\n        <div class="button">\n            <ui-button class="blue explore-btn" tabindex="0"\n                @confirm.stop="_onOpenDirectory($event, info)"\n                @change.stop\n            >\n                <ui-icon value="folder-open"></ui-icon>\n            </ui-button>\n        </div>\n    </div>\n\n    <div class="content">\n        <ui-prop\n            @confirm="_onPropertyChanged($event, \'isBundle\')"\n            :readonly="_isResources || info.readonly"\n        >\n            <ui-label slot="label" value="i18n:builder.asset_bundle.is_bundle"></ui-label>\n            <ui-checkbox\n                slot="content"\n                :value="_isBundle"\n                :disabled="_isResources || info.readonly"\n                :invalid="invalid(\'isBundle\')"\n            ></ui-checkbox>\n        </ui-prop>\n        <div\n            v-if="_isBundle && !invalid(\'isBundle\')"\n        >\n            <ui-prop\n                @confirm="_onPropertyChanged($event, \'bundleName\')"\n                :readonly="_isResources || info.readonly || metas.length > 1"\n            >\n                <ui-label slot="label" value="i18n:builder.asset_bundle.bundle_name"></ui-label>\n                <ui-input\n                    slot="content"\n                    :disabled="_isResources || info.readonly  || metas.length > 1"\n                    :value="metas[0].userData.bundleName || defaultValue.bundleName"\n                    :placeholder="getDefaultValue()"\n                    :invalid="invalid(\'bundleName\')"\n                ></ui-input>\n            </ui-prop>\n            <ui-prop\n                @confirm="_onPropertyChanged($event, \'priority\')"\n                tooltip="i18n:builder.asset_bundle.priority_tooltip"\n                :readonly="info.readonly"\n            >\n                <ui-label slot="label" value="i18n:builder.asset_bundle.priority"></ui-label>\n                <ui-num-input\n                    slot="content"\n                    :disabled="info.readonly"\n                    min="1"\n                    max="20"\n                    step="1"\n                    :value="metas[0].userData.priority || defaultValue.priority"\n                    :invalid="invalid(\'priority\')"\n                >\n                </ui-num-input>\n            </ui-prop>\n            <ui-prop\n                @confirm.stop="curPlatform = $event.target.value"\n                @change.stop\n                tooltip="i18n:builder.asset_bundle.target_platform_tooltip"\n                :readonly="info.readonly"\n            >\n                <ui-label slot="label" value="i18n:builder.asset_bundle.target_platform"></ui-label>\n                <ui-select\n                    slot="content"\n                    :disabled="info.readonly"\n                    :value="curPlatform"\n                >\n                    <option\n                        v-for="platform in platforms"\n                        v-if="platformFeatures[platform]"\n                        :value="platform"\n                    >{{platformName(platformFeatures[platform].platformName)}}</option>\n                </ui-select>\n            </ui-prop>\n            <ui-prop class="indent"\n                @confirm="_platformSettingsChanged($event, \'compressionType\')"\n                tooltip="i18n:builder.asset_bundle.compression_type_tooltip" \n                :readonly="info.readonly"\n            >\n                <ui-label slot="label" value="i18n:builder.asset_bundle.compression_type"></ui-label>\n                <ui-select\n                    slot="content"\n                    :disabled="info.readonly"\n                    :value="meta.userData.compressionType[curPlatform] || defaultValue.compressionType"\n                    :invalid="invalidCompressionType()"\n                >\n                    <option\n                        v-for="(val, key) in compressionTypes"\n                        :value="val"\n                        :title="t(val + \'_tooltip\')">\n                            {{t(val)}}\n                    </option>\n                </ui-select>\n            </ui-prop>\n            <ui-prop class="indent"\n                @confirm="_platformSettingsChanged($event, \'isRemoteBundle\')"\n                tooltip="i18n:builder.asset_bundle.remote_bundle_invalid_tooltip"\n                :readonly="_isRemoteLocked || info.readonly"\n            >\n                <ui-label slot="label" value="i18n:builder.asset_bundle.is_remote_bundle"></ui-label>\n                <ui-checkbox\n                    slot="content"\n                    :disabled="_isRemoteLocked || info.readonly"\n                    :value="meta.userData.isRemoteBundle[curPlatform]"\n                    :invalid="invalidIsRemoteBundle()"\n                >\n                </ui-checkbox>\n            </ui-prop>\n            <template\n                v-if="!_isResources"\n            >\n                <p>\n                    <ui-label value="i18n:engine.bundle_docs1"></ui-label>\n                </p>\n                <p>\n                    <ui-label value="i18n:engine.bundle_docs2"></ui-label>\n                </p>\n                <p>\n                    <ui-label value="i18n:engine.bundle_docs3"></ui-label>\n                    <a\n                        @click="openBundleDocs"\n                    >\n                        Asset Bundle\n                    </a>\n                </p>\n            </template>\n        </div>\n        <template\n            v-if="_isResources"\n        >\n            <p>\n                <ui-label value="i18n:engine.resources_docs_1"></ui-label>\n            </p>\n            <p>\n                <ui-label value="i18n:engine.resources_docs_2"></ui-label>\n            </p>\n            <p>\n                <ui-label value="i18n:engine.resources_docs_3"></ui-label>\n                <a\n                    @click="openDocs"\n                >\n                    <ui-label value="i18n:engine.resources_docs_4"></ui-label>\n                </a>\n            </p>\n        </template>\n    </div>\n</section>\n\n',exports.$={root:".asset-directory"},exports.update=update,exports.methods={async apply(){return await this.vm.apply()}};