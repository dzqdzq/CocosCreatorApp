"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.update=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),lodash=require("lodash"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./style.css"),"utf8");const PKG_NAME="builder",I18N_HEADER="i18n:builder.assets.auto_atlas",vueTemplate=`\n<section class="asset-auto-atlas">\n    <div class="content"\n        v-if="meta && metas.length === 1"\n    >\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.max_width"\n                tooltip="${I18N_HEADER}.max_width_tips"\n            ></ui-label>\n            <ui-num-input slot="content"\n                :disabled="info.readonly"\n                :invalid="getInvalid('maxWidth')"\n                :value="meta.userData.maxWidth"\n                @change="onChanged($event, 'maxWidth')"\n                step="1"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.max_height"\n                tooltip="${I18N_HEADER}.max_height_tips"\n            ></ui-label>\n            <ui-num-input slot="content"\n                :disabled="info.readonly"\n                :invalid="getInvalid('maxHeight')"\n                :value="meta.userData.maxHeight"\n                @confirm="onChanged($event, 'maxHeight')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.padding"\n                tooltip="${I18N_HEADER}.padding_tips"\n            ></ui-label>\n            <ui-num-input slot="content"\n                :disabled="info.readonly"\n                :invalid="getInvalid('padding')"\n                :value="meta.userData.padding"\n                @confirm="onChanged($event, 'padding')"\n            ></ui-num-input>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.padding_bleed"\n                tooltip="${I18N_HEADER}.padding_bleed_tips"\n            ></ui-label>\n            <ui-checkbox slot="content"\n                :disabled="info.readonly"\n                :value="meta.userData.paddingBleed"\n                @confirm="onChanged($event, 'paddingBleed')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.power_of_two"\n                tooltip="${I18N_HEADER}.power_of_two_tips"\n            ></ui-label>\n            <ui-checkbox slot="content"\n                :disabled="info.readonly"\n                :value="meta.userData.powerOfTwo"\n                @confirm="onChanged($event, 'powerOfTwo')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.force_squared"\n                tooltip="${I18N_HEADER}.force_squared_tips"\n            ></ui-label>\n            <ui-checkbox slot="content"\n                :disabled="info.readonly"\n                :value="meta.userData.forceSquared"\n                @confirm="onChanged($event, 'forceSquared')"\n            ></ui-checkbox>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.filter_unused"\n                tooltip="${I18N_HEADER}.filter_unused_tips"\n            ></ui-label>\n            <div slot="content">\n                <ui-checkbox slot="content"\n                    :disabled="info.readonly"\n                    :value="meta.userData.filterUnused"\n                    @confirm="onChanged($event, 'filterUnused')"\n                ></ui-checkbox>\n                <ui-icon color="true" value="warn-triangle"\n                    tooltip="${I18N_HEADER}.only_work_after_build"\n                ></ui-icon>\n            </div>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.remove_texture_force_in_bundle"\n                tooltip="${I18N_HEADER}.remove_texture_force_in_bundle_tips"\n            ></ui-label>\n            <div slot="content">\n                <ui-checkbox slot="content"\n                    :disabled="info.readonly"\n                    :value="meta.userData.removeTextureInBundle"\n                    @confirm="onChanged($event, 'removeTextureInBundle')"\n                ></ui-checkbox>\n                <ui-icon color="true" value="warn-triangle"\n                    tooltip="${I18N_HEADER}.only_work_after_build"\n                ></ui-icon>\n            </div>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.remove_image_force_in_bundle"\n                tooltip="${I18N_HEADER}.remove_image_force_in_bundle_tips"\n            ></ui-label>\n            <div slot="content">\n                <ui-checkbox slot="content"\n                    :disabled="info.readonly"\n                    :value="meta.userData.removeImageInBundle"\n                    @confirm="onChanged($event, 'removeImageInBundle')"\n                ></ui-checkbox>\n                <ui-icon color="true" value="warn-triangle"\n                    tooltip="${I18N_HEADER}.only_work_after_build"\n                ></ui-icon>\n            </div>\n        </ui-prop>\n        <ui-prop>\n            <ui-label slot="label"\n                value="${I18N_HEADER}.remove_sprite_atlas_in_bundle"\n                tooltip="${I18N_HEADER}.remove_sprite_atlas_in_bundle_tips"\n            ></ui-label>\n            <div slot="content">\n                <ui-checkbox slot="content"\n                    :disabled="info.readonly"\n                    :value="meta.userData.removeSpriteAtlasInBundle"\n                    @confirm="onChanged($event, 'removeSpriteAtlasInBundle')"\n                ></ui-checkbox>\n                <ui-icon color="true" value="warn-triangle"\n                    tooltip="${I18N_HEADER}.only_work_after_build"\n                ></ui-icon>\n            </div>\n        </ui-prop>\n\n        <compress-texture\n            :meta="meta"\n            :metas="metas"\n            :readonly="info.readonly"\n            @confirm="onConfirm"\n        ></compress-texture>\n\n        <div class="footer">\n            <ui-button tabindex="0"\n                :disabled="info.readonly"\n                @mouseup.stop\n                @confirm.stop="_onPreviewClick"\n            >\n                <ui-label value="${I18N_HEADER}.preview"></ui-label>\n            </ui-button>\n\t\t\t<ui-label class="images-title" value="${I18N_HEADER}.packedTextures"></ui-label>\n            <div class="images"\n                v-if="packedTextures.length !== 0"\n            >\n            <div class="image"\n                v-for="(src, index) in packedTextures"\n            >\n                    <img class="img"\n                        :src="src + '?' + Math.random()"\n                    >\n                    <ui-link :value="src" :tooltip="src">\n                        <ui-label value="${I18N_HEADER}.packedImage"></ui-label>\n                        ({{ index + 1 }})\n                    </ui-link>\n                </div>\n            </div>\n            <div class="images-title"\n                v-if="unpackedTextures.length !== 0"\n            >\n                Unpacked Textures:\n            </div>\n            <div class="images"\n                v-if="unpackedTextures.length !== 0"\n            >\n                <div class="image"\n                    v-for="spriteFrameInfo in unpackedTextures"\n                    @click="twinkle(spriteFrameInfo.imageUuid)"\n                >\n                    <img class="img"\n                        :src="spriteFrameInfo.libraryPath + '?' + Math.random()"\n                    >\n                </div>\n            </div>\n        </div>\n        <ui-loading v-if="generating"></ui-loading>\n    </div>\n    <ui-label class="multiple-warn-tip" value="i18n:ENGINE.assets.multipleWarning"\n        v-else\n    ></ui-label>\n</section>\n`;function update(e,n){const t=this;if(!t.vm){const e=new Vue({components:{"compress-texture":require("../image/compress-texture")},data:()=>({infos:null,info:null,metas:null,meta:null,packedTextures:[],unpackedTextures:[],generating:!1}),computed:{isIllegalWrapModeT(){var e;return"repeat"===(null===(e=this.meta)||void 0===e?void 0:e.userData.textureSetting.wrapModeT)},isIllegalWrapModeS(){var e;return"repeat"===(null===(e=this.meta)||void 0===e?void 0:e.userData.textureSetting.wrapModeS)}},methods:{getInvalid(e){var n,t;const i=lodash.get(null===(n=this.meta)||void 0===n?void 0:n.userData,e);return!(null===(t=this.metas)||void 0===t?void 0:t.every(n=>i===lodash.get(n.userData,e)))},t:e=>Editor.I18n.t(`inspector.asset.autoAtlas.${e}`),onChanged(e,n){var t;const i=e.target;lodash.set(null===(t=this.meta)||void 0===t?void 0:t.userData,n,i.value),this.onConfirm()},onConfirm(){t.dispatch("change"),t.dispatch("snapshot")},async _onPreviewClick(){if(this.meta){this.generating=!0;try{const e=await Editor.Message.request("builder","preview-pac",this.meta.uuid,this.meta.userData);e&&this.showImages(e)}catch(e){console.warn(`Auto Atlas Preview Error: ${e}`)}this.generating=!1}},async showImages(e){e?(this.packedTextures=e.atlasImagePaths,this.unpackedTextures=e.unpackedImages):(this.packedTextures=[],this.unpackedTextures=[])},twinkle(e){Editor.Message.send("assets","twinkle",e)},async refresh(){if(!this.meta)return;this.generating=!1;const e=await Editor.Message.request("builder","query-atlas-files",this.meta.uuid);this.showImages(e)}},template:vueTemplate});e.$mount(t.$.container),t.vm=e}t.vm.infos=e,t.vm.metas=n,t.vm.info=e[0],t.vm.meta=n[0],t.vm.refresh()}function close(){var e;null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=null}exports.template='<div class="container"></div>',exports.$={container:".container"},exports.update=update,exports.close=close;