"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,o,e,i){void 0===i&&(i=e),Object.defineProperty(t,i,{enumerable:!0,get:function(){return o[e]}})}:function(t,o,e,i){void 0===i&&(i=e),t[i]=o[e]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,o){Object.defineProperty(t,"default",{enumerable:!0,value:o})}:function(t,o){t.default=o}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&__createBinding(o,t,e);return __setModuleDefault(o,t),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.computed=exports.data=exports.props=exports.template=exports.components=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),customConfig=__importStar(require("../comp/custom-config")),configToolbar=__importStar(require("../comp/config-toolbar"));function getDefaultConfig(t){return{id:Editor.Utils.UUID.generate(),name:t,path:"",command:"",format:"png"}}exports.components={"custom-config":customConfig,"config-toolbar":configToolbar},exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../../../static/contributions/compress-format.html"),"utf8"),exports.props=["compressConfig","customConfigs","overwriteFormats"];const data=function(){return{editConfig:null,newConfigName:"",configNameTips:"",mode:"config"}};async function mounted(){}exports.data=data,exports.computed={displayConfigs(){const t=this,o={};return t.customConfigs?"search"!==t.mode?t.customConfigs:(Object.keys(t.customConfigs).forEach(e=>{t.customConfigs[e].name.includes(t.newConfigName)&&(o[e]=t.customConfigs[e])}),t.configNameTips="",o):{}}},exports.methods={t:t=>Editor.I18n.t(`builder.project.texture_compress.${t}`),async init(){const t=this;t.customConfigs=await Editor.Profile.getProject("builder","textureCompressConfig.customConfigs")||{},t.customConfigs&&Object.keys(t.customConfigs)&&Object.values(t.customConfigs).forEach(o=>{o.overwrite&&(t.overwriteFormats[o.format]&&(t.customConfigs[t.overwriteFormats[o.format]].overwrite=!1,console.debug(`conflic format config ${o.format}(${t.overwriteFormats[o.format]} is invalid.)`)),t.overwriteFormats[o.format]=o.id)}),t.mode=await Editor.Profile.getProject("builder","textureCompressConfig.customConfigsMode")||"config"},async onToolBarChange(t,o){const e=this;switch(t){case"add-config":e.newConfigName=o,e.addConfig();break;case"import-config":e.importConfig();break;case"export-config":e.exportConfig();break;case"config-name":e.newConfigName=o;break;case"mode-change":e.mode=o,await Editor.Profile.setProject("builder","textureCompressConfig.customConfigsMode",o)}},async addConfig(){const t=this;if(!t.newConfigName)return void console.warn("Please enter config name first!");if(Object.values(t.customConfigs).find(o=>o.name===t.newConfigName)){if(0!==(await Editor.Dialog.info(Editor.I18n.t("builder.project.texture_compress.overwirteFormat",{configName:t.newConfigName}),{buttons:[Editor.I18n.t("builder.project.texture_compress.overwirte"),Editor.I18n.t("builder.project.texture_compress.cancel")],cancel:1,default:1})).response)return}const o=t.customConfigs||{},e=getDefaultConfig(t.newConfigName);t.$set(o,e.id,e),t.$root.customConfigs=o,await Editor.Profile.setProject("builder",`textureCompressConfig.customConfigs.${e.id}`,e),t.emitChange()},jumpToConfig(t){if(!this.$refs.wrap)return;const o=this.$refs.wrap.querySelector(`ui-section[id="${t}"]`);o&&(this.$refs.wrap.scrollTop=o.offsetTop-36)},async importConfig(){const t=this,o=(await Editor.Dialog.select({title:t.t("import_config"),path:Editor.Project.path,filters:[{name:"JSON",extensions:["json"]}]})).filePaths[0];if(!o)return;const e=await Editor.Dialog.warn(t.t("import_config_options"),{buttons:[t.t("overwrite"),t.t("merge")],default:1});let i;try{if(i=await fs_extra_1.readJSON(o),1===e.response)for(const o of Object.keys(i))i[o]&&i[o].format&&t.$set(t.customConfigs,o,i[o]);else t.$root.customConfigs=i}catch(t){return void console.error(t)}await Editor.Profile.setProject("builder","textureCompressConfig.customConfigs",i),console.log(`Import custom compress config from {link(${o})} success!`),t.emitChange()},async exportConfig(){const t=await Editor.Dialog.save({title:this.t("export_config"),path:path_1.join(Editor.Project.path,"custom-compress-config.json"),filters:[{name:"JSON",extensions:["json"]}]});t.filePath&&(await fs_extra_1.outputFile(t.filePath,JSON.stringify(this.customConfigs,null,2)),console.log(`Custom compress config has export in {link(${t.filePath})}.`))},async onConfigChange(t,o,e){this.$set(this.customConfigs[t],o,e),await Editor.Profile.setProject("builder",`textureCompressConfig.customConfigs.${t}`,this.customConfigs[t]),this.emitChange()},async onRemoveFormat(t){this.$set(this.customConfigs,t,null),delete this.customConfigs[t],await Editor.Profile.setProject("builder","textureCompressConfig.customConfigs",this.customConfigs),this.emitChange()},async emitChange(){this.$emit("update")}},exports.mounted=mounted;