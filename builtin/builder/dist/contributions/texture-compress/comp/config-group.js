"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){e[o=void 0===o?r:o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[r.length]=t);return r})(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&__createBinding(t,e,r[o]);return __setModuleDefault(t,e),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.computed=exports.data=exports.props=exports.components=exports.template=void 0,exports.created=created,exports.beforeDestroy=beforeDestroy;const fs_extra_1=require("fs-extra"),path_1=require("path"),configItems=__importStar(require("./config-items")),event_bus_1=require("../event-bus"),data=(exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static/contributions/config-group.html"),"utf8"),exports.components={"config-items":configItems},exports.props=["compressConfig","config","readonly","overwriteFormats"],function(){return{currentPlatform:"web",selectPlatforms:[]}});function created(){event_bus_1.EventBus.$on("blank-click",this.onBlankClickBind=this.onBlankClick.bind(this))}function beforeDestroy(){event_bus_1.EventBus.$off("blank-click",this.onBlankClickBind)}exports.data=data,exports.computed={showOverWrite(){var e=this;return!(!e.platformConfig[e.currentPlatform]||e.readonly&&(!e.config.overwrite||0===e.config.overwrite.length))},displayFormatInfo(){var e=this;if(Object.keys(e.config.options).length&&e.config.options[e.currentPlatform])return e.getFormatInfo("options",e.currentPlatform)},platformConfig(){const o=this,n=o.compressConfig.platformConfig,s={};return Object.keys(n).forEach(e=>{var t,r=n[e];r.textureCompressConfig&&(t=r.textureCompressConfig.platformType,o.compressConfig.configGroups[t].supportOverwrite)&&(s[t]||(s[t]={[e]:{name:r.name}}),s[t][e]={name:r.name})}),s}},exports.methods={onSelectPlatform(t){var e=this.selectPlatforms.findIndex(e=>e===t);-1===e?this.selectPlatforms.push(t):this.selectPlatforms.splice(e,1)},onBlankClick(){this.selectPlatforms=[]},showFormatMenu(e,t,r){Editor.Menu.popup({x:e.pageX,y:e.pageY,menu:this.getPlatformMenu(t,r)})},getPlatformMenu(r,o){const n=this;let t=[];"options"===r&&(e=n.compressConfig.configGroups[o].support,t=[...new Set([...e.rgba,...e.rgb])]);const s=n.compressConfig.formatsInfo;const i=[];Object.keys(n.compressConfig.textureFormatConfigs).forEach(e=>{e=n.compressConfig.textureFormatConfigs[e];1===e.formats.length?i.push(n.formatConfigOption(r,e.formats[0],o)):(t.length&&e.formats.filter(e=>t.includes(e.value)),i.push({label:e.displayName,submenu:e.formats.map(e=>n.formatConfigOption(r,e,o))}))});var e=Object.keys(n.compressConfig.customFormats).map(e=>{return{label:s[e].displayName+" (custom)",enabled:!n.config[o]||(t=e,!Object.keys(n.config[r][o]).find(e=>!!s[e]&&s[t].formatType===s[e].formatType&&s[t].alpha===s[e].alpha)),click(){n.$emit("add",r,o,e)}};var t});return[...i,{type:"separator"},...e]},checkFormatIsEnable(e,t,r){const o=this;if(!o.config[e]||!o.config[e][r])return!0;const n=o.compressConfig.formatsInfo[t];return!Object.keys(o.config[e][r]).find(e=>o.compressConfig.formatsInfo[e].formatType===n.formatType&&n.alpha===o.compressConfig.formatsInfo[e].alpha)},formatConfigOption(e,t,r){const o=this;return{label:t.displayName,enabled:o.checkFormatIsEnable(e,t.value,r),click(){o.$emit("add",e,r,t.value)}}},getFormatInfo(n,s){const i={},a=this;return Object.keys(a.config[n][s]).forEach(e=>{var t,r,o=a.compressConfig.formatsInfo[e];o?(t=JSON.parse(JSON.stringify(o)),a.overwriteFormats[e]&&a.compressConfig.formatsInfo[a.overwriteFormats[e]]&&(r=a.compressConfig.formatsInfo[a.overwriteFormats[e]],t.overwritedInfo={displayName:r.displayName,id:a.overwriteFormats[e]}),t.value=a.config[n][s][e],r=JSON.parse(JSON.stringify(a.compressConfig.textureFormatConfigs[o.formatType].options)),a.readonly&&(r.quality.render=Object.assign(r.quality.render,{attributes:{disabled:!0}})),t.options=r,i[e]=t):i[e]={displayName:""+e,missing:!0}}),i},removeFormat(e,t,r){this.$emit("remove",e,t,r)},onChangeQuality(e,t,r,o,n){var s=this;n&&o&&(s.config[e][t][n]=s.config[e][t][n]||{},s.config[e][t][n][r]=o,s.$emit("update",e,t,n,s.config[e][t][n]))},getCustomConfigInfo(e){var t=this.compressConfig.formatsInfo[e];return t||{displayName:e+"(missing)",missing:!0}},deletePlatformOverwrite(){const t=this;t.selectPlatforms.forEach(e=>{t.$emit("remove","overwrite",e)})},addPlatformOverwriteFormat(e,t){return this.showFormatMenu(e,"overwrite",t)},addPlatformOverwriteMenu(e){const t=this;var r=Object.keys(t.platformConfig[t.currentPlatform]).map(e=>{return{label:t.platformConfig[t.currentPlatform][e].name,enabled:t.checkPlatformAddEnable(e),click:()=>{t.$emit("add-platform",e,t.currentPlatform)}}});Editor.Menu.popup({x:e.x,y:e.y,menu:r})},checkPlatformAddEnable(e){return!this.config.overwrite||!this.config.overwrite[e]}};