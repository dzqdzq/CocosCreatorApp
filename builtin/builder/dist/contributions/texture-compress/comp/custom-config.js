"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeDestroy=exports.created=exports.methods=exports.data=exports.props=exports.template=void 0;const event_bus_1=require("../event-bus");exports.template='\n<div class="custom-format" v-if="config && formatsInfo">\n    <ui-section class="content" expand>\n        <div class="config-header flex-spacing-between" slot="header">\n            <span>\n                <ui-input\n                    v-if="inEdit"\n                    :value="config.name"\n                    :tooltip="config.name"\n                    @click.stop\n                    @confirm="onChangeFormatName($event.target.value)"\n                ></ui-input>\n                <ui-label v-else :value="config.name"></ui-label>\n            </span>\n            <ui-button type="icon" class="transparent child-margin-right"\n                @click.stop="showMenu"\n            >\n                <ui-icon value="menu"></ui-icon>\n            </ui-button>\n        </div>\n        <div @confirm="onConfigChange" class="config-content">\n            <ui-prop>\n                <ui-label slot="label" value="i18n:builder.project.texture_compress.customFormat.format"></ui-label>\n                <ui-select slot="content" path="format"\n                    :value="config.format || Object.keys(formatsInfo)[0]"\n                >\n                    <option\n                        v-for="(format, formatId) in formatsInfo"\n                        :value="formatId"\n                        :key="formatId"\n                    >{{format.displayName}}</option>\n                </ui-select>\n            </ui-prop>\n            <ui-prop>\n                <ui-label slot="label" value="i18n:builder.project.texture_compress.customFormat.overwrite"></ui-label>\n                <ui-checkbox slot="content" path="overwrite"\n                    :value="config.overwrite"\n                ></ui-checkbox>\n            </ui-prop>\n            <ui-prop>\n                <ui-label slot="label" value="i18n:builder.project.texture_compress.customFormat.compressTools"></ui-label>\n                <div slot="content">\n                    <ui-prop class="config-item">\n                        <ui-label slot="label" value="i18n:builder.project.texture_compress.customFormat.program"></ui-label>\n                        <ui-file slot="content"\n                            path="path"\n                            protocols="file,project"\n                            :value="config.path"\n                        ></ui-file>\n                    </ui-prop>\n                    <ui-prop class="config-item">\n                        <ui-label slot="label" value="i18n:builder.project.texture_compress.customFormat.commandParams"></ui-label>\n                        <div\n                            slot="content"\n                        >\n                            <ui-input\n                                path="command"\n                                :value="config.command"\n                            ></ui-input>\n                            <ui-button @click="showAddParamsMenu">\n                                <ui-icon value="arrow-triangle"></ui-icon>\n                            </ui-button>\n                        </div>\n                    </ui-prop>\n                </div>\n            </ui-prop>\n        </div>\n    </ui-section>\n</div>\n',exports.props=["formatsInfo","config","customConfigs","overwriteFormats"];const data=function(){return{editTypList:{program:"程序",npm:"npm 库"},inEdit:""}};function created(){event_bus_1.EventBus.$on("blank-click",this.onBlankClickBind=this.onBlankClick.bind(this))}function beforeDestroy(){event_bus_1.EventBus.$off("blank-click",this.onBlankClickBind)}exports.data=data,exports.methods={removeFormat(){this.$emit("remove",this.config.id)},async onConfigChange(e){const t=e.target,o=t.getAttribute("path");if(!o)return;const i=this,n=t.value,r=i.config.id;if("overwrite"===o||"format"===o){const e=!!("overwrite"===o?n:i.config.overwrite),a="format"===o?n:i.config.format,s=i.config[o];if(!0===e){if(i.overwriteFormats[a]&&!0===e){const e=i.overwriteFormats[i.customConfigs[r].format];if(!i.customConfigs[e])return i.config[o]=!0,delete i.overwriteFormats[i.customConfigs[r].format],void i.$emit("update",r,"overwrite",!0);if(1===(await Editor.Dialog.info(Editor.I18n.t("builder.project.texture_compress.customFormat.conflictOverwrite",{rawFormat:a,conflictFormat:i.customConfigs[e]&&i.customConfigs[e].name||e}),{buttons:[Editor.I18n.t("builder.project.texture_compress.overwrite"),Editor.I18n.t("builder.project.texture_compress.cancel")],cancel:1,default:1})).response)return void(t.value=s);i.$emit("update",e,"overwrite",!1)}else i.config[o]=n;const c="format"===o?s:i.config.format;delete i.overwriteFormats[c],i.$set(i.overwriteFormats,a,r)}else i.config[o]=s,"overwrite"===o&&delete i.overwriteFormats[a]}i.$emit("update",r,o,n)},showMenu(e){Editor.Menu.popup({x:e.pageX,y:e.pageY,menu:[{label:"i18n:builder.project.texture_compress.editConfigName",enabled:!this.readonly,click:()=>{this.inEdit=!0}},{label:"i18n:builder.copyConfig",click:()=>{this.$emit("add-config",this.config.id)}},{label:"i18n:builder.project.texture_compress.copyId",click:()=>{Editor.Clipboard.write("text",this.config.id)}},{type:"separator"},{label:"i18n:builder.delete",enabled:!this.readonly,click:()=>{this.removeFormat()}}]})},onChangeFormatName(e){this.$emit("update",this.config.id,"name",e)},showAddParamsMenu(e){const t=this,o=["src","dest","quality"].map(e=>({label:e,click:()=>{t.addParam(e)}}));Editor.Menu.popup({x:e.x,y:e.y,menu:o})},addParam(e){this.config.command+=" ${"+e+"}",this.$emit("update",this.config.id,"command",this.config.command)},onBlankClick(){this.inEdit=!1}},exports.created=created,exports.beforeDestroy=beforeDestroy;