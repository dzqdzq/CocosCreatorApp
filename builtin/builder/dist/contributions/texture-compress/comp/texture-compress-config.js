"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeDestroy=exports.created=exports.methods=exports.data=exports.components=exports.computed=exports.props=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),configGroup=__importStar(require("./config-group")),event_bus_1=require("../event-bus");exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static/contributions/texture-compress-config.html"),"utf8"),exports.props=["compressInfo","config","readonly","name","id","overwriteFormats"],exports.computed={initialized(){return this.compressInfo&&this.config}},exports.components={"config-group":configGroup};const data=()=>({inEdit:!1});function created(){event_bus_1.EventBus.$on("blank-click",this.onBlankClickBind=this.onBlankClick.bind(this))}function beforeDestroy(){event_bus_1.EventBus.$off("blank-click",this.onBlankClickBind)}exports.data=data,exports.methods={showFormatMenu(e,t){Editor.Menu.popup({x:e.pageX,y:e.pageY,menu:t?this.getPlatformMenu(t):this.getMenu()})},getMenu(){const e=this,t=e.compressInfo.configGroups;return Object.keys(t).map(o=>({label:t[o].displayName,submenu:e.getPlatformMenu(o)}))},getPlatformMenu(e){const t=this,o=t.compressInfo.configGroups[e].support,r=[...new Set([...o.rgba,...o.rgb])],i=t.compressInfo.formatsInfo;const n=[];Object.keys(t.compressInfo.textureFormatConfigs).forEach(o=>{const i=t.compressInfo.textureFormatConfigs[o];1!==i.formats.length?(i.formats.filter(e=>r.includes(e.value)),n.push({label:i.displayName,submenu:i.formats.map(o=>t.formatConfigOption(o,e))})):n.push(t.formatConfigOption(i.formats[0],e))});const s=Object.keys(t.compressInfo.customFormats).map(o=>({label:i[o].displayName+" (custom)",enabled:!t.config[e]||(o=o,!Object.keys(t.config[e]).find(e=>!!i[e]&&i[o].formatType===i[e].formatType&&i[o].alpha===i[e].alpha)),click(){t.$emit("add",t.id,e,o)}}));var a;return[...n,{type:"separator"},...s]},checkFormatIsEnable(e,t){const o=this;if(!o.config[t])return!0;const r=o.compressInfo.formatsInfo[e];return!Object.keys(o.config[t]).find(e=>o.compressInfo.formatsInfo[e].formatType===r.formatType&&r.alpha===o.compressInfo.formatsInfo[e].alpha)},formatConfigOption(e,t){const o=this;return{label:e.displayName,enabled:o.checkFormatIsEnable(e.value,t),click(){o.$emit("add",o.id,t,e.value)}}},onChangeFormatName(e){this.$emit("change",this.id,e)},updateFormatQuality(e,t,o){this.$emit("update",this.id,e,t,o)},showEditMenu(e){Editor.Menu.popup({x:e.pageX,y:e.pageY,menu:[{label:"i18n:builder.project.texture_compress.editConfigName",enabled:!this.readonly,click:()=>{this.inEdit=!0}},{label:"i18n:builder.copyConfig",click:()=>{this.$emit("add-config",this.id)}},{label:"i18n:builder.project.texture_compress.copyId",click:()=>{Editor.Clipboard.write("text",this.id)}},{type:"separator"},{label:"i18n:builder.delete",enabled:!this.readonly,click:()=>{this.onRemoveFormat()}}]})},onRemoveFormat(e,t){this.$emit("remove",this.id,e,t)},onBlankClick(){this.inEdit=!1}},exports.created=created,exports.beforeDestroy=beforeDestroy;