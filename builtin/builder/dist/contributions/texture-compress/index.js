"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),compressPresets=__importStar(require("./page/compress-presets")),compressFormat=__importStar(require("./page/compress-format")),event_bus_1=require("./event-bus"),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1;const vueTemplate=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/contributions/texture-compress.html"),"utf8");function ready(){const e=this;if(!e.vm){const t=new Vue({components:{"compress-presets":compressPresets,"compress-format":compressFormat},data:()=>({tab:"presets",tabList:{presets:{label:"i18n:builder.project.texture_compress.compress_preset",comp:"compress-presets"},format:{label:"i18n:builder.project.texture_compress.custom_format",comp:"compress-format"}},textureCompressConfig:null,configDirty:!1,customConfigs:null,overwriteFormats:{},genMipmaps:!0}),created(){document.addEventListener("click",onBlankClick)},destroyed(){document.removeEventListener("click",onBlankClick)},methods:{t:e=>Editor.I18n.t(`builder.project.texture_compress.${e}`),async refresh(){var e;const t=await Editor.Message.request("builder","query-compress-config");if(!t)return;const r=null===(e=await Editor.Profile.getProject("builder","textureCompressConfig.genMipmaps"))||void 0===e||e,s=await Editor.Profile.getProject("builder","textureCompressConfig.customConfigs")||{};this.genMipmaps=r,this.customConfigs=s,this.textureCompressConfig=t,this.calcOverwriteFormats()},calcOverwriteFormats(){const e=this.customConfigs;if(e){const t=Object.values(e);if(Array.isArray(t)){const r={};t.forEach(t=>{if(t.overwrite){const s=r[t.format];if(s){const o=e[s];o&&(o.overwrite=!1,console.debug(`conflic format config ${t.format}(${r[t.format]} is invalid.)`))}r[t.format]=t.id}}),this.overwriteFormats=r}}},async onChangeTab(e,t){this.tab=e,this.configDirty&&await this.refresh(),t&&process.nextTick(()=>{const r=this.tabList[e];if(r){const e=r.comp,s=this.$refs[e];s&&s.jumpToConfig(t)}})},onConfigChange(){this.configDirty=!0},updateMipmapConfig(e){const t=e.target;this.genMipmaps="on"===t.value,Editor.Profile.setProject("builder","textureCompressConfig.genMipmaps",this.genMipmaps)}},template:vueTemplate});t.$mount(e.$.container),e.vm=t}e.vm.refresh()}function onBlankClick(e){event_bus_1.EventBus.$emit("blank-click",e)}function close(){var e;null===(e=this.vm)||void 0===e||e.$destroy(),this.vm=null}exports.style=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"./texture-compress.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"},exports.ready=ready,exports.close=close;