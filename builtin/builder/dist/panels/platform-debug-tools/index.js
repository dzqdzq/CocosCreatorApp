"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),custom_render_1=require("./custom-render"),Vue=require("vue/dist/vue.js");function translateName(e){return e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):""}Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/template/platform-debug-tools.html"),"utf8"),BuilderPlatformDebugToolsVM=Vue.extend({name:"BuilderPlatformDebugToolsVM",data:()=>({platforms:[],currentPlatform:"vivo-mini-game",currentProjectPath:"",projectList:{},platformConfigMap:{},processState:{},selectProject:"",consoleInfo:{}}),computed:{project(){return this.currentProjectPath||this.selectProject}},methods:{translateName:translateName,async executeCompMethod(e){if(!this.currentPlatform||!this.currentProjectPath)return;let t=this.$refs[this.currentPlatform+"custom"];if(Array.isArray(t)&&(t=t[0]),t&&t.handleCommand){if(await t.handleCommand(e))return}Editor.Message.send("builder",e+"-build-task",this.currentProjectPath,this.currentPlatform)},resetSelection(){this.currentProjectPath=""},onPlatformChange(e){const t=e.target;this.currentPlatform=t.value,this.currentProjectPath=""}},template:vueTemplate});async function ready(e,t,r){console.debug("ready",e,t,r),panel=this;const o={},a=[],n={},s={},l=await Editor.Message.request("builder","query-platform-config");l&&Array.isArray(l.order)&&l.order.forEach(e=>{const t=l.config[e];if(t&&t.name&&t.supportRun&&t.supportRun&&(o[e]={},s[e]={requireCompile:t.requireCompile,supportRun:t.supportRun},a.push({label:translateName(t.name),value:e}),t.debugConfig)){const r=(0,custom_render_1.getVueComponentFromConfig)(t.debugConfig,e);for(const e of r)n[e.name]=e;s[e].compNames=r.map(e=>e.name)}});const i=await Editor.Message.request("builder","query-tasks");Object.values(i).forEach(e=>{if(!e.options)return;const{platform:t,buildPath:r,outputName:a}=e.options;if(!o[t]||!r||!a)return;const n=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(r),a);o[t][n]={name:a,path:n}}),null===vm||void 0===vm||vm.$destroy(),(vm=new BuilderPlatformDebugToolsVM({data:{platforms:a,currentPlatform:e||"vivo-mini-game",currentProjectPath:t||"",projectList:o,platformConfigMap:s},components:n})).$mount(panel.$.container),r&&vm.executeCompMethod(r)}function close(){null===vm||void 0===vm||vm.$destroy(),vm=null,panel=null}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/platform-debug-tools.css")),exports.template='\n<div class="container"></div>\n',exports.$={container:".container"},exports.methods={initState(e,t,r){e&&(panel.vm.platform=e),t&&(panel.vm.packagePath=t),r&&panel.vm.executeCompMethod(r)},updateCompileProcess(e,t){panel.vm.$set(panel.vm.processState,e,t)},updateConsole(e,t,r){if(!e||!r||!t)return;const o=panel.vm.consoleInfo[e];Array.isArray(o)?o.push({type:t,message:r}):panel.vm.$set(panel.vm.consoleInfo,e,[{type:t,message:r}])}},exports.ready=ready,exports.close=close;