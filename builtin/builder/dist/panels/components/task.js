"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.components=exports.methods=exports.computed=exports.data=exports.props=exports.template=void 0;const electron_1=require("electron"),fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../../share/utils"),plugin_1=require("../plugin");function data(){return{missing:!1}}function mounted(){const t=this;if(1===t.progress){const e=Editor.UI.File.resolveToRaw(t.task.options.buildPath);t.missing=(0,fs_extra_1.existsSync)(e)}}exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static","/template/components/task.html"),"utf8"),exports.props=["task","free","dbReady","runningTask"],exports.data=data,exports.computed={isPluginTaskBusy(){const t=this.task;return"processing"===t.state||"waiting"===t.state},isPlatformDisabled(){return!plugin_1.pluginManager.platformMap[this.task.options.platform]}},exports.methods={t:t=>Editor.I18n.t(`builder.${t}`),_onCheckOptions(t){const e=this;e.isPlatformDisabled||e.$root.checkTaskRawOptions(e.task.id)},_onEditOptions(t){this.$root.editTaskOptions(this.task.id)},_onRebuild(){Editor.Message.send("builder","recompile-task",String(this.task.id),this.task.options)},async _onRemoveTask(t){const e=this;if(e.isPluginTaskBusy)return;const s=await e.showDeleteRawDir(e.task.options.outputName);return 0!==s?2===s?(e.$root.internalMaskInfo="i18n:builder.tips.waiting_for_remove_task",await Editor.Message.request("builder","remove-task",String(e.task.id),!0),void(e.$root.internalMaskInfo="")):void await Editor.Message.request("builder","remove-task",String(e.task.id)):void 0},async revealInExplorer(){const t=this,e=t.task.rawOptions||t.task.options,s=(0,path_1.join)(Editor.UI.File.resolveToRaw(e.buildPath),e.outputName||"");if((0,fs_extra_1.existsSync)(s))electron_1.shell.showItemInFolder(s);else{1===(await Editor.Dialog.info("文件夹不存在，是否移除该构建任务",{title:"文件夹不存在",buttons:["cancel","delete"],default:0})).response&&t._onRemoveTask()}},async showBuildLog(){const t=this.task.options.platform+(0,utils_1.changeToLocalTime)(this.task.id).replace(":","-"),e=(0,path_1.join)(Editor.Project.tmpDir,"builder","log",t+".log");(0,fs_extra_1.existsSync)(e)||(0,fs_extra_1.outputFileSync)(e,"","utf-8"),"openFileDir"===await Editor.Profile.getConfig("builder","log.openType")?electron_1.shell.showItemInFolder(e):electron_1.shell.openPath(e)},async checkTask(){const t=this;let e=t.task.options.buildPath;if((0,path_1.isAbsolute)(e)||(e=(0,path_1.join)(Editor.UI.File.resolveToRaw(t.task.options.buildPath),t.task.options.outputName||"")),!(0,fs_extra_1.existsSync)(e)){return 1===(await Editor.Dialog.info(Editor.I18n.t("builder.check_task.message"),{title:Editor.I18n.t("builder.check_task.title"),buttons:[Editor.I18n.t("builder.check_task.cancel"),Editor.I18n.t("builder.check_task.delete")],default:0})).response&&t._onRemoveTask(),!1}return!0},async showDeleteRawDir(t){const e=this.t;let s="";return"processing"===this.task.state&&(s=e("is_remove_task.has_building_task")),s+=e("is_remove_task.message"),(await Editor.Dialog.info(s,{title:`${e("is_remove_task.title")} ${t}`,buttons:[e("is_remove_task.cancel"),e("is_remove_task.remove"),e("is_remove_task.deep_remove")],default:0,cancel:0})).response}},exports.components={buttons:require("./buttons")},exports.mounted=mounted;