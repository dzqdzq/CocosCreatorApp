"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.components=exports.methods=exports.data=exports.props=exports.template=void 0;const electron_1=require("electron"),fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../../share/utils"),plugin_1=require("../plugin");function data(){return{runningTask:""}}exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../../static","/template/components/task.html"),"utf8"),exports.props=["task","free","dbReady"],exports.data=data,exports.methods={t:t=>Editor.I18n.t(`builder.${t}`),_onCheckOptions(t){this.$root.checkTaskRawOptions(this.task.id)},_onEditOptions(t){this.$root.editTaskOptions(this.task.id)},_onRebuild(){Editor.Message.send("builder","recompile-task",String(this.task.id),this.task.options)},async _onRemoveTask(t){const e=this,s=await this.showDeleteRawDir(this.task.options.outputName);if(0!==s)return 2===s?(e.$root.maskInfo="i18n:builder.tips.waiting_for_remove",await Editor.Message.request("builder","remove-task",String(e.task.id),!0),void(e.$root.maskInfo="")):void await Editor.Message.request("builder","remove-task",String(e.task.id))},async revealInExplorer(){const t=this,e=t.task.rawOptions||t.task.options,s=plugin_1.pluginManager.getRealInFileExplorer(e.platform);if(s)return s(e);let o=e.buildPath;if(path_1.isAbsolute(o)||(o=path_1.join(utils_1.getBuildDist(e.buildPath),e.outputName||"")),fs_extra_1.existsSync(o))electron_1.shell.showItemInFolder(o);else{1===(await Editor.Dialog.info("文件夹不存在，是否移除该构建任务",{title:"文件夹不存在",buttons:["cancel","delete"],default:0})).response&&t._onRemoveTask()}},showBuildLog(){const t=this.task.options.platform+utils_1.changeToLocalTime(this.task.id).replace(":","-"),e=path_1.join(Editor.Project.tmpDir,"builder","log",t+".log");fs_extra_1.existsSync(e)||fs_extra_1.outputFileSync(e,"","utf-8"),electron_1.shell.openPath(e)},async checkTask(){const t=this;let e=t.task.options.buildPath;if(path_1.isAbsolute(e)||(e=path_1.join(utils_1.getBuildDist(t.task.options.buildPath),t.task.options.outputName||"")),!fs_extra_1.existsSync(e)){return 1===(await Editor.Dialog.info("文件夹不存在，是否移除该构建任务",{title:"文件夹不存在",buttons:["cancel","delete"],default:0})).response&&t._onRemoveTask(),!1}return!0},async showDeleteRawDir(t){const e=this.t;let s="";return"processing"===this.task.state&&(s=e("is_remove_task.has_building_task")),s+=e("is_remove_task.message"),(await Editor.Dialog.info(s,{title:`${e("is_remove_task.title")} ${t}`,buttons:[e("is_remove_task.cancel"),e("is_remove_task.remove"),e("is_remove_task.deep_remove")],default:0,cancel:0})).response}},exports.components={buttons:require("./buttons")};