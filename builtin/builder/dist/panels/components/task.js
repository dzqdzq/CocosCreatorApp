"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.components=exports.methods=exports.computed=exports.data=exports.props=exports.template=void 0;const electron_1=require("electron"),fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../../share/utils"),plugin_1=require("../plugin");function data(){return{missing:!1}}function mounted(){const t=this;t.$nextTick(()=>{if(1===t.progress){const e=Editor.UI.__protected__.File.resolveToRaw(t.task.options.buildPath);t.missing=(0,fs_extra_1.existsSync)(e)}t.$emit("childTaskRendered")})}function t(t){return Editor.I18n.t(`builder.${t}`)}async function showShouldBreakTask(e){return(await Editor.Dialog.info(`${t("isBreakBuildTask.title")} ${e}`,{title:e,buttons:[t("isBreakBuildTask.break"),t("cancel")],default:1,cancel:1})).response}exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static","/template/components/task.html"),"utf8"),exports.props=["task","free","dbReady","runningTask"],exports.data=data,exports.computed={isPluginTaskBusy(){const t=this.task;return"processing"===t.state||"waiting"===t.state},isPlatformDisabled(){return!plugin_1.pluginManager.platformMap[this.task.options.platform]}},exports.methods={t:t,_onCheckOptions(t){const e=this;e.isPlatformDisabled||(e.$root.checkTaskRawOptions(e.task.id),(0,utils_1.Metric)("dblclick"===t?"B100023":"B100024"))},_onEditOptions(t){this.$root.editTaskOptions(this.task.id)},_onRebuild(){Editor.Message.send("builder","recompile-task",String(this.task.id),this.task.options)},async _onRemoveTask(t){const e=this;if(e.isPluginTaskBusy){return void(0===await showShouldBreakTask(e.task.options.taskName||e.task.options.outputName)&&Editor.Message.send("builder","break-task",String(e.task.id)))}if(e.task.options.buildPath){const t=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(e.task.options.buildPath),e.task.options.outputName);if(!(0,fs_extra_1.existsSync)(t))return void await Editor.Message.request("builder","remove-task",String(e.task.id))}const s=await e.showDeleteRawDir(e.task.options.taskName||e.task.options.outputName);if(0!==s)return 2===s?(e.$root.internalMaskInfo="i18n:builder.tips.waiting_for_remove_task",await Editor.Message.request("builder","remove-task",String(e.task.id),!0),void(e.$root.internalMaskInfo="")):void await Editor.Message.request("builder","remove-task",String(e.task.id))},async revealInExplorer(){const t=this,e=t.task.rawOptions||t.task.options,s=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(e.buildPath),e.outputName||"");if((0,fs_extra_1.existsSync)(s))electron_1.shell.showItemInFolder(s);else{if(t.isPluginTaskBusy)return;1===(await Editor.Dialog.info(Editor.I18n.t("builder.isRemoveBuildTask.title"),{title:e.taskName||e.outputName,buttons:[Editor.I18n.t("builder.cancel"),Editor.I18n.t("builder.delete")],default:0})).response&&t._onRemoveTask()}},async showBuildLog(){const t=Editor.UI.__protected__.File.resolveToRaw(this.task.options.logDest||(0,utils_1.getTaskLogDest)(this.task.options.platform,this.task.id));if((0,fs_extra_1.existsSync)(t)||((0,fs_extra_1.outputFileSync)(t,"","utf-8"),console.debug("log file is empty: ",t)),"openFileDir"===await Editor.Profile.getConfig("builder","log.openType"))electron_1.shell.showItemInFolder(t);else{await Editor.Message.request("program","open-program","scriptEditor",{_args:[t]})||electron_1.shell.openPath(t)}},async checkTask(){const t=this;let e=t.task.options.buildPath;if((0,path_1.isAbsolute)(e)||(e=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(t.task.options.buildPath),t.task.options.outputName||"")),!(0,fs_extra_1.existsSync)(e)){return 1===(await Editor.Dialog.info(Editor.I18n.t("builder.check_task.message"),{title:e,buttons:[Editor.I18n.t("builder.check_task.cancel"),Editor.I18n.t("builder.check_task.delete")],default:0})).response&&t._onRemoveTask(),!1}return!0},async showDeleteRawDir(t){const e=this.t;let s="";return"processing"===this.task.state&&(s=e("is_remove_task.has_building_task")),s+=e("is_remove_task.message"),(await Editor.Dialog.info(s,{title:`${e("is_remove_task.title")} ${t}`,buttons:[e("is_remove_task.cancel"),e("is_remove_task.remove"),e("is_remove_task.deep_remove")],default:0,cancel:0})).response}},exports.components={buttons:require("./buttons")},exports.mounted=mounted;