"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.methods=exports.data=exports.components=exports.props=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),platformConfig=__importStar(require("../../../share/platforms-options")),buttonsComponent=__importStar(require("../buttons")),buildProp=__importStar(require("../build-prop/index")),errorInfo=__importStar(require("../error-info")),validator_manager_1=require("../../../share/validator-manager"),lodash=require("lodash"),Vue=require("vue/dist/vue.js");function data(){return{builtinPlugins:platformConfig.builtinPlugins,pkgOptions:{},pkgErrorMap:{},disabledPkg:["android","huawei-agc","ios","windows","mac","native","ohos"]}}async function mounted(){await this.init(),this.updatePluginRender(this.options.platform);const e=require("@editor/setting");this.dev=e.dev}exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../../../../static","/template/components/settings/build-plugin.html"),"utf8"),exports.props=["config","options","free","errorMap","name","type","updateInfo"],exports.components={"error-info":errorInfo,"build-prop":buildProp,buttons:buttonsComponent},exports.data=data,exports.methods={t(e,t=!0){e=e.replace("i18n:","");const o=Editor.I18n.t(`${t?"builder.":""}${e}`);return o&&"string"==typeof o?o:e},onConfirm(e,t){const o=e.target.value;this.onDataUpdate(t,o)},onPanelUpdate(e,t,o){const r=this;void 0!==o&&r.$root.updateErrorMap(e,o&&JSON.parse(JSON.stringify(o))||null),lodash.set(r.options,e,t&&JSON.parse(JSON.stringify(t))),Editor.Profile.setConfig(r.config.pkgName,`options.${r.options.platform}`,lodash.get(r.options,`packages.${r.config.pkgName}`),"local"),r.$emit("datachange",r.config.pkgName,e,t)},onDataUpdate(e,t){this.checkValue(e,t),this.$root.updateErrorMap(`packages.${this.config.pkgName}.${e}`,lodash.get(this.pkgErrorMap,e)),lodash.set(this.options,`packages.${this.config.pkgName}.${e}`,t),lodash.set(this.pkgOptions,`${e}`,t),Editor.Profile.setConfig(this.config.pkgName,`options.${this.options.platform}.${e}`,t,"local"),this.$emit("datachange",this.config.pkgName,`packages.${this.config.pkgName}.${e}`,t)},async init(){const e=this;if(e.pkgOptions=e.options.packages&&e.options.packages[e.config.pkgName]||{},lodash.set(e.options,`packages.${e.config.pkgName}`,e.pkgOptions),e.pkgErrorMap=lodash.get(e.errorMap,`packages.${e.config.pkgName}`)||{},e.config.options){for(const t of Object.keys(e.config.options))await e.checkValue(t,e.pkgOptions[t]);e.pkgErrorMap=JSON.parse(JSON.stringify(e.pkgErrorMap))}},async checkValue(e,t){const o=this;if(!o.config||!o.config.options||!o.config.options[e])return;const{verifyRules:r,render:i}=o.config.options[e];if(r&&i){if(validator_manager_1.validator.check("required",t)||r.includes("required")){const i=await validator_manager_1.validatorManager.check(t,o.options,r,o.options.platform+o.config.pkgName);o.pkgErrorMap[e]=i||null}else o.pkgErrorMap[e]=null;o.$root.updateErrorMap&&o.$root.updateErrorMap(`packages.${o.config.pkgName}.${e}`,o.pkgErrorMap[e])}},updatePluginRender(){const e=this,t=e.config;if(t.panelInfo){const o=document.createElement("ui-panel"),r={};Object.keys(t.panelInfo).forEach(e=>{r[e]=t.panelInfo[e]}),t.panelInfo.ready&&(r.ready=(()=>t.panelInfo.ready.call(o.panelObject,JSON.parse(JSON.stringify(e.options)),e.type,t.pkgName,JSON.parse(JSON.stringify(e.errorMap))))),r.style=fs_extra_1.readFileSync(path_1.join(__dirname,"./../../../../dist/build-plugin.css"),"utf8")+(r.style||""),o.config=r,o.setAttribute("name",t.displayName),e.$uiPanel=o,Vue.nextTick(()=>{const r=Array.isArray(e.$refs[t.pkgName])?e.$refs[t.pkgName][0]:e.$refs[t.pkgName];r?(r.innerHTML="",r.appendChild(o)):console.warn(`Can't get pluginContent from ${t.pkgName}`)})}},async update(e,t){"string"==typeof t&&e&&e!==this.config.pkgName&&(await this.init(),this.$uiPanel&&this.$uiPanel.update(JSON.parse(JSON.stringify(this.options)),t))}},exports.mounted=mounted;