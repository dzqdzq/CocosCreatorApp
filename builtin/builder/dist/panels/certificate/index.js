"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path");let vm,panel=null;const Vue=require("vue/dist/vue.js");async function ready(){vm=new Vue({el:(panel=this).$.certificate,data:{settings:{country:"CN",state:"福建省",locality:"厦门市",organizationalUnit:"",organization:"",commonName:"",email:"",certificatePath:""},dirty:!1,saveBtnState:!1,saveBtnDisabled:!1,generateSuccess:!1,verifyResult:{},verifyFuncMap:{certificatePath(e){let t="";return Editor.Utils.Path.contains(path_1.join(Editor.Project.path,"./build"),e)&&(t="Can't specify certificate path in the build path"),t},country(e){if(!/^[A-Z]{2}$/.test(e))return"i18n:builder.certificate.country_error"}}},methods:{onConfirm(e){var t;const i=e.target.getAttribute("name");if(!i)return;const s=e.target.value,r=this;r.dirty=!0,r.saveBtnState=!1;let a=r.judgeEmpty(i,s);a||(a=null===(t=r.verifyFuncMap[i])||void 0===t?void 0:t.call(r,s)),r.verifyResult[i]=a,a&&console.warn(a),r.saveBtnDisabled=r.calcBtnState(),r.settings[i]=s,Editor.Profile.setConfig("builder",`certificate.${i}`,s,"global")},judgeEmpty(e,t){let i="";return t&&0!=t.trim().length||(i=`${e} can't be empty`),i},onGenerate(){const e=this;-1===process.env.PATH.indexOf("/usr/bin/openssl")&&(process.env.PATH+=":/usr/bin/openssl");const t=e.settings.certificatePath,{country:i,state:s,locality:r,organization:a,organizationalUnit:n,commonName:o,email:c}=e.settings;var l=`/C=${i}/ST=${s}/L=${r}/O=${a}/OU=${n}/CN=${o}/emailAddress=${c}`;const u=path_1.join(Editor.App.path,"../tools/openSSLWin64/bin");var d=path_1.join(u,"openssl"),p=`${"win32"===process.platform?d:"openssl"} req -newkey rsa:2048 -nodes -keyout private.pem -x509 -days 3650 -out certificate.pem -subj ${l}`,f=path_1.join(u,"openssl.cfg"),v="win32"===process.platform?{OPENSSL_CONF:f}:process.env;(0,require("child_process").exec)(`${p}`,{env:v,cwd:t},t=>{if(t)return e.generateSuccess=!1,void console.error(Editor.I18n.t("builder.certificate.build_certificate_fail")+t);console.log(Editor.I18n.t("builder.certificate.build_certificate_complete")),e.generateSuccess=!0,Editor.Panel.close("builder.certificate")})},calcBtnState(){const e=this;if(e.saveBtnState)return!0;for(const t of Object.keys(e.verifyResult))if(e.verifyResult[t])return!0;return!1},async initData(){var e;const t=this,i=await Editor.Profile.getConfig("builder","certificate");Object.assign(t.settings,i);for(const i of Object.keys(t.settings)){let s=t.judgeEmpty(i,t.settings[i]);s||(s=null===(e=t.verifyFuncMap[i])||void 0===e?void 0:e.call(t,t.settings[i])),t.verifyResult[i]=s,s&&(t.saveBtnState=!0,t.saveBtnDisabled=!0)}}},async mounted(){this.netStatus="success",await this.initData()}})}async function beforeClose(){}async function close(){}async function checkIsSave(){if(!vm||!vm.dirty)return;const e=Editor.I18n.t,t=await Editor.Dialog.warn(e("builder.splash_setting.is_save_dialog.title"),{buttons:[e("builder.splash_setting.is_save_dialog.save"),e("builder.splash_setting.is_save_dialog.cancel"),e("builder.splash_setting.is_save_dialog.abort")],default:0,cancel:1});return 1!==t.response&&(0===t.response&&await vm.saveSettings(),!0)}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../../dist/certificate.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../../static/template/certificate.html"),"utf8"),exports.$={certificate:".certificate"},exports.methods={},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;