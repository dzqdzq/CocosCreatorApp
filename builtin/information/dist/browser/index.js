"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=exports.contributions=void 0;const electron_1=require("electron"),querystring_1=require("querystring"),formURLMap={};async function load(){}async function unload(){}exports.contributions={enable(e,o){exports.methods.attach(e,o)}},exports.methods={attach(e,o){e.invalid||o.tags&&Array.isArray(o.tags)&&o.tags.forEach(e=>{exports.methods.queryInfo(e)})},async queryInfo(e){if(formURLMap[e])return formURLMap[e];try{const o=await Editor.Profile.getConfig("utils","information_url"),t=await Editor.User.getData(),r=await Editor.Network.get(o,{form:e,uid:t.cocos_uid,pid:Editor.Project.uuid,ver:Editor.App.version,lang:Editor.I18n.getLanguage()}),n=JSON.parse(r.toString());return formURLMap[e]={enable:!!n.result.enable,complete:!!n.result.complete,form:n.result.form}}catch(e){return null}},async openDialog(e,o){const t=await Editor.User.getData();(o=o||{}).uid=t.cocos_uid,o.pid=Editor.Project.uuid,o.ver=Editor.App.version,o.lang=Editor.I18n.getLanguage();const r=electron_1.BrowserWindow.getFocusedWindow(),n=new electron_1.BrowserWindow;r&&n!==r&&!r.isDestroyed()&&n.webContents.on("dom-ready",()=>{n.setParentWindow(r)});let a=e;return/\?/.test(e)?a+="&"+(0,querystring_1.stringify)(o||{}):a+="?"+(0,querystring_1.stringify)(o||{}),n.loadURL(a),new Promise(e=>{n.on("closed",()=>{e(void 0)})})},async queryInformation(e,o){o&&o.force&&delete formURLMap[e];const t=await exports.methods.queryInfo(e);return t?{enable:!!t.enable,complete:!!t.complete,form:t.form||""}:null},async informationDialog(e,o){if(formURLMap[e]||await exports.methods.queryInfo(e),!formURLMap[e]||!formURLMap[e].enable)return{action:"unusual"};const t=formURLMap[e];return t.complete?{action:"resolve"}:(await exports.methods.openDialog(t.form,o),delete formURLMap[e],await exports.methods.queryInfo(e),formURLMap[e]&&formURLMap[e].enable?formURLMap[e].complete?{action:"resolve"}:{action:"reject"}:{action:"cancel"})}},exports.load=load,exports.unload=unload;