var e=require("path"),r=require("http"),t=require("fire-fs");const i=require("express"),o=i();var n,a=function(e,r,t,i){function o(){e.removeListener("error",n),i(null,r)}function n(n){if(e.removeListener("listening",o),"EADDRINUSE"!==n.code&&"EACCES"!==n.code)return i(n);Editor.warn(`The current '${r}' preview port is already occupied, the port is automatically incremented`),a(e,++r,t,i)}e.once("error",n),e.once("listening",o),e.listen(r,t)};let s={npmRunServer:async function(s,c){var u=n.dest,d=e.join(u,"dist");if(!t.existsSync(d))return Editor.error(Editor.T("migu-runtime.buidBeforePreview")),void 0;o.use(i.static(d));var p=await Editor.remote.Network.ip,l=await Editor.Profile.load("project://project.json").get("preview-port");const m=r.createServer(o);a(m,++l,p,async(e,r)=>{if(null!=e)return Editor.error("migu server failed to start: "+e),void 0;Editor.log(`migu server listening at http://${p}:${r}`);var t=`http://${p}:${r}`+`/${n.title}.rpk`,i="youplay://cocosgame?",o=Editor.Profile.load("project://migu-runtime.json").getSelfData();i+=`gameId=${o.package}`,i+=`&gameName=${o.name}`,i+=`&portrait=${"portrait"===o.deviceOrientation?1:0}`,i+=`&versionCode=${o.versionCode}`,i+=`&hasSubpackage=${o.isSubpackage?1:0}`,s(i+=`&mainUrl=${t}`)})},setOptions:function(e){n=e},closePort:function(){},options:n};module.exports=s;