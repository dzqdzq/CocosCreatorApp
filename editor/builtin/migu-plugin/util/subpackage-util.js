let e,n,s,t,i,r,a=require("path"),o=require("fs-extra");module.exports={gatherInfo(a){i=a.JsZip,t=a.gameConfig,s=a.title,e=a.buildPath,r=a.options,n=[]},organizeResources(){let e=[];for(var s=0,i=r.bundles.length;s<i;s++){var c=r.bundles[s];if("subpackage"!==c.compressionType)continue;if(n.includes(c.scriptDest))break;let t=a.join(c.scriptDest,"index.js");o.existsSync(t)?(o.renameSync(t,a.join(c.scriptDest,"game.js")),n.push(c.scriptDest),e.push({name:"usr_"+c.name,root:c.name+"/"})):Editor.error("subpackage entry file does not exist, bundle.name: "+c.name)}e.length>0&&(t.subpackages=e)},async pack(){const s=[];n.forEach(function(n){let t=new i,r=a.win32.basename(n),c=a.join(e,"usr_"+r+".rpk");o.existsSync(c)&&o.unlinkSync(c),t.directory(n,r);const u=t.generateAsync({type:"nodebuffer",base64:!1,compression:"DEFLATE"}).then(function(e){o.writeFileSync(c,e)});s.push(u)}),s.length>0&&await Promise.all(s)}};