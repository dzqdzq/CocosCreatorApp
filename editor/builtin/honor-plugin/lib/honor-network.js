var e=require("path"),r=require("http"),t=require("fire-fs");const o=require("express"),i=o();var n,a=function(e,r,t,o){function i(){e.removeListener("error",n),o(null,r)}function n(n){if(e.removeListener("listening",i),"EADDRINUSE"!==n.code&&"EACCES"!==n.code)return o(n);Editor.warn(`The current '${r}' preview port is already occupied, the port is automatically incremented`),a(e,++r,t,o)}e.once("error",n),e.once("listening",i),e.listen(r,t)};let s={npmRunServer:async function(s,c){var d=n.dest,u=e.join(d,"dist");if(!t.existsSync(u))return Editor.error(Editor.T("honor-minigame.buidBeforePreview")),void 0;i.use(o.static(u));var l=await Editor.remote.Network.ip,p=await Editor.Profile.load("project://project.json").get("preview-port");const f=r.createServer(i);a(f,++p,l,async(e,r)=>{if(null!=e)return Editor.error("honor server failed to start: "+e),void 0;Editor.log(`honor server listening at http://${l}:${r}`);var t=Editor.Profile.load("project://honor-minigame.json").getSelfData(),o=`http://${l}:${r}`+`/${t.package}.rpk`;s(o)})},setOptions:function(e){n=e},closePort:function(){},options:n};module.exports=s;