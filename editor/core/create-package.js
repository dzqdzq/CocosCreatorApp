"use strict";const e=require("electron").ipcMain,a=require("path"),t=require("fire-fs"),r=Editor.url("unpack://static/package-template");function i(e,a,r){var i=t.readFileSync(e,{encoding:"utf8"});t.writeFileSync(e,i.replace(new RegExp(a,"ig"),r),{encoding:"utf8"})}e.on("editor:create-package",async(e,c)=>{var o="";"global"===c?o=a.join(Editor.App.home,"packages"):"project"===c&&(o=a.join(Editor.Project.path,"packages"));var n=await Editor.Dialog.saveFile({title:Editor.T("MESSAGE.package.title"),defaultPath:o,buttonLabel:Editor.T("MESSAGE.package.create")});if(!n)return;if(t.isDirSync(n))return Editor.error("Failed to create package at "+n+", Directory already exists!"),void 0;const s=a.basename(n),d=Editor.Package.packagePath(s);if(Editor.Package.packagePath(s))return Editor.error(`Failed to create ${s} package because it has the same name as ${d}`),void 0;(function(e,c){var o=a.basename(e);t.copy(r,e,function(t){if(t)return c(t);(function(e,t,c){var o=a.basename(r);return i(a.join(t,"package.json"),o,e),i(a.join(t,"main.js"),o,e),i(a.join(t,"panel","index.js"),o,e),c(null)})(o,e,c)})})(n,function(e){e?Editor.error(e):Editor.Package.load(n,()=>{Editor.success("Create package successfully at "+n)})})});