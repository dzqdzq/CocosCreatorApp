"use strict";const e=require("electron").ipcMain,{EventEmitter:t}=require("events"),o=require("../../request.js").sendRequest,c=require("../lib/config").trackID,r=require("../../cocos-analytics");let n="",i="";let l=module.exports=new class extends t{constructor(){super(),this.trackID=c}trackEvent(e,t){if(!n)return console.log("no valid user ID"),void 0;if(!i)return console.log("no valid client ID"),void 0;let l={v:1,tid:c,cid:i,uid:n,t:"event",ec:e.category,ea:e.action};e.label&&(l.el=e.label),o({method:"POST",host:"www.google-analytics.com",path:"/collect",protocol:"https",data:l},function(e,o){e&&console.log(e),t&&t(e,o)}),r.trackEvent(e)}trackException(e,t){if(!i)return console.log("no valid client ID"),void 0;o({method:"POST",host:"www.google-analytics.com",path:"/collect",protocol:"https",data:{v:1,tid:c,cid:i,uid:n,t:"exception",exd:e,exf:0}},function(e,o){e&&console.log(e),t&&t(e,o)}),r.trackException(e)}prepareUserIdentity(){let e=Editor.Profile.load("global://user_token.json");e.get("nickname"),e.get("email"),n=e.get("cocos_uid")}sendAppInfo(e){if(!i)return console.log("no valid client ID"),void 0;let t=require("semver"),r=Editor.versions.CocosCreator,l=`${t.major(r)}.${t.minor(r)}.${t.patch(r)}`;o({method:"POST",host:"www.google-analytics.com",path:"/collect",protocol:"https",data:{v:1,tid:c,cid:i,uid:n,t:"screenview",an:"CocosCreator",aid:"com.cocos.creator",av:l,cd:"Home"}},function(t,o){t&&console.log(t),e&&e(t,o)})}setClientId(e){const t=require("md5");require("getmac").getMac(function(o,c){let r="";if(o){console.log(o);let e=require("os").networkInterfaces(),c=!1;for(var n in e){let o=e[n];for(let e=0;e<o.length;++e){let n=o[e];if(!n.internal&&n.mac){r=t(n.mac),c=!0;break}}if(c)break}c||(r=t("00:00:00:00:00:00"))}else r=t(c);i=r,e()})}};e.on("metrics:track-event",(e,t)=>{l.trackEvent(t,null)}),e.on("metrics:track-exception",(e,t)=>{l.trackException(t,null)});