"use strict";const e=require("os"),t=require("https"),{parse:r}=require("url"),{stringify:o}=require("querystring"),{request:n}=require("https");exports.canConnectPassport=function(e){let r=!1,o=t.request({method:"GET",host:"passport.cocos.com",port:443,path:"/oauth/token?xxx",headers:{}},t=>{if(200!==t.statusCode){if(Editor.log("failed to connect login server... skipping login"),r)return;return r=!0,e(!1)}if(!r)return r=!0,Editor.log("connected!"),e(!0)}).on("error",t=>{if(!r)return r=!0,Editor.log("failed to connect login server... skipping login"),e(!1)});o.write(""),o.end(),setTimeout(function(){if(!r)return Editor.log("failed to connect login server due to request timeout"),r=!0,e(!1)},3e3)},exports.queryIpList=function(){let t=e.networkInterfaces(),r=[];for(let e in t)t[e].forEach(e=>{"IPv4"===e.family&&!1===e.internal&&r.push(e.address)});return"win32"===process.platform&&(r=r.filter(e=>/^(?!169\.254)/.test(e))),r},exports.sendPostRequest=function(e,t){return new Promise((i,s)=>{let a=r(e),u={"Content-Type":"application/x-www-form-urlencoded","Content-Length":(t=o(t||{})).length,"User-Agent":"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.23 Mobile Safari/537.36"},d={method:"POST",host:a.hostname,port:a.port||443,path:a.pathname,headers:u},l="",p=n(d,e=>{if(200!==e.statusCode)return s(new Error("Connect Failed")),void 0;e.on("data",e=>{l+=e}).on("end",()=>{var e=null;try{e=JSON.parse(l)}catch(e){return s(e),void 0}i(e)})}).on("error",e=>{s(e)}).setTimeout(8e3,()=>{s(new Error("timeout"))});p.write(t),p.end()})},exports.sendGetRequest=function(e,t){return new Promise((i,s)=>{var a=r(e);t=o(t||{});var u={method:"GET",host:a.hostname,port:a.port||443,path:a.pathname+"?"+t,headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.23 Mobile Safari/537.36"}},d="";n(u,e=>{if(200!==e.statusCode)return s(new Error("Connect Failed")),void 0;e.on("data",e=>{d+=e}).on("end",()=>{var e=null;try{e=JSON.parse(d)}catch(e){return s(e)}i(e)})}).on("error",e=>{s(e)}).setTimeout(8e3,()=>{s(new Error("timeout"))}).end()})};